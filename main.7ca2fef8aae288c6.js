(self.webpackChunkfront_end_avanzada=self.webpackChunkfront_end_avanzada||[]).push([[792],{247:function(hm){hm.exports=function(){"use strict";var Ph,Ll,Iu;function nl(h,Jr){if(Ph)if(Ll){var Ro="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Ph+")(sharedChunk); ("+Ll+")(sharedChunk); self.onerror = null;",Kn={};Ph(Kn),Iu=Jr(Kn),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(Iu.workerUrl=window.URL.createObjectURL(new Blob([Ro],{type:"text/javascript"})))}else Ll=Jr;else Ph=Jr}return nl(0,function(h){function Jr(d){return d&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d}var Ro,Kn={},Gn={};function To(){if(Ro)return Gn;Ro=1,Object.defineProperty(Gn,"__esModule",{value:!0}),Gn.setMatrixArrayType=function(g){Gn.ARRAY_TYPE=o=g},Gn.toRadian=function(g){return g*u},Gn.equals=function(g,p){return Math.abs(g-p)<=d*Math.max(1,Math.abs(g),Math.abs(p))},Gn.RANDOM=Gn.ARRAY_TYPE=Gn.EPSILON=void 0;var d=1e-6;Gn.EPSILON=d;var o=typeof Float32Array<"u"?Float32Array:Array;Gn.ARRAY_TYPE=o;var a=Math.random;Gn.RANDOM=a;var u=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var g=0,p=arguments.length;p--;)g+=arguments[p]*arguments[p];return Math.sqrt(g)}),Gn}var nr,jn={};function ri(){if(nr)return jn;function d(p){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(y){return typeof y}:function(y){return y&&"function"==typeof Symbol&&y.constructor===Symbol&&y!==Symbol.prototype?"symbol":typeof y})(p)}nr=1,Object.defineProperty(jn,"__esModule",{value:!0}),jn.create=function(){var p=new o.ARRAY_TYPE(4);return o.ARRAY_TYPE!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p},jn.clone=function(p){var y=new o.ARRAY_TYPE(4);return y[0]=p[0],y[1]=p[1],y[2]=p[2],y[3]=p[3],y},jn.copy=function(p,y){return p[0]=y[0],p[1]=y[1],p[2]=y[2],p[3]=y[3],p},jn.identity=function(p){return p[0]=1,p[1]=0,p[2]=0,p[3]=1,p},jn.fromValues=function(p,y,C,S){var I=new o.ARRAY_TYPE(4);return I[0]=p,I[1]=y,I[2]=C,I[3]=S,I},jn.set=function(p,y,C,S,I){return p[0]=y,p[1]=C,p[2]=S,p[3]=I,p},jn.transpose=function(p,y){if(p===y){var C=y[1];p[1]=y[2],p[2]=C}else p[0]=y[0],p[1]=y[2],p[2]=y[1],p[3]=y[3];return p},jn.invert=function(p,y){var C=y[0],S=y[1],I=y[2],b=y[3],D=C*b-I*S;return D?(p[0]=b*(D=1/D),p[1]=-S*D,p[2]=-I*D,p[3]=C*D,p):null},jn.adjoint=function(p,y){var C=y[0];return p[0]=y[3],p[1]=-y[1],p[2]=-y[2],p[3]=C,p},jn.determinant=function(p){return p[0]*p[3]-p[2]*p[1]},jn.multiply=u,jn.rotate=function(p,y,C){var S=y[0],I=y[1],b=y[2],D=y[3],k=Math.sin(C),T=Math.cos(C);return p[0]=S*T+b*k,p[1]=I*T+D*k,p[2]=S*-k+b*T,p[3]=I*-k+D*T,p},jn.scale=function(p,y,C){var S=y[1],I=y[2],b=y[3],D=C[0],k=C[1];return p[0]=y[0]*D,p[1]=S*D,p[2]=I*k,p[3]=b*k,p},jn.fromRotation=function(p,y){var C=Math.sin(y),S=Math.cos(y);return p[0]=S,p[1]=C,p[2]=-C,p[3]=S,p},jn.fromScaling=function(p,y){return p[0]=y[0],p[1]=0,p[2]=0,p[3]=y[1],p},jn.str=function(p){return"mat2("+p[0]+", "+p[1]+", "+p[2]+", "+p[3]+")"},jn.frob=function(p){return Math.hypot(p[0],p[1],p[2],p[3])},jn.LDU=function(p,y,C,S){return p[2]=S[2]/S[0],C[0]=S[0],C[1]=S[1],C[3]=S[3]-p[2]*C[1],[p,y,C]},jn.add=function(p,y,C){return p[0]=y[0]+C[0],p[1]=y[1]+C[1],p[2]=y[2]+C[2],p[3]=y[3]+C[3],p},jn.subtract=g,jn.exactEquals=function(p,y){return p[0]===y[0]&&p[1]===y[1]&&p[2]===y[2]&&p[3]===y[3]},jn.equals=function(p,y){var C=p[0],S=p[1],I=p[2],b=p[3],D=y[0],k=y[1],T=y[2],A=y[3];return Math.abs(C-D)<=o.EPSILON*Math.max(1,Math.abs(C),Math.abs(D))&&Math.abs(S-k)<=o.EPSILON*Math.max(1,Math.abs(S),Math.abs(k))&&Math.abs(I-T)<=o.EPSILON*Math.max(1,Math.abs(I),Math.abs(T))&&Math.abs(b-A)<=o.EPSILON*Math.max(1,Math.abs(b),Math.abs(A))},jn.multiplyScalar=function(p,y,C){return p[0]=y[0]*C,p[1]=y[1]*C,p[2]=y[2]*C,p[3]=y[3]*C,p},jn.multiplyScalarAndAdd=function(p,y,C,S){return p[0]=y[0]+C[0]*S,p[1]=y[1]+C[1]*S,p[2]=y[2]+C[2]*S,p[3]=y[3]+C[3]*S,p},jn.sub=jn.mul=void 0;var o=function(p){if(p&&p.__esModule)return p;if(null===p||"object"!==d(p)&&"function"!=typeof p)return{default:p};var C=a(void 0);if(C&&C.has(p))return C.get(p);var S={},I=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var b in p)if("default"!==b&&Object.prototype.hasOwnProperty.call(p,b)){var D=I?Object.getOwnPropertyDescriptor(p,b):null;D&&(D.get||D.set)?Object.defineProperty(S,b,D):S[b]=p[b]}return S.default=p,C&&C.set(p,S),S}(To());function a(p){if("function"!=typeof WeakMap)return null;var y=new WeakMap,C=new WeakMap;return(a=function(S){return S?C:y})(p)}function u(p,y,C){var S=y[0],I=y[1],b=y[2],D=y[3],k=C[0],T=C[1],A=C[2],O=C[3];return p[0]=S*k+b*T,p[1]=I*k+D*T,p[2]=S*A+b*O,p[3]=I*A+D*O,p}function g(p,y,C){return p[0]=y[0]-C[0],p[1]=y[1]-C[1],p[2]=y[2]-C[2],p[3]=y[3]-C[3],p}return jn.mul=u,jn.sub=g,jn}var Bi,fi={};function Ta(){if(Bi)return fi;function d(p){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(y){return typeof y}:function(y){return y&&"function"==typeof Symbol&&y.constructor===Symbol&&y!==Symbol.prototype?"symbol":typeof y})(p)}Bi=1,Object.defineProperty(fi,"__esModule",{value:!0}),fi.create=function(){var p=new o.ARRAY_TYPE(6);return o.ARRAY_TYPE!=Float32Array&&(p[1]=0,p[2]=0,p[4]=0,p[5]=0),p[0]=1,p[3]=1,p},fi.clone=function(p){var y=new o.ARRAY_TYPE(6);return y[0]=p[0],y[1]=p[1],y[2]=p[2],y[3]=p[3],y[4]=p[4],y[5]=p[5],y},fi.copy=function(p,y){return p[0]=y[0],p[1]=y[1],p[2]=y[2],p[3]=y[3],p[4]=y[4],p[5]=y[5],p},fi.identity=function(p){return p[0]=1,p[1]=0,p[2]=0,p[3]=1,p[4]=0,p[5]=0,p},fi.fromValues=function(p,y,C,S,I,b){var D=new o.ARRAY_TYPE(6);return D[0]=p,D[1]=y,D[2]=C,D[3]=S,D[4]=I,D[5]=b,D},fi.set=function(p,y,C,S,I,b,D){return p[0]=y,p[1]=C,p[2]=S,p[3]=I,p[4]=b,p[5]=D,p},fi.invert=function(p,y){var C=y[0],S=y[1],I=y[2],b=y[3],D=y[4],k=y[5],T=C*b-S*I;return T?(p[0]=b*(T=1/T),p[1]=-S*T,p[2]=-I*T,p[3]=C*T,p[4]=(I*k-b*D)*T,p[5]=(S*D-C*k)*T,p):null},fi.determinant=function(p){return p[0]*p[3]-p[1]*p[2]},fi.multiply=u,fi.rotate=function(p,y,C){var S=y[0],I=y[1],b=y[2],D=y[3],k=y[4],T=y[5],A=Math.sin(C),O=Math.cos(C);return p[0]=S*O+b*A,p[1]=I*O+D*A,p[2]=S*-A+b*O,p[3]=I*-A+D*O,p[4]=k,p[5]=T,p},fi.scale=function(p,y,C){var S=y[1],I=y[2],b=y[3],D=y[4],k=y[5],T=C[0],A=C[1];return p[0]=y[0]*T,p[1]=S*T,p[2]=I*A,p[3]=b*A,p[4]=D,p[5]=k,p},fi.translate=function(p,y,C){var S=y[0],I=y[1],b=y[2],D=y[3],k=y[4],T=y[5],A=C[0],O=C[1];return p[0]=S,p[1]=I,p[2]=b,p[3]=D,p[4]=S*A+b*O+k,p[5]=I*A+D*O+T,p},fi.fromRotation=function(p,y){var C=Math.sin(y),S=Math.cos(y);return p[0]=S,p[1]=C,p[2]=-C,p[3]=S,p[4]=0,p[5]=0,p},fi.fromScaling=function(p,y){return p[0]=y[0],p[1]=0,p[2]=0,p[3]=y[1],p[4]=0,p[5]=0,p},fi.fromTranslation=function(p,y){return p[0]=1,p[1]=0,p[2]=0,p[3]=1,p[4]=y[0],p[5]=y[1],p},fi.str=function(p){return"mat2d("+p[0]+", "+p[1]+", "+p[2]+", "+p[3]+", "+p[4]+", "+p[5]+")"},fi.frob=function(p){return Math.hypot(p[0],p[1],p[2],p[3],p[4],p[5],1)},fi.add=function(p,y,C){return p[0]=y[0]+C[0],p[1]=y[1]+C[1],p[2]=y[2]+C[2],p[3]=y[3]+C[3],p[4]=y[4]+C[4],p[5]=y[5]+C[5],p},fi.subtract=g,fi.multiplyScalar=function(p,y,C){return p[0]=y[0]*C,p[1]=y[1]*C,p[2]=y[2]*C,p[3]=y[3]*C,p[4]=y[4]*C,p[5]=y[5]*C,p},fi.multiplyScalarAndAdd=function(p,y,C,S){return p[0]=y[0]+C[0]*S,p[1]=y[1]+C[1]*S,p[2]=y[2]+C[2]*S,p[3]=y[3]+C[3]*S,p[4]=y[4]+C[4]*S,p[5]=y[5]+C[5]*S,p},fi.exactEquals=function(p,y){return p[0]===y[0]&&p[1]===y[1]&&p[2]===y[2]&&p[3]===y[3]&&p[4]===y[4]&&p[5]===y[5]},fi.equals=function(p,y){var C=p[0],S=p[1],I=p[2],b=p[3],D=p[4],k=p[5],T=y[0],A=y[1],O=y[2],B=y[3],V=y[4],q=y[5];return Math.abs(C-T)<=o.EPSILON*Math.max(1,Math.abs(C),Math.abs(T))&&Math.abs(S-A)<=o.EPSILON*Math.max(1,Math.abs(S),Math.abs(A))&&Math.abs(I-O)<=o.EPSILON*Math.max(1,Math.abs(I),Math.abs(O))&&Math.abs(b-B)<=o.EPSILON*Math.max(1,Math.abs(b),Math.abs(B))&&Math.abs(D-V)<=o.EPSILON*Math.max(1,Math.abs(D),Math.abs(V))&&Math.abs(k-q)<=o.EPSILON*Math.max(1,Math.abs(k),Math.abs(q))},fi.sub=fi.mul=void 0;var o=function(p){if(p&&p.__esModule)return p;if(null===p||"object"!==d(p)&&"function"!=typeof p)return{default:p};var C=a(void 0);if(C&&C.has(p))return C.get(p);var S={},I=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var b in p)if("default"!==b&&Object.prototype.hasOwnProperty.call(p,b)){var D=I?Object.getOwnPropertyDescriptor(p,b):null;D&&(D.get||D.set)?Object.defineProperty(S,b,D):S[b]=p[b]}return S.default=p,C&&C.set(p,S),S}(To());function a(p){if("function"!=typeof WeakMap)return null;var y=new WeakMap,C=new WeakMap;return(a=function(S){return S?C:y})(p)}function u(p,y,C){var S=y[0],I=y[1],b=y[2],D=y[3],k=y[4],T=y[5],A=C[0],O=C[1],B=C[2],V=C[3],q=C[4],G=C[5];return p[0]=S*A+b*O,p[1]=I*A+D*O,p[2]=S*B+b*V,p[3]=I*B+D*V,p[4]=S*q+b*G+k,p[5]=I*q+D*G+T,p}function g(p,y,C){return p[0]=y[0]-C[0],p[1]=y[1]-C[1],p[2]=y[2]-C[2],p[3]=y[3]-C[3],p[4]=y[4]-C[4],p[5]=y[5]-C[5],p}return fi.mul=u,fi.sub=g,fi}var jc,Li={};function Ld(){if(jc)return Li;function d(p){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(y){return typeof y}:function(y){return y&&"function"==typeof Symbol&&y.constructor===Symbol&&y!==Symbol.prototype?"symbol":typeof y})(p)}jc=1,Object.defineProperty(Li,"__esModule",{value:!0}),Li.create=function(){var p=new o.ARRAY_TYPE(9);return o.ARRAY_TYPE!=Float32Array&&(p[1]=0,p[2]=0,p[3]=0,p[5]=0,p[6]=0,p[7]=0),p[0]=1,p[4]=1,p[8]=1,p},Li.fromMat4=function(p,y){return p[0]=y[0],p[1]=y[1],p[2]=y[2],p[3]=y[4],p[4]=y[5],p[5]=y[6],p[6]=y[8],p[7]=y[9],p[8]=y[10],p},Li.clone=function(p){var y=new o.ARRAY_TYPE(9);return y[0]=p[0],y[1]=p[1],y[2]=p[2],y[3]=p[3],y[4]=p[4],y[5]=p[5],y[6]=p[6],y[7]=p[7],y[8]=p[8],y},Li.copy=function(p,y){return p[0]=y[0],p[1]=y[1],p[2]=y[2],p[3]=y[3],p[4]=y[4],p[5]=y[5],p[6]=y[6],p[7]=y[7],p[8]=y[8],p},Li.fromValues=function(p,y,C,S,I,b,D,k,T){var A=new o.ARRAY_TYPE(9);return A[0]=p,A[1]=y,A[2]=C,A[3]=S,A[4]=I,A[5]=b,A[6]=D,A[7]=k,A[8]=T,A},Li.set=function(p,y,C,S,I,b,D,k,T,A){return p[0]=y,p[1]=C,p[2]=S,p[3]=I,p[4]=b,p[5]=D,p[6]=k,p[7]=T,p[8]=A,p},Li.identity=function(p){return p[0]=1,p[1]=0,p[2]=0,p[3]=0,p[4]=1,p[5]=0,p[6]=0,p[7]=0,p[8]=1,p},Li.transpose=function(p,y){if(p===y){var C=y[1],S=y[2],I=y[5];p[1]=y[3],p[2]=y[6],p[3]=C,p[5]=y[7],p[6]=S,p[7]=I}else p[0]=y[0],p[1]=y[3],p[2]=y[6],p[3]=y[1],p[4]=y[4],p[5]=y[7],p[6]=y[2],p[7]=y[5],p[8]=y[8];return p},Li.invert=function(p,y){var C=y[0],S=y[1],I=y[2],b=y[3],D=y[4],k=y[5],T=y[6],A=y[7],O=y[8],B=O*D-k*A,V=-O*b+k*T,q=A*b-D*T,G=C*B+S*V+I*q;return G?(p[0]=B*(G=1/G),p[1]=(-O*S+I*A)*G,p[2]=(k*S-I*D)*G,p[3]=V*G,p[4]=(O*C-I*T)*G,p[5]=(-k*C+I*b)*G,p[6]=q*G,p[7]=(-A*C+S*T)*G,p[8]=(D*C-S*b)*G,p):null},Li.adjoint=function(p,y){var C=y[0],S=y[1],I=y[2],b=y[3],D=y[4],k=y[5],T=y[6],A=y[7],O=y[8];return p[0]=D*O-k*A,p[1]=I*A-S*O,p[2]=S*k-I*D,p[3]=k*T-b*O,p[4]=C*O-I*T,p[5]=I*b-C*k,p[6]=b*A-D*T,p[7]=S*T-C*A,p[8]=C*D-S*b,p},Li.determinant=function(p){var y=p[3],C=p[4],S=p[5],I=p[6],b=p[7],D=p[8];return p[0]*(D*C-S*b)+p[1]*(-D*y+S*I)+p[2]*(b*y-C*I)},Li.multiply=u,Li.translate=function(p,y,C){var S=y[0],I=y[1],b=y[2],D=y[3],k=y[4],T=y[5],A=y[6],O=y[7],B=y[8],V=C[0],q=C[1];return p[0]=S,p[1]=I,p[2]=b,p[3]=D,p[4]=k,p[5]=T,p[6]=V*S+q*D+A,p[7]=V*I+q*k+O,p[8]=V*b+q*T+B,p},Li.rotate=function(p,y,C){var S=y[0],I=y[1],b=y[2],D=y[3],k=y[4],T=y[5],A=y[6],O=y[7],B=y[8],V=Math.sin(C),q=Math.cos(C);return p[0]=q*S+V*D,p[1]=q*I+V*k,p[2]=q*b+V*T,p[3]=q*D-V*S,p[4]=q*k-V*I,p[5]=q*T-V*b,p[6]=A,p[7]=O,p[8]=B,p},Li.scale=function(p,y,C){var S=C[0],I=C[1];return p[0]=S*y[0],p[1]=S*y[1],p[2]=S*y[2],p[3]=I*y[3],p[4]=I*y[4],p[5]=I*y[5],p[6]=y[6],p[7]=y[7],p[8]=y[8],p},Li.fromTranslation=function(p,y){return p[0]=1,p[1]=0,p[2]=0,p[3]=0,p[4]=1,p[5]=0,p[6]=y[0],p[7]=y[1],p[8]=1,p},Li.fromRotation=function(p,y){var C=Math.sin(y),S=Math.cos(y);return p[0]=S,p[1]=C,p[2]=0,p[3]=-C,p[4]=S,p[5]=0,p[6]=0,p[7]=0,p[8]=1,p},Li.fromScaling=function(p,y){return p[0]=y[0],p[1]=0,p[2]=0,p[3]=0,p[4]=y[1],p[5]=0,p[6]=0,p[7]=0,p[8]=1,p},Li.fromMat2d=function(p,y){return p[0]=y[0],p[1]=y[1],p[2]=0,p[3]=y[2],p[4]=y[3],p[5]=0,p[6]=y[4],p[7]=y[5],p[8]=1,p},Li.fromQuat=function(p,y){var C=y[0],S=y[1],I=y[2],b=y[3],D=C+C,k=S+S,T=I+I,A=C*D,O=S*D,B=S*k,V=I*D,q=I*k,G=I*T,H=b*D,Z=b*k,ee=b*T;return p[0]=1-B-G,p[3]=O-ee,p[6]=V+Z,p[1]=O+ee,p[4]=1-A-G,p[7]=q-H,p[2]=V-Z,p[5]=q+H,p[8]=1-A-B,p},Li.normalFromMat4=function(p,y){var C=y[0],S=y[1],I=y[2],b=y[3],D=y[4],k=y[5],T=y[6],A=y[7],O=y[8],B=y[9],V=y[10],q=y[11],G=y[12],H=y[13],Z=y[14],ee=y[15],ie=C*k-S*D,me=C*T-I*D,ue=C*A-b*D,pe=S*T-I*k,Te=S*A-b*k,_e=I*A-b*T,Ie=O*H-B*G,Le=O*Z-V*G,Fe=O*ee-q*G,Ve=B*Z-V*H,ze=B*ee-q*H,We=V*ee-q*Z,Ue=ie*We-me*ze+ue*Ve+pe*Fe-Te*Le+_e*Ie;return Ue?(p[0]=(k*We-T*ze+A*Ve)*(Ue=1/Ue),p[1]=(T*Fe-D*We-A*Le)*Ue,p[2]=(D*ze-k*Fe+A*Ie)*Ue,p[3]=(I*ze-S*We-b*Ve)*Ue,p[4]=(C*We-I*Fe+b*Le)*Ue,p[5]=(S*Fe-C*ze-b*Ie)*Ue,p[6]=(H*_e-Z*Te+ee*pe)*Ue,p[7]=(Z*ue-G*_e-ee*me)*Ue,p[8]=(G*Te-H*ue+ee*ie)*Ue,p):null},Li.projection=function(p,y,C){return p[0]=2/y,p[1]=0,p[2]=0,p[3]=0,p[4]=-2/C,p[5]=0,p[6]=-1,p[7]=1,p[8]=1,p},Li.str=function(p){return"mat3("+p[0]+", "+p[1]+", "+p[2]+", "+p[3]+", "+p[4]+", "+p[5]+", "+p[6]+", "+p[7]+", "+p[8]+")"},Li.frob=function(p){return Math.hypot(p[0],p[1],p[2],p[3],p[4],p[5],p[6],p[7],p[8])},Li.add=function(p,y,C){return p[0]=y[0]+C[0],p[1]=y[1]+C[1],p[2]=y[2]+C[2],p[3]=y[3]+C[3],p[4]=y[4]+C[4],p[5]=y[5]+C[5],p[6]=y[6]+C[6],p[7]=y[7]+C[7],p[8]=y[8]+C[8],p},Li.subtract=g,Li.multiplyScalar=function(p,y,C){return p[0]=y[0]*C,p[1]=y[1]*C,p[2]=y[2]*C,p[3]=y[3]*C,p[4]=y[4]*C,p[5]=y[5]*C,p[6]=y[6]*C,p[7]=y[7]*C,p[8]=y[8]*C,p},Li.multiplyScalarAndAdd=function(p,y,C,S){return p[0]=y[0]+C[0]*S,p[1]=y[1]+C[1]*S,p[2]=y[2]+C[2]*S,p[3]=y[3]+C[3]*S,p[4]=y[4]+C[4]*S,p[5]=y[5]+C[5]*S,p[6]=y[6]+C[6]*S,p[7]=y[7]+C[7]*S,p[8]=y[8]+C[8]*S,p},Li.exactEquals=function(p,y){return p[0]===y[0]&&p[1]===y[1]&&p[2]===y[2]&&p[3]===y[3]&&p[4]===y[4]&&p[5]===y[5]&&p[6]===y[6]&&p[7]===y[7]&&p[8]===y[8]},Li.equals=function(p,y){var C=p[0],S=p[1],I=p[2],b=p[3],D=p[4],k=p[5],T=p[6],A=p[7],O=p[8],B=y[0],V=y[1],q=y[2],G=y[3],H=y[4],Z=y[5],ee=y[6],ie=y[7],me=y[8];return Math.abs(C-B)<=o.EPSILON*Math.max(1,Math.abs(C),Math.abs(B))&&Math.abs(S-V)<=o.EPSILON*Math.max(1,Math.abs(S),Math.abs(V))&&Math.abs(I-q)<=o.EPSILON*Math.max(1,Math.abs(I),Math.abs(q))&&Math.abs(b-G)<=o.EPSILON*Math.max(1,Math.abs(b),Math.abs(G))&&Math.abs(D-H)<=o.EPSILON*Math.max(1,Math.abs(D),Math.abs(H))&&Math.abs(k-Z)<=o.EPSILON*Math.max(1,Math.abs(k),Math.abs(Z))&&Math.abs(T-ee)<=o.EPSILON*Math.max(1,Math.abs(T),Math.abs(ee))&&Math.abs(A-ie)<=o.EPSILON*Math.max(1,Math.abs(A),Math.abs(ie))&&Math.abs(O-me)<=o.EPSILON*Math.max(1,Math.abs(O),Math.abs(me))},Li.sub=Li.mul=void 0;var o=function(p){if(p&&p.__esModule)return p;if(null===p||"object"!==d(p)&&"function"!=typeof p)return{default:p};var C=a(void 0);if(C&&C.has(p))return C.get(p);var S={},I=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var b in p)if("default"!==b&&Object.prototype.hasOwnProperty.call(p,b)){var D=I?Object.getOwnPropertyDescriptor(p,b):null;D&&(D.get||D.set)?Object.defineProperty(S,b,D):S[b]=p[b]}return S.default=p,C&&C.set(p,S),S}(To());function a(p){if("function"!=typeof WeakMap)return null;var y=new WeakMap,C=new WeakMap;return(a=function(S){return S?C:y})(p)}function u(p,y,C){var S=y[0],I=y[1],b=y[2],D=y[3],k=y[4],T=y[5],A=y[6],O=y[7],B=y[8],V=C[0],q=C[1],G=C[2],H=C[3],Z=C[4],ee=C[5],ie=C[6],me=C[7],ue=C[8];return p[0]=V*S+q*D+G*A,p[1]=V*I+q*k+G*O,p[2]=V*b+q*T+G*B,p[3]=H*S+Z*D+ee*A,p[4]=H*I+Z*k+ee*O,p[5]=H*b+Z*T+ee*B,p[6]=ie*S+me*D+ue*A,p[7]=ie*I+me*k+ue*O,p[8]=ie*b+me*T+ue*B,p}function g(p,y,C){return p[0]=y[0]-C[0],p[1]=y[1]-C[1],p[2]=y[2]-C[2],p[3]=y[3]-C[3],p[4]=y[4]-C[4],p[5]=y[5]-C[5],p[6]=y[6]-C[6],p[7]=y[7]-C[7],p[8]=y[8]-C[8],p}return Li.mul=u,Li.sub=g,Li}var Ia,Sn={};function Aa(){if(Ia)return Sn;function d(b){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(D){return typeof D}:function(D){return D&&"function"==typeof Symbol&&D.constructor===Symbol&&D!==Symbol.prototype?"symbol":typeof D})(b)}Ia=1,Object.defineProperty(Sn,"__esModule",{value:!0}),Sn.create=function(){var b=new o.ARRAY_TYPE(16);return o.ARRAY_TYPE!=Float32Array&&(b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[11]=0,b[12]=0,b[13]=0,b[14]=0),b[0]=1,b[5]=1,b[10]=1,b[15]=1,b},Sn.clone=function(b){var D=new o.ARRAY_TYPE(16);return D[0]=b[0],D[1]=b[1],D[2]=b[2],D[3]=b[3],D[4]=b[4],D[5]=b[5],D[6]=b[6],D[7]=b[7],D[8]=b[8],D[9]=b[9],D[10]=b[10],D[11]=b[11],D[12]=b[12],D[13]=b[13],D[14]=b[14],D[15]=b[15],D},Sn.copy=function(b,D){return b[0]=D[0],b[1]=D[1],b[2]=D[2],b[3]=D[3],b[4]=D[4],b[5]=D[5],b[6]=D[6],b[7]=D[7],b[8]=D[8],b[9]=D[9],b[10]=D[10],b[11]=D[11],b[12]=D[12],b[13]=D[13],b[14]=D[14],b[15]=D[15],b},Sn.fromValues=function(b,D,k,T,A,O,B,V,q,G,H,Z,ee,ie,me,ue){var pe=new o.ARRAY_TYPE(16);return pe[0]=b,pe[1]=D,pe[2]=k,pe[3]=T,pe[4]=A,pe[5]=O,pe[6]=B,pe[7]=V,pe[8]=q,pe[9]=G,pe[10]=H,pe[11]=Z,pe[12]=ee,pe[13]=ie,pe[14]=me,pe[15]=ue,pe},Sn.set=function(b,D,k,T,A,O,B,V,q,G,H,Z,ee,ie,me,ue,pe){return b[0]=D,b[1]=k,b[2]=T,b[3]=A,b[4]=O,b[5]=B,b[6]=V,b[7]=q,b[8]=G,b[9]=H,b[10]=Z,b[11]=ee,b[12]=ie,b[13]=me,b[14]=ue,b[15]=pe,b},Sn.identity=u,Sn.transpose=function(b,D){if(b===D){var k=D[1],T=D[2],A=D[3],O=D[6],B=D[7],V=D[11];b[1]=D[4],b[2]=D[8],b[3]=D[12],b[4]=k,b[6]=D[9],b[7]=D[13],b[8]=T,b[9]=O,b[11]=D[14],b[12]=A,b[13]=B,b[14]=V}else b[0]=D[0],b[1]=D[4],b[2]=D[8],b[3]=D[12],b[4]=D[1],b[5]=D[5],b[6]=D[9],b[7]=D[13],b[8]=D[2],b[9]=D[6],b[10]=D[10],b[11]=D[14],b[12]=D[3],b[13]=D[7],b[14]=D[11],b[15]=D[15];return b},Sn.invert=function(b,D){var k=D[0],T=D[1],A=D[2],O=D[3],B=D[4],V=D[5],q=D[6],G=D[7],H=D[8],Z=D[9],ee=D[10],ie=D[11],me=D[12],ue=D[13],pe=D[14],Te=D[15],_e=k*V-T*B,Ie=k*q-A*B,Le=k*G-O*B,Fe=T*q-A*V,Ve=T*G-O*V,ze=A*G-O*q,We=H*ue-Z*me,Ue=H*pe-ee*me,Ze=H*Te-ie*me,ht=Z*pe-ee*ue,ut=Z*Te-ie*ue,qt=ee*Te-ie*pe,gt=_e*qt-Ie*ut+Le*ht+Fe*Ze-Ve*Ue+ze*We;return gt?(b[0]=(V*qt-q*ut+G*ht)*(gt=1/gt),b[1]=(A*ut-T*qt-O*ht)*gt,b[2]=(ue*ze-pe*Ve+Te*Fe)*gt,b[3]=(ee*Ve-Z*ze-ie*Fe)*gt,b[4]=(q*Ze-B*qt-G*Ue)*gt,b[5]=(k*qt-A*Ze+O*Ue)*gt,b[6]=(pe*Le-me*ze-Te*Ie)*gt,b[7]=(H*ze-ee*Le+ie*Ie)*gt,b[8]=(B*ut-V*Ze+G*We)*gt,b[9]=(T*Ze-k*ut-O*We)*gt,b[10]=(me*Ve-ue*Le+Te*_e)*gt,b[11]=(Z*Le-H*Ve-ie*_e)*gt,b[12]=(V*Ue-B*ht-q*We)*gt,b[13]=(k*ht-T*Ue+A*We)*gt,b[14]=(ue*Ie-me*Fe-pe*_e)*gt,b[15]=(H*Fe-Z*Ie+ee*_e)*gt,b):null},Sn.adjoint=function(b,D){var k=D[0],T=D[1],A=D[2],O=D[3],B=D[4],V=D[5],q=D[6],G=D[7],H=D[8],Z=D[9],ee=D[10],ie=D[11],me=D[12],ue=D[13],pe=D[14],Te=D[15];return b[0]=V*(ee*Te-ie*pe)-Z*(q*Te-G*pe)+ue*(q*ie-G*ee),b[1]=-(T*(ee*Te-ie*pe)-Z*(A*Te-O*pe)+ue*(A*ie-O*ee)),b[2]=T*(q*Te-G*pe)-V*(A*Te-O*pe)+ue*(A*G-O*q),b[3]=-(T*(q*ie-G*ee)-V*(A*ie-O*ee)+Z*(A*G-O*q)),b[4]=-(B*(ee*Te-ie*pe)-H*(q*Te-G*pe)+me*(q*ie-G*ee)),b[5]=k*(ee*Te-ie*pe)-H*(A*Te-O*pe)+me*(A*ie-O*ee),b[6]=-(k*(q*Te-G*pe)-B*(A*Te-O*pe)+me*(A*G-O*q)),b[7]=k*(q*ie-G*ee)-B*(A*ie-O*ee)+H*(A*G-O*q),b[8]=B*(Z*Te-ie*ue)-H*(V*Te-G*ue)+me*(V*ie-G*Z),b[9]=-(k*(Z*Te-ie*ue)-H*(T*Te-O*ue)+me*(T*ie-O*Z)),b[10]=k*(V*Te-G*ue)-B*(T*Te-O*ue)+me*(T*G-O*V),b[11]=-(k*(V*ie-G*Z)-B*(T*ie-O*Z)+H*(T*G-O*V)),b[12]=-(B*(Z*pe-ee*ue)-H*(V*pe-q*ue)+me*(V*ee-q*Z)),b[13]=k*(Z*pe-ee*ue)-H*(T*pe-A*ue)+me*(T*ee-A*Z),b[14]=-(k*(V*pe-q*ue)-B*(T*pe-A*ue)+me*(T*q-A*V)),b[15]=k*(V*ee-q*Z)-B*(T*ee-A*Z)+H*(T*q-A*V),b},Sn.determinant=function(b){var D=b[0],k=b[1],T=b[2],A=b[3],O=b[4],B=b[5],V=b[6],q=b[7],G=b[8],H=b[9],Z=b[10],ee=b[11],ie=b[12],me=b[13],ue=b[14],pe=b[15];return(D*B-k*O)*(Z*pe-ee*ue)-(D*V-T*O)*(H*pe-ee*me)+(D*q-A*O)*(H*ue-Z*me)+(k*V-T*B)*(G*pe-ee*ie)-(k*q-A*B)*(G*ue-Z*ie)+(T*q-A*V)*(G*me-H*ie)},Sn.multiply=g,Sn.translate=function(b,D,k){var T,A,O,B,V,q,G,H,Z,ee,ie,me,ue=k[0],pe=k[1],Te=k[2];return D===b?(b[12]=D[0]*ue+D[4]*pe+D[8]*Te+D[12],b[13]=D[1]*ue+D[5]*pe+D[9]*Te+D[13],b[14]=D[2]*ue+D[6]*pe+D[10]*Te+D[14],b[15]=D[3]*ue+D[7]*pe+D[11]*Te+D[15]):(A=D[1],O=D[2],B=D[3],V=D[4],q=D[5],G=D[6],H=D[7],Z=D[8],ee=D[9],ie=D[10],me=D[11],b[0]=T=D[0],b[1]=A,b[2]=O,b[3]=B,b[4]=V,b[5]=q,b[6]=G,b[7]=H,b[8]=Z,b[9]=ee,b[10]=ie,b[11]=me,b[12]=T*ue+V*pe+Z*Te+D[12],b[13]=A*ue+q*pe+ee*Te+D[13],b[14]=O*ue+G*pe+ie*Te+D[14],b[15]=B*ue+H*pe+me*Te+D[15]),b},Sn.scale=function(b,D,k){var T=k[0],A=k[1],O=k[2];return b[0]=D[0]*T,b[1]=D[1]*T,b[2]=D[2]*T,b[3]=D[3]*T,b[4]=D[4]*A,b[5]=D[5]*A,b[6]=D[6]*A,b[7]=D[7]*A,b[8]=D[8]*O,b[9]=D[9]*O,b[10]=D[10]*O,b[11]=D[11]*O,b[12]=D[12],b[13]=D[13],b[14]=D[14],b[15]=D[15],b},Sn.rotate=function(b,D,k,T){var A,O,B,V,q,G,H,Z,ee,ie,me,ue,pe,Te,_e,Ie,Le,Fe,Ve,ze,We,Ue,Ze,ht,ut=T[0],qt=T[1],gt=T[2],yt=Math.hypot(ut,qt,gt);return yt<o.EPSILON?null:(ut*=yt=1/yt,qt*=yt,gt*=yt,A=Math.sin(k),O=Math.cos(k),q=D[1],G=D[2],H=D[3],ee=D[5],ie=D[6],me=D[7],pe=D[9],Te=D[10],_e=D[11],Ie=ut*ut*(B=1-O)+O,Ve=ut*qt*B-gt*A,ze=qt*qt*B+O,We=gt*qt*B+ut*A,Ue=ut*gt*B+qt*A,Ze=qt*gt*B-ut*A,ht=gt*gt*B+O,b[0]=(V=D[0])*Ie+(Z=D[4])*(Le=qt*ut*B+gt*A)+(ue=D[8])*(Fe=gt*ut*B-qt*A),b[1]=q*Ie+ee*Le+pe*Fe,b[2]=G*Ie+ie*Le+Te*Fe,b[3]=H*Ie+me*Le+_e*Fe,b[4]=V*Ve+Z*ze+ue*We,b[5]=q*Ve+ee*ze+pe*We,b[6]=G*Ve+ie*ze+Te*We,b[7]=H*Ve+me*ze+_e*We,b[8]=V*Ue+Z*Ze+ue*ht,b[9]=q*Ue+ee*Ze+pe*ht,b[10]=G*Ue+ie*Ze+Te*ht,b[11]=H*Ue+me*Ze+_e*ht,D!==b&&(b[12]=D[12],b[13]=D[13],b[14]=D[14],b[15]=D[15]),b)},Sn.rotateX=function(b,D,k){var T=Math.sin(k),A=Math.cos(k),O=D[4],B=D[5],V=D[6],q=D[7],G=D[8],H=D[9],Z=D[10],ee=D[11];return D!==b&&(b[0]=D[0],b[1]=D[1],b[2]=D[2],b[3]=D[3],b[12]=D[12],b[13]=D[13],b[14]=D[14],b[15]=D[15]),b[4]=O*A+G*T,b[5]=B*A+H*T,b[6]=V*A+Z*T,b[7]=q*A+ee*T,b[8]=G*A-O*T,b[9]=H*A-B*T,b[10]=Z*A-V*T,b[11]=ee*A-q*T,b},Sn.rotateY=function(b,D,k){var T=Math.sin(k),A=Math.cos(k),O=D[0],B=D[1],V=D[2],q=D[3],G=D[8],H=D[9],Z=D[10],ee=D[11];return D!==b&&(b[4]=D[4],b[5]=D[5],b[6]=D[6],b[7]=D[7],b[12]=D[12],b[13]=D[13],b[14]=D[14],b[15]=D[15]),b[0]=O*A-G*T,b[1]=B*A-H*T,b[2]=V*A-Z*T,b[3]=q*A-ee*T,b[8]=O*T+G*A,b[9]=B*T+H*A,b[10]=V*T+Z*A,b[11]=q*T+ee*A,b},Sn.rotateZ=function(b,D,k){var T=Math.sin(k),A=Math.cos(k),O=D[0],B=D[1],V=D[2],q=D[3],G=D[4],H=D[5],Z=D[6],ee=D[7];return D!==b&&(b[8]=D[8],b[9]=D[9],b[10]=D[10],b[11]=D[11],b[12]=D[12],b[13]=D[13],b[14]=D[14],b[15]=D[15]),b[0]=O*A+G*T,b[1]=B*A+H*T,b[2]=V*A+Z*T,b[3]=q*A+ee*T,b[4]=G*A-O*T,b[5]=H*A-B*T,b[6]=Z*A-V*T,b[7]=ee*A-q*T,b},Sn.fromTranslation=function(b,D){return b[0]=1,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=1,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[10]=1,b[11]=0,b[12]=D[0],b[13]=D[1],b[14]=D[2],b[15]=1,b},Sn.fromScaling=function(b,D){return b[0]=D[0],b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=D[1],b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[10]=D[2],b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b},Sn.fromRotation=function(b,D,k){var T,A,O,B=k[0],V=k[1],q=k[2],G=Math.hypot(B,V,q);return G<o.EPSILON?null:(B*=G=1/G,V*=G,q*=G,T=Math.sin(D),A=Math.cos(D),b[0]=B*B*(O=1-A)+A,b[1]=V*B*O+q*T,b[2]=q*B*O-V*T,b[3]=0,b[4]=B*V*O-q*T,b[5]=V*V*O+A,b[6]=q*V*O+B*T,b[7]=0,b[8]=B*q*O+V*T,b[9]=V*q*O-B*T,b[10]=q*q*O+A,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b)},Sn.fromXRotation=function(b,D){var k=Math.sin(D),T=Math.cos(D);return b[0]=1,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=T,b[6]=k,b[7]=0,b[8]=0,b[9]=-k,b[10]=T,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b},Sn.fromYRotation=function(b,D){var k=Math.sin(D),T=Math.cos(D);return b[0]=T,b[1]=0,b[2]=-k,b[3]=0,b[4]=0,b[5]=1,b[6]=0,b[7]=0,b[8]=k,b[9]=0,b[10]=T,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b},Sn.fromZRotation=function(b,D){var k=Math.sin(D),T=Math.cos(D);return b[0]=T,b[1]=k,b[2]=0,b[3]=0,b[4]=-k,b[5]=T,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[10]=1,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b},Sn.fromRotationTranslation=p,Sn.fromQuat2=function(b,D){var k=new o.ARRAY_TYPE(3),T=-D[0],A=-D[1],O=-D[2],B=D[3],V=D[4],q=D[5],G=D[6],H=D[7],Z=T*T+A*A+O*O+B*B;return Z>0?(k[0]=2*(V*B+H*T+q*O-G*A)/Z,k[1]=2*(q*B+H*A+G*T-V*O)/Z,k[2]=2*(G*B+H*O+V*A-q*T)/Z):(k[0]=2*(V*B+H*T+q*O-G*A),k[1]=2*(q*B+H*A+G*T-V*O),k[2]=2*(G*B+H*O+V*A-q*T)),p(b,D,k),b},Sn.getTranslation=function(b,D){return b[0]=D[12],b[1]=D[13],b[2]=D[14],b},Sn.getScaling=y,Sn.getRotation=function(b,D){var k=new o.ARRAY_TYPE(3);y(k,D);var T=1/k[0],A=1/k[1],O=1/k[2],B=D[0]*T,V=D[1]*A,q=D[2]*O,G=D[4]*T,H=D[5]*A,Z=D[6]*O,ee=D[8]*T,ie=D[9]*A,me=D[10]*O,ue=B+H+me,pe=0;return ue>0?(pe=2*Math.sqrt(ue+1),b[3]=.25*pe,b[0]=(Z-ie)/pe,b[1]=(ee-q)/pe,b[2]=(V-G)/pe):B>H&&B>me?(pe=2*Math.sqrt(1+B-H-me),b[3]=(Z-ie)/pe,b[0]=.25*pe,b[1]=(V+G)/pe,b[2]=(ee+q)/pe):H>me?(pe=2*Math.sqrt(1+H-B-me),b[3]=(ee-q)/pe,b[0]=(V+G)/pe,b[1]=.25*pe,b[2]=(Z+ie)/pe):(pe=2*Math.sqrt(1+me-B-H),b[3]=(V-G)/pe,b[0]=(ee+q)/pe,b[1]=(Z+ie)/pe,b[2]=.25*pe),b},Sn.fromRotationTranslationScale=function(b,D,k,T){var A=D[0],O=D[1],B=D[2],V=D[3],q=A+A,G=O+O,H=B+B,Z=A*q,ee=A*G,ie=A*H,me=O*G,ue=O*H,pe=B*H,Te=V*q,_e=V*G,Ie=V*H,Le=T[0],Fe=T[1],Ve=T[2];return b[0]=(1-(me+pe))*Le,b[1]=(ee+Ie)*Le,b[2]=(ie-_e)*Le,b[3]=0,b[4]=(ee-Ie)*Fe,b[5]=(1-(Z+pe))*Fe,b[6]=(ue+Te)*Fe,b[7]=0,b[8]=(ie+_e)*Ve,b[9]=(ue-Te)*Ve,b[10]=(1-(Z+me))*Ve,b[11]=0,b[12]=k[0],b[13]=k[1],b[14]=k[2],b[15]=1,b},Sn.fromRotationTranslationScaleOrigin=function(b,D,k,T,A){var O=D[0],B=D[1],V=D[2],q=D[3],G=O+O,H=B+B,Z=V+V,ee=O*G,ie=O*H,me=O*Z,ue=B*H,pe=B*Z,Te=V*Z,_e=q*G,Ie=q*H,Le=q*Z,Fe=T[0],Ve=T[1],ze=T[2],We=A[0],Ue=A[1],Ze=A[2],ht=(1-(ue+Te))*Fe,ut=(ie+Le)*Fe,qt=(me-Ie)*Fe,gt=(ie-Le)*Ve,yt=(1-(ee+Te))*Ve,pt=(pe+_e)*Ve,fn=(me+Ie)*ze,Ut=(pe-_e)*ze,Jt=(1-(ee+ue))*ze;return b[0]=ht,b[1]=ut,b[2]=qt,b[3]=0,b[4]=gt,b[5]=yt,b[6]=pt,b[7]=0,b[8]=fn,b[9]=Ut,b[10]=Jt,b[11]=0,b[12]=k[0]+We-(ht*We+gt*Ue+fn*Ze),b[13]=k[1]+Ue-(ut*We+yt*Ue+Ut*Ze),b[14]=k[2]+Ze-(qt*We+pt*Ue+Jt*Ze),b[15]=1,b},Sn.fromQuat=function(b,D){var k=D[0],T=D[1],A=D[2],O=D[3],B=k+k,V=T+T,q=A+A,G=k*B,H=T*B,Z=T*V,ee=A*B,ie=A*V,me=A*q,ue=O*B,pe=O*V,Te=O*q;return b[0]=1-Z-me,b[1]=H+Te,b[2]=ee-pe,b[3]=0,b[4]=H-Te,b[5]=1-G-me,b[6]=ie+ue,b[7]=0,b[8]=ee+pe,b[9]=ie-ue,b[10]=1-G-Z,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b},Sn.frustum=function(b,D,k,T,A,O,B){var V=1/(k-D),q=1/(A-T),G=1/(O-B);return b[0]=2*O*V,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=2*O*q,b[6]=0,b[7]=0,b[8]=(k+D)*V,b[9]=(A+T)*q,b[10]=(B+O)*G,b[11]=-1,b[12]=0,b[13]=0,b[14]=B*O*2*G,b[15]=0,b},Sn.perspectiveNO=C,Sn.perspectiveZO=function(b,D,k,T,A){var O,B=1/Math.tan(D/2);return b[0]=B/k,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=B,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[11]=-1,b[12]=0,b[13]=0,b[15]=0,null!=A&&A!==1/0?(b[10]=A*(O=1/(T-A)),b[14]=A*T*O):(b[10]=-1,b[14]=-T),b},Sn.perspectiveFromFieldOfView=function(b,D,k,T){var A=Math.tan(D.upDegrees*Math.PI/180),O=Math.tan(D.downDegrees*Math.PI/180),B=Math.tan(D.leftDegrees*Math.PI/180),V=Math.tan(D.rightDegrees*Math.PI/180),q=2/(B+V),G=2/(A+O);return b[0]=q,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=G,b[6]=0,b[7]=0,b[8]=-(B-V)*q*.5,b[9]=(A-O)*G*.5,b[10]=T/(k-T),b[11]=-1,b[12]=0,b[13]=0,b[14]=T*k/(k-T),b[15]=0,b},Sn.orthoNO=S,Sn.orthoZO=function(b,D,k,T,A,O,B){var V=1/(D-k),q=1/(T-A),G=1/(O-B);return b[0]=-2*V,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=-2*q,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[10]=G,b[11]=0,b[12]=(D+k)*V,b[13]=(A+T)*q,b[14]=O*G,b[15]=1,b},Sn.lookAt=function(b,D,k,T){var A,O,B,V,q,G,H,Z,ee,ie,me=D[0],ue=D[1],pe=D[2],Te=T[0],_e=T[1],Ie=T[2],Le=k[0],Fe=k[1],Ve=k[2];return Math.abs(me-Le)<o.EPSILON&&Math.abs(ue-Fe)<o.EPSILON&&Math.abs(pe-Ve)<o.EPSILON?u(b):(H=me-Le,Z=ue-Fe,ee=pe-Ve,A=_e*(ee*=ie=1/Math.hypot(H,Z,ee))-Ie*(Z*=ie),O=Ie*(H*=ie)-Te*ee,B=Te*Z-_e*H,(ie=Math.hypot(A,O,B))?(A*=ie=1/ie,O*=ie,B*=ie):(A=0,O=0,B=0),V=Z*B-ee*O,q=ee*A-H*B,G=H*O-Z*A,(ie=Math.hypot(V,q,G))?(V*=ie=1/ie,q*=ie,G*=ie):(V=0,q=0,G=0),b[0]=A,b[1]=V,b[2]=H,b[3]=0,b[4]=O,b[5]=q,b[6]=Z,b[7]=0,b[8]=B,b[9]=G,b[10]=ee,b[11]=0,b[12]=-(A*me+O*ue+B*pe),b[13]=-(V*me+q*ue+G*pe),b[14]=-(H*me+Z*ue+ee*pe),b[15]=1,b)},Sn.targetTo=function(b,D,k,T){var A=D[0],O=D[1],B=D[2],V=T[0],q=T[1],G=T[2],H=A-k[0],Z=O-k[1],ee=B-k[2],ie=H*H+Z*Z+ee*ee;ie>0&&(H*=ie=1/Math.sqrt(ie),Z*=ie,ee*=ie);var me=q*ee-G*Z,ue=G*H-V*ee,pe=V*Z-q*H;return(ie=me*me+ue*ue+pe*pe)>0&&(me*=ie=1/Math.sqrt(ie),ue*=ie,pe*=ie),b[0]=me,b[1]=ue,b[2]=pe,b[3]=0,b[4]=Z*pe-ee*ue,b[5]=ee*me-H*pe,b[6]=H*ue-Z*me,b[7]=0,b[8]=H,b[9]=Z,b[10]=ee,b[11]=0,b[12]=A,b[13]=O,b[14]=B,b[15]=1,b},Sn.str=function(b){return"mat4("+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+", "+b[4]+", "+b[5]+", "+b[6]+", "+b[7]+", "+b[8]+", "+b[9]+", "+b[10]+", "+b[11]+", "+b[12]+", "+b[13]+", "+b[14]+", "+b[15]+")"},Sn.frob=function(b){return Math.hypot(b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7],b[8],b[9],b[10],b[11],b[12],b[13],b[14],b[15])},Sn.add=function(b,D,k){return b[0]=D[0]+k[0],b[1]=D[1]+k[1],b[2]=D[2]+k[2],b[3]=D[3]+k[3],b[4]=D[4]+k[4],b[5]=D[5]+k[5],b[6]=D[6]+k[6],b[7]=D[7]+k[7],b[8]=D[8]+k[8],b[9]=D[9]+k[9],b[10]=D[10]+k[10],b[11]=D[11]+k[11],b[12]=D[12]+k[12],b[13]=D[13]+k[13],b[14]=D[14]+k[14],b[15]=D[15]+k[15],b},Sn.subtract=I,Sn.multiplyScalar=function(b,D,k){return b[0]=D[0]*k,b[1]=D[1]*k,b[2]=D[2]*k,b[3]=D[3]*k,b[4]=D[4]*k,b[5]=D[5]*k,b[6]=D[6]*k,b[7]=D[7]*k,b[8]=D[8]*k,b[9]=D[9]*k,b[10]=D[10]*k,b[11]=D[11]*k,b[12]=D[12]*k,b[13]=D[13]*k,b[14]=D[14]*k,b[15]=D[15]*k,b},Sn.multiplyScalarAndAdd=function(b,D,k,T){return b[0]=D[0]+k[0]*T,b[1]=D[1]+k[1]*T,b[2]=D[2]+k[2]*T,b[3]=D[3]+k[3]*T,b[4]=D[4]+k[4]*T,b[5]=D[5]+k[5]*T,b[6]=D[6]+k[6]*T,b[7]=D[7]+k[7]*T,b[8]=D[8]+k[8]*T,b[9]=D[9]+k[9]*T,b[10]=D[10]+k[10]*T,b[11]=D[11]+k[11]*T,b[12]=D[12]+k[12]*T,b[13]=D[13]+k[13]*T,b[14]=D[14]+k[14]*T,b[15]=D[15]+k[15]*T,b},Sn.exactEquals=function(b,D){return b[0]===D[0]&&b[1]===D[1]&&b[2]===D[2]&&b[3]===D[3]&&b[4]===D[4]&&b[5]===D[5]&&b[6]===D[6]&&b[7]===D[7]&&b[8]===D[8]&&b[9]===D[9]&&b[10]===D[10]&&b[11]===D[11]&&b[12]===D[12]&&b[13]===D[13]&&b[14]===D[14]&&b[15]===D[15]},Sn.equals=function(b,D){var k=b[0],T=b[1],A=b[2],O=b[3],B=b[4],V=b[5],q=b[6],G=b[7],H=b[8],Z=b[9],ee=b[10],ie=b[11],me=b[12],ue=b[13],pe=b[14],Te=b[15],_e=D[0],Ie=D[1],Le=D[2],Fe=D[3],Ve=D[4],ze=D[5],We=D[6],Ue=D[7],Ze=D[8],ht=D[9],ut=D[10],qt=D[11],gt=D[12],yt=D[13],pt=D[14],fn=D[15];return Math.abs(k-_e)<=o.EPSILON*Math.max(1,Math.abs(k),Math.abs(_e))&&Math.abs(T-Ie)<=o.EPSILON*Math.max(1,Math.abs(T),Math.abs(Ie))&&Math.abs(A-Le)<=o.EPSILON*Math.max(1,Math.abs(A),Math.abs(Le))&&Math.abs(O-Fe)<=o.EPSILON*Math.max(1,Math.abs(O),Math.abs(Fe))&&Math.abs(B-Ve)<=o.EPSILON*Math.max(1,Math.abs(B),Math.abs(Ve))&&Math.abs(V-ze)<=o.EPSILON*Math.max(1,Math.abs(V),Math.abs(ze))&&Math.abs(q-We)<=o.EPSILON*Math.max(1,Math.abs(q),Math.abs(We))&&Math.abs(G-Ue)<=o.EPSILON*Math.max(1,Math.abs(G),Math.abs(Ue))&&Math.abs(H-Ze)<=o.EPSILON*Math.max(1,Math.abs(H),Math.abs(Ze))&&Math.abs(Z-ht)<=o.EPSILON*Math.max(1,Math.abs(Z),Math.abs(ht))&&Math.abs(ee-ut)<=o.EPSILON*Math.max(1,Math.abs(ee),Math.abs(ut))&&Math.abs(ie-qt)<=o.EPSILON*Math.max(1,Math.abs(ie),Math.abs(qt))&&Math.abs(me-gt)<=o.EPSILON*Math.max(1,Math.abs(me),Math.abs(gt))&&Math.abs(ue-yt)<=o.EPSILON*Math.max(1,Math.abs(ue),Math.abs(yt))&&Math.abs(pe-pt)<=o.EPSILON*Math.max(1,Math.abs(pe),Math.abs(pt))&&Math.abs(Te-fn)<=o.EPSILON*Math.max(1,Math.abs(Te),Math.abs(fn))},Sn.sub=Sn.mul=Sn.ortho=Sn.perspective=void 0;var o=function(b){if(b&&b.__esModule)return b;if(null===b||"object"!==d(b)&&"function"!=typeof b)return{default:b};var k=a(void 0);if(k&&k.has(b))return k.get(b);var T={},A=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var O in b)if("default"!==O&&Object.prototype.hasOwnProperty.call(b,O)){var B=A?Object.getOwnPropertyDescriptor(b,O):null;B&&(B.get||B.set)?Object.defineProperty(T,O,B):T[O]=b[O]}return T.default=b,k&&k.set(b,T),T}(To());function a(b){if("function"!=typeof WeakMap)return null;var D=new WeakMap,k=new WeakMap;return(a=function(T){return T?k:D})(b)}function u(b){return b[0]=1,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=1,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[10]=1,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b}function g(b,D,k){var T=D[0],A=D[1],O=D[2],B=D[3],V=D[4],q=D[5],G=D[6],H=D[7],Z=D[8],ee=D[9],ie=D[10],me=D[11],ue=D[12],pe=D[13],Te=D[14],_e=D[15],Ie=k[0],Le=k[1],Fe=k[2],Ve=k[3];return b[0]=Ie*T+Le*V+Fe*Z+Ve*ue,b[1]=Ie*A+Le*q+Fe*ee+Ve*pe,b[2]=Ie*O+Le*G+Fe*ie+Ve*Te,b[3]=Ie*B+Le*H+Fe*me+Ve*_e,b[4]=(Ie=k[4])*T+(Le=k[5])*V+(Fe=k[6])*Z+(Ve=k[7])*ue,b[5]=Ie*A+Le*q+Fe*ee+Ve*pe,b[6]=Ie*O+Le*G+Fe*ie+Ve*Te,b[7]=Ie*B+Le*H+Fe*me+Ve*_e,b[8]=(Ie=k[8])*T+(Le=k[9])*V+(Fe=k[10])*Z+(Ve=k[11])*ue,b[9]=Ie*A+Le*q+Fe*ee+Ve*pe,b[10]=Ie*O+Le*G+Fe*ie+Ve*Te,b[11]=Ie*B+Le*H+Fe*me+Ve*_e,b[12]=(Ie=k[12])*T+(Le=k[13])*V+(Fe=k[14])*Z+(Ve=k[15])*ue,b[13]=Ie*A+Le*q+Fe*ee+Ve*pe,b[14]=Ie*O+Le*G+Fe*ie+Ve*Te,b[15]=Ie*B+Le*H+Fe*me+Ve*_e,b}function p(b,D,k){var T=D[0],A=D[1],O=D[2],B=D[3],V=T+T,q=A+A,G=O+O,H=T*V,Z=T*q,ee=T*G,ie=A*q,me=A*G,ue=O*G,pe=B*V,Te=B*q,_e=B*G;return b[0]=1-(ie+ue),b[1]=Z+_e,b[2]=ee-Te,b[3]=0,b[4]=Z-_e,b[5]=1-(H+ue),b[6]=me+pe,b[7]=0,b[8]=ee+Te,b[9]=me-pe,b[10]=1-(H+ie),b[11]=0,b[12]=k[0],b[13]=k[1],b[14]=k[2],b[15]=1,b}function y(b,D){var k=D[4],T=D[5],A=D[6],O=D[8],B=D[9],V=D[10];return b[0]=Math.hypot(D[0],D[1],D[2]),b[1]=Math.hypot(k,T,A),b[2]=Math.hypot(O,B,V),b}function C(b,D,k,T,A){var O,B=1/Math.tan(D/2);return b[0]=B/k,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=B,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[11]=-1,b[12]=0,b[13]=0,b[15]=0,null!=A&&A!==1/0?(b[10]=(A+T)*(O=1/(T-A)),b[14]=2*A*T*O):(b[10]=-1,b[14]=-2*T),b}function S(b,D,k,T,A,O,B){var V=1/(D-k),q=1/(T-A),G=1/(O-B);return b[0]=-2*V,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=-2*q,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[10]=2*G,b[11]=0,b[12]=(D+k)*V,b[13]=(A+T)*q,b[14]=(B+O)*G,b[15]=1,b}function I(b,D,k){return b[0]=D[0]-k[0],b[1]=D[1]-k[1],b[2]=D[2]-k[2],b[3]=D[3]-k[3],b[4]=D[4]-k[4],b[5]=D[5]-k[5],b[6]=D[6]-k[6],b[7]=D[7]-k[7],b[8]=D[8]-k[8],b[9]=D[9]-k[9],b[10]=D[10]-k[10],b[11]=D[11]-k[11],b[12]=D[12]-k[12],b[13]=D[13]-k[13],b[14]=D[14]-k[14],b[15]=D[15]-k[15],b}return Sn.perspective=C,Sn.ortho=S,Sn.mul=g,Sn.sub=I,Sn}var pc,On={},zn={};function Nl(){if(pc)return zn;function d(A){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(O){return typeof O}:function(O){return O&&"function"==typeof Symbol&&O.constructor===Symbol&&O!==Symbol.prototype?"symbol":typeof O})(A)}pc=1,Object.defineProperty(zn,"__esModule",{value:!0}),zn.create=u,zn.clone=function(A){var O=new o.ARRAY_TYPE(3);return O[0]=A[0],O[1]=A[1],O[2]=A[2],O},zn.length=g,zn.fromValues=function(A,O,B){var V=new o.ARRAY_TYPE(3);return V[0]=A,V[1]=O,V[2]=B,V},zn.copy=function(A,O){return A[0]=O[0],A[1]=O[1],A[2]=O[2],A},zn.set=function(A,O,B,V){return A[0]=O,A[1]=B,A[2]=V,A},zn.add=function(A,O,B){return A[0]=O[0]+B[0],A[1]=O[1]+B[1],A[2]=O[2]+B[2],A},zn.subtract=p,zn.multiply=y,zn.divide=C,zn.ceil=function(A,O){return A[0]=Math.ceil(O[0]),A[1]=Math.ceil(O[1]),A[2]=Math.ceil(O[2]),A},zn.floor=function(A,O){return A[0]=Math.floor(O[0]),A[1]=Math.floor(O[1]),A[2]=Math.floor(O[2]),A},zn.min=function(A,O,B){return A[0]=Math.min(O[0],B[0]),A[1]=Math.min(O[1],B[1]),A[2]=Math.min(O[2],B[2]),A},zn.max=function(A,O,B){return A[0]=Math.max(O[0],B[0]),A[1]=Math.max(O[1],B[1]),A[2]=Math.max(O[2],B[2]),A},zn.round=function(A,O){return A[0]=Math.round(O[0]),A[1]=Math.round(O[1]),A[2]=Math.round(O[2]),A},zn.scale=function(A,O,B){return A[0]=O[0]*B,A[1]=O[1]*B,A[2]=O[2]*B,A},zn.scaleAndAdd=function(A,O,B,V){return A[0]=O[0]+B[0]*V,A[1]=O[1]+B[1]*V,A[2]=O[2]+B[2]*V,A},zn.distance=S,zn.squaredDistance=I,zn.squaredLength=b,zn.negate=function(A,O){return A[0]=-O[0],A[1]=-O[1],A[2]=-O[2],A},zn.inverse=function(A,O){return A[0]=1/O[0],A[1]=1/O[1],A[2]=1/O[2],A},zn.normalize=function(A,O){var B=O[0],V=O[1],q=O[2],G=B*B+V*V+q*q;return G>0&&(G=1/Math.sqrt(G)),A[0]=O[0]*G,A[1]=O[1]*G,A[2]=O[2]*G,A},zn.dot=D,zn.cross=function(A,O,B){var V=O[0],q=O[1],G=O[2],H=B[0],Z=B[1],ee=B[2];return A[0]=q*ee-G*Z,A[1]=G*H-V*ee,A[2]=V*Z-q*H,A},zn.lerp=function(A,O,B,V){var q=O[0],G=O[1],H=O[2];return A[0]=q+V*(B[0]-q),A[1]=G+V*(B[1]-G),A[2]=H+V*(B[2]-H),A},zn.hermite=function(A,O,B,V,q,G){var H=G*G,Z=H*(2*G-3)+1,ee=H*(G-2)+G,ie=H*(G-1),me=H*(3-2*G);return A[0]=O[0]*Z+B[0]*ee+V[0]*ie+q[0]*me,A[1]=O[1]*Z+B[1]*ee+V[1]*ie+q[1]*me,A[2]=O[2]*Z+B[2]*ee+V[2]*ie+q[2]*me,A},zn.bezier=function(A,O,B,V,q,G){var H=1-G,Z=H*H,ee=G*G,ie=Z*H,me=3*G*Z,ue=3*ee*H,pe=ee*G;return A[0]=O[0]*ie+B[0]*me+V[0]*ue+q[0]*pe,A[1]=O[1]*ie+B[1]*me+V[1]*ue+q[1]*pe,A[2]=O[2]*ie+B[2]*me+V[2]*ue+q[2]*pe,A},zn.random=function(A,O){O=O||1;var B=2*o.RANDOM()*Math.PI,V=2*o.RANDOM()-1,q=Math.sqrt(1-V*V)*O;return A[0]=Math.cos(B)*q,A[1]=Math.sin(B)*q,A[2]=V*O,A},zn.transformMat4=function(A,O,B){var V=O[0],q=O[1],G=O[2],H=B[3]*V+B[7]*q+B[11]*G+B[15];return A[0]=(B[0]*V+B[4]*q+B[8]*G+B[12])/(H=H||1),A[1]=(B[1]*V+B[5]*q+B[9]*G+B[13])/H,A[2]=(B[2]*V+B[6]*q+B[10]*G+B[14])/H,A},zn.transformMat3=function(A,O,B){var V=O[0],q=O[1],G=O[2];return A[0]=V*B[0]+q*B[3]+G*B[6],A[1]=V*B[1]+q*B[4]+G*B[7],A[2]=V*B[2]+q*B[5]+G*B[8],A},zn.transformQuat=function(A,O,B){var V=B[0],q=B[1],G=B[2],H=O[0],Z=O[1],ee=O[2],ie=q*ee-G*Z,me=G*H-V*ee,ue=V*Z-q*H,pe=q*ue-G*me,Te=G*ie-V*ue,_e=V*me-q*ie,Ie=2*B[3];return me*=Ie,ue*=Ie,Te*=2,_e*=2,A[0]=H+(ie*=Ie)+(pe*=2),A[1]=Z+me+Te,A[2]=ee+ue+_e,A},zn.rotateX=function(A,O,B,V){var q=[],G=[];return q[0]=O[0]-B[0],q[1]=O[1]-B[1],q[2]=O[2]-B[2],G[0]=q[0],G[1]=q[1]*Math.cos(V)-q[2]*Math.sin(V),G[2]=q[1]*Math.sin(V)+q[2]*Math.cos(V),A[0]=G[0]+B[0],A[1]=G[1]+B[1],A[2]=G[2]+B[2],A},zn.rotateY=function(A,O,B,V){var q=[],G=[];return q[0]=O[0]-B[0],q[1]=O[1]-B[1],q[2]=O[2]-B[2],G[0]=q[2]*Math.sin(V)+q[0]*Math.cos(V),G[1]=q[1],G[2]=q[2]*Math.cos(V)-q[0]*Math.sin(V),A[0]=G[0]+B[0],A[1]=G[1]+B[1],A[2]=G[2]+B[2],A},zn.rotateZ=function(A,O,B,V){var q=[],G=[];return q[0]=O[0]-B[0],q[1]=O[1]-B[1],q[2]=O[2]-B[2],G[0]=q[0]*Math.cos(V)-q[1]*Math.sin(V),G[1]=q[0]*Math.sin(V)+q[1]*Math.cos(V),G[2]=q[2],A[0]=G[0]+B[0],A[1]=G[1]+B[1],A[2]=G[2]+B[2],A},zn.angle=function(A,O){var B=A[0],V=A[1],q=A[2],G=O[0],H=O[1],Z=O[2],ee=Math.sqrt(B*B+V*V+q*q)*Math.sqrt(G*G+H*H+Z*Z),ie=ee&&D(A,O)/ee;return Math.acos(Math.min(Math.max(ie,-1),1))},zn.zero=function(A){return A[0]=0,A[1]=0,A[2]=0,A},zn.str=function(A){return"vec3("+A[0]+", "+A[1]+", "+A[2]+")"},zn.exactEquals=function(A,O){return A[0]===O[0]&&A[1]===O[1]&&A[2]===O[2]},zn.equals=function(A,O){var B=A[0],V=A[1],q=A[2],G=O[0],H=O[1],Z=O[2];return Math.abs(B-G)<=o.EPSILON*Math.max(1,Math.abs(B),Math.abs(G))&&Math.abs(V-H)<=o.EPSILON*Math.max(1,Math.abs(V),Math.abs(H))&&Math.abs(q-Z)<=o.EPSILON*Math.max(1,Math.abs(q),Math.abs(Z))},zn.forEach=zn.sqrLen=zn.len=zn.sqrDist=zn.dist=zn.div=zn.mul=zn.sub=void 0;var o=function(A){if(A&&A.__esModule)return A;if(null===A||"object"!==d(A)&&"function"!=typeof A)return{default:A};var B=a(void 0);if(B&&B.has(A))return B.get(A);var V={},q=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var G in A)if("default"!==G&&Object.prototype.hasOwnProperty.call(A,G)){var H=q?Object.getOwnPropertyDescriptor(A,G):null;H&&(H.get||H.set)?Object.defineProperty(V,G,H):V[G]=A[G]}return V.default=A,B&&B.set(A,V),V}(To());function a(A){if("function"!=typeof WeakMap)return null;var O=new WeakMap,B=new WeakMap;return(a=function(V){return V?B:O})(A)}function u(){var A=new o.ARRAY_TYPE(3);return o.ARRAY_TYPE!=Float32Array&&(A[0]=0,A[1]=0,A[2]=0),A}function g(A){return Math.hypot(A[0],A[1],A[2])}function p(A,O,B){return A[0]=O[0]-B[0],A[1]=O[1]-B[1],A[2]=O[2]-B[2],A}function y(A,O,B){return A[0]=O[0]*B[0],A[1]=O[1]*B[1],A[2]=O[2]*B[2],A}function C(A,O,B){return A[0]=O[0]/B[0],A[1]=O[1]/B[1],A[2]=O[2]/B[2],A}function S(A,O){return Math.hypot(O[0]-A[0],O[1]-A[1],O[2]-A[2])}function I(A,O){var B=O[0]-A[0],V=O[1]-A[1],q=O[2]-A[2];return B*B+V*V+q*q}function b(A){var O=A[0],B=A[1],V=A[2];return O*O+B*B+V*V}function D(A,O){return A[0]*O[0]+A[1]*O[1]+A[2]*O[2]}zn.sub=p,zn.mul=y,zn.div=C,zn.dist=S,zn.sqrDist=I,zn.len=g,zn.sqrLen=b;var k,T=(k=u(),function(A,O,B,V,q,G){var H,Z;for(O||(O=3),B||(B=0),Z=V?Math.min(V*O+B,A.length):A.length,H=B;H<Z;H+=O)k[0]=A[H],k[1]=A[H+1],k[2]=A[H+2],q(k,k,G),A[H]=k[0],A[H+1]=k[1],A[H+2]=k[2];return A});return zn.forEach=T,zn}var zl,Hc,oi={};function Ys(){if(zl)return oi;function d(T){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(A){return typeof A}:function(A){return A&&"function"==typeof Symbol&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A})(T)}zl=1,Object.defineProperty(oi,"__esModule",{value:!0}),oi.create=u,oi.clone=function(T){var A=new o.ARRAY_TYPE(4);return A[0]=T[0],A[1]=T[1],A[2]=T[2],A[3]=T[3],A},oi.fromValues=function(T,A,O,B){var V=new o.ARRAY_TYPE(4);return V[0]=T,V[1]=A,V[2]=O,V[3]=B,V},oi.copy=function(T,A){return T[0]=A[0],T[1]=A[1],T[2]=A[2],T[3]=A[3],T},oi.set=function(T,A,O,B,V){return T[0]=A,T[1]=O,T[2]=B,T[3]=V,T},oi.add=function(T,A,O){return T[0]=A[0]+O[0],T[1]=A[1]+O[1],T[2]=A[2]+O[2],T[3]=A[3]+O[3],T},oi.subtract=g,oi.multiply=p,oi.divide=y,oi.ceil=function(T,A){return T[0]=Math.ceil(A[0]),T[1]=Math.ceil(A[1]),T[2]=Math.ceil(A[2]),T[3]=Math.ceil(A[3]),T},oi.floor=function(T,A){return T[0]=Math.floor(A[0]),T[1]=Math.floor(A[1]),T[2]=Math.floor(A[2]),T[3]=Math.floor(A[3]),T},oi.min=function(T,A,O){return T[0]=Math.min(A[0],O[0]),T[1]=Math.min(A[1],O[1]),T[2]=Math.min(A[2],O[2]),T[3]=Math.min(A[3],O[3]),T},oi.max=function(T,A,O){return T[0]=Math.max(A[0],O[0]),T[1]=Math.max(A[1],O[1]),T[2]=Math.max(A[2],O[2]),T[3]=Math.max(A[3],O[3]),T},oi.round=function(T,A){return T[0]=Math.round(A[0]),T[1]=Math.round(A[1]),T[2]=Math.round(A[2]),T[3]=Math.round(A[3]),T},oi.scale=function(T,A,O){return T[0]=A[0]*O,T[1]=A[1]*O,T[2]=A[2]*O,T[3]=A[3]*O,T},oi.scaleAndAdd=function(T,A,O,B){return T[0]=A[0]+O[0]*B,T[1]=A[1]+O[1]*B,T[2]=A[2]+O[2]*B,T[3]=A[3]+O[3]*B,T},oi.distance=C,oi.squaredDistance=S,oi.length=I,oi.squaredLength=b,oi.negate=function(T,A){return T[0]=-A[0],T[1]=-A[1],T[2]=-A[2],T[3]=-A[3],T},oi.inverse=function(T,A){return T[0]=1/A[0],T[1]=1/A[1],T[2]=1/A[2],T[3]=1/A[3],T},oi.normalize=function(T,A){var O=A[0],B=A[1],V=A[2],q=A[3],G=O*O+B*B+V*V+q*q;return G>0&&(G=1/Math.sqrt(G)),T[0]=O*G,T[1]=B*G,T[2]=V*G,T[3]=q*G,T},oi.dot=function(T,A){return T[0]*A[0]+T[1]*A[1]+T[2]*A[2]+T[3]*A[3]},oi.cross=function(T,A,O,B){var V=O[0]*B[1]-O[1]*B[0],q=O[0]*B[2]-O[2]*B[0],G=O[0]*B[3]-O[3]*B[0],H=O[1]*B[2]-O[2]*B[1],Z=O[1]*B[3]-O[3]*B[1],ee=O[2]*B[3]-O[3]*B[2],ie=A[0],me=A[1],ue=A[2],pe=A[3];return T[0]=me*ee-ue*Z+pe*H,T[1]=-ie*ee+ue*G-pe*q,T[2]=ie*Z-me*G+pe*V,T[3]=-ie*H+me*q-ue*V,T},oi.lerp=function(T,A,O,B){var V=A[0],q=A[1],G=A[2],H=A[3];return T[0]=V+B*(O[0]-V),T[1]=q+B*(O[1]-q),T[2]=G+B*(O[2]-G),T[3]=H+B*(O[3]-H),T},oi.random=function(T,A){var O,B,V,q,G,H;A=A||1;do{G=(O=2*o.RANDOM()-1)*O+(B=2*o.RANDOM()-1)*B}while(G>=1);do{H=(V=2*o.RANDOM()-1)*V+(q=2*o.RANDOM()-1)*q}while(H>=1);var Z=Math.sqrt((1-G)/H);return T[0]=A*O,T[1]=A*B,T[2]=A*V*Z,T[3]=A*q*Z,T},oi.transformMat4=function(T,A,O){var B=A[0],V=A[1],q=A[2],G=A[3];return T[0]=O[0]*B+O[4]*V+O[8]*q+O[12]*G,T[1]=O[1]*B+O[5]*V+O[9]*q+O[13]*G,T[2]=O[2]*B+O[6]*V+O[10]*q+O[14]*G,T[3]=O[3]*B+O[7]*V+O[11]*q+O[15]*G,T},oi.transformQuat=function(T,A,O){var B=A[0],V=A[1],q=A[2],G=O[0],H=O[1],Z=O[2],ee=O[3],ie=ee*B+H*q-Z*V,me=ee*V+Z*B-G*q,ue=ee*q+G*V-H*B,pe=-G*B-H*V-Z*q;return T[0]=ie*ee+pe*-G+me*-Z-ue*-H,T[1]=me*ee+pe*-H+ue*-G-ie*-Z,T[2]=ue*ee+pe*-Z+ie*-H-me*-G,T[3]=A[3],T},oi.zero=function(T){return T[0]=0,T[1]=0,T[2]=0,T[3]=0,T},oi.str=function(T){return"vec4("+T[0]+", "+T[1]+", "+T[2]+", "+T[3]+")"},oi.exactEquals=function(T,A){return T[0]===A[0]&&T[1]===A[1]&&T[2]===A[2]&&T[3]===A[3]},oi.equals=function(T,A){var O=T[0],B=T[1],V=T[2],q=T[3],G=A[0],H=A[1],Z=A[2],ee=A[3];return Math.abs(O-G)<=o.EPSILON*Math.max(1,Math.abs(O),Math.abs(G))&&Math.abs(B-H)<=o.EPSILON*Math.max(1,Math.abs(B),Math.abs(H))&&Math.abs(V-Z)<=o.EPSILON*Math.max(1,Math.abs(V),Math.abs(Z))&&Math.abs(q-ee)<=o.EPSILON*Math.max(1,Math.abs(q),Math.abs(ee))},oi.forEach=oi.sqrLen=oi.len=oi.sqrDist=oi.dist=oi.div=oi.mul=oi.sub=void 0;var o=function(T){if(T&&T.__esModule)return T;if(null===T||"object"!==d(T)&&"function"!=typeof T)return{default:T};var O=a(void 0);if(O&&O.has(T))return O.get(T);var B={},V=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var q in T)if("default"!==q&&Object.prototype.hasOwnProperty.call(T,q)){var G=V?Object.getOwnPropertyDescriptor(T,q):null;G&&(G.get||G.set)?Object.defineProperty(B,q,G):B[q]=T[q]}return B.default=T,O&&O.set(T,B),B}(To());function a(T){if("function"!=typeof WeakMap)return null;var A=new WeakMap,O=new WeakMap;return(a=function(B){return B?O:A})(T)}function u(){var T=new o.ARRAY_TYPE(4);return o.ARRAY_TYPE!=Float32Array&&(T[0]=0,T[1]=0,T[2]=0,T[3]=0),T}function g(T,A,O){return T[0]=A[0]-O[0],T[1]=A[1]-O[1],T[2]=A[2]-O[2],T[3]=A[3]-O[3],T}function p(T,A,O){return T[0]=A[0]*O[0],T[1]=A[1]*O[1],T[2]=A[2]*O[2],T[3]=A[3]*O[3],T}function y(T,A,O){return T[0]=A[0]/O[0],T[1]=A[1]/O[1],T[2]=A[2]/O[2],T[3]=A[3]/O[3],T}function C(T,A){return Math.hypot(A[0]-T[0],A[1]-T[1],A[2]-T[2],A[3]-T[3])}function S(T,A){var O=A[0]-T[0],B=A[1]-T[1],V=A[2]-T[2],q=A[3]-T[3];return O*O+B*B+V*V+q*q}function I(T){return Math.hypot(T[0],T[1],T[2],T[3])}function b(T){var A=T[0],O=T[1],B=T[2],V=T[3];return A*A+O*O+B*B+V*V}oi.sub=g,oi.mul=p,oi.div=y,oi.dist=C,oi.sqrDist=S,oi.len=I,oi.sqrLen=b;var D,k=(D=u(),function(T,A,O,B,V,q){var G,H;for(A||(A=4),O||(O=0),H=B?Math.min(B*A+O,T.length):T.length,G=O;G<H;G+=A)D[0]=T[G],D[1]=T[G+1],D[2]=T[G+2],D[3]=T[G+3],V(D,D,q),T[G]=D[0],T[G+1]=D[1],T[G+2]=D[2],T[G+3]=D[3];return T});return oi.forEach=k,oi}function il(){if(Hc)return On;function d(_e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(Ie){return typeof Ie}:function(Ie){return Ie&&"function"==typeof Symbol&&Ie.constructor===Symbol&&Ie!==Symbol.prototype?"symbol":typeof Ie})(_e)}Hc=1,Object.defineProperty(On,"__esModule",{value:!0}),On.create=C,On.identity=function(_e){return _e[0]=0,_e[1]=0,_e[2]=0,_e[3]=1,_e},On.setAxisAngle=S,On.getAxisAngle=function(_e,Ie){var Le=2*Math.acos(Ie[3]),Fe=Math.sin(Le/2);return Fe>o.EPSILON?(_e[0]=Ie[0]/Fe,_e[1]=Ie[1]/Fe,_e[2]=Ie[2]/Fe):(_e[0]=1,_e[1]=0,_e[2]=0),Le},On.getAngle=function(_e,Ie){var Le=O(_e,Ie);return Math.acos(2*Le*Le-1)},On.multiply=I,On.rotateX=function(_e,Ie,Le){Le*=.5;var Fe=Ie[0],Ve=Ie[1],ze=Ie[2],We=Ie[3],Ue=Math.sin(Le),Ze=Math.cos(Le);return _e[0]=Fe*Ze+We*Ue,_e[1]=Ve*Ze+ze*Ue,_e[2]=ze*Ze-Ve*Ue,_e[3]=We*Ze-Fe*Ue,_e},On.rotateY=function(_e,Ie,Le){Le*=.5;var Fe=Ie[0],Ve=Ie[1],ze=Ie[2],We=Ie[3],Ue=Math.sin(Le),Ze=Math.cos(Le);return _e[0]=Fe*Ze-ze*Ue,_e[1]=Ve*Ze+We*Ue,_e[2]=ze*Ze+Fe*Ue,_e[3]=We*Ze-Ve*Ue,_e},On.rotateZ=function(_e,Ie,Le){Le*=.5;var Fe=Ie[0],Ve=Ie[1],ze=Ie[2],We=Ie[3],Ue=Math.sin(Le),Ze=Math.cos(Le);return _e[0]=Fe*Ze+Ve*Ue,_e[1]=Ve*Ze-Fe*Ue,_e[2]=ze*Ze+We*Ue,_e[3]=We*Ze-ze*Ue,_e},On.calculateW=function(_e,Ie){var Le=Ie[0],Fe=Ie[1],Ve=Ie[2];return _e[0]=Le,_e[1]=Fe,_e[2]=Ve,_e[3]=Math.sqrt(Math.abs(1-Le*Le-Fe*Fe-Ve*Ve)),_e},On.exp=b,On.ln=D,On.pow=function(_e,Ie,Le){return D(_e,Ie),A(_e,_e,Le),b(_e,_e),_e},On.slerp=k,On.random=function(_e){var Ie=o.RANDOM(),Le=o.RANDOM(),Fe=o.RANDOM(),Ve=Math.sqrt(1-Ie),ze=Math.sqrt(Ie);return _e[0]=Ve*Math.sin(2*Math.PI*Le),_e[1]=Ve*Math.cos(2*Math.PI*Le),_e[2]=ze*Math.sin(2*Math.PI*Fe),_e[3]=ze*Math.cos(2*Math.PI*Fe),_e},On.invert=function(_e,Ie){var Le=Ie[0],Fe=Ie[1],Ve=Ie[2],ze=Ie[3],We=Le*Le+Fe*Fe+Ve*Ve+ze*ze,Ue=We?1/We:0;return _e[0]=-Le*Ue,_e[1]=-Fe*Ue,_e[2]=-Ve*Ue,_e[3]=ze*Ue,_e},On.conjugate=function(_e,Ie){return _e[0]=-Ie[0],_e[1]=-Ie[1],_e[2]=-Ie[2],_e[3]=Ie[3],_e},On.fromMat3=T,On.fromEuler=function(_e,Ie,Le,Fe){var Ve=.5*Math.PI/180;Ie*=Ve,Le*=Ve,Fe*=Ve;var ze=Math.sin(Ie),We=Math.cos(Ie),Ue=Math.sin(Le),Ze=Math.cos(Le),ht=Math.sin(Fe),ut=Math.cos(Fe);return _e[0]=ze*Ze*ut-We*Ue*ht,_e[1]=We*Ue*ut+ze*Ze*ht,_e[2]=We*Ze*ht-ze*Ue*ut,_e[3]=We*Ze*ut+ze*Ue*ht,_e},On.str=function(_e){return"quat("+_e[0]+", "+_e[1]+", "+_e[2]+", "+_e[3]+")"},On.setAxes=On.sqlerp=On.rotationTo=On.equals=On.exactEquals=On.normalize=On.sqrLen=On.squaredLength=On.len=On.length=On.lerp=On.dot=On.scale=On.mul=On.add=On.set=On.copy=On.fromValues=On.clone=void 0;var o=y(To()),a=y(Ld()),u=y(Nl()),g=y(Ys());function p(_e){if("function"!=typeof WeakMap)return null;var Ie=new WeakMap,Le=new WeakMap;return(p=function(Fe){return Fe?Le:Ie})(_e)}function y(_e,Ie){if(_e&&_e.__esModule)return _e;if(null===_e||"object"!==d(_e)&&"function"!=typeof _e)return{default:_e};var Le=p(Ie);if(Le&&Le.has(_e))return Le.get(_e);var Fe={},Ve=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var ze in _e)if("default"!==ze&&Object.prototype.hasOwnProperty.call(_e,ze)){var We=Ve?Object.getOwnPropertyDescriptor(_e,ze):null;We&&(We.get||We.set)?Object.defineProperty(Fe,ze,We):Fe[ze]=_e[ze]}return Fe.default=_e,Le&&Le.set(_e,Fe),Fe}function C(){var _e=new o.ARRAY_TYPE(4);return o.ARRAY_TYPE!=Float32Array&&(_e[0]=0,_e[1]=0,_e[2]=0),_e[3]=1,_e}function S(_e,Ie,Le){Le*=.5;var Fe=Math.sin(Le);return _e[0]=Fe*Ie[0],_e[1]=Fe*Ie[1],_e[2]=Fe*Ie[2],_e[3]=Math.cos(Le),_e}function I(_e,Ie,Le){var Fe=Ie[0],Ve=Ie[1],ze=Ie[2],We=Ie[3],Ue=Le[0],Ze=Le[1],ht=Le[2],ut=Le[3];return _e[0]=Fe*ut+We*Ue+Ve*ht-ze*Ze,_e[1]=Ve*ut+We*Ze+ze*Ue-Fe*ht,_e[2]=ze*ut+We*ht+Fe*Ze-Ve*Ue,_e[3]=We*ut-Fe*Ue-Ve*Ze-ze*ht,_e}function b(_e,Ie){var Le=Ie[0],Fe=Ie[1],Ve=Ie[2],ze=Ie[3],We=Math.sqrt(Le*Le+Fe*Fe+Ve*Ve),Ue=Math.exp(ze),Ze=We>0?Ue*Math.sin(We)/We:0;return _e[0]=Le*Ze,_e[1]=Fe*Ze,_e[2]=Ve*Ze,_e[3]=Ue*Math.cos(We),_e}function D(_e,Ie){var Le=Ie[0],Fe=Ie[1],Ve=Ie[2],ze=Ie[3],We=Math.sqrt(Le*Le+Fe*Fe+Ve*Ve),Ue=We>0?Math.atan2(We,ze)/We:0;return _e[0]=Le*Ue,_e[1]=Fe*Ue,_e[2]=Ve*Ue,_e[3]=.5*Math.log(Le*Le+Fe*Fe+Ve*Ve+ze*ze),_e}function k(_e,Ie,Le,Fe){var Ve,ze,We,Ue,Ze,ht=Ie[0],ut=Ie[1],qt=Ie[2],gt=Ie[3],yt=Le[0],pt=Le[1],fn=Le[2],Ut=Le[3];return(ze=ht*yt+ut*pt+qt*fn+gt*Ut)<0&&(ze=-ze,yt=-yt,pt=-pt,fn=-fn,Ut=-Ut),1-ze>o.EPSILON?(Ve=Math.acos(ze),We=Math.sin(Ve),Ue=Math.sin((1-Fe)*Ve)/We,Ze=Math.sin(Fe*Ve)/We):(Ue=1-Fe,Ze=Fe),_e[0]=Ue*ht+Ze*yt,_e[1]=Ue*ut+Ze*pt,_e[2]=Ue*qt+Ze*fn,_e[3]=Ue*gt+Ze*Ut,_e}function T(_e,Ie){var Le,Fe=Ie[0]+Ie[4]+Ie[8];if(Fe>0)Le=Math.sqrt(Fe+1),_e[3]=.5*Le,_e[0]=(Ie[5]-Ie[7])*(Le=.5/Le),_e[1]=(Ie[6]-Ie[2])*Le,_e[2]=(Ie[1]-Ie[3])*Le;else{var Ve=0;Ie[4]>Ie[0]&&(Ve=1),Ie[8]>Ie[3*Ve+Ve]&&(Ve=2);var ze=(Ve+1)%3,We=(Ve+2)%3;Le=Math.sqrt(Ie[3*Ve+Ve]-Ie[3*ze+ze]-Ie[3*We+We]+1),_e[Ve]=.5*Le,_e[3]=(Ie[3*ze+We]-Ie[3*We+ze])*(Le=.5/Le),_e[ze]=(Ie[3*ze+Ve]+Ie[3*Ve+ze])*Le,_e[We]=(Ie[3*We+Ve]+Ie[3*Ve+We])*Le}return _e}On.clone=g.clone,On.fromValues=g.fromValues,On.copy=g.copy,On.set=g.set,On.add=g.add,On.mul=I;var A=g.scale;On.scale=A;var O=g.dot;On.dot=O,On.lerp=g.lerp;var B=g.length;On.length=B,On.len=B;var V=g.squaredLength;On.squaredLength=V,On.sqrLen=V;var q=g.normalize;On.normalize=q,On.exactEquals=g.exactEquals,On.equals=g.equals;var G,H,Z,ee=(G=u.create(),H=u.fromValues(1,0,0),Z=u.fromValues(0,1,0),function(_e,Ie,Le){var Fe=u.dot(Ie,Le);return Fe<-.999999?(u.cross(G,H,Ie),u.len(G)<1e-6&&u.cross(G,Z,Ie),u.normalize(G,G),S(_e,G,Math.PI),_e):Fe>.999999?(_e[0]=0,_e[1]=0,_e[2]=0,_e[3]=1,_e):(u.cross(G,Ie,Le),_e[0]=G[0],_e[1]=G[1],_e[2]=G[2],_e[3]=1+Fe,q(_e,_e))});On.rotationTo=ee;var ie,me,ue=(ie=C(),me=C(),function(_e,Ie,Le,Fe,Ve,ze){return k(ie,Ie,Ve,ze),k(me,Le,Fe,ze),k(_e,ie,me,2*ze*(1-ze)),_e});On.sqlerp=ue;var pe,Te=(pe=a.create(),function(_e,Ie,Le,Fe){return pe[0]=Le[0],pe[3]=Le[1],pe[6]=Le[2],pe[1]=Fe[0],pe[4]=Fe[1],pe[7]=Fe[2],pe[2]=-Ie[0],pe[5]=-Ie[1],pe[8]=-Ie[2],q(_e,T(_e,pe))});return On.setAxes=Te,On}var rl,qn={};var Gp,Oh,$n={};function qp(){if(Gp)return $n;function d(T){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(A){return typeof A}:function(A){return A&&"function"==typeof Symbol&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A})(T)}Gp=1,Object.defineProperty($n,"__esModule",{value:!0}),$n.create=u,$n.clone=function(T){var A=new o.ARRAY_TYPE(2);return A[0]=T[0],A[1]=T[1],A},$n.fromValues=function(T,A){var O=new o.ARRAY_TYPE(2);return O[0]=T,O[1]=A,O},$n.copy=function(T,A){return T[0]=A[0],T[1]=A[1],T},$n.set=function(T,A,O){return T[0]=A,T[1]=O,T},$n.add=function(T,A,O){return T[0]=A[0]+O[0],T[1]=A[1]+O[1],T},$n.subtract=g,$n.multiply=p,$n.divide=y,$n.ceil=function(T,A){return T[0]=Math.ceil(A[0]),T[1]=Math.ceil(A[1]),T},$n.floor=function(T,A){return T[0]=Math.floor(A[0]),T[1]=Math.floor(A[1]),T},$n.min=function(T,A,O){return T[0]=Math.min(A[0],O[0]),T[1]=Math.min(A[1],O[1]),T},$n.max=function(T,A,O){return T[0]=Math.max(A[0],O[0]),T[1]=Math.max(A[1],O[1]),T},$n.round=function(T,A){return T[0]=Math.round(A[0]),T[1]=Math.round(A[1]),T},$n.scale=function(T,A,O){return T[0]=A[0]*O,T[1]=A[1]*O,T},$n.scaleAndAdd=function(T,A,O,B){return T[0]=A[0]+O[0]*B,T[1]=A[1]+O[1]*B,T},$n.distance=C,$n.squaredDistance=S,$n.length=I,$n.squaredLength=b,$n.negate=function(T,A){return T[0]=-A[0],T[1]=-A[1],T},$n.inverse=function(T,A){return T[0]=1/A[0],T[1]=1/A[1],T},$n.normalize=function(T,A){var O=A[0],B=A[1],V=O*O+B*B;return V>0&&(V=1/Math.sqrt(V)),T[0]=A[0]*V,T[1]=A[1]*V,T},$n.dot=function(T,A){return T[0]*A[0]+T[1]*A[1]},$n.cross=function(T,A,O){var B=A[0]*O[1]-A[1]*O[0];return T[0]=T[1]=0,T[2]=B,T},$n.lerp=function(T,A,O,B){var V=A[0],q=A[1];return T[0]=V+B*(O[0]-V),T[1]=q+B*(O[1]-q),T},$n.random=function(T,A){A=A||1;var O=2*o.RANDOM()*Math.PI;return T[0]=Math.cos(O)*A,T[1]=Math.sin(O)*A,T},$n.transformMat2=function(T,A,O){var B=A[0],V=A[1];return T[0]=O[0]*B+O[2]*V,T[1]=O[1]*B+O[3]*V,T},$n.transformMat2d=function(T,A,O){var B=A[0],V=A[1];return T[0]=O[0]*B+O[2]*V+O[4],T[1]=O[1]*B+O[3]*V+O[5],T},$n.transformMat3=function(T,A,O){var B=A[0],V=A[1];return T[0]=O[0]*B+O[3]*V+O[6],T[1]=O[1]*B+O[4]*V+O[7],T},$n.transformMat4=function(T,A,O){var B=A[0],V=A[1];return T[0]=O[0]*B+O[4]*V+O[12],T[1]=O[1]*B+O[5]*V+O[13],T},$n.rotate=function(T,A,O,B){var V=A[0]-O[0],q=A[1]-O[1],G=Math.sin(B),H=Math.cos(B);return T[0]=V*H-q*G+O[0],T[1]=V*G+q*H+O[1],T},$n.angle=function(T,A){var O=T[0],B=T[1],V=A[0],q=A[1],G=Math.sqrt(O*O+B*B)*Math.sqrt(V*V+q*q);return Math.acos(Math.min(Math.max(G&&(O*V+B*q)/G,-1),1))},$n.zero=function(T){return T[0]=0,T[1]=0,T},$n.str=function(T){return"vec2("+T[0]+", "+T[1]+")"},$n.exactEquals=function(T,A){return T[0]===A[0]&&T[1]===A[1]},$n.equals=function(T,A){var O=T[0],B=T[1],V=A[0],q=A[1];return Math.abs(O-V)<=o.EPSILON*Math.max(1,Math.abs(O),Math.abs(V))&&Math.abs(B-q)<=o.EPSILON*Math.max(1,Math.abs(B),Math.abs(q))},$n.forEach=$n.sqrLen=$n.sqrDist=$n.dist=$n.div=$n.mul=$n.sub=$n.len=void 0;var o=function(T){if(T&&T.__esModule)return T;if(null===T||"object"!==d(T)&&"function"!=typeof T)return{default:T};var O=a(void 0);if(O&&O.has(T))return O.get(T);var B={},V=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var q in T)if("default"!==q&&Object.prototype.hasOwnProperty.call(T,q)){var G=V?Object.getOwnPropertyDescriptor(T,q):null;G&&(G.get||G.set)?Object.defineProperty(B,q,G):B[q]=T[q]}return B.default=T,O&&O.set(T,B),B}(To());function a(T){if("function"!=typeof WeakMap)return null;var A=new WeakMap,O=new WeakMap;return(a=function(B){return B?O:A})(T)}function u(){var T=new o.ARRAY_TYPE(2);return o.ARRAY_TYPE!=Float32Array&&(T[0]=0,T[1]=0),T}function g(T,A,O){return T[0]=A[0]-O[0],T[1]=A[1]-O[1],T}function p(T,A,O){return T[0]=A[0]*O[0],T[1]=A[1]*O[1],T}function y(T,A,O){return T[0]=A[0]/O[0],T[1]=A[1]/O[1],T}function C(T,A){return Math.hypot(A[0]-T[0],A[1]-T[1])}function S(T,A){var O=A[0]-T[0],B=A[1]-T[1];return O*O+B*B}function I(T){return Math.hypot(T[0],T[1])}function b(T){var A=T[0],O=T[1];return A*A+O*O}$n.len=I,$n.sub=g,$n.mul=p,$n.div=y,$n.dist=C,$n.sqrDist=S,$n.sqrLen=b;var D,k=(D=u(),function(T,A,O,B,V,q){var G,H;for(A||(A=2),O||(O=0),H=B?Math.min(B*A+O,T.length):T.length,G=O;G<H;G+=A)D[0]=T[G],D[1]=T[G+1],V(D,D,q),T[G]=D[0],T[G+1]=D[1];return T});return $n.forEach=k,$n}var Zs,ol,Wp,$c,ge=function Fh(){if(Oh)return Kn;function d(T){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(A){return typeof A}:function(A){return A&&"function"==typeof Symbol&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A})(T)}Oh=1,Object.defineProperty(Kn,"__esModule",{value:!0}),Kn.vec4=Kn.vec3=Kn.vec2=Kn.quat2=Kn.quat=Kn.mat4=Kn.mat3=Kn.mat2d=Kn.mat2=Kn.glMatrix=void 0;var o=k(To());Kn.glMatrix=o;var a=k(ri());Kn.mat2=a;var u=k(Ta());Kn.mat2d=u;var g=k(Ld());Kn.mat3=g;var p=k(Aa());Kn.mat4=p;var y=k(il());Kn.quat=y;var C=k(function Yo(){if(rl)return qn;function d(k){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(T){return typeof T}:function(T){return T&&"function"==typeof Symbol&&T.constructor===Symbol&&T!==Symbol.prototype?"symbol":typeof T})(k)}rl=1,Object.defineProperty(qn,"__esModule",{value:!0}),qn.create=function(){var k=new o.ARRAY_TYPE(8);return o.ARRAY_TYPE!=Float32Array&&(k[0]=0,k[1]=0,k[2]=0,k[4]=0,k[5]=0,k[6]=0,k[7]=0),k[3]=1,k},qn.clone=function(k){var T=new o.ARRAY_TYPE(8);return T[0]=k[0],T[1]=k[1],T[2]=k[2],T[3]=k[3],T[4]=k[4],T[5]=k[5],T[6]=k[6],T[7]=k[7],T},qn.fromValues=function(k,T,A,O,B,V,q,G){var H=new o.ARRAY_TYPE(8);return H[0]=k,H[1]=T,H[2]=A,H[3]=O,H[4]=B,H[5]=V,H[6]=q,H[7]=G,H},qn.fromRotationTranslationValues=function(k,T,A,O,B,V,q){var G=new o.ARRAY_TYPE(8);G[0]=k,G[1]=T,G[2]=A,G[3]=O;var H=.5*B,Z=.5*V,ee=.5*q;return G[4]=H*O+Z*A-ee*T,G[5]=Z*O+ee*k-H*A,G[6]=ee*O+H*T-Z*k,G[7]=-H*k-Z*T-ee*A,G},qn.fromRotationTranslation=y,qn.fromTranslation=function(k,T){return k[0]=0,k[1]=0,k[2]=0,k[3]=1,k[4]=.5*T[0],k[5]=.5*T[1],k[6]=.5*T[2],k[7]=0,k},qn.fromRotation=function(k,T){return k[0]=T[0],k[1]=T[1],k[2]=T[2],k[3]=T[3],k[4]=0,k[5]=0,k[6]=0,k[7]=0,k},qn.fromMat4=function(k,T){var A=a.create();u.getRotation(A,T);var O=new o.ARRAY_TYPE(3);return u.getTranslation(O,T),y(k,A,O),k},qn.copy=C,qn.identity=function(k){return k[0]=0,k[1]=0,k[2]=0,k[3]=1,k[4]=0,k[5]=0,k[6]=0,k[7]=0,k},qn.set=function(k,T,A,O,B,V,q,G,H){return k[0]=T,k[1]=A,k[2]=O,k[3]=B,k[4]=V,k[5]=q,k[6]=G,k[7]=H,k},qn.getDual=function(k,T){return k[0]=T[4],k[1]=T[5],k[2]=T[6],k[3]=T[7],k},qn.setDual=function(k,T){return k[4]=T[0],k[5]=T[1],k[6]=T[2],k[7]=T[3],k},qn.getTranslation=function(k,T){var A=T[4],O=T[5],B=T[6],V=T[7],q=-T[0],G=-T[1],H=-T[2],Z=T[3];return k[0]=2*(A*Z+V*q+O*H-B*G),k[1]=2*(O*Z+V*G+B*q-A*H),k[2]=2*(B*Z+V*H+A*G-O*q),k},qn.translate=function(k,T,A){var O=T[0],B=T[1],V=T[2],q=T[3],G=.5*A[0],H=.5*A[1],Z=.5*A[2],ee=T[4],ie=T[5],me=T[6],ue=T[7];return k[0]=O,k[1]=B,k[2]=V,k[3]=q,k[4]=q*G+B*Z-V*H+ee,k[5]=q*H+V*G-O*Z+ie,k[6]=q*Z+O*H-B*G+me,k[7]=-O*G-B*H-V*Z+ue,k},qn.rotateX=function(k,T,A){var O=-T[0],B=-T[1],V=-T[2],q=T[3],G=T[4],H=T[5],Z=T[6],ee=T[7],ie=G*q+ee*O+H*V-Z*B,me=H*q+ee*B+Z*O-G*V,ue=Z*q+ee*V+G*B-H*O,pe=ee*q-G*O-H*B-Z*V;return a.rotateX(k,T,A),k[4]=ie*(q=k[3])+pe*(O=k[0])+me*(V=k[2])-ue*(B=k[1]),k[5]=me*q+pe*B+ue*O-ie*V,k[6]=ue*q+pe*V+ie*B-me*O,k[7]=pe*q-ie*O-me*B-ue*V,k},qn.rotateY=function(k,T,A){var O=-T[0],B=-T[1],V=-T[2],q=T[3],G=T[4],H=T[5],Z=T[6],ee=T[7],ie=G*q+ee*O+H*V-Z*B,me=H*q+ee*B+Z*O-G*V,ue=Z*q+ee*V+G*B-H*O,pe=ee*q-G*O-H*B-Z*V;return a.rotateY(k,T,A),k[4]=ie*(q=k[3])+pe*(O=k[0])+me*(V=k[2])-ue*(B=k[1]),k[5]=me*q+pe*B+ue*O-ie*V,k[6]=ue*q+pe*V+ie*B-me*O,k[7]=pe*q-ie*O-me*B-ue*V,k},qn.rotateZ=function(k,T,A){var O=-T[0],B=-T[1],V=-T[2],q=T[3],G=T[4],H=T[5],Z=T[6],ee=T[7],ie=G*q+ee*O+H*V-Z*B,me=H*q+ee*B+Z*O-G*V,ue=Z*q+ee*V+G*B-H*O,pe=ee*q-G*O-H*B-Z*V;return a.rotateZ(k,T,A),k[4]=ie*(q=k[3])+pe*(O=k[0])+me*(V=k[2])-ue*(B=k[1]),k[5]=me*q+pe*B+ue*O-ie*V,k[6]=ue*q+pe*V+ie*B-me*O,k[7]=pe*q-ie*O-me*B-ue*V,k},qn.rotateByQuatAppend=function(k,T,A){var O=A[0],B=A[1],V=A[2],q=A[3],G=T[0],H=T[1],Z=T[2],ee=T[3];return k[0]=G*q+ee*O+H*V-Z*B,k[1]=H*q+ee*B+Z*O-G*V,k[2]=Z*q+ee*V+G*B-H*O,k[3]=ee*q-G*O-H*B-Z*V,k[4]=(G=T[4])*q+(ee=T[7])*O+(H=T[5])*V-(Z=T[6])*B,k[5]=H*q+ee*B+Z*O-G*V,k[6]=Z*q+ee*V+G*B-H*O,k[7]=ee*q-G*O-H*B-Z*V,k},qn.rotateByQuatPrepend=function(k,T,A){var O=T[0],B=T[1],V=T[2],q=T[3],G=A[0],H=A[1],Z=A[2],ee=A[3];return k[0]=O*ee+q*G+B*Z-V*H,k[1]=B*ee+q*H+V*G-O*Z,k[2]=V*ee+q*Z+O*H-B*G,k[3]=q*ee-O*G-B*H-V*Z,k[4]=O*(ee=A[7])+q*(G=A[4])+B*(Z=A[6])-V*(H=A[5]),k[5]=B*ee+q*H+V*G-O*Z,k[6]=V*ee+q*Z+O*H-B*G,k[7]=q*ee-O*G-B*H-V*Z,k},qn.rotateAroundAxis=function(k,T,A,O){if(Math.abs(O)<o.EPSILON)return C(k,T);var B=Math.hypot(A[0],A[1],A[2]);O*=.5;var V=Math.sin(O),q=V*A[0]/B,G=V*A[1]/B,H=V*A[2]/B,Z=Math.cos(O),ee=T[0],ie=T[1],me=T[2],ue=T[3];k[0]=ee*Z+ue*q+ie*H-me*G,k[1]=ie*Z+ue*G+me*q-ee*H,k[2]=me*Z+ue*H+ee*G-ie*q,k[3]=ue*Z-ee*q-ie*G-me*H;var pe=T[4],Te=T[5],_e=T[6],Ie=T[7];return k[4]=pe*Z+Ie*q+Te*H-_e*G,k[5]=Te*Z+Ie*G+_e*q-pe*H,k[6]=_e*Z+Ie*H+pe*G-Te*q,k[7]=Ie*Z-pe*q-Te*G-_e*H,k},qn.add=function(k,T,A){return k[0]=T[0]+A[0],k[1]=T[1]+A[1],k[2]=T[2]+A[2],k[3]=T[3]+A[3],k[4]=T[4]+A[4],k[5]=T[5]+A[5],k[6]=T[6]+A[6],k[7]=T[7]+A[7],k},qn.multiply=S,qn.scale=function(k,T,A){return k[0]=T[0]*A,k[1]=T[1]*A,k[2]=T[2]*A,k[3]=T[3]*A,k[4]=T[4]*A,k[5]=T[5]*A,k[6]=T[6]*A,k[7]=T[7]*A,k},qn.lerp=function(k,T,A,O){var B=1-O;return I(T,A)<0&&(O=-O),k[0]=T[0]*B+A[0]*O,k[1]=T[1]*B+A[1]*O,k[2]=T[2]*B+A[2]*O,k[3]=T[3]*B+A[3]*O,k[4]=T[4]*B+A[4]*O,k[5]=T[5]*B+A[5]*O,k[6]=T[6]*B+A[6]*O,k[7]=T[7]*B+A[7]*O,k},qn.invert=function(k,T){var A=D(T);return k[0]=-T[0]/A,k[1]=-T[1]/A,k[2]=-T[2]/A,k[3]=T[3]/A,k[4]=-T[4]/A,k[5]=-T[5]/A,k[6]=-T[6]/A,k[7]=T[7]/A,k},qn.conjugate=function(k,T){return k[0]=-T[0],k[1]=-T[1],k[2]=-T[2],k[3]=T[3],k[4]=-T[4],k[5]=-T[5],k[6]=-T[6],k[7]=T[7],k},qn.normalize=function(k,T){var A=D(T);if(A>0){A=Math.sqrt(A);var O=T[0]/A,B=T[1]/A,V=T[2]/A,q=T[3]/A,G=T[4],H=T[5],Z=T[6],ee=T[7],ie=O*G+B*H+V*Z+q*ee;k[0]=O,k[1]=B,k[2]=V,k[3]=q,k[4]=(G-O*ie)/A,k[5]=(H-B*ie)/A,k[6]=(Z-V*ie)/A,k[7]=(ee-q*ie)/A}return k},qn.str=function(k){return"quat2("+k[0]+", "+k[1]+", "+k[2]+", "+k[3]+", "+k[4]+", "+k[5]+", "+k[6]+", "+k[7]+")"},qn.exactEquals=function(k,T){return k[0]===T[0]&&k[1]===T[1]&&k[2]===T[2]&&k[3]===T[3]&&k[4]===T[4]&&k[5]===T[5]&&k[6]===T[6]&&k[7]===T[7]},qn.equals=function(k,T){var A=k[0],O=k[1],B=k[2],V=k[3],q=k[4],G=k[5],H=k[6],Z=k[7],ee=T[0],ie=T[1],me=T[2],ue=T[3],pe=T[4],Te=T[5],_e=T[6],Ie=T[7];return Math.abs(A-ee)<=o.EPSILON*Math.max(1,Math.abs(A),Math.abs(ee))&&Math.abs(O-ie)<=o.EPSILON*Math.max(1,Math.abs(O),Math.abs(ie))&&Math.abs(B-me)<=o.EPSILON*Math.max(1,Math.abs(B),Math.abs(me))&&Math.abs(V-ue)<=o.EPSILON*Math.max(1,Math.abs(V),Math.abs(ue))&&Math.abs(q-pe)<=o.EPSILON*Math.max(1,Math.abs(q),Math.abs(pe))&&Math.abs(G-Te)<=o.EPSILON*Math.max(1,Math.abs(G),Math.abs(Te))&&Math.abs(H-_e)<=o.EPSILON*Math.max(1,Math.abs(H),Math.abs(_e))&&Math.abs(Z-Ie)<=o.EPSILON*Math.max(1,Math.abs(Z),Math.abs(Ie))},qn.sqrLen=qn.squaredLength=qn.len=qn.length=qn.dot=qn.mul=qn.setReal=qn.getReal=void 0;var o=p(To()),a=p(il()),u=p(Aa());function g(k){if("function"!=typeof WeakMap)return null;var T=new WeakMap,A=new WeakMap;return(g=function(O){return O?A:T})(k)}function p(k,T){if(k&&k.__esModule)return k;if(null===k||"object"!==d(k)&&"function"!=typeof k)return{default:k};var A=g(T);if(A&&A.has(k))return A.get(k);var O={},B=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var V in k)if("default"!==V&&Object.prototype.hasOwnProperty.call(k,V)){var q=B?Object.getOwnPropertyDescriptor(k,V):null;q&&(q.get||q.set)?Object.defineProperty(O,V,q):O[V]=k[V]}return O.default=k,A&&A.set(k,O),O}function y(k,T,A){var O=.5*A[0],B=.5*A[1],V=.5*A[2],q=T[0],G=T[1],H=T[2],Z=T[3];return k[0]=q,k[1]=G,k[2]=H,k[3]=Z,k[4]=O*Z+B*H-V*G,k[5]=B*Z+V*q-O*H,k[6]=V*Z+O*G-B*q,k[7]=-O*q-B*G-V*H,k}function C(k,T){return k[0]=T[0],k[1]=T[1],k[2]=T[2],k[3]=T[3],k[4]=T[4],k[5]=T[5],k[6]=T[6],k[7]=T[7],k}function S(k,T,A){var O=T[0],B=T[1],V=T[2],q=T[3],G=A[4],H=A[5],Z=A[6],ee=A[7],ie=T[4],me=T[5],ue=T[6],pe=T[7],Te=A[0],_e=A[1],Ie=A[2],Le=A[3];return k[0]=O*Le+q*Te+B*Ie-V*_e,k[1]=B*Le+q*_e+V*Te-O*Ie,k[2]=V*Le+q*Ie+O*_e-B*Te,k[3]=q*Le-O*Te-B*_e-V*Ie,k[4]=O*ee+q*G+B*Z-V*H+ie*Le+pe*Te+me*Ie-ue*_e,k[5]=B*ee+q*H+V*G-O*Z+me*Le+pe*_e+ue*Te-ie*Ie,k[6]=V*ee+q*Z+O*H-B*G+ue*Le+pe*Ie+ie*_e-me*Te,k[7]=q*ee-O*G-B*H-V*Z+pe*Le-ie*Te-me*_e-ue*Ie,k}qn.getReal=a.copy,qn.setReal=a.copy,qn.mul=S;var I=a.dot;qn.dot=I;var b=a.length;qn.length=b,qn.len=b;var D=a.squaredLength;return qn.squaredLength=D,qn.sqrLen=D,qn}());Kn.quat2=C;var S=k(qp());Kn.vec2=S;var I=k(Nl());Kn.vec3=I;var b=k(Ys());function D(T){if("function"!=typeof WeakMap)return null;var A=new WeakMap,O=new WeakMap;return(D=function(B){return B?O:A})(T)}function k(T,A){if(T&&T.__esModule)return T;if(null===T||"object"!==d(T)&&"function"!=typeof T)return{default:T};var O=D(A);if(O&&O.has(T))return O.get(T);var B={},V=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var q in T)if("default"!==q&&Object.prototype.hasOwnProperty.call(T,q)){var G=V?Object.getOwnPropertyDescriptor(T,q):null;G&&(G.get||G.set)?Object.defineProperty(B,q,G):B[q]=T[q]}return B.default=T,O&&O.set(T,B),B}return Kn.vec4=b,Kn}(),Lh=function(){if(ol)return Zs;function d(o,a,u,g){this.cx=3*o,this.bx=3*(u-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(g-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=a,this.p2x=u,this.p2y=g}return ol=1,Zs=d,d.prototype={sampleCurveX:function(o){return((this.ax*o+this.bx)*o+this.cx)*o},sampleCurveY:function(o){return((this.ay*o+this.by)*o+this.cy)*o},sampleCurveDerivativeX:function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},solveCurveX:function(o,a){if(void 0===a&&(a=1e-6),o<0)return 0;if(o>1)return 1;for(var u=o,g=0;g<8;g++){var p=this.sampleCurveX(u)-o;if(Math.abs(p)<a)return u;var y=this.sampleCurveDerivativeX(u);if(Math.abs(y)<1e-6)break;u-=p/y}var C=0,S=1;for(u=o,g=0;g<20&&(p=this.sampleCurveX(u),!(Math.abs(p-o)<a));g++)o>p?C=u:S=u,u=.5*(S-C)+C;return u},solve:function(o,a){return this.sampleCurveY(this.solveCurveX(o,a))}},Zs}(),fc=Jr(Lh);function Nd(){if($c)return Wp;function d(o,a){this.x=o,this.y=a}return $c=1,Wp=d,d.prototype={clone:function(){return new d(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,a){return this.clone()._rotateAround(o,a)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var a=o.x-this.x,u=o.y-this.y;return a*a+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,a){return Math.atan2(this.x*a-this.y*o,this.x*o+this.y*a)},_matMult:function(o){var a=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=a,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var a=Math.cos(o),u=Math.sin(o),g=u*this.x+a*this.y;return this.x=a*this.x-u*this.y,this.y=g,this},_rotateAround:function(o,a){var u=Math.cos(o),g=Math.sin(o),p=a.y+g*(this.x-a.x)+u*(this.y-a.y);return this.x=a.x+u*(this.x-a.x)-g*(this.y-a.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},d.convert=function(o){return o instanceof d?o:Array.isArray(o)?new d(o[0],o[1]):o},Wp}var Ot=Jr(Nd());function Bl(d,o){if(Array.isArray(d)){if(!Array.isArray(o)||d.length!==o.length)return!1;for(let a=0;a<d.length;a++)if(!Bl(d[a],o[a]))return!1;return!0}if("object"==typeof d&&null!==d&&null!==o){if("object"!=typeof o||Object.keys(d).length!==Object.keys(o).length)return!1;for(const a in d)if(!Bl(d[a],o[a]))return!1;return!0}return d===o}const Xs=Math.PI/180,mc=180/Math.PI;function yi(d){return d*Xs}function Po(d){return d*mc}const sl=[[0,0],[1,0],[1,1],[0,1]];function gc(d){if(d<=0)return 0;if(d>=1)return 1;const o=d*d,a=o*d;return 4*(d<.5?a:3*(d-o)+a-.75)}function Fs(d,o,a,u){const g=new fc(d,o,a,u);return function(p){return g.solve(p)}}const zd=Fs(.25,.1,.25,1);function Qn(d,o,a){return Math.min(a,Math.max(o,d))}function aa(d,o,a){return(a=Qn((a-d)/(o-d),0,1))*a*(3-2*a)}function Dr(d,o,a){const u=a-o,g=((d-o)%u+u)%u+o;return g===o?a:g}function Gc(d,o,a){if(!d.length)return a(null,[]);let u=d.length;const g=new Array(d.length);let p=null;d.forEach((y,C)=>{o(y,(S,I)=>{S&&(p=S),g[C]=I,0==--u&&a(p,g)})})}function ls(d,...o){for(const a of o)for(const u in a)d[u]=a[u];return d}let al=1;function Mi(){return al++}function Nh(d){return d<=1?1:Math.pow(2,Math.ceil(Math.log(d)/Math.LN2))}function zh(d,o){d.forEach(a=>{o[a]&&(o[a]=o[a].bind(o))})}function Bd(d,o,a){const u={};for(const g in d)u[g]=o.call(this,d[g],g,d);return u}function ka(d,o,a){const u={};for(const g in d)o.call(this,d[g],g,d)&&(u[g]=d[g]);return u}function Ls(d){return Array.isArray(d)?d.map(Ls):"object"==typeof d&&d?Bd(d,Ls):d}const Au={};function Ir(d){Au[d]||(typeof console<"u"&&console.warn(d),Au[d]=!0)}function ir(d,o,a){return(a.y-d.y)*(o.x-d.x)>(o.y-d.y)*(a.x-d.x)}function Yp(d){let o=0;for(let a,u,g=0,p=d.length,y=p-1;g<p;y=g++)a=d[g],u=d[y],o+=(u.x-a.x)*(a.y+u.y);return o}function Bh([d,o,a]){const u=yi(o+90),g=yi(a);return{x:d*Math.cos(u)*Math.sin(g),y:d*Math.sin(u)*Math.sin(g),z:d*Math.cos(g),azimuthal:o,polar:a}}function ws(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Ra(d){const o={};if(d.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(a,u,g,p)=>{const y=g||p;return o[u]=!y||y.toLowerCase(),""}),o["max-age"]){const a=parseInt(o["max-age"],10);isNaN(a)?delete o["max-age"]:o["max-age"]=a}return o}let Vd=null;function Vh(d,o){return[d[4*o],d[4*o+1],d[4*o+2],d[4*o+3]]}function Uh(d,o,a,u){for(;o<a;){const g=o+a>>1;d[g]<u?o=g+1:a=g}return o}function fm(d,o,a,u){for(;o<a;){const g=o+a>>1;d[g]<=u?o=g+1:a=g}return o}function ku(d){return d>0?1/(1.001-d):1+d}function it(d){return d>0?1-1/(1.001-d):-d}const re={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!re.API_URL)return null;try{const d=new URL(re.API_URL);return"api.mapbox.cn"===d.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===d.hostname?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function ce(d){return re.API_URL_REGEX.test(d)}function Se(d){return re.API_SPRITE_REGEX.test(d)}let Pe,Ae,Ne,Ke,je,tt;function Qe(){return null==Pe&&(Pe=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof self.createImageBitmap),Pe}const nt={now:()=>void 0!==Ke?Ke:performance.now(),setNow(d){Ke=d},restoreNow(){Ke=void 0},frame(d){const o=requestAnimationFrame(d);return{cancel:()=>cancelAnimationFrame(o)}},getImageData(d,o=0){const{width:a,height:u}=d;je||(je=document.createElement("canvas"));const g=je.getContext("2d",{willReadFrequently:!0});if(!g)throw new Error("failed to create canvas 2d context");return(a>je.width||u>je.height)&&(je.width=a,je.height=u),g.clearRect(-o,-o,a+2*o,u+2*o),g.drawImage(d,0,0,a,u),g.getImageData(-o,-o,a+2*o,u+2*o)},resolveURL:d=>(Ae||(Ae=document.createElement("a")),Ae.href=d,Ae.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(null==Ne&&(Ne=window.matchMedia("(prefers-reduced-motion: reduce)")),Ne.matches)},hasCanvasFingerprintNoise(){if(void 0!==tt)return tt;if(!Qe())return tt=!1,!1;const d=new OffscreenCanvas(85,1),o=d.getContext("2d",{willReadFrequently:!0});let a=0;for(let g=0;g<d.width;++g)o.fillStyle=`rgba(${a++},${a++},${a++}, 255)`,o.fillRect(g,0,1,1);const u=o.getImageData(0,0,d.width,d.height);a=0;for(let g=0;g<u.data.length;++g)if(g%4!=3&&a++!==u.data[g])return tt=!0,!0;return tt=!1,!1}};function Dt(d,o){const a=d.indexOf("?");if(a<0)return`${d}?${new URLSearchParams(o).toString()}`;const u=new URLSearchParams(d.slice(a));for(const g in o)u.set(g,o[g]);return`${d.slice(0,a)}?${u.toString()}`}function Yt(d,o={persistentParams:[]}){const a=d.indexOf("?");if(a<0)return d;const u=new URLSearchParams,g=new URLSearchParams(d.slice(a));for(const y of o.persistentParams){const C=g.get(y);C&&u.set(y,C)}const p=u.toString();return`${d.slice(0,a)}${p.length>0?`?${p}`:""}`}const Qt="mapbox-tiles";let Et=500,Ln=50;const pn=["language","worldview","jobid"];let Hn,Jn;function li(){try{return caches}catch{}}function si(){const d=li();d&&null==Hn&&(Hn=d.open(Qt))}let an=1/0;const Wi={supported:!1,testSupport:function(d){!Oo&&bt&&(eo?Cs(d):ji=d)}};let ji,bt,Oo=!1,eo=!1;const Ks=typeof self<"u"?self:{};function Cs(d){const o=d.createTexture();d.bindTexture(d.TEXTURE_2D,o);try{if(d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,bt),d.isContextLost())return;Wi.supported=!0}catch{}d.deleteTexture(o),Oo=!0}Ks.document&&(bt=Ks.document.createElement("img"),bt.onload=function(){ji&&Cs(ji),ji=null,eo=!0},bt.onerror=function(){Oo=!0,ji=null},bt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Zo={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};"function"==typeof Object.freeze&&Object.freeze(Zo);class Fo extends Error{constructor(o,a,u){401===a&&ce(u)&&(o+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(o),this.status=a,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const la=ws()?()=>self.worker&&self.worker.referrer:()=>("blob:"===location.protocol?parent:self).location.href,Es=function(d,o){if(!(/^file:/.test(a=d.url)||/^file:/.test(la())&&!/^\w+:/.test(a))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(u,g){const p=new AbortController,y=new Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:la(),referrerPolicy:u.referrerPolicy,signal:p.signal});let C=!1,S=!1;const I=(b=y.url).indexOf("sku=")>0&&ce(b);var b;"json"===u.type&&y.headers.set("Accept","application/json");const D=(T,A,O)=>{if(S)return;if(T&&"SecurityError"!==T.message&&Ir(T.toString()),A&&O)return k(A);const B=Date.now();fetch(y).then(V=>{if(V.ok){const q=I?V.clone():null;return k(V,q,B)}return g(new Fo(V.statusText,V.status,u.url))}).catch(V=>{"AbortError"!==V.name&&g(new Error(`${V.message} ${u.url}`))})},k=(T,A,O)=>{("arrayBuffer"===u.type?T.arrayBuffer():"json"===u.type?T.json():T.text()).then(B=>{S||(A&&O&&function(V,q,G){if(si(),null==Hn)return;const H=Ra(q.headers.get("Cache-Control")||"");if(H["no-store"])return;const Z={status:q.status,statusText:q.statusText,headers:new Headers};q.headers.forEach((me,ue)=>Z.headers.set(ue,me)),H["max-age"]&&Z.headers.set("Expires",new Date(G+1e3*H["max-age"]).toUTCString());const ee=Z.headers.get("Expires");if(!ee||new Date(ee).getTime()-G<42e4)return;let ie=Yt(V.url,{persistentParams:pn});if(206===q.status){const me=V.headers.get("Range");if(!me)return;Z.status=200,ie=Dt(ie,{range:me})}!function(me,ue){if(void 0===Jn)try{new Response(new ReadableStream),Jn=!0}catch{Jn=!1}Jn?ue(me.body):me.blob().then(ue)}(q,me=>{const ue=new Response(200!==(pe=q.status)&&404!==pe&&[101,103,204,205,304].includes(pe)?null:me,Z);var pe;si(),Hn?.then(Te=>Te.put(ie,ue)).catch(Te=>Ir(Te.message))})}(y,A,O),C=!0,g(null,B,T.headers.get("Cache-Control"),T.headers.get("Expires")))}).catch(B=>{S||g(new Error(B.message))})};return I?function(T,A){if(si(),null==Hn)return A(null);Hn.then(O=>{let B=Yt(T.url,{persistentParams:pn});const V=T.headers.get("Range");V&&(B=Dt(B,{range:V})),O.match(B).then(q=>{const G=function(H){if(!H)return!1;const Z=new Date(H.headers.get("Expires")||0),ee=Ra(H.headers.get("Cache-Control")||"");return Z>Date.now()&&!ee["no-cache"]}(q);O.delete(B),G&&O.put(B,q.clone()),A(null,q,G)}).catch(A)}).catch(A)}(y,D):D(null,null),{cancel:()=>{S=!0,C||p.abort()}}}(d,o);if(ws()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",d,o,void 0,!0)}var a;return function(u,g){const p=new XMLHttpRequest;p.open(u.method||"GET",u.url,!0),"arrayBuffer"===u.type&&(p.responseType="arraybuffer");for(const y in u.headers)p.setRequestHeader(y,u.headers[y]);return"json"===u.type&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials="include"===u.credentials,p.onerror=()=>{g(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||0===p.status)&&null!==p.response){let y=p.response;if("json"===u.type)try{y=JSON.parse(p.response)}catch(C){return g(C)}g(null,y,p.getResponseHeader("Cache-Control"),p.getResponseHeader("Expires"))}else g(new Fo(p.statusText,p.status,u.url))},p.send(u.body),{cancel:()=>p.abort()}}(d,o)},ca=function(d,o){return Es(ls(d,{type:"arrayBuffer"}),o)};function Ud(d){const o=document.createElement("a");return o.href=d,o.protocol===location.protocol&&o.host===location.host}const Zp="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Ru,Vl;Ru=[],Vl=0;const hv=function(d,o){if(Wi.supported&&(d.headers||(d.headers={}),d.headers.accept="image/webp,*/*"),Vl>=re.MAX_PARALLEL_IMAGE_REQUESTS){const p={requestParameters:d,callback:o,cancelled:!1,cancel(){this.cancelled=!0}};return Ru.push(p),p}Vl++;let a=!1;const u=()=>{if(!a)for(a=!0,Vl--;Ru.length&&Vl<re.MAX_PARALLEL_IMAGE_REQUESTS;){const p=Ru.shift(),{requestParameters:y,callback:C,cancelled:S}=p;S||(p.cancel=hv(y,C).cancel)}},g=ca(d,(p,y,C,S)=>{u(),p?o(p):y&&(self.createImageBitmap?function(I,b){const D=new Blob([new Uint8Array(I)],{type:"image/png"});createImageBitmap(D).then(k=>{b(null,k)}).catch(k=>{b(new Error(`Could not load image because of ${k.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(y,(I,b)=>o(I,b,C,S)):function(I,b){const D=new Image;D.onload=()=>{b(null,D),URL.revokeObjectURL(D.src),D.onload=null,requestAnimationFrame(()=>{D.src=Zp})},D.onerror=()=>b(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const k=new Blob([new Uint8Array(I)],{type:"image/png"});D.src=I.byteLength?URL.createObjectURL(k):Zp}(y,(I,b)=>o(I,b,C,S)))});return{cancel:()=>{g.cancel(),u()}}};var ho,_x,pv,gr={exports:{}},Pa={exports:{}},Lr={exports:{}},_c=function(){if(pv)return gr.exports;pv=1;var d=(ho||(ho=1,Pa.exports=function(a,u){var g,p,y,C,S,I,b,D;for(p=a.length-(g=3&a.length),y=u,S=3432918353,I=461845907,D=0;D<p;)b=255&a.charCodeAt(D)|(255&a.charCodeAt(++D))<<8|(255&a.charCodeAt(++D))<<16|(255&a.charCodeAt(++D))<<24,++D,y=27492+(65535&(C=5*(65535&(y=(y^=b=(65535&(b=(b=(65535&b)*S+(((b>>>16)*S&65535)<<16)&4294967295)<<15|b>>>17))*I+(((b>>>16)*I&65535)<<16)&4294967295)<<13|y>>>19))+((5*(y>>>16)&65535)<<16)&4294967295))+((58964+(C>>>16)&65535)<<16);switch(b=0,g){case 3:b^=(255&a.charCodeAt(D+2))<<16;case 2:b^=(255&a.charCodeAt(D+1))<<8;case 1:y^=b=(65535&(b=(b=(65535&(b^=255&a.charCodeAt(D)))*S+(((b>>>16)*S&65535)<<16)&4294967295)<<15|b>>>17))*I+(((b>>>16)*I&65535)<<16)&4294967295}return y^=a.length,y=2246822507*(65535&(y^=y>>>16))+((2246822507*(y>>>16)&65535)<<16)&4294967295,y=3266489909*(65535&(y^=y>>>13))+((3266489909*(y>>>16)&65535)<<16)&4294967295,(y^=y>>>16)>>>0}),Pa.exports),o=(_x||(_x=1,Lr.exports=function(a,u){for(var g,p=a.length,y=u^p,C=0;p>=4;)g=1540483477*(65535&(g=255&a.charCodeAt(C)|(255&a.charCodeAt(++C))<<8|(255&a.charCodeAt(++C))<<16|(255&a.charCodeAt(++C))<<24))+((1540483477*(g>>>16)&65535)<<16),y=1540483477*(65535&y)+((1540483477*(y>>>16)&65535)<<16)^(g=1540483477*(65535&(g^=g>>>24))+((1540483477*(g>>>16)&65535)<<16)),p-=4,++C;switch(p){case 3:y^=(255&a.charCodeAt(C+2))<<16;case 2:y^=(255&a.charCodeAt(C+1))<<8;case 1:y=1540483477*(65535&(y^=255&a.charCodeAt(C)))+((1540483477*(y>>>16)&65535)<<16)}return y=1540483477*(65535&(y^=y>>>13))+((1540483477*(y>>>16)&65535)<<16),(y^=y>>>15)>>>0}),Lr.exports);return gr.exports=d,gr.exports.murmur3=d,gr.exports.murmur2=o,gr.exports}(),ll=Jr(_c);class da{constructor(o,...a){ls(this,a[0]||{}),this.type=o}}class ur extends da{constructor(o,a={}){super("error",ls({error:o},a))}}function vi(d,o,a){a[d]&&-1!==a[d].indexOf(o)||(a[d]=a[d]||[],a[d].push(o))}function Pu(d,o,a){if(a&&a[d]){const u=a[d].indexOf(o);-1!==u&&a[d].splice(u,1)}}class po{on(o,a){return this._listeners=this._listeners||{},vi(o,a,this._listeners),this}off(o,a){return Pu(o,a,this._listeners),Pu(o,a,this._oneTimeListeners),this}once(o,a){return a?(this._oneTimeListeners=this._oneTimeListeners||{},vi(o,a,this._oneTimeListeners),this):new Promise(u=>{this.once(o,u)})}fire(o,a){const u="string"==typeof o?new da(o,a):o,g=u.type;if(this.listens(g)){u.target=this;const p=this._listeners&&this._listeners[g]?this._listeners[g].slice():[];for(const S of p)S.call(this,u);const y=this._oneTimeListeners&&this._oneTimeListeners[g]?this._oneTimeListeners[g].slice():[];for(const S of y)Pu(g,S,this._oneTimeListeners),S.call(this,u);const C=this._eventedParent;C&&(ls(u,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),C.fire(u))}else u instanceof ur&&console.error(u.error);return this}listens(o){return!!(this._listeners&&this._listeners[o]&&this._listeners[o].length>0||this._oneTimeListeners&&this._oneTimeListeners[o]&&this._oneTimeListeners[o].length>0||this._eventedParent&&this._eventedParent.listens(o))}setEventedParent(o,a){return this._eventedParent=o,this._eventedParentData=a,this}}class ua{constructor(o){"string"==typeof o?this.name=o:(this.name=o.name,this.iconsetId=o.iconsetId)}static from(o){return new ua(o)}static toString(o){return o.iconsetId?`${o.name}\x1f${o.iconsetId}`:o.name}static parse(o){const[a,u]=o.split("\x1f");return new ua({name:a,iconsetId:u})}static isEqual(o,a){return o.name===a.name&&o.iconsetId===a.iconsetId}toString(){return ua.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var fv,mv={},cs=function(){if(fv)return mv;fv=1;var d={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function o(p){return(p=Math.round(p))<0?0:p>255?255:p}function a(p){return o("%"===p[p.length-1]?parseFloat(p)/100*255:parseInt(p))}function u(p){return(y="%"===p[p.length-1]?parseFloat(p)/100:parseFloat(p))<0?0:y>1?1:y;var y}function g(p,y,C){return C<0?C+=1:C>1&&(C-=1),6*C<1?p+(y-p)*C*6:2*C<1?y:3*C<2?p+(y-p)*(2/3-C)*6:p}try{mv.parseCSSColor=function(p){var y,C=p.replace(/ /g,"").toLowerCase();if(C in d)return d[C].slice();if("#"===C[0])return 4===C.length?(y=parseInt(C.substr(1),16))>=0&&y<=4095?[(3840&y)>>4|(3840&y)>>8,240&y|(240&y)>>4,15&y|(15&y)<<4,1]:null:7===C.length&&(y=parseInt(C.substr(1),16))>=0&&y<=16777215?[(16711680&y)>>16,(65280&y)>>8,255&y,1]:null;var S=C.indexOf("("),I=C.indexOf(")");if(-1!==S&&I+1===C.length){var b=C.substr(0,S),D=C.substr(S+1,I-(S+1)).split(","),k=1;switch(b){case"rgba":if(4!==D.length)return null;k=u(D.pop());case"rgb":return 3!==D.length?null:[a(D[0]),a(D[1]),a(D[2]),k];case"hsla":if(4!==D.length)return null;k=u(D.pop());case"hsl":if(3!==D.length)return null;var T=(parseFloat(D[0])%360+360)%360/360,A=u(D[1]),O=u(D[2]),B=O<=.5?O*(A+1):O+A-O*A,V=2*O-B;return[o(255*g(V,B,T+1/3)),o(255*g(V,B,T)),o(255*g(V,B,T-1/3)),k];default:return null}}return null}}catch{}return mv}();class Yi{constructor(o,a,u,g=1){this.r=o,this.g=a,this.b=u,this.a=g}static parse(o){if(!o)return;if(o instanceof Yi)return o;if("string"!=typeof o)return;const a=cs.parseCSSColor(o);return a?new Yi(a[0]/255*a[3],a[1]/255*a[3],a[2]/255*a[3],a[3]):void 0}toStringPremultipliedAlpha(){const[o,a,u,g]=0===this.a?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(o)},${Math.round(a)},${Math.round(u)},${g})`}toString(){const[o,a,u,g]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*o)},${Math.round(255*a)},${Math.round(255*u)},${g})`}toRenderColor(o){const{r:a,g:u,b:g,a:p}=this;return new gv(o,a,u,g,p)}clone(){return new Yi(this.r,this.g,this.b,this.a)}}class gv{constructor(o,a,u,g,p){if(o){const y=o.image.height,C=y*y;a=0===p?0:a/p*(y-1),u=0===p?0:u/p*(y-1),g=0===p?0:g/p*(y-1);const S=Math.floor(a),I=Math.floor(u),b=Math.floor(g),D=Math.ceil(a),k=Math.ceil(u),T=Math.ceil(g),A=a-S,O=u-I,B=g-b,V=o.image.data,q=4*(S+I*C+b*y),G=4*(S+I*C+T*y),H=4*(S+k*C+b*y),Z=4*(S+k*C+T*y),ee=4*(D+I*C+b*y),ie=4*(D+I*C+T*y),me=4*(D+k*C+b*y),ue=4*(D+k*C+T*y);if(q<0||ue>=V.length)throw new Error("out of range");this.r=_n(_n(_n(V[q],V[G],B),_n(V[H],V[Z],B),O),_n(_n(V[ee],V[ie],B),_n(V[me],V[ue],B),O),A)/255*p,this.g=_n(_n(_n(V[q+1],V[G+1],B),_n(V[H+1],V[Z+1],B),O),_n(_n(V[ee+1],V[ie+1],B),_n(V[me+1],V[ue+1],B),O),A)/255*p,this.b=_n(_n(_n(V[q+2],V[G+2],B),_n(V[H+2],V[Z+2],B),O),_n(_n(V[ee+2],V[ie+2],B),_n(V[me+2],V[ue+2],B),O),A)/255*p,this.a=p}else this.r=a,this.g=u,this.b=g,this.a=p}toArray(){const{r:o,g:a,b:u,a:g}=this;return 0===g?[0,0,0,0]:[255*o/g,255*a/g,255*u/g,g]}toHslaArray(){if(0===this.a)return[0,0,0,0];const{r:o,g:a,b:u,a:g}=this,p=Math.min(Math.max(o/g,0),1),y=Math.min(Math.max(a/g,0),1),C=Math.min(Math.max(u/g,0),1),S=Math.min(p,y,C),I=Math.max(p,y,C),b=(S+I)/2;if(S===I)return[0,0,100*b,g];const D=I-S,k=b>.5?D/(2-I-S):D/(I+S);let T=0;return I===p?T=(y-C)/D+(y<C?6:0):I===y?T=(C-p)/D+2:I===C&&(T=(p-y)/D+4),T*=60,[Math.min(Math.max(T,0),360),Math.min(Math.max(100*k,0),100),Math.min(Math.max(100*b,0),100),g]}toArray01(){const{r:o,g:a,b:u,a:g}=this;return 0===g?[0,0,0,0]:[o/g,a/g,u/g,g]}toArray01Scaled(o){const{r:a,g:u,b:g,a:p}=this;return 0===p?[0,0,0]:[a/p*o,u/p*o,g/p*o]}toArray01PremultipliedAlpha(){const{r:o,g:a,b:u,a:g}=this;return[o,a,u,g]}toArray01Linear(){const{r:o,g:a,b:u,a:g}=this;return 0===g?[0,0,0,0]:[Math.pow(o/g,2.2),Math.pow(a/g,2.2),Math.pow(u/g,2.2),g]}}function _n(d,o,a){return d*(1-a)+o*a}function yx(d,o,a){return d.map((u,g)=>_n(u,o[g],a))}function _v(d){return d*d*d*d*d}Yi.black=new Yi(0,0,0,1),Yi.white=new Yi(1,1,1,1),Yi.transparent=new Yi(0,0,0,0),Yi.red=new Yi(1,0,0,1),Yi.blue=new Yi(0,0,1,1);var mm=Object.freeze({__proto__:null,array:yx,color:function(d,o,a){return new Yi(_n(d.r,o.r,a),_n(d.g,o.g,a),_n(d.b,o.b,a),_n(d.a,o.a,a))},easeIn:_v,number:_n});function Ti(d,...o){for(const a of o)for(const u in a)d[u]=a[u];return d}class to extends Error{constructor(o,a){super(a),this.message=a,this.key=o}}class ni{constructor(o,a=[]){this.parent=o,this.bindings={};for(const[u,g]of a)this.bindings[u]=g}concat(o){return new ni(this,o)}get(o){if(this.bindings[o])return this.bindings[o];if(this.parent)return this.parent.get(o);throw new Error(`${o} not found in scope.`)}has(o){return!!this.bindings[o]||!!this.parent&&this.parent.has(o)}}const Xp={kind:"null"},rn={kind:"number"},Hi={kind:"string"},Ii={kind:"boolean"},Ns={kind:"color"},Nt={kind:"object"},Ni={kind:"value"},Ai={kind:"collator"},jd={kind:"formatted"},qc={kind:"resolvedImage"};function Xo(d,o){return{kind:"array",itemType:d,N:o}}function Wr(d){if("array"===d.kind){const o=Wr(d.itemType);return"number"==typeof d.N?`array<${o}, ${d.N}>`:"value"===d.itemType.kind?"array":`array<${o}>`}return d.kind}const ha=[Xp,rn,Hi,Ii,Ns,jd,Nt,Xo(Ni),qc];function Wc(d,o){if("error"===o.kind)return null;if("array"===d.kind){if("array"===o.kind&&(0===o.N&&"value"===o.itemType.kind||!Wc(d.itemType,o.itemType))&&("number"!=typeof d.N||d.N===o.N))return null}else{if(d.kind===o.kind)return null;if("value"===d.kind)for(const a of ha)if(!Wc(a,o))return null}return`Expected ${Wr(d)} but found ${Wr(o)} instead.`}function Kp(d,o){return o.some(a=>a.kind===d.kind)}function Ou(d,o){return o.some(a=>"null"===a?null===d:"array"===a?Array.isArray(d):"object"===a?d&&!Array.isArray(d)&&"object"==typeof d:a===typeof d)}class gm{constructor(o,a,u){this.sensitivity=o?a?"variant":"case":a?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(o,a){return this.collator.compare(o,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class _t{constructor(o,a,u,g,p){this.text=o.normalize?o.normalize():o,this.image=a,this.scale=u,this.fontStack=g,this.textColor=p}}class Ko{constructor(o){this.sections=o}static fromString(o){return new Ko([new _t(o,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(o=>0!==o.text.length||!!o.image&&o.image.hasPrimary())}static factory(o){return o instanceof Ko?o:Ko.fromString(o)}toString(){return 0===this.sections.length?"":this.sections.map(o=>o.text).join("")}serialize(){const o=["format"];for(const a of this.sections){if(a.image){const g=a.image.getPrimary().id.toString();o.push(["image",g]);continue}o.push(a.text);const u={};a.fontStack&&(u["text-font"]=["literal",a.fontStack.split(",")]),a.scale&&(u["font-scale"]=a.scale),a.textColor&&(u["text-color"]=["rgba"].concat(a.textColor.toRenderColor(null).toArray())),o.push(u)}return o}}class Oa{constructor(o,a={}){if(this.id=ua.from(o),this.options=Object.assign({},a),a.transform){const{a:u,b:g,c:p,d:y,e:C,f:S}=a.transform;this.options.transform=new DOMMatrix([u,g,p,y,C,S])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:o,b:a,c:u,d:g,e:p,f:y}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:o,b:a,c:u,d:g,e:p,f:y}})}static parse(o){let a,u,g,p;try{({name:a,iconsetId:u,params:g,transform:p}=JSON.parse(o)||{})}catch{return null}if(!a)return null;const{a:y,b:C,c:S,d:I,e:b,f:D}=p||{};return new Oa({name:a,iconsetId:u},{params:g,transform:new DOMMatrix([y,C,S,I,b,D])})}scaleSelf(o){return this.options.transform.scaleSelf(o),this}}class ds{constructor(o,a,u,g,p=!1){this.primaryId=ua.from(o),this.primaryOptions=a,u&&(this.secondaryId=ua.from(u)),this.secondaryOptions=g,this.available=p}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Oa(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Oa(this.secondaryId,this.secondaryOptions):null}static from(o){return"string"==typeof o?ds.build({name:o}):o}static build(o,a,u,g){return!o||"object"==typeof o&&!("name"in o)?null:new ds(o,u,a,g)}}function Fu(d,o,a,u){return"number"==typeof d&&d>=0&&d<=255&&"number"==typeof o&&o>=0&&o<=255&&"number"==typeof a&&a>=0&&a<=255?void 0===u||"number"==typeof u&&u>=0&&u<=1?null:`Invalid rgba value [${[d,o,a,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof u?[d,o,a,u]:[d,o,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ul(d){if(null===d||"string"==typeof d||"boolean"==typeof d||"number"==typeof d||d instanceof Yi||d instanceof gm||d instanceof Ko||d instanceof ds)return!0;if(Array.isArray(d)){for(const o of d)if(!Ul(o))return!1;return!0}if("object"==typeof d){for(const o in d)if(!Ul(d[o]))return!1;return!0}return!1}function Yr(d){if(null===d)return Xp;if("string"==typeof d)return Hi;if("boolean"==typeof d)return Ii;if("number"==typeof d)return rn;if(d instanceof Yi)return Ns;if(d instanceof gm)return Ai;if(d instanceof Ko)return jd;if(d instanceof ds)return qc;if(Array.isArray(d)){const o=d.length;let a;for(const u of d){const g=Yr(u);if(a){if(a===g)continue;a=Ni;break}a=g}return Xo(a||Ni,o)}return Nt}function Qo(d){const o=typeof d;return null===d?"":"string"===o||"number"===o||"boolean"===o?String(d):d instanceof Yi?d.toStringPremultipliedAlpha():d instanceof Ko||d instanceof ds?d.toString():JSON.stringify(d)}class Hd{constructor(o,a){this.type=o,this.value=a}static parse(o,a){if(2!==o.length)return a.error(`'literal' expression requires exactly one argument, but found ${o.length-1} instead.`);if(!Ul(o[1]))return a.error("invalid value");const u=o[1];let g=Yr(u);const p=a.expectedType;return"array"!==g.kind||0!==g.N||!p||"array"!==p.kind||"number"==typeof p.N&&0!==p.N||(g=p),new Hd(g,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Yi?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof Ko?this.value.serialize():this.value}}class so{constructor(o){this.name="ExpressionEvaluationError",this.message=o}toJSON(){return this.message}}const yv={string:Hi,number:rn,boolean:Ii,object:Nt};class cl{constructor(o,a){this.type=o,this.args=a}static parse(o,a){if(o.length<2)return a.error("Expected at least one argument.");let u,g=1;const p=o[0];if("array"===p){let C,S;if(o.length>2){const I=o[1];if("string"!=typeof I||!(I in yv)||"object"===I)return a.error('The item type argument of "array" must be one of string, number, boolean',1);C=yv[I],g++}else C=Ni;if(o.length>3){if(null!==o[2]&&("number"!=typeof o[2]||o[2]<0||o[2]!==Math.floor(o[2])))return a.error('The length argument to "array" must be a positive integer literal',2);S=o[2],g++}u=Xo(C,S)}else u=yv[p];const y=[];for(;g<o.length;g++){const C=a.parse(o[g],g,Ni);if(!C)return null;y.push(C)}return new cl(u,y)}evaluate(o){for(let a=0;a<this.args.length;a++){const u=this.args[a].evaluate(o);if(!Wc(this.type,Yr(u)))return u;if(a===this.args.length-1)throw new so(`The expression ${JSON.stringify(this.args[a].serialize())} evaluated to ${Wr(Yr(u))} but was expected to be of type ${Wr(this.type)}.`)}return null}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=this.type,a=[o.kind];if("array"===o.kind){const u=o.itemType;if("string"===u.kind||"number"===u.kind||"boolean"===u.kind){a.push(u.kind);const g=o.N;("number"==typeof g||this.args.length>1)&&a.push(g)}}return a.concat(this.args.map(u=>u.serialize()))}}class $d{constructor(o){this.type=jd,this.sections=o}static parse(o,a){if(o.length<2)return a.error("Expected at least one argument.");const u=o[1];if(!Array.isArray(u)&&"object"==typeof u)return a.error("First argument must be an image or text section.");const g=[];let p=!1;for(let y=1;y<=o.length-1;++y){const C=o[y];if(p&&"object"==typeof C&&!Array.isArray(C)){p=!1;let S=null;if(C["font-scale"]&&(S=a.parseObjectValue(C["font-scale"],y,"font-scale",rn),!S))return null;let I=null;if(C["text-font"]&&(I=a.parseObjectValue(C["text-font"],y,"text-font",Xo(Hi)),!I))return null;let b=null;if(C["text-color"]&&(b=a.parseObjectValue(C["text-color"],y,"text-color",Ns),!b))return null;const D=g[g.length-1];D.scale=S,D.font=I,D.textColor=b}else{const S=a.parse(o[y],y,Ni);if(!S)return null;const I=S.type.kind;if("string"!==I&&"value"!==I&&"null"!==I&&"resolvedImage"!==I)return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,g.push({content:S,scale:null,font:null,textColor:null})}}return new $d(g)}evaluate(o){return new Ko(this.sections.map(a=>{const u=a.content.evaluate(o);return Yr(u)===qc?new _t("",u,null,null,null):new _t(Qo(u),null,a.scale?a.scale.evaluate(o):null,a.font?a.font.evaluate(o).join(","):null,a.textColor?a.textColor.evaluate(o):null)}))}eachChild(o){for(const a of this.sections)o(a.content),a.scale&&o(a.scale),a.font&&o(a.font),a.textColor&&o(a.textColor)}outputDefined(){return!1}serialize(){const o=["format"];for(const a of this.sections){o.push(a.content.serialize());const u={};a.scale&&(u["font-scale"]=a.scale.serialize()),a.font&&(u["text-font"]=a.font.serialize()),a.textColor&&(u["text-color"]=a.textColor.serialize()),o.push(u)}return o}}class Fa{constructor(o,a,u,g){this._imageWarnHistory={},this.type=qc,this.namePrimary=o,this.nameSecondary=a,u&&(this.paramsPrimary=u.params,this.iconsetIdPrimary=u.iconset?u.iconset.id:void 0),g&&(this.paramsSecondary=g.params,this.iconsetIdSecondary=g.iconset?g.iconset.id:void 0)}static parse(o,a){if(o.length<2)return a.error("Expected two or more arguments.");let u=1;const g=[];function p(){if(u<o.length){const C=a.parse(o[u],u++,Hi);return C?(g.push({image:C,options:{}}),!0):(a.error(g.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function y(){if(u<o.length){const S=o[u];if(null===(C=S)||"object"!=typeof C||Array.isArray(C))return!0;const I=S.params,b=S.iconset,D=a.concat(u);if(!I&&!b)return u++,!0;if(I){if("object"!=typeof I||I.constructor!==Object)return D.error('Image options "params" should be an object'),!1;const k={},T=D.concat(void 0,"params");for(const A in I){if(!A)return T.error("Image parameter name should be non-empty"),!1;const O=T.concat(void 0,A).parse(I[A],void 0,Ns,void 0,{typeAnnotation:"coerce"});if(!O)return!1;k[A]=O}g[g.length-1].options.params=k}if(b){if("object"!=typeof b||b.constructor!==Object)return D.error('Image options "iconset" should be an object'),!1;if(!b.id)return D.error('Image options "iconset" should have an "id" property'),!1;g[g.length-1].options.iconset=b}return u++,!0}var C;return!0}for(let C=0;C<2;C++)if(!p()||!y())return;return new Fa(g[0].image,g[1]?g[1].image:void 0,g[0].options,g[1]?g[1].options:void 0)}evaluateParams(o,a){const u={};if(a){for(const g in a)if(a[g])try{u[g]=a[g].evaluate(o)}catch{continue}if(0!==Object.keys(u).length)return{params:u}}}evaluate(o){const a={name:this.namePrimary.evaluate(o),iconsetId:this.iconsetIdPrimary},u=this.nameSecondary?{name:this.nameSecondary.evaluate(o),iconsetId:this.iconsetIdSecondary}:void 0,g=ds.build(a,u,this.paramsPrimary?this.evaluateParams(o,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(o,this.paramsSecondary):void 0);if(g&&o.availableImages){const p=g.getPrimary().id;if(g.available=o.availableImages.some(y=>ua.isEqual(y,p)),g.available){const y=g.getSecondary()?g.getSecondary().id:null;y&&(g.available=o.availableImages.some(C=>ua.isEqual(C,y)))}}return g}eachChild(o){if(o(this.namePrimary),this.paramsPrimary)for(const a in this.paramsPrimary)this.paramsPrimary[a]&&o(this.paramsPrimary[a]);if(this.nameSecondary&&(o(this.nameSecondary),this.paramsSecondary))for(const a in this.paramsSecondary)this.paramsSecondary[a]&&o(this.paramsSecondary[a])}outputDefined(){return!1}serializeOptions(o,a){const u={};if(a&&(u.iconset={id:a}),o){u.params={};for(const g in o)o[g]&&(u.params[g]=o[g].serialize())}return Object.keys(u).length>0?u:void 0}serialize(){const o=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const a=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);a&&o.push(a)}if(this.nameSecondary&&(o.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const a=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);a&&o.push(a)}return o}}function jl(d){return d instanceof Number?"number":d instanceof String?"string":d instanceof Boolean?"boolean":Array.isArray(d)?"array":null===d?"null":typeof d}const t_={"to-boolean":Ii,"to-color":Ns,"to-number":rn,"to-string":Hi};class yc{constructor(o,a){this.type=o,this.args=a}static parse(o,a){if(o.length<2)return a.error("Expected at least one argument.");const u=o[0],g=[];let p=Xp;if("to-array"===u){if(!Array.isArray(o[1]))return null;const y=o[1].length;if(a.expectedType){if("array"!==a.expectedType.kind)return a.error(`Expected ${a.expectedType.kind} but found array.`);p=Xo(a.expectedType.itemType,y)}else{if(!(y>0&&Ul(o[1][0])))return null;p=Xo(Yr(o[1][0]),y)}for(let C=0;C<y;C++){const S=o[1][C];let I;if("array"===jl(S))I=a.parse(S,void 0,p.itemType);else{const b=jl(S);if(b!==p.itemType.kind)return a.error(`Expected ${p.itemType.kind} but found ${b}.`);I=a.registry.literal.parse(["literal",void 0===S?null:S],a)}if(!I)return null;g.push(I)}}else{if(("to-boolean"===u||"to-string"===u)&&2!==o.length)return a.error("Expected one argument.");p=t_[u];for(let y=1;y<o.length;y++){const C=a.parse(o[y],y,Ni);if(!C)return null;g.push(C)}}return new yc(p,g)}evaluate(o){if("boolean"===this.type.kind)return!!this.args[0].evaluate(o);if("color"===this.type.kind){let a,u;for(const g of this.args){if(a=g.evaluate(o),u=null,a instanceof Yi)return a;if("string"==typeof a){const p=o.parseColor(a);if(p)return p}else if(Array.isArray(a)&&(u=a.length<3||a.length>4?`Invalid rbga value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:Fu(a[0],a[1],a[2],a[3]),!u))return new Yi(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new so(u||`Could not parse color from value '${"string"==typeof a?a:String(JSON.stringify(a))}'`)}if("number"===this.type.kind){let a=null;for(const u of this.args){if(a=u.evaluate(o),null===a)return 0;const g=Number(a);if(!isNaN(g))return g}throw new so(`Could not convert ${JSON.stringify(a)} to number.`)}return"formatted"===this.type.kind?Ko.fromString(Qo(this.args[0].evaluate(o))):"resolvedImage"===this.type.kind?ds.build(Qo(this.args[0].evaluate(o))):"array"===this.type.kind?this.args.map(a=>a.evaluate(o)):Qo(this.args[0].evaluate(o))}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){if("formatted"===this.type.kind)return new $d([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Fa(this.args[0]).serialize();const o="array"===this.type.kind?[]:[`to-${this.type.kind}`];return this.eachChild(a=>{o.push(a.serialize())}),o}}const Yc=["Unknown","Point","LineString","Polygon"];class Gd{constructor(o,a){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=o,this.options=a}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Yc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(o){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const o=this.featureDistanceData.center,a=this.featureDistanceData.scale,{x:u,y:g}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(u*a-o[0])+this.featureDistanceData.bearing[1]*(g*a-o[1])}return 0}parseColor(o){let a=this._parseColorCache[o];return a||(a=this._parseColorCache[o]=Yi.parse(o)),a}getConfig(o){return this.options?this.options.get(o):null}}class Ss{constructor(o,a,u,g,p){this.name=o,this.type=a,this._evaluate=u,this.args=g,this._overloadIndex=p}evaluate(o){if(!this._evaluate){const a=Ss.definitions[this.name];this._evaluate=Array.isArray(a)?a[2]:a.overloads[this._overloadIndex][1]}return this._evaluate(o,this.args)}eachChild(o){this.args.forEach(o)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(o=>o.serialize()))}static parse(o,a){const u=o[0],g=Ss.definitions[u];if(!g)return a.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(g)?g[0]:g.type,y=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,C=[];let S=null,I=-1;for(const[b,D]of y){if(Array.isArray(b)&&b.length!==o.length-1)continue;C.push(b),I++,S=new Sm(a.registry,a.path,null,a.scope,void 0,a._scope,a.options);const k=[];let T=!1;for(let A=1;A<o.length;A++){const O=o[A],B=Array.isArray(b)?b[A-1]:b.type,V=S.parse(O,1+k.length,B);if(!V){T=!0;break}k.push(V)}if(!T)if(Array.isArray(b)&&b.length!==k.length)S.error(`Expected ${b.length} arguments, but found ${k.length} instead.`);else{for(let A=0;A<k.length;A++){const O=Array.isArray(b)?b[A]:b.type,B=k[A];S.concat(A+1).checkSubtype(O,B.type)}if(0===S.errors.length)return new Ss(u,p,D,k,I)}}if(1===C.length)a.errors.push(...S.errors);else{const b=(C.length?C:y.map(([k])=>k)).map(zi).join(" | "),D=[];for(let k=1;k<o.length;k++){const T=a.parse(o[k],1+D.length);if(!T)return null;D.push(Wr(T.type))}a.error(`Expected arguments of type ${b}, but found (${D.join(", ")}) instead.`)}return null}static register(o,a){Ss.definitions=a;for(const u in a)o[u]=Ss}}function zi(d){return Array.isArray(d)?`(${d.map(Wr).join(", ")})`:`(${Wr(d.type)}...)`}class cr{constructor(o,a,u){this.type=Ai,this.locale=u,this.caseSensitive=o,this.diacriticSensitive=a}static parse(o,a){if(2!==o.length)return a.error("Expected one argument.");const u=o[1];if("object"!=typeof u||Array.isArray(u))return a.error("Collator options argument must be an object.");const g=void 0===u["case-sensitive"]?a.parse(!1,1,Ii):a.parseObjectValue(u["case-sensitive"],1,"case-sensitive",Ii);if(!g)return null;const p=void 0===u["diacritic-sensitive"]?a.parse(!1,1,Ii):a.parseObjectValue(u["diacritic-sensitive"],1,"diacritic-sensitive",Ii);if(!p)return null;let y=null;return u.locale&&(y=a.parseObjectValue(u.locale,1,"locale",Hi),!y)?null:new cr(g,p,y)}evaluate(o){return new gm(this.caseSensitive.evaluate(o),this.diacriticSensitive.evaluate(o),this.locale?this.locale.evaluate(o):null)}eachChild(o){o(this.caseSensitive),o(this.diacriticSensitive),this.locale&&o(this.locale)}outputDefined(){return!1}serialize(){const o={};return o["case-sensitive"]=this.caseSensitive.serialize(),o["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(o.locale=this.locale.serialize()),["collator",o]}}function vx(d,o,a=0,u=d.length-1,g=vv){for(;u>a;){if(u-a>600){const S=u-a+1,I=o-a+1,b=Math.log(S),D=.5*Math.exp(2*b/3),k=.5*Math.sqrt(b*D*(S-D)/S)*(I-S/2<0?-1:1);vx(d,o,Math.max(a,Math.floor(o-I*D/S+k)),Math.min(u,Math.floor(o+(S-I)*D/S+k)),g)}const p=d[o];let y=a,C=u;for(Qp(d,a,o),g(d[u],p)>0&&Qp(d,a,u);y<C;){for(Qp(d,y,C),y++,C--;g(d[y],p)<0;)y++;for(;g(d[C],p)>0;)C--}0===g(d[a],p)?Qp(d,a,C):(C++,Qp(d,C,u)),C<=o&&(a=C+1),o<=C&&(u=C-1)}}function Qp(d,o,a){const u=d[o];d[o]=d[a],d[a]=u}function vv(d,o){return d<o?-1:d>o?1:0}function xE(d){let o=0;for(let a,u,g=0,p=d.length,y=p-1;g<p;y=g++)a=d[g],u=d[y],o+=(u.x-a.x)*(a.y+u.y);return o}function Jp(d,o){d[0]=Math.min(d[0],o[0]),d[1]=Math.min(d[1],o[1]),d[2]=Math.max(d[2],o[0]),d[3]=Math.max(d[3],o[1])}function Lu(d,o){return!(d[0]<=o[0]||d[2]>=o[2]||d[1]<=o[1]||d[3]>=o[3])}function rr(d,o,a){const u=d[0]-o[0],g=d[1]-o[1],p=d[0]-a[0],y=d[1]-a[1];return u*y-p*g==0&&u*p<=0&&g*y<=0}function Zc(d,o,a=!1){let u=!1;for(let C=0,S=o.length;C<S;C++){const I=o[C];for(let b=0,D=I.length,k=D-1;b<D;k=b++){const T=I[k],A=I[b];if(rr(d,T,A))return a;(p=T)[1]>(g=d)[1]!=(y=A)[1]>g[1]&&g[0]<(y[0]-p[0])*(g[1]-p[1])/(y[1]-p[1])+p[0]&&(u=!u)}}var g,p,y;return u}function qd(d,o,a,u){const g=u[0]-a[0],p=u[1]-a[1],y=(d[0]-a[0])*p-g*(d[1]-a[1]),C=(o[0]-a[0])*p-g*(o[1]-a[1]);return y>0&&C<0||y<0&&C>0}function Ds(d,o,a,u){return(g=[u[0]-a[0],u[1]-a[1]])[0]*(p=[o[0]-d[0],o[1]-d[1]])[1]-g[1]*p[0]!=0&&!(!qd(d,o,a,u)||!qd(a,u,d,o));var g,p}const Xc=8192;function bv(d,o){const a=(180+d[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+d[1]*Math.PI/360)))/360,g=Math.pow(2,o.z);return[Math.round(a*g*Xc),Math.round(u*g*Xc)]}function wE(d,o){for(let a=0;a<o.length;a++)if(Zc(d,o[a]))return!0;return!1}function Nu(d,o,a){for(const u of a)for(let g=0,p=u.length,y=p-1;g<p;y=g++)if(Ds(d,o,u[y],u[g]))return!0;return!1}function _m(d,o){for(let a=0;a<d.length;++a)if(!Zc(d[a],o))return!1;for(let a=0;a<d.length-1;++a)if(Nu(d[a],d[a+1],o))return!1;return!0}function xv(d,o){for(let a=0;a<o.length;a++)if(_m(d,o[a]))return!0;return!1}function Hl(d,o,a){const u=[];for(let g=0;g<d.length;g++){const p=[];for(let y=0;y<d[g].length;y++){const C=bv(d[g][y],a);Jp(o,C),p.push(C)}u.push(p)}return u}function ei(d,o,a){const u=[];for(let g=0;g<d.length;g++){const p=Hl(d[g],o,a);u.push(p)}return u}function cn(d,o,a,u){if(d[0]<a[0]||d[0]>a[2]){const g=.5*u;let p=d[0]-a[0]>g?-u:a[0]-d[0]>g?u:0;0===p&&(p=d[0]-a[2]>g?-u:a[2]-d[0]>g?u:0),d[0]+=p}Jp(o,d)}function ym(d,o,a,u){const g=Math.pow(2,u.z)*Xc,p=[u.x*Xc,u.y*Xc],y=[];if(!d)return y;for(const C of d)for(const S of C){const I=[S.x+p[0],S.y+p[1]];cn(I,o,a,g),y.push(I)}return y}function Rn(d,o,a,u){const g=Math.pow(2,u.z)*Xc,p=[u.x*Xc,u.y*Xc],y=[];if(!d)return y;for(const S of d){const I=[];for(const b of S){const D=[b.x+p[0],b.y+p[1]];Jp(o,D),I.push(D)}y.push(I)}if(o[2]-o[0]<=g/2){(C=o)[0]=C[1]=1/0,C[2]=C[3]=-1/0;for(const S of y)for(const I of S)cn(I,o,a,g)}var C;return y}class Kc{constructor(o,a){this.type=Ii,this.geojson=o,this.geometries=a}static parse(o,a){if(2!==o.length)return a.error(`'within' expression requires exactly one argument, but found ${o.length-1} instead.`);if(Ul(o[1])){const u=o[1];if("FeatureCollection"===u.type)for(let g=0;g<u.features.length;++g){const p=u.features[g].geometry.type;if("Polygon"===p||"MultiPolygon"===p)return new Kc(u,u.features[g].geometry)}else if("Feature"===u.type){const g=u.geometry.type;if("Polygon"===g||"MultiPolygon"===g)return new Kc(u,u.geometry)}else if("Polygon"===u.type||"MultiPolygon"===u.type)return new Kc(u,u)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(o){if(null!=o.geometry()&&null!=o.canonicalID()){if("Point"===o.geometryType())return function(a,u){const g=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],y=a.canonicalID();if(!y)return!1;if("Polygon"===u.type){const C=Hl(u.coordinates,p,y),S=ym(a.geometry(),g,p,y);if(!Lu(g,p))return!1;for(const I of S)if(!Zc(I,C))return!1}if("MultiPolygon"===u.type){const C=ei(u.coordinates,p,y),S=ym(a.geometry(),g,p,y);if(!Lu(g,p))return!1;for(const I of S)if(!wE(I,C))return!1}return!0}(o,this.geometries);if("LineString"===o.geometryType())return function(a,u){const g=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],y=a.canonicalID();if(!y)return!1;if("Polygon"===u.type){const C=Hl(u.coordinates,p,y),S=Rn(a.geometry(),g,p,y);if(!Lu(g,p))return!1;for(const I of S)if(!_m(I,C))return!1}if("MultiPolygon"===u.type){const C=ei(u.coordinates,p,y),S=Rn(a.geometry(),g,p,y);if(!Lu(g,p))return!1;for(const I of S)if(!xv(I,C))return!1}return!0}(o,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const gn={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Mn=1/298.257223563,te=Mn*(2-Mn),vc=Math.PI/180;class Wd{static fromTile(o,a,u){const g=Math.PI*(1-2*(o+.5)/Math.pow(2,a)),p=Math.atan(.5*(Math.exp(g)-Math.exp(-g)))/vc;return new Wd(p,u)}static get units(){return gn}constructor(o,a){if(void 0===o)throw new Error("No latitude given.");if(a&&!gn[a])throw new Error(`Unknown unit ${a}. Use one of: ${Object.keys(gn).join(", ")}`);const u=6378.137*vc*(a?gn[a]:1),g=Math.cos(o*vc),p=1/(1-te*(1-g*g)),y=Math.sqrt(p);this.kx=u*y*g,this.ky=u*y*p*(1-te)}distance(o,a){const u=Hr(o[0]-a[0])*this.kx,g=(o[1]-a[1])*this.ky;return Math.sqrt(u*u+g*g)}bearing(o,a){const u=Hr(a[0]-o[0])*this.kx;return Math.atan2(u,(a[1]-o[1])*this.ky)/vc}destination(o,a,u){const g=u*vc;return this.offset(o,Math.sin(g)*a,Math.cos(g)*a)}offset(o,a,u){return[o[0]+a/this.kx,o[1]+u/this.ky]}lineDistance(o){let a=0;for(let u=0;u<o.length-1;u++)a+=this.distance(o[u],o[u+1]);return a}area(o){let a=0;for(let u=0;u<o.length;u++){const g=o[u];for(let p=0,y=g.length,C=y-1;p<y;C=p++)a+=Hr(g[p][0]-g[C][0])*(g[p][1]+g[C][1])*(u?-1:1)}return Math.abs(a)/2*this.kx*this.ky}along(o,a){let u=0;if(a<=0)return o[0];for(let g=0;g<o.length-1;g++){const p=o[g],y=o[g+1],C=this.distance(p,y);if(u+=C,u>a)return jh(p,y,(a-(u-C))/C)}return o[o.length-1]}pointToSegmentDistance(o,a,u){let[g,p]=a,y=Hr(u[0]-g)*this.kx,C=(u[1]-p)*this.ky;if(0!==y||0!==C){const S=(Hr(o[0]-g)*this.kx*y+(o[1]-p)*this.ky*C)/(y*y+C*C);S>1?(g=u[0],p=u[1]):S>0&&(g+=y/this.kx*S,p+=C/this.ky*S)}return y=Hr(o[0]-g)*this.kx,C=(o[1]-p)*this.ky,Math.sqrt(y*y+C*C)}pointOnLine(o,a){let u=1/0,g=o[0][0],p=o[0][1],y=0,C=0;for(let S=0;S<o.length-1;S++){let I=o[S][0],b=o[S][1],D=Hr(o[S+1][0]-I)*this.kx,k=(o[S+1][1]-b)*this.ky,T=0;0===D&&0===k||(T=(Hr(a[0]-I)*this.kx*D+(a[1]-b)*this.ky*k)/(D*D+k*k),T>1?(I=o[S+1][0],b=o[S+1][1]):T>0&&(I+=D/this.kx*T,b+=k/this.ky*T)),D=Hr(a[0]-I)*this.kx,k=(a[1]-b)*this.ky;const A=D*D+k*k;A<u&&(u=A,g=I,p=b,y=S,C=T)}return{point:[g,p],index:y,t:Math.max(0,Math.min(1,C))}}lineSlice(o,a,u){let g=this.pointOnLine(u,o),p=this.pointOnLine(u,a);if(g.index>p.index||g.index===p.index&&g.t>p.t){const I=g;g=p,p=I}const y=[g.point],C=g.index+1,S=p.index;!zu(u[C],y[0])&&C<=S&&y.push(u[C]);for(let I=C+1;I<=S;I++)y.push(u[I]);return zu(u[S],p.point)||y.push(p.point),y}lineSliceAlong(o,a,u){let g=0;const p=[];for(let y=0;y<u.length-1;y++){const C=u[y],S=u[y+1],I=this.distance(C,S);if(g+=I,g>o&&0===p.length&&p.push(jh(C,S,(o-(g-I))/I)),g>=a)return p.push(jh(C,S,(a-(g-I))/I)),p;g>o&&p.push(S)}return p}bufferPoint(o,a){const u=a/this.ky,g=a/this.kx;return[o[0]-g,o[1]-u,o[0]+g,o[1]+u]}bufferBBox(o,a){const u=a/this.ky,g=a/this.kx;return[o[0]-g,o[1]-u,o[2]+g,o[3]+u]}insideBBox(o,a){return Hr(o[0]-a[0])>=0&&Hr(o[0]-a[2])<=0&&o[1]>=a[1]&&o[1]<=a[3]}}function zu(d,o){return d[0]===o[0]&&d[1]===o[1]}function jh(d,o,a){const u=Hr(o[0]-d[0]);return[d[0]+u*a,d[1]+(o[1]-d[1])*a]}function Hr(d){for(;d<-180;)d+=360;for(;d>180;)d-=360;return d}class ef{constructor(o=[],a=(u,g)=>u<g?-1:u>g?1:0){if(this.data=o,this.length=this.data.length,this.compare=a,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(o){this.data.push(o),this._up(this.length++)}pop(){if(0===this.length)return;const o=this.data[0],a=this.data.pop();return--this.length>0&&(this.data[0]=a,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:a,compare:u}=this,g=a[o];for(;o>0;){const p=o-1>>1,y=a[p];if(u(g,y)>=0)break;a[o]=y,o=p}a[o]=g}_down(o){const{data:a,compare:u}=this,g=this.length>>1,p=a[o];for(;o<g;){let y=1+(o<<1);const C=y+1;if(C<this.length&&u(a[C],a[y])<0&&(y=C),u(a[y],p)>=0)break;a[o]=a[y],o=y}a[o]=p}}var kt=8192;function La(d,o){return o.dist-d.dist}function wv(d){const o=[1/0,1/0,-1/0,-1/0];if(o.length!==d.length)return!1;for(let a=0;a<o.length;a++)if(o[a]!==d[a])return!1;return!0}function bc(d){return d[1]-d[0]+1}function Jc(d,o){const a=d[1]>=d[0]&&d[1]<o;return a||console.warn("Distance Expression: Index is out of range"),a}function Jo(d,o){if(d[0]>d[1])return[null,null];const a=bc(d);if(o){if(2===a)return[d,null];const u=Math.floor(a/2);return[[d[0],d[0]+u],[d[0]+u,d[1]]]}{if(1===a)return[d,null];const u=Math.floor(a/2)-1;return[[d[0],d[0]+u],[d[0]+u+1,d[1]]]}}function Na(d,o){const a=[1/0,1/0,-1/0,-1/0];if(!Jc(o,d.length))return a;for(let u=o[0];u<=o[1];++u)Jp(a,d[u]);return a}function Bu(d){const o=[1/0,1/0,-1/0,-1/0];for(let a=0;a<d.length;++a)for(let u=0;u<d[a].length;++u)Jp(o,d[a][u]);return o}function ed(d,o,a){if(wv(d)||wv(o))return NaN;let u=0,g=0;return d[2]<o[0]&&(u=o[0]-d[2]),d[0]>o[2]&&(u=d[0]-o[2]),d[1]>o[3]&&(g=d[1]-o[3]),d[3]<o[1]&&(g=o[1]-d[3]),a.distance([0,0],[u,g])}function vm(d){return 360*d-180}function Cv(d){return 360/Math.PI*Math.atan(Math.exp((180-360*d)*Math.PI/180))-90}function bm(d,o){const a=Math.pow(2,o.z),u=(d.y/kt+o.y)/a;return[vm((d.x/kt+o.x)/a),Cv(u)]}function pa(d,o){const a=[];for(let u=0;u<d.length;++u)a.push(bm(d[u],o));return a}function xm(d,o,a){const u=a.pointOnLine(o,d).point;return a.distance(d,u)}function Hh(d,o,a,u,g){const p=a.slice(u[0],u[1]+1);let y=1/0;for(let C=o[0];C<=o[1];++C)if(0===(y=Math.min(y,xm(d[C],p,g))))return 0;return y}function wm(d,o,a,u,g){const p=Math.min(g.pointToSegmentDistance(d,a,u),g.pointToSegmentDistance(o,a,u)),y=Math.min(g.pointToSegmentDistance(a,d,o),g.pointToSegmentDistance(u,d,o));return Math.min(p,y)}function $l(d,o,a,u,g){if(!Jc(o,d.length)||!Jc(u,a.length))return NaN;let p=1/0;for(let y=o[0];y<o[1];++y)for(let C=u[0];C<u[1];++C){if(Ds(d[y],d[y+1],a[C],a[C+1]))return 0;p=Math.min(p,wm(d[y],d[y+1],a[C],a[C+1],g))}return p}function or(d,o,a,u,g){if(!Jc(o,d.length)||!Jc(u,a.length))return NaN;let p=1/0;for(let y=o[0];y<=o[1];++y)for(let C=u[0];C<=u[1];++C)if(0===(p=Math.min(p,g.distance(d[y],a[C]))))return p;return p}function dl(d,o,a){if(Zc(d,o,!0))return 0;let u=1/0;for(const g of o){const p=g.length;if(p<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(g[0]!==g[p-1]&&0===(u=Math.min(u,a.pointToSegmentDistance(d,g[p-1],g[0])))||0===(u=Math.min(u,xm(d,g,a))))return u}return u}function Ev(d,o,a,u){if(!Jc(o,d.length))return NaN;for(let p=o[0];p<=o[1];++p)if(Zc(d[p],a,!0))return 0;let g=1/0;for(let p=o[0];p<o[1];++p)for(const y of a)for(let C=0,S=y.length,I=S-1;C<S;I=C++){if(Ds(d[p],d[p+1],y[I],y[C]))return 0;g=Math.min(g,wm(d[p],d[p+1],y[I],y[C],u))}return g}function $h(d,o){for(const a of d)for(let u=0;u<=a.length-1;++u)if(Zc(a[u],o,!0))return!0;return!1}function tf(d,o,a,u=1/0){const g=Bu(d),p=Bu(o);if(u!==1/0&&ed(g,p,a)>=u)return u;if(Lu(g,p)){if($h(d,o))return 0}else if($h(o,d))return 0;let y=u;for(const C of d)for(let S=0,I=C.length,b=I-1;S<I;b=S++)for(const D of o)for(let k=0,T=D.length,A=T-1;k<T;A=k++){if(Ds(C[b],C[S],D[A],D[k]))return 0;y=Math.min(y,wm(C[b],C[S],D[A],D[k],a))}return y}function Ms(d,o,a,u,g,p,y){if(null===p||null===y)return;const C=ed(Na(u,p),Na(g,y),a);C<o&&d.push({dist:C,range1:p,range2:y})}function bi(d,o,a,u,g=1/0){let p=Math.min(u.distance(d[0],a[0][0]),g);if(0===p)return p;const y=new ef([{dist:0,range1:[0,d.length-1],range2:[0,0]}],La),C=o?50:100,S=Bu(a);for(;y.length;){const I=y.pop();if(I.dist>=p)continue;const b=I.range1;if(bc(b)<=C){if(!Jc(b,d.length))return NaN;if(o){const D=Ev(d,b,a,u);if(0===(p=Math.min(p,D)))return p}else for(let D=b[0];D<=b[1];++D){const k=dl(d[D],a,u);if(0===(p=Math.min(p,k)))return p}}else{const D=Jo(b,o);if(null!==D[0]){const k=ed(Na(d,D[0]),S,u);k<p&&y.push({dist:k,range1:D[0],range2:[0,0]})}if(null!==D[1]){const k=ed(Na(d,D[1]),S,u);k<p&&y.push({dist:k,range1:D[1],range2:[0,0]})}}}return p}function es(d,o,a,u,g,p=1/0){let y=Math.min(p,g.distance(d[0],a[0]));if(0===y)return y;const C=new ef([{dist:0,range1:[0,d.length-1],range2:[0,a.length-1]}],La),S=o?50:100,I=u?50:100;for(;C.length;){const b=C.pop();if(b.dist>=y)continue;const D=b.range1,k=b.range2;if(bc(D)<=S&&bc(k)<=I){if(!Jc(D,d.length)||!Jc(k,a.length))return NaN;if(o&&u?y=Math.min(y,$l(d,D,a,k,g)):o||u?o&&!u?y=Math.min(y,Hh(a,k,d,D,g)):!o&&u&&(y=Math.min(y,Hh(d,D,a,k,g))):y=Math.min(y,or(d,D,a,k,g)),0===y)return y}else{const T=Jo(D,o),A=Jo(k,u);Ms(C,y,g,d,a,T[0],A[0]),Ms(C,y,g,d,a,T[0],A[1]),Ms(C,y,g,d,a,T[1],A[0]),Ms(C,y,g,d,a,T[1],A[1])}}return y}function zs(d,o,a,u,g=1/0){let p=g;const y=Na(d,[0,d.length-1]);for(const C of a)if(!(p!==1/0&&ed(y,Na(C,[0,C.length-1]),u)>=p)&&(p=Math.min(p,es(d,o,C,!0,u,p)),0===p))return p;return p}function Gl(d,o,a,u,g=1/0){let p=g;const y=Na(d,[0,d.length-1]);for(const C of a){if(p!==1/0&&ed(y,Bu(C),u)>=p)continue;const S=bi(d,o,C,u,p);if(isNaN(S))return S;if(0===(p=Math.min(p,S)))return p}return p}function ul(d){return"Point"===d||"MultiPoint"===d||"LineString"===d||"MultiLineString"===d||"Polygon"===d||"MultiPolygon"===d}class Vu{constructor(o,a){this.type=rn,this.geojson=o,this.geometries=a}static parse(o,a){if(2!==o.length)return a.error(`'distance' expression requires either one argument, but found ' ${o.length-1} instead.`);if(Ul(o[1])){const u=o[1];if("FeatureCollection"===u.type){for(let g=0;g<u.features.length;++g)if(ul(u.features[g].geometry.type))return new Vu(u,u.features[g].geometry)}else if("Feature"===u.type){if(ul(u.geometry.type))return new Vu(u,u.geometry)}else if(ul(u.type))return new Vu(u,u)}return a.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(o){const a=o.geometry(),u=o.canonicalID();if(null!=a&&null!=u){if("Point"===o.geometryType())return function(g,p,y){const C=[];for(const I of g)for(const b of I)C.push(bm(b,p));const S=new Wd(C[0][1],"meters");return"Point"===y.type||"MultiPoint"===y.type||"LineString"===y.type?es(C,!1,"Point"===y.type?[y.coordinates]:y.coordinates,"LineString"===y.type,S):"MultiLineString"===y.type?zs(C,!1,y.coordinates,S):"Polygon"===y.type||"MultiPolygon"===y.type?Gl(C,!1,"Polygon"===y.type?[y.coordinates]:y.coordinates,S):null}(a,u,this.geometries);if("LineString"===o.geometryType())return function(g,p,y){const C=[];for(const I of g){const b=[];for(const D of I)b.push(bm(D,p));C.push(b)}const S=new Wd(C[0][0][1],"meters");if("Point"===y.type||"MultiPoint"===y.type||"LineString"===y.type)return zs("Point"===y.type?[y.coordinates]:y.coordinates,"LineString"===y.type,C,S);if("MultiLineString"===y.type){let I=1/0;for(let b=0;b<y.coordinates.length;b++){const D=zs(y.coordinates[b],!0,C,S,I);if(isNaN(D))return D;if(0===(I=Math.min(I,D)))return I}return I}if("Polygon"===y.type||"MultiPolygon"===y.type){let I=1/0;for(let b=0;b<C.length;b++){const D=Gl(C[b],!0,"Polygon"===y.type?[y.coordinates]:y.coordinates,S,I);if(isNaN(D))return D;if(0===(I=Math.min(I,D)))return I}return I}return null}(a,u,this.geometries);if("Polygon"===o.geometryType())return function(g,p,y){const C=[];for(const I of function(b){const k=b.length;if(k<=1)return[b];const T=[];let A,O;for(let B=0;B<k;B++){const V=xE(b[B]);0!==V&&(b[B].area=Math.abs(V),void 0===O&&(O=V<0),O===V<0?(A&&T.push(A),A=[b[B]]):A.push(b[B]))}return A&&T.push(A),T}(g)){const b=[];for(let D=0;D<I.length;++D)b.push(pa(I[D],p));C.push(b)}const S=new Wd(C[0][0][0][1],"meters");if("Point"===y.type||"MultiPoint"===y.type||"LineString"===y.type)return Gl("Point"===y.type?[y.coordinates]:y.coordinates,"LineString"===y.type,C,S);if("MultiLineString"===y.type){let I=1/0;for(let b=0;b<y.coordinates.length;b++){const D=Gl(y.coordinates[b],!0,C,S,I);if(isNaN(D))return D;if(0===(I=Math.min(I,D)))return I}return I}return"Polygon"===y.type||"MultiPolygon"===y.type?function(I,b,D){let k=1/0;for(const T of I)for(const A of b){const O=tf(T,A,D,k);if(isNaN(O))return O;if(0===(k=Math.min(k,O)))return k}return k}("Polygon"===y.type?[y.coordinates]:y.coordinates,C,S):null}(a,u,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Cm(d,o){switch(d){case"string":return Qo(o);case"number":return+o;case"boolean":return!!o;case"color":return Yi.parse(o);case"formatted":return Ko.fromString(Qo(o));case"resolvedImage":return ds.build(Qo(o))}return o}function nf(d,o,a,u){return void 0!==u&&(d=u*Math.round(d/u)),void 0!==o&&d<o&&(d=o),void 0!==a&&d>a&&(d=a),d}class Yd{constructor(o,a,u){this.type=o,this.key=a,this.scope=u}static parse(o,a){let u=a.expectedType;if(null==u&&(u=Ni),o.length<2||o.length>3)return a.error("Invalid number of arguments for 'config' expression.");const g=a.parse(o[1],1);if(!(g instanceof Hd))return a.error("Key name of 'config' expression must be a string literal.");if(o.length>=3){const p=a.parse(o[2],2);return p instanceof Hd?new Yd(u,Qo(g.value),Qo(p.value)):a.error("Scope of 'config' expression must be a string literal.")}return new Yd(u,Qo(g.value))}evaluate(o){const a=[this.key,this.scope,o.scope].filter(Boolean).join("\x1f"),u=o.getConfig(a);if(!u)return null;const{type:g,value:p,values:y,minValue:C,maxValue:S,stepValue:I}=u,b=u.default.evaluate(o);let D=b;if(p){const k=o.scope;o.scope=(k||"").split("\x1f").slice(1).join("\x1f"),D=p.evaluate(o),o.scope=k}return g&&(D=Cm(g,D)),void 0===D||void 0===C&&void 0===S&&void 0===I||("number"==typeof D?D=nf(D,C,S,I):Array.isArray(D)&&(D=D.map(k=>"number"==typeof k?nf(k,C,S,I):k))),void 0!==p&&void 0!==D&&y&&!y.includes(D)&&(D=b,g&&(D=Cm(g,D))),(g&&g!==this.type||void 0!==D&&Yr(D)!==this.type)&&(D=Cm(this.type.kind,D)),D}eachChild(){}outputDefined(){return!1}serialize(){const o=["config",this.key];return this.scope&&o.concat(this.key),o}}function td(d){if(d instanceof Ss&&("get"===d.name&&1===d.args.length||"feature-state"===d.name||"has"===d.name&&1===d.args.length||"properties"===d.name||"geometry-type"===d.name||"id"===d.name||/^filter-/.test(d.name))||d instanceof Kc||d instanceof Vu)return!1;let o=!0;return d.eachChild(a=>{o&&!td(a)&&(o=!1)}),o}function Em(d){if(d instanceof Ss&&"feature-state"===d.name)return!1;let o=!0;return d.eachChild(a=>{o&&!Em(a)&&(o=!1)}),o}function Uu(d){if(d instanceof Yd)return new Set([d.key]);let o=new Set;return d.eachChild(a=>{o=new Set([...o,...Uu(a)])}),o}function nd(d,o){if(d instanceof Ss&&o.indexOf(d.name)>=0)return!1;let a=!0;return d.eachChild(u=>{a&&!nd(u,o)&&(a=!1)}),a}class id{constructor(o,a){this.type=a.type,this.name=o,this.boundExpression=a}static parse(o,a){if(2!==o.length||"string"!=typeof o[1])return a.error("'var' expression requires exactly one string literal argument.");const u=o[1];return a.scope.has(u)?new id(u,a.scope.get(u)):a.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(o){return this.boundExpression.evaluate(o)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class ju{constructor(o,a=[],u,g=new ni,p=[],y,C){this.registry=o,this.path=a,this.key=a.map(S=>"string"==typeof S?`['${S}']`:`[${S}]`).join(""),this.scope=g,this.errors=p,this.expectedType=u,this._scope=y,this.options=C}parse(o,a,u,g,p={}){return a||u?this.concat(a,null,u,g)._parse(o,p):this._parse(o,p)}parseObjectValue(o,a,u,g,p,y={}){return this.concat(a,u,g,p)._parse(o,y)}_parse(o,a){function u(g,p,y){return"assert"===y?new cl(p,[g]):"coerce"===y?new yc(p,[g]):g}if(null!==o&&"string"!=typeof o&&"boolean"!=typeof o&&"number"!=typeof o||(o=["literal",o]),Array.isArray(o)){if(0===o.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g="string"==typeof o[0]?this.registry[o[0]]:void 0;if(g){let p=g.parse(o,this);if(!p)return null;if(this.expectedType){const y=this.expectedType,C=p.type;if("string"!==y.kind&&"number"!==y.kind&&"boolean"!==y.kind&&"object"!==y.kind&&"array"!==y.kind||"value"!==C.kind)if("color"!==y.kind&&"formatted"!==y.kind&&"resolvedImage"!==y.kind||"value"!==C.kind&&"string"!==C.kind){if(this.checkSubtype(y,C))return null}else p=u(p,y,a.typeAnnotation||"coerce");else p=u(p,y,a.typeAnnotation||"assert")}if(!(p instanceof Hd)&&"resolvedImage"!==p.type.kind&&xc(p)){const y=new Gd(this._scope,this.options);try{p=new Hd(p.type,p.evaluate(y))}catch(C){return this.error(C.message),null}}return p}return yc.parse(["to-array",o],this)}return this.error(void 0===o?"'undefined' value invalid. Use null instead.":"object"==typeof o?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof o} instead.`)}concat(o,a,u,g){let p="number"==typeof o?this.path.concat(o):this.path;p="string"==typeof a?p.concat(a):p;const y=g?this.scope.concat(g):this.scope;return new ju(this.registry,p,u||null,y,this.errors,this._scope,this.options)}error(o,...a){const u=`${this.key}${a.map(g=>`[${g}]`).join("")}`;this.errors.push(new to(u,o))}checkSubtype(o,a){const u=Wc(o,a);return u&&this.error(u),u}}var Sm=ju;function xc(d){if(d instanceof id)return xc(d.boundExpression);if(d instanceof Ss&&"error"===d.name||d instanceof cr||d instanceof Kc||d instanceof Vu||d instanceof Yd)return!1;const o=d instanceof yc||d instanceof cl;let a=!0;return d.eachChild(u=>{a=o?a&&xc(u):a&&u instanceof Hd}),!!a&&td(d)&&nd(d,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function rf(d,o){const a=d.length-1;let u,g,p=0,y=a,C=0;for(;p<=y;)if(C=Math.floor((p+y)/2),u=d[C],g=d[C+1],u<=o){if(C===a||o<g)return C;p=C+1}else{if(!(u>o))throw new so("Input is not a number.");y=C-1}return 0}class hl{constructor(o,a,u){this.type=o,this.input=a,this.labels=[],this.outputs=[];for(const[g,p]of u)this.labels.push(g),this.outputs.push(p)}static parse(o,a){if(o.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return a.error("Expected an even number of arguments.");const u=a.parse(o[1],1,rn);if(!u)return null;const g=[];let p=null;a.expectedType&&"value"!==a.expectedType.kind&&(p=a.expectedType);for(let y=1;y<o.length;y+=2){const C=1===y?-1/0:o[y],S=o[y+1],I=y,b=y+1;if("number"!=typeof C)return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(g.length&&g[g.length-1][0]>=C)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',I);const D=a.parse(S,b,p);if(!D)return null;p=p||D.type,g.push([C,D])}return new hl(p,u,g)}evaluate(o){const a=this.labels,u=this.outputs;if(1===a.length)return u[0].evaluate(o);const g=this.input.evaluate(o);if(g<=a[0])return u[0].evaluate(o);const p=a.length;return g>=a[p-1]?u[p-1].evaluate(o):u[rf(a,g)].evaluate(o)}eachChild(o){o(this.input);for(const a of this.outputs)o(a)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){const o=["step",this.input.serialize()];for(let a=0;a<this.labels.length;a++)a>0&&o.push(this.labels[a]),o.push(this.outputs[a].serialize());return o}}const Dm=4/29,rd=6/29,Lo=3*rd*rd,Hu=rd*rd*rd,_r=Math.PI/180,bx=180/Math.PI;function i_(d){return d>Hu?Math.pow(d,1/3):d/Lo+Dm}function Mm(d){return d>rd?d*d*d:Lo*(d-Dm)}function $u(d){return 255*(d<=.0031308?12.92*d:1.055*Math.pow(d,1/2.4)-.055)}function Zd(d){return(d/=255)<=.04045?d/12.92:Math.pow((d+.055)/1.055,2.4)}function Sv(d){const o=Zd(d.r),a=Zd(d.g),u=Zd(d.b),g=i_((.4124564*o+.3575761*a+.1804375*u)/.95047),p=i_((.2126729*o+.7151522*a+.072175*u)/1);return{l:116*p-16,a:500*(g-p),b:200*(p-i_((.0193339*o+.119192*a+.9503041*u)/1.08883)),alpha:d.a}}function Dv(d){let o=(d.l+16)/116,a=isNaN(d.a)?o:o+d.a/500,u=isNaN(d.b)?o:o-d.b/200;return o=1*Mm(o),a=.95047*Mm(a),u=1.08883*Mm(u),new Yi($u(3.2404542*a-1.5371385*o-.4985314*u),$u(-.969266*a+1.8760108*o+.041556*u),$u(.0556434*a-.2040259*o+1.0572252*u),d.alpha)}function xx(d,o,a){const u=o-d;return d+a*(u>180||u<-180?u-360*Math.round(u/360):u)}const Gu={forward:Sv,reverse:Dv,interpolate:function(d,o,a){return{l:_n(d.l,o.l,a),a:_n(d.a,o.a,a),b:_n(d.b,o.b,a),alpha:_n(d.alpha,o.alpha,a)}}},Bs={forward:function(d){const{l:o,a,b:u}=Sv(d),g=Math.atan2(u,a)*bx;return{h:g<0?g+360:g,c:Math.sqrt(a*a+u*u),l:o,alpha:d.a}},reverse:function(d){const o=d.h*_r,a=d.c;return Dv({l:d.l,a:Math.cos(o)*a,b:Math.sin(o)*a,alpha:d.alpha})},interpolate:function(d,o,a){return{h:xx(d.h,o.h,a),c:_n(d.c,o.c,a),l:_n(d.l,o.l,a),alpha:_n(d.alpha,o.alpha,a)}}};var r_=Object.freeze({__proto__:null,hcl:Bs,lab:Gu});class us{constructor(o,a,u,g,p){this.type=o,this.operator=a,this.interpolation=u,this.input=g,this.labels=[],this.outputs=[];for(const[y,C]of p)this.labels.push(y),this.outputs.push(C)}static interpolationFactor(o,a,u,g){let p=0;if("exponential"===o.name)p=Xd(a,o.base,u,g);else if("linear"===o.name)p=Xd(a,1,u,g);else if("cubic-bezier"===o.name){const y=o.controlPoints;p=new fc(y[0],y[1],y[2],y[3]).solve(Xd(a,1,u,g))}return p}static parse(o,a){let[u,g,p,...y]=o;if(!Array.isArray(g)||0===g.length)return a.error("Expected an interpolation type expression.",1);if("linear"===g[0])g={name:"linear"};else if("exponential"===g[0]){const I=g[1];if("number"!=typeof I)return a.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:I}}else{if("cubic-bezier"!==g[0])return a.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const I=g.slice(1);if(4!==I.length||I.some(b=>"number"!=typeof b||b<0||b>1))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:I}}}if(o.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length-1>3&&(o.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(p=a.parse(p,2,rn),!p)return null;const C=[];let S=null;"interpolate-hcl"===u||"interpolate-lab"===u?S=Ns:a.expectedType&&"value"!==a.expectedType.kind&&(S=a.expectedType);for(let I=0;I<y.length;I+=2){const b=y[I],D=y[I+1],k=I+3,T=I+4;if("number"!=typeof b)return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(C.length&&C[C.length-1][0]>=b)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',k);const A=a.parse(D,T,S);if(!A)return null;S=S||A.type,C.push([b,A])}return"number"===S.kind||"color"===S.kind||"array"===S.kind&&"number"===S.itemType.kind&&"number"==typeof S.N?new us(S,u,g,p,C):a.error(`Type ${Wr(S)} is not interpolatable.`)}evaluate(o){const a=this.labels,u=this.outputs;if(1===a.length)return u[0].evaluate(o);const g=this.input.evaluate(o);if(g<=a[0])return u[0].evaluate(o);const p=a.length;if(g>=a[p-1])return u[p-1].evaluate(o);const y=rf(a,g),C=us.interpolationFactor(this.interpolation,g,a[y],a[y+1]),S=u[y].evaluate(o),I=u[y+1].evaluate(o);return"interpolate"===this.operator?mm[this.type.kind.toLowerCase()](S,I,C):"interpolate-hcl"===this.operator?Bs.reverse(Bs.interpolate(Bs.forward(S),Bs.forward(I),C)):Gu.reverse(Gu.interpolate(Gu.forward(S),Gu.forward(I),C))}eachChild(o){o(this.input);for(const a of this.outputs)o(a)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){let o;o="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const a=[this.operator,o,this.input.serialize()];for(let u=0;u<this.labels.length;u++)a.push(this.labels[u],this.outputs[u].serialize());return a}}function Xd(d,o,a,u){const g=u-a,p=d-a;return 0===g?0:1===o?p/g:(Math.pow(o,p)-1)/(Math.pow(o,g)-1)}class Tm{constructor(o,a){this.type=o,this.args=a}static parse(o,a){if(o.length<2)return a.error("Expectected at least one argument.");let u=null;const g=a.expectedType;g&&"value"!==g.kind&&(u=g);const p=[];for(const C of o.slice(1)){const S=a.parse(C,1+p.length,u,void 0,{typeAnnotation:"omit"});if(!S)return null;u=u||S.type,p.push(S)}const y=g&&p.some(C=>Wc(g,C.type));return new Tm(y?Ni:u,p)}evaluate(o){let a,u=null,g=0;for(const p of this.args){if(g++,u=p.evaluate(o),u&&u instanceof ds&&!u.available&&(a||(a=u),u=null,g===this.args.length))return a;if(null!==u)break}return u}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=["coalesce"];return this.eachChild(a=>{o.push(a.serialize())}),o}}class Im{constructor(o,a){this.type=a.type,this.bindings=[].concat(o),this.result=a}evaluate(o){return this.result.evaluate(o)}eachChild(o){for(const a of this.bindings)o(a[1]);o(this.result)}static parse(o,a){if(o.length<4)return a.error(`Expected at least 3 arguments, but found ${o.length-1} instead.`);const u=[];for(let p=1;p<o.length-1;p+=2){const y=o[p];if("string"!=typeof y)return a.error(`Expected string, but found ${typeof y} instead.`,p);if(/[^a-zA-Z0-9_]/.test(y))return a.error("Variable names must contain only alphanumeric characters or '_'.",p);const C=a.parse(o[p+1],p+1);if(!C)return null;u.push([y,C])}const g=a.parse(o[o.length-1],o.length-1,a.expectedType,u);return g?new Im(u,g):null}outputDefined(){return this.result.outputDefined()}serialize(){const o=["let"];for(const[a,u]of this.bindings)o.push(a,u.serialize());return o.push(this.result.serialize()),o}}class Io{constructor(o,a,u){this.type=o,this.index=a,this.input=u}static parse(o,a){if(3!==o.length)return a.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const u=a.parse(o[1],1,rn),g=a.parse(o[2],2,Xo(a.expectedType||Ni));return u&&g?new Io(g.type.itemType,u,g):null}evaluate(o){const a=this.index.evaluate(o),u=this.input.evaluate(o);if(a<0)throw new so(`Array index out of bounds: ${a} < 0.`);if(a>=u.length)throw new so(`Array index out of bounds: ${a} > ${u.length-1}.`);if(a!==Math.floor(a))throw new so(`Array index must be an integer, but found ${a} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return u[a]}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Am{constructor(o,a,u){this.type=o,this.index=a,this.input=u}static parse(o,a){if(3!==o.length)return a.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const u=a.parse(o[1],1,rn),g=a.parse(o[2],2,Xo(a.expectedType||Ni));return u&&g?new Am(g.type.itemType,u,g):null}evaluate(o){const a=this.index.evaluate(o),u=this.input.evaluate(o);if(a<0)throw new so(`Array index out of bounds: ${a} < 0.`);if(a>u.length-1)throw new so(`Array index out of bounds: ${a} > ${u.length-1}.`);if(a===Math.floor(a))return u[a];const g=Math.floor(a),p=Math.ceil(a),y=u[g],C=u[p];if("number"!=typeof y||"number"!=typeof C)throw new so(`Cannot interpolate between non-number values at index ${a}.`);const S=a-g;return y*(1-S)+C*S}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class o_{constructor(o,a){this.type=Ii,this.needle=o,this.haystack=a}static parse(o,a){if(3!==o.length)return a.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const u=a.parse(o[1],1,Ni),g=a.parse(o[2],2,Ni);return u&&g?Kp(u.type,[Ii,Hi,rn,Xp,Ni])?new o_(u,g):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${Wr(u.type)} instead`):null}evaluate(o){const a=this.needle.evaluate(o),u=this.haystack.evaluate(o);if(null==u)return!1;if(!Ou(a,["boolean","string","number","null"]))throw new so(`Expected first argument to be of type boolean, string, number or null, but found ${Wr(Yr(a))} instead.`);if(!Ou(u,["string","array"]))throw new so(`Expected second argument to be of type array or string, but found ${Wr(Yr(u))} instead.`);return u.indexOf(a)>=0}eachChild(o){o(this.needle),o(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Kd{constructor(o,a,u){this.type=rn,this.needle=o,this.haystack=a,this.fromIndex=u}static parse(o,a){if(o.length<=2||o.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const u=a.parse(o[1],1,Ni),g=a.parse(o[2],2,Ni);if(!u||!g)return null;if(!Kp(u.type,[Ii,Hi,rn,Xp,Ni]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${Wr(u.type)} instead`);if(4===o.length){const p=a.parse(o[3],3,rn);return p?new Kd(u,g,p):null}return new Kd(u,g)}evaluate(o){const a=this.needle.evaluate(o),u=this.haystack.evaluate(o);if(!Ou(a,["boolean","string","number","null"]))throw new so(`Expected first argument to be of type boolean, string, number or null, but found ${Wr(Yr(a))} instead.`);if(!Ou(u,["string","array"]))throw new so(`Expected second argument to be of type array or string, but found ${Wr(Yr(u))} instead.`);if(this.fromIndex){const g=this.fromIndex.evaluate(o);return u.indexOf(a,g)}return u.indexOf(a)}eachChild(o){o(this.needle),o(this.haystack),this.fromIndex&&o(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const o=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),o]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class s_{constructor(o,a,u,g,p,y){this.inputType=o,this.type=a,this.input=u,this.cases=g,this.outputs=p,this.otherwise=y}static parse(o,a){if(o.length<5)return a.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length%2!=1)return a.error("Expected an even number of arguments.");let u,g;a.expectedType&&"value"!==a.expectedType.kind&&(g=a.expectedType);const p={},y=[];for(let I=2;I<o.length-1;I+=2){let b=o[I];const D=o[I+1];Array.isArray(b)||(b=[b]);const k=a.concat(I);if(0===b.length)return k.error("Expected at least one branch label.");for(const A of b){if("number"!=typeof A&&"string"!=typeof A)return k.error("Branch labels must be numbers or strings.");if("number"==typeof A&&Math.abs(A)>Number.MAX_SAFE_INTEGER)return k.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof A&&Math.floor(A)!==A)return k.error("Numeric branch labels must be integer values.");if(u){if(k.checkSubtype(u,Yr(A)))return null}else u=Yr(A);if(void 0!==p[String(A)])return k.error("Branch labels must be unique.");p[String(A)]=y.length}const T=a.parse(D,I,g);if(!T)return null;g=g||T.type,y.push(T)}const C=a.parse(o[1],1,Ni);if(!C)return null;const S=a.parse(o[o.length-1],o.length-1,g);return S?"value"!==C.type.kind&&a.concat(1).checkSubtype(u,C.type)?null:new s_(u,g,C,p,y,S):null}evaluate(o){const a=this.input.evaluate(o);return(Yr(a)===this.inputType&&this.outputs[this.cases[a]]||this.otherwise).evaluate(o)}eachChild(o){o(this.input),this.outputs.forEach(o),o(this.otherwise)}outputDefined(){return this.outputs.every(o=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["match",this.input.serialize()],a=Object.keys(this.cases).sort(),u=[],g={};for(const y of a){const C=g[this.cases[y]];void 0===C?(g[this.cases[y]]=u.length,u.push([this.cases[y],[y]])):u[C][1].push(y)}const p=y=>"number"===this.inputType.kind?Number(y):y;for(const[y,C]of u)o.push(1===C.length?p(C[0]):C.map(p)),o.push(this.outputs[y].serialize());return o.push(this.otherwise.serialize()),o}}class a_{constructor(o,a,u){this.type=o,this.branches=a,this.otherwise=u}static parse(o,a){if(o.length<4)return a.error(`Expected at least 3 arguments, but found only ${o.length-1}.`);if(o.length%2!=0)return a.error("Expected an odd number of arguments.");let u;a.expectedType&&"value"!==a.expectedType.kind&&(u=a.expectedType);const g=[];for(let y=1;y<o.length-1;y+=2){const C=a.parse(o[y],y,Ii);if(!C)return null;const S=a.parse(o[y+1],y+1,u);if(!S)return null;g.push([C,S]),u=u||S.type}const p=a.parse(o[o.length-1],o.length-1,u);return p?new a_(u,g,p):null}evaluate(o){for(const[a,u]of this.branches)if(a.evaluate(o))return u.evaluate(o);return this.otherwise.evaluate(o)}eachChild(o){for(const[a,u]of this.branches)o(a),o(u);o(this.otherwise)}outputDefined(){return this.branches.every(([o,a])=>a.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["case"];return this.eachChild(a=>{o.push(a.serialize())}),o}}class km{constructor(o,a,u,g){this.type=o,this.input=a,this.beginIndex=u,this.endIndex=g}static parse(o,a){if(o.length<=2||o.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const u=a.parse(o[1],1,Ni),g=a.parse(o[2],2,rn);if(!u||!g)return null;if(!Kp(u.type,[Xo(Ni),Hi,Ni]))return a.error(`Expected first argument to be of type array or string, but found ${Wr(u.type)} instead`);if(4===o.length){const p=a.parse(o[3],3,rn);return p?new km(u.type,u,g,p):null}return new km(u.type,u,g)}evaluate(o){const a=this.input.evaluate(o),u=this.beginIndex.evaluate(o);if(!Ou(a,["string","array"]))throw new so(`Expected first argument to be of type array or string, but found ${Wr(Yr(a))} instead.`);if(this.endIndex){const g=this.endIndex.evaluate(o);return a.slice(u,g)}return a.slice(u)}eachChild(o){o(this.input),o(this.beginIndex),this.endIndex&&o(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const o=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),o]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Mv(d,o){return"=="===d||"!="===d?"boolean"===o.kind||"string"===o.kind||"number"===o.kind||"null"===o.kind||"value"===o.kind:"string"===o.kind||"number"===o.kind||"value"===o.kind}function Tv(d,o,a,u){return 0===u.compare(o,a)}function Gh(d,o,a){const u="=="!==d&&"!="!==d;return class ej{constructor(p,y,C){this.type=Ii,this.lhs=p,this.rhs=y,this.collator=C,this.hasUntypedArgument="value"===p.type.kind||"value"===y.type.kind}static parse(p,y){if(3!==p.length&&4!==p.length)return y.error("Expected two or three arguments.");const C=p[0];let S=y.parse(p[1],1,Ni);if(!S)return null;if(!Mv(C,S.type))return y.concat(1).error(`"${C}" comparisons are not supported for type '${Wr(S.type)}'.`);let I=y.parse(p[2],2,Ni);if(!I)return null;if(!Mv(C,I.type))return y.concat(2).error(`"${C}" comparisons are not supported for type '${Wr(I.type)}'.`);if(S.type.kind!==I.type.kind&&"value"!==S.type.kind&&"value"!==I.type.kind)return y.error(`Cannot compare types '${Wr(S.type)}' and '${Wr(I.type)}'.`);u&&("value"===S.type.kind&&"value"!==I.type.kind?S=new cl(I.type,[S]):"value"!==S.type.kind&&"value"===I.type.kind&&(I=new cl(S.type,[I])));let b=null;if(4===p.length){if("string"!==S.type.kind&&"string"!==I.type.kind&&"value"!==S.type.kind&&"value"!==I.type.kind)return y.error("Cannot use collator to compare non-string types.");if(b=y.parse(p[3],3,Ai),!b)return null}return new ej(S,I,b)}evaluate(p){const y=this.lhs.evaluate(p),C=this.rhs.evaluate(p);if(u&&this.hasUntypedArgument){const S=Yr(y),I=Yr(C);if(S.kind!==I.kind||"string"!==S.kind&&"number"!==S.kind)throw new so(`Expected arguments for "${d}" to be (string, string) or (number, number), but found (${S.kind}, ${I.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const S=Yr(y),I=Yr(C);if("string"!==S.kind||"string"!==I.kind)return o(p,y,C)}return this.collator?a(p,y,C,this.collator.evaluate(p)):o(p,y,C)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}serialize(){const p=[d];return this.eachChild(y=>{p.push(y.serialize())}),p}}}const l_=Gh("==",function(d,o,a){return o===a},Tv),Rm=Gh("!=",function(d,o,a){return o!==a},function(d,o,a,u){return!Tv(0,o,a,u)}),Nr=Gh("<",function(d,o,a){return o<a},function(d,o,a,u){return u.compare(o,a)<0}),nn=Gh(">",function(d,o,a){return o>a},function(d,o,a,u){return u.compare(o,a)>0}),mi=Gh("<=",function(d,o,a){return o<=a},function(d,o,a,u){return u.compare(o,a)<=0}),fo=Gh(">=",function(d,o,a){return o>=a},function(d,o,a,u){return u.compare(o,a)>=0});class No{constructor(o,a,u,g,p,y){this.type=Hi,this.number=o,this.locale=a,this.currency=u,this.unit=g,this.minFractionDigits=p,this.maxFractionDigits=y}static parse(o,a){if(3!==o.length)return a.error("Expected two arguments.");const u=a.parse(o[1],1,rn);if(!u)return null;const g=o[2];if("object"!=typeof g||Array.isArray(g))return a.error("NumberFormat options argument must be an object.");let p=null;if(g.locale&&(p=a.parseObjectValue(g.locale,2,"locale",Hi),!p))return null;let y=null;if(g.currency&&(y=a.parseObjectValue(g.currency,2,"currency",Hi),!y))return null;let C=null;if(g.unit&&(C=a.parseObjectValue(g.unit,2,"unit",Hi),!C))return null;let S=null;if(g["min-fraction-digits"]&&(S=a.parseObjectValue(g["min-fraction-digits"],2,"min-fraction-digits",rn),!S))return null;let I=null;return g["max-fraction-digits"]&&(I=a.parseObjectValue(g["max-fraction-digits"],2,"max-fraction-digits",rn),!I)?null:new No(u,p,y,C,S,I)}evaluate(o){return new Intl.NumberFormat(this.locale?this.locale.evaluate(o):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(o):void 0,unit:this.unit?this.unit.evaluate(o):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(o):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(o):void 0}).format(this.number.evaluate(o))}eachChild(o){o(this.number),this.locale&&o(this.locale),this.currency&&o(this.currency),this.unit&&o(this.unit),this.minFractionDigits&&o(this.minFractionDigits),this.maxFractionDigits&&o(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const o={};return this.locale&&(o.locale=this.locale.serialize()),this.currency&&(o.currency=this.currency.serialize()),this.unit&&(o.unit=this.unit.serialize()),this.minFractionDigits&&(o["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(o["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),o]}}class zo{constructor(o){this.type=rn,this.input=o}static parse(o,a){if(2!==o.length)return a.error(`Expected 1 argument, but found ${o.length-1} instead.`);const u=a.parse(o[1],1);return u?"array"!==u.type.kind&&"string"!==u.type.kind&&"value"!==u.type.kind?a.error(`Expected argument of type string or array, but found ${Wr(u.type)} instead.`):new zo(u):null}evaluate(o){const a=this.input.evaluate(o);if("string"==typeof a||Array.isArray(a))return a.length;throw new so(`Expected value to be of type string or array, but found ${Wr(Yr(a))} instead.`)}eachChild(o){o(this.input)}outputDefined(){return!1}serialize(){const o=["length"];return this.eachChild(a=>{o.push(a.serialize())}),o}}function Ts(d){return function(){d=1831565813+(d|=0)|0;let o=Math.imul(d^d>>>15,1|d);return o=o+Math.imul(o^o>>>7,61|o)^o,((o^o>>>14)>>>0)/4294967296}}const ql={"==":l_,"!=":Rm,">":nn,"<":Nr,">=":fo,"<=":mi,array:cl,at:Io,"at-interpolated":Am,boolean:cl,case:a_,coalesce:Tm,collator:cr,format:$d,image:Fa,in:o_,"index-of":Kd,interpolate:us,"interpolate-hcl":us,"interpolate-lab":us,length:zo,let:Im,literal:Hd,match:s_,number:cl,"number-format":No,object:cl,slice:km,step:hl,string:cl,"to-boolean":yc,"to-color":yc,"to-number":yc,"to-string":yc,var:id,within:Kc,distance:Vu,config:Yd};function Ar(d,[o,a,u,g]){o=o.evaluate(d),a=a.evaluate(d),u=u.evaluate(d);const p=g?g.evaluate(d):1,y=Fu(o,a,u,p);if(y)throw new so(y);return new Yi(o/255*p,a/255*p,u/255*p,p)}function mo(d,[o,a,u,g]){o=o.evaluate(d),a=a.evaluate(d),u=u.evaluate(d);const p=g?g.evaluate(d):1,y=(b=a,D=u,k=p,"number"==typeof(I=o)&&I>=0&&I<=360?"number"==typeof b&&b>=0&&b<=100&&"number"==typeof D&&D>=0&&D<=100?void 0===k||"number"==typeof k&&k>=0&&k<=1?null:`Invalid hsla value [${[I,b,D,k].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${("number"==typeof k?[I,b,D,k]:[I,b,D]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${("number"==typeof k?[I,b,D,k]:[I,b,D]).join(", ")}]: 'h' must be between 0 and 360.`);var I,b,D,k;if(y)throw new so(y);const C=`hsla(${o}, ${a}%, ${u}%, ${p})`,S=Yi.parse(C);if(!S)throw new so(`Failed to parse HSLA color: ${C}`);return S}function pl(d,o){return d in o}function ci(d,o){const a=o[d];return void 0===a?null:a}function hs(d){return{type:d}}function qh(d){return{result:"success",value:d}}function fa(d){return{result:"error",value:d}}function Zr(d,o){return!!d&&!!d.parameters&&d.parameters.indexOf(o)>-1}function fl(d){return"data-driven"===d["property-type"]}function od(d){return Zr(d.expression,"measure-light")}function wc(d){return Zr(d.expression,"zoom")}function qu(d){return!!d.expression&&d.expression.interpolated}function sf(d){return"object"==typeof d&&null!==d&&!Array.isArray(d)}function sd(d){return d}function af(d,o){const a="color"===o.type,u=d.stops&&"object"==typeof d.stops[0][0],g=u||!(u||void 0!==d.property),p=d.type||(qu(o)?"exponential":"interval");if(a&&((d=Ti({},d)).stops&&(d.stops=d.stops.map(I=>[I[0],Yi.parse(I[1])])),d.default=Yi.parse(d.default?d.default:o.default)),d.colorSpace&&"rgb"!==d.colorSpace&&!r_[d.colorSpace])throw new Error(`Unknown color space: ${d.colorSpace}`);let y,C,S;if("exponential"===p)y=Pn;else if("interval"===p)y=Wu;else if("categorical"===p){y=za,C=Object.create(null);for(const I of d.stops)C[I[0]]=I[1];S=typeof d.stops[0][0]}else{if("identity"!==p)throw new Error(`Unknown function type "${p}"`);y=Wh}if(u){const I={},b=[];for(let T=0;T<d.stops.length;T++){const A=d.stops[T],O=A[0].zoom;void 0===I[O]&&(I[O]={zoom:O,type:d.type,property:d.property,default:d.default,stops:[]},b.push(O)),I[O].stops.push([A[0].value,A[1]])}const D=[];for(const T of b)D.push([I[T].zoom,af(I[T],o)]);const k={name:"linear"};return{kind:"composite",interpolationType:k,interpolationFactor:us.interpolationFactor.bind(void 0,k),zoomStops:D.map(T=>T[0]),evaluate:({zoom:T},A)=>Pn({stops:D,base:d.base},o,T).evaluate(T,A)}}if(g){const I="exponential"===p?{name:"exponential",base:void 0!==d.base?d.base:1}:null;return{kind:"camera",interpolationType:I,interpolationFactor:us.interpolationFactor.bind(void 0,I),zoomStops:d.stops.map(b=>b[0]),evaluate:({zoom:b})=>y(d,o,b,C,S)}}return{kind:"source",evaluate(I,b){const D=b&&b.properties?b.properties[d.property]:void 0;return void 0===D?Wl(d.default,o.default):y(d,o,D,C,S)}}}function Wl(d,o,a){return void 0!==d?d:void 0!==o?o:void 0!==a?a:void 0}function za(d,o,a,u,g){return Wl(typeof a===g?u[a]:void 0,d.default,o.default)}function Wu(d,o,a){if("number"!==jl(a))return Wl(d.default,o.default);const u=d.stops.length;if(1===u||a<=d.stops[0][0])return d.stops[0][1];if(a>=d.stops[u-1][0])return d.stops[u-1][1];const g=rf(d.stops.map(p=>p[0]),a);return d.stops[g][1]}function Pn(d,o,a){const u=void 0!==d.base?d.base:1;if("number"!==jl(a))return Wl(d.default,o.default);const g=d.stops.length;if(1===g||a<=d.stops[0][0])return d.stops[0][1];if(a>=d.stops[g-1][0])return d.stops[g-1][1];const p=rf(d.stops.map(b=>b[0]),a),y=function(b,D,k,T){const A=T-k,O=b-k;return 0===A?0:1===D?O/A:(Math.pow(D,O)-1)/(Math.pow(D,A)-1)}(a,u,d.stops[p][0],d.stops[p+1][0]),C=d.stops[p][1],S=d.stops[p+1][1];let I=mm[o.type]||sd;if(d.colorSpace&&"rgb"!==d.colorSpace){const b=r_[d.colorSpace];I=(D,k)=>b.reverse(b.interpolate(b.forward(D),b.forward(k),y))}return"function"==typeof C.evaluate?{evaluate(...b){const D=C.evaluate.apply(void 0,b),k=S.evaluate.apply(void 0,b);if(void 0!==D&&void 0!==k)return I(D,k,y)}}:I(C,S,y)}function Wh(d,o,a){return"color"===o.type?a=Yi.parse(a):"formatted"===o.type?a=Ko.fromString(a.toString()):"resolvedImage"===o.type?a=ds.build(a.toString()):jl(a)===o.type||"enum"===o.type&&o.values[a]||(a=void 0),Wl(a,d.default,o.default)}Ss.register(ql,{error:[{kind:"error"},[Hi],(d,[o])=>{throw new so(o.evaluate(d))}],typeof:[Hi,[Ni],(d,[o])=>Wr(Yr(o.evaluate(d)))],"to-rgba":[Xo(rn,4),[Ns],(d,[o])=>o.evaluate(d).toRenderColor(null).toArray()],"to-hsla":[Xo(rn,4),[Ns],(d,[o])=>o.evaluate(d).toRenderColor(null).toHslaArray()],rgb:[Ns,[rn,rn,rn],Ar],rgba:[Ns,[rn,rn,rn,rn],Ar],hsl:[Ns,[rn,rn,rn],mo],hsla:[Ns,[rn,rn,rn,rn],mo],has:{type:Ii,overloads:[[[Hi],(d,[o])=>pl(o.evaluate(d),d.properties())],[[Hi,Nt],(d,[o,a])=>pl(o.evaluate(d),a.evaluate(d))]]},get:{type:Ni,overloads:[[[Hi],(d,[o])=>ci(o.evaluate(d),d.properties())],[[Hi,Nt],(d,[o,a])=>ci(o.evaluate(d),a.evaluate(d))]]},"feature-state":[Ni,[Hi],(d,[o])=>ci(o.evaluate(d),d.featureState||{})],properties:[Nt,[],d=>d.properties()],"geometry-type":[Hi,[],d=>d.geometryType()],id:[Ni,[],d=>d.id()],zoom:[rn,[],d=>d.globals.zoom],pitch:[rn,[],d=>d.globals.pitch||0],"distance-from-center":[rn,[],d=>d.distanceFromCenter()],"measure-light":[rn,[Hi],(d,[o])=>d.measureLight(o.evaluate(d))],"heatmap-density":[rn,[],d=>d.globals.heatmapDensity||0],"line-progress":[rn,[],d=>d.globals.lineProgress||0],"raster-value":[rn,[],d=>d.globals.rasterValue||0],"raster-particle-speed":[rn,[],d=>d.globals.rasterParticleSpeed||0],"sky-radial-progress":[rn,[],d=>d.globals.skyRadialProgress||0],accumulated:[Ni,[],d=>void 0===d.globals.accumulated?null:d.globals.accumulated],"+":[rn,hs(rn),(d,o)=>{let a=0;for(const u of o)a+=u.evaluate(d);return a}],"*":[rn,hs(rn),(d,o)=>{let a=1;for(const u of o)a*=u.evaluate(d);return a}],"-":{type:rn,overloads:[[[rn,rn],(d,[o,a])=>o.evaluate(d)-a.evaluate(d)],[[rn],(d,[o])=>-o.evaluate(d)]]},"/":[rn,[rn,rn],(d,[o,a])=>o.evaluate(d)/a.evaluate(d)],"%":[rn,[rn,rn],(d,[o,a])=>o.evaluate(d)%a.evaluate(d)],ln2:[rn,[],()=>Math.LN2],pi:[rn,[],()=>Math.PI],e:[rn,[],()=>Math.E],"^":[rn,[rn,rn],(d,[o,a])=>Math.pow(o.evaluate(d),a.evaluate(d))],sqrt:[rn,[rn],(d,[o])=>Math.sqrt(o.evaluate(d))],log10:[rn,[rn],(d,[o])=>Math.log(o.evaluate(d))/Math.LN10],ln:[rn,[rn],(d,[o])=>Math.log(o.evaluate(d))],log2:[rn,[rn],(d,[o])=>Math.log(o.evaluate(d))/Math.LN2],sin:[rn,[rn],(d,[o])=>Math.sin(o.evaluate(d))],cos:[rn,[rn],(d,[o])=>Math.cos(o.evaluate(d))],tan:[rn,[rn],(d,[o])=>Math.tan(o.evaluate(d))],asin:[rn,[rn],(d,[o])=>Math.asin(o.evaluate(d))],acos:[rn,[rn],(d,[o])=>Math.acos(o.evaluate(d))],atan:[rn,[rn],(d,[o])=>Math.atan(o.evaluate(d))],min:[rn,hs(rn),(d,o)=>Math.min(...o.map(a=>a.evaluate(d)))],max:[rn,hs(rn),(d,o)=>Math.max(...o.map(a=>a.evaluate(d)))],abs:[rn,[rn],(d,[o])=>Math.abs(o.evaluate(d))],round:[rn,[rn],(d,[o])=>{const a=o.evaluate(d);return a<0?-Math.round(-a):Math.round(a)}],floor:[rn,[rn],(d,[o])=>Math.floor(o.evaluate(d))],ceil:[rn,[rn],(d,[o])=>Math.ceil(o.evaluate(d))],"filter-==":[Ii,[Hi,Ni],(d,[o,a])=>d.properties()[o.value]===a.value],"filter-id-==":[Ii,[Ni],(d,[o])=>d.id()===o.value],"filter-type-==":[Ii,[Hi],(d,[o])=>d.geometryType()===o.value],"filter-<":[Ii,[Hi,Ni],(d,[o,a])=>{const u=d.properties()[o.value],g=a.value;return typeof u==typeof g&&u<g}],"filter-id-<":[Ii,[Ni],(d,[o])=>{const a=d.id(),u=o.value;return typeof a==typeof u&&a<u}],"filter->":[Ii,[Hi,Ni],(d,[o,a])=>{const u=d.properties()[o.value],g=a.value;return typeof u==typeof g&&u>g}],"filter-id->":[Ii,[Ni],(d,[o])=>{const a=d.id(),u=o.value;return typeof a==typeof u&&a>u}],"filter-<=":[Ii,[Hi,Ni],(d,[o,a])=>{const u=d.properties()[o.value],g=a.value;return typeof u==typeof g&&u<=g}],"filter-id-<=":[Ii,[Ni],(d,[o])=>{const a=d.id(),u=o.value;return typeof a==typeof u&&a<=u}],"filter->=":[Ii,[Hi,Ni],(d,[o,a])=>{const u=d.properties()[o.value],g=a.value;return typeof u==typeof g&&u>=g}],"filter-id->=":[Ii,[Ni],(d,[o])=>{const a=d.id(),u=o.value;return typeof a==typeof u&&a>=u}],"filter-has":[Ii,[Ni],(d,[o])=>o.value in d.properties()],"filter-has-id":[Ii,[],d=>null!==d.id()&&void 0!==d.id()],"filter-type-in":[Ii,[Xo(Hi)],(d,[o])=>o.value.indexOf(d.geometryType())>=0],"filter-id-in":[Ii,[Xo(Ni)],(d,[o])=>o.value.indexOf(d.id())>=0],"filter-in-small":[Ii,[Hi,Xo(Ni)],(d,[o,a])=>a.value.indexOf(d.properties()[o.value])>=0],"filter-in-large":[Ii,[Hi,Xo(Ni)],(d,[o,a])=>function(u,g,p,y){for(;p<=y;){const C=p+y>>1;if(g[C]===u)return!0;g[C]>u?y=C-1:p=C+1}return!1}(d.properties()[o.value],a.value,0,a.value.length-1)],all:{type:Ii,overloads:[[[Ii,Ii],(d,[o,a])=>o.evaluate(d)&&a.evaluate(d)],[hs(Ii),(d,o)=>{for(const a of o)if(!a.evaluate(d))return!1;return!0}]]},any:{type:Ii,overloads:[[[Ii,Ii],(d,[o,a])=>o.evaluate(d)||a.evaluate(d)],[hs(Ii),(d,o)=>{for(const a of o)if(a.evaluate(d))return!0;return!1}]]},"!":[Ii,[Ii],(d,[o])=>!o.evaluate(d)],"is-supported-script":[Ii,[Hi],(d,[o])=>{const a=d.globals&&d.globals.isSupportedScript;return!a||a(o.evaluate(d))}],upcase:[Hi,[Hi],(d,[o])=>o.evaluate(d).toUpperCase()],downcase:[Hi,[Hi],(d,[o])=>o.evaluate(d).toLowerCase()],concat:[Hi,hs(Ni),(d,o)=>o.map(a=>Qo(a.evaluate(d))).join("")],"resolved-locale":[Hi,[Ai],(d,[o])=>o.evaluate(d).resolvedLocale()],random:[rn,[rn,rn,Ni],(d,o)=>{const[a,u,g]=o.map(y=>y.evaluate(d));if(a>u||a===u)return a;let p;if("string"==typeof g)p=function(y){let C=0;if(0===y.length)return C;for(let S=0;S<y.length;S++)C=(C<<5)-C+y.charCodeAt(S),C|=0;return C}(g);else{if("number"!=typeof g)throw new so(`Invalid seed input: ${g}`);p=g}return a+Ts(p)()*(u-a)}]});class Ba{constructor(o,a,u,g){var p;this.expression=o,this._warningHistory={},this._evaluator=new Gd(u,g),this._defaultValue=a?"color"===(p=a).type&&(sf(p.default)||Array.isArray(p.default))?new Yi(0,0,0,0):"color"===p.type?Yi.parse(p.default)||null:void 0===p.default?null:p.default:null,this._enumValues=a&&"enum"===a.type?a.values:null,this.configDependencies=Uu(o)}evaluateWithoutErrorHandling(o,a,u,g,p,y,C,S){return this._evaluator.globals=o,this._evaluator.feature=a,this._evaluator.featureState=u,this._evaluator.canonical=g||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=y,this._evaluator.featureTileCoord=C||null,this._evaluator.featureDistanceData=S||null,this.expression.evaluate(this._evaluator)}evaluate(o,a,u,g,p,y,C,S){this._evaluator.globals=o,this._evaluator.feature=a||null,this._evaluator.featureState=u||null,this._evaluator.canonical=g||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=y||null,this._evaluator.featureTileCoord=C||null,this._evaluator.featureDistanceData=S||null;try{const I=this.expression.evaluate(this._evaluator);if(null==I||"number"==typeof I&&I!=I)return this._defaultValue;if(this._enumValues&&!(I in this._enumValues))throw new so(`Expected value to be one of ${Object.keys(this._enumValues).map(b=>JSON.stringify(b)).join(", ")}, but found ${JSON.stringify(I)} instead.`);return I}catch(I){return this._warningHistory[I.message]||(this._warningHistory[I.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${I.message}`)),this._defaultValue}}}function Va(d){return Array.isArray(d)&&d.length>0&&"string"==typeof d[0]&&d[0]in ql}function ad(d,o,a,u){const g=new Sm(ql,[],o?function(y){const C={color:Ns,string:Hi,number:rn,enum:Hi,boolean:Ii,formatted:jd,resolvedImage:qc};return"array"===y.type?Xo(C[y.value]||Ni,y.length):C[y.type]}(o):void 0,void 0,void 0,a,u),p=g.parse(d,void 0,void 0,void 0,o&&"string"===o.type?{typeAnnotation:"coerce"}:void 0);return p?qh(new Ba(p,o,a,u)):fa(g.errors)}class Qd{constructor(o,a,u,g){this.kind=o,this._styleExpression=a,this.isLightConstant=u,this.isLineProgressConstant=g,this.isStateDependent="constant"!==o&&!Em(a.expression),this.configDependencies=Uu(a.expression)}evaluateWithoutErrorHandling(o,a,u,g,p,y){return this._styleExpression.evaluateWithoutErrorHandling(o,a,u,g,p,y)}evaluate(o,a,u,g,p,y){return this._styleExpression.evaluate(o,a,u,g,p,y)}}class zr{constructor(o,a,u,g,p,y){this.kind=o,this.zoomStops=u,this._styleExpression=a,this.isStateDependent="camera"!==o&&!Em(a.expression),this.isLightConstant=p,this.isLineProgressConstant=y,this.configDependencies=Uu(a.expression),this.interpolationType=g}evaluateWithoutErrorHandling(o,a,u,g,p,y){return this._styleExpression.evaluateWithoutErrorHandling(o,a,u,g,p,y)}evaluate(o,a,u,g,p,y){return this._styleExpression.evaluate(o,a,u,g,p,y)}interpolationFactor(o,a,u){return this.interpolationType?us.interpolationFactor(this.interpolationType,o,a,u):0}}function ao(d,o,a,u){if("error"===(d=ad(d,o,a,u)).result)return d;const g=d.value.expression,p=td(g);if(!p&&!fl(o))return fa([new to("","data expressions not supported")]);const y=nd(g,["zoom","pitch","distance-from-center"]);if(!y&&!wc(o))return fa([new to("","zoom expressions not supported")]);const C=nd(g,["measure-light"]);if(!C&&!od(o))return fa([new to("","measure-light expression not supported")]);const S=nd(g,["line-progress"]);if(!S&&!Zr(o.expression,"line-progress"))return fa([new to("","line-progress expression not supported")]);const I=o.expression&&o.expression.relaxZoomRestriction,b=Yh(g);return b||y||I?b instanceof to?fa([b]):b instanceof us&&!qu(o)?fa([new to("",'"interpolate" expressions cannot be used with this property')]):qh(b?new zr(p&&S?"camera":"composite",d.value,b.labels,b instanceof us?b.interpolation:void 0,C,S):new Qd(p&&S?"constant":"source",d.value,C,S)):fa([new to("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class xo{constructor(o,a){this._parameters=o,this._specification=a,Ti(this,af(this._parameters,this._specification))}static deserialize(o){return new xo(o._parameters,o._specification)}static serialize(o){return{_parameters:o._parameters,_specification:o._specification}}}function Yh(d){let o=null;if(d instanceof Im)o=Yh(d.result);else if(d instanceof Tm){for(const a of d.args)if(o=Yh(a),o)break}else(d instanceof hl||d instanceof us)&&d.input instanceof Ss&&"zoom"===d.input.name&&(o=d);return o instanceof to||d.eachChild(a=>{const u=Yh(a);u instanceof to?o=u:o&&u&&o!==u&&(o=new to("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),o}var Qs,lf,ma=function(){if(lf)return Qs;lf=1,Qs=o;var d=3;function o(a,u,g){var p=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var y=new Int32Array(this.arrayBuffer);a=y[0],this.d=(u=y[1])+2*(g=y[2]);for(var C=0;C<this.d*this.d;C++){var S=y[d+C],I=y[d+C+1];p.push(S===I?null:y.subarray(S,I))}var b=y[d+p.length+1];this.keys=y.subarray(y[d+p.length],b),this.bboxes=y.subarray(b),this.insert=this._insertReadonly}else{this.d=u+2*g;for(var D=0;D<this.d*this.d;D++)p.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=a,this.padding=g,this.scale=u/a,this.uid=0;var k=g/u*a;this.min=-k,this.max=a+k}return o.prototype.insert=function(a,u,g,p,y){this._forEachCell(u,g,p,y,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(u),this.bboxes.push(g),this.bboxes.push(p),this.bboxes.push(y)},o.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},o.prototype._insertCell=function(a,u,g,p,y,C){this.cells[y].push(C)},o.prototype.query=function(a,u,g,p,y){var C=this.min,S=this.max;if(a<=C&&u<=C&&S<=g&&S<=p&&!y)return Array.prototype.slice.call(this.keys);var I=[];return this._forEachCell(a,u,g,p,this._queryCell,I,{},y),I},o.prototype._queryCell=function(a,u,g,p,y,C,S,I){var b=this.cells[y];if(null!==b)for(var D=this.keys,k=this.bboxes,T=0;T<b.length;T++){var A=b[T];if(void 0===S[A]){var O=4*A;(I?I(k[O+0],k[O+1],k[O+2],k[O+3]):a<=k[O+2]&&u<=k[O+3]&&g>=k[O+0]&&p>=k[O+1])?(S[A]=!0,C.push(D[A])):S[A]=!1}}},o.prototype._forEachCell=function(a,u,g,p,y,C,S,I){for(var b=this._convertToCellCoord(a),D=this._convertToCellCoord(u),k=this._convertToCellCoord(g),T=this._convertToCellCoord(p),A=b;A<=k;A++)for(var O=D;O<=T;O++){var B=this.d*O+A;if((!I||I(this._convertFromCellCoord(A),this._convertFromCellCoord(O),this._convertFromCellCoord(A+1),this._convertFromCellCoord(O+1)))&&y.call(this,a,u,g,p,B,C,S,I))return}},o.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},o.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},o.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,u=d+this.cells.length+1+1,g=0,p=0;p<this.cells.length;p++)g+=this.cells[p].length;var y=new Int32Array(u+g+this.keys.length+this.bboxes.length);y[0]=this.extent,y[1]=this.n,y[2]=this.padding;for(var C=u,S=0;S<a.length;S++){var I=a[S];y[d+S]=C,y.set(I,C),C+=I.length}return y[d+a.length]=C,y.set(this.keys,C),y[d+a.length+1]=C+=this.keys.length,y.set(this.bboxes,C),C+=this.bboxes.length,y.buffer},Qs}(),ga=Jr(ma);const cf={};function Zt(d,o,a={}){Object.defineProperty(d,"_classRegistryKey",{value:o,writable:!1}),cf[o]={klass:d,omit:a.omit||[]}}Zt(Object,"Object"),ga.serialize=function(d,o){const a=d.toArrayBuffer();return o&&o.add(a),{buffer:a}},ga.deserialize=function(d){return new ga(d.buffer)},Object.defineProperty(ga,"name",{value:"Grid"}),Zt(ga,"Grid"),typeof DOMMatrix<"u"&&Zt(DOMMatrix,"DOMMatrix"),Zt(Yi,"Color"),Zt(Error,"Error"),Zt(Ko,"Formatted"),Zt(_t,"FormattedSection"),Zt(Fo,"AJAXError"),Zt(ds,"ResolvedImage"),Zt(xo,"StylePropertyFunction"),Zt(Ba,"StyleExpression",{omit:["_evaluator"]}),Zt(ua,"ImageId"),Zt(Oa,"ImageVariant"),Zt(zr,"ZoomDependentExpression"),Zt(Qd,"ZoomConstantExpression"),Zt(Ss,"CompoundExpression",{omit:["_evaluate"]});for(const d in ql)cf[ql[d]._classRegistryKey]||Zt(ql[d],`Expression${d}`);function Cc(d){return d&&typeof ArrayBuffer<"u"&&(d instanceof ArrayBuffer||d.constructor&&"ArrayBuffer"===d.constructor.name)}function Pm(d){return self.ImageBitmap&&d instanceof ImageBitmap}function Jd(d,o){if(null==d||"boolean"==typeof d||"number"==typeof d||"string"==typeof d||d instanceof Boolean||d instanceof Number||d instanceof String||d instanceof Date||d instanceof RegExp)return d;if(Cc(d)||Pm(d))return o&&o.add(d),d;if(ArrayBuffer.isView(d))return o&&o.add(d.buffer),d;if(d instanceof ImageData)return o&&o.add(d.data.buffer),d;if(Array.isArray(d)){const a=[];for(const u of d)a.push(Jd(u,o));return a}if(d instanceof Map){const a={$name:"Map",entries:[]};for(const[u,g]of d.entries())a.entries.push(Jd(u),Jd(g));return a}if(d instanceof Set){const a={$name:"Set"};let u=0;for(const g of d.values())a[++u]=Jd(g);return a}if(d instanceof DOMMatrix){const a={$name:"DOMMatrix"},u=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const g of u)a[g]=d[g];return a}if("bigint"==typeof d)return{$name:"BigInt",value:d.toString()};if("object"==typeof d){const a=d.constructor,u=a._classRegistryKey;if(!u)throw new Error(`Can't serialize object of unregistered class "${a.name}".`);const g=a.serialize?a.serialize(d,o):{};if(!a.serialize){for(const p in d)d.hasOwnProperty(p)&&(cf[u].omit.indexOf(p)>=0||(g[p]=Jd(d[p],o)));d instanceof Error&&(g.message=d.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==u&&(g.$name=u),g}throw new Error("can't serialize object of type "+typeof d)}function Vs(d){if(null==d||"boolean"==typeof d||"number"==typeof d||"string"==typeof d||d instanceof Boolean||d instanceof Number||d instanceof String||d instanceof Date||d instanceof RegExp||Cc(d)||Pm(d)||ArrayBuffer.isView(d)||d instanceof ImageData)return d;if(Array.isArray(d))return d.map(Vs);if("object"==typeof d){const o=d.$name||"Object";if("Map"===o){const g=d.entries||[],p=new Map;for(let y=0;y<g.length;y+=2)p.set(Vs(g[y]),Vs(g[y+1]));return p}if("Set"===o){const g=new Set;for(const p of Object.keys(d))"$name"!==p&&g.add(Vs(d[p]));return g}if("DOMMatrix"===o){let g;return g=d.is2D?[d.a,d.b,d.c,d.d,d.e,d.f]:[d.m11,d.m12,d.m13,d.m14,d.m21,d.m22,d.m23,d.m24,d.m31,d.m32,d.m33,d.m34,d.m41,d.m42,d.m43,d.m44],new DOMMatrix(g)}if("BigInt"===o)return BigInt(d.value);const{klass:a}=cf[o];if(!a)throw new Error(`Can't deserialize unregistered class "${o}".`);if(a.deserialize)return a.deserialize(d);const u=Object.create(a.prototype);for(const g of Object.keys(d))"$name"!==g&&(u[g]=Vs(d[g]));return u}throw new Error("can't deserialize object of type "+typeof d)}const hn_Latin_1_Supplement=d=>d>=128&&d<=255,hn_Arabic=d=>d>=1536&&d<=1791,hn_Arabic_Supplement=d=>d>=1872&&d<=1919,hn_Arabic_Extended_A=d=>d>=2208&&d<=2303,hn_Hangul_Jamo=d=>d>=4352&&d<=4607,hn_Unified_Canadian_Aboriginal_Syllabics=d=>d>=5120&&d<=5759,hn_Khmer=d=>d>=6016&&d<=6143,hn_Unified_Canadian_Aboriginal_Syllabics_Extended=d=>d>=6320&&d<=6399,hn_General_Punctuation=d=>d>=8192&&d<=8303,hn_Letterlike_Symbols=d=>d>=8448&&d<=8527,hn_Number_Forms=d=>d>=8528&&d<=8591,hn_Miscellaneous_Technical=d=>d>=8960&&d<=9215,hn_Control_Pictures=d=>d>=9216&&d<=9279,hn_Optical_Character_Recognition=d=>d>=9280&&d<=9311,hn_Enclosed_Alphanumerics=d=>d>=9312&&d<=9471,hn_Geometric_Shapes=d=>d>=9632&&d<=9727,hn_Miscellaneous_Symbols=d=>d>=9728&&d<=9983,hn_Miscellaneous_Symbols_and_Arrows=d=>d>=11008&&d<=11263,hn_CJK_Radicals_Supplement=d=>d>=11904&&d<=12031,hn_Kangxi_Radicals=d=>d>=12032&&d<=12255,hn_Ideographic_Description_Characters=d=>d>=12272&&d<=12287,hn_CJK_Symbols_and_Punctuation=d=>d>=12288&&d<=12351,hn_Hiragana=d=>d>=12352&&d<=12447,hn_Katakana=d=>d>=12448&&d<=12543,hn_Bopomofo=d=>d>=12544&&d<=12591,hn_Hangul_Compatibility_Jamo=d=>d>=12592&&d<=12687,hn_Kanbun=d=>d>=12688&&d<=12703,hn_Bopomofo_Extended=d=>d>=12704&&d<=12735,hn_CJK_Strokes=d=>d>=12736&&d<=12783,hn_Katakana_Phonetic_Extensions=d=>d>=12784&&d<=12799,hn_Enclosed_CJK_Letters_and_Months=d=>d>=12800&&d<=13055,hn_CJK_Compatibility=d=>d>=13056&&d<=13311,hn_CJK_Unified_Ideographs_Extension_A=d=>d>=13312&&d<=19903,hn_Yijing_Hexagram_Symbols=d=>d>=19904&&d<=19967,hn_CJK_Unified_Ideographs=d=>d>=19968&&d<=40959,hn_Yi_Syllables=d=>d>=40960&&d<=42127,hn_Yi_Radicals=d=>d>=42128&&d<=42191,hn_Hangul_Jamo_Extended_A=d=>d>=43360&&d<=43391,hn_Hangul_Syllables=d=>d>=44032&&d<=55215,hn_Hangul_Jamo_Extended_B=d=>d>=55216&&d<=55295,hn_Private_Use_Area=d=>d>=57344&&d<=63743,hn_CJK_Compatibility_Ideographs=d=>d>=63744&&d<=64255,hn_Arabic_Presentation_Forms_A=d=>d>=64336&&d<=65023,hn_Vertical_Forms=d=>d>=65040&&d<=65055,hn_CJK_Compatibility_Forms=d=>d>=65072&&d<=65103,hn_Small_Form_Variants=d=>d>=65104&&d<=65135,hn_Arabic_Presentation_Forms_B=d=>d>=65136&&d<=65279,hn_Halfwidth_and_Fullwidth_Forms=d=>d>=65280&&d<=65519,hn_Osage=d=>d>=66736&&d<=66815,hn_CJK_Unified_Ideographs_Extension_B=d=>d>=131072&&d<=173791;function Iv(d){for(const o of d)if(c_(o.charCodeAt(0)))return!0;return!1}function CE(d){for(const o of d)if(!wx(o.charCodeAt(0)))return!1;return!0}function wx(d){return!(hn_Arabic(d)||hn_Arabic_Supplement(d)||hn_Arabic_Extended_A(d)||hn_Arabic_Presentation_Forms_A(d)||hn_Arabic_Presentation_Forms_B(d))}function c_(d){return!(746!==d&&747!==d&&(d<4352||!(hn_Bopomofo_Extended(d)||hn_Bopomofo(d)||hn_CJK_Compatibility_Forms(d)&&!(d>=65097&&d<=65103)||hn_CJK_Compatibility_Ideographs(d)||hn_CJK_Compatibility(d)||hn_CJK_Radicals_Supplement(d)||hn_CJK_Strokes(d)||!(!hn_CJK_Symbols_and_Punctuation(d)||d>=12296&&d<=12305||d>=12308&&d<=12319||12336===d)||hn_CJK_Unified_Ideographs_Extension_A(d)||hn_CJK_Unified_Ideographs(d)||hn_Enclosed_CJK_Letters_and_Months(d)||hn_Hangul_Compatibility_Jamo(d)||hn_Hangul_Jamo_Extended_A(d)||hn_Hangul_Jamo_Extended_B(d)||hn_Hangul_Jamo(d)||hn_Hangul_Syllables(d)||hn_Hiragana(d)||hn_Ideographic_Description_Characters(d)||hn_Kanbun(d)||hn_Kangxi_Radicals(d)||hn_Katakana_Phonetic_Extensions(d)||hn_Katakana(d)&&12540!==d||!(!hn_Halfwidth_and_Fullwidth_Forms(d)||65288===d||65289===d||65293===d||d>=65306&&d<=65310||65339===d||65341===d||65343===d||d>=65371&&d<=65503||65507===d||d>=65512&&d<=65519)||!(!hn_Small_Form_Variants(d)||d>=65112&&d<=65118||d>=65123&&d<=65126)||hn_Unified_Canadian_Aboriginal_Syllabics(d)||hn_Unified_Canadian_Aboriginal_Syllabics_Extended(d)||hn_Vertical_Forms(d)||hn_Yijing_Hexagram_Symbols(d)||hn_Yi_Syllables(d)||hn_Yi_Radicals(d))))}function Av(d){return!(c_(d)||(o=d,hn_Latin_1_Supplement(o)&&(167===o||169===o||174===o||177===o||188===o||189===o||190===o||215===o||247===o)||hn_General_Punctuation(o)&&(8214===o||8224===o||8225===o||8240===o||8241===o||8251===o||8252===o||8258===o||8263===o||8264===o||8265===o||8273===o)||hn_Letterlike_Symbols(o)||hn_Number_Forms(o)||hn_Miscellaneous_Technical(o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||9003===o||o>=9085&&o<=9114||o>=9150&&o<=9165||9167===o||o>=9169&&o<=9179||o>=9186&&o<=9215)||hn_Control_Pictures(o)&&9251!==o||hn_Optical_Character_Recognition(o)||hn_Enclosed_Alphanumerics(o)||hn_Geometric_Shapes(o)||hn_Miscellaneous_Symbols(o)&&!(o>=9754&&o<=9759)||hn_Miscellaneous_Symbols_and_Arrows(o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||hn_CJK_Symbols_and_Punctuation(o)||hn_Katakana(o)||hn_Private_Use_Area(o)||hn_CJK_Compatibility_Forms(o)||hn_Small_Form_Variants(o)||hn_Halfwidth_and_Fullwidth_Forms(o)||8734===o||8756===o||8757===o||o>=9984&&o<=10087||o>=10102&&o<=10131||65532===o||65533===o));var o}function d_(d){return hn_Arabic(d)||hn_Arabic_Supplement(d)||hn_Arabic_Extended_A(d)||hn_Arabic_Presentation_Forms_A(d)||hn_Arabic_Presentation_Forms_B(d)}function u_(d){return d>=1424&&d<=2303||hn_Arabic_Presentation_Forms_A(d)||hn_Arabic_Presentation_Forms_B(d)}function kv(d,o){return!(!o&&u_(d)||d>=2304&&d<=3583||d>=3840&&d<=4255||hn_Khmer(d))}function Cx(d){for(const o of d)if(u_(o.charCodeAt(0)))return!0;return!1}const Rv="deferred",df="loading",Om="loaded";let Pv=null,_a="unavailable",Yu=null;const uf=function(d){d&&"string"==typeof d&&d.indexOf("NetworkError")>-1&&(_a="error"),Pv&&Pv(d)};function hf(){Mr.fire(new da("pluginStateChange",{pluginStatus:_a,pluginURL:Yu}))}const Mr=new po,pf=function(){return _a},Ov=function(){if(_a!==Rv||!Yu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");_a=df,hf(),Yu&&ca({url:Yu},d=>{d?uf(d):(_a=Om,hf())})},ml={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>_a===Om||null!=ml.applyArabicShaping,isLoading:()=>_a===df,setState(d){_a=d.pluginStatus,Yu=d.pluginURL},isParsed:()=>null!=ml.applyArabicShaping&&null!=ml.processBidirectionalText&&null!=ml.processStyledBidirectionalText,getPluginURL:()=>Yu};class sr{constructor(o,a){this.zoom=o,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.transition=a.transition,this.pitch=a.pitch,this.brightness=a.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(o){return function(a,u){for(const g of a)if(!kv(g.charCodeAt(0),u))return!1;return!0}(o,ml.isLoaded())}}class Zu{constructor(o,a,u,g){this.property=o,this.value=a,this.expression=function(p,y,C,S){if(sf(p))return new xo(p,y);if(Va(p)||Array.isArray(p)&&p.length>0){const I=ao(p,y,C,S);if("error"===I.result)throw new Error(I.value.map(b=>`${b.key}: ${b.message}`).join(", "));return I.value}{let I=p;return"string"==typeof p&&"color"===y.type&&(I=Yi.parse(p)),{kind:"constant",configDependencies:new Set,evaluate:()=>I}}}(void 0===a?o.specification.default:a,o.specification,u,g)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(o,a,u){return this.property.possiblyEvaluate(this,o,a,u)}}class h_{constructor(o,a,u){this.property=o,this.value=new Zu(o,void 0,a,u)}transitioned(o,a){return new Fm(this.property,this.value,a,ls({},o.transition,this.transition),o.now)}untransitioned(){return new Fm(this.property,this.value,null,{},0)}}class ff{constructor(o,a,u){this._properties=o,this._values=Object.create(o.defaultTransitionablePropertyValues),this._scope=a,this._options=u,this.configDependencies=new Set}getValue(o){return Ls(this._values[o].value.value)}setValue(o,a){this._values.hasOwnProperty(o)||(this._values[o]=new h_(this._values[o].property,this._scope,this._options)),this._values[o].value=new Zu(this._values[o].property,null===a?void 0:Ls(a),this._scope,this._options),this._values[o].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[o].value.expression.configDependencies]))}setTransitionOrValue(o,a){a&&(this._options=a);const u=this._properties.properties;if(o)for(const g in o){const p=o[g];if(g.endsWith("-transition")){const y=g.slice(0,-11);u[y]&&this.setTransition(y,p)}else u.hasOwnProperty(g)&&this.setValue(g,p)}}getTransition(o){return Ls(this._values[o].transition)}setTransition(o,a){this._values.hasOwnProperty(o)||(this._values[o]=new h_(this._values[o].property)),this._values[o].transition=Ls(a)||void 0}serialize(){const o={};for(const a of Object.keys(this._values)){const u=this.getValue(a);void 0!==u&&(o[a]=u);const g=this.getTransition(a);void 0!==g&&(o[`${a}-transition`]=g)}return o}transitioned(o,a){const u=new yr(this._properties);for(const g of Object.keys(this._values))u._values[g]=this._values[g].transitioned(o,a._values[g]);return u}untransitioned(){const o=new yr(this._properties);for(const a of Object.keys(this._values))o._values[a]=this._values[a].untransitioned();return o}}class Fm{constructor(o,a,u,g,p){const y=g.delay||0,C=g.duration||0;p=p||0,this.property=o,this.value=a,this.begin=p+y,this.end=this.begin+C,o.specification.transition&&(g.delay||g.duration)&&(this.prior=u)}possiblyEvaluate(o,a,u){const g=o.now||0,p=this.value.possiblyEvaluate(o,a,u),y=this.prior;if(y){if(g>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(g<this.begin)return y.possiblyEvaluate(o,a,u);{const C=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(o,a,u),p,gc(C))}}return p}}class yr{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitioningPropertyValues)}possiblyEvaluate(o,a,u){const g=new tr(this._properties);for(const p of Object.keys(this._values))g._values[p]=this._values[p].possiblyEvaluate(o,a,u);return g}hasTransition(){for(const o of Object.keys(this._values))if(this._values[o].prior)return!0;return!1}}class Xu{constructor(o,a,u){this._properties=o,this._values=Object.create(o.defaultPropertyValues),this._scope=a,this._options=u,this.configDependencies=new Set}getValue(o){return Ls(this._values[o].value)}setValue(o,a){this._values[o]=new Zu(this._values[o].property,null===a?void 0:Ls(a),this._scope,this._options),this._values[o].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[o].expression.configDependencies]))}serialize(){const o={};for(const a of Object.keys(this._values)){const u=this.getValue(a);void 0!==u&&(o[a]=u)}return o}possiblyEvaluate(o,a,u){const g=new tr(this._properties);for(const p of Object.keys(this._values))g._values[p]=this._values[p].possiblyEvaluate(o,a,u);return g}}class Ku{constructor(o,a,u){this.property=o,this.value=a,this.parameters=u}isConstant(){return"constant"===this.value.kind}constantOr(o){return"constant"===this.value.kind?this.value.value:o}evaluate(o,a,u,g){return this.property.evaluate(this.value,this.parameters,o,a,u,g)}}class tr{constructor(o){this._properties=o,this._values=Object.create(o.defaultPossiblyEvaluatedValues)}get(o){return this._values[o]}}class Mt{constructor(o){this.specification=o}possiblyEvaluate(o,a){return o.expression.evaluate(a)}interpolate(o,a,u){const g=mm[this.specification.type];return g?g(o,a,u):o}}class Vt{constructor(o,a){this.specification=o,this.overrides=a}possiblyEvaluate(o,a,u,g){return new Ku(this,"constant"===o.expression.kind||"camera"===o.expression.kind?{kind:"constant",value:o.expression.evaluate(a,null,{},u,g)}:o.expression,a)}interpolate(o,a,u){if("constant"!==o.value.kind||"constant"!==a.value.kind)return o;if(void 0===o.value.value||void 0===a.value.value)return new Ku(this,{kind:"constant",value:void 0},o.parameters);const g=mm[this.specification.type];return g?new Ku(this,{kind:"constant",value:g(o.value.value,a.value.value,u)},o.parameters):o}evaluate(o,a,u,g,p,y){return"constant"===o.kind?o.value:o.evaluate(a,u,g,p,y)}}class Bo{constructor(o){this.specification=o}possiblyEvaluate(o,a,u,g){return!!o.expression.evaluate(a,null,{},u,g)}interpolate(){return!1}}class Br{constructor(o){this.properties=o,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const a=new sr(0,{});for(const u in o){const g=o[u];g.specification.overridable&&this.overridableProperties.push(u);const p=this.defaultPropertyValues[u]=new Zu(g,void 0),y=this.defaultTransitionablePropertyValues[u]=new h_(g);this.defaultTransitioningPropertyValues[u]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=p.possiblyEvaluate(a)}}}Zt(Vt,"DataDrivenProperty"),Zt(Mt,"DataConstantProperty"),Zt(Bo,"ColorRampProperty");var Ye=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow","experimental":true},"rain":{"type":"rain","experimental":true},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor","experimental":true},"imports":{"type":"array","value":"import"},"iconsets":{"experimental":true,"type":"iconsets"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"metadata":{"experimental":true,"type":"*"},"selectors":{"experimental":true,"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"experimental":true,"type":"string","required":true},"properties":{"experimental":true,"type":"selectorProperty","required":false},"featureNamespace":{"experimental":true,"type":"string","required":false},"_uniqueFeatureID":{"experimental":true,"type":"boolean","private":true,"required":false}},"selectorProperty":{"experimental":true,"*":{"experimental":true,"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-quality":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]},"experimental":true},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"required":true,"type":"enum","values":{"sprite":1}},"url":{"required":true,"type":"string"}},"iconset_source":{"type":{"required":true,"type":"enum","values":{"source":1}},"source":{"required":true,"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant"},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","experimental":true,"private":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"line-cross-slope":{"type":"number","experimental":true,"expression":{},"property-type":"constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","experimental":true,"private":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.4,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","property-type":"data-constant","default":0.71,"minimum":0,"maximum":5,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.57,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","property-type":"data-constant","default":0.7,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}},"buildingFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","experimental":true,"private":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","transition":true,"experimental":true,"private":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"flat","property-type":"data-constant"},"fill-extrusion-base-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"terrain","property-type":"data-constant"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"experimental":true,"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"*"}}}');function eu(d){return d instanceof Number||d instanceof String||d instanceof Boolean?d.valueOf():d}function ps(d){if(Array.isArray(d))return d.map(ps);if(d instanceof Object&&!(d instanceof Number||d instanceof String||d instanceof Boolean)){const o={};for(const a in d)o[a]=ps(d[a]);return o}return eu(d)}function p_(d){if(!0===d||!1===d)return!0;if(!Array.isArray(d)||0===d.length)return!1;switch(d[0]){case"has":return d.length>=2&&"$id"!==d[1]&&"$type"!==d[1];case"in":return d.length>=3&&("string"!=typeof d[1]||Array.isArray(d[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==d.length||Array.isArray(d[1])||Array.isArray(d[2]);case"any":case"all":for(const o of d.slice(1))if(!p_(o)&&"boolean"!=typeof o)return!1;return!0;default:return!0}}function mf(d,o="",a=null,u="fill"){if(null==d)return{filter:()=>!0,needGeometry:!1,needFeature:!1};p_(d)||(d=Xh(d));const g=d;let p=!0;try{p=function(b){if(!Qu(b))return b;let D=ps(b);return Ua(D),D=Fv(D),D}(g)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(g,null,2)}\n        `)}let y=null,C=null;if("background"!==u&&"sky"!==u&&"slot"!==u){C=Ye[`filter_${u}`];const b=ad(p,C,o,a);if("error"===b.result)throw new Error(b.value.map(D=>`${D.key}: ${D.message}`).join(", "));y=(D,k,T)=>b.value.evaluate(D,k,{},T)}let S=null,I=null;if(p!==g){const b=ad(g,C,o,a);if("error"===b.result)throw new Error(b.value.map(D=>`${D.key}: ${D.message}`).join(", "));S=(D,k,T,A,O)=>b.value.evaluate(D,k,{},T,void 0,void 0,A,O),I=!td(b.value.expression)}return{filter:y,dynamicFilter:S||void 0,needGeometry:Zh(p),needFeature:!!I}}function Fv(d){if(!Array.isArray(d))return d;const o=function(a){if(f_.has(a[0]))for(let u=1;u<a.length;u++)if(Qu(a[u]))return!0;return a}(d);return!0===o?o:o.map(a=>Fv(a))}function Ua(d){let o=!1;const a=[];if("case"===d[0]){for(let u=1;u<d.length-1;u+=2)o=o||Qu(d[u]),a.push(d[u+1]);a.push(d[d.length-1])}else if("match"===d[0]){o=o||Qu(d[1]);for(let u=2;u<d.length-1;u+=2)a.push(d[u+1]);a.push(d[d.length-1])}else if("step"===d[0]){o=o||Qu(d[1]);for(let u=1;u<d.length-1;u+=2)a.push(d[u+1])}o&&(d.length=0,d.push("any",...a));for(let u=1;u<d.length;u++)Ua(d[u])}function Qu(d){if(!Array.isArray(d))return!1;if("pitch"===(o=d[0])||"distance-from-center"===o)return!0;var o;for(let a=1;a<d.length;a++)if(Qu(d[a]))return!0;return!1}const f_=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Lv(d,o){return d<o?-1:d>o?1:0}function Zh(d){if(!Array.isArray(d))return!1;if("within"===d[0]||"distance"===d[0])return!0;for(let o=1;o<d.length;o++)if(Zh(d[o]))return!0;return!1}function Xh(d){if(!d)return!0;const o=d[0];return d.length<=1?"any"!==o:"=="===o?ja(d[1],d[2],"=="):"!="===o?Js(ja(d[1],d[2],"==")):"<"===o||">"===o||"<="===o||">="===o?ja(d[1],d[2],o):"any"===o?(a=d.slice(1),["any"].concat(a.map(Xh))):"all"===o?["all"].concat(d.slice(1).map(Xh)):"none"===o?["all"].concat(d.slice(1).map(Xh).map(Js)):"in"===o?Kh(d[1],d.slice(2)):"!in"===o?Js(Kh(d[1],d.slice(2))):"has"===o?gf(d[1]):"!has"!==o||Js(gf(d[1]));var a}function ja(d,o,a){switch(d){case"$type":return[`filter-type-${a}`,o];case"$id":return[`filter-id-${a}`,o];default:return[`filter-${a}`,d,o]}}function Kh(d,o){if(0===o.length)return!1;switch(d){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(a=>typeof a!=typeof o[0])?["filter-in-large",d,["literal",o.sort(Lv)]]:["filter-in-small",d,["literal",o]]}}function gf(d){switch(d){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",d]}}function Js(d){return["!",d]}function tu(d,o){return o?`${d}\x1f${o}`:d}const ld="-transition",xi=new Set(["fill","line","background","hillshade","raster"]);class go extends po{constructor(o,a,u,g,p){if(super(),this.id=o.id,this.fqid=tu(this.id,u),this.type=o.type,this.scope=u,this.lut=g,this.options=p,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,"custom"!==o.type){if(this.metadata=o.metadata,this.minzoom=o.minzoom,this.maxzoom=o.maxzoom,o.type&&"background"!==o.type&&"sky"!==o.type&&"slot"!==o.type){this.source=o.source,this.sourceLayer=o["source-layer"],this.filter=o.filter;const y=ad(this.filter,Ye[`filter_${o.type}`]);"error"!==y.result&&(this.configDependencies=new Set([...this.configDependencies,...y.value.configDependencies]))}if(o.slot&&(this.slot=o.slot),a.layout&&(this._unevaluatedLayout=new Xu(a.layout,this.scope,p),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),a.paint){this._transitionablePaint=new ff(a.paint,this.scope,p);for(const y in o.paint)this.setPaintProperty(y,o.paint[y]);for(const y in o.layout)this.setLayoutProperty(y,o.layout[y]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new tr(a.paint)}}}onAdd(o){}onRemove(o){}isDraped(o){return!this.is3D(!0)&&xi.has(this.type)}getLayoutProperty(o){return"visibility"===o?this.visibility:this._unevaluatedLayout.getValue(o)}setLayoutProperty(o,a){if("custom"===this.type&&"visibility"===o)return void(this.visibility=a);const u=this._unevaluatedLayout;u._properties.properties[o]&&(u.setValue(o,a),this.configDependencies=new Set([...this.configDependencies,...u.configDependencies]),"visibility"===o&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(o){return o.endsWith(ld)?this._transitionablePaint.getTransition(o.slice(0,-11)):this._transitionablePaint.getValue(o)}setPaintProperty(o,a){const u=this._transitionablePaint,g=u._properties.properties;if(o.endsWith(ld)){const D=o.slice(0,-11);return g[D]&&u.setTransition(D,a||void 0),!1}if(!g[o])return!1;const p=u._values[o],y=p.value.isDataDriven(),C=p.value;u.setValue(o,a),this.configDependencies=new Set([...this.configDependencies,...u.configDependencies]),this._handleSpecialPaintPropertyUpdate(o);const S=u._values[o].value,I=S.isDataDriven(),b=o.endsWith("pattern")||"line-dasharray"===o;return I||y||b||this._handleOverridablePaintPropertyUpdate(o,C,S)}_handleSpecialPaintPropertyUpdate(o){}getProgramIds(){return null}getDefaultProgramParams(o,a,u){return null}_handleOverridablePaintPropertyUpdate(o,a,u){return!1}isHidden(o){return!!(this.minzoom&&o<this.minzoom)||!!(this.maxzoom&&o>=this.maxzoom)||"none"===this.visibility}updateTransitions(o){this._transitioningPaint=this._transitionablePaint.transitioned(o,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(o,a){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(o,void 0,a)),this.paint=this._transitioningPaint.possiblyEvaluate(o,void 0,a)}serialize(){return ka({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(o,a)=>!(void 0===o||"layout"===a&&!Object.keys(o).length||"paint"===a&&!Object.keys(o).length))}is3D(o){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const o in this.paint._values){const a=this.paint.get(o);if(a instanceof Ku&&fl(a.property.specification)&&("source"===a.value.kind||"composite"===a.value.kind)&&a.value.isStateDependent)return!0}return!1}compileFilter(o){this._filterCompiled||(this._featureFilter=mf(this.filter,this.scope,o),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(o){this._stats&&("shadow"===o.renderPass?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(o){}queryIntersectsFeature(o,a,u,g,p,y,C,S,I){}}const m_={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ju{constructor(o,a){this._structArray=o,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class fr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(o,a){return o._trim(),a&&(o.isTransferred=!0,a.add(o.arrayBuffer)),{length:o.length,arrayBuffer:o.arrayBuffer}}static deserialize(o){const a=Object.create(this.prototype);return a.arrayBuffer=o.arrayBuffer,a.length=o.length,a.capacity=o.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(o){this.reserve(o),this.length=o}reserve(o){if(o>this.capacity){this.capacity=Math.max(o,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...o){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...o){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function ki(d,o=1){let a=0,u=0;return{members:d.map(g=>{const p=m_[g.type].BYTES_PER_ELEMENT,y=a=Nv(a,Math.max(o,p)),C=g.components||1;return u=Math.max(u,p),a+=p*C,{name:g.name,type:g.type,components:C,offset:y}}),size:Nv(a,Math.max(u,o)),alignment:o}}function Nv(d,o){return Math.ceil(d/o)*o}class Yl extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,a){const u=this.length;return this.resize(u+1),this.emplace(u,o,a)}emplace(o,a,u){const g=2*o;return this.int16[g+0]=a,this.int16[g+1]=u,o}}Yl.prototype.bytesPerElement=4,Zt(Yl,"StructArrayLayout2i4");class gl extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,a,u){const g=this.length;return this.resize(g+1),this.emplace(g,o,a,u)}emplace(o,a,u,g){const p=3*o;return this.int16[p+0]=a,this.int16[p+1]=u,this.int16[p+2]=g,o}}gl.prototype.bytesPerElement=6,Zt(gl,"StructArrayLayout3i6");class cd extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,a,u,g){const p=this.length;return this.resize(p+1),this.emplace(p,o,a,u,g)}emplace(o,a,u,g,p){const y=4*o;return this.int16[y+0]=a,this.int16[y+1]=u,this.int16[y+2]=g,this.int16[y+3]=p,o}}cd.prototype.bytesPerElement=8,Zt(cd,"StructArrayLayout4i8");class eh extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o){const a=this.length;return this.resize(a+1),this.emplace(a,o)}emplace(o,a){return this.float32[1*o+0]=a,o}}eh.prototype.bytesPerElement=4,Zt(eh,"StructArrayLayout1f4");class _f extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,a,u){const g=this.length;return this.resize(g+1),this.emplace(g,o,a,u)}emplace(o,a,u,g){const p=4*o,y=2*o;return this.int16[p+0]=a,this.int16[p+1]=u,this.float32[y+1]=g,o}}_f.prototype.bytesPerElement=8,Zt(_f,"StructArrayLayout2i1f8");class g_ extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,a,u){const g=this.length;return this.resize(g+1),this.emplace(g,o,a,u)}emplace(o,a,u,g){const p=4*o;return this.int16[p+0]=a,this.int16[p+1]=u,this.int16[p+2]=g,o}}g_.prototype.bytesPerElement=8,Zt(g_,"StructArrayLayout3i8");class _l extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,a,u,g,p){const y=this.length;return this.resize(y+1),this.emplace(y,o,a,u,g,p)}emplace(o,a,u,g,p,y){const C=5*o;return this.int16[C+0]=a,this.int16[C+1]=u,this.int16[C+2]=g,this.int16[C+3]=p,this.int16[C+4]=y,o}}_l.prototype.bytesPerElement=10,Zt(_l,"StructArrayLayout5i10");class xt extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,a,u,g,p,y,C){const S=this.length;return this.resize(S+1),this.emplace(S,o,a,u,g,p,y,C)}emplace(o,a,u,g,p,y,C,S){const I=6*o,b=12*o,D=3*o;return this.int16[I+0]=a,this.int16[I+1]=u,this.uint8[b+4]=g,this.uint8[b+5]=p,this.uint8[b+6]=y,this.uint8[b+7]=C,this.float32[D+2]=S,o}}xt.prototype.bytesPerElement=12,Zt(xt,"StructArrayLayout2i4ub1f12");class Wn extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,a,u){const g=this.length;return this.resize(g+1),this.emplace(g,o,a,u)}emplace(o,a,u,g){const p=3*o;return this.float32[p+0]=a,this.float32[p+1]=u,this.float32[p+2]=g,o}}Wn.prototype.bytesPerElement=12,Zt(Wn,"StructArrayLayout3f12");class on extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,a,u,g,p){const y=this.length;return this.resize(y+1),this.emplace(y,o,a,u,g,p)}emplace(o,a,u,g,p,y){const C=6*o,S=3*o;return this.uint16[C+0]=a,this.uint16[C+1]=u,this.uint16[C+2]=g,this.uint16[C+3]=p,this.float32[S+2]=y,o}}on.prototype.bytesPerElement=12,Zt(on,"StructArrayLayout4ui1f12");class ln extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,a,u,g){const p=this.length;return this.resize(p+1),this.emplace(p,o,a,u,g)}emplace(o,a,u,g,p){const y=4*o;return this.uint16[y+0]=a,this.uint16[y+1]=u,this.uint16[y+2]=g,this.uint16[y+3]=p,o}}ln.prototype.bytesPerElement=8,Zt(ln,"StructArrayLayout4ui8");class Zi extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,a,u,g,p,y){const C=this.length;return this.resize(C+1),this.emplace(C,o,a,u,g,p,y)}emplace(o,a,u,g,p,y,C){const S=6*o;return this.int16[S+0]=a,this.int16[S+1]=u,this.int16[S+2]=g,this.int16[S+3]=p,this.int16[S+4]=y,this.int16[S+5]=C,o}}Zi.prototype.bytesPerElement=12,Zt(Zi,"StructArrayLayout6i12");class Lm extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,a,u,g,p,y,C,S,I,b,D,k){const T=this.length;return this.resize(T+1),this.emplace(T,o,a,u,g,p,y,C,S,I,b,D,k)}emplace(o,a,u,g,p,y,C,S,I,b,D,k,T){const A=12*o;return this.int16[A+0]=a,this.int16[A+1]=u,this.int16[A+2]=g,this.int16[A+3]=p,this.uint16[A+4]=y,this.uint16[A+5]=C,this.uint16[A+6]=S,this.uint16[A+7]=I,this.int16[A+8]=b,this.int16[A+9]=D,this.int16[A+10]=k,this.int16[A+11]=T,o}}Lm.prototype.bytesPerElement=24,Zt(Lm,"StructArrayLayout4i4ui4i24");class th extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,a,u,g,p,y){const C=this.length;return this.resize(C+1),this.emplace(C,o,a,u,g,p,y)}emplace(o,a,u,g,p,y,C){const S=10*o,I=5*o;return this.int16[S+0]=a,this.int16[S+1]=u,this.int16[S+2]=g,this.float32[I+2]=p,this.float32[I+3]=y,this.float32[I+4]=C,o}}th.prototype.bytesPerElement=20,Zt(th,"StructArrayLayout3i3f20");class Is extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,a,u,g){const p=this.length;return this.resize(p+1),this.emplace(p,o,a,u,g)}emplace(o,a,u,g,p){const y=4*o;return this.float32[y+0]=a,this.float32[y+1]=u,this.float32[y+2]=g,this.float32[y+3]=p,o}}Is.prototype.bytesPerElement=16,Zt(Is,"StructArrayLayout4f16");class yf extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o){const a=this.length;return this.resize(a+1),this.emplace(a,o)}emplace(o,a){return this.uint32[1*o+0]=a,o}}yf.prototype.bytesPerElement=4,Zt(yf,"StructArrayLayout1ul4");class Ec extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,a){const u=this.length;return this.resize(u+1),this.emplace(u,o,a)}emplace(o,a,u){const g=2*o;return this.uint16[g+0]=a,this.uint16[g+1]=u,o}}Ec.prototype.bytesPerElement=4,Zt(Ec,"StructArrayLayout2ui4");class Nm extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,a,u,g,p,y,C,S,I,b,D,k,T){const A=this.length;return this.resize(A+1),this.emplace(A,o,a,u,g,p,y,C,S,I,b,D,k,T)}emplace(o,a,u,g,p,y,C,S,I,b,D,k,T,A){const O=20*o,B=10*o;return this.int16[O+0]=a,this.int16[O+1]=u,this.int16[O+2]=g,this.int16[O+3]=p,this.int16[O+4]=y,this.float32[B+3]=C,this.float32[B+4]=S,this.float32[B+5]=I,this.float32[B+6]=b,this.int16[O+14]=D,this.uint32[B+8]=k,this.uint16[O+18]=T,this.uint16[O+19]=A,o}}Nm.prototype.bytesPerElement=40,Zt(Nm,"StructArrayLayout5i4f1i1ul2ui40");class zm extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,a,u,g,p,y,C){const S=this.length;return this.resize(S+1),this.emplace(S,o,a,u,g,p,y,C)}emplace(o,a,u,g,p,y,C,S){const I=8*o;return this.int16[I+0]=a,this.int16[I+1]=u,this.int16[I+2]=g,this.int16[I+4]=p,this.int16[I+5]=y,this.int16[I+6]=C,this.int16[I+7]=S,o}}zm.prototype.bytesPerElement=16,Zt(zm,"StructArrayLayout3i2i2i16");class zv extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,a,u,g,p){const y=this.length;return this.resize(y+1),this.emplace(y,o,a,u,g,p)}emplace(o,a,u,g,p,y){const C=4*o,S=8*o;return this.float32[C+0]=a,this.float32[C+1]=u,this.float32[C+2]=g,this.int16[S+6]=p,this.int16[S+7]=y,o}}zv.prototype.bytesPerElement=16,Zt(zv,"StructArrayLayout2f1f2i16");class Bm extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,a,u,g,p,y){const C=this.length;return this.resize(C+1),this.emplace(C,o,a,u,g,p,y)}emplace(o,a,u,g,p,y,C){const S=20*o,I=5*o;return this.uint8[S+0]=a,this.uint8[S+1]=u,this.float32[I+1]=g,this.float32[I+2]=p,this.float32[I+3]=y,this.float32[I+4]=C,o}}Bm.prototype.bytesPerElement=20,Zt(Bm,"StructArrayLayout2ub4f20");class Vo extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,a,u){const g=this.length;return this.resize(g+1),this.emplace(g,o,a,u)}emplace(o,a,u,g){const p=3*o;return this.uint16[p+0]=a,this.uint16[p+1]=u,this.uint16[p+2]=g,o}}Vo.prototype.bytesPerElement=6,Zt(Vo,"StructArrayLayout3ui6");class nh extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,a,u,g,p,y,C,S,I,b,D,k,T,A,O,B,V,q,G,H,Z){const ee=this.length;return this.resize(ee+1),this.emplace(ee,o,a,u,g,p,y,C,S,I,b,D,k,T,A,O,B,V,q,G,H,Z)}emplace(o,a,u,g,p,y,C,S,I,b,D,k,T,A,O,B,V,q,G,H,Z,ee){const ie=30*o,me=15*o,ue=60*o;return this.int16[ie+0]=a,this.int16[ie+1]=u,this.int16[ie+2]=g,this.float32[me+2]=p,this.float32[me+3]=y,this.uint16[ie+8]=C,this.uint16[ie+9]=S,this.uint32[me+5]=I,this.uint32[me+6]=b,this.uint32[me+7]=D,this.uint16[ie+16]=k,this.uint16[ie+17]=T,this.uint16[ie+18]=A,this.float32[me+10]=O,this.float32[me+11]=B,this.uint8[ue+48]=V,this.uint8[ue+49]=q,this.uint8[ue+50]=G,this.uint32[me+13]=H,this.int16[ie+28]=Z,this.uint8[ue+58]=ee,o}}nh.prototype.bytesPerElement=60,Zt(nh,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class fs extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,a,u,g,p,y,C,S,I,b,D,k,T,A,O,B,V,q,G,H,Z,ee,ie,me,ue,pe,Te,_e,Ie,Le,Fe,Ve,ze){const We=this.length;return this.resize(We+1),this.emplace(We,o,a,u,g,p,y,C,S,I,b,D,k,T,A,O,B,V,q,G,H,Z,ee,ie,me,ue,pe,Te,_e,Ie,Le,Fe,Ve,ze)}emplace(o,a,u,g,p,y,C,S,I,b,D,k,T,A,O,B,V,q,G,H,Z,ee,ie,me,ue,pe,Te,_e,Ie,Le,Fe,Ve,ze,We){const Ue=20*o,Ze=40*o,ht=80*o;return this.float32[Ue+0]=a,this.float32[Ue+1]=u,this.int16[Ze+4]=g,this.int16[Ze+5]=p,this.int16[Ze+6]=y,this.int16[Ze+7]=C,this.int16[Ze+8]=S,this.int16[Ze+9]=I,this.int16[Ze+10]=b,this.int16[Ze+11]=D,this.int16[Ze+12]=k,this.uint16[Ze+13]=T,this.uint16[Ze+14]=A,this.uint16[Ze+15]=O,this.uint16[Ze+16]=B,this.uint16[Ze+17]=V,this.uint16[Ze+18]=q,this.uint16[Ze+19]=G,this.uint16[Ze+20]=H,this.uint16[Ze+21]=Z,this.uint16[Ze+22]=ee,this.uint16[Ze+23]=ie,this.uint16[Ze+24]=me,this.uint16[Ze+25]=ue,this.uint16[Ze+26]=pe,this.uint16[Ze+27]=Te,this.uint32[Ue+14]=_e,this.float32[Ue+15]=Ie,this.float32[Ue+16]=Le,this.float32[Ue+17]=Fe,this.float32[Ue+18]=Ve,this.uint8[ht+76]=ze,this.uint16[Ze+39]=We,o}}fs.prototype.bytesPerElement=80,Zt(fs,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class wo extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,a,u,g,p){const y=this.length;return this.resize(y+1),this.emplace(y,o,a,u,g,p)}emplace(o,a,u,g,p,y){const C=5*o;return this.float32[C+0]=a,this.float32[C+1]=u,this.float32[C+2]=g,this.float32[C+3]=p,this.float32[C+4]=y,o}}wo.prototype.bytesPerElement=20,Zt(wo,"StructArrayLayout5f20");class vf extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,a,u,g,p,y,C){const S=this.length;return this.resize(S+1),this.emplace(S,o,a,u,g,p,y,C)}emplace(o,a,u,g,p,y,C,S){const I=7*o;return this.float32[I+0]=a,this.float32[I+1]=u,this.float32[I+2]=g,this.float32[I+3]=p,this.float32[I+4]=y,this.float32[I+5]=C,this.float32[I+6]=S,o}}vf.prototype.bytesPerElement=28,Zt(vf,"StructArrayLayout7f28");class ya extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,a,u,g,p,y,C,S,I,b,D){const k=this.length;return this.resize(k+1),this.emplace(k,o,a,u,g,p,y,C,S,I,b,D)}emplace(o,a,u,g,p,y,C,S,I,b,D,k){const T=11*o;return this.float32[T+0]=a,this.float32[T+1]=u,this.float32[T+2]=g,this.float32[T+3]=p,this.float32[T+4]=y,this.float32[T+5]=C,this.float32[T+6]=S,this.float32[T+7]=I,this.float32[T+8]=b,this.float32[T+9]=D,this.float32[T+10]=k,o}}ya.prototype.bytesPerElement=44,Zt(ya,"StructArrayLayout11f44");class Zl extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,a,u,g,p,y,C,S,I){const b=this.length;return this.resize(b+1),this.emplace(b,o,a,u,g,p,y,C,S,I)}emplace(o,a,u,g,p,y,C,S,I,b){const D=9*o;return this.float32[D+0]=a,this.float32[D+1]=u,this.float32[D+2]=g,this.float32[D+3]=p,this.float32[D+4]=y,this.float32[D+5]=C,this.float32[D+6]=S,this.float32[D+7]=I,this.float32[D+8]=b,o}}Zl.prototype.bytesPerElement=36,Zt(Zl,"StructArrayLayout9f36");class Jh extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,a){const u=this.length;return this.resize(u+1),this.emplace(u,o,a)}emplace(o,a,u){const g=2*o;return this.float32[g+0]=a,this.float32[g+1]=u,o}}Jh.prototype.bytesPerElement=8,Zt(Jh,"StructArrayLayout2f8");class ep extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,a,u,g){const p=this.length;return this.resize(p+1),this.emplace(p,o,a,u,g)}emplace(o,a,u,g,p){const y=6*o;return this.uint32[3*o+0]=a,this.uint16[y+2]=u,this.uint16[y+3]=g,this.uint16[y+4]=p,o}}ep.prototype.bytesPerElement=12,Zt(ep,"StructArrayLayout1ul3ui12");class Vm extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o){const a=this.length;return this.resize(a+1),this.emplace(a,o)}emplace(o,a){return this.uint16[1*o+0]=a,o}}Vm.prototype.bytesPerElement=2,Zt(Vm,"StructArrayLayout1ui2");class Um extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,a,u,g,p,y,C,S,I,b,D,k,T,A,O,B){const V=this.length;return this.resize(V+1),this.emplace(V,o,a,u,g,p,y,C,S,I,b,D,k,T,A,O,B)}emplace(o,a,u,g,p,y,C,S,I,b,D,k,T,A,O,B,V){const q=16*o;return this.float32[q+0]=a,this.float32[q+1]=u,this.float32[q+2]=g,this.float32[q+3]=p,this.float32[q+4]=y,this.float32[q+5]=C,this.float32[q+6]=S,this.float32[q+7]=I,this.float32[q+8]=b,this.float32[q+9]=D,this.float32[q+10]=k,this.float32[q+11]=T,this.float32[q+12]=A,this.float32[q+13]=O,this.float32[q+14]=B,this.float32[q+15]=V,o}}Um.prototype.bytesPerElement=64,Zt(Um,"StructArrayLayout16f64");class tp extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,a,u,g,p,y,C){const S=this.length;return this.resize(S+1),this.emplace(S,o,a,u,g,p,y,C)}emplace(o,a,u,g,p,y,C,S){const I=10*o,b=5*o;return this.uint16[I+0]=a,this.uint16[I+1]=u,this.uint16[I+2]=g,this.uint16[I+3]=p,this.float32[b+2]=y,this.float32[b+3]=C,this.float32[b+4]=S,o}}tp.prototype.bytesPerElement=20,Zt(tp,"StructArrayLayout4ui3f20");class np extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o){const a=this.length;return this.resize(a+1),this.emplace(a,o)}emplace(o,a){return this.int16[1*o+0]=a,o}}np.prototype.bytesPerElement=2,Zt(np,"StructArrayLayout1i2");class bf extends fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(o){const a=this.length;return this.resize(a+1),this.emplace(a,o)}emplace(o,a){return this.uint8[1*o+0]=a,o}}bf.prototype.bytesPerElement=1,Zt(bf,"StructArrayLayout1ub1");class ip extends Ju{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}ip.prototype.size=40;class xf extends Nm{get(o){return new ip(this,o)}}Zt(xf,"CollisionBoxArray");class __ extends Ju{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(o){this._structArray.uint8[this._pos1+49]=o}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(o){this._structArray.uint8[this._pos1+50]=o}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(o){this._structArray.uint32[this._pos4+13]=o}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(o){this._structArray.uint8[this._pos1+58]=o}}__.prototype.size=60;class jm extends nh{get(o){return new __(this,o)}}Zt(jm,"PlacedSymbolArray");class y_ extends Ju{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(o){this._structArray.uint32[this._pos4+14]=o}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(o){this._structArray.float32[this._pos4+18]=o}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}y_.prototype.size=80;class v_ extends fs{get(o){return new y_(this,o)}}Zt(v_,"SymbolInstanceArray");class b_ extends eh{getoffsetX(o){return this.float32[1*o+0]}}Zt(b_,"GlyphOffsetArray");class rp extends Yl{getx(o){return this.int16[2*o+0]}gety(o){return this.int16[2*o+1]}}Zt(rp,"SymbolLineVertexArray");class ih extends Ju{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}ih.prototype.size=12;class va extends ep{get(o){return new ih(this,o)}}Zt(va,"FeatureIndexArray");class Ao extends Ec{geta_centroid_pos0(o){return this.uint16[2*o+0]}geta_centroid_pos1(o){return this.uint16[2*o+1]}}Zt(Ao,"FillExtrusionCentroidArray");class nu extends Ju{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}nu.prototype.size=6;class Vr extends gl{get(o){return new nu(this,o)}}Zt(Vr,"FillExtrusionWallArray");const ba=ki([{name:"a_pos",components:2,type:"Int16"}],4),Ex=ki([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class hr{constructor(o=[]){this.segments=o}_prepareSegment(o,a,u,g){let p=this.segments[this.segments.length-1];return o>hr.MAX_VERTEX_ARRAY_LENGTH&&Ir(`Max vertices per segment is ${hr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${o}`),(!p||p.vertexLength+o>hr.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==g)&&(p={vertexOffset:a,primitiveOffset:u,vertexLength:0,primitiveLength:0},void 0!==g&&(p.sortKey=g),this.segments.push(p)),p}prepareSegment(o,a,u,g){return this._prepareSegment(o,a.length,u.length,g)}get(){return this.segments}destroy(){for(const o of this.segments)for(const a in o.vaos)o.vaos[a].destroy()}static simpleSegment(o,a,u,g){return new hr([{vertexOffset:o,primitiveOffset:a,vertexLength:u,primitiveLength:g,vaos:{},sortKey:0}])}}function Bv(d,o){return 256*(d=Qn(Math.floor(d),0,255))+Qn(Math.floor(o),0,255)}hr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Zt(hr,"SegmentVector");const Hm=ki([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Vv=ki([{name:"a_dash",components:4,type:"Uint16"}]);class dd{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(o,a,u,g){this.ids.push(yl(o)),this.positions.push(a,u,g)}eachPosition(o,a){const u=yl(o);let g=0,p=this.ids.length-1;for(;g<p;){const y=g+p>>1;this.ids[y]>=u?p=y:g=y+1}for(;this.ids[g]===u;)a(this.positions[3*g],this.positions[3*g+1],this.positions[3*g+2]),g++}static serialize(o,a){const u=new Float64Array(o.ids),g=new Uint32Array(o.positions);return wf(u,g,0,u.length-1),a&&(a.add(u.buffer),a.add(g.buffer)),{ids:u,positions:g}}static deserialize(o){const a=new dd;let u;a.ids=o.ids,a.positions=o.positions;for(const g of a.ids)g!==u&&a.uniqueIds.push(g),u=g;return a.indexed=!0,a}}function yl(d){const o=+d;return!isNaN(o)&&Number.MIN_SAFE_INTEGER<=o&&o<=Number.MAX_SAFE_INTEGER?o:ll(String(d))}function wf(d,o,a,u){for(;a<u;){const g=d[a+u>>1];let p=a-1,y=u+1;for(;;){do{p++}while(d[p]<g);do{y--}while(d[y]>g);if(p>=y)break;op(d,p,y),op(o,3*p,3*y),op(o,3*p+1,3*y+1),op(o,3*p+2,3*y+2)}y-a<u-y?(wf(d,o,a,y),a=y+1):(wf(d,o,y+1,u),u=y)}}function op(d,o,a){const u=d[o];d[o]=d[a],d[a]=u}Zt(dd,"FeaturePositionMap");class Ha{constructor(o){this.gl=o.gl,this.initialized=!1}fetchUniformLocation(o,a){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(o,a),this.initialized=!0),!!this.location}set(o,a,u){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class iu extends Ha{constructor(o){super(o),this.current=0}set(o,a,u){this.fetchUniformLocation(o,a)&&this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}}class $r extends Ha{constructor(o){super(o),this.current=0}set(o,a,u){this.fetchUniformLocation(o,a)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class $a extends Ha{constructor(o){super(o),this.current=[0,0]}set(o,a,u){this.fetchUniformLocation(o,a)&&(u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1])))}}class rh extends Ha{constructor(o){super(o),this.current=[0,0,0]}set(o,a,u){this.fetchUniformLocation(o,a)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2])))}}class Cf extends Ha{constructor(o){super(o),this.current=[0,0,0,0]}set(o,a,u){this.fetchUniformLocation(o,a)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class oh extends Ha{constructor(o){super(o),this.current=Yi.transparent.toRenderColor(null)}set(o,a,u){this.fetchUniformLocation(o,a)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}const sp=new Float32Array(16);class sh extends Ha{constructor(o){super(o),this.current=sp}set(o,a,u){if(this.fetchUniformLocation(o,a)){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let g=1;g<16;g++)if(u[g]!==this.current[g]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}}}const Ef=new Float32Array(9),Sx=new Float32Array(4);class x_ extends Ha{constructor(o){super(o),this.current=Sx}set(o,a,u){if(this.fetchUniformLocation(o,a))for(let g=0;g<4;g++)if(u[g]!==this.current[g]){this.current=u,this.gl.uniformMatrix2fv(this.location,!1,u);break}}}function w_(d){return[Bv(255*d.r,255*d.g),Bv(255*d.b,255*d.a)]}class $m{constructor(o,a,u,g){this.value=o,this.uniformNames=a.map(p=>`u_${p}`),this.type=u,this.context=g}setUniform(o,a,u,g,p){const y=g.constantOr(this.value);a.set(o,p,y instanceof Yi?y.toRenderColor(this.lutExpression&&"none"===this.lutExpression.value?null:this.context.lut):y)}getBinding(o,a){return"color"===this.type?new oh(o):new $r(o)}}class ap{constructor(o,a){this.uniformNames=a.map(u=>`u_${u}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(o){this.pixelRatio=o.pixelRatio||1,this.pattern=o.tl.concat(o.br)}setUniform(o,a,u,g,p){const y="u_pattern"===p||"u_dash"===p?this.pattern:"u_pixel_ratio"===p?this.pixelRatio:null;y&&a.set(o,p,y)}getBinding(o,a){return"u_pattern"===a||"u_dash"===a?new Cf(o):new $r(o)}}class ud{constructor(o,a,u,g){this.expression=o,this.type=u,this.maxValue=0,this.paintVertexAttributes=a.map(p=>({name:`a_${p}`,type:"Float32",components:"color"===u?2:1,offset:0})),this.paintVertexArray=new g}populatePaintArray(o,a,u,g,p,y,C){const S=this.paintVertexArray.length,I="composite"===this.expression.kind||"source"===this.expression.kind?this.expression.evaluate(new sr(0,{brightness:y}),a,{},p,g,C):"constant"===this.expression.kind&&this.expression.value,b=!!this.lutExpression&&"none"===("composite"===this.lutExpression.kind||"source"===this.lutExpression.kind?this.lutExpression.evaluate(new sr(0,{brightness:y}),a,{},p,g,C):this.lutExpression.value);this.paintVertexArray.resize(o),this._setPaintValue(S,o,I,b?null:this.context.lut)}updatePaintArray(o,a,u,g,p,y,C){const S="composite"===this.expression.kind||"source"===this.expression.kind?this.expression.evaluate({zoom:0,brightness:C},u,g,void 0,p):"constant"===this.expression.kind&&this.expression.value,I=!!this.lutExpression&&"none"===("composite"===this.lutExpression.kind||"source"===this.lutExpression.kind?this.lutExpression.evaluate(new sr(0,{brightness:C}),u,g,void 0,p):this.lutExpression.value);this._setPaintValue(o,a,S,I?null:this.context.lut)}_setPaintValue(o,a,u,g){if("color"===this.type){const p=w_(u.toRenderColor(g));for(let y=o;y<a;y++)this.paintVertexArray.emplace(y,p[0],p[1])}else{for(let p=o;p<a;p++)this.paintVertexArray.emplace(p,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&"constant"!==this.lutExpression.kind&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||"constant"!==this.expression.kind&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class vl{constructor(o,a,u,g,p,y){this.expression=o,this.uniformNames=a.map(C=>`u_${C}_t`),this.type=u,this.useIntegerZoom=g,this.context=p,this.maxValue=0,this.paintVertexAttributes=a.map(C=>({name:`a_${C}`,type:"Float32",components:"color"===u?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(o,a,u,g,p,y,C){const S=this.expression.evaluate(new sr(this.context.zoom,{brightness:y}),a,{},p,g,C),I=this.expression.evaluate(new sr(this.context.zoom+1,{brightness:y}),a,{},p,g,C),b=!!this.lutExpression&&"none"===("composite"===this.lutExpression.kind||"source"===this.lutExpression.kind?this.lutExpression.evaluate(new sr(0,{brightness:y}),a,{},p,g,C):this.lutExpression.value),D=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValue(D,o,S,I,b?null:this.context.lut)}updatePaintArray(o,a,u,g,p,y,C){const S=this.expression.evaluate({zoom:this.context.zoom,brightness:C},u,g,void 0,p),I=this.expression.evaluate({zoom:this.context.zoom+1,brightness:C},u,g,void 0,p),b=!!this.lutExpression&&"none"===("composite"===this.lutExpression.kind||"source"===this.lutExpression.kind?this.lutExpression.evaluate(new sr(0,{brightness:C}),u,g,void 0,p):this.lutExpression.value);this._setPaintValue(o,a,S,I,b?null:this.context.lut)}_setPaintValue(o,a,u,g,p){if("color"===this.type){const y=w_(u.toRenderColor(p)),C=w_(u.toRenderColor(p));for(let S=o;S<a;S++)this.paintVertexArray.emplace(S,y[0],y[1],C[0],C[1])}else{for(let y=o;y<a;y++)this.paintVertexArray.emplace(y,u,g);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(g))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(o,a,u,g,p){const y=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,C=Qn(this.expression.interpolationFactor(y,this.context.zoom,this.context.zoom+1),0,1);a.set(o,p,C)}getBinding(o,a){return new $r(o)}}class hd{constructor(o,a,u,g,p){this.expression=o,this.layerId=p,this.paintVertexAttributes=("array"===u?Vv:Hm).members;for(let y=0;y<a.length;++y);this.paintVertexArray=new g}populatePaintArray(o,a,u,g){const p=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValues(p,o,a.patterns&&a.patterns[this.layerId],u)}updatePaintArray(o,a,u,g,p,y,C){this._setPaintValues(o,a,u.patterns&&u.patterns[this.layerId],y)}_setPaintValues(o,a,u,g){if(!g||!u)return;const p=g[u];if(!p)return;const{tl:y,br:C,pixelRatio:S}=p;for(let I=o;I<a;I++)this.paintVertexArray.emplace(I,y[0],y[1],C[0],C[1],S)}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class bl{constructor(o,a,u=()=>!0){this.binders={},this._buffers=[],this.context=a;const g=[];for(const p in o.paint._values){const y=o.paint.get(p);if(p.endsWith("-use-theme")||!u(p)||!(y instanceof Ku&&fl(y.property.specification)))continue;const C=Sf(p,o.type),S=y.value,I=y.property.specification.type,b=!!y.property.useIntegerZoom,D="line-dasharray"===p||p.endsWith("pattern"),k=o.paint.get(`${p}-use-theme`),T="line-dasharray"===p&&"constant"!==o.layout.get("line-cap").value.kind||k&&"constant"!==k.value.kind;if("constant"!==S.kind||T)if("source"===S.kind||T||D){const A=Gm(p,I,"source");this.binders[p]=D?new hd(S,C,I,A,o.id):new ud(S,C,I,A),g.push(`/a_${p}`)}else{const A=Gm(p,I,"composite");this.binders[p]=new vl(S,C,I,b,a,A),g.push(`/z_${p}`)}else this.binders[p]=D?new ap(S.value,C):new $m(S.value,C,I,a),g.push(`/u_${p}`);k&&(this.binders[p].lutExpression=k.value)}this.cacheKey=g.sort().join("")}getMaxValue(o){const a=this.binders[o];return a instanceof ud||a instanceof vl?a.maxValue:0}populatePaintArrays(o,a,u,g,p,y,C){for(const S in this.binders){const I=this.binders[S];I.context=this.context,(I instanceof ud||I instanceof vl||I instanceof hd)&&I.populatePaintArray(o,a,u,g,p,y,C)}}setConstantPatternPositions(o){for(const a in this.binders){const u=this.binders[a];u instanceof ap&&u.setConstantPatternPositions(o)}}updatePaintArrays(o,a,u,g,p,y,C,S,I){let b=!1;const D=Object.keys(o),k=0!==D.length&&!S,T=k?D:a.uniqueIds;this.context.lut=p.lut;for(const A in this.binders){const O=this.binders[A];if(O.context=this.context,(O instanceof ud||O instanceof vl||O instanceof hd)&&O.expression&&O.expression.kind&&"constant"!==O.expression.kind&&(!0===O.expression.isStateDependent||!1===O.expression.isLightConstant)){const B=p.paint.get(A);O.expression=B.value;for(const V of T){const q=o[V.toString()];a.eachPosition(V,(G,H,Z)=>{const ee=g.feature(G);O.updatePaintArray(H,Z,ee,q,y,C,I)})}if(!k)for(const V of u.uniqueIds){const q=o[V.toString()];u.eachPosition(V,(G,H,Z)=>{const ee=g.feature(G);O.updatePaintArray(H,Z,ee,q,y,C,I)})}b=!0}}return b}defines(){const o=[];for(const a in this.binders){const u=this.binders[a];(u instanceof $m||u instanceof ap)&&o.push(...u.uniformNames.map(g=>`#define HAS_UNIFORM_${g}`))}return o}getBinderAttributes(){const o=[];for(const a in this.binders){const u=this.binders[a];if(u instanceof ud||u instanceof vl||u instanceof hd)for(let g=0;g<u.paintVertexAttributes.length;g++)o.push(u.paintVertexAttributes[g].name)}return o}getBinderUniforms(){const o=[];for(const a in this.binders){const u=this.binders[a];if(u instanceof $m||u instanceof ap||u instanceof vl)for(const g of u.uniformNames)o.push(g)}return o}getPaintVertexBuffers(){return this._buffers}getUniforms(o){const a=[];for(const u in this.binders){const g=this.binders[u];if(g instanceof $m||g instanceof ap||g instanceof vl)for(const p of g.uniformNames)a.push({name:p,property:u,binding:g.getBinding(o,p)})}return a}setUniforms(o,a,u,g,p){for(const{name:y,property:C,binding:S}of u)this.binders[C].setUniform(o,S,p,g.get(C),y)}updatePaintBuffers(){this._buffers=[];for(const o in this.binders){const a=this.binders[o];(a instanceof ud||a instanceof vl||a instanceof hd)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(o){for(const a in this.binders){const u=this.binders[a];(u instanceof ud||u instanceof vl||u instanceof hd)&&u.upload(o)}this.updatePaintBuffers()}destroy(){for(const o in this.binders){const a=this.binders[o];(a instanceof ud||a instanceof vl||a instanceof hd)&&a.destroy()}}}class pd{constructor(o,a,u=()=>!0){this.programConfigurations={};for(const g of o)this.programConfigurations[g.id]=new bl(g,a,u);this.needsUpload=!1,this._featureMap=new dd,this._featureMapWithoutIds=new dd,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(o,a,u,g,p,y,C,S){for(const I in this.programConfigurations)this.programConfigurations[I].populatePaintArrays(o,a,g,p,y,C,S);void 0!==a.id?this._featureMap.add(a.id,u,this._bufferOffset,o):(this._featureMapWithoutIds.add(this._idlessCounter,u,this._bufferOffset,o),this._idlessCounter+=1),this._bufferOffset=o,this.needsUpload=!0}updatePaintArrays(o,a,u,g,p,y,C){for(const S of u)this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(o,this._featureMap,this._featureMapWithoutIds,a,S,g,p,y,C||0)||this.needsUpload}get(o){return this.programConfigurations[o]}upload(o){if(this.needsUpload){for(const a in this.programConfigurations)this.programConfigurations[a].upload(o);this.needsUpload=!1}}destroy(){for(const o in this.programConfigurations)this.programConfigurations[o].destroy()}}const C_={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Sf(d,o){return C_[d]||[d.replace(`${o}-`,"").replace(/-/g,"_")]}const Dx={"line-pattern":{source:on,composite:on},"fill-pattern":{source:on,composite:on},"fill-extrusion-pattern":{source:on,composite:on},"line-dasharray":{source:ln,composite:ln}},ru={color:{source:Jh,composite:Is},number:{source:eh,composite:Jh}};function Gm(d,o,a){const u=Dx[d];return u&&u[a]||ru[o][a]}Zt($m,"ConstantBinder"),Zt(ap,"PatternConstantBinder"),Zt(ud,"SourceExpressionBinder"),Zt(hd,"PatternCompositeBinder"),Zt(vl,"CompositeExpressionBinder"),Zt(bl,"ProgramConfiguration",{omit:["_buffers"]}),Zt(pd,"ProgramConfigurationSet");const ts=kt/Math.PI/2,Ga=[64,32,16],qa=-ts,Us=ts;function ou(d,o,a,u=ts){return a=yi(a),[d*Math.sin(a)*u,-o*u,d*Math.cos(a)*u]}function su(d,o,a){return ou(Math.cos(yi(d)),Math.sin(yi(d)),o,a)}const Sc=6371008.8,Mf=2*Math.PI*Sc;class Ri{constructor(o,a){if(isNaN(o)||isNaN(a))throw new Error(`Invalid LngLat object: (${o}, ${a})`);if(this.lng=+o,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ri(Dr(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(o){const a=Math.PI/180,u=this.lat*a,g=o.lat*a,p=Math.sin(u)*Math.sin(g)+Math.cos(u)*Math.cos(g)*Math.cos((o.lng-this.lng)*a);return Sc*Math.acos(Math.min(p,1))}toBounds(o=0){const a=360*o/40075017,u=a/Math.cos(Math.PI/180*this.lat);return new fd({lng:this.lng-u,lat:this.lat-a},{lng:this.lng+u,lat:this.lat+a})}toEcef(o){return su(this.lat,this.lng,ts+o*ts/Sc)}static convert(o){if(o instanceof Ri)return o;if(Array.isArray(o)&&(2===o.length||3===o.length))return new Ri(Number(o[0]),Number(o[1]));if(!Array.isArray(o)&&"object"==typeof o&&null!==o)return new Ri(Number("lng"in o?o.lng:o.lon),Number(o.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class fd{constructor(o,a){if(o)if(a)this.setSouthWest(o).setNorthEast(a);else if(4===o.length){const u=o;this.setSouthWest([u[0],u[1]]).setNorthEast([u[2],u[3]])}else{const u=o;this.setSouthWest(u[0]).setNorthEast(u[1])}}setNorthEast(o){return this._ne=o instanceof Ri?new Ri(o.lng,o.lat):Ri.convert(o),this}setSouthWest(o){return this._sw=o instanceof Ri?new Ri(o.lng,o.lat):Ri.convert(o),this}extend(o){const a=this._sw,u=this._ne;let g,p;if(o instanceof Ri)g=o,p=o;else{if(!(o instanceof fd))return Array.isArray(o)?4===o.length||o.every(Array.isArray)?this.extend(fd.convert(o)):this.extend(Ri.convert(o)):"object"==typeof o&&null!==o&&o.hasOwnProperty("lat")&&(o.hasOwnProperty("lon")||o.hasOwnProperty("lng"))?this.extend(Ri.convert(o)):this;if(g=o._sw,p=o._ne,!g||!p)return this}return a||u?(a.lng=Math.min(g.lng,a.lng),a.lat=Math.min(g.lat,a.lat),u.lng=Math.max(p.lng,u.lng),u.lat=Math.max(p.lat,u.lat)):(this._sw=new Ri(g.lng,g.lat),this._ne=new Ri(p.lng,p.lat)),this}getCenter(){return new Ri((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Ri(this.getWest(),this.getNorth())}getSouthEast(){return new Ri(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){const{lng:a,lat:u}=Ri.convert(o);let g=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&g}static convert(o){if(o)return o instanceof fd?o:new fd(o)}}function Tf(d){return Mf*Math.cos(d*Math.PI/180)}function Dc(d){return(180+d)/360}function As(d){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+d*Math.PI/360)))/360}function Co(d,o){return d/Tf(o)}function xa(d){return 360*d-180}function Uo(d){return 360/Math.PI*Math.atan(Math.exp((180-360*d)*Math.PI/180))-90}function qm(d,o){return d*Tf(Uo(o))}const br=85.051129;function au(d){return Math.cos(yi(Qn(d,-br,br)))}function Ur(d,o){const a=Qn(o,0,25.5),u=Math.pow(2,a);return au(d)*Mf/(512*u)}function Mx(d){return 1/Math.cos(d*Math.PI/180)}function m(d,o=0){const a=Math.exp(Math.PI*(1-(d.y+o/kt)/(1<<d.z)*2));return 80150034*a/(a*a+1)/kt/(1<<d.z)}class s{constructor(o,a,u=0){this.x=+o,this.y=+a,this.z=+u}static fromLngLat(o,a=0){const u=Ri.convert(o);return new s(Dc(u.lng),As(u.lat),Co(a,u.lat))}toLngLat(){return new Ri(xa(this.x),Uo(this.y))}toAltitude(){return qm(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Mf*Mx(Uo(this.y))}}function c(d,o,a,u,g,p,y,C,S){const I=(o+u)/2,b=(a+g)/2,D=new Ot(I,b);C(D),function(k,T,A,O,B,V){const q=A-B,G=O-V;return Math.abs((O-T)*q-(A-k)*G)/Math.hypot(q,G)}(D.x,D.y,p.x,p.y,y.x,y.y)>=S?(c(d,o,a,I,b,p,D,C,S),c(d,I,b,u,g,D,y,C,S)):d.push(y)}function _(d,o,a){let u=d[0],g=u.x,p=u.y;o(u);const y=[u];for(let C=1;C<d.length;C++){const S=d[C],{x:I,y:b}=S;o(S),c(y,g,p,I,b,u,S,o,a),g=I,p=b,u=S}return y}function v(d,o,a,u){if(u(o,a)){const g=o.add(a)._mult(.5);v(d,o,g,u),v(d,g,a,u)}else d.push(a)}function x(d,o){let a=d[0];const u=[a];for(let g=1;g<d.length;g++){const p=d[g];v(u,a,p,o),a=p}return u}const E=Math.pow(2,14)-1,R=-E-1;function F(d,o){const a=Math.round(d.x*o),u=Math.round(d.y*o);return d.x=Qn(a,R,E),d.y=Qn(u,R,E),(a<d.x||a>d.x+1||u<d.y||u>d.y+1)&&Ir("Geometry exceeds allowed extent, reduce your vector tile buffer size"),d}function N(d,o,a){const u=d.loadGeometry(),g=d.extent,p=kt/g;if(o&&a&&a.projection.isReprojectedInTileSpace){const y=1<<o.z,{scale:C,x:S,y:I,projection:b}=a,D=k=>{const T=xa((o.x+k.x/g)/y),A=Uo((o.y+k.y/g)/y),O=b.project(T,A);k.x=(O.x*C-S)*g,k.y=(O.y*C-I)*g};for(let k=0;k<u.length;k++)if(1!==d.type)u[k]=_(u[k],D,1);else{const T=[];for(const A of u[k])A.x<0||A.x>=g||A.y<0||A.y>=g||(D(A),T.push(A));u[k]=T}}for(const y of u)for(const C of y)F(C,p);return u}function z(d,o){return{type:d.type,id:d.id,properties:d.properties,geometry:o?N(d):[]}}function U(d,o,a,u,g){d.emplaceBack(2*o+(u+1)/2,2*a+(g+1)/2)}function j(d,o,a){d.emplaceBack(o.x,o.y,o.z,16384*a[0],16384*a[1],16384*a[2])}class W{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=o.index,this.hasPattern=!1,this.projection=o.projection,this.layoutVertexArray=new Yl,this.indexArray=new Vo,this.segments=new hr,this.programConfigurations=new pd(o.layers,{zoom:o.zoom,lut:o.lut}),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}updateFootprints(o,a){}populate(o,a,u,g){const p=this.layers[0],y=[];let C=null;"circle"===p.type&&(C=p.layout.get("circle-sort-key"));for(const{feature:I,id:b,index:D,sourceLayerIndex:k}of o){const T=this.layers[0]._featureFilter.needGeometry,A=z(I,T);if(!this.layers[0]._featureFilter.filter(new sr(this.zoom),A,u))continue;const O=C?C.evaluate(A,{},u):void 0,B={id:b,properties:I.properties,type:I.type,sourceLayerIndex:k,index:D,geometry:T?A.geometry:N(I,u,g),patterns:{},sortKey:O};y.push(B)}C&&y.sort((I,b)=>I.sortKey-b.sortKey);let S=null;"globe"===g.projection.name&&(this.globeExtVertexArray=new Zi,S=g.projection);for(const I of y){const{geometry:b,index:D,sourceLayerIndex:k}=I,T=o[D].feature;this.addFeature(I,b,D,a.availableImages,u,S,a.brightness),a.featureIndex.insert(T,b,D,k,this.index)}}update(o,a,u,g,p,y,C){this.programConfigurations.updatePaintArrays(o,a,p,u,g,y,C)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,ba.members),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,Ex.members))),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(o,a,u,g,p,y,C){for(const S of a)for(const I of S){const b=I.x,D=I.y;if(b<0||b>=kt||D<0||D>=kt)continue;if(y){const A=y.projectTilePoint(b,D,p),O=y.upVector(p,b,D),B=this.globeExtVertexArray;j(B,A,O),j(B,A,O),j(B,A,O),j(B,A,O)}const k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,o.sortKey),T=k.vertexLength;U(this.layoutVertexArray,b,D,-1,-1),U(this.layoutVertexArray,b,D,1,-1),U(this.layoutVertexArray,b,D,1,1),U(this.layoutVertexArray,b,D,-1,1),this.indexArray.emplaceBack(T,T+1,T+2),this.indexArray.emplaceBack(T,T+2,T+3),k.vertexLength+=4,k.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,u,{},g,p,C)}}function ne(d,o){for(let a=0;a<d.length;a++)if(De(o,d[a]))return!0;for(let a=0;a<o.length;a++)if(De(d,o[a]))return!0;return!!fe(d,o)}function J(d,o,a){return!!De(d,o)||!!ve(o,d,a)}function oe(d,o){if(1===d.length)return Ee(o,d[0]);for(let a=0;a<o.length;a++){const u=o[a];for(let g=0;g<u.length;g++)if(De(d,u[g]))return!0}for(let a=0;a<d.length;a++)if(Ee(o,d[a]))return!0;for(let a=0;a<o.length;a++)if(fe(d,o[a]))return!0;return!1}function se(d,o,a){if(d.length>1){if(fe(d,o))return!0;for(let u=0;u<o.length;u++)if(ve(o[u],d,a))return!0}for(let u=0;u<d.length;u++)if(ve(d[u],o,a))return!0;return!1}function fe(d,o){if(0===d.length||0===o.length)return!1;for(let a=0;a<d.length-1;a++){const u=d[a],g=d[a+1];for(let p=0;p<o.length-1;p++)if(be(u,g,o[p],o[p+1]))return!0}return!1}function be(d,o,a,u){return ir(d,a,u)!==ir(o,a,u)&&ir(d,o,a)!==ir(d,o,u)}function ve(d,o,a){const u=a*a;if(1===o.length)return d.distSqr(o[0])<u;for(let g=1;g<o.length;g++)if(we(d,o[g-1],o[g])<u)return!0;return!1}function we(d,o,a){const u=o.distSqr(a);if(0===u)return d.distSqr(o);const g=((d.x-o.x)*(a.x-o.x)+(d.y-o.y)*(a.y-o.y))/u;return d.distSqr(g<0?o:g>1?a:a.sub(o)._mult(g)._add(o))}function Ee(d,o){let a,u,g,p=!1;for(let y=0;y<d.length;y++){a=d[y];for(let C=0,S=a.length-1;C<a.length;S=C++)u=a[C],g=a[S],u.y>o.y!=g.y>o.y&&o.x<(g.x-u.x)*(o.y-u.y)/(g.y-u.y)+u.x&&(p=!p)}return p}function De(d,o){let a=!1;for(let u=0,g=d.length-1;u<d.length;g=u++){const p=d[u],y=d[g];p.y>o.y!=y.y>o.y&&o.x<(y.x-p.x)*(o.y-p.y)/(y.y-p.y)+p.x&&(a=!a)}return a}function Me(d,o,a,u,g){for(const y of d)if(o<=y.x&&a<=y.y&&u>=y.x&&g>=y.y)return!0;const p=[new Ot(o,a),new Ot(o,g),new Ot(u,g),new Ot(u,a)];if(d.length>2)for(const y of p)if(De(d,y))return!0;for(let y=0;y<d.length-1;y++)if(ke(d[y],d[y+1],p))return!0;return!1}function ke(d,o,a){const u=a[0],g=a[2];if(d.x<u.x&&o.x<u.x||d.x>g.x&&o.x>g.x||d.y<u.y&&o.y<u.y||d.y>g.y&&o.y>g.y)return!1;const p=ir(d,o,a[0]);return p!==ir(d,o,a[1])||p!==ir(d,o,a[2])||p!==ir(d,o,a[3])}function Oe(d,o,a,u,g,p){let y=o.y-d.y,C=d.x-o.x;if(p=p||0){const S=y*y+C*C;if(0===S)return!0;const I=Math.sqrt(S);y/=I,C/=I}return!((a.x-d.x)*y+(a.y-d.y)*C-p<0||(u.x-d.x)*y+(u.y-d.y)*C-p<0||(g.x-d.x)*y+(g.y-d.y)*C-p<0)}function et(d,o,a,u,g,p,y){return!(Oe(d,o,u,g,p,y)||Oe(o,a,u,g,p,y)||Oe(a,d,u,g,p,y)||Oe(u,g,d,o,a,y)||Oe(g,p,d,o,a,y)||Oe(p,u,d,o,a,y))}function qe(d,o,a){const u=o.paint.get(d).value;return"constant"===u.kind?u.value:a.programConfigurations.get(o.id).getMaxValue(d)}function ot(d){return Math.sqrt(d[0]*d[0]+d[1]*d[1])}function lt(d,o,a,u,g){if(!o[0]&&!o[1])return d;const p=Ot.convert(o)._mult(g);"viewport"===a&&p._rotate(-u);const y=[];for(let C=0;C<d.length;C++)y.push(d[C].sub(p));return y}function Ct(d,o,a,u){const g=Ot.convert(d)._mult(u);return"viewport"===o&&g._rotate(-a),g}let He,st;Zt(W,"CircleBucket",{omit:["layers"]});var Be,at={exports:{}},rt=(Be||(Be=1,function(a){function u(p,y,C){var S=g(256*p,256*(y=Math.pow(2,C)-y-1),C),I=g(256*(p+1),256*(y+1),C);return S[0]+","+S[1]+","+I[0]+","+I[1]}function g(p,y,C){var S=2*Math.PI*6378137/256/Math.pow(2,C);return[p*S-2*Math.PI*6378137/2,y*S-2*Math.PI*6378137/2]}a.getURL=function(p,y,C,S,I,b){return b=b||{},p+"?"+["bbox="+u(C,S,I),"format="+(b.format||"image/png"),"service="+(b.service||"WMS"),"version="+(b.version||"1.1.1"),"request="+(b.request||"GetMap"),"srs="+(b.srs||"EPSG:3857"),"width="+(b.width||256),"height="+(b.height||256),"layers="+y].join("&")},a.getTileBBox=u,a.getMercCoords=g,Object.defineProperty(a,"__esModule",{value:!0})}(at.exports)),at.exports);class $e{constructor(o,a,u){this.z=o,this.x=a,this.y=u,this.key=Ft(0,o,o,a,u)}equals(o){return this.z===o.z&&this.x===o.x&&this.y===o.y}url(o,a){const u=rt.getTileBBox(this.x,this.y,this.z),g=function(p,y,C){let S,I="";for(let b=p;b>0;b--)S=1<<b-1,I+=(y&S?1:0)+(C&S?2:0);return I}(this.z,this.x,this.y);return o[(this.x+this.y)%o.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===a?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",g).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Je{constructor(o,a){this.wrap=o,this.canonical=a,this.key=Ft(o,a.z,a.z,a.x,a.y)}}class dt{constructor(o,a,u,g,p){this.overscaledZ=o,this.wrap=a,this.canonical=new $e(u,+g,+p),this.key=0===a&&o===u?this.canonical.key:Ft(a,o,u,g,p)}equals(o){return this.overscaledZ===o.overscaledZ&&this.wrap===o.wrap&&this.canonical.equals(o.canonical)}scaledTo(o){const a=this.canonical.z-o;return o>this.canonical.z?new dt(o,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new dt(o,this.wrap,o,this.canonical.x>>a,this.canonical.y>>a)}calculateScaledKey(o,a=!0){if(this.overscaledZ===o&&a)return this.key;if(o>this.canonical.z)return Ft(this.wrap*+a,o,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-o;return Ft(this.wrap*+a,o,o,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(o){if(o.wrap!==this.wrap)return!1;const a=this.canonical.z-o.canonical.z;return 0===o.overscaledZ||o.overscaledZ<this.overscaledZ&&o.canonical.z<this.canonical.z&&o.canonical.x===this.canonical.x>>a&&o.canonical.y===this.canonical.y>>a}children(o){if(this.overscaledZ>=o)return[new dt(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const a=this.canonical.z+1,u=2*this.canonical.x,g=2*this.canonical.y;return[new dt(a,this.wrap,a,u,g),new dt(a,this.wrap,a,u+1,g),new dt(a,this.wrap,a,u,g+1),new dt(a,this.wrap,a,u+1,g+1)]}isLessThan(o){return this.wrap<o.wrap||!(this.wrap>o.wrap)&&(this.overscaledZ<o.overscaledZ||!(this.overscaledZ>o.overscaledZ)&&(this.canonical.x<o.canonical.x||!(this.canonical.x>o.canonical.x)&&this.canonical.y<o.canonical.y))}wrapped(){return new dt(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(o){return new dt(this.overscaledZ,o,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Je(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Ft(d,o,a,u,g){const p=1<<Math.min(a,22);let y=p*(g%p)+u%p;return d&&a<22&&(y+=p*p*((d<0?-2*d-1:2*d)%(1<<2*(22-a)))),16*(32*y+a)+(o-a)}const zt=[d=>{let o=d.canonical.x-1,a=d.wrap;return o<0&&(o=(1<<d.canonical.z)-1,a--),new dt(d.overscaledZ,a,d.canonical.z,o,d.canonical.y)},d=>{let o=d.canonical.x+1,a=d.wrap;return o===1<<d.canonical.z&&(o=0,a++),new dt(d.overscaledZ,a,d.canonical.z,o,d.canonical.y)},d=>new dt(d.overscaledZ,d.wrap,d.canonical.z,d.canonical.x,(0===d.canonical.y?1<<d.canonical.z:d.canonical.y)-1),d=>new dt(d.overscaledZ,d.wrap,d.canonical.z,d.canonical.x,d.canonical.y===(1<<d.canonical.z)-1?0:d.canonical.y+1)];Zt($e,"CanonicalTileID"),Zt(dt,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Bt=ki([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:en}=Bt,In=ki([{name:"a_pos_3",components:3,type:"Int16"}]);var wt=ki([{name:"a_pos",type:"Int16",components:2}]);class Tn{constructor(o,a){this.pos=o,this.dir=a}intersectsPlane(o,a,u){const g=ge.vec2.dot(a,this.dir);if(Math.abs(g)<1e-6)return!1;const p=((o[0]-this.pos[0])*a[0]+(o[1]-this.pos[1])*a[1])/g;return u[0]=this.pos[0]+this.dir[0]*p,u[1]=this.pos[1]+this.dir[1]*p,!0}}class vn{constructor(o,a){this.pos=o,this.dir=a}intersectsPlane(o,a,u){const g=ge.vec3.dot(a,this.dir);if(Math.abs(g)<1e-6)return!1;const p=((o[0]-this.pos[0])*a[0]+(o[1]-this.pos[1])*a[1]+(o[2]-this.pos[2])*a[2])/g;return u[0]=this.pos[0]+this.dir[0]*p,u[1]=this.pos[1]+this.dir[1]*p,u[2]=this.pos[2]+this.dir[2]*p,!0}closestPointOnSphere(o,a,u){if(ge.vec3.equals(this.pos,o)||0===a)return u[0]=u[1]=u[2]=0,!1;const[g,p,y]=this.dir,C=this.pos[0]-o[0],S=this.pos[1]-o[1],I=this.pos[2]-o[2],b=g*g+p*p+y*y,D=2*(C*g+S*p+I*y),k=D*D-4*b*(C*C+S*S+I*I-a*a);if(k<0){const T=Math.max(-D/2,0),A=C+g*T,O=S+p*T,B=I+y*T,V=Math.hypot(A,O,B);return u[0]=A*a/V,u[1]=O*a/V,u[2]=B*a/V,!1}{const T=(-D-Math.sqrt(k))/(2*b);if(T<0){const A=Math.hypot(C,S,I);return u[0]=C*a/A,u[1]=S*a/A,u[2]=I*a/A,!1}return u[0]=C+g*T,u[1]=S+p*T,u[2]=I+y*T,!0}}}class di{constructor(o,a,u,g,p){this.TL=o,this.TR=a,this.BR=u,this.BL=g,this.horizon=p}static fromInvProjectionMatrix(o,a,u){const g=[-1,1,1],p=[1,1,1],y=[1,-1,1],C=[-1,-1,1],S=ge.vec3.transformMat4(g,g,o),I=ge.vec3.transformMat4(p,p,o),b=ge.vec3.transformMat4(y,y,o),D=ge.vec3.transformMat4(C,C,o);return new di(S,I,b,D,a/u)}}function Pi(d,o,a){let u=1/0,g=-1/0;const p=[];for(const y of d){ge.vec3.sub(p,y,o);const C=ge.vec3.dot(p,a);u=Math.min(u,C),g=Math.max(g,C)}return[u,g]}function ar(d,o){let a=!0;for(let u=0;u<d.planes.length;u++){const g=d.planes[u];let p=0;for(let y=0;y<o.length;y++)p+=ge.vec3.dot(g,o[y])+g[3]>=0;if(0===p)return 0;p!==o.length&&(a=!1)}return a?2:1}function Yn(d,o){for(const a of d.projections){const u=Pi(o,d.points[0],a.axis);if(a.projection[1]<u[0]||a.projection[0]>u[1])return 0}return 1}function xr(d,o){let a=0;const u=[0,0,0,0];for(let g=0;g<d.length;g++)u[0]=d[g][0],u[1]=d[g][1],u[2]=d[g][2],u[3]=1,ge.vec4.dot(u,o)>=0&&a++;return a}class An{constructor(o,a){this.points=o||new Array(8).fill([0,0,0]),this.planes=a||new Array(6).fill([0,0,0,0]),this.bounds=tn.fromPoints(this.points),this.projections=[],this.frustumEdges=[ge.vec3.sub([],this.points[2],this.points[3]),ge.vec3.sub([],this.points[0],this.points[3]),ge.vec3.sub([],this.points[4],this.points[0]),ge.vec3.sub([],this.points[5],this.points[1]),ge.vec3.sub([],this.points[6],this.points[2]),ge.vec3.sub([],this.points[7],this.points[3])];for(const u of this.frustumEdges){const g=[0,-u[2],u[1]],p=[u[2],0,-u[0]];this.projections.push({axis:g,projection:Pi(this.points,this.points[0],g)}),this.projections.push({axis:p,projection:Pi(this.points,this.points[0],p)})}}static fromInvProjectionMatrix(o,a,u,g){const p=Math.pow(2,u),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(I=>{const b=ge.vec4.transformMat4([],I,o),D=1/b[3]/a*p;return ge.vec4.mul(b,b,[D,D,g?1/b[3]:D,D])}),C=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(I=>{const b=ge.vec3.sub([],y[I[0]],y[I[1]]),D=ge.vec3.sub([],y[I[2]],y[I[1]]),k=ge.vec3.normalize([],ge.vec3.cross([],b,D)),T=-ge.vec3.dot(k,y[I[1]]);return k.concat(T)}),S=[];for(let I=0;I<y.length;I++)S.push([y[I][0],y[I][1],y[I][2]]);return new An(S,C)}intersectsPrecise(o,a,u){for(let g=0;g<a.length;g++)if(!xr(o,a[g]))return 0;for(let g=0;g<this.planes.length;g++)if(!xr(o,this.planes[g]))return 0;for(const g of u)for(const p of this.frustumEdges){const y=ge.vec3.cross([],g,p),C=ge.vec3.length(y);if(0===C)continue;ge.vec3.scale(y,y,1/C);const S=Pi(this.points,this.points[0],y),I=Pi(o,this.points[0],y);if(S[0]>I[1]||I[0]>S[1])return 0}return 1}containsPoint(o){for(const a of this.planes){const u=a[3];if(ge.vec3.dot([a[0],a[1],a[2]],o)+u<0)return!1}return!0}}class tn{static fromPoints(o){const a=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(const g of o)ge.vec3.min(a,a,g),ge.vec3.max(u,u,g);return new tn(a,u)}static fromTileIdAndHeight(o,a,u){const g=1<<o.canonical.z,p=o.canonical.x,y=o.canonical.y;return new tn([p/g,y/g,a],[(p+1)/g,(y+1)/g,u])}static applyTransform(o,a){const u=o.getCorners();for(let g=0;g<u.length;++g)ge.vec3.transformMat4(u[g],u[g],a);return tn.fromPoints(u)}static applyTransformFast(o,a){const u=[a[12],a[13],a[14]],g=[...u];for(let p=0;p<3;p++)for(let y=0;y<3;y++){const C=a[4*y+p],S=C*o.min[y],I=C*o.max[y];u[p]+=Math.min(S,I),g[p]+=Math.max(S,I)}return new tn(u,g)}static projectAabbCorners(o,a){const u=o.getCorners();for(let g=0;g<u.length;++g)ge.vec3.transformMat4(u[g],u[g],a);return u}constructor(o,a){this.min=o,this.max=a,this.center=ge.vec3.scale([],ge.vec3.add([],this.min,this.max),.5)}quadrant(o){const a=[o%2==0,o<2],u=ge.vec3.clone(this.min),g=ge.vec3.clone(this.max);for(let p=0;p<a.length;p++)u[p]=a[p]?this.min[p]:this.center[p],g[p]=a[p]?this.center[p]:this.max[p];return g[2]=this.max[2],new tn(u,g)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}distanceZ(o){return Math.max(Math.min(this.max[2],o[2]),this.min[2])-o[2]}getCorners(){const o=this.min,a=this.max;return[[o[0],o[1],o[2]],[a[0],o[1],o[2]],[a[0],a[1],o[2]],[o[0],a[1],o[2]],[o[0],o[1],a[2]],[a[0],o[1],a[2]],[a[0],a[1],a[2]],[o[0],a[1],a[2]]]}intersects(o){return this.intersectsAabb(o.bounds)?ar(o,this.getCorners()):0}intersectsFlat(o){return this.intersectsAabb(o.bounds)?ar(o,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(o,a){return a||this.intersects(o)?Yn(o,this.getCorners()):0}intersectsPreciseFlat(o,a){return a||this.intersectsFlat(o)?Yn(o,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(o){for(let a=0;a<3;++a)if(this.min[a]>o.max[a]||o.min[a]>this.max[a])return!1;return!0}intersectsAabbXY(o){return!(this.min[0]>o.max[0]||o.min[0]>this.max[0]||this.min[1]>o.max[1]||o.min[1]>this.max[1])}encapsulate(o){for(let a=0;a<3;a++)this.min[a]=Math.min(this.min[a],o.min[a]),this.max[a]=Math.max(this.max[a],o.max[a])}encapsulatePoint(o){for(let a=0;a<3;a++)this.min[a]=Math.min(this.min[a],o[a]),this.max[a]=Math.max(this.max[a],o[a])}closestPoint(o){return[Math.max(Math.min(this.max[0],o[0]),this.min[0]),Math.max(Math.min(this.max[1],o[1]),this.min[1]),Math.max(Math.min(this.max[2],o[2]),this.min[2])]}}function gi(d){return d*ts/Sc}Zt(tn,"Aabb");const Vi=[new tn([qa,qa,qa],[Us,Us,Us]),new tn([qa,qa,qa],[0,0,Us]),new tn([0,qa,qa],[Us,0,Us]),new tn([qa,0,qa],[0,Us,Us]),new tn([0,0,qa],[Us,Us,Us])];function Ei(d,o,a,u=!0){const g=ge.vec3.scale([],d._camera.position,d.worldSize),p=[o,a,1,1];ge.vec4.transformMat4(p,p,d.pixelMatrixInverse),ge.vec4.scale(p,p,1/p[3]);const y=ge.vec3.sub([],p,g),C=ge.vec3.normalize([],y),S=d.globeMatrix,I=[S[12],S[13],S[14]],b=ge.vec3.sub([],I,g),D=ge.vec3.length(b),k=ge.vec3.normalize([],b),T=d.worldSize/(2*Math.PI),A=ge.vec3.dot(k,C),O=Math.asin(T/D);if(O<Math.acos(A)){if(!u)return null;const Te=[],_e=[];ge.vec3.scale(Te,C,D/A),ge.vec3.normalize(_e,ge.vec3.sub(_e,Te,b)),ge.vec3.normalize(C,ge.vec3.add(C,b,ge.vec3.scale(C,_e,Math.tan(O)*D)))}const B=[];new vn(g,C).closestPointOnSphere(I,T,B);const V=ge.vec3.normalize([],Vh(S,0)),q=ge.vec3.normalize([],Vh(S,1)),G=ge.vec3.normalize([],Vh(S,2)),H=ge.vec3.dot(V,B),Z=ge.vec3.dot(q,B),ee=ge.vec3.dot(G,B),ie=Po(Math.asin(-Z/T));let me=Po(Math.atan2(H,ee));me=d.center.lng+function(Te,_e){const Ie=(_e-Te+180)%360-180;return Ie<-180?Ie+360:Ie}(d.center.lng,me);const ue=Dc(me),pe=Qn(As(ie),0,1);return new s(ue,pe)}class Xi{constructor(o,a,u){this.a=ge.vec3.sub([],o,u),this.b=ge.vec3.sub([],a,u),this.center=u;const g=ge.vec3.normalize([],this.a),p=ge.vec3.normalize([],this.b);this.angle=Math.acos(ge.vec3.dot(g,p))}}function lo(d,o){if(0===d.angle)return null;let a;return a=0===d.a[o]?1/d.angle*.5*Math.PI:1/d.angle*Math.atan(d.b[o]/d.a[o]/Math.sin(d.angle)-1/Math.tan(d.angle)),a<0||a>1?null:function(u,g,p,y){const C=Math.sin(p);return u*(Math.sin((1-y)*p)/C)+g*(Math.sin(y*p)/C)}(d.a[o],d.b[o],d.angle,Qn(a,0,1))+d.center[o]}function _o(d){if(d.z<=1)return Vi[d.z+2*d.y+d.x];const o=Tr(wi(d));return tn.fromPoints(o)}function jo(d,o,a){return ge.vec3.scale(d,d,1-a),ge.vec3.scaleAndAdd(d,d,o,a)}function xl(d,o,a){for(const u of d)ge.vec3.transformMat4(u,u,o),ge.vec3.scale(u,u,a)}function ms(d,o,a,u){const g=o/d.worldSize,p=d.globeMatrix;if(a.z<=1){const ue=_o(a).getCorners();return xl(ue,p,g),tn.fromPoints(ue)}const y=wi(a,u),C=Tr(y,ts+gi(d._tileCoverLift));xl(C,p,g);const S=Number.MAX_VALUE,I=[-S,-S,-S],b=[S,S,S];if(y.contains(d.center)){for(const Te of C)ge.vec3.min(b,b,Te),ge.vec3.max(I,I,Te);I[2]=0;const ue=d.point,pe=[ue.x*g,ue.y*g,0];return ge.vec3.min(b,b,pe),ge.vec3.max(I,I,pe),new tn(b,I)}if(d._tileCoverLift>0){for(const ue of C)ge.vec3.min(b,b,ue),ge.vec3.max(I,I,ue);return new tn(b,I)}const D=[p[12]*g,p[13]*g,p[14]*g],k=y.getCenter(),T=Qn(d.center.lat,-br,br),A=Qn(k.lat,-br,br),O=Dc(d.center.lng),B=As(T);let V=O-Dc(k.lng);const q=B-As(A);V>.5?V-=1:V<-.5&&(V+=1);let G=0;if(Math.abs(V)>Math.abs(q))G=V>=0?1:3;else{G=q>=0?0:2;const ue=[p[4]*g,p[5]*g,p[6]*g],pe=-Math.sin(yi(q>=0?y.getSouth():y.getNorth()))*ts;ge.vec3.scaleAndAdd(D,D,ue,pe)}const H=C[G],Z=C[(G+1)%4],ee=new Xi(H,Z,D),ie=[lo(ee,0)||H[0],lo(ee,1)||H[1],lo(ee,2)||H[2]],me=js(d.zoom);if(me>0){const ue=function({x:Te,y:_e,z:Ie},Le,Fe,Ve,ze){const We=1/(1<<Ie);let Ue=Te*We,Ze=Ue+We,ht=_e*We,ut=ht+We,qt=0;const gt=(Ue+Ze)/2-Ve;return gt>.5?qt=-1:gt<-.5&&(qt=1),Ue=((Ue+qt)*Le-(Ve*=Le))*Fe+Ve,Ze=((Ze+qt)*Le-Ve)*Fe+Ve,ht=(ht*Le-(ze*=Le))*Fe+ze,ut=(ut*Le-ze)*Fe+ze,[[Ue,ut,0],[Ze,ut,0],[Ze,ht,0],[Ue,ht,0]]}(a,o,d._pixelsPerMercatorPixel,O,B);for(let Te=0;Te<C.length;Te++)jo(C[Te],ue[Te],me);const pe=ge.vec3.add([],ue[G],ue[(G+1)%4]);ge.vec3.scale(pe,pe,.5),jo(ie,pe,me)}for(const ue of C)ge.vec3.min(b,b,ue),ge.vec3.max(I,I,ue);return b[2]=Math.min(H[2],Z[2]),ge.vec3.min(b,b,ie),ge.vec3.max(I,I,ie),new tn(b,I)}function wi({x:d,y:o,z:a},u=!1){const g=1/(1<<a),p=new Ri(xa(d*g),o===(1<<a)-1&&u?-90:Uo((o+1)*g)),y=new Ri(xa((d+1)*g),0===o&&u?90:Uo(o*g));return new fd(p,y)}function Tr(d,o=ts){const a=yi(d.getNorth()),u=yi(d.getSouth()),g=Math.cos(a),p=Math.cos(u),y=Math.sin(a),C=Math.sin(u),S=d.getWest(),I=d.getEast();return[ou(p,C,S,o),ou(p,C,I,o),ou(g,y,I,o),ou(g,y,S,o)]}function Oi(d,o,a,u){const g=1<<a.z,p=(d/kt+a.x)/g;return su(Uo((o/kt+a.y)/g),xa(p),u)}function $i({min:d,max:o}){return 16383/Math.max(o[0]-d[0],o[1]-d[1],o[2]-d[2])}const Dn=new Float64Array(16);function vr(d){const o=$i(d),a=ge.mat4.fromScaling(Dn,[o,o,o]);return ge.mat4.translate(a,a,ge.vec3.negate([],d.min))}function Gr(d){const o=ge.mat4.fromTranslation(Dn,d.min),a=1/$i(d);return ge.mat4.scale(o,o,[a,a,a])}function md(d){const o=kt/(2*Math.PI);return d/(2*Math.PI)/o}function wr(d,o){return kt/(512*Math.pow(2,d))*$i(_o(o))}function ea(d,o,a,u,g){const p=md(a),y=[d,o,-a/(2*Math.PI)],C=ge.mat4.identity(new Float64Array(16));return ge.mat4.translate(C,C,y),ge.mat4.scale(C,C,[p,p,p]),ge.mat4.rotateX(C,C,yi(-g)),ge.mat4.rotateY(C,C,yi(-u)),C}function js(d){return aa(5,6,d)}function wl(d,o){const a=su(o.lat,o.lng),u=function(p){const y=su(p._center.lat,p._center.lng),C=ge.vec3.fromValues(0,1,0);let S=ge.vec3.cross([],C,y);const I=ge.mat4.fromRotation([],-p.angle,y);S=ge.vec3.transformMat4(S,S,I),ge.mat4.fromRotation(I,-p._pitch,S);const b=ge.vec3.normalize([],y);return ge.vec3.scale(b,b,gi(p.cameraToCenterDistance/p.pixelsPerMeter)),ge.vec3.transformMat4(b,b,I),ge.vec3.add([],y,b)}(d),g=ge.vec3.subtract([],u,a);return ge.vec3.angle(g,a)}function gs(d,o){return wl(d,o)>Math.PI/2*1.01}const Wa=yi(85),Mc=Math.cos(Wa),Xl=Math.sin(Wa),Wm=ge.mat4.create(),Tc=d=>{const o=[];return"map"===d.paint.get("circle-pitch-alignment")&&o.push("PITCH_WITH_MAP"),"map"===d.paint.get("circle-pitch-scale")&&o.push("SCALE_WITH_MAP"),o};function lu(d,o,a,u,g,p,y,C,S){if(p&&d.queryGeometry.isAboveHorizon)return!1;p&&(S*=d.pixelToTileUnitsFactor);const I=d.tileID.canonical,b=a.projection.upVectorScale(I,a.center.lat,a.worldSize).metersToTile;for(const D of o)for(const k of D){const T=k.add(C),A=g&&a.elevation?a.elevation.exaggeration()*g.getElevationAt(T.x,T.y,!0):0,O=a.projection.projectTilePoint(T.x,T.y,I);if(A>0){const G=a.projection.upVector(I,T.x,T.y);O.x+=G[0]*b*A,O.y+=G[1]*b*A,O.z+=G[2]*b*A}const B=p?T:Ym(O.x,O.y,O.z,u),V=p?d.tilespaceRays.map(G=>lI(G,A)):d.queryGeometry.screenGeometry,q=ge.vec4.transformMat4([],[O.x,O.y,O.z,1],u);if(!y&&p?S*=q[3]/a.cameraToCenterDistance:y&&!p&&(S*=a.cameraToCenterDistance/q[3]),p){const G=Uo((k.y/kt+I.y)/(1<<I.z));S/=a.projection.pixelsPerMeter(G,1)/Co(1,G)}if(J(V,B,S))return!0}return!1}function Ym(d,o,a,u){const g=ge.vec4.transformMat4([],[d,o,a,1],u);return new Ot(g[0]/g[3],g[1]/g[3])}const D_=ge.vec3.fromValues(0,0,0),Hv=ge.vec3.fromValues(0,0,1);function lI(d,o){const a=ge.vec3.create();return D_[2]=o,d.intersectsPlane(D_,Hv,a),new Ot(a[0],a[1])}class EE extends W{}let SE,Tx,$v,DE;function ME(d,{width:o,height:a},u,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==o*a*u)throw new RangeError("mismatched image size")}else g=new Uint8Array(o*a*u);return d.width=o,d.height=a,d.data=g,d}function Ya(d,o,a){const{width:u,height:g}=o;u===d.width&&g===d.height||(M_(d,o,{x:0,y:0},{x:0,y:0},{width:Math.min(d.width,u),height:Math.min(d.height,g)},a,null),d.width=u,d.height=g,d.data=o.data)}function M_(d,o,a,u,g,p,y,C){if(0===g.width||0===g.height)return o;if(g.width>d.width||g.height>d.height||a.x>d.width-g.width||a.y>d.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>o.width||g.height>o.height||u.x>o.width-g.width||u.y>o.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const S=d.data,I=o.data,b=4===p&&C;for(let D=0;D<g.height;D++){const k=((a.y+D)*d.width+a.x)*p,T=((u.y+D)*o.width+u.x)*p;if(b)for(let A=0;A<g.width;A++){const O=k+A*p+3,B=T+A*p;I[B+0]=255,I[B+1]=255,I[B+2]=255,I[B+3]=S[O]}else if(y)for(let A=0;A<g.width;A++){const O=k+A*p,B=T+A*p,V=S[O+3],q=new Yi(S[O+0]/255*V,S[O+1]/255*V,S[O+2]/255*V,V).toRenderColor(y).toArray();I[B+0]=q[0],I[B+1]=q[1],I[B+2]=q[2],I[B+3]=q[3]}else for(let A=0;A<g.width*p;A++)I[T+A]=S[k+A]}return o}Zt(EE,"HeatmapBucket",{omit:["layers"]});class ah{constructor(o,a){ME(this,o,1,a)}resize(o){Ya(this,new ah(o),1)}clone(){return new ah({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,a,u,g,p){M_(o,a,u,g,p,1,null)}}class Ho{constructor(o,a){ME(this,o,4,a)}resize(o){Ya(this,new Ho(o),4)}replace(o,a){a?this.data.set(o):this.data=o instanceof Uint8ClampedArray?new Uint8Array(o.buffer):o}clone(){return new Ho({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,a,u,g,p,y,C){M_(o,a,u,g,p,4,y,C)}}class Za{constructor(o,a){this.width=o.width,this.height=o.height,this.data=a instanceof Uint8Array?new Float32Array(a.buffer):a}}function lh(d){const o={},a=d.resolution||256,u=d.clips?d.clips.length:1,g=d.image||new Ho({width:a,height:u}),p=(y,C,S)=>{o[d.evaluationKey]=S;const I=d.expression.evaluate(o);I&&(g.data[y+C+0]=Math.floor(255*I.r/I.a),g.data[y+C+1]=Math.floor(255*I.g/I.a),g.data[y+C+2]=Math.floor(255*I.b/I.a),g.data[y+C+3]=Math.floor(255*I.a))};if(d.clips)for(let y=0,C=0;y<u;++y,C+=4*a)for(let S=0,I=0;S<a;S++,I+=4){const b=S/(a-1),{start:D,end:k}=d.clips[y];p(C,I,D*(1-b)+k*b)}else for(let y=0,C=0;y<a;y++,C+=4)p(0,C,y/(a-1));return g}Zt(ah,"AlphaImage"),Zt(Ho,"RGBAImage");const Ix=ki([{name:"a_pos",components:2,type:"Int16"}],4),TE=ki([{name:"a_road_z_offset",components:1,type:"Float32"}],4),cI=ki([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),IE=ki([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function T_(d,o,a=2){const u=o&&o.length,g=u?o[0]*a:d.length;let p=Ax(d,0,g,a,!0);const y=[];if(!p||p.next===p.prev)return y;let C,S,I;if(u&&(p=function(b,D,k,T){const A=[];for(let O=0,B=D.length;O<B;O++){const V=Ax(b,D[O]*T,O<B-1?D[O+1]*T:b.length,T,!1);V===V.next&&(V.steiner=!0),A.push(PE(V))}A.sort(AE);for(let O=0;O<A.length;O++)k=kE(A[O],k);return k}(d,o,p,a)),d.length>80*a){C=1/0,S=1/0;let b=-1/0,D=-1/0;for(let k=a;k<g;k+=a){const T=d[k],A=d[k+1];T<C&&(C=T),A<S&&(S=A),T>b&&(b=T),A>D&&(D=A)}I=Math.max(b-C,D-S),I=0!==I?32767/I:0}return Zm(p,y,a,C,S,I,0),y}function Ax(d,o,a,u,g){let p;if(g===function(y,C,S,I){let b=0;for(let D=C,k=S-I;D<S;D+=I)b+=(y[k]-y[D])*(y[D+1]+y[k+1]),k=D;return b}(d,o,a,u)>0)for(let y=o;y<a;y+=u)p=LE(y/u|0,d[y],d[y+1],p);else for(let y=a-u;y>=o;y-=u)p=LE(y/u|0,d[y],d[y+1],p);return p&&Gv(p,p.next)&&(A_(p),p=p.next),p}function If(d,o){if(!d)return d;o||(o=d);let a,u=d;do{if(a=!1,u.steiner||!Gv(u,u.next)&&0!==Eo(u.prev,u,u.next))u=u.next;else{if(A_(u),u=o=u.prev,u===u.next)break;a=!0}}while(a||u!==o);return o}function Zm(d,o,a,u,g,p,y){if(!d)return;!y&&p&&function(S,I,b,D){let k=S;do{0===k.z&&(k.z=Xm(k.x,k.y,I,b,D)),k.prevZ=k.prev,k.nextZ=k.next,k=k.next}while(k!==S);k.prevZ.nextZ=null,k.prevZ=null,function(T){let A,O=1;do{let B,V=T;T=null;let q=null;for(A=0;V;){A++;let G=V,H=0;for(let ee=0;ee<O&&(H++,G=G.nextZ,G);ee++);let Z=O;for(;H>0||Z>0&&G;)0!==H&&(0===Z||!G||V.z<=G.z)?(B=V,V=V.nextZ,H--):(B=G,G=G.nextZ,Z--),q?q.nextZ=B:T=B,B.prevZ=q,q=B;V=G}q.nextZ=null,O*=2}while(A>1)}(k)}(d,u,g,p);let C=d;for(;d.prev!==d.next;){const S=d.prev,I=d.next;if(p?uI(d,u,g,p):dI(d))o.push(S.i,d.i,I.i),A_(d),d=I.next,C=I.next;else if((d=I)===C){y?1===y?Zm(d=hI(If(d),o),o,a,u,g,p,2):2===y&&pI(d,o,a,u,g,p):Zm(If(d),o,a,u,g,p,1);break}}}function dI(d){const o=d.prev,a=d,u=d.next;if(Eo(o,a,u)>=0)return!1;const g=o.x,p=a.x,y=u.x,C=o.y,S=a.y,I=u.y,b=g<p?g<y?g:y:p<y?p:y,D=C<S?C<I?C:I:S<I?S:I,k=g>p?g>y?g:y:p>y?p:y,T=C>S?C>I?C:I:S>I?S:I;let A=u.next;for(;A!==o;){if(A.x>=b&&A.x<=k&&A.y>=D&&A.y<=T&&Af(g,C,p,S,y,I,A.x,A.y)&&Eo(A.prev,A,A.next)>=0)return!1;A=A.next}return!0}function uI(d,o,a,u){const g=d.prev,p=d,y=d.next;if(Eo(g,p,y)>=0)return!1;const C=g.x,S=p.x,I=y.x,b=g.y,D=p.y,k=y.y,T=C<S?C<I?C:I:S<I?S:I,A=b<D?b<k?b:k:D<k?D:k,O=C>S?C>I?C:I:S>I?S:I,B=b>D?b>k?b:k:D>k?D:k,V=Xm(T,A,o,a,u),q=Xm(O,B,o,a,u);let G=d.prevZ,H=d.nextZ;for(;G&&G.z>=V&&H&&H.z<=q;){if(G.x>=T&&G.x<=O&&G.y>=A&&G.y<=B&&G!==g&&G!==y&&Af(C,b,S,D,I,k,G.x,G.y)&&Eo(G.prev,G,G.next)>=0||(G=G.prevZ,H.x>=T&&H.x<=O&&H.y>=A&&H.y<=B&&H!==g&&H!==y&&Af(C,b,S,D,I,k,H.x,H.y)&&Eo(H.prev,H,H.next)>=0))return!1;H=H.nextZ}for(;G&&G.z>=V;){if(G.x>=T&&G.x<=O&&G.y>=A&&G.y<=B&&G!==g&&G!==y&&Af(C,b,S,D,I,k,G.x,G.y)&&Eo(G.prev,G,G.next)>=0)return!1;G=G.prevZ}for(;H&&H.z<=q;){if(H.x>=T&&H.x<=O&&H.y>=A&&H.y<=B&&H!==g&&H!==y&&Af(C,b,S,D,I,k,H.x,H.y)&&Eo(H.prev,H,H.next)>=0)return!1;H=H.nextZ}return!0}function hI(d,o){let a=d;do{const u=a.prev,g=a.next.next;!Gv(u,g)&&FE(u,a,a.next,g)&&I_(u,g)&&I_(g,u)&&(o.push(u.i,a.i,g.i),A_(a),A_(a.next),a=d=g),a=a.next}while(a!==d);return If(a)}function pI(d,o,a,u,g,p){let y=d;do{let C=y.next.next;for(;C!==y.prev;){if(y.i!==C.i&&OE(y,C)){let S=kx(y,C);return y=If(y,y.next),S=If(S,S.next),Zm(y,o,a,u,g,p,0),void Zm(S,o,a,u,g,p,0)}C=C.next}y=y.next}while(y!==d)}function AE(d,o){return d.x-o.x}function kE(d,o){const a=function(g,p){let y=p;const C=g.x,S=g.y;let I,b=-1/0;do{if(S<=y.y&&S>=y.next.y&&y.next.y!==y.y){const O=y.x+(S-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(O<=C&&O>b&&(b=O,I=y.x<y.next.x?y:y.next,O===C))return I}y=y.next}while(y!==p);if(!I)return null;const D=I,k=I.x,T=I.y;let A=1/0;y=I;do{if(C>=y.x&&y.x>=k&&C!==y.x&&Af(S<T?C:b,S,k,T,S<T?b:C,S,y.x,y.y)){const O=Math.abs(S-y.y)/(C-y.x);I_(y,g)&&(O<A||O===A&&(y.x>I.x||y.x===I.x&&RE(I,y)))&&(I=y,A=O)}y=y.next}while(y!==D);return I}(d,o);if(!a)return o;const u=kx(a,d);return If(u,u.next),If(a,a.next)}function RE(d,o){return Eo(d.prev,d,o.prev)<0&&Eo(o.next,d,d.next)<0}function Xm(d,o,a,u,g){return(d=1431655765&((d=858993459&((d=252645135&((d=16711935&((d=(d-a)*g|0)|d<<8))|d<<4))|d<<2))|d<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-u)*g|0)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function PE(d){let o=d,a=d;do{(o.x<a.x||o.x===a.x&&o.y<a.y)&&(a=o),o=o.next}while(o!==d);return a}function Af(d,o,a,u,g,p,y,C){return(g-y)*(o-C)>=(d-y)*(p-C)&&(d-y)*(u-C)>=(a-y)*(o-C)&&(a-y)*(p-C)>=(g-y)*(u-C)}function OE(d,o){return d.next.i!==o.i&&d.prev.i!==o.i&&!function(a,u){let g=a;do{if(g.i!==a.i&&g.next.i!==a.i&&g.i!==u.i&&g.next.i!==u.i&&FE(g,g.next,a,u))return!0;g=g.next}while(g!==a);return!1}(d,o)&&(I_(d,o)&&I_(o,d)&&function(a,u){let g=a,p=!1;const y=(a.x+u.x)/2,C=(a.y+u.y)/2;do{g.y>C!=g.next.y>C&&g.next.y!==g.y&&y<(g.next.x-g.x)*(C-g.y)/(g.next.y-g.y)+g.x&&(p=!p),g=g.next}while(g!==a);return p}(d,o)&&(Eo(d.prev,d,o.prev)||Eo(d,o.prev,o))||Gv(d,o)&&Eo(d.prev,d,d.next)>0&&Eo(o.prev,o,o.next)>0)}function Eo(d,o,a){return(o.y-d.y)*(a.x-o.x)-(o.x-d.x)*(a.y-o.y)}function Gv(d,o){return d.x===o.x&&d.y===o.y}function FE(d,o,a,u){const g=Wv(Eo(d,o,a)),p=Wv(Eo(d,o,u)),y=Wv(Eo(a,u,d)),C=Wv(Eo(a,u,o));return g!==p&&y!==C||!(0!==g||!qv(d,a,o))||!(0!==p||!qv(d,u,o))||!(0!==y||!qv(a,d,u))||!(0!==C||!qv(a,o,u))}function qv(d,o,a){return o.x<=Math.max(d.x,a.x)&&o.x>=Math.min(d.x,a.x)&&o.y<=Math.max(d.y,a.y)&&o.y>=Math.min(d.y,a.y)}function Wv(d){return d>0?1:d<0?-1:0}function I_(d,o){return Eo(d.prev,d,d.next)<0?Eo(d,o,d.next)>=0&&Eo(d,d.prev,o)>=0:Eo(d,o,d.prev)<0||Eo(d,d.next,o)<0}function kx(d,o){const a=Rx(d.i,d.x,d.y),u=Rx(o.i,o.x,o.y),g=d.next,p=o.prev;return d.next=o,o.prev=d,a.next=g,g.prev=a,u.next=a,a.prev=u,p.next=u,u.prev=p,u}function LE(d,o,a,u){const g=Rx(d,o,a);return u?(g.next=u.next,g.prev=u,u.next.prev=g,u.next=g):(g.prev=g,g.next=g),g}function A_(d){d.next.prev=d.prev,d.prev.next=d.next,d.prevZ&&(d.prevZ.nextZ=d.nextZ),d.nextZ&&(d.nextZ.prevZ=d.prevZ)}function Rx(d,o,a){return{i:d,x:o,y:a,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function k_(d,o){const a=d.length;if(a<=1)return[d];const u=[];let g,p;for(let y=0;y<a;y++){const C=Yp(d[y]);0!==C&&(d[y].area=Math.abs(C),void 0===p&&(p=C<0),p===C<0?(g&&u.push(g),g=[d[y]]):g.push(d[y]))}if(g&&u.push(g),o>1)for(let y=0;y<u.length;y++)u[y].length<=o||(vx(u[y],o,1,u[y].length-1,Px),u[y]=u[y].slice(0,o));return u}function Px(d,o){return o.area-d.area}function NE(d,o,a=1){if(!d)return null;const u="string"==typeof d?ds.from(d).getPrimary():d.getPrimary(),g=u.id.toString();return o.has(g)||o.set(g,[]),u.scaleSelf(a),o.get(g).push(u),u.toString()}function Ic(d,o,a,u){const g=u.patternDependencies;let p=!1;for(const y of o){const C=y.paint.get(`${d}-pattern`);C.isConstant()||(p=!0),NE(C.constantOr(null),g,a)&&(p=!0)}return p}function gd(d,o,a,u,g,p){const y=p.patternDependencies;for(const C of o){const S=C.paint.get(`${d}-pattern`).value;if("constant"!==S.kind){let I=S.evaluate({zoom:u},a,{},p.availableImages);I=I&&I.name?I.name:I;const b=NE(I,y,g);b&&(a.patterns[C.id]=b)}}return a}var Ox,Yv,cu,fI,wa,Zv,zE,Xv={};function mI(){if(Yv)return Ox;Yv=1;var d=Nd();function o(g,p,y,C,S){this.properties={},this.extent=y,this.type=0,this._pbf=g,this._geometry=-1,this._keys=C,this._values=S,g.readFields(a,this,p)}function a(g,p,y){1==g?p.id=y.readVarint():2==g?function(C,S){for(var I=C.readVarint()+C.pos;C.pos<I;){var b=S._keys[C.readVarint()],D=S._values[C.readVarint()];S.properties[b]=D}}(y,p):3==g?p.type=y.readVarint():4==g&&(p._geometry=y.pos)}function u(g){for(var p,y,C=0,S=0,I=g.length,b=I-1;S<I;b=S++)C+=((y=g[b]).x-(p=g[S]).x)*(p.y+y.y);return C}return Ox=o,o.types=["Unknown","Point","LineString","Polygon"],o.prototype.loadGeometry=function(){var g=this._pbf;g.pos=this._geometry;for(var p,y=g.readVarint()+g.pos,C=1,S=0,I=0,b=0,D=[];g.pos<y;){if(S<=0){var k=g.readVarint();C=7&k,S=k>>3}if(S--,1===C||2===C)I+=g.readSVarint(),b+=g.readSVarint(),1===C&&(p&&D.push(p),p=[]),p.push(new d(I,b));else{if(7!==C)throw new Error("unknown command "+C);p&&p.push(p[0].clone())}}return p&&D.push(p),D},o.prototype.bbox=function(){var g=this._pbf;g.pos=this._geometry;for(var p=g.readVarint()+g.pos,y=1,C=0,S=0,I=0,b=1/0,D=-1/0,k=1/0,T=-1/0;g.pos<p;){if(C<=0){var A=g.readVarint();y=7&A,C=A>>3}if(C--,1===y||2===y)(S+=g.readSVarint())<b&&(b=S),S>D&&(D=S),(I+=g.readSVarint())<k&&(k=I),I>T&&(T=I);else if(7!==y)throw new Error("unknown command "+y)}return[b,k,D,T]},o.prototype.toGeoJSON=function(g,p,y){var C,S,I=this.extent*Math.pow(2,y),b=this.extent*g,D=this.extent*p,k=this.loadGeometry(),T=o.types[this.type];function A(V){for(var q=0;q<V.length;q++){var G=V[q];V[q]=[360*(G.x+b)/I-180,360/Math.PI*Math.atan(Math.exp((180-360*(G.y+D)/I)*Math.PI/180))-90]}}switch(this.type){case 1:var O=[];for(C=0;C<k.length;C++)O[C]=k[C][0];A(k=O);break;case 2:for(C=0;C<k.length;C++)A(k[C]);break;case 3:for(k=function(V){var q=V.length;if(q<=1)return[V];for(var G,H,Z=[],ee=0;ee<q;ee++){var ie=u(V[ee]);0!==ie&&(void 0===H&&(H=ie<0),H===ie<0?(G&&Z.push(G),G=[V[ee]]):G.push(V[ee]))}return G&&Z.push(G),Z}(k),C=0;C<k.length;C++)for(S=0;S<k[C].length;S++)A(k[C][S])}1===k.length?k=k[0]:T="Multi"+T;var B={type:"Feature",geometry:{type:T,coordinates:k},properties:this.properties};return"id"in this&&(B.id=this.id),B},Ox}function BE(){if(fI)return cu;fI=1;var d=mI();function o(u,g){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=u,this._keys=[],this._values=[],this._features=[],u.readFields(a,this,g),this.length=this._features.length}function a(u,g,p){15===u?g.version=p.readVarint():1===u?g.name=p.readString():5===u?g.extent=p.readVarint():2===u?g._features.push(p.pos):3===u?g._keys.push(p.readString()):4===u&&g._values.push(function(y){for(var C=null,S=y.readVarint()+y.pos;y.pos<S;){var I=y.readVarint()>>3;C=1===I?y.readString():2===I?y.readFloat():3===I?y.readDouble():4===I?y.readVarint64():5===I?y.readVarint():6===I?y.readSVarint():7===I?y.readBoolean():null}return C}(p))}return cu=o,o.prototype.feature=function(u){if(u<0||u>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[u];var g=this._pbf.readVarint()+this._pbf.pos;return new d(this._pbf,g,this.extent,this._keys,this._values)},cu}function cp(){return zE||(zE=1,Xv.VectorTile=function(){if(Zv)return wa;Zv=1;var d=BE();function o(a,u,g){if(3===a){var p=new d(g,g.readVarint()+g.pos);p.length&&(u[p.name]=p)}}return wa=function(a,u){this.layers=a.readFields(o,{},u)}}(),Xv.VectorTileFeature=mI(),Xv.VectorTileLayer=BE()),Xv}var dp=cp();const ch="3d_elevation_id";class Fx{constructor(){this._valid=!1}reset(o){return this.feature=o,this._valid=!0,this._geometry=o.loadGeometry(),0!==this._geometry.length&&0!==this._geometry[0].length||(this._valid=!1),this}geometry(o,a){return this._valid&&o(a(this._geometry)),this}require(o,a,u){return this.get(o,!0,a,u)}optional(o,a,u){return this.get(o,!1,a,u)}success(){return this._valid}get(o,a,u,g){const p=this.feature.properties.hasOwnProperty(o)?+this.feature.properties[o]:void 0;return this._valid&&void 0!==p?u(g?g(p):p):a&&(this._valid=!1),this}}class Lx{constructor(o,a){this.featureFunc=o,this.vertexFunc=a}parseFeature(o,a,u){return this.featureFunc(o,a,u)}parseVertex(o,a,u){return this.vertexFunc(o,a,u)}}const Qv=new Lx((d,o,a)=>d.reset(o).require(ch,u=>{a.id=u}).optional("fixed_height_relative",u=>{a.constantHeight=u},Kl.decodeRelativeHeight).geometry(u=>{a.bounds=u},Kl.computeBounds).success(),(d,o,a)=>d.reset(o).require(ch,u=>{a.id=u}).require("elevation_idx",u=>{a.idx=u}).require("extent",u=>{a.extent=u}).require("height_relative",u=>{a.height=u},Kl.decodeRelativeHeight).geometry(u=>{a.position=u},Kl.getPoint).success()),Nx=new Lx((d,o,a)=>d.reset(o).require(ch,u=>{a.id=u}).optional("fixed_height",u=>{a.constantHeight=u},Kl.decodeMetricHeight).geometry(u=>{a.bounds=u},Kl.computeBounds).success(),(d,o,a)=>d.reset(o).require(ch,u=>{a.id=u}).require("elevation_idx",u=>{a.idx=u}).require("extent",u=>{a.extent=u}).require("height",u=>{a.height=u},Kl.decodeMetricHeight).geometry(u=>{a.position=u},Kl.getPoint).success());class Kl{static computeBounds(o){const a=new Ot(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),u=new Ot(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const g of o[0])a.x>g.x&&(a.x=g.x),a.y>g.y&&(a.y=g.y),u.x<g.x&&(u.x=g.x),u.y<g.y&&(u.y=g.y);return{min:a,max:u}}static getPoint(o){return ge.vec2.fromValues(o[0][0].x,o[0][0].y)}static decodeRelativeHeight(o){return 1e-4*o*5}static decodeMetricHeight(o){return 1e-4*o}static parse(o){const a=[],u=[],g=o.length,p=new Fx;for(let C=0;C<g;C++){const S=o.feature(C),I=S.properties.hasOwnProperty("version")?String(S.properties.version):void 0,b=(y=I)?"1.0.1"===y?Nx:void 0:Qv;if(void 0===b){Ir(`Unknown elevation feature version number ${I||"(unknown)"}`);continue}const D=S.properties.hasOwnProperty("type")?S.properties.type:void 0;if(D)if("Point"===dp.VectorTileFeature.types[S.type]&&"curve_point"===D){const k={};b.parseVertex(p,S,k)&&a.push(k)}else if("Polygon"===dp.VectorTileFeature.types[S.type]&&"curve_meta"===D){const k={};b.parseFeature(p,S,k)&&u.push(k)}}var y;return{vertices:a,features:u}}}class Km{constructor(o,a,u,g,p,y){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=o,this.heightRange={min:u,max:u},this.safeArea=a,this.constantHeight=u,null==this.constantHeight&&(null!=this.constantHeight||0!==g.length)){this.vertices=g,this.edges=p,this.edges=this.edges.filter(C=>C.a<this.vertices.length&&C.b<this.vertices.length&&!ge.vec2.exactEquals(this.vertices[C.a].position,this.vertices[C.b].position)),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const C of this.vertices)this.vertexProps.push({dir:ge.vec2.fromValues(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,C.height),this.heightRange.max=Math.max(this.heightRange.max,C.height);for(const C of this.edges){const S=this.vertices[C.a].position,I=this.vertices[C.b].position,b=ge.vec2.subtract(ge.vec2.create(),I,S),D=ge.vec2.length(b),k=ge.vec2.scale(ge.vec2.create(),b,1/D);this.edgeProps.push({vec:b,dir:k,len:D});const T=this.vertexProps[C.a].dir,A=this.vertexProps[C.b].dir;ge.vec2.add(T,T,k),ge.vec2.add(A,A,k)}for(const C of this.vertexProps)0===C.dir[0]&&0===C.dir[1]||ge.vec2.normalize(C.dir,C.dir);this.tessellate(y)}}pointElevation(o){if(null!=this.constantHeight)return this.constantHeight;const a=this.getClosestEdge(o);if(null==a)return 0;const[u,g]=a;return(1-(C=g))*this.vertices[this.edges[u].a].height+C*this.vertices[this.edges[u].b].height;var C}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(o){if(0===this.edges.length)return;let a=0,u=Number.POSITIVE_INFINITY,g=0;const p=ge.vec2.fromValues(o.x,o.y);for(let y=0;y<this.edges.length;y++){const C=this.edges[y],S=this.edgeProps[y].dir,I=new Tn(p,this.edgeProps[y].dir),b=this.vertices[C.a].position,D=this.vertices[C.b].position,k=ge.vec2.create(),T=ge.vec2.create(),A=I.intersectsPlane(b,this.vertexProps[C.a].dir,k),O=I.intersectsPlane(D,this.vertexProps[C.b].dir,T);if(!A||!O)continue;const B=ge.vec2.subtract(ge.vec2.create(),T,k),V=ge.vec2.subtract(ge.vec2.create(),p,k),q=ge.vec2.dot(B,B),G=q>0?ge.vec2.dot(V,B)/q:0,H=Qn(G,0,1),Z=Math.abs((G-H)*this.edgeProps[y].len),ee=ge.vec2.subtract(ge.vec2.create(),p,b),ie=Z+Math.abs(ge.vec2.dot(ee,ge.vec2.fromValues(S[1],-S[0])));ie<u&&(a=y,u=ie,g=H)}return[a,g]}tessellate(o){for(let a=this.edges.length-1;a>=0;--a){const u=this.edges[a].a,g=this.edges[a].b,{position:p,height:y,extent:C}=this.vertices[u],{position:S,height:I,extent:b}=this.vertices[g],D=this.vertexProps[u].dir,k=this.vertexProps[g].dir,T=ge.vec3.fromValues(p[0]/o,p[1]/o,y),A=ge.vec3.fromValues(S[0]/o,S[1]/o,I),O=ge.vec3.fromValues(D[1],-D[0],0);ge.vec3.scale(O,O,C);const B=ge.vec3.fromValues(k[1],-k[0],0);if(ge.vec3.scale(B,B,b),this.distSqLines(ge.vec3.fromValues(T[0]+.5*O[0],T[1]+.5*O[1],T[2]+.5*O[2]),ge.vec3.fromValues(A[0]-.5*B[0],A[1]-.5*B[1],A[2]-.5*B[2]),ge.vec3.fromValues(T[0]-.5*O[0],T[1]-.5*O[1],T[2]-.5*O[2]),ge.vec3.fromValues(A[0]+.5*B[0],A[1]+.5*B[1],A[2]+.5*B[2]))<=.05*.05)continue;const V=this.vertices.length,q=ge.vec2.add(ge.vec2.create(),p,S);this.vertices.push({position:ge.vec2.scale(q,q,.5),height:.5*(y+I),extent:.5*(C+b)});const G=ge.vec2.add(ge.vec2.create(),D,k);this.vertexProps.push({dir:ge.vec2.normalize(G,G)}),this.edges.splice(a,1),this.edgeProps.splice(a,1),this.edges.push({a:u,b:V}),this.edges.push({a:V,b:g});const H=ge.vec2.subtract(ge.vec2.create(),this.vertices[V].position,p),Z=ge.vec2.length(H),ee={vec:H,dir:ge.vec2.scale(ge.vec2.create(),H,1/Z),len:Z};this.edgeProps.push(ee),this.edgeProps.push(ee)}}distSqLines(o,a,u,g){const p=ge.vec3.subtract(ge.vec3.create(),a,o),y=ge.vec3.subtract(ge.vec3.create(),g,u),C=ge.vec3.subtract(ge.vec3.create(),o,u),S=ge.vec3.dot(p,p),I=ge.vec3.dot(p,y),b=ge.vec3.dot(p,C),D=ge.vec3.dot(y,y),k=ge.vec3.dot(y,C),T=S*D-I*I;if(0===T){const q=ge.vec3.dot(C,y)/ge.vec3.dot(y,y),G=ge.vec3.lerp(ge.vec3.create(),u,g,q);return ge.vec3.squaredDistance(G,o)}const A=(I*k-b*D)/T,O=(S*k-I*b)/T,B=ge.vec3.lerp(ge.vec3.create(),o,a,A),V=ge.vec3.lerp(ge.vec3.create(),u,g,O);return ge.vec3.squaredDistance(B,V)}}class up{constructor(o,a){this.zScale=1,this.xOffset=0,this.yOffset=0,o.equals(a)||(this.zScale=Math.pow(2,a.z-o.z),this.xOffset=(o.x*this.zScale-a.x)*kt,this.yOffset=(o.y*this.zScale-a.y)*kt)}constantElevation(o,a){if(null!=o.constantHeight)return this.computeBiasedHeight(o.constantHeight,a)}pointElevation(o,a,u){return this.constantElevation(a,u)??(o.x=o.x*this.zScale+this.xOffset,o.y=o.y*this.zScale+this.yOffset,this.computeBiasedHeight(a.pointElevation(o),u))}computeBiasedHeight(o,a){return a<=0?o:o+a*aa(0,a,o>=0?o:Math.abs(.5*o))}}Zt(Km,"ElevationFeature");class Jv{constructor(){this.polygons=new Map}add(o,...a){this.polygons.has(o)?this.polygons.get(o).push(...a):this.polygons.set(o,a)}merge(o){for(const[a,u]of o.polygons)this.add(a,...u)}}class du{constructor(){this.portals=[]}static evaluate(o){if(0===o.length)return new du;let a=[];for(const I of o)a.push(...I.portals);if(0===a.length)return new du;const u=(I,b)=>I<=0&&b<=0||I>=kt&&b>=kt;for(const I of a){const b=I.va,D=I.vb;(u(b.x,D.x)||u(b.y,D.y))&&(I.type="border")}const g=a.filter(I=>"unevaluated"!==I.type),p=a.filter(I=>"unevaluated"===I.type);if(0===p.length)return new du;p.sort((I,b)=>I.hash===b.hash?I.isTunnel===b.isTunnel?0:I.isTunnel?-1:1:I.hash<b.hash?1:-1),a=g.concat(p);let y=g.length,C=y,S=y;do{if(C++,C===a.length||a[y].hash!==a[C].hash){if(C-y==2){S<y&&(a[S]=a[y],a[y]=null);const I=a[S],b=a[C-1];I.type=I.isTunnel!==b.isTunnel?"tunnel":"polygon",I.connection={a:I.connection.a,b:b.connection.a},S++}y=C}}while(y!==a.length);return a.splice(S),a.sort((I,b)=>I.hash<b.hash?1:-1),{portals:a}}}Zt(du,"ElevationPortalGraph"),Zt(Jv,"ElevationPolygons");class R_{constructor(o,a,u){this.outPositions=o,this.outNormals=a,this.outIndices=u,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(o,a,u){let g=o[2];null!=u&&(g*=u);const p=this.getVec3Bits(o)<<96n|this.getVec3Bits(a),y=this.vertexLookup.get(p);if(null!=y)return y;const C=this.outPositions.length;this.vertexLookup.set(p,C);const S=Math.trunc(16384*a[0]),I=Math.trunc(16384*a[1]),b=Math.trunc(16384*a[2]);return this.outPositions.emplaceBack(o[0],o[1],g),this.outNormals.emplaceBack(S,I,b),C}addVertices(o,a,...u){const g=[];for(const p of u){const y=this.addVertex(p,o,a);g.push(y)}return g}addTriangles(o,a,u){if(a&&u){const g=1===u.length,p=ge.vec3.fromValues(0,0,0);for(let y=0;y<o.length;y+=3){const C=a[o[y+0]],S=a[o[y+1]],I=a[o[y+2]],b=g?u[0]:u[o[y+1]],D=g?u[0]:u[o[y+2]],k=this.addVertex(ge.vec3.fromValues(C.x,C.y,g?u[0]:u[o[y+0]]),p),T=this.addVertex(ge.vec3.fromValues(S.x,S.y,b),p),A=this.addVertex(ge.vec3.fromValues(I.x,I.y,D),p);this.outIndices.emplaceBack(k,T,A)}}else for(let g=0;g<o.length;g+=3)this.outIndices.emplaceBack(o[g+0],o[g+1],o[g+2])}addQuad(o,a){const u=this.addVertices(a,void 0,...o.map(S=>ge.vec3.fromValues(S.coord.x,S.coord.y,S.height))),[g,p,y,C]=u;this.addTriangles([g,p,y,y,C,g])}getBits(o){return this.view.setFloat32(0,o),BigInt(this.view.getUint32(0))}getVec3Bits(o){return this.getBits(o[0])<<64n|this.getBits(o[1])<<32n|this.getBits(o[2])}}class Ql{constructor(o){this.unevaluatedPortals=new du,this.portalPolygons=new Jv,this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new _f,this.vertexNormals=new g_,this.indexArray=new Vo,this.tileToMeters=m(o)}addVertices(o,a){const u=this.unevalVertices.length;for(let g=0;g<o.length;g++)this.unevalVertices.push(o[g]),this.unevalHeights.push(a[g]);return u}addTriangles(o,a,u){const g=u?this.unevalTunnelTriangles:this.unevalTriangles;for(const p of o)g.push(p+a)}addRenderableRing(o,a,u,g,p){const y=[new Ot(p.min.x,p.min.y),new Ot(p.max.x,p.min.y),new Ot(p.max.x,p.max.y),new Ot(p.min.x,p.max.y)];for(let C=0;C<u-1;C++){const S=a+C,I=S+1,b=this.unevalVertices[S],D=this.unevalVertices[I];if(!(b.x>=p.min.x&&b.x<=p.max.x&&b.y>=p.min.y&&b.y<=p.max.y||D.x>=p.min.x&&D.x<=p.max.x&&D.y>=p.min.y&&D.y<=p.max.y||ke(b,D,y))||this.isOnBorder(b.x,D.x)||this.isOnBorder(b.y,D.y))continue;const k=Ql.computeEdgeHash(this.unevalVertices[S],this.unevalVertices[I]);let T,A=this.vertexHashLookup.get(Ql.computePosHash(b));null!=A?T=A.next:(A=this.vertexHashLookup.get(Ql.computePosHash(D)),T=null!=A?A.prev:k),this.unevalEdges.push({polygonIdx:o,a:S,b:I,hash:k,portalHash:T,isTunnel:g,type:"unevaluated"})}}addPortalCandidates(o,a,u,g,p){if(0===a.length)return;this.portalPolygons.add(o,{geometry:a,zLevel:p});const y=a[0];this.vertexHashLookup.clear();let C=Ql.computeEdgeHash(y[y.length-2],y[y.length-1]);for(let S=0;S<y.length-1;S++){const I=y[S+0],b=y[S+1],D=ge.vec2.fromValues(b.x-I.x,b.y-I.y),k=ge.vec2.length(D);if(0===k)continue;let T="unevaluated";const A=g.pointElevation(I),O=g.pointElevation(b);Math.abs(A)<.01&&Math.abs(O)<.01?T="entrance":(this.isOnBorder(I.x,b.x)||this.isOnBorder(I.y,b.y))&&(T="border");const B=Ql.computeEdgeHash(I,b);this.unevaluatedPortals.portals.push({connection:{a:o,b:void 0},va:I,vb:b,vab:D,length:k,hash:B,isTunnel:u,type:T});const V=Ql.computePosHash(I);this.vertexHashLookup.set(V,{prev:C,next:B}),C=B}}construct(o){if(0===this.unevalVertices.length)return;const a=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),u=D=>{D.primitiveLength=this.indexArray.length-D.primitiveOffset},g=new R_(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(o.portals,this.unevalEdges);const p=a(),y=a(),C=a(),S=(D,k)=>{D.sort((A,O)=>A.type===k&&O.type!==k?-1:A.type!==k&&O.type===k?1:0);const T=D.findIndex(A=>A.type!==k);return T>=0?T:D.length};let I=0;this.unevalEdges.length>0&&(I=S(this.unevalEdges,"none"),this.constructBridgeStructures(g,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:I},this.tileToMeters));const b=a();if(this.unevalEdges.length>0){const D=this.unevalEdges.splice(I),k=S(D,"tunnel")+I;this.unevalEdges.push(...D),this.constructTunnelStructures(g,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:I},{min:I,max:k})}u(C),g.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),u(b),g.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),u(y),g.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),u(p),this.maskSegments=hr.simpleSegment(0,b.primitiveOffset,0,b.primitiveLength),this.depthSegments=hr.simpleSegment(0,y.primitiveOffset,0,y.primitiveLength),this.renderableSegments=hr.simpleSegment(0,C.primitiveOffset,0,C.primitiveLength),this.shadowCasterSegments=hr.simpleSegment(0,p.primitiveOffset,0,p.primitiveLength)}upload(o){this.vertexBuffer||0===this.vertexPositions.length||0===this.vertexNormals.length||0===this.indexArray.length||(this.vertexBuffer=o.createVertexBuffer(this.vertexPositions,cI.members),this.vertexBufferNormal=o.createVertexBuffer(this.vertexNormals,IE.members),this.indexBuffer=o.createIndexBuffer(this.indexArray))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableSegments.destroy(),this.shadowCasterSegments.destroy())}computeVertexConnections(o,a,u,g){const p=new Map;for(let y=u;y<g;y++){const C=a[y],S=C.a,I=C.b;p.has(S)||p.set(S,{}),p.has(I)||p.set(I,{});const b=p.get(S),D=p.get(I);o[I]>0&&(b.to=I),o[S]>0&&(D.from=S)}return p}constructBridgeStructures(o,a,u,g,p,y){const C=this.computeVertexConnections(u,g,p.min,p.max),S=1/y,I=.5*S,b=k=>ge.vec3.fromValues(a[k].x,a[k].y,u[k]*S),D=k=>{const T=C.get(k),A=T.from,O=T.to;if(!A||!O)return;const B=b(A),V=b(k),q=b(O),G=ge.vec3.fromValues(0,0,0);if(!ge.vec3.exactEquals(B,V)){const Z=ge.vec3.sub(ge.vec3.create(),V,B);ge.vec3.add(G,G,ge.vec3.normalize(Z,Z))}if(!ge.vec3.exactEquals(q,V)){const Z=ge.vec3.sub(ge.vec3.create(),q,V);ge.vec3.add(G,G,ge.vec3.normalize(Z,Z))}const H=ge.vec3.len(G);return H>0?ge.vec3.scale(G,G,1/H):void 0};for(let k=p.min;k<p.max;k++){const T=g[k],A=this.prepareEdgePoints(a,u,T,(pt,fn)=>pt>=fn);if(null==A)continue;const O=A[0],B=A[1],V=ge.vec3.fromValues(O.coord.x,O.coord.y,S*O.height),q=ge.vec3.fromValues(B.coord.x,B.coord.y,S*B.height);if(ge.vec3.exactEquals(V,q))continue;const G=ge.vec3.sub(ge.vec3.create(),q,V);ge.vec3.normalize(G,G);const H=pt=>ge.vec3.normalize(pt,pt),Z=D(T.a)||G,ee=D(T.b)||G,ie=H(ge.vec3.fromValues(Z[1],-Z[0],0)),me=H(ge.vec3.fromValues(ee[1],-ee[0],0)),ue=H(ge.vec3.cross(ge.vec3.create(),ie,Z)),pe=H(ge.vec3.cross(ge.vec3.create(),me,ee)),Te=ge.vec3.create(),_e=[ge.vec3.add(ge.vec3.create(),V,ge.vec3.scale(Te,ge.vec3.sub(Te,ie,ue),I)),ge.vec3.add(ge.vec3.create(),V,ge.vec3.scale(Te,ge.vec3.add(Te,ie,ue),I)),ge.vec3.add(ge.vec3.create(),V,ge.vec3.scale(Te,ue,I)),V],Ie=[ge.vec3.add(ge.vec3.create(),q,ge.vec3.scale(Te,ge.vec3.sub(Te,me,pe),I)),ge.vec3.add(ge.vec3.create(),q,ge.vec3.scale(Te,ge.vec3.add(Te,me,pe),I)),ge.vec3.add(ge.vec3.create(),q,ge.vec3.scale(Te,pe,I)),q],[Le,Fe]=o.addVertices(ie,y,_e[0],_e[1]),[Ve,ze]=o.addVertices(me,y,Ie[0],Ie[1]);o.addTriangles([Le,Fe,Ve,Fe,ze,Ve]);const[We,Ue]=o.addVertices(ue,y,_e[1],_e[2]),[Ze,ht]=o.addVertices(pe,y,Ie[1],Ie[2]);o.addTriangles([We,Ue,Ze,Ue,ht,Ze]);const[ut,qt]=o.addVertices(ge.vec3.negate(ie,ie),y,_e[2],_e[3]),[gt,yt]=o.addVertices(ge.vec3.negate(me,me),y,Ie[2],Ie[3]);o.addTriangles([ut,qt,gt,qt,yt,gt])}}constructTunnelStructures(o,a,u,g,p,y){const C=S=>ge.vec3.normalize(S,S);for(let S=p.min;S<p.max;S++){const I=this.prepareEdgePoints(a,u,g[S],(T,A)=>T<=A);if(null==I)continue;const[b,D]=I,k=C(ge.vec3.fromValues(D.coord.y-b.coord.y,-(D.coord.x-b.coord.x),0));o.addQuad([b,D,{coord:D.coord,height:g[S].isTunnel?-.1:0},{coord:b.coord,height:g[S].isTunnel?-.1:0}],k)}for(let S=y.min;S<y.max;S++){const I=g[S],b=a[I.a],D=a[I.b],k=C(ge.vec3.fromValues(D.y-b.y,-(D.x-b.x),0));o.addQuad([{coord:D,height:0},{coord:b,height:0},{coord:b,height:u[I.a]+4},{coord:D,height:u[I.b]+4}],k),o.addQuad([{coord:b,height:0},{coord:D,height:0},{coord:D,height:u[I.b]+4},{coord:b,height:u[I.a]+4}],k)}}prepareEdgePoints(o,a,u,g){const p=o[u.a],y=o[u.b];let C=a[u.a],S=a[u.b];if(!(0!==C&&g(C,0)||0!==S&&g(S,0)))return;const I=p.clone(),b=y.clone();if(g(C,0)){if(!g(S,0)){const D=S/(S-C);b.x=_n(b.x,I.x,D),b.y=_n(b.y,I.y,D),S=_n(S,C,D)}}else{const D=C/(C-S);I.x=_n(I.x,b.x,D),I.y=_n(I.y,b.y,D),C=_n(C,S,D)}return[{coord:I,height:C},{coord:b,height:S}]}prepareEdges(o,a){if(0===a.length)return;a.sort((C,S)=>C.hash===S.hash?S.polygonIdx-C.polygonIdx:S.hash>C.hash?1:-1);let u=0,g=0,p=0,y=a[u].polygonIdx;do{g++,(g===a.length||a[u].hash!==a[g].hash)&&((g-u==1||a[g-1].polygonIdx!==y)&&(p<u&&(a[p]=a[u],a[u]=null),a[p].type="none",p++),u=g,u!==a.length&&(y=a[u].polygonIdx))}while(u!==a.length);if(a.splice(p),0!==a.length&&0!==o.length){a.sort((I,b)=>I.hash<b.hash?1:-1);let C=0,S=0;for(;C!==a.length&&S!==o.length;){const I=a[C],b=o[S];I.portalHash>b.hash?C++:b.hash>I.portalHash?S++:(I.type=b.type,C++)}}}isOnBorder(o,a){return o<=0&&a<=0||o>=kt&&a>=kt}static computeEdgeHash(o,a){return(o.y===a.y&&o.x>a.x||o.y>a.y)&&([o,a]=[a,o]),BigInt(Ql.computePosHash(o))<<32n|BigInt(Ql.computePosHash(a))}static computePosHash(o){return((65535&o.x)<<16|65535&o.y)>>>0}}class P_{constructor(o,a){this.layoutVertexArray=new Yl,this.indexArray=new Vo,this.lineIndexArray=new Ec,this.triangleSegments=new hr,this.lineSegments=new hr,this.programConfigurations=new pd(o.layers,{zoom:o.zoom,lut:o.lut}),this.uploaded=!1,a&&(this.elevatedLayoutVertexArray=new eh)}update(o,a,u,g,p,y,C){this.programConfigurations.updatePaintArrays(o,a,p,u,g,y,C)}isEmpty(){return 0===this.layoutVertexArray.length}needsUpload(){return this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Ix.members),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.lineIndexBuffer=o.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=o.createVertexBuffer(this.elevatedLayoutVertexArray,TE.members))),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(o,a,u,g,p,y){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,a,u,g,p,y)}}class Qm{constructor(o){this.zoom=o.zoom,this.pixelRatio=o.pixelRatio,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.bufferData=new P_(o,!1),this.elevationBufferData=new P_(o,!0),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.projection=o.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference")}updateFootprints(o,a){}populate(o,a,u,g){this.hasPattern=Ic("fill",this.layers,this.pixelRatio,a);const p=this.layers[0].layout.get("fill-sort-key"),y=[];for(const{feature:C,id:S,index:I,sourceLayerIndex:b}of o){const D=this.layers[0]._featureFilter.needGeometry,k=z(C,D);if(!this.layers[0]._featureFilter.filter(new sr(this.zoom),k,u))continue;const T=p?p.evaluate(k,{},u,a.availableImages):void 0,A={id:S,properties:C.properties,type:C.type,sourceLayerIndex:b,index:I,geometry:D?k.geometry:N(C,u,g),patterns:{},sortKey:T};y.push(A)}p&&y.sort((C,S)=>C.sortKey-S.sortKey);for(const C of y){const{geometry:S,index:I,sourceLayerIndex:b}=C;if(this.hasPattern){const D=gd("fill",this.layers,C,this.zoom,this.pixelRatio,a);this.patternFeatures.push(D)}else this.addFeature(C,S,I,u,{},a.availableImages,a.brightness,a.elevationFeatures);a.featureIndex.insert(o[I].feature,S,I,b,this.index)}}update(o,a,u,g,p,y,C){this.bufferData.update(o,a,u,g,p,y,C),this.elevationBufferData.update(o,a,u,g,p,y,C)}addFeatures(o,a,u,g,p,y){for(const C of this.patternFeatures)this.addFeature(C,C.geometry,C.index,a,u,g,y,o.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(o){this.bufferData.upload(o),this.elevationBufferData.upload(o),this.elevatedStructures&&this.elevatedStructures.upload(o)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(o,a,u,g,p,y=[],C,S){const I=k_(a,500);"none"!==this.elevationMode?this.addElevatedRoadFeature(o,I,g,u,S):this.addGeometry(I,this.bufferData),this.bufferData.populatePaintArrays(o,u,p,y,g,C),this.elevationBufferData.populatePaintArrays(o,u,p,y,g,C)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(o){this.elevatedStructures&&this.elevatedStructures.construct(o)}addElevatedRoadFeature(o,a,u,g,p){const y=new Array,C=this.getElevationFeature(o,p);if(C){y.push({polygons:a,elevationFeature:C,elevationTileID:u});for(const S of y)if(S.elevationFeature){if("hd-road-base"===this.elevationMode){this.elevatedStructures||(this.elevatedStructures=new Ql(S.elevationTileID));const b=S.elevationFeature.isTunnel();let D=0;o.properties.hasOwnProperty("level")&&(D=+o.properties.level);for(const k of S.polygons)this.elevatedStructures.addPortalCandidates(S.elevationFeature.id,k,b,S.elevationFeature,D)}const I=new up(u,S.elevationTileID);this.addElevatedGeometry(S.polygons,I,S.elevationFeature,"hd-road-base"===this.elevationMode?0:.05,g)}}else this.addGeometry(a,this.bufferData)}addElevatedGeometry(o,a,u,g,p){const y={elevation:u,elevationSampler:a,bias:g,index:p},[C,S]=this.addGeometry(o,this.elevationBufferData,y);null==this.elevationBufferData.heightRange?this.elevationBufferData.heightRange={min:C,max:S}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,C),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,S))}addGeometry(o,a,u){let g=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,y=null;u&&(y=u.elevationSampler.constantElevation(u.elevation,u.bias),null!=y&&(g=y,p=y));const C=(S,I,b)=>{if(null!=u)if(I.push(S),null!=y)a.elevatedLayoutVertexArray.emplaceBack(y),b.push(y);else{const D=u.elevationSampler.pointElevation(S,u.elevation,u.bias);a.elevatedLayoutVertexArray.emplaceBack(D),b.push(D),g=Math.min(g,D),p=Math.max(p,D)}};for(const S of o){let I=0;for(const G of S)I+=G.length;const b=a.triangleSegments.prepareSegment(I,a.layoutVertexArray,a.indexArray),D=b.vertexLength,k=[],T=[],A=[],O=[],B=[],V=a.layoutVertexArray.length;for(const G of S){if(0===G.length)continue;G!==S[0]&&T.push(k.length/2);const H=a.lineSegments.prepareSegment(G.length,a.layoutVertexArray,a.lineIndexArray),Z=H.vertexLength;u&&B.push(a.layoutVertexArray.length-V),C(G[0],A,O),a.layoutVertexArray.emplaceBack(G[0].x,G[0].y),a.lineIndexArray.emplaceBack(Z+G.length-1,Z),k.push(G[0].x),k.push(G[0].y);for(let ee=1;ee<G.length;ee++)C(G[ee],A,O),a.layoutVertexArray.emplaceBack(G[ee].x,G[ee].y),a.lineIndexArray.emplaceBack(Z+ee-1,Z+ee),k.push(G[ee].x),k.push(G[ee].y);H.vertexLength+=G.length,H.primitiveLength+=G.length}const q=T_(k,T);for(let G=0;G<q.length;G+=3)a.indexArray.emplaceBack(D+q[G],D+q[G+1],D+q[G+2]);if(u&&"hd-road-base"===this.elevationMode){const G=u.elevation.isTunnel(),H=u.elevation.safeArea,Z=this.elevatedStructures.addVertices(A,O);this.elevatedStructures.addTriangles(q,Z,G);const ee=B.length;if(ee>0){for(let ie=0;ie<ee-1;ie++)this.elevatedStructures.addRenderableRing(u.index,B[ie]+Z,B[ie+1]-B[ie],G,H);this.elevatedStructures.addRenderableRing(u.index,B[ee-1]+Z,A.length-B[ee-1],G,H)}}b.vertexLength+=I,b.primitiveLength+=q.length/3}return[g,p]}getElevationFeature(o,a){if(!a)return;const u=+o.properties[ch];return null!=u?a.find(g=>g.id===u):void 0}}let zx,eb,kf,Bx;Zt(Qm,"FillBucket",{omit:["layers","patternFeatures"]}),Zt(P_,"FillBufferData"),Zt(Ql,"ElevatedStructures");class tb{constructor(o,a,u,g){if(this.triangleCount=a.length/3,this.min=new Ot(0,0),this.max=new Ot(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],0===this.triangleCount||0===o.length)return;const[p,y]=[o[0].clone(),o[0].clone()];for(let D=1;D<o.length;++D){const k=o[D];p.x=Math.min(p.x,k.x),p.y=Math.min(p.y,k.y),y.x=Math.max(y.x,k.x),y.y=Math.max(y.y,k.y)}if(g){const D=Math.ceil(Math.max(y.x-p.x,y.y-p.y)/g);u=Math.max(u,D)}if(0===u)return;this.min=p,this.max=y;const C=this.max.sub(this.min);C.x=Math.max(C.x,1),C.y=Math.max(C.y,1);const S=Math.max(C.x,C.y)/u;this.cellsX=Math.max(1,Math.ceil(C.x/S)),this.cellsY=Math.max(1,Math.ceil(C.y/S)),this.xScale=1/S,this.yScale=1/S;const I=[];for(let D=0;D<this.triangleCount;D++){const k=o[a[3*D+0]].sub(this.min),T=o[a[3*D+1]].sub(this.min),A=o[a[3*D+2]].sub(this.min),O=_d(Math.floor(Math.min(k.x,T.x,A.x)),this.xScale,this.cellsX),B=_d(Math.floor(Math.max(k.x,T.x,A.x)),this.xScale,this.cellsX),V=_d(Math.floor(Math.min(k.y,T.y,A.y)),this.yScale,this.cellsY),q=_d(Math.floor(Math.max(k.y,T.y,A.y)),this.yScale,this.cellsY),G=new Ot(0,0),H=new Ot(0,0),Z=new Ot(0,0),ee=new Ot(0,0);for(let ie=V;ie<=q;++ie){G.y=H.y=ie*S,Z.y=ee.y=(ie+1)*S;for(let me=O;me<=B;++me)G.x=Z.x=me*S,H.x=ee.x=(me+1)*S,(et(k,T,A,G,H,ee)||et(k,T,A,G,ee,Z))&&I.push({cellIdx:ie*this.cellsX+me,triIdx:D})}}if(0===I.length)return;I.sort((D,k)=>D.cellIdx-k.cellIdx||D.triIdx-k.triIdx);let b=0;for(;b<I.length;){const D=I[b].cellIdx,k={start:this.payload.length,len:0};for(;b<I.length&&I[b].cellIdx===D;)++k.len,this.payload.push(I[b++].triIdx);this.cells[D]=k}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(o,a){if(0===this.triangleCount||0===this.cells.length||o.x>this.max.x||this.min.x>o.x||o.y>this.max.y||this.min.y>o.y)return;const u=_d(o.x-this.min.x,this.xScale,this.cellsX),g=_d(o.y-this.min.y,this.yScale,this.cellsY),p=this.cells[g*this.cellsX+u];if(p){this._lazyInitLookup();for(let y=0;y<p.len;y++){const C=this.payload[p.start+y],S=Math.floor(C/8),I=1<<C%8;if(!(this.lookup[S]&I)&&(this.lookup[S]|=I,a.push(C),a.length===this.triangleCount))return}}}query(o,a,u){if(0===this.triangleCount||0===this.cells.length||o.x>this.max.x||this.min.x>a.x||o.y>this.max.y||this.min.y>a.y)return;this._lazyInitLookup();const g=_d(o.x-this.min.x,this.xScale,this.cellsX),p=_d(a.x-this.min.x,this.xScale,this.cellsX),y=_d(o.y-this.min.y,this.yScale,this.cellsY),C=_d(a.y-this.min.y,this.yScale,this.cellsY);for(let S=y;S<=C;S++)for(let I=g;I<=p;I++){const b=this.cells[S*this.cellsX+I];if(b)for(let D=0;D<b.len;D++){const k=this.payload[b.start+D],T=Math.floor(k/8),A=1<<k%8;if(!(this.lookup[T]&A)&&(this.lookup[T]|=A,u.push(k),u.length===this.triangleCount))return}}}}function _d(d,o,a){return Math.max(0,Math.min(a-1,Math.floor(d*o)))}Zt(tb,"TriangleGridIndex");class nb{constructor(o){this.zoom=o.zoom,this.layers=o.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=o.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.footprints=[]}updateFootprints(o,a){for(const u of this.footprints)a.push({footprint:u,id:o})}populate(o,a,u,g){const p=[];for(const{feature:y,id:C,index:S,sourceLayerIndex:I}of o){const b=this.layers[0]._featureFilter.needGeometry,D=z(y,b);if(!this.layers[0]._featureFilter.filter(new sr(this.zoom),D,u))continue;const k={id:C,properties:y.properties,type:y.type,sourceLayerIndex:I,index:S,geometry:b?D.geometry:N(y,u,g),patterns:{}};p.push(k)}for(const y of p){const{geometry:C,index:S,sourceLayerIndex:I}=y;this.addFeature(y,C,S,u,{},a.availableImages,a.brightness),a.featureIndex.insert(o[S].feature,C,S,I,this.index)}}isEmpty(){return 0===this.footprints.length}uploadPending(){return!1}upload(o){}update(o,a,u,g,p,y,C){}destroy(){}addFeature(o,a,u,g,p,y=[],C){for(const S of k_(a,2)){const I=[],b=[],D=[],k=new Ot(1/0,1/0),T=new Ot(-1/0,-1/0);for(const B of S)if(0!==B.length){B!==S[0]&&D.push(b.length/2);for(let V=0;V<B.length;V++)b.push(B[V].x),b.push(B[V].y),I.push(B[V]),k.x=Math.min(k.x,B[V].x),k.y=Math.min(k.y,B[V].y),T.x=Math.max(T.x,B[V].x),T.y=Math.max(T.y,B[V].y)}const A=T_(b,D),O=new tb(I,A,8,256);this.footprints.push({vertices:I,indices:A,grid:O,min:k,max:T})}}}Zt(nb,"ClipBucket",{omit:["layers"]});const VE=ki([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),UE=ki([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),Vx=ki([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Ux=ki([{name:"a_join_normal_inside",components:3,type:"Int16"}]),Jm=ki([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),jE=ki([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Cl}=VE;class eg extends Ot{constructor(o,a,u){super(o,a),this.z=u}}class O_ extends eg{constructor(o,a,u,g){super(o,a,u),this.w=g}}function ib(d,o,a,u){const g=[],p=0===u?(y,C,S,I,b,D)=>{y.push(new Ot(D,S+(D-C)/(I-C)*(b-S)))}:(y,C,S,I,b,D)=>{y.push(new Ot(C+(D-S)/(b-S)*(I-C),D))};for(const y of d){const C=[];for(const S of y){if(S.length<=2)continue;const I=[];for(let k=0;k<S.length-1;k++){const T=S[k].x,A=S[k].y,O=S[k+1].x,B=S[k+1].y,V=0===u?T:A,q=0===u?O:B;V<o?q>o&&p(I,T,A,O,B,o):V>a?q<a&&p(I,T,A,O,B,a):I.push(S[k]),q<o&&V>=o&&p(I,T,A,O,B,o),q>a&&V<=a&&p(I,T,A,O,B,a)}let b=S[S.length-1];const D=0===u?b.x:b.y;D>=o&&D<=a&&I.push(b),I.length&&(b=I[I.length-1],I[0].x===b.x&&I[0].y===b.y||I.push(I[0]),C.push(I))}C.length&&g.push(C)}return g}function Rf(d,o,a,u){const g="x"===a?"y":"x",p=(u-d[a])/(o[a]-d[a]);d[g]=d[g]+(o[g]-d[g])*p,d[a]=u,d.hasOwnProperty("z")&&(d.z=_n(d.z,o.z,p)),d.hasOwnProperty("w")&&(d.w=_n(d.w,o.w,p))}function rb(d,o,a,u){const g=a,p=u;for(const y of["x","y"]){let C=d,S=o;C[y]>=S[y]&&(C=o,S=d),C[y]<g&&S[y]>g&&Rf(C,S,y,g),C[y]<p&&S[y]>p&&Rf(S,C,y,p)}}const F_=Number.MAX_SAFE_INTEGER;function jx(d,o,a,u){return d.order<o||d.order===F_||!(d.clipMask&a)||(g=u,0!==(p=d.clipScope).length&&void 0===p.find(y=>y===g));var g,p}function L_(d,o){return d.x-o.x||d.y-o.y}function tg(d,o){return 0===L_(d.min,o.min)&&0===L_(d.max,o.max)}function El(d,o){return!(d.min.x>o.max.x||d.max.x<o.min.x||d.min.y>o.max.y||d.max.y<o.min.y)}function Hx(d,o){if(d.length!==o.length)return!1;for(let a=0;a<d.length;a++)if(d[a].sourceId!==o[a].sourceId||!tg(d[a],o[a])||d[a].order!==o[a].order||d[a].clipMask!==o[a].clipMask||!Bl(d[a].clipScope,o[a].clipScope))return!1;return!0}function $x(d,o,a){const u=1/kt,g=1/(1<<a.canonical.z),p=(o.x*u+a.canonical.x)*g+a.wrap,y=(o.y*u+a.canonical.y)*g;return{min:new Ot((d.x*u+a.canonical.x)*g+a.wrap,(d.y*u+a.canonical.y)*g),max:new Ot(p,y)}}function cO(d,o,a){const u=1<<a.canonical.z,g=((o.x-a.wrap)*u-a.canonical.x)*kt,p=(o.y*u-a.canonical.y)*kt;return{min:new Ot(((d.x-a.wrap)*u-a.canonical.x)*kt,(d.y*u-a.canonical.y)*kt),max:new Ot(g,p)}}function $o(d,o,a,u,g,p,y){const C=d.indices,S=d.vertices,I=[];for(let b=u;b<u+g;b+=3){const D=o[a[b+0]+p],k=o[a[b+1]+p],T=o[a[b+2]+p],A=Math.min(D.x,k.x,T.x),O=Math.max(D.x,k.x,T.x),B=Math.min(D.y,k.y,T.y),V=Math.max(D.y,k.y,T.y);I.length=0,d.grid.query(new Ot(A,B),new Ot(O,V),I);for(let q=0;q<I.length;q++){const G=I[q];if(et(S[C[3*G+0]],S[C[3*G+1]],S[C[3*G+2]],D,k,T,y))return!0}}return!1}function N_(d,o,a,u){if(!d||!a)return!1;let g=d.vertices;if(!o.canonical.equals(u.canonical)||o.wrap!==u.wrap){if(a.vertices.length<d.vertices.length)return N_(a,u,d,o);const p=o.canonical,y=u.canonical,C=Math.pow(2,y.z-p.z);g=d.vertices.map(S=>new Ot((S.x+p.x*kt)*C-y.x*kt,(S.y+p.y*kt)*C-y.y*kt))}return $o(a,g,d.indices,0,d.indices.length,0,0)}function Gx(d,o,a,u){const g=Math.pow(2,u.z-a.z);return new Ot((d+a.x*kt)*g-u.x*kt,(o+a.y*kt)*g-u.y*kt)}function qr(d,o){const a=[];o.grid.queryPoint(d,a);const u=o.indices,g=o.vertices;for(let p=0;p<a.length;p++){const y=a[p];if(De([g[u[3*y+0]],g[u[3*y+1]],g[u[3*y+2]]],d))return!0}return!1}const hp=[new Ot(0,0),new Ot(kt,0),new Ot(kt,kt),new Ot(0,kt)];function Pf(d,o){const a=[];let u=[];if(!o||d.length<2)return[d];if(2===d.length)return ke(d[0],d[1],hp)?[d]:[];for(let g=0;g<d.length+2;g++){const p=d[g%d.length],y=d[(g+1)%d.length],C=ke(0===g?d[d.length-1]:d[(g-1)%d.length],p,hp),S=ke(p,y,hp),I=C||S;I&&u.push(p),I&&S||u.length>0&&(u.length>1&&a.push(u),u=[])}return u.length>1&&a.push(u),a}const yd=dp.VectorTileFeature.types,z_=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],ob=["fill-extrusion-flood-light-ground-radius"],gI=Math.pow(2,13),_I=Math.pow(2,15)-1,Of=new Ot(0,1),pp=2147483648;function uu(d,o,a,u,g,p,y,C){d.emplaceBack((o<<1)+y,(a<<1)+p,(Math.floor(u*gI)<<1)+g,Math.round(C))}function B_(d,o,a){d.emplaceBack(o.x*kt,o.y*kt,a?1:0)}function V_(d,o,a,u,g,p){d.emplaceBack(o.x,o.y,(a.x<<1)+u,(a.y<<1)+g,p)}function dh(d,o,a){d.emplaceBack(o.x,o.y,o.z,16384*a[0],16384*a[1],16384*a[2])}class U_{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class qx{constructor(){this.centroidXY=new Ot(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Ot(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Ot(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Ot(this.max.x-this.min.x,this.max.y-this.min.y)}}class Wx{constructor(){this.acc=new Ot(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(o,a){o.min.x===Number.MAX_VALUE&&(o.min.x=o.max.x=a.x,o.min.y=o.max.y=a.y)}appendEdge(o,a,u){this.accCount++,this.acc._add(a);let g=!!this.borders;a.x<o.min.x?(o.min.x=a.x,g=!0):a.x>o.max.x&&(o.max.x=a.x,g=!0),a.y<o.min.y?(o.min.y=a.y,g=!0):a.y>o.max.y&&(o.max.y=a.y,g=!0),((0===a.x||a.x===kt)&&a.x===u.x)!=((0===a.y||a.y===kt)&&a.y===u.y)&&this.processBorderOverlap(a,u),g&&this.checkBorderIntersection(a,u)}checkBorderIntersection(o,a){a.x<0!=o.x<0&&this.addBorderIntersection(0,_n(a.y,o.y,(0-a.x)/(o.x-a.x))),a.x>kt!=o.x>kt&&this.addBorderIntersection(1,_n(a.y,o.y,(kt-a.x)/(o.x-a.x))),a.y<0!=o.y<0&&this.addBorderIntersection(2,_n(a.x,o.x,(0-a.y)/(o.y-a.y))),a.y>kt!=o.y>kt&&this.addBorderIntersection(3,_n(a.x,o.x,(kt-a.y)/(o.y-a.y)))}addBorderIntersection(o,a){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[o];a<u[0]&&(u[0]=a),a>u[1]&&(u[1]=a)}processBorderOverlap(o,a){if(o.x===a.x){if(o.y===a.y)return;const u=0===o.x?0:1;this.addBorderIntersection(u,a.y),this.addBorderIntersection(u,o.y)}else{const u=0===o.y?2:3;this.addBorderIntersection(u,a.x),this.addBorderIntersection(u,o.x)}}centroid(){return 0===this.accCount?new Ot(0,0):new Ot(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((o,a)=>o+ +(a[0]!==Number.MAX_VALUE),0):0}}function ng(d,o){const a=d.add(o)._unit(),u=Qn(d.x*a.x+d.y*a.y,-1,1);var g,p,y;return y=Math.acos(u),Math.min(4,Math.max(-4,Math.tan(y)))/4*_I*((g=d).x*(p=o).y-g.y*p.x<0?-1:1)}const Xa=[d=>d.x<0,d=>d.x>kt,d=>d.y<0,d=>d.y>kt];function yI(d,o,a,u){const g=[4];if(0===u)return g;a._mult(u);const p=d.sub(a),y=o.sub(a),C=[d,o,p,y];for(let S=0;S<4;S++)for(const I of C)if(Xa[S](I)){g.push(S);break}return g}class ks{constructor(o){this.vertexArray=new _l,this.indexArray=new Vo,this.programConfigurations=new pd(o.layers,{zoom:o.zoom,lut:o.lut},a=>ob.includes(a)),this._segments=new hr,this.hiddenByLandmarkVertexArray=new bf,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new hr}getDefaultSegment(){return this.regionSegments[4]}hasData(){return 0!==this.vertexArray.length}addData(o,a,u,g=!1){const p=o.length;if(p>2){let y=Math.max(0,this._segments.get().length-1);const C=this._segments._prepareSegment(4*p,this.vertexArray.length,2*this._segmentToGroundQuads[y].length);let S;y!==this._segments.get().length-1&&(y++,this._segmentToGroundQuads[y]=[],this._segmentToRegionTriCounts[y]=[0,0,0,0,0]);{const I=o[0],b=o[1];S=ng(I.sub(o[p-1])._perp()._unit(),b.sub(I)._perp()._unit())}for(let I=0;I<p;I++){const b=I===p-1?0:I+1,D=o[I],k=o[b],T=o[b===p-1?0:b+1],A=k.sub(D)._perp()._unit(),O=ng(A,T.sub(k)._perp()._unit()),B=S,V=O;if(ab(D,k,a)||g&&$E(D,a)&&$E(k,a)){S=O;continue}const q=C.vertexLength;V_(this.vertexArray,D,k,1,1,B),V_(this.vertexArray,D,k,1,0,B),V_(this.vertexArray,D,k,0,1,V),V_(this.vertexArray,D,k,0,0,V),C.vertexLength+=4;const G=yI(D,k,A,u);for(const H of G)this._segmentToGroundQuads[y].push({id:q,region:H}),this._segmentToRegionTriCounts[y][H]+=2,C.primitiveLength+=2;S=O}}}prepareBorderSegments(){if(!this.hasData())return;const o=this._segments.get(),a=o.length;for(let u=0;u<a;u++)this._segmentToGroundQuads[u].sort((g,p)=>g.region-p.region);for(let u=0;u<a;u++){const g=this._segmentToGroundQuads[u],p=o[u],y=this._segmentToRegionTriCounts[u];y.reduce((S,I)=>S+I,0);let C=0;for(let S=0;S<=4;S++){const I=y[S];if(0!==I){let b=this.regionSegments[S];b||(b=this.regionSegments[S]=new hr);const D={vertexOffset:p.vertexOffset,primitiveOffset:p.primitiveOffset+C,vertexLength:p.vertexLength,primitiveLength:I};b.get().push(D)}C+=I}for(let S=0;S<g.length;S++){const I=g[S].id;this.indexArray.emplaceBack(I,I+1,I+3),this.indexArray.emplaceBack(I,I+3,I+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(o,a,u,g,p,y){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,o,a,u,g,p,y)}upload(o){this.hasData()&&(this.vertexBuffer=o.createVertexBuffer(this.vertexArray,UE.members),this.indexBuffer=o.createIndexBuffer(this.indexArray))}uploadPaintProperties(o){this.hasData()&&this.programConfigurations.upload(o)}update(o,a,u,g,p,y,C){this.hasData()&&this.programConfigurations.updatePaintArrays(o,a,u,g,p,y,C)}updateHiddenByLandmark(o){if(!this.hasData())return;const a=o.groundVertexCount+o.groundVertexArrayOffset;if(0===o.groundVertexCount)return;const u=o.flags&pp?1:0;for(let g=o.groundVertexArrayOffset;g<a;++g)this.hiddenByLandmarkVertexArray.emplace(g,u);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(o){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=o.createVertexBuffer(this.hiddenByLandmarkVertexArray,Jm.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let o=0;o<=4;o++){const a=this.regionSegments[o];a&&a.destroy()}}}}class sb{constructor(o){this.zoom=o.zoom,this.canonical=o.canonical,this.overscaling=o.overscaling,this.layers=o.layers,this.pixelRatio=o.pixelRatio,this.layerIds=this.layers.map(a=>a.fqid),this.index=o.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=o.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Vo,this.footprintVertices=new Yl,this.footprintSegments=[],this.layoutVertexArray=new cd,this.centroidVertexArray=new Ao,this.wallVertexArray=new Vr,this.indexArray=new Vo,this.programConfigurations=new pd(o.layers,{zoom:o.zoom,lut:o.lut},a=>z_.includes(a)),this.segments=new hr,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.groundEffect=new ks(o),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(o,a){}populate(o,a,u,g){this.features=[],this.hasPattern=Ic("fill-extrusion",this.layers,this.pixelRatio,a),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=m(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=0!==this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1);for(const{feature:p,id:y,index:C,sourceLayerIndex:S}of o){const I=this.layers[0]._featureFilter.needGeometry,b=z(p,I);if(!this.layers[0]._featureFilter.filter(new sr(this.zoom),b,u))continue;const D={id:y,sourceLayerIndex:S,index:C,geometry:I?b.geometry:N(p,u,g),properties:p.properties,type:p.type,patterns:{}},k=this.layoutVertexArray.length,T="Polygon"===yd[D.type];if(this.hasPattern)this.features.push(gd("fill-extrusion",this.layers,D,this.zoom,this.pixelRatio,a));else if(this.wallMode)for(const A of D.geometry)for(const O of Pf(A,T))this.addFeature(D,[O],C,u,{},a.availableImages,g,a.brightness);else this.addFeature(D,D.geometry,C,u,{},a.availableImages,g,a.brightness);a.featureIndex.insert(p,D.geometry,C,S,this.index,k)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(o,a,u,g,p,y){for(const C of this.features){const S="Polygon"===yd[C.type],{geometry:I}=C;if(this.wallMode)for(const b of I)for(const D of Pf(b,S))this.addFeature(C,[D],C.index,a,u,g,p,y);else this.addFeature(C,I,C.index,a,u,g,p,y)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles()}update(o,a,u,g,p,y,C){this.programConfigurations.updatePaintArrays(o,a,p,u,g,y,C),this.groundEffect.update(o,a,p,u,g,y,C)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Cl),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.wallVertexBuffer=o.createVertexBuffer(this.wallVertexArray,Ux.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=o.createVertexBuffer(this.layoutVertexExtArray,jE.members,!0)),this.groundEffect.upload(o)),this.groundEffect.uploadPaintProperties(o),this.programConfigurations.upload(o),this.uploaded=!0}uploadCentroid(o){this.groundEffect.uploadHiddenByLandmark(o),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=o.createVertexBuffer(this.centroidVertexArray,Vx.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(o,a,u,g,p,y,C,S){const I=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(o,{})/this.tileToMeter,b=[new Ot(0,0),new Ot(kt,kt)],D=C.projection,k="globe"===D.name,T=this.wallMode||"Polygon"===yd[o.type],A=new Wx;A.centroidDataIndex=this.centroidData.length;const O=new qx,B=this.layers[0].paint.get("fill-extrusion-base").evaluate(o,{},g)<=0,V=this.layers[0].paint.get("fill-extrusion-height").evaluate(o,{},g);let q;if(O.height=V,O.vertexArrayOffset=this.layoutVertexArray.length,O.groundVertexArrayOffset=this.groundEffect.vertexArray.length,k&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Zi),this.wallMode){if(k)return void Ir("Non zero fill-extrusion-line-width is not yet supported on globe.");if(1!==a.length)return;q=function(pe){const Te=pe[0].x===pe[pe.length-1].x&&pe[0].y===pe[pe.length-1].y;(function(yt){let pt=0;const fn=yt.length;for(let Ut=0;Ut<fn;Ut++)pt+=(yt[(Ut+1)%fn].x-yt[Ut].x)*(yt[(Ut+1)%fn].y+yt[Ut].y);return pt>=0})(pe)||(pe=pe.reverse());const Ie={geometry:[],joinNormals:[],indices:[]},Le=[],Fe=[],Ve=[];let ze=pe.length;for(;ze>=2&&pe[ze-1].equals(pe[ze-2]);)ze--;if(ze<(Te?3:2))return Ie;let We,Ue,Ze,ht,ut,qt=0;for(;qt<ze-1&&pe[qt].equals(pe[qt+1]);)qt++;Te&&(We=pe[ze-2],ut=pe[qt].sub(We)._unit()._perp());for(let yt=qt;yt<ze;yt++){if(Ze=yt===ze-1?Te?pe[qt+1]:void 0:pe[yt+1],Ze&&pe[yt].equals(Ze))continue;ut&&(ht=ut),We&&(Ue=We),We=pe[yt],ut=Ze?Ze.sub(We)._unit()._perp():ht,ht=ht||ut;let pt=ht.add(ut);0===pt.x&&0===pt.y||pt._unit();const fn=pt.x*ut.x+pt.y*ut.y,Ut=0!==fn?1/fn:1/0,Jt=ht.x*ut.y-ht.y*ut.x>0;let xn="miter";const Bn=2;"miter"===xn&&Ut>Bn&&(xn="bevel"),"bevel"===xn&&(Ut>100&&(xn="flipbevel"),Ut<Bn&&(xn="miter"));const En=(ti,Vn,ui,Si)=>{const Ui=new Ot(ti.x,ti.y),wn=new Ot(ti.x,ti.y);Ui.x+=Vn.x*Si,Ui.y+=Vn.y*Si,wn.x-=Vn.x*Math.max(ui,1),wn.y-=Vn.y*Math.max(ui,1),Ve.push(Vn),Le.push(Ui),Fe.push(wn)};if("miter"===xn)pt._mult(Ut),En(We,pt,0,0);else if("flipbevel"===xn)pt=ut.mult(-1),En(We,pt,0,0),En(We,pt.mult(-1),0,0);else{const ti=-Math.sqrt(Ut*Ut-1),Vn=Jt?ti:0,ui=Jt?0:ti;Ue&&En(We,ht,Vn,ui),Ze&&En(We,ut,Vn,ui)}}Ie.geometry=[...Le,...Fe.reverse(),Le[0]],Ie.joinNormals=[...Ve,...Ve.reverse(),Ve[Ve.length-1]];const gt=Ie.geometry.length-1;for(let yt=0;yt<gt/2;yt++)if(yt+1<gt/2){let pt=yt,fn=yt+1,Ut=gt-1-yt,Jt=gt-2-yt;pt=0===pt?gt-1:pt-1,fn=0===fn?gt-1:fn-1,Ut=0===Ut?gt-1:Ut-1,Jt=0===Jt?gt-1:Jt-1,Ie.indices.push(Ut),Ie.indices.push(fn),Ie.indices.push(pt),Ie.indices.push(Ut),Ie.indices.push(Jt),Ie.indices.push(fn)}return Ie}(a[0]),a=[q.geometry]}const G=(pe,Te)=>pe<(Te.length-1)/2||pe===Te.length-1,H=this.wallMode?[a]:k_(a,500);for(let pe=H.length-1;pe>=0;pe--){const Te=H[pe];(0===Te.length||(Z=Te[0]).every(_e=>_e.x<=0)||Z.every(_e=>_e.x>=kt)||Z.every(_e=>_e.y<=0)||Z.every(_e=>_e.y>=kt))&&H.splice(pe,1)}var Z;let ee;if(k)ee=bI(H,b,g);else{ee=[];for(const pe of H)ee.push({polygon:pe,bounds:b})}const ie=T?this.edgeRadius:0,me=ie>0&&this.zoom<17,ue=(pe,Te)=>{if(0===pe.length)return!1;const _e=pe[pe.length-1];return Te.x===_e.x&&Te.y===_e.y};for(const{polygon:pe,bounds:Te}of ee){let _e=0,Ie=0;for(const ze of pe)T&&!ze[0].equals(ze[ze.length-1])&&ze.push(ze[0]),Ie+=T?ze.length-1:ze.length;const Le=this.segments.prepareSegment((T?5:4)*Ie,this.layoutVertexArray,this.indexArray);O.footprintSegIdx<0&&(O.footprintSegIdx=this.footprintSegments.length),O.polygonSegIdx<0&&(O.polygonSegIdx=this.polygonSegments.length);const Fe={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Ve=new U_;if(Ve.vertexOffset=this.footprintVertices.length,Ve.indexOffset=3*this.footprintIndices.length,Ve.ringIndices=[],T){const ze=[],We=[];_e=Le.vertexLength;for(let Ze=0;Ze<pe.length;Ze++){const ht=pe[Ze];ht.length&&0!==Ze&&We.push(ze.length/2);const ut=[];let qt,gt;qt=ht[1].sub(ht[0])._perp()._unit(),Ve.ringIndices.push(ht.length-1);for(let yt=1;yt<ht.length;yt++){const pt=ht[yt],fn=ht[yt===ht.length-1?1:yt+1],Ut=pt.clone();if(ie){gt=fn.sub(pt)._perp()._unit();const Jt=qt.add(gt)._unit(),xn=ie*Math.min(4,1/(qt.x*Jt.x+qt.y*Jt.y));Ut.x+=xn*Jt.x,Ut.y+=xn*Jt.y,Ut.x=Math.round(Ut.x),Ut.y=Math.round(Ut.y),qt=gt}if(!B||0!==ie&&!me||ue(ut,Ut)||ut.push(Ut),uu(this.layoutVertexArray,Ut.x,Ut.y,0,0,1,1,0),this.wallMode){const Jt=G(yt,ht);B_(this.wallVertexArray,q.joinNormals[yt],!Jt)}Le.vertexLength++,this.footprintVertices.emplaceBack(pt.x,pt.y),ze.push(pt.x,pt.y),k&&dh(this.layoutVertexExtArray,D.projectTilePoint(Ut.x,Ut.y,g),D.upVector(g,Ut.x,Ut.y))}B&&(0===ie||me)&&(0!==ut.length&&ue(ut,ut[0])&&ut.pop(),this.groundEffect.addData(ut,Te,I))}const Ue=this.wallMode?q.indices:T_(ze,We);for(let Ze=0;Ze<Ue.length;Ze+=3)this.footprintIndices.emplaceBack(Ve.vertexOffset+Ue[Ze+0],Ve.vertexOffset+Ue[Ze+1],Ve.vertexOffset+Ue[Ze+2]),this.indexArray.emplaceBack(_e+Ue[Ze],_e+Ue[Ze+2],_e+Ue[Ze+1]),Le.primitiveLength++;Ve.indexCount+=Ue.length,Ve.vertexCount+=this.footprintVertices.length-Ve.vertexOffset}for(let ze=0;ze<pe.length;ze++){const We=pe[ze];A.startRing(O,We[0]);let Ue=We.length>4&&vI(We[We.length-2],We[0],We[1]),Ze=ie?Yx(We[We.length-2],We[0],We[1],ie):0;const ht=[];let ut,qt,gt;qt=We[1].sub(We[0])._perp()._unit();let yt=!0;for(let pt=1,fn=0;pt<We.length;pt++){let Ut=We[pt-1],Jt=We[pt];const xn=We[pt===We.length-1?1:pt+1];if(A.appendEdge(O,Jt,Ut),ab(Jt,Ut,Te)){ie&&(qt=xn.sub(Jt)._perp()._unit(),yt=!yt);continue}const Bn=Jt.sub(Ut)._perp(),En=Bn.x/(Math.abs(Bn.x)+Math.abs(Bn.y)),ti=Bn.y>0?1:0,Vn=Ut.dist(Jt);if(fn+Vn>32768&&(fn=0),ie){gt=xn.sub(Jt)._perp()._unit();let wn=Zx(Ut,Jt,xn,HE(qt,gt),ie);isNaN(wn)&&(wn=0);const hi=Jt.sub(Ut)._unit();Ut=Ut.add(hi.mult(Ze))._round(),Jt=Jt.add(hi.mult(-wn))._round(),Ze=wn,qt=gt,B&&this.zoom>=17&&(ue(ht,Ut)||ht.push(Ut),ue(ht,Jt)||ht.push(Jt))}const ui=Le.vertexLength,Si=We.length>4&&vI(Ut,Jt,xn);let Ui=Xx(fn,Ue,yt);if(uu(this.layoutVertexArray,Ut.x,Ut.y,En,ti,0,0,Ui),uu(this.layoutVertexArray,Ut.x,Ut.y,En,ti,0,1,Ui),this.wallMode){const wn=G(pt-1,We),hi=q.joinNormals[pt-1];B_(this.wallVertexArray,hi,wn),B_(this.wallVertexArray,hi,wn)}if(fn+=Vn,Ui=Xx(fn,Si,!yt),Ue=Si,uu(this.layoutVertexArray,Jt.x,Jt.y,En,ti,0,0,Ui),uu(this.layoutVertexArray,Jt.x,Jt.y,En,ti,0,1,Ui),this.wallMode){const wn=G(pt,We),hi=q.joinNormals[pt];B_(this.wallVertexArray,hi,wn),B_(this.wallVertexArray,hi,wn)}if(Le.vertexLength+=4,this.indexArray.emplaceBack(ui+0,ui+1,ui+2),this.indexArray.emplaceBack(ui+1,ui+3,ui+2),Le.primitiveLength+=2,ie){const wn=_e+(1===pt?We.length-2:pt-2),hi=1===pt?_e:wn+1;if(this.indexArray.emplaceBack(ui+1,wn,ui+3),this.indexArray.emplaceBack(wn,hi,ui+3),Le.primitiveLength+=2,void 0===ut&&(ut=ui),!ab(xn,We[pt],Te)){const lr=pt===We.length-1?ut:Le.vertexLength;this.indexArray.emplaceBack(ui+2,ui+3,lr),this.indexArray.emplaceBack(ui+3,lr+1,lr),this.indexArray.emplaceBack(ui+3,hi,lr+1),Le.primitiveLength+=3}yt=!yt}if(k){const wn=this.layoutVertexExtArray,hi=D.projectTilePoint(Ut.x,Ut.y,g),lr=D.projectTilePoint(Jt.x,Jt.y,g),Cr=D.upVector(g,Ut.x,Ut.y),ft=D.upVector(g,Jt.x,Jt.y);dh(wn,hi,Cr),dh(wn,hi,Cr),dh(wn,lr,ft),dh(wn,lr,ft)}}T&&(_e+=We.length-1),B&&ie&&this.zoom>=17&&(0!==ht.length&&ue(ht,ht[0])&&ht.pop(),this.groundEffect.addData(ht,Te,I,ie>0))}this.footprintSegments.push(Ve),Fe.triangleCount=this.indexArray.length-Fe.triangleArrayOffset,this.polygonSegments.push(Fe),++O.footprintSegLen,++O.polygonSegLen}if(O.vertexCount=this.layoutVertexArray.length-O.vertexArrayOffset,O.groundVertexCount=this.groundEffect.vertexArray.length-O.groundVertexArrayOffset,0!==O.vertexCount){if(O.centroidXY=A.borders?Of:this.encodeCentroid(A,O),this.centroidData.push(O),A.borders){this.featuresOnBorder.push(A);const pe=this.featuresOnBorder.length-1;for(let Te=0;Te<A.borders.length;Te++)A.borders[Te][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Te].push(pe)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,u,p,y,g,S),this.groundEffect.addPaintPropertiesData(o,u,p,y,g,S),this.maxHeight=Math.max(this.maxHeight,V)}}sortBorders(){for(let o=0;o<this.borderFeatureIndices.length;o++)this.borderFeatureIndices[o].sort((a,u)=>this.featuresOnBorder[a].borders[o][0]-this.featuresOnBorder[u].borders[o][0])}splitToSubtiles(){const o=[];for(let C=0;C<this.centroidData.length;C++){const S=this.centroidData[C],I=+(S.min.y+S.max.y>kt),b=2*I+(+(S.min.x+S.max.x>kt)^I);for(let D=0;D<S.polygonSegLen;D++){const k=S.polygonSegIdx+D;o.push({centroidIdx:C,subtile:b,polygonSegmentIdx:k,triangleSegmentIdx:this.polygonSegments[k].triangleSegIdx})}}const a=new Vo;o.sort((C,S)=>C.triangleSegmentIdx===S.triangleSegmentIdx?C.subtile-S.subtile:C.triangleSegmentIdx-S.triangleSegmentIdx);let u=0,g=0,p=0;for(const C of o){if(C.triangleSegmentIdx!==u)break;p++}const y=o.length;for(;g!==o.length;){u=o[g].triangleSegmentIdx;let C=0,S=g,I=g;for(let b=S;b<p&&o[b].subtile===C;b++)I++;for(;S!==p;){const b=o[S];C=b.subtile;const D=this.centroidData[b.centroidIdx].min.clone(),k=this.centroidData[b.centroidIdx].max.clone(),T={vertexOffset:this.segments.segments[u].vertexOffset,primitiveOffset:a.length,vertexLength:this.segments.segments[u].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let A=S;A<I;A++){const O=o[A],B=this.polygonSegments[O.polygonSegmentIdx],V=this.centroidData[O.centroidIdx].min,q=this.centroidData[O.centroidIdx].max,G=this.indexArray.uint16;for(let H=B.triangleArrayOffset;H<B.triangleArrayOffset+B.triangleCount;H++)a.emplaceBack(G[3*H],G[3*H+1],G[3*H+2]);T.primitiveLength+=B.triangleCount,D.x=Math.min(D.x,V.x),D.y=Math.min(D.y,V.y),k.x=Math.max(k.x,q.x),k.y=Math.max(k.y,q.y)}T.primitiveLength>0&&this.triangleSubSegments.push({segment:T,min:D,max:k}),S=I;for(let A=S;A<p&&o[A].subtile===o[S].subtile;A++)I++}g=p;for(let b=g;b<y&&o[b].triangleSegmentIdx===o[g].triangleSegmentIdx;b++)p++}a._trim(),this.indexArray=a}getVisibleSegments(o,a,u){const g=new hr;if(this.wallMode){for(const O of this.triangleSubSegments)g.segments.push(O.segment);return g}let p=0,y=0;const C=1<<o.canonical.z;if(a){const O=a.getMinMaxForTile(o);O&&(p=O.min,y=O.max)}y+=this.maxHeight;const S=o.toUnwrapped();let I;const b=[S.canonical.x/C+S.wrap,S.canonical.y/C],D=[(S.canonical.x+1)/C+S.wrap,(S.canonical.y+1)/C],k=(O,B,V)=>[O[0]*(1-V[0])+B[0]*V[0],O[1]*(1-V[1])+B[1]*V[1]],T=[],A=[];for(const O of this.triangleSubSegments){T[0]=O.min.x/kt,T[1]=O.min.y/kt,A[0]=O.max.x/kt,A[1]=O.max.y/kt;const B=k(b,D,T),V=k(b,D,A);if(0===new tn([B[0],B[1],p],[V[0],V[1],y]).intersectsPrecise(u)){I&&(g.segments.push(I),I=void 0);continue}const q=O.segment;I&&I.vertexOffset!==q.vertexOffset&&(g.segments.push(I),I=void 0),I?(I.vertexLength+=q.vertexLength,I.primitiveLength+=q.primitiveLength):I={vertexOffset:q.vertexOffset,primitiveLength:q.primitiveLength,vertexLength:q.vertexLength,primitiveOffset:q.primitiveOffset,sortKey:void 0,vaos:{}}}return I&&g.segments.push(I),g}encodeCentroid(o,a){const u=o.centroid(),g=a.span(),p=Math.min(7,Math.round(g.x*this.tileToMeter/10)),y=Math.min(7,Math.round(g.y*this.tileToMeter/10));return new Ot(Qn(u.x,1,8191)<<3|p,Qn(u.y,1,8191)<<3|y)}encodeBorderCentroid(o){if(!o.borders)return new Ot(0,0);const a=o.borders,u=Number.MAX_VALUE;if(a[0][0]!==u||a[1][0]!==u){const g=a[0][0]!==u?0:1;return new Ot(6|(a[0][0]!==u?0:65528),(a[g][0]+a[g][1])/2<<3|6)}{const g=a[2][0]!==u?2:3;return new Ot((a[g][0]+a[g][1])/2<<3|6,6|(a[2][0]!==u?0:65528))}}showCentroid(o){const a=this.centroidData[o.centroidDataIndex];a.flags&=pp,a.centroidXY.x=0,a.centroidXY.y=0,this.writeCentroidToBuffer(a)}writeCentroidToBuffer(o){this.groundEffect.updateHiddenByLandmark(o);const a=o.vertexArrayOffset,u=o.vertexCount+o.vertexArrayOffset,g=o.flags&pp?Of:o.centroidXY,p=this.centroidVertexArray.geta_centroid_pos0(a);if(this.centroidVertexArray.geta_centroid_pos1(a)!==g.y||p!==g.x){for(let y=a;y<u;++y)this.centroidVertexArray.emplace(y,g.x,g.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const o of this.centroidData)this.writeCentroidToBuffer(o)}updateReplacement(o,a,u){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const g=a.getReplacementRegionsForTile(o.toUnwrapped());if(Hx(this.activeReplacements,g))return;if(this.activeReplacements=g,0===this.centroidVertexArray.length)this.createCentroidsBuffer();else for(const y of this.centroidData)y.flags&=2147483647;const p=[];for(const y of this.activeReplacements){if(y.order<u)continue;const C=Math.max(1,Math.pow(2,y.footprintTileId.canonical.z-o.canonical.z));for(const S of this.centroidData)if(!(S.flags&pp||y.min.x>S.max.x||S.min.x>y.max.x||y.min.y>S.max.y||S.min.y>y.max.y))for(let I=0;I<S.footprintSegLen;I++){const b=this.footprintSegments[S.footprintSegIdx+I];if(p.length=0,lb(this.footprintVertices,b.vertexOffset,b.vertexCount,y.footprintTileId.canonical,o.canonical,p),$o(y.footprint,p,this.footprintIndices.uint16,b.indexOffset,b.indexCount,-b.vertexOffset,-C)){S.flags|=pp;break}}}for(const y of this.centroidData)this.writeCentroidToBuffer(y);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(o,a,u){let g=!1;for(let p=0;p<u.footprintSegLen;p++){const y=this.footprintSegments[u.footprintSegIdx+p];let C=0;for(const S of y.ringIndices){for(let I=C,b=S+C-1;I<S+C;b=I++){const D=this.footprintVertices.int16[2*(I+y.vertexOffset)+0],k=this.footprintVertices.int16[2*(I+y.vertexOffset)+1],T=this.footprintVertices.int16[2*(b+y.vertexOffset)+1];k>a!=T>a&&o<(this.footprintVertices.int16[2*(b+y.vertexOffset)+0]-D)*(a-k)/(T-k)+D&&(g=!g)}C=S}}return g}getHeightAtTileCoord(o,a){let u=Number.NEGATIVE_INFINITY,g=!0;const p=4*(o+kt)*kt+(a+kt);if(this.partLookup.hasOwnProperty(p)){const y=this.partLookup[p];return y?{height:y.height,hidden:!!(y.flags&pp)}:void 0}for(const y of this.centroidData)o>y.max.x||y.min.x>o||a>y.max.y||y.min.y>a||this.footprintContainsPoint(o,a,y)&&y&&y.height>u&&(u=y.height,this.partLookup[p]=y,g=!!(y.flags&pp));if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:g};this.partLookup[p]=void 0}}function HE(d,o){const a=d.add(o)._unit();return d.x*a.x+d.y*a.y}function Yx(d,o,a,u){const g=o.sub(d)._perp()._unit(),p=a.sub(o)._perp()._unit();return Zx(d,o,a,HE(g,p),u)}function Zx(d,o,a,u,g){const p=Math.sqrt(1-u*u);return Math.min(d.dist(o)/3,o.dist(a)/3,g*p/u)}function ab(d,o,a){return d.x<a[0].x&&o.x<a[0].x||d.x>a[1].x&&o.x>a[1].x||d.y<a[0].y&&o.y<a[0].y||d.y>a[1].y&&o.y>a[1].y}function $E(d,o){return d.x<o[0].x||d.x>o[1].x||d.y<o[0].y||d.y>o[1].y}function vI(d,o,a){if(d.x<0||d.x>=kt||o.x<0||o.x>=kt||a.x<0||a.x>=kt)return!1;const u=a.sub(o),g=u.perp(),p=d.sub(o);return(u.x*p.x+u.y*p.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(p.x*p.x+p.y*p.y))>-.866&&g.x*p.x+g.y*p.y<0}function Xx(d,o,a){const u=o?2|d:-3&d;return a?1|u:-2&u}function GE(){const d=Math.PI/32,o=Math.tan(d),a=Sc;return a*Math.sqrt(1+2*o*o)-a}function bI(d,o,a){const u=1<<a.z,g=xa(a.x/u),p=xa((a.x+1)/u),y=Uo(a.y/u),C=Uo((a.y+1)/u);return function(S,I,b,D,k=0,T){const A=[];if(!S.length||!b||!D)return A;const O=(ee,ie)=>{for(const me of ee)A.push({polygon:me,bounds:ie})},B=Math.ceil(Math.log2(b)),V=Math.ceil(Math.log2(D)),q=B-V,G=[];for(let ee=0;ee<Math.abs(q);ee++)G.push(q>0?0:1);for(let ee=0;ee<Math.min(B,V);ee++)G.push(0),G.push(1);let H=S;if(H=ib(H,I[0].y-k,I[1].y+k,1),H=ib(H,I[0].x-k,I[1].x+k,0),!H.length)return A;const Z=[];for(G.length?Z.push({polygons:H,bounds:I,depth:0}):O(H,I);Z.length;){const ee=Z.pop(),ie=ee.depth,me=G[ie],ue=ee.bounds[0],pe=ee.bounds[1],Te=0===me?ue.x:ue.y,_e=0===me?pe.x:pe.y,Ie=T?T(me,Te,_e):.5*(Te+_e),Le=ib(ee.polygons,Te-k,Ie+k,me),Fe=ib(ee.polygons,Ie-k,_e+k,me);if(Le.length){const Ve=[ue,new Ot(0===me?Ie:pe.x,1===me?Ie:pe.y)];G.length>ie+1?Z.push({polygons:Le,bounds:Ve,depth:ie+1}):O(Le,Ve)}if(Fe.length){const Ve=[new Ot(0===me?Ie:ue.x,1===me?Ie:ue.y),pe];G.length>ie+1?Z.push({polygons:Fe,bounds:Ve,depth:ie+1}):O(Fe,Ve)}}return A}(d,o,Math.ceil((p-g)/11.25),Math.ceil((y-C)/11.25),1,(S,I,b)=>{if(0===S)return.5*(I+b);{const D=Uo((a.y+I/kt)/u);return(As(.5*(Uo((a.y+b/kt)/u)+D))*u-a.y)*kt}})}function lb(d,o,a,u,g,p){const y=Math.pow(2,u.z-g.z);for(let C=0;C<a;C++){let S=d.int16[2*(C+o)+0],I=d.int16[2*(C+o)+1];S=(S+g.x*kt)*y-u.x*kt,I=(I+g.y*kt)*y-u.y*kt,p.push(new Ot(S,I))}}let cb,db;function hu(d,o){return d.x*o.x+d.y*o.y}function j_(d,o){if(1===d.length){let a=0;const u=o[a++];let g;for(;!g||u.equals(g);)if(g=o[a++],!g)return 1/0;for(;a<o.length;a++){const p=o[a],y=d[0],C=g.sub(u),S=p.sub(u),I=y.sub(u),b=hu(C,C),D=hu(C,S),k=hu(S,S),T=hu(I,C),A=hu(I,S),O=b*k-D*D,B=(k*T-D*A)/O,V=(b*A-D*T)/O,q=u.z*(1-B-V)+g.z*B+p.z*V;if(isFinite(q))return q}return 1/0}{let a=1/0;for(const u of o)a=Math.min(a,u.z);return a}}function H_(d,o,a,u,g,p,y,C){const S=y*g.getElevationAt(d,o,!0,!0),I=0!==p[0],b=I?0===p[1]?y*(p[0]/7-450):y*function(D,k,T){const A=Math.floor(k[0]/8),O=Math.floor(k[1]/8),B=10*(k[0]-8*A),V=10*(k[1]-8*O),q=D.getElevationAt(A,O,!0,!0),G=D.getMeterToDEM(T),H=Math.floor(.5*(B*G-1)),Z=Math.floor(.5*(V*G-1)),ee=D.tileCoordToPixel(A,O),ie=2*H+1,me=2*Z+1,ue=(We=ie,Ue=me,[(Fe=D).getElevationAtPixel(Ve=ee.x-H,ze=ee.y-Z,!0),Fe.getElevationAtPixel(Ve+Ue,ze,!0),Fe.getElevationAtPixel(Ve,ze+Ue,!0),Fe.getElevationAtPixel(Ve+We,ze+Ue,!0)]),pe=Math.abs(ue[0]-ue[1]),Te=Math.abs(ue[2]-ue[3]),_e=Math.abs(ue[0]-ue[2])+Math.abs(ue[1]-ue[3]),Ie=Math.min(.25,.5*G*(pe+Te)/ie),Le=Math.min(.25,.5*G*_e/me);var Fe,Ve,ze,We,Ue;return q+Math.max(Ie*B,Le*V)}(g,p,C):S;return{base:S+(0===a?-1:a),top:I?Math.max(b+u,S+a+2):S+u}}Zt(sb,"FillExtrusionBucket",{omit:["layers","features"]}),Zt(qx,"PartData"),Zt(U_,"FootprintSegment"),Zt(Wx,"BorderCentroidData"),Zt(ks,"GroundEffect");const ig=ki([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),Kx=ki([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:Qx}=ig,qE=ki([{name:"a_packed",components:3,type:"Float32"}]),{members:WE}=qE,Jx=ki([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:xI}=Jx;class YE{constructor(o,a){this.width=o,this.height=a,this.nextRow=0,this.image=new ah({width:o,height:a}),this.positions={},this.uploaded=!1}getDash(o,a){const u=this.getKey(o,a);return this.positions[u]}trim(){const o=this.width,a=this.height=Nh(this.nextRow);this.image.resize({width:o,height:a})}getKey(o,a){return o.join(",")+a}getDashRanges(o,a,u){const g=[];let p=o.length%2==1?-o[o.length-1]*u:0,y=o[0]*u,C=!0;g.push({left:p,right:y,isDash:C,zeroLength:0===o[0]});let S=o[0];for(let I=1;I<o.length;I++){C=!C;const b=o[I];p=S*u,S+=b,y=S*u,g.push({left:p,right:y,isDash:C,zeroLength:0===b})}return g}addRoundDash(o,a,u){const g=a/2;for(let p=-u;p<=u;p++){const y=this.width*(this.nextRow+u+p);let C=0,S=o[C];for(let I=0;I<this.width;I++){I/S.right>1&&(S=o[++C]);const b=Math.abs(I-S.left),D=Math.abs(I-S.right),k=Math.min(b,D);let T;const A=p/u*(g+1);if(S.isDash){const O=g-Math.abs(A);T=Math.sqrt(k*k+O*O)}else T=g-Math.sqrt(k*k+A*A);this.image.data[y+I]=Math.max(0,Math.min(255,T+128))}}}addRegularDash(o,a){for(let S=o.length-1;S>=0;--S){const I=o[S],b=o[S+1];I.zeroLength?o.splice(S,1):b&&b.isDash===I.isDash&&(b.left=I.left,o.splice(S,1))}const u=o[0],g=o[o.length-1];u.isDash===g.isDash&&(u.left=g.left-this.width,g.right=u.right+this.width);const p=this.width*this.nextRow;let y=0,C=o[y];for(let S=0;S<this.width;S++){S/C.right>1&&(C=o[++y]);const I=Math.abs(S-C.left),b=Math.abs(S-C.right),D=Math.min(I,b);this.image.data[p+S]=Math.max(0,Math.min(255,(C.isDash?D:-D)+a+128))}}addDash(o,a){const u=this.getKey(o,a);if(this.positions[u])return this.positions[u];const g="round"===a,p=g?7:0,y=2*p+1;if(this.nextRow+y>this.height)return Ir("LineAtlas out of space"),null;0===o.length&&o.push(1);let C=0;for(let b=0;b<o.length;b++)o[b]<0&&(Ir("Negative value is found in line dasharray, replacing values with 0"),o[b]=0),C+=o[b];if(0!==C){const b=this.width/C,D=this.getDashRanges(o,this.width,b);g?this.addRoundDash(D,b,p):this.addRegularDash(D,"square"===a?.5*b:0)}const S=this.nextRow+p;this.nextRow+=y;const I={tl:[S,p],br:[C,0]};return this.positions[u]=I,I}}Zt(YE,"LineAtlas");const rg=dp.VectorTileFeature.types,$_=Math.cos(Math.PI/180*37.5),ZE=Math.cos(Math.PI/180*5);class ew{constructor(o){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.zoom=o.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=o.overscaling,this.pixelRatio=o.pixelRatio,this.layers=o.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=o.index,this.projection=o.projection,this.hasPattern=!1,this.hasZOffset=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(a=>{this.gradients[a.id]={}}),this.layoutVertexArray=new xt,this.layoutVertexArray2=new Wn,this.patternVertexArray=new Wn,this.indexArray=new Vo,this.programConfigurations=new pd(o.layers,{zoom:o.zoom,lut:o.lut}),this.segments=new hr,this.maxLineLength=0,this.zOffsetVertexArray=new Wn,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.tessellationStep=o.tessellationStep?o.tessellationStep:128}updateFootprints(o,a){}populate(o,a,u,g){this.hasPattern=Ic("line",this.layers,this.pixelRatio,a);const p=this.layers[0].layout.get("line-sort-key");this.tileToMeter=m(u);const y=this.layers[0].layout.get("line-z-offset"),C=y.isConstant()&&!y.constantOr(0),S=this.layers[0].layout.get("line-elevation-reference");this.hasZOffset="sea"===S||"ground"===S||!C&&"none"===S,this.hasZOffset&&"none"===S&&Ir(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`);const I=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.hasZOffset&&void 0!==I;const b=[];for(const{feature:A,id:O,index:B,sourceLayerIndex:V}of o){const q=this.layers[0]._featureFilter.needGeometry,G=z(A,q);if(!this.layers[0]._featureFilter.filter(new sr(this.zoom),G,u))continue;const H=p?p.evaluate(G,{},u):void 0,Z={id:O,properties:A.properties,type:A.type,sourceLayerIndex:V,index:B,geometry:q?G.geometry:N(A,u,g),patterns:{},sortKey:H};b.push(Z)}p&&b.sort((A,O)=>A.sortKey-O.sortKey);const{lineAtlas:D,featureIndex:k}=a,T=this.addConstantDashes(D);for(const A of b){const{geometry:O,index:B,sourceLayerIndex:V}=A;if(T&&this.addFeatureDashes(A,D),this.hasPattern){const q=gd("line",this.layers,A,this.zoom,this.pixelRatio,a);this.patternFeatures.push(q)}else this.addFeature(A,O,B,u,D.positions,a.availableImages,a.brightness);k.insert(o[B].feature,O,B,V,this.index)}}addConstantDashes(o){let a=!1;for(const u of this.layers){const g=u.paint.get("line-dasharray").value,p=u.layout.get("line-cap").value;if("constant"!==g.kind||"constant"!==p.kind)a=!0;else{const y=p.value,C=g.value;if(!C)continue;o.addDash(C,y)}}return a}addFeatureDashes(o,a){const u=this.zoom;for(const g of this.layers){const p=g.paint.get("line-dasharray").value,y=g.layout.get("line-cap").value;if("constant"===p.kind&&"constant"===y.kind)continue;let C,S;if("constant"===p.kind){if(C=p.value,!C)continue}else C=p.evaluate({zoom:u},o);S="constant"===y.kind?y.value:y.evaluate({zoom:u},o),a.addDash(C,S),o.patterns[g.id]=a.getKey(C,S)}}update(o,a,u,g,p,y,C){this.programConfigurations.updatePaintArrays(o,a,p,u,g,y,C)}addFeatures(o,a,u,g,p,y){for(const C of this.patternFeatures)this.addFeature(C,C.geometry,C.index,a,u,g,y)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=o.createVertexBuffer(this.layoutVertexArray2,WE)),0!==this.patternVertexArray.length&&(this.patternVertexBuffer=o.createVertexBuffer(this.patternVertexArray,xI)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=o.createVertexBuffer(this.zOffsetVertexArray,Kx.members,!0)),this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Qx),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(o){if(o.properties&&o.properties.hasOwnProperty("mapbox_clip_start")&&o.properties.hasOwnProperty("mapbox_clip_end"))return{start:+o.properties.mapbox_clip_start,end:+o.properties.mapbox_clip_end}}addFeature(o,a,u,g,p,y,C){const S=this.layers[0].layout,I=S.get("line-join").evaluate(o,{}),b=S.get("line-cap").evaluate(o,{}),D=S.get("line-miter-limit"),k=S.get("line-round-limit");this.lineClips=this.lineFeatureClips(o),this.lineFeature=o,this.zOffsetValue=S.get("line-z-offset").value;const T=this.layers[0].paint.get("line-width").value;"constant"!==T.kind&&!1===T.isLineProgressConstant&&(this.variableWidthValue=T);for(const A of a)this.addLine(A,o,g,I,b,D,k);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,u,p,y,g,C)}addLine(o,a,u,g,p,y,C){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const S="none"===g;if(this.patternJoinNone=this.hasPattern&&S,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let G=0;G<o.length-1;G++)this.totalDistance+=o[G].dist(o[G+1]);this.totalFeatureLength=this.totalDistance/(this.lineClips.end-this.lineClips.start),this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const I="Polygon"===rg[a.type];let b=o.length;for(;b>=2&&o[b-1].equals(o[b-2]);)b--;let D=0;for(;D<b-1&&o[D].equals(o[D+1]);)D++;if(b<(I?3:2))return;"bevel"===g&&(y=1.05);const k=this.segments.prepareSegment(10*b,this.layoutVertexArray,this.indexArray);let T,A,O,B,V,q;this.e1=this.e2=-1,I&&(T=o[b-2],V=o[D].sub(T)._unit()._perp());for(let G=D;G<b;G++){if(O=G===b-1?I?o[D+1]:void 0:o[G+1],O&&o[G].equals(O))continue;V&&(B=V),T&&(A=T),T=o[G],q=this.evaluateLineProgressFeatures(A?A.dist(T):0),V=O?O.sub(T)._unit()._perp():B,B=B||V;const H=A&&O;let Z=H?g:I||S?"butt":p;const ee=B.x*V.x+B.y*V.y;if(S){const Le=function(Fe){if(Fe.patternJoinNone){const Ve=Fe.segmentPoints.length/2,ze=Fe.lineSoFar-Fe.segmentStart;for(let We=0;We<Ve;++We){const Ue=Fe.segmentPoints[2*We+1],Ze=Math.round(Fe.segmentPoints[2*We])+.5+.25*Ue;Fe.patternVertexArray.emplaceBack(Ze,ze,Fe.segmentStart),Fe.patternVertexArray.emplaceBack(Ze,ze,Fe.segmentStart)}Fe.segmentPoints.length=0}Fe.e1=Fe.e2=-1};if(H&&ee<ZE){this.updateDistance(A,T),this.addCurrentVertex(T,B,1,1,k,q),Le(this),this.addCurrentVertex(T,V,-1,-1,k,q);continue}if(A){if(!O){this.updateDistance(A,T),this.addCurrentVertex(T,B,1,1,k,q),Le(this);continue}Z="miter"}}let ie=B.add(V);0===ie.x&&0===ie.y||ie._unit();const me=ie.x*V.x+ie.y*V.y,ue=0!==me?1/me:1/0,pe=2*Math.sqrt(2-2*me),Te=me<$_&&A&&O,_e=B.x*V.y-B.y*V.x>0,Ie=this.overscaling<=16?15*kt/(512*this.overscaling):0;if(H&&"round"===Z)if(ue<C)Z="miter";else if(ue<=2){const Le=ub(T,-10,8202);Z=this.hasZOffset&&(Le||this.hasCrossSlope)?"miter":"fakeround"}if("miter"===Z&&ue>y&&(Z="bevel"),"bevel"===Z&&(ue>2&&(Z="flipbevel"),ue<y&&(Z="miter")),A&&!("miter"===Z&&Te)&&this.updateDistance(A,T),"miter"===Z)if(Te){const Le=T.dist(A);if(Le>2*Ie){const Ve=T.sub(T.sub(A)._mult(Ie/Le)._round());this.updateDistance(A,Ve),this.addCurrentVertex(Ve,B,0,0,k,q),A=Ve}this.updateDistance(A,T),ie._mult(ue),this.addCurrentVertex(T,ie,0,0,k,q);const Fe=T.dist(O);if(Fe>2*Ie){const Ve=T.add(O.sub(T)._mult(Ie/Fe)._round());this.updateDistance(T,Ve),this.addCurrentVertex(Ve,V,0,0,k,q),T=Ve}}else ie._mult(ue),this.addCurrentVertex(T,ie,0,0,k,q);else if("flipbevel"===Z){if(ue>100)ie=V.mult(-1);else{const Le=ue*B.add(V).mag()/B.sub(V).mag();ie._perp()._mult(Le*(_e?-1:1))}this.addCurrentVertex(T,ie,0,0,k,q),this.addCurrentVertex(T,ie.mult(-1),0,0,k,q)}else if("bevel"===Z||"fakeround"===Z){null!=q&&A&&this.addCurrentVertex(T,B,-1,-1,k,q);const Le=T.dist(A)<=2*Ie&&"bevel"!==Z,Fe=ie.mult(_e?1:-1);Fe._mult(ue);const Ve=V.mult(_e?-1:1),ze=B.mult(_e?-1:1),We=this.evaluateLineProgressFeatures(this.distance);if(null==q&&(this.addHalfVertex(T,Fe.x,Fe.y,!1,!_e,0,k,We),Le||this.addHalfVertex(T,Fe.x+2*ze.x,Fe.y+2*ze.y,!1,_e,0,k,We)),"fakeround"===Z){const Ue=Math.round(180*pe/Math.PI/20);this.addHalfVertex(T,ze.x,ze.y,!1,_e,0,k,We);for(let Ze=0;Ze<Ue;Ze++){let ht=Ze/Ue;if(.5!==ht){const qt=ht-.5;ht+=ht*qt*(ht-1)*((1.0904+ee*(ee*(3.55645-1.43519*ee)-3.2452))*qt*qt+(.848013+ee*(.215638*ee-1.06021)))}const ut=Ve.sub(ze)._mult(ht)._add(ze)._unit();this.addHalfVertex(T,ut.x,ut.y,!1,_e,0,k,We)}this.addHalfVertex(T,Ve.x,Ve.y,!1,_e,0,k,We)}Le||null!=q||this.addHalfVertex(T,Fe.x+2*Ve.x,Fe.y+2*Ve.y,!1,_e,0,k,We),null!=q&&O&&this.addCurrentVertex(T,V,1,1,k,q)}else"butt"===Z?this.addCurrentVertex(T,ie,0,0,k,q):"square"===Z?(A||this.addCurrentVertex(T,ie,-1,-1,k,q),this.addCurrentVertex(T,ie,0,0,k,q),A&&this.addCurrentVertex(T,ie,1,1,k,q)):"round"===Z&&(A&&(this.addCurrentVertex(T,B,0,0,k,q),this.addCurrentVertex(T,B,1,1,k,q,!0)),O&&(this.addCurrentVertex(T,V,-1,-1,k,q,!0),this.addCurrentVertex(T,V,0,0,k,q)))}}addVerticesTo(o,a,u,g,p,y,C,S,I,b){const D=(a.w-o.w)/this.tessellationStep|0;let k=0;const T=this.scaledDistance;if(D>1){this.lineSoFar=o.w;const O=(a.x-o.x)/D,B=(a.y-o.y)/D,V=(a.z-o.z)/D,q=(a.w-o.w)/D;for(let G=1;G<D;++G){o.x+=O,o.y+=B,o.z+=V,this.lineSoFar+=q,k+=q;const H=this.evaluateLineProgressFeatures(this.prevDistance+k);this.scaledDistance=(this.prevDistance+k)/this.totalDistance,this.addHalfVertex(o,u,g,b,!1,C,I,H),this.addHalfVertex(o,p,y,b,!0,-S,I,H)}}this.lineSoFar=a.w,this.scaledDistance=T;const A=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(a,u,g,b,!1,C,I,A),this.addHalfVertex(a,p,y,b,!0,-S,I,A)}evaluateLineProgressFeatures(o){if(!this.variableWidthValue&&!this.hasZOffset)return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+o)/this.totalFeatureLength):Ir(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let a=0;return this.variableWidthValue&&"constant"!==this.variableWidthValue.kind&&(a=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.hasZOffset?"constant"===this.zOffsetValue.kind?{zOffset:this.zOffsetValue.value,variableWidth:a}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:a}:{zOffset:0,variableWidth:a}}addCurrentVertex(o,a,u,g,p,y,C=!1){const S=a.x+a.y*u,I=a.y-a.x*u,b=a.y*g-a.x,D=-a.y-a.x*g;if(null!=y){const k=this.hasZOffset,T=-10,A=8202,O=y.zOffset,B=new O_(o.x,o.y,O,this.lineSoFar),V=!!k&&ub(o,T,A),q=this.lineSoFar,G=this.distance;if(this.currentVertex)if(V){const H=this.currentVertexIsOutside,Z=this.currentVertex,ee=new O_(o.x,o.y,O,this.lineSoFar);if(rb(Z,ee,T,A),!ub(ee,T,A)){if(H){this.e1=this.e2=-1,this.distance-=Z.dist(B),this.lineSoFar=Z.w;const ie=this.evaluateLineProgressFeatures(Z.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Z,S,I,C,!1,u,p,ie),this.addHalfVertex(Z,b,D,C,!0,-g,p,ie),this.prevDistance=this.distance}this.distance=this.prevDistance+Z.dist(ee),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(Z,ee,S,I,b,D,u,g,p,C),this.distance=G,this.scaledDistance=this.distance/this.totalDistance}}else{const H=this.currentVertex;if(this.currentVertexIsOutside){rb(H,B,T,A),this.e1=this.e2=-1,this.distance-=H.dist(B),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=H.w;const Z=this.evaluateLineProgressFeatures(H.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(H,S,I,C,!1,u,p,Z),this.addHalfVertex(H,b,D,C,!0,-g,p,Z),this.prevDistance=this.distance,this.distance=G,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(H,B,S,I,b,D,u,g,p,C)}else V||(this.addHalfVertex(o,S,I,C,!1,u,p,y),this.addHalfVertex(o,b,D,C,!0,-g,p,y));this.currentVertex=B,this.currentVertexIsOutside=V,this.lineSoFar=q}else this.addHalfVertex(o,S,I,C,!1,u,p,y),this.addHalfVertex(o,b,D,C,!0,-g,p,y)}addHalfVertex({x:o,y:a},u,g,p,y,C,S,I){if(this.patternJoinNone&&(0===this.segmentPoints.length&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),y||this.segmentPoints.push(this.lineSoFar-this.segmentStart,C)),this.layoutVertexArray.emplaceBack((o<<1)+(p?1:0),(a<<1)+(y?1:0),Math.round(63*u)+128,Math.round(63*g)+128,1+(0===C?0:C<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const D=_n(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,D)}const b=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,b),S.primitiveLength++),y?this.e2=b:this.e1=b,null!=I&&this.zOffsetVertexArray.emplaceBack(I.zOffset,I.variableWidth,I.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(o,a){this.prevDistance=this.distance,this.distance+=o.dist(a),this.updateScaledDistance()}}function ub(d,o,a){return d.x<o||d.x>a||d.y<o||d.y>a}let wI,tw;function XE(d,o,a){return o*(kt/(d.tileSize*Math.pow(2,a-d.tileID.overscaledZ)))}Zt(ew,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const nw=(d,o,a)=>(1-a)*d+a*o;function pu(d,o){return 1/XE(d,1,o.tileZoom)}function KE(d,o,a,u){return d.translatePosMatrix(u||o.tileID.projMatrix,o,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const CI=d=>{const o=[];hb(d)&&o.push("RENDER_LINE_DASH"),d.paint.get("line-gradient")&&o.push("RENDER_LINE_GRADIENT");const a=d.paint.get("line-trim-offset");0===a[0]&&0===a[1]||o.push("RENDER_LINE_TRIM_OFFSET"),0!==d.paint.get("line-border-width").constantOr(1)&&o.push("RENDER_LINE_BORDER");const u="none"===d.layout.get("line-join").constantOr("miter"),g=!!d.paint.get("line-pattern").constantOr(1);return u&&g&&o.push("LINE_JOIN_NONE"),o};function hb(d){const o=d.paint.get("line-dasharray").value;return o.value||"constant"!==o.kind}let QE;const G_=()=>QE||(QE={layout:wI||(wI=new Br({"line-cap":new Vt(Ye.layout_line["line-cap"]),"line-join":new Vt(Ye.layout_line["line-join"]),"line-miter-limit":new Mt(Ye.layout_line["line-miter-limit"]),"line-round-limit":new Mt(Ye.layout_line["line-round-limit"]),"line-sort-key":new Vt(Ye.layout_line["line-sort-key"]),"line-z-offset":new Vt(Ye.layout_line["line-z-offset"]),"line-elevation-reference":new Mt(Ye.layout_line["line-elevation-reference"]),"line-cross-slope":new Mt(Ye.layout_line["line-cross-slope"]),visibility:new Mt(Ye.layout_line.visibility),"line-width-unit":new Mt(Ye.layout_line["line-width-unit"])})),paint:tw||(tw=new Br({"line-opacity":new Vt(Ye.paint_line["line-opacity"]),"line-color":new Vt(Ye.paint_line["line-color"]),"line-translate":new Mt(Ye.paint_line["line-translate"]),"line-translate-anchor":new Mt(Ye.paint_line["line-translate-anchor"]),"line-width":new Vt(Ye.paint_line["line-width"]),"line-gap-width":new Vt(Ye.paint_line["line-gap-width"]),"line-offset":new Vt(Ye.paint_line["line-offset"]),"line-blur":new Vt(Ye.paint_line["line-blur"]),"line-dasharray":new Vt(Ye.paint_line["line-dasharray"]),"line-pattern":new Vt(Ye.paint_line["line-pattern"]),"line-gradient":new Bo(Ye.paint_line["line-gradient"]),"line-trim-offset":new Mt(Ye.paint_line["line-trim-offset"]),"line-trim-fade-range":new Mt(Ye.paint_line["line-trim-fade-range"]),"line-trim-color":new Mt(Ye.paint_line["line-trim-color"]),"line-emissive-strength":new Mt(Ye.paint_line["line-emissive-strength"]),"line-border-width":new Vt(Ye.paint_line["line-border-width"]),"line-border-color":new Vt(Ye.paint_line["line-border-color"]),"line-occlusion-opacity":new Mt(Ye.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"})}))},QE);class q_ extends Vt{possiblyEvaluate(o,a){return a=new sr(Math.floor(a.zoom),{now:a.now,fadeDuration:a.fadeDuration,transition:a.transition}),super.possiblyEvaluate(o,a)}evaluate(o,a,u,g){return a=ls({},a,{zoom:Math.floor(a.zoom)}),super.evaluate(o,a,u,g)}}let W_;function iw(d,o){return o>0?o+2*d:d}const EI=ki([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),SI=ki([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),JE=ki([{name:"a_projected_pos",components:4,type:"Float32"}],4);ki([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const eS=ki([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),DI=ki([{name:"a_texb",components:2,type:"Uint16"}]),MI=ki([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),Y_=ki([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);ki([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const rw=ki([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),ow=ki([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ki([{name:"triangle",components:3,type:"Uint16"}]),ki([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ki([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),ki([{type:"Float32",name:"offsetX"}]),ki([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);const fu=128;function TI(d,o,a,u,g){if("camera"===d.kind)return d.maxSize;if("composite"===d.kind){const p=o.possiblyEvaluate(new sr(d.maxZoom),a).evaluate(g,{},a),y=o.possiblyEvaluate(new sr(d.minZoom),a).evaluate(g,{},a);return Math.max(p,y)}return o.possiblyEvaluate(new sr(u)).evaluate(g,{},a)}function tS(d,o){const{expression:a}=o;if("constant"===a.kind)return{kind:"constant",layoutSize:a.evaluate(new sr(d+1))};if("source"===a.kind)return{kind:"source"};{const{zoomStops:u,interpolationType:g}=a;let p=0;for(;p<u.length&&u[p]<=d;)p++;p=Math.max(0,p-1);let y=p;for(;y<u.length&&u[y]<d+1;)y++;y=Math.min(u.length-1,y);const C=u[p],S=u[y];return"composite"===a.kind?{kind:"composite",minZoom:C,maxZoom:S,interpolationType:g}:{kind:"camera",minZoom:C,maxZoom:S,minSize:a.evaluate(new sr(C)),maxSize:a.evaluate(new sr(S)),interpolationType:g}}}function fp(d,{uSize:o,uSizeT:a},{lowerSize:u,upperSize:g}){return"source"===d.kind?u/fu:"composite"===d.kind?_n(u/fu,g/fu,a):o}function og(d,o,a=1){let u=0,g=0;if("constant"===d.kind)g=d.layoutSize*a;else if("source"!==d.kind){const{interpolationType:p,minZoom:y,maxZoom:C}=d,S=p?Qn(us.interpolationFactor(p,o,y,C),0,1):0;"camera"===d.kind?g=_n(d.minSize,d.maxSize,S)*a:u=S*a}return{uSizeT:u,uSize:g}}var pb=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:fu,evaluateSizeForFeature:fp,evaluateSizeForZoom:og,getRasterizedIconSize:TI,getSizeData:tS});function sw(d,o,a){return d.sections.forEach(u=>{u.text=function(g,p,y){const C=p.layout.get("text-transform").evaluate(y,{});return"uppercase"===C?g=g.toLocaleUpperCase():"lowercase"===C&&(g=g.toLocaleLowerCase()),ml.applyArabicShaping&&(g=ml.applyArabicShaping(g)),g}(u.text,o,a)}),d}const uh={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function dO(d){return"\ufe36"===d||"\ufe48"===d||"\ufe38"===d||"\ufe44"===d||"\ufe42"===d||"\ufe3e"===d||"\ufe3c"===d||"\ufe3a"===d||"\ufe18"===d||"\ufe40"===d||"\ufe10"===d||"\ufe13"===d||"\ufe14"===d||"\uff40"===d||"\uffe3"===d||"\ufe11"===d||"\ufe12"===d}function uO(d){return"\ufe35"===d||"\ufe47"===d||"\ufe37"===d||"\ufe43"===d||"\ufe41"===d||"\ufe3d"===d||"\ufe3b"===d||"\ufe39"===d||"\ufe17"===d||"\ufe3f"===d}var aw,lw,cw,Z_={};function mp(){if(cw)return lw;cw=1,lw=o;var d=function nS(){return aw||(aw=1,Z_.read=function(d,o,a,u,g){var p,y,C=8*g-u-1,S=(1<<C)-1,I=S>>1,b=-7,D=a?g-1:0,k=a?-1:1,T=d[o+D];for(D+=k,p=T&(1<<-b)-1,T>>=-b,b+=C;b>0;p=256*p+d[o+D],D+=k,b-=8);for(y=p&(1<<-b)-1,p>>=-b,b+=u;b>0;y=256*y+d[o+D],D+=k,b-=8);if(0===p)p=1-I;else{if(p===S)return y?NaN:1/0*(T?-1:1);y+=Math.pow(2,u),p-=I}return(T?-1:1)*y*Math.pow(2,p-u)},Z_.write=function(d,o,a,u,g,p){var y,C,S,I=8*p-g-1,b=(1<<I)-1,D=b>>1,k=23===g?Math.pow(2,-24)-Math.pow(2,-77):0,T=u?0:p-1,A=u?1:-1,O=o<0||0===o&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(C=isNaN(o)?1:0,y=b):(y=Math.floor(Math.log(o)/Math.LN2),o*(S=Math.pow(2,-y))<1&&(y--,S*=2),(o+=y+D>=1?k/S:k*Math.pow(2,1-D))*S>=2&&(y++,S/=2),y+D>=b?(C=0,y=b):y+D>=1?(C=(o*S-1)*Math.pow(2,g),y+=D):(C=o*Math.pow(2,D-1)*Math.pow(2,g),y=0));g>=8;d[a+T]=255&C,T+=A,C/=256,g-=8);for(y=y<<g|C,I+=g;I>0;d[a+T]=255&y,T+=A,y/=256,I-=8);d[a+T-A]|=128*O}),Z_}();function o(H){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(H)?H:new Uint8Array(H||0),this.pos=0,this.type=0,this.length=this.buf.length}o.Varint=0,o.Fixed64=1,o.Bytes=2,o.Fixed32=5;var a=4294967296,u=1/a,g=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function p(H){return H.type===o.Bytes?H.readVarint()+H.pos:H.pos+1}function C(H,Z,ee){var ie=Z<=16383?1:Z<=2097151?2:Z<=268435455?3:Math.floor(Math.log(Z)/(7*Math.LN2));ee.realloc(ie);for(var me=ee.pos-1;me>=H;me--)ee.buf[me+ie]=ee.buf[me]}function S(H,Z){for(var ee=0;ee<H.length;ee++)Z.writeVarint(H[ee])}function I(H,Z){for(var ee=0;ee<H.length;ee++)Z.writeSVarint(H[ee])}function b(H,Z){for(var ee=0;ee<H.length;ee++)Z.writeFloat(H[ee])}function D(H,Z){for(var ee=0;ee<H.length;ee++)Z.writeDouble(H[ee])}function k(H,Z){for(var ee=0;ee<H.length;ee++)Z.writeBoolean(H[ee])}function T(H,Z){for(var ee=0;ee<H.length;ee++)Z.writeFixed32(H[ee])}function A(H,Z){for(var ee=0;ee<H.length;ee++)Z.writeSFixed32(H[ee])}function O(H,Z){for(var ee=0;ee<H.length;ee++)Z.writeFixed64(H[ee])}function B(H,Z){for(var ee=0;ee<H.length;ee++)Z.writeSFixed64(H[ee])}function V(H,Z){return(H[Z]|H[Z+1]<<8|H[Z+2]<<16)+16777216*H[Z+3]}function q(H,Z,ee){H[ee]=Z,H[ee+1]=Z>>>8,H[ee+2]=Z>>>16,H[ee+3]=Z>>>24}function G(H,Z){return(H[Z]|H[Z+1]<<8|H[Z+2]<<16)+(H[Z+3]<<24)}return o.prototype={destroy:function(){this.buf=null},readFields:function(H,Z,ee){for(ee=ee||this.length;this.pos<ee;){var ie=this.readVarint(),me=ie>>3,ue=this.pos;this.type=7&ie,H(me,Z,this),this.pos===ue&&this.skip(ie)}return Z},readMessage:function(H,Z){return this.readFields(H,Z,this.readVarint()+this.pos)},readFixed32:function(){var H=V(this.buf,this.pos);return this.pos+=4,H},readSFixed32:function(){var H=G(this.buf,this.pos);return this.pos+=4,H},readFixed64:function(){var H=V(this.buf,this.pos)+V(this.buf,this.pos+4)*a;return this.pos+=8,H},readSFixed64:function(){var H=V(this.buf,this.pos)+G(this.buf,this.pos+4)*a;return this.pos+=8,H},readFloat:function(){var H=d.read(this.buf,this.pos,!0,23,4);return this.pos+=4,H},readDouble:function(){var H=d.read(this.buf,this.pos,!0,52,8);return this.pos+=8,H},readVarint:function(H){var Z,ee,ie=this.buf;return Z=127&(ee=ie[this.pos++]),ee<128?Z:(Z|=(127&(ee=ie[this.pos++]))<<7,ee<128?Z:(Z|=(127&(ee=ie[this.pos++]))<<14,ee<128?Z:(Z|=(127&(ee=ie[this.pos++]))<<21,ee<128?Z:function(me,ue,pe){var Te,_e,Ie=pe.buf;if(Te=(112&(_e=Ie[pe.pos++]))>>4,_e<128||(Te|=(127&(_e=Ie[pe.pos++]))<<3,_e<128)||(Te|=(127&(_e=Ie[pe.pos++]))<<10,_e<128)||(Te|=(127&(_e=Ie[pe.pos++]))<<17,_e<128)||(Te|=(127&(_e=Ie[pe.pos++]))<<24,_e<128)||(Te|=(1&(_e=Ie[pe.pos++]))<<31,_e<128))return function y(H,Z,ee){return ee?4294967296*Z+(H>>>0):4294967296*(Z>>>0)+(H>>>0)}(me,Te,ue);throw new Error("Expected varint not more than 10 bytes")}(Z|=(15&(ee=ie[this.pos]))<<28,H,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var H=this.readVarint();return H%2==1?(H+1)/-2:H/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var H=this.readVarint()+this.pos,Z=this.pos;return this.pos=H,H-Z>=12&&g?g.decode(this.buf.subarray(Z,H)):function(ee,ie,me){for(var ue="",pe=ie;pe<me;){var Te,_e,Ie,Le=ee[pe],Fe=null,Ve=Le>239?4:Le>223?3:Le>191?2:1;if(pe+Ve>me)break;1===Ve?Le<128&&(Fe=Le):2===Ve?128==(192&(Te=ee[pe+1]))&&(Fe=(31&Le)<<6|63&Te)<=127&&(Fe=null):3===Ve?(_e=ee[pe+2],128==(192&(Te=ee[pe+1]))&&128==(192&_e)&&((Fe=(15&Le)<<12|(63&Te)<<6|63&_e)<=2047||Fe>=55296&&Fe<=57343)&&(Fe=null)):4===Ve&&(_e=ee[pe+2],Ie=ee[pe+3],128==(192&(Te=ee[pe+1]))&&128==(192&_e)&&128==(192&Ie)&&((Fe=(15&Le)<<18|(63&Te)<<12|(63&_e)<<6|63&Ie)<=65535||Fe>=1114112)&&(Fe=null)),null===Fe?(Fe=65533,Ve=1):Fe>65535&&(Fe-=65536,ue+=String.fromCharCode(Fe>>>10&1023|55296),Fe=56320|1023&Fe),ue+=String.fromCharCode(Fe),pe+=Ve}return ue}(this.buf,Z,H)},readBytes:function(){var H=this.readVarint()+this.pos,Z=this.buf.subarray(this.pos,H);return this.pos=H,Z},readPackedVarint:function(H,Z){if(this.type!==o.Bytes)return H.push(this.readVarint(Z));var ee=p(this);for(H=H||[];this.pos<ee;)H.push(this.readVarint(Z));return H},readPackedSVarint:function(H){if(this.type!==o.Bytes)return H.push(this.readSVarint());var Z=p(this);for(H=H||[];this.pos<Z;)H.push(this.readSVarint());return H},readPackedBoolean:function(H){if(this.type!==o.Bytes)return H.push(this.readBoolean());var Z=p(this);for(H=H||[];this.pos<Z;)H.push(this.readBoolean());return H},readPackedFloat:function(H){if(this.type!==o.Bytes)return H.push(this.readFloat());var Z=p(this);for(H=H||[];this.pos<Z;)H.push(this.readFloat());return H},readPackedDouble:function(H){if(this.type!==o.Bytes)return H.push(this.readDouble());var Z=p(this);for(H=H||[];this.pos<Z;)H.push(this.readDouble());return H},readPackedFixed32:function(H){if(this.type!==o.Bytes)return H.push(this.readFixed32());var Z=p(this);for(H=H||[];this.pos<Z;)H.push(this.readFixed32());return H},readPackedSFixed32:function(H){if(this.type!==o.Bytes)return H.push(this.readSFixed32());var Z=p(this);for(H=H||[];this.pos<Z;)H.push(this.readSFixed32());return H},readPackedFixed64:function(H){if(this.type!==o.Bytes)return H.push(this.readFixed64());var Z=p(this);for(H=H||[];this.pos<Z;)H.push(this.readFixed64());return H},readPackedSFixed64:function(H){if(this.type!==o.Bytes)return H.push(this.readSFixed64());var Z=p(this);for(H=H||[];this.pos<Z;)H.push(this.readSFixed64());return H},skip:function(H){var Z=7&H;if(Z===o.Varint)for(;this.buf[this.pos++]>127;);else if(Z===o.Bytes)this.pos=this.readVarint()+this.pos;else if(Z===o.Fixed32)this.pos+=4;else{if(Z!==o.Fixed64)throw new Error("Unimplemented type: "+Z);this.pos+=8}},writeTag:function(H,Z){this.writeVarint(H<<3|Z)},realloc:function(H){for(var Z=this.length||16;Z<this.pos+H;)Z*=2;if(Z!==this.length){var ee=new Uint8Array(Z);ee.set(this.buf),this.buf=ee,this.length=Z}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(H){this.realloc(4),q(this.buf,H,this.pos),this.pos+=4},writeSFixed32:function(H){this.realloc(4),q(this.buf,H,this.pos),this.pos+=4},writeFixed64:function(H){this.realloc(8),q(this.buf,-1&H,this.pos),q(this.buf,Math.floor(H*u),this.pos+4),this.pos+=8},writeSFixed64:function(H){this.realloc(8),q(this.buf,-1&H,this.pos),q(this.buf,Math.floor(H*u),this.pos+4),this.pos+=8},writeVarint:function(H){(H=+H||0)>268435455||H<0?function(Z,ee){var ie,me,ue,Te;if(Z>=0?(ie=Z%4294967296|0,me=Z/4294967296|0):(me=~(-Z/4294967296),4294967295^(ie=~(-Z%4294967296))?ie=ie+1|0:(ie=0,me=me+1|0)),Z>=0x10000000000000000||Z<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");ee.realloc(10),ue=ie,(Te=ee).buf[Te.pos++]=127&ue|128,ue>>>=7,Te.buf[Te.pos++]=127&ue|128,ue>>>=7,Te.buf[Te.pos++]=127&ue|128,ue>>>=7,Te.buf[Te.pos++]=127&ue|128,Te.buf[Te.pos]=127&(ue>>>=7),function(ue,pe){var Te=(7&ue)<<4;pe.buf[pe.pos++]|=Te|((ue>>>=3)?128:0),ue&&(pe.buf[pe.pos++]=127&ue|((ue>>>=7)?128:0),ue&&(pe.buf[pe.pos++]=127&ue|((ue>>>=7)?128:0),ue&&(pe.buf[pe.pos++]=127&ue|((ue>>>=7)?128:0),ue&&(pe.buf[pe.pos++]=127&ue|((ue>>>=7)?128:0),ue&&(pe.buf[pe.pos++]=127&ue)))))}(me,ee)}(H,this):(this.realloc(4),this.buf[this.pos++]=127&H|(H>127?128:0),H<=127||(this.buf[this.pos++]=127&(H>>>=7)|(H>127?128:0),H<=127||(this.buf[this.pos++]=127&(H>>>=7)|(H>127?128:0),H<=127||(this.buf[this.pos++]=H>>>7&127))))},writeSVarint:function(H){this.writeVarint(H<0?2*-H-1:2*H)},writeBoolean:function(H){this.writeVarint(!!H)},writeString:function(H){H=String(H),this.realloc(4*H.length),this.pos++;var Z=this.pos;this.pos=function(ie,me,ue){for(var pe,Te,_e=0;_e<me.length;_e++){if((pe=me.charCodeAt(_e))>55295&&pe<57344){if(!Te){pe>56319||_e+1===me.length?(ie[ue++]=239,ie[ue++]=191,ie[ue++]=189):Te=pe;continue}if(pe<56320){ie[ue++]=239,ie[ue++]=191,ie[ue++]=189,Te=pe;continue}pe=Te-55296<<10|pe-56320|65536,Te=null}else Te&&(ie[ue++]=239,ie[ue++]=191,ie[ue++]=189,Te=null);pe<128?ie[ue++]=pe:(pe<2048?ie[ue++]=pe>>6|192:(pe<65536?ie[ue++]=pe>>12|224:(ie[ue++]=pe>>18|240,ie[ue++]=pe>>12&63|128),ie[ue++]=pe>>6&63|128),ie[ue++]=63&pe|128)}return ue}(this.buf,H,this.pos);var ee=this.pos-Z;ee>=128&&C(Z,ee,this),this.pos=Z-1,this.writeVarint(ee),this.pos+=ee},writeFloat:function(H){this.realloc(4),d.write(this.buf,H,this.pos,!0,23,4),this.pos+=4},writeDouble:function(H){this.realloc(8),d.write(this.buf,H,this.pos,!0,52,8),this.pos+=8},writeBytes:function(H){var Z=H.length;this.writeVarint(Z),this.realloc(Z);for(var ee=0;ee<Z;ee++)this.buf[this.pos++]=H[ee]},writeRawMessage:function(H,Z){this.pos++;var ee=this.pos;H(Z,this);var ie=this.pos-ee;ie>=128&&C(ee,ie,this),this.pos=ee-1,this.writeVarint(ie),this.pos+=ie},writeMessage:function(H,Z,ee){this.writeTag(H,o.Bytes),this.writeRawMessage(Z,ee)},writePackedVarint:function(H,Z){Z.length&&this.writeMessage(H,S,Z)},writePackedSVarint:function(H,Z){Z.length&&this.writeMessage(H,I,Z)},writePackedBoolean:function(H,Z){Z.length&&this.writeMessage(H,k,Z)},writePackedFloat:function(H,Z){Z.length&&this.writeMessage(H,b,Z)},writePackedDouble:function(H,Z){Z.length&&this.writeMessage(H,D,Z)},writePackedFixed32:function(H,Z){Z.length&&this.writeMessage(H,T,Z)},writePackedSFixed32:function(H,Z){Z.length&&this.writeMessage(H,A,Z)},writePackedFixed64:function(H,Z){Z.length&&this.writeMessage(H,O,Z)},writePackedSFixed64:function(H,Z){Z.length&&this.writeMessage(H,B,Z)},writeBytesField:function(H,Z){this.writeTag(H,o.Bytes),this.writeBytes(Z)},writeFixed32Field:function(H,Z){this.writeTag(H,o.Fixed32),this.writeFixed32(Z)},writeSFixed32Field:function(H,Z){this.writeTag(H,o.Fixed32),this.writeSFixed32(Z)},writeFixed64Field:function(H,Z){this.writeTag(H,o.Fixed64),this.writeFixed64(Z)},writeSFixed64Field:function(H,Z){this.writeTag(H,o.Fixed64),this.writeSFixed64(Z)},writeVarintField:function(H,Z){this.writeTag(H,o.Varint),this.writeVarint(Z)},writeSVarintField:function(H,Z){this.writeTag(H,o.Varint),this.writeSVarint(Z)},writeStringField:function(H,Z){this.writeTag(H,o.Bytes),this.writeString(Z)},writeFloatField:function(H,Z){this.writeTag(H,o.Fixed32),this.writeFloat(Z)},writeDoubleField:function(H,Z){this.writeTag(H,o.Fixed64),this.writeDouble(Z)},writeBooleanField:function(H,Z){this.writeVarintField(H,!!Z)}},lw}var X_=Jr(mp());function II(d,o,a){o.glyphs=[],1===d&&a.readMessage(AI,o)}function AI(d,o,a){if(3===d){const{id:u,bitmap:g,width:p,height:y,left:C,top:S,advance:I}=a.readMessage(kI,{});o.glyphs.push({id:u,bitmap:new ah({width:p+6,height:y+6},g),metrics:{width:p,height:y,left:C,top:S,advance:I}})}else 4===d?o.ascender=a.readSVarint():5===d&&(o.descender=a.readSVarint())}function kI(d,o,a){1===d?o.id=a.readVarint():2===d?o.bitmap=a.readBytes():3===d?o.width=a.readVarint():4===d?o.height=a.readVarint():5===d?o.left=a.readSVarint():6===d?o.top=a.readSVarint():7===d&&(o.advance=a.readVarint())}const Ka={horizontal:1,vertical:2,horizontalOnly:3};class K_{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(o,a){const u=new K_;return u.scale=o||1,u.fontStack=a,u}static forImage(o){const a=new K_;return a.image=o,a}}class sg{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(o,a,u){const g=new sg;for(let p=0;p<o.sections.length;p++){const y=o.sections[p];y.image?g.addImageSection(y,u):g.addTextSection(y,a)}return g}length(){return this.text.length}getSection(o){return this.sections[this.sectionIndex[o]]}getSections(){return this.sections}getSectionIndex(o){return this.sectionIndex[o]}getCodePoint(o){return this.text.codePointAt(o)}verticalizePunctuation(o){this.text=function(a,u){let g="";for(let p=0;p<a.length;p++){const y=a.charCodeAt(p+1)||null,C=a.charCodeAt(p-1)||null;g+=!u&&(y&&Av(y)&&!uh[a[p+1]]||C&&Av(C)&&!uh[a[p-1]])||!uh[a[p]]?a[p]:uh[a[p]]}return g}(this.text,o)}trim(){let o=0;for(let u=0;u<this.text.length&&fb[this.text.charCodeAt(u)];u++)o++;let a=this.text.length;for(let u=this.text.length-1;u>=0&&u>=o&&fb[this.text.charCodeAt(u)];u--)a--;this.text=this.text.substring(o,a),this.sectionIndex=this.sectionIndex.slice(o,a)}substring(o,a){const u=new sg;return u.text=this.text.substring(o,a),u.sectionIndex=this.sectionIndex.slice(o,a),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((o,a)=>Math.max(o,this.sections[a].scale),0)}addTextSection(o,a){this.text+=o.text,this.sections.push(K_.forText(o.scale,o.fontStack||a));const u=this.sections.length-1;for(let g=0;g<o.text.length;++g)this.sectionIndex.push(u)}addImageSection(o,a){const u=o.image?o.image.getPrimary():null;if(!u)return void Ir("Can't add FormattedSection with an empty image.");u.scaleSelf(a);const g=this.getNextImageSectionCharCode();g?(this.text+=String.fromCodePoint(g),this.sections.push(K_.forImage(u)),this.sectionIndex.push(this.sections.length-1)):Ir("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function hw(d,o,a,u,g,p,y,C,S,I,b,D,k,T,A,O=1){const B=sg.fromFeature(d,g,O);D===Ka.vertical&&B.verticalizePunctuation(k);let V=[];const q=function(ie,me,ue,pe,Te,_e){if(!ie)return[];const Ie=[],Le=function(We,Ue,Ze,ht,ut,qt){let gt=0;for(let yt=0;yt<We.length();yt++){const pt=We.getSection(yt);gt+=iS(We.getCodePoint(yt),pt,ht,ut,Ue,qt)}return gt/Math.max(1,Math.ceil(gt/Ze))}(ie,me,ue,pe,Te,_e),Fe=ie.text.indexOf("\u200b")>=0;let Ve=0;for(let We=0;We<ie.length();We++){const Ue=ie.getSection(We),Ze=ie.getCodePoint(We);if(fb[Ze]||(Ve+=iS(Ze,Ue,pe,Te,me,_e)),We<ie.length()-1){const ht=!((ze=Ze)<11904||!(hn_Bopomofo_Extended(ze)||hn_Bopomofo(ze)||hn_CJK_Compatibility_Forms(ze)||hn_CJK_Compatibility_Ideographs(ze)||hn_CJK_Compatibility(ze)||hn_CJK_Radicals_Supplement(ze)||hn_CJK_Strokes(ze)||hn_CJK_Symbols_and_Punctuation(ze)||hn_CJK_Unified_Ideographs_Extension_A(ze)||hn_CJK_Unified_Ideographs(ze)||hn_Enclosed_CJK_Letters_and_Months(ze)||hn_Halfwidth_and_Fullwidth_Forms(ze)||hn_Hiragana(ze)||hn_Ideographic_Description_Characters(ze)||hn_Kangxi_Radicals(ze)||hn_Katakana_Phonetic_Extensions(ze)||hn_Katakana(ze)||hn_Vertical_Forms(ze)||hn_Yi_Radicals(ze)||hn_Yi_Syllables(ze)));(pw[Ze]||ht||Ue.image)&&Ie.push(mw(We+1,Ve,Le,Ie,fw(Ze,ie.getCodePoint(We+1),ht&&Fe),!1))}}var ze;return oS(mw(ie.length(),Ve,Le,Ie,0,!0))}(B,I,p,o,u,T),{processBidirectionalText:G,processStyledBidirectionalText:H}=ml;if(G&&1===B.sections.length){const ie=G(B.toString(),q);for(const me of ie){const ue=new sg;ue.text=me,ue.sections=B.sections;for(let pe=0;pe<me.length;pe++)ue.sectionIndex.push(0);V.push(ue)}}else if(H){const ie=H(B.text,B.sectionIndex,q);for(const me of ie){const ue=new sg;ue.text=me[0],ue.sectionIndex=me[1],ue.sections=B.sections,V.push(ue)}}else V=function(ie,me){const ue=[],pe=ie.text;let Te=0;for(const _e of me)ue.push(ie.substring(Te,_e)),Te=_e;return Te<pe.length&&ue.push(ie.substring(Te,pe.length)),ue}(B,q);const Z=[],ee={positionedLines:Z,text:B.toString(),top:b[1],bottom:b[1],left:b[0],right:b[0],writingMode:D,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(ie,me,ue,pe,Te,_e,Ie,Le,Fe,Ve,ze,We){let Ue=0,Ze=0,ht=0;const ut="right"===Le?1:"left"===Le?0:.5;let qt=!1;for(const Jt of Te){const xn=Jt.getSections();for(const Bn of xn){if(Bn.image)continue;const En=me[Bn.fontStack];if(En&&(qt=void 0!==En.ascender&&void 0!==En.descender,!qt))break}if(!qt)break}let gt=0;for(const Jt of Te){Jt.trim();const xn=Jt.getMaxScale(),Bn=24*(xn-1),En={positionedGlyphs:[],lineOffset:0};ie.positionedLines[gt]=En;const ti=En.positionedGlyphs;let Vn=0;if(!Jt.length()){Ze+=_e,++gt;continue}let ui=0,Si=0;for(let wn=0;wn<Jt.length();wn++){const hi=Jt.getSection(wn),lr=Jt.getSectionIndex(wn),Cr=Jt.getCodePoint(wn);let ft=hi.scale,Or=null,Ki=null,ko=null,ta=24,co=0;Fe===Ka.vertical&&(12312===(yt=Cr)||12313===yt||12316===yt||12540===yt||12448===yt)&&(Fe=Ka.horizontal);const yo=!(Fe===Ka.horizontal||!ze&&!c_(Cr)||ze&&(fb[Cr]||d_(Cr)));if(hi.image){const Rs=pe.get(hi.image.toString());if(!Rs)continue;ko=hi.image,ie.iconsInText=ie.iconsInText||!0,Ki=Rs.paddedRect;const rs=Rs.displaySize;ft=24*ft/We,Or={width:rs[0],height:rs[1],left:0,top:-3,advance:yo?rs[1]:rs[0],localGlyph:!1},co=qt?-Or.height*ft:24*xn-17-rs[1]*ft,ta=Or.advance;const Tl=(yo?rs[0]:rs[1])*ft-24*xn;Tl>0&&Tl>Vn&&(Vn=Tl)}else{const Rs=ue[hi.fontStack];if(!Rs)continue;Rs[Cr]&&(Ki=Rs[Cr]);const rs=me[hi.fontStack];if(!rs)continue;const Tl=rs.glyphs[Cr];if(!Tl)continue;if(Or=Tl.metrics,ta=8203!==Cr?24:0,qt){const bh=void 0!==rs.ascender?Math.abs(rs.ascender):0,nc=void 0!==rs.descender?Math.abs(rs.descender):0,Pc=(bh+nc)*ft;ui<Pc&&(ui=Pc,Si=(bh-nc)/2*ft),co=-bh*ft}else co=24*(xn-ft)-17}yo?(ie.verticalizable=!0,ti.push({glyph:Cr,image:ko,x:Ue,y:Ze+co,vertical:yo,scale:ft,localGlyph:Or.localGlyph,fontStack:hi.fontStack,sectionIndex:lr,metrics:Or,rect:Ki}),Ue+=ta*ft+Ve):(ti.push({glyph:Cr,image:ko,x:Ue,y:Ze+co,vertical:yo,scale:ft,localGlyph:Or.localGlyph,fontStack:hi.fontStack,sectionIndex:lr,metrics:Or,rect:Ki}),Ue+=Or.advance*ft+Ve)}0!==ti.length&&(ht=Math.max(Ue-Ve,ht),qt?gb(ti,ut,Vn,Si,_e*xn/2):gb(ti,ut,Vn,0,_e/2)),Ue=0;const Ui=_e*xn+Vn;En.lineOffset=Math.max(Vn,Bn),Ze+=Ui,++gt}var yt;const pt=Ze,{horizontalAlign:fn,verticalAlign:Ut}=mb(Ie);(function(Jt,xn,Bn,En,ti,Vn){const ui=(xn-Bn)*ti,Si=-Vn*En;for(const Ui of Jt)for(const wn of Ui.positionedGlyphs)wn.x+=ui,wn.y+=Si})(ie.positionedLines,ut,fn,Ut,ht,pt),ie.top+=-Ut*pt,ie.bottom=ie.top+pt,ie.left+=-fn*ht,ie.right=ie.left+ht,ie.hasBaseline=qt}(ee,o,a,u,V,y,C,S,D,I,k,A),!function(ie){for(const me of ie)if(0!==me.positionedGlyphs.length)return!1;return!0}(Z))return ee}const fb={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},pw={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function iS(d,o,a,u,g,p){if(o.image){const y=u.get(o.image.toString());return y?y.displaySize[0]*o.scale*24/p+g:0}{const y=a[o.fontStack],C=y&&y.glyphs[d];return C?C.metrics.advance*o.scale+g:0}}function rS(d,o,a,u){const g=Math.pow(d-o,2);return u?d<o?g/2:2*g:g+Math.abs(a)*a}function fw(d,o,a){let u=0;return 10===d&&(u-=1e4),a&&(u+=150),40!==d&&65288!==d||(u+=50),41!==o&&65289!==o||(u+=50),u}function mw(d,o,a,u,g,p){let y=null,C=rS(o,a,g,p);for(const S of u){const I=rS(o-S.x,a,g,p)+S.badness;I<=C&&(y=S,C=I)}return{index:d,x:o,priorBreak:y,badness:C}}function oS(d){return d?oS(d.priorBreak).concat(d.index):[]}function mb(d){let o=.5,a=.5;switch(d){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(d){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:o,verticalAlign:a}}function gb(d,o,a,u,g){if(!(o||a||u||g))return;const p=d.length-1,y=d[p],C=(y.x+y.metrics.advance*y.scale)*o;for(let S=0;S<=p;S++)d[S].x-=C,d[S].y+=a+u+g}function gw(d,o,a,u){const{horizontalAlign:g,verticalAlign:p}=mb(u),y=a[0]-d.displaySize[0]*g,C=a[1]-d.displaySize[1]*p;return{imagePrimary:d,imageSecondary:o,top:C,bottom:C+d.displaySize[1],left:y,right:y+d.displaySize[0]}}function Jl(d,o,a,u,g,p){const y=d.imagePrimary;let C;if(y.content){const B=y.content,V=y.pixelRatio||1;C=[B[0]/V,B[1]/V,y.displaySize[0]-B[2]/V,y.displaySize[1]-B[3]/V]}const S=o.left*p,I=o.right*p;let b,D,k,T;"width"===a||"both"===a?(T=g[0]+S-u[3],D=g[0]+I+u[1]):(T=g[0]+(S+I-y.displaySize[0])/2,D=T+y.displaySize[0]);const A=o.top*p,O=o.bottom*p;return"height"===a||"both"===a?(b=g[1]+A-u[0],k=g[1]+O+u[2]):(b=g[1]+(A+O-y.displaySize[1])/2,k=b+y.displaySize[1]),{imagePrimary:y,imageSecondary:void 0,top:b,right:D,bottom:k,left:T,collisionPadding:C}}class Ac extends Ot{constructor(o,a,u,g,p){super(o,a),this.angle=g,this.z=u,void 0!==p&&(this.segment=p)}clone(){return new Ac(this.x,this.y,this.z,this.angle,this.segment)}}function _w(d,o,a,u,g){if(void 0===o.segment)return!0;let p=o,y=o.segment+1,C=0;for(;C>-a/2;){if(y--,y<0)return!1;C-=d[y].dist(p),p=d[y]}C+=d[y].dist(d[y+1]),y++;const S=[];let I=0;for(;C<a/2;){const b=d[y],D=d[y+1];if(!D)return!1;let k=d[y-1].angleTo(b)-b.angleTo(D);for(k=Math.abs((k+3*Math.PI)%(2*Math.PI)-Math.PI),S.push({distance:C,angleDelta:k}),I+=k;C-S[0].distance>u;)I-=S.shift().angleDelta;if(I>g)return!1;y++,C+=b.dist(D)}return!0}function Ff(d){let o=0;for(let a=0;a<d.length-1;a++)o+=d[a].dist(d[a+1]);return o}function sS(d,o,a){return d?.6*o*a:0}function Q_(d,o){return Math.max(d?d.right-d.left:0,o?o.right-o.left:0)}function yw(d,o,a,u,g,p){const y=sS(a,g,p),C=Q_(a,u)*p;let S=0;const I=Ff(d)/2;for(let b=0;b<d.length-1;b++){const D=d[b],k=d[b+1],T=D.dist(k);if(S+T>I){const A=(I-S)/T,O=_n(D.x,k.x,A),B=_n(D.y,k.y,A),V=new Ac(O,B,0,k.angleTo(D),b);return!y||_w(d,V,C,y,o)?V:void 0}S+=T}}function aS(d,o,a,u,g,p,y,C,S){const I=sS(u,p,y),b=Q_(u,g),D=b*y,k=0===d[0].x||d[0].x===S||0===d[0].y||d[0].y===S;return o-D<o/4&&(o=D+o/4),vw(d,k?o/2*C%o:(b/2+2*p)*y*C%o,o,I,a,D,k,!1,S)}function vw(d,o,a,u,g,p,y,C,S){const I=p/2,b=Ff(d);let D=0,k=o-a,T=[];for(let A=0;A<d.length-1;A++){const O=d[A],B=d[A+1],V=O.dist(B),q=B.angleTo(O);for(;k+a<D+V;){k+=a;const G=(k-D)/V,H=_n(O.x,B.x,G),Z=_n(O.y,B.y,G);if(H>=0&&H<S&&Z>=0&&Z<S&&k-I>=0&&k+I<=b){const ee=new Ac(H,Z,0,q,A);u&&!_w(d,ee,p,u,g)||T.push(ee)}}D+=V}return C||T.length||y||(T=vw(d,D/2,a,u,g,p,y,!0,S)),T}function bw(d,o,a,u,g){const p=[];for(let y=0;y<d.length;y++){const C=d[y];let S;for(let I=0;I<C.length-1;I++){let b=C[I],D=C[I+1];b.x<o&&D.x<o||(b.x<o?b=new Ot(o,b.y+(o-b.x)/(D.x-b.x)*(D.y-b.y))._round():D.x<o&&(D=new Ot(o,b.y+(o-b.x)/(D.x-b.x)*(D.y-b.y))._round()),b.y<a&&D.y<a||(b.y<a?b=new Ot(b.x+(a-b.y)/(D.y-b.y)*(D.x-b.x),a)._round():D.y<a&&(D=new Ot(b.x+(a-b.y)/(D.y-b.y)*(D.x-b.x),a)._round()),b.x>=u&&D.x>=u||(b.x>=u?b=new Ot(u,b.y+(u-b.x)/(D.x-b.x)*(D.y-b.y))._round():D.x>=u&&(D=new Ot(u,b.y+(u-b.x)/(D.x-b.x)*(D.y-b.y))._round()),b.y>=g&&D.y>=g||(b.y>=g?b=new Ot(b.x+(g-b.y)/(D.y-b.y)*(D.x-b.x),g)._round():D.y>=g&&(D=new Ot(b.x+(g-b.y)/(D.y-b.y)*(D.x-b.x),g)._round()),S&&b.equals(S[S.length-1])||(S=[b],p.push(S)),S.push(D)))))}}return p}function gp(d){let o=0,a=0;for(const y of d)o+=y.w*y.h,a=Math.max(a,y.w);d.sort((y,C)=>C.h-y.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),a),h:1/0}];let g=0,p=0;for(const y of d)for(let C=u.length-1;C>=0;C--){const S=u[C];if(!(y.w>S.w||y.h>S.h)){if(y.x=S.x,y.y=S.y,p=Math.max(p,y.y+y.h),g=Math.max(g,y.x+y.w),y.w===S.w&&y.h===S.h){const I=u.pop();C<u.length&&(u[C]=I)}else y.h===S.h?(S.x+=y.w,S.w-=y.w):y.w===S.w?(S.y+=y.h,S.h-=y.h):(u.push({x:S.x+y.w,y:S.y,w:S.w-y.w,h:y.h}),S.y+=y.h,S.h-=y.h);break}}return{w:g,h:p,fill:o/(g*p)||0}}Zt(Ac,"Anchor");class J_{static getImagePositionScale(o,a,u){if(a&&o&&o.options&&o.options.transform){const g=o.options.transform;return{x:g.a,y:g.d}}return{x:u,y:u}}constructor(o,a,u,g){this.paddedRect=o;const{pixelRatio:p,version:y,stretchX:C,stretchY:S,content:I,sdf:b,usvg:D}=a;this.pixelRatio=p,this.stretchX=C,this.stretchY=S,this.content=I,this.version=y,this.padding=u,this.sdf=b,this.scale=J_.getImagePositionScale(g,D,p)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function lS(d,o,a){const u=Oa.parse(d),g=function(p,y,C=[1,1]){return{x:0,y:0,w:(p.data?p.data.width:p.width*C[0])+2*y,h:(p.data?p.data.height:p.height*C[1])+2*y}}(o,a,[u.options.transform.a,u.options.transform.d]);return{bin:g,imagePosition:new J_(g,o,a,u),imageVariant:u}}class cS{constructor(o,a,u){const g=new Map,p=new Map;this.haveRenderCallbacks=[];const y=[];this.addImages(o,g,1,y),this.addImages(a,p,2,y);const{w:C,h:S}=gp(y),I=new Ho({width:C||1,height:S||1});for(const[b,D]of o.entries()){const k=g.get(b).paddedRect;Ho.copy(D.data,I,{x:0,y:0},{x:k.x+1,y:k.y+1},D.data,u,D.sdf)}for(const[b,D]of a.entries()){const k=p.get(b),T=k.paddedRect;let A=k.padding;const O=T.x+A,B=T.y+A,V=D.data.width,q=D.data.height;A=A>1?A-1:A,Ho.copy(D.data,I,{x:0,y:0},{x:O,y:B},D.data,u),Ho.copy(D.data,I,{x:0,y:q-A},{x:O,y:B-A},{width:V,height:A},u),Ho.copy(D.data,I,{x:0,y:0},{x:O,y:B+q},{width:V,height:A},u),Ho.copy(D.data,I,{x:V-A,y:0},{x:O-A,y:B},{width:A,height:q},u),Ho.copy(D.data,I,{x:0,y:0},{x:O+V,y:B},{width:A,height:q},u),Ho.copy(D.data,I,{x:V-A,y:q-A},{x:O-A,y:B-A},{width:A,height:A},u),Ho.copy(D.data,I,{x:0,y:q-A},{x:O+V,y:B-A},{width:A,height:A},u),Ho.copy(D.data,I,{x:0,y:0},{x:O+V,y:B+q},{width:A,height:A},u),Ho.copy(D.data,I,{x:V-A,y:0},{x:O-A,y:B+q},{width:A,height:A},u)}this.lut=u,this.image=I,this.iconPositions=g,this.patternPositions=p}addImages(o,a,u,g){for(const[p,y]of o.entries()){const{bin:C,imagePosition:S,imageVariant:I}=lS(p,y,u);a.set(p,S),g.push(C),y.hasRenderCallback&&this.haveRenderCallbacks.push(I.id)}}patchUpdatedImages(o,a,u){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(g=>o.hasImage(g,u)),o.dispatchRenderCallbacks(this.haveRenderCallbacks,u);for(const g of o.getUpdatedImages(u)){for(const p of this.iconPositions.keys()){const y=Oa.parse(p);if(ua.isEqual(y.id,g)){const C=o.getImage(g,u);this.patchUpdatedImage(this.iconPositions.get(p),C,a)}}for(const p of this.patternPositions.keys()){const y=Oa.parse(p);if(ua.isEqual(y.id,g)){const C=o.getImage(g,u);this.patchUpdatedImage(this.patternPositions.get(p),C,a)}}}}patchUpdatedImage(o,a,u){if(!o||!a||o.version===a.version)return;o.version=a.version;const[g,p]=o.tl,y=o.sdf;if(this.lut||y){const C={width:a.data.width,height:a.data.height},S=new Ho(C);Ho.copy(a.data,S,{x:0,y:0},{x:0,y:0},C,this.lut,y),u.update(S,{position:{x:g,y:p}})}else u.update(a.data,{position:{x:g,y:p}})}}Zt(J_,"ImagePosition"),Zt(cS,"ImageAtlas");const ey=1e20;function Sl(d,o,a,u,g,p,y,C,S){for(let I=o;I<o+u;I++)vd(d,a*p+I,p,g,y,C,S);for(let I=a;I<a+g;I++)vd(d,I*p+o,1,u,y,C,S)}function vd(d,o,a,u,g,p,y){p[0]=0,y[0]=-ey,y[1]=ey,g[0]=d[o];for(let C=1,S=0,I=0;C<u;C++){g[C]=d[o+C*a];const b=C*C;do{const D=p[S];I=(g[C]-g[D]+b-D*D)/(C-D)/2}while(I<=y[S]&&--S>-1);S++,p[S]=C,y[S]=I,y[S+1]=ey}for(let C=0,S=0;C<u;C++){for(;y[S+1]<C;)S++;const I=p[S],b=C-I;d[o+C*a]=g[I]+b*b}}const xw={none:0,ideographs:1,all:2};class lg{constructor(o,a,u){this.requestManager=o,this.localGlyphMode=a,this.localFontFamily=u,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(o,a){this.urls[a]=o}getGlyphs(o,a,u){const g=[],p=this.urls[a]||re.GLYPHS_URL;for(const y in o)for(const C of o[y])g.push({stack:y,id:C});Gc(g,({stack:y,id:C},S)=>{let I=this.entries[y];I||(I=this.entries[y]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let b=I.glyphs[C];if(void 0!==b)return void S(null,{stack:y,id:C,glyph:b});if(b=this._tinySDF(I,y,C),b)return I.glyphs[C]=b,void S(null,{stack:y,id:C,glyph:b});const D=Math.floor(C/256);if(256*D>65535)return Ir("glyphs > 65535 not supported"),void S(null,{stack:y,id:C,glyph:b});if(I.ranges[D])return void S(null,{stack:y,id:C,glyph:b});let k=I.requests[D];k||(k=I.requests[D]=[],lg.loadGlyphRange(y,D,p,this.requestManager,(T,A)=>{if(A){I.ascender=A.ascender,I.descender=A.descender;for(const O in A.glyphs)this._doesCharSupportLocalGlyph(+O)||(I.glyphs[+O]=A.glyphs[+O]);I.ranges[D]=!0}for(const O of k)O(T,A);delete I.requests[D]})),k.push((T,A)=>{T?S(T):A&&S(null,{stack:y,id:C,glyph:A.glyphs[C]||null})})},(y,C)=>{if(y)u(y);else if(C){const S={};for(const{stack:I,id:b,glyph:D}of C)void 0===S[I]&&(S[I]={}),void 0===S[I].glyphs&&(S[I].glyphs={}),S[I].glyphs[b]=D&&{id:D.id,bitmap:D.bitmap.clone(),metrics:D.metrics},S[I].ascender=this.entries[I].ascender,S[I].descender=this.entries[I].descender;u(null,S)}})}_doesCharSupportLocalGlyph(o){return this.localGlyphMode!==xw.none&&(this.localGlyphMode===xw.all?!!this.localFontFamily:!!this.localFontFamily&&(hn_CJK_Unified_Ideographs(o)||hn_Hangul_Syllables(o)||hn_Hiragana(o)||hn_Katakana(o)||hn_CJK_Symbols_and_Punctuation(o)||hn_CJK_Unified_Ideographs_Extension_A(o)||hn_CJK_Unified_Ideographs_Extension_B(o)||hn_Osage(o)))}_tinySDF(o,a,u){const g=this.localFontFamily;if(!g||!this._doesCharSupportLocalGlyph(u))return;let p=o.tinySDF;if(!p){let O="400";/bold/i.test(a)?O="900":/medium/i.test(a)?O="500":/light/i.test(a)&&(O="200"),p=o.tinySDF=new lg.TinySDF({fontFamily:g,fontWeight:O,fontSize:48,buffer:6,radius:16}),p.fontWeight=O}if(this.localGlyphs[p.fontWeight][u])return this.localGlyphs[p.fontWeight][u];const y=String.fromCodePoint(u),{data:C,width:S,height:I,glyphWidth:b,glyphHeight:D,glyphLeft:k,glyphTop:T,glyphAdvance:A}=p.draw(y);return this.localGlyphs[p.fontWeight][u]={id:u,bitmap:new ah({width:S,height:I},C),metrics:{width:b/2,height:D/2,left:k/2,top:T/2-27,advance:A/2,localGlyph:!0}}}}lg.loadGlyphRange=function(d,o,a,u,g){const p=256*o,y=p+255,C=u.transformRequest(u.normalizeGlyphsURL(a).replace("{fontstack}",d).replace("{range}",`${p}-${y}`),Zo.Glyphs);ca(C,(S,I)=>{if(S)g(S);else if(I){const b={},D=new X_(I).readFields(II,{});for(const k of D.glyphs)b[k.id]=k;g(null,{glyphs:b,ascender:D.ascender,descender:D.descender})}})},lg.TinySDF=class{constructor({fontSize:d=24,buffer:o=3,radius:a=8,cutoff:u=.25,fontFamily:g="sans-serif",fontWeight:p="normal",fontStyle:y="normal"}={}){this.buffer=o,this.cutoff=u,this.radius=a;const C=this.size=d+4*o,S=this._createCanvas(C),I=this.ctx=S.getContext("2d",{willReadFrequently:!0});I.font=`${y} ${p} ${d}px ${g}`,I.textBaseline="alphabetic",I.textAlign="left",I.fillStyle="black",this.gridOuter=new Float64Array(C*C),this.gridInner=new Float64Array(C*C),this.f=new Float64Array(C),this.z=new Float64Array(C+1),this.v=new Uint16Array(C)}_createCanvas(d){const o=document.createElement("canvas");return o.width=o.height=d,o}draw(d){const{width:o,actualBoundingBoxAscent:a,actualBoundingBoxDescent:u,actualBoundingBoxLeft:g,actualBoundingBoxRight:p}=this.ctx.measureText(d),y=Math.ceil(a),C=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-g))),S=Math.min(this.size-this.buffer,y+Math.ceil(u)),I=C+2*this.buffer,b=S+2*this.buffer,D=Math.max(I*b,0),k=new Uint8ClampedArray(D),T={data:k,width:I,height:b,glyphWidth:C,glyphHeight:S,glyphTop:y,glyphLeft:0,glyphAdvance:o};if(0===C||0===S)return T;const{ctx:A,buffer:O,gridInner:B,gridOuter:V}=this;A.clearRect(O,O,C,S),A.fillText(d,O,O+y);const q=A.getImageData(O,O,C,S);V.fill(ey,0,D),B.fill(0,0,D);for(let G=0;G<S;G++)for(let H=0;H<C;H++){const Z=q.data[4*(G*C+H)+3]/255;if(0===Z)continue;const ee=(G+O)*I+H+O;if(1===Z)V[ee]=0,B[ee]=ey;else{const ie=.5-Z;V[ee]=ie>0?ie*ie:0,B[ee]=ie<0?ie*ie:0}}Sl(V,0,0,I,b,I,this.f,this.v,this.z),Sl(B,O,O,C,S,I,this.f,this.v,this.z);for(let G=0;G<D;G++){const H=Math.sqrt(V[G])-Math.sqrt(B[G]);k[G]=Math.round(255-255*(H/this.radius+this.cutoff))}return T}};function dS(d,o){return d+o[1]-o[0]}function uS(d,o,a,u,g=1){const p=[],y=d.imagePrimary,C=y.pixelRatio,S=y.paddedRect.w-2,I=y.paddedRect.h-2,b=(d.right-d.left)*g,D=(d.bottom-d.top)*g,k=y.stretchX||[[0,S]],T=y.stretchY||[[0,I]],A=k.reduce(dS,0),O=T.reduce(dS,0),B=S-A,V=I-O;let q=0,G=A,H=0,Z=O,ee=0,ie=B,me=0,ue=V;if(y.content&&u){const Te=y.content;q=ty(k,0,Te[0]),H=ty(T,0,Te[1]),G=ty(k,Te[0],Te[2]),Z=ty(T,Te[1],Te[3]),ee=Te[0]-q,me=Te[1]-H,ie=Te[2]-Te[0]-G,ue=Te[3]-Te[1]-Z}const pe=(Te,_e,Ie,Le)=>{const Fe=_b(Te.stretch-q,G,b,d.left*g),Ve=yb(Te.fixed-ee,ie,Te.stretch,A),ze=_b(_e.stretch-H,Z,D,d.top*g),We=yb(_e.fixed-me,ue,_e.stretch,O),Ue=_b(Ie.stretch-q,G,b,d.left*g),Ze=yb(Ie.fixed-ee,ie,Ie.stretch,A),ht=_b(Le.stretch-H,Z,D,d.top*g),ut=yb(Le.fixed-me,ue,Le.stretch,O),qt=new Ot(Fe,ze),gt=new Ot(Ue,ze),yt=new Ot(Ue,ht),pt=new Ot(Fe,ht),fn=new Ot(Ve/C,We/C),Ut=new Ot(Ze/C,ut/C),Jt=o*Math.PI/180;if(Jt){const ui=Math.sin(Jt),Si=Math.cos(Jt),Ui=[Si,-ui,ui,Si];qt._matMult(Ui),gt._matMult(Ui),pt._matMult(Ui),yt._matMult(Ui)}const xn=Te.stretch+Te.fixed,Bn=Ie.stretch+Ie.fixed,En=_e.stretch+_e.fixed,ti=Le.stretch+Le.fixed,Vn=d.imageSecondary;return{tl:qt,tr:gt,bl:pt,br:yt,texPrimary:{x:y.paddedRect.x+1+xn,y:y.paddedRect.y+1+En,w:Bn-xn,h:ti-En},texSecondary:Vn?{x:Vn.paddedRect.x+1+xn,y:Vn.paddedRect.y+1+En,w:Bn-xn,h:ti-En}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:fn,pixelOffsetBR:Ut,minFontScaleX:ie/C/b,minFontScaleY:ue/C/D,isSDF:a}};if(u&&(y.stretchX||y.stretchY)){const Te=hS(k,B,A),_e=hS(T,V,O);for(let Ie=0;Ie<Te.length-1;Ie++){const Le=Te[Ie],Fe=Te[Ie+1];for(let Ve=0;Ve<_e.length-1;Ve++)p.push(pe(Le,_e[Ve],Fe,_e[Ve+1]))}}else p.push(pe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:S+1},{fixed:0,stretch:I+1}));return p}function ty(d,o,a){let u=0;for(const g of d)u+=Math.max(o,Math.min(a,g[1]))-Math.max(o,Math.min(a,g[0]));return u}function hS(d,o,a){const u=[{fixed:-1,stretch:0}];for(const[g,p]of d){const y=u[u.length-1];u.push({fixed:g-y.stretch,stretch:y.stretch}),u.push({fixed:g-y.stretch,stretch:y.stretch+(p-g)})}return u.push({fixed:o+1,stretch:a}),u}function _b(d,o,a,u){return d/o*a+u}function yb(d,o,a,u){return d-o*a/u}function RI(d,o,a,u){const g=o+d.positionedLines[u].lineOffset;return 0===u?a+g/2:a+(g+(o+d.positionedLines[u-1].lineOffset))/2}function vb(d,o=1,a=!1){let u=1/0,g=1/0,p=-1/0,y=-1/0;const C=d[0];for(let T=0;T<C.length;T++){const A=C[T];(!T||A.x<u)&&(u=A.x),(!T||A.y<g)&&(g=A.y),(!T||A.x>p)&&(p=A.x),(!T||A.y>y)&&(y=A.y)}const S=Math.min(p-u,y-g);let I=S/2;const b=new ef([],hh);if(0===S)return new Ot(u,g);for(let T=u;T<p;T+=S)for(let A=g;A<y;A+=S)b.push(new mu(T+I,A+I,I,d));let D=function(T){let A=0,O=0,B=0;const V=T[0];for(let q=0,G=V.length,H=G-1;q<G;H=q++){const Z=V[q],ee=V[H],ie=Z.x*ee.y-ee.x*Z.y;O+=(Z.x+ee.x)*ie,B+=(Z.y+ee.y)*ie,A+=3*ie}return new mu(O/A,B/A,0,T)}(d),k=b.length;for(;b.length;){const T=b.pop();(T.d>D.d||!D.d)&&(D=T,a&&console.log("found best %d after %d probes",Math.round(1e4*T.d)/1e4,k)),T.max-D.d<=o||(I=T.h/2,b.push(new mu(T.p.x-I,T.p.y-I,I,d)),b.push(new mu(T.p.x+I,T.p.y-I,I,d)),b.push(new mu(T.p.x-I,T.p.y+I,I,d)),b.push(new mu(T.p.x+I,T.p.y+I,I,d)),k+=4)}return a&&(console.log(`num probes: ${k}`),console.log(`best distance: ${D.d}`)),D.p}function hh(d,o){return o.max-d.max}class mu{constructor(o,a,u,g){this.p=new Ot(o,a),this.h=u,this.d=function(p,y){let C=!1,S=1/0;for(let I=0;I<y.length;I++){const b=y[I];for(let D=0,k=b.length,T=k-1;D<k;T=D++){const A=b[D],O=b[T];A.y>p.y!=O.y>p.y&&p.x<(O.x-A.x)*(p.y-A.y)/(O.y-A.y)+A.x&&(C=!C),S=Math.min(S,we(p,A,O))}}return(C?1:-1)*Math.sqrt(S)}(this.p,g),this.max=this.d+this.h*Math.SQRT2}}const bb=Number.POSITIVE_INFINITY,pS=Math.sqrt(2);function ww(d,[o,a]){let u=0,g=0;if(a===bb){o<0&&(o=0);const p=o/pS;switch(d){case"top-right":case"top-left":g=p-7;break;case"bottom-right":case"bottom-left":g=7-p;break;case"bottom":g=7-o;break;case"top":g=o-7}switch(d){case"top-right":case"bottom-right":u=-p;break;case"top-left":case"bottom-left":u=p;break;case"left":u=o;break;case"right":u=-o}}else{switch(o=Math.abs(o),a=Math.abs(a),d){case"top-right":case"top-left":case"top":g=a-7;break;case"bottom-right":case"bottom-left":case"bottom":g=7-a}switch(d){case"top-right":case"bottom-right":case"right":u=-o;break;case"top-left":case"bottom-left":case"left":u=o}}return[u,g]}function PI(d,o,a,u,g,p,y,C){if(!d)return;const S=TI(o,a,u,g,p);return d.scaleSelf(S*C*y)}function OI(d,o,a,u,g,p,y,C){return{iconPrimary:PI(d.getPrimary(),o,a,u,g,p,y,C),iconSecondary:PI(d.getSecondary(),o,a,u,g,p,y,C)}}function FI(d,o,a,u){if(!d)return;const g=o.get(a.toString());if(d.imagePrimary=g,u){const p=o.get(u.toString());d.imageSecondary=p}}function Cw(d,o){for(const a in d.horizontal)xb(d.horizontal[a],o);xb(d.vertical,o)}function xb(d,o){if(d)for(const a of d.positionedLines)for(const u of a.positionedGlyphs)if(null!==u.image){const g=u.image.toString();u.rect=o.get(g).paddedRect}}function fS(d){switch(d){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function hO(d,o,a,u,g,p,y,C,S){const I=Ew(p.horizontal)||p.vertical,b=a.get("icon-text-fit-padding").evaluate(u,{},g);let D,k=o;return o&&"none"!==S&&(d.allowVerticalPlacement&&p.vertical&&(D=Jl(o,p.vertical,S,b,C,y)),I&&(k=Jl(o,I,S,b,C,y))),{defaultShapedIcon:k,verticallyShapedIcon:D}}function mS(d,o,a,u,g,p,y,C,S,I,b,D,k,T,A,O,B,V,q,G){let H=y.textMaxSize.evaluate(o,{},k);void 0===H?H=C*y.textScaleFactor:H*=y.textScaleFactor;const Z=d.layers[0].layout,ee=Ew(a.horizontal)||a.vertical,ie="globe"===T.name,ue=d.tilePixelRatio*H/24,pe=(Ve=d.overscaling,d.zoom>18&&Ve>2&&(Ve>>=1),Math.max(kt/(512*Ve),1)*Z.get("symbol-spacing")),Te=Z.get("text-padding")*d.tilePixelRatio,_e=Z.get("icon-padding")*d.tilePixelRatio,Ie=yi(Z.get("text-max-angle")),Le="map"===Z.get("icon-rotation-alignment")&&"point"!==G,Fe=pe/2;var Ve;!1===d.hasAnyIconTextFit&&"none"!==B&&(d.hasAnyIconTextFit=!0);const ze=o.properties?+o.properties[ch]:null,We=ze&&d.elevationFeatureIdToIndex?d.elevationFeatureIdToIndex.get(ze):65535,Ue=(Ze,ht,ut)=>{if(ht.x<0||ht.x>=kt||ht.y<0||ht.y>=kt)return;let qt=null;if(ie){const{x:gt,y:yt,z:pt}=T.projectTilePoint(ht.x,ht.y,ut);qt={anchor:new Ac(gt,yt,pt,0,void 0),up:T.upVector(ut,ht.x,ht.y)}}!function(gt,yt,pt,fn,Ut,Jt,xn,Bn,En,ti,Vn,ui,Si,Ui,wn,hi,lr,Cr,ft,Or,Ki,ko,ta,co,yo,Rs,rs,Tl,bh){const nc=gt.addToLineVertexArray(yt,fn);let Pc,Mp,Tp,Gf,xD,wD,CA,C1=0,E1=0,S1=0,CD=0,D1=-1,ED=-1;const _u={};let SD=ll("");const qf=pt?pt.anchor:yt,Wf="none"!==Tl;let M1=0,T1=0;if(void 0===En._unevaluatedLayout.getValue("text-radial-offset")?[M1,T1]=En.layout.get("text-offset").evaluate(Ki,{},yo).map(Il=>24*Il):(M1=24*En.layout.get("text-radial-offset").evaluate(Ki,{},yo),T1=bb),gt.allowVerticalPlacement&&Ut.vertical){const Il=Ut.vertical;if(wn)wD=Cb(Il),Bn&&(CA=Cb(Bn));else{const Ca=En.layout.get("text-rotate").evaluate(Ki,{},yo)+90;Tp=wb(ti,qf,yt,Vn,ui,Si,Il,Ui,Ca,hi),Bn&&(Gf=wb(ti,qf,yt,Vn,ui,Si,Bn,Cr,Ca))}}if(Jt){const Il=gt.iconSizeData,Ca=En.layout.get("icon-rotate").evaluate(Ki,{},yo),Yf=uS(Jt,Ca,ta,Wf,ko.iconScaleFactor),a0=Bn?uS(Bn,Ca,ta,Wf,ko.iconScaleFactor):void 0;Mp=wb(ti,qf,yt,Vn,ui,Si,Jt,Cr,Ca,null),C1=4*Yf.length;let Zf=null;"source"===Il.kind?(Zf=[fu*En.layout.get("icon-size").evaluate(Ki,{},yo)*ko.iconScaleFactor],Zf[0]>yp&&Ir(`${gt.layerIds[0]}: Value for "icon-size" is >= ${ny}. Reduce your "icon-size".`)):"composite"===Il.kind&&(Zf=[fu*ko.compositeIconSizes[0].evaluate(Ki,{},yo)*ko.iconScaleFactor,fu*ko.compositeIconSizes[1].evaluate(Ki,{},yo)*ko.iconScaleFactor],(Zf[0]>yp||Zf[1]>yp)&&Ir(`${gt.layerIds[0]}: Value for "icon-size" is >= ${ny}. Reduce your "icon-size".`)),gt.addSymbols(gt.icon,Yf,Zf,Or,ft,Ki,!1,pt,yt,nc.lineStartIndex,nc.lineLength,-1,co,yo,Rs,rs),D1=gt.icon.placedSymbolArray.length-1,a0&&(E1=4*a0.length,gt.addSymbols(gt.icon,a0,Zf,Or,ft,Ki,Ka.vertical,pt,yt,nc.lineStartIndex,nc.lineLength,-1,co,yo,Rs,rs),ED=gt.icon.placedSymbolArray.length-1)}for(const Il in Ut.horizontal){const Ca=Ut.horizontal[Il];Pc||(SD=ll(Ca.text),wn?xD=Cb(Ca):Pc=wb(ti,qf,yt,Vn,ui,Si,Ca,Ui,En.layout.get("text-rotate").evaluate(Ki,{},yo),hi));const Yf=1===Ca.positionedLines.length;if(S1+=gS(gt,pt,yt,Ca,xn,En,wn,Ki,hi,nc,Ut.vertical?Ka.horizontal:Ka.horizontalOnly,Yf?Object.keys(Ut.horizontal):[Il],_u,D1,ko,co,yo,Rs),Yf)break}Ut.vertical&&(CD+=gS(gt,pt,yt,Ut.vertical,xn,En,wn,Ki,hi,nc,Ka.vertical,["vertical"],_u,ED,ko,co,yo,Rs));let io=-1;const I1=(Il,Ca)=>Il?Math.max(Il,Ca):Ca;io=I1(xD,io),io=I1(wD,io),io=I1(CA,io);const EA=io>-1?1:0;gt.glyphOffsetArray.length>=65535&&Ir("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==Ki.sortKey&&gt.addToSortKeyRanges(gt.symbolInstances.length,Ki.sortKey),gt.symbolInstances.emplaceBack(yt.x,yt.y,qf.x,qf.y,qf.z,_u.right>=0?_u.right:-1,_u.center>=0?_u.center:-1,_u.left>=0?_u.left:-1,_u.vertical>=0?_u.vertical:-1,D1,ED,SD,void 0!==Pc?Pc:gt.collisionBoxArray.length,void 0!==Pc?Pc+1:gt.collisionBoxArray.length,void 0!==Tp?Tp:gt.collisionBoxArray.length,void 0!==Tp?Tp+1:gt.collisionBoxArray.length,void 0!==Mp?Mp:gt.collisionBoxArray.length,void 0!==Mp?Mp+1:gt.collisionBoxArray.length,Gf||gt.collisionBoxArray.length,Gf?Gf+1:gt.collisionBoxArray.length,Vn,S1,CD,C1,E1,EA,0,M1,T1,io,0,Wf?1:0,bh)}(d,ht,qt,Ze,a,u,p,g,d.layers[0],d.collisionBoxArray,o.index,o.sourceLayerIndex,d.index,Te,q,I,0,_e,Le,V,o,y,b,D,k,A,O,B,We)};if("line"===G)for(const Ze of bw(o.geometry,0,0,kt,kt)){const ht=aS(Ze,pe,Ie,a.vertical||ee,u,24,ue,d.overscaling,kt);for(const ut of ht)ee&&_S(d,ee.text,Fe,ut)||Ue(Ze,ut,k)}else if("line-center"===G){for(const Ze of o.geometry)if(Ze.length>1){const ht=yw(Ze,Ie,a.vertical||ee,u,24,ue);ht&&Ue(Ze,ht,k)}}else if("Polygon"===o.type)for(const Ze of k_(o.geometry,0)){const ht=vb(Ze,16);Ue(Ze[0],new Ac(ht.x,ht.y,0,0,void 0),k)}else if("LineString"===o.type)for(const Ze of o.geometry)Ue(Ze,new Ac(Ze[0].x,Ze[0].y,0,0,void 0),k);else if("Point"===o.type)for(const Ze of o.geometry)for(const ht of Ze)Ue([ht],new Ac(ht.x,ht.y,0,0,void 0),k)}const ny=255,yp=ny*fu;function gS(d,o,a,u,g,p,y,C,S,I,b,D,k,T,A,O,B,V){const q=function(Z,ee,ie,me,ue,pe,Te,_e){const Ie=[];if(0===ee.positionedLines.length)return Ie;const Le=me.layout.get("text-rotate").evaluate(pe,{})*Math.PI/180,Fe=function(Ze){const ht=Ze[0],ut=Ze[1],qt=ht*ut;return qt>0?[ht,-ut]:qt<0?[-ht,ut]:0===ht?[ut,ht]:[ut,-ht]}(ie);let Ve=Math.abs(ee.top-ee.bottom);for(const Ze of ee.positionedLines)Ve-=Ze.lineOffset;const ze=ee.positionedLines.length,We=Ve/ze;let Ue=ee.top-ie[1];for(let Ze=0;Ze<ze;++Ze){const ht=ee.positionedLines[Ze];Ue=RI(ee,We,Ue,Ze);for(const ut of ht.positionedGlyphs){if(!ut.rect)continue;const qt=ut.rect||{};let gt=4,yt=!0,pt=1,fn=0;if(ut.image){const Ki=Te.get(ut.image.toString());if(!Ki)continue;if(Ki.sdf){Ir("SDF images are not supported in formatted text and will be ignored.");continue}yt=!1,pt=Ki.pixelRatio,gt=1/pt}const Ut=(ue||_e)&&ut.vertical,Jt=ut.metrics.advance*ut.scale/2,xn=ut.metrics,Bn=ut.rect;if(null===Bn)continue;_e&&ee.verticalizable&&(fn=ut.image?Jt-ut.metrics.width*ut.scale/2:0);const En=ue?[ut.x+Jt,ut.y]:[0,0];let ti=[0,0],Vn=[0,0],ui=!1;ue||(Ut?(Vn=[ut.x+Jt+Fe[0],ut.y+Fe[1]-fn],ui=!0):ti=[ut.x+Jt+ie[0],ut.y+ie[1]-fn]);const Si=Bn.w*ut.scale/(pt*(ut.localGlyph?2:1)),Ui=Bn.h*ut.scale/(pt*(ut.localGlyph?2:1));let wn,hi,lr,Cr;if(Ut){const Ki=ut.y-Ue,ko=new Ot(-Jt,Jt-Ki),ta=-Math.PI/2,co=new Ot(...Vn);wn=new Ot(-Jt+ti[0],ti[1]),wn._rotateAround(ta,ko)._add(co),wn.x+=-Ki+Jt,wn.y-=(xn.left-gt)*ut.scale;const yo=ut.image?xn.advance*ut.scale:24*ut.scale,Rs=String.fromCodePoint(ut.glyph);dO(Rs)?wn.x+=(1-gt)*ut.scale:uO(Rs)?wn.x+=yo-xn.height*ut.scale+(-gt-1)*ut.scale:wn.x+=ut.image||xn.width+2*gt===Bn.w&&xn.height+2*gt===Bn.h?(yo-Ui)/2:(yo-(xn.height+2*gt)*ut.scale)/2,hi=new Ot(wn.x,wn.y-Si),lr=new Ot(wn.x+Ui,wn.y),Cr=new Ot(wn.x+Ui,wn.y-Si)}else{const Ki=(xn.left-gt)*ut.scale-Jt+ti[0],ko=(-xn.top-gt)*ut.scale+ti[1],ta=Ki+Si,co=ko+Ui;wn=new Ot(Ki,ko),hi=new Ot(ta,ko),lr=new Ot(Ki,co),Cr=new Ot(ta,co)}if(Le){let Ki;Ki=ue?new Ot(0,0):ui?new Ot(Fe[0],Fe[1]):new Ot(ie[0],ie[1]),wn._rotateAround(Le,Ki),hi._rotateAround(Le,Ki),lr._rotateAround(Le,Ki),Cr._rotateAround(Le,Ki)}const ft=new Ot(0,0),Or=new Ot(0,0);Ie.push({tl:wn,tr:hi,bl:lr,br:Cr,texPrimary:qt,texSecondary:void 0,writingMode:ee.writingMode,glyphOffset:En,sectionIndex:ut.sectionIndex,isSDF:yt,pixelOffsetTL:ft,pixelOffsetBR:Or,minFontScaleX:0,minFontScaleY:0})}}return Ie}(0,u,S,p,y,C,g,d.allowVerticalPlacement),G=d.textSizeData;let H=null;"source"===G.kind?(H=[fu*p.layout.get("text-size").evaluate(C,{},B)*A.textScaleFactor],H[0]>yp&&Ir(`${d.layerIds[0]}: Value for "text-size" is >= ${ny}. Reduce your "text-size".`)):"composite"===G.kind&&(H=[fu*A.compositeTextSizes[0].evaluate(C,{},B)*A.textScaleFactor,fu*A.compositeTextSizes[1].evaluate(C,{},B)*A.textScaleFactor],(H[0]>yp||H[1]>yp)&&Ir(`${d.layerIds[0]}: Value for "text-size" is >= ${ny}. Reduce your "text-size".`)),d.addSymbols(d.text,q,H,S,y,C,b,o,a,I.lineStartIndex,I.lineLength,T,O,B,V,!1);for(const Z of D)k[Z]=d.text.placedSymbolArray.length-1;return 4*q.length}function Ew(d){for(const o in d)return d[o];return null}function wb(d,o,a,u,g,p,y,C,S,I){let b=y.top,D=y.bottom,k=y.left,T=y.right;const A=y.collisionPadding;if(A&&(k-=A[0],b-=A[1],T+=A[2],D+=A[3]),S){const O=new Ot(k,b),B=new Ot(T,b),V=new Ot(k,D),q=new Ot(T,D),G=yi(S);let H=new Ot(0,0);I&&(H=new Ot(I[0],I[1])),O._rotateAround(G,H),B._rotateAround(G,H),V._rotateAround(G,H),q._rotateAround(G,H),k=Math.min(O.x,B.x,V.x,q.x),T=Math.max(O.x,B.x,V.x,q.x),b=Math.min(O.y,B.y,V.y,q.y),D=Math.max(O.y,B.y,V.y,q.y)}return d.emplaceBack(o.x,o.y,o.z,a.x,a.y,k,b,T,D,C,u,g,p),d.length-1}function Cb(d){d.collisionPadding&&(d.top-=d.collisionPadding[1],d.bottom+=d.collisionPadding[3]);const o=d.bottom-d.top;return o>0?Math.max(10,o):null}function _S(d,o,a,u){const g=d.compareText;if(o in g){const p=g[o];for(let y=p.length-1;y>=0;y--)if(u.dist(p[y])<a)return!0}else g[o]=[];return g[o].push(u),!1}function yS(d,o){const a=d.fovAboveCenter,u=d.elevation?d.elevation.getMinElevationBelowMSL()*o:0,g=(d._camera.position[2]*d.worldSize-u)/Math.cos(d._pitch),p=Math.sin(a)*g/Math.sin(Math.max(Math.PI/2-d._pitch-a,.01));let y=Math.sin(d._pitch)*p+g;const C=g*(1/d._horizonShift);if(!d.elevation||0===d.elevation.exaggeration()){let S=Math.max(d.zoom-17,0);d.isOrthographic&&(S/=10),y*=1+S}return Math.min(1.01*y,C)}function iy(d,o){if(!o.isReprojectedInTileSpace)return{scale:1<<d.z,x:d.x,y:d.y,x2:d.x+1,y2:d.y+1,projection:o};const a=Math.pow(2,-d.z),u=d.x*a,g=(d.x+1)*a,p=d.y*a,y=(d.y+1)*a,C=xa(u),S=xa(g),I=Uo(p),b=Uo(y),D=o.project(C,I),k=o.project(S,I),T=o.project(S,b),A=o.project(C,b);let O=Math.min(D.x,k.x,T.x,A.x),B=Math.min(D.y,k.y,T.y,A.y),V=Math.max(D.x,k.x,T.x,A.x),q=Math.max(D.y,k.y,T.y,A.y);const G=a/16;function H(ee,ie,me,ue,pe,Te){const _e=(me+pe)/2,Ie=(ue+Te)/2,Le=o.project(xa(_e),Uo(Ie)),Fe=Math.max(0,O-Le.x,B-Le.y,Le.x-V,Le.y-q);O=Math.min(O,Le.x),V=Math.max(V,Le.x),B=Math.min(B,Le.y),q=Math.max(q,Le.y),Fe>G&&(H(ee,Le,me,ue,_e,Ie),H(Le,ie,_e,Ie,pe,Te))}H(D,k,u,p,g,p),H(k,T,g,p,g,y),H(T,A,g,y,u,y),H(A,D,u,y,u,p),O-=G,B-=G,V+=G,q+=G;const Z=1/Math.max(V-O,q-B);return{scale:Z,x:O*Z,y:B*Z,x2:V*Z,y2:q*Z,projection:o}}function Sw(d,{x:o,y:a},u=0){return new Ot(((o-u)*d.scale-d.x)*kt,(a*d.scale-d.y)*kt)}const Eb=ge.mat4.identity(new Float32Array(16));class ph{constructor(o){this.spec=o,this.name=o.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(o,a){return{x:0,y:0,z:0}}unproject(o,a){return new Ri(0,0)}projectTilePoint(o,a,u){return{x:o,y:a,z:0}}locationPoint(o,a,u,g=!0){return o._coordinatePoint(o.locationCoordinate(a,u),g)}pixelsPerMeter(o,a){return Co(1,o)*a}pixelSpaceConversion(o,a,u){return 1}farthestPixelDistance(o){return yS(o,o.pixelsPerMeter)}pointCoordinate(o,a,u,g){const p=o.horizonLineFromTop(!1),y=new Ot(a,Math.max(p,u));return o.rayIntersectionCoordinate(o.pointRayIntersection(y,g))}pointCoordinate3D(o,a,u){const g=new Ot(a,u);if(o.elevation)return o.elevation.pointCoordinate(g);{const p=this.pointCoordinate(o,g.x,g.y,0);return[p.x,p.y,p.z]}}isPointAboveHorizon(o,a){if(o.elevation&&o.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(o,a.x,a.y);const u=o.horizonLineFromTop();return a.y<u}createInversionMatrix(o,a){return Eb}createTileMatrix(o,a,u){let g,p,y;const C=u.canonical,S=ge.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const I=iy(C,this);g=1,p=I.x+u.wrap*I.scale,y=I.y,ge.mat4.scale(S,S,[g/I.scale,g/I.scale,o.pixelsPerMeter/a])}else g=a/o.zoomScale(C.z),p=(C.x+Math.pow(2,C.z)*u.wrap)*g,y=C.y*g;return ge.mat4.translate(S,S,[p,y,0]),ge.mat4.scale(S,S,[g/kt,g/kt,1]),S}upVector(o,a,u){return[0,0,1]}upVectorScale(o,a,u){return{metersToTile:1}}}class Dw extends ph{constructor(o){super(o),this.range=[4,7],this.center=o.center||[-96,37.5];const[a,u]=this.parallels=o.parallels||[29.5,45.5],g=Math.sin(yi(a));this.n=(g+Math.sin(yi(u)))/2,this.c=1+g*(2*this.n-g),this.r0=Math.sqrt(this.c)/this.n}project(o,a){const{n:u,c:g,r0:p}=this,y=yi(o-this.center[0]),C=yi(a),S=Math.sqrt(g-2*u*Math.sin(C))/u;return{x:S*Math.sin(y*u),y:S*Math.cos(y*u)-p,z:0}}unproject(o,a){const{n:u,c:g,r0:p}=this,y=p+a;let C=Math.atan2(o,Math.abs(y))*Math.sign(y);y*u<0&&(C-=Math.PI*Math.sign(o)*Math.sign(y));const S=yi(this.center[0])*u;C=Dr(C,-Math.PI-S,Math.PI-S);const I=Qn(Po(C/u)+this.center[0],-180,180),b=Math.asin(Qn((g-(o*o+y*y)*u*u)/(2*u),-1,1)),D=Qn(Po(b),-br,br);return new Ri(I,D)}}const ry=1.340264,ns=-.081106,oy=893e-6,sy=.003796,vp=Math.sqrt(3)/2;class vS extends ph{project(o,a){a=a/180*Math.PI,o=o/180*Math.PI;const u=Math.asin(vp*Math.sin(a)),g=u*u,p=g*g*g;return{x:.5*(o*Math.cos(u)/(vp*(ry+3*ns*g+p*(7*oy+9*sy*g)))/Math.PI+.5),y:1-.5*(u*(ry+ns*g+p*(oy+sy*g))/Math.PI+1),z:0}}unproject(o,a){o=(2*o-.5)*Math.PI;let u=a=(2*(1-a)-1)*Math.PI,g=u*u,p=g*g*g;for(let b,D,k,T=0;T<12&&(D=u*(ry+ns*g+p*(oy+sy*g))-a,k=ry+3*ns*g+p*(7*oy+9*sy*g),b=D/k,u=Qn(u-b,-Math.PI/3,Math.PI/3),g=u*u,p=g*g*g,!(Math.abs(b)<1e-12));++T);const y=vp*o*(ry+3*ns*g+p*(7*oy+9*sy*g))/Math.cos(u),C=Math.asin(Math.sin(u)/vp),S=Qn(180*y/Math.PI,-180,180),I=Qn(180*C/Math.PI,-br,br);return new Ri(S,I)}}class LI extends ph{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0}project(o,a){return{x:.5+o/360,y:.5-a/360,z:0}}unproject(o,a){const u=360*(o-.5),g=Qn(360*(.5-a),-br,br);return new Ri(u,g)}}const cg=Math.PI/2;function Sb(d){return Math.tan((cg+d)/2)}class NI extends ph{constructor(o){super(o),this.center=o.center||[0,30];const[a,u]=this.parallels=o.parallels||[30,30];let g=yi(a),p=yi(u);this.southernCenter=g+p<0,this.southernCenter&&(g=-g,p=-p);const y=Math.cos(g),C=Sb(g);this.n=g===p?Math.sin(g):Math.log(y/Math.cos(p))/Math.log(Sb(p)/C),this.f=y*Math.pow(Sb(g),this.n)/this.n}project(o,a){a=yi(a),this.southernCenter&&(a=-a),o=yi(o-this.center[0]);const u=1e-6,{n:g,f:p}=this;p>0?a<-cg+u&&(a=-cg+u):a>cg-u&&(a=cg-u);const y=p/Math.pow(Sb(a),g);let C=y*Math.sin(g*o),S=p-y*Math.cos(g*o);return C=.5*(C/Math.PI+.5),S=.5*(S/Math.PI+.5),{x:C,y:this.southernCenter?S:1-S,z:0}}unproject(o,a){o=(2*o-.5)*Math.PI,this.southernCenter&&(a=1-a),a=(2*(1-a)-.5)*Math.PI;const{n:u,f:g}=this,p=g-a,y=Math.sign(p),C=Math.sign(u)*Math.sqrt(o*o+p*p);let S=Math.atan2(o,Math.abs(p))*y;p*u<0&&(S-=Math.PI*Math.sign(o)*y);const I=Qn(Po(S/u)+this.center[0],-180,180),b=Qn(Po(2*Math.atan(Math.pow(g/C,1/u))-cg),-br,br);return new Ri(I,this.southernCenter?-b:b)}}class Mw extends ph{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(o,a){return{x:Dc(o),y:As(a),z:0}}unproject(o,a){const u=xa(o),g=Uo(a);return new Ri(u,g)}}const zI=yi(br);class pO extends ph{project(o,a){const u=(a=yi(a))*a,g=u*u;return{x:.5*((o=yi(o))*(.8707-.131979*u+g*(g*(.003971*u-.001529*g)-.013791))/Math.PI+.5),y:1-.5*(a*(1.007226+u*(.015085+g*(.028874*u-.044475-.005916*g)))/Math.PI+1),z:0}}unproject(o,a){o=(2*o-.5)*Math.PI;let u=a=(2*(1-a)-1)*Math.PI,g=25,p=0,y=u*u;do{y=u*u;const I=y*y;p=(u*(1.007226+y*(.015085+I*(.028874*y-.044475-.005916*I)))-a)/(1.007226+y*(.045255+I*(.259866*y-.311325-.005916*11*I))),u=Qn(u-p,-zI,zI)}while(Math.abs(p)>1e-6&&--g>0);y=u*u;const C=Qn(Po(o/(.8707+y*(y*(y*y*y*(.003971-.001529*y)-.013791)-.131979))),-180,180),S=Po(u);return new Ri(C,S)}}const dg=yi(br);class BI extends ph{project(o,a){a=yi(a),o=yi(o);const u=Math.cos(a),g=2/Math.PI,p=Math.acos(u*Math.cos(o/2)),y=Math.sin(p)/p,C=.5*(o*g+2*u*Math.sin(o/2)/y)||0,S=.5*(a+Math.sin(a)/y)||0;return{x:.5*(C/Math.PI+.5),y:1-.5*(S/Math.PI+1),z:0}}unproject(o,a){let u=o=(2*o-.5)*Math.PI,g=a=(2*(1-a)-1)*Math.PI,p=25;const y=1e-6;let C=0,S=0;do{const I=Math.cos(g),b=Math.sin(g),D=2*b*I,k=b*b,T=I*I,A=Math.cos(u/2),O=Math.sin(u/2),B=2*A*O,V=O*O,q=1-T*A*A,G=q?1/q:0,H=q?Math.acos(I*A)*Math.sqrt(1/q):0,Z=.5*(2*H*I*O+2*u/Math.PI)-o,ee=.5*(H*b+g)-a,ie=.5*G*(T*V+H*I*A*k)+1/Math.PI,me=G*(B*D/4-H*b*O),ue=.125*G*(D*O-H*b*T*B),pe=.5*G*(k*A+H*V*I)+.5,Te=me*ue-pe*ie;C=(ee*me-Z*pe)/Te,S=(Z*ue-ee*ie)/Te,u=Qn(u-C,-Math.PI,Math.PI),g=Qn(g-S,-dg,dg)}while((Math.abs(C)>y||Math.abs(S)>y)&&--p>0);return new Ri(Po(u),Po(g))}}class bS extends ph{constructor(o){super(o),this.center=o.center||[0,0],this.parallels=o.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(yi(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(o,a){const{scale:u,cosPhi:g}=this;return{x:yi(o)*g*u+.5,y:-Math.sin(yi(a))/g*u+.5,z:0}}unproject(o,a){const{scale:u,cosPhi:g}=this,p=-(a-.5)/u,y=Qn(Po((o-.5)/u)/g,-180,180),C=Math.asin(Qn(p*g,-1,1)),S=Qn(Po(C),-br,br);return new Ri(y,S)}}class VI extends Mw{constructor(o){super(o),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(o,a,u){const g=Oi(o,a,u),p=vr(_o(u));return ge.vec3.transformMat4(g,g,p),{x:g[0],y:g[1],z:g[2]}}locationPoint(o,a,u){const g=su(a.lat,a.lng),p=ge.vec3.normalize([],g),y=u?o._centerAltitude+u:o.elevation?o.elevation.getAtPointOrZero(o.locationCoordinate(a),o._centerAltitude):o._centerAltitude,C=Co(1,0)*kt*y;ge.vec3.scaleAndAdd(g,g,p,C);const S=ge.mat4.identity(new Float64Array(16));return ge.mat4.multiply(S,o.pixelMatrix,o.globeMatrix),ge.vec3.transformMat4(g,g,S),new Ot(g[0],g[1])}pixelsPerMeter(o,a){return Co(1,0)*a}pixelSpaceConversion(o,a,u){const g=Co(1,o)*a,p=_n(Co(1,45)*a,g,u);return this.pixelsPerMeter(o,a)/p}createTileMatrix(o,a,u){const g=Gr(_o(u.canonical));return ge.mat4.multiply(new Float64Array(16),o.globeMatrix,g)}createInversionMatrix(o,a){const{center:u}=o,g=vr(_o(a));return ge.mat4.rotateY(g,g,yi(u.lng)),ge.mat4.rotateX(g,g,yi(u.lat)),ge.mat4.scale(g,g,[o._pixelsPerMercatorPixel,o._pixelsPerMercatorPixel,1]),Float32Array.from(g)}pointCoordinate(o,a,u,g){return Ei(o,a,u,!0)||new s(0,0)}pointCoordinate3D(o,a,u){const g=this.pointCoordinate(o,a,u,0);return[g.x,g.y,g.z]}isPointAboveHorizon(o,a){return!Ei(o,a.x,a.y,!1)}farthestPixelDistance(o){const a=function(g,p){const y=g.cameraToCenterDistance,C=g._centerAltitude*p,S=g._camera,I=g._camera.forward(),b=ge.vec3.add([],ge.vec3.scale([],I,-y),[0,0,C]),D=g.worldSize/(2*Math.PI),k=[0,0,-D],T=g.width/g.height,A=Math.tan(g.fovAboveCenter),O=ge.vec3.scale([],S.up(),A),B=ge.vec3.scale([],S.right(),A*T),V=ge.vec3.normalize([],ge.vec3.add([],ge.vec3.add([],I,O),B)),q=[];let G;if(new vn(b,V).closestPointOnSphere(k,D,q)){const H=ge.vec3.add([],q,k),Z=ge.vec3.sub([],H,b);G=Math.cos(g.fovAboveCenter)*ge.vec3.length(Z)}else{const H=ge.vec3.sub([],b,k),Z=ge.vec3.sub([],k,b);ge.vec3.normalize(Z,Z);const ee=ge.vec3.length(H)-D;G=Math.sqrt(ee*(ee+2*D));const ie=Math.acos(G/(D+ee))-Math.acos(ge.vec3.dot(I,Z));G*=Math.cos(ie)}return 1.01*G}(o,this.pixelsPerMeter(o.center.lat,o.worldSize)),u=js(o.zoom);if(u>0){const g=yS(o,Co(1,o.center.lat)*o.worldSize),p=o.worldSize/(2*Math.PI),y=Math.max(o.width,o.height)/o.worldSize*Math.PI;return _n(a,g+p*(1-Math.cos(y)),Math.pow(u,10))}return a}upVector(o,a,u){return Oi(a,u,o,1)}upVectorScale(o){return{metersToTile:gi($i(_o(o)))}}}function Tw(d){const o=d.parallels,a=!!o&&Math.abs(o[0]+o[1])<.01;switch(d.name){case"mercator":return new Mw(d);case"equirectangular":return new LI(d);case"naturalEarth":return new pO(d);case"equalEarth":return new vS(d);case"winkelTripel":return new BI(d);case"albers":return a?new bS(d):new Dw(d);case"lambertConformalConic":return a?new bS(d):new NI(d);case"globe":return new VI(d)}throw new Error(`Invalid projection name: ${d.name}`)}const UI=dp.VectorTileFeature.types,jI=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Db(d,o,a,u,g,p,y,C,S,I,b,D,k){const T=C?Math.min(yp,Math.round(C[0])):0,A=C?Math.min(yp,Math.round(C[1])):0;d.emplaceBack(o,a,Math.round(32*u),Math.round(32*g),p,y,(T<<1)+(S?1:0),A,16*I,16*b,256*D,256*k)}function Mb(d,o,a){d.emplaceBack(o,a)}function Tb(d,o,a,u,g,p,y){d.emplaceBack(o,a,u,g,p,y)}function Ib(d,o,a,u,g){d.emplaceBack(o,a,u,g),d.emplaceBack(o,a,u,g),d.emplaceBack(o,a,u,g),d.emplaceBack(o,a,u,g)}function Iw(d){for(const o of d.sections)if(Cx(o.text))return!0;return!1}class xS{constructor(o){this.layoutVertexArray=new Lm,this.indexArray=new Vo,this.programConfigurations=o,this.segments=new hr,this.dynamicLayoutVertexArray=new Is,this.opacityVertexArray=new yf,this.placedSymbolArray=new jm,this.iconTransitioningVertexArray=new Ec,this.globeExtVertexArray=new th,this.zOffsetVertexArray=new eh}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length&&0===this.iconTransitioningVertexArray.length}upload(o,a,u,g,p){this.isEmpty()||(u&&(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,EI.members),this.indexBuffer=o.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=o.createVertexBuffer(this.dynamicLayoutVertexArray,JE.members,!0),this.opacityVertexBuffer=o.createVertexBuffer(this.opacityVertexArray,jI,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=o.createVertexBuffer(this.iconTransitioningVertexArray,DI.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,SI.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||p)&&(this.zOffsetVertexBuffer=o.createVertexBuffer(this.zOffsetVertexArray,eS.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||g)&&this.programConfigurations.upload(o))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Zt(xS,"SymbolBuffers");class wS{constructor(o,a,u){this.layoutVertexArray=new o,this.layoutAttributes=a,this.indexArray=new u,this.segments=new hr,this.collisionVertexArray=new Bm,this.collisionVertexArrayExt=new Is}upload(o){this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=o.createVertexBuffer(this.collisionVertexArray,MI.members,!0),this.collisionVertexBufferExt=o.createVertexBuffer(this.collisionVertexArrayExt,Y_.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Zt(wS,"CollisionBuffers");class ug{constructor(o){this.collisionBoxArray=o.collisionBoxArray,this.zoom=o.zoom,this.lut=o.lut,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(y=>y.fqid),this.index=o.index,this.pixelRatio=o.pixelRatio,this.sourceLayerIndex=o.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ge.mat4.identity([]),this.placementViewportMatrix=ge.mat4.identity([]);const a=this.layers[0]._unevaluatedLayout._values;this.textSizeData=tS(this.zoom,a["text-size"]),this.iconSizeData=tS(this.zoom,a["icon-size"]);const u=this.layers[0].layout,g=u.get("symbol-sort-key"),p=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==p&&void 0!==g.constantOr(1),this.sortFeaturesByY=("viewport-y"===p||"auto"===p&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(y=>Ka[y]),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=o.sourceID,this.projection=o.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new xS(new pd(this.layers,{zoom:this.zoom,lut:this.lut},o=>o.startsWith("text")||o.startsWith("symbol"))),this.icon=new xS(new pd(this.layers,{zoom:this.zoom,lut:this.lut},o=>o.startsWith("icon")||o.startsWith("symbol"))),this.glyphOffsetArray=new b_,this.lineVertexArray=new rp,this.symbolInstances=new v_}calculateGlyphDependencies(o,a,u,g,p){for(const y of o){const C=y.codePointAt(0);if(void 0===C)break;if(a[C]=!0,g&&p&&C<=65535){const S=uh[y];S&&(a[S.charCodeAt(0)]=!0)}}}updateFootprints(o,a){}updateReplacement(o,a){if(a.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=a.updateTime;const u=a.getReplacementRegionsForTile(o.toUnwrapped(),!0);return!Hx(this.activeReplacements,u)&&(this.activeReplacements=u,!0)}populate(o,a,u,g){const p=this.layers[0],y=p.layout,C="globe"===this.projection.name,S=y.get("text-font"),I=y.get("text-field"),b=y.get("icon-image"),[D,k]=y.get("icon-size-scale-range"),T=Qn(a.scaleFactor||1,D,k),A=("constant"!==I.value.kind||I.value.value instanceof Ko&&!I.value.value.isEmpty()||I.value.value.toString().length>0)&&("constant"!==S.value.kind||S.value.value.length>0),O="constant"!==b.value.kind||!!b.value.value||Object.keys(b.parameters).length>0,B=y.get("symbol-sort-key");if(this.features=[],!A&&!O)return;const V=a.iconDependencies,q=a.glyphDependencies,G=a.availableImages,H=new sr(this.zoom);for(const{feature:Z,id:ee,index:ie,sourceLayerIndex:me}of o){const ue=p._featureFilter.needGeometry,pe=z(Z,ue);if(!p._featureFilter.filter(H,pe,u))continue;if(ue||(pe.geometry=N(Z,u,g)),C&&1!==Z.type&&u.z<=5){const Fe=pe.geometry,Ve=.98078528056,ze=(We,Ue)=>{const Ze=Oi(We.x,We.y,u,1),ht=Oi(Ue.x,Ue.y,u,1);return ge.vec3.dot(Ze,ht)<Ve};for(let We=0;We<Fe.length;We++)Fe[We]=x(Fe[We],ze)}let Te,_e;if(A){const Fe=p.getValueAndResolveTokens("text-field",pe,u,G),Ve=Ko.factory(Fe);Iw(Ve)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===pf()||this.hasRTLText&&ml.isParsed())&&(Te=sw(Ve,p,pe))}if(O){const Fe=p.getValueAndResolveTokens("icon-image",pe,u,G);_e=Fe instanceof ds?Fe:ds.build(Fe)}if(!Te&&!_e)continue;const Ie=this.sortFeaturesByKey?B.evaluate(pe,{},u):void 0,Le={id:ee,text:Te,icon:_e,index:ie,sourceLayerIndex:me,geometry:pe.geometry,properties:Z.properties,type:UI[Z.type],sortKey:Ie};if(this.features.push(Le),_e){const Fe=this.layers[0]._unevaluatedLayout._values,{iconPrimary:Ve,iconSecondary:ze}=OI(_e,this.iconSizeData,Fe["icon-size"],u,this.zoom,Le,this.pixelRatio,T),We=Ve.id.toString();if(V.has(We)?V.get(We).push(Ve):V.set(We,[Ve]),ze){const Ue=ze.id.toString();V.has(Ue)?V.get(Ue).push(ze):V.set(Ue,[ze])}}if(Te){const Fe=S.evaluate(pe,{},u).join(","),Ve="map"===y.get("text-rotation-alignment")&&"point"!==y.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ka.vertical)>=0;for(const ze of Te.sections)if(ze.image){const We=ze.image.getPrimary().scaleSelf(this.pixelRatio),Ue=We.id.toString(),Ze=V.get(Ue)||[];Ze.push(We),V.set(Ue,Ze)}else{const We=Iv(Te.toString()),Ue=ze.fontStack||Fe,Ze=q[Ue]=q[Ue]||{};this.calculateGlyphDependencies(ze.text,Ze,Ve,this.allowVerticalPlacement,We)}}}if("line"===y.get("symbol-placement")&&(this.features=function(Z){const ee={},ie={},me=[];let ue=0;function pe(Le){me.push(Z[Le]),ue++}function Te(Le,Fe,Ve){const ze=ie[Le];return delete ie[Le],ie[Fe]=ze,me[ze].geometry[0].pop(),me[ze].geometry[0]=me[ze].geometry[0].concat(Ve[0]),ze}function _e(Le,Fe,Ve){const ze=ee[Fe];return delete ee[Fe],ee[Le]=ze,me[ze].geometry[0].shift(),me[ze].geometry[0]=Ve[0].concat(me[ze].geometry[0]),ze}function Ie(Le,Fe,Ve){const ze=Ve?Fe[0][Fe[0].length-1]:Fe[0][0];return`${Le}:${ze.x}:${ze.y}`}for(let Le=0;Le<Z.length;Le++){const Fe=Z[Le],Ve=Fe.geometry,ze=Fe.text?Fe.text.toString():null;if(!ze){pe(Le);continue}const We=Ie(ze,Ve),Ue=Ie(ze,Ve,!0);if(We in ie&&Ue in ee&&ie[We]!==ee[Ue]){const Ze=_e(We,Ue,Ve),ht=Te(We,Ue,me[Ze].geometry);delete ee[We],delete ie[Ue],ie[Ie(ze,me[ht].geometry,!0)]=ht,me[Ze].geometry=null}else We in ie?Te(We,Ue,Ve):Ue in ee?_e(We,Ue,Ve):(pe(Le),ee[We]=ue-1,ie[Ue]=ue-1)}return me.filter(Le=>Le.geometry)}(this.features)),"hd-road-markup"===y.get("symbol-elevation-reference")){if(this.elevationType="road",a.elevationFeatures){!this.elevationFeatures&&a.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Z of a.elevationFeatures)this.elevationFeatureIdToIndex.set(Z.id,this.elevationFeatures.length),this.elevationFeatures.push(Z)}}else y.get("symbol-z-elevate")&&(this.elevationType="offset");"none"!==this.elevationType&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((Z,ee)=>Z.sortKey-ee.sortKey)}update(o,a,u,g,p,y,C){this.text.programConfigurations.updatePaintArrays(o,a,p,u,g,y,C),this.icon.programConfigurations.updatePaintArrays(o,a,p,u,g,y,C)}updateRoadElevation(){if("road"!==this.elevationType||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let o=!1;for(let a=0;a<this.symbolInstances.length;a++){const u=this.symbolInstances.get(a);if(65535===u.elevationFeatureIndex)continue;const g=this.elevationFeatures[u.elevationFeatureIndex];if(g){const p=.05+g.pointElevation(new Ot(u.tileAnchorX,u.tileAnchorY));u.zOffset!==p&&(o=!0,u.zOffset=p)}}o&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const o=(p,y,C)=>{u+=y,u>p.length&&p.resize(u);for(let S=-y;S<0;S++)p.emplace(S+u,C)},a=(p,y,C)=>{g+=y,g>p.length&&p.resize(g);for(let S=-y;S<0;S++)p.emplace(S+g,C)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let u=0,g=0;for(let p=0;p<this.symbolInstances.length;p++){const y=this.symbolInstances.get(p),{numHorizontalGlyphVertices:C,numVerticalGlyphVertices:S,numIconVertices:I}=y,b=y.zOffset,D=I>0;if((C>0||S>0)&&(o(this.text.zOffsetVertexArray,C,b),o(this.text.zOffsetVertexArray,S,b)),D){const{placedIconSymbolIndex:k,verticalPlacedIconSymbolIndex:T}=y;k>=0&&a(this.icon.zOffsetVertexArray,I,b),T>=0&&a(this.icon.zOffsetVertexArray,y.numVerticalIconVertices,b)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(o){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(o),this.iconCollisionBox.upload(o)),this.text.upload(o,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(o,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Tw(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(o,a){const u=this.lineVertexArray.length;if(void 0!==o.segment)for(const{x:g,y:p}of a)this.lineVertexArray.emplaceBack(g,p);return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(o,a,u,g,p,y,C,S,I,b,D,k,T,A,O,B){const V=o.indexArray,q=o.layoutVertexArray,G=o.globeExtVertexArray,H=o.segments.prepareSegment(4*a.length,q,V,this.canOverlap?y.sortKey:void 0),Z=this.glyphOffsetArray.length,ee=H.vertexLength,ie=this.allowVerticalPlacement&&C===Ka.vertical?Math.PI/2:0,me=y.text&&y.text.sections;for(let pe=0;pe<a.length;pe++){const{tl:Te,tr:_e,bl:Ie,br:Le,texPrimary:Fe,texSecondary:Ve,pixelOffsetTL:ze,pixelOffsetBR:We,minFontScaleX:Ue,minFontScaleY:Ze,glyphOffset:ht,isSDF:ut,sectionIndex:qt}=a[pe],gt=H.vertexLength,yt=ht[1];if(Db(q,I.x,I.y,Te.x,yt+Te.y,Fe.x,Fe.y,u,ut,ze.x,ze.y,Ue,Ze),Db(q,I.x,I.y,_e.x,yt+_e.y,Fe.x+Fe.w,Fe.y,u,ut,We.x,ze.y,Ue,Ze),Db(q,I.x,I.y,Ie.x,yt+Ie.y,Fe.x,Fe.y+Fe.h,u,ut,ze.x,We.y,Ue,Ze),Db(q,I.x,I.y,Le.x,yt+Le.y,Fe.x+Fe.w,Fe.y+Fe.h,u,ut,We.x,We.y,Ue,Ze),S){const{x:pt,y:fn,z:Ut}=S.anchor,[Jt,xn,Bn]=S.up;Tb(G,pt,fn,Ut,Jt,xn,Bn),Tb(G,pt,fn,Ut,Jt,xn,Bn),Tb(G,pt,fn,Ut,Jt,xn,Bn),Tb(G,pt,fn,Ut,Jt,xn,Bn),Ib(o.dynamicLayoutVertexArray,pt,fn,Ut,ie)}else Ib(o.dynamicLayoutVertexArray,I.x,I.y,I.z,ie);if(B){const pt=Ve||Fe;Mb(o.iconTransitioningVertexArray,pt.x,pt.y),Mb(o.iconTransitioningVertexArray,pt.x+pt.w,pt.y),Mb(o.iconTransitioningVertexArray,pt.x,pt.y+pt.h),Mb(o.iconTransitioningVertexArray,pt.x+pt.w,pt.y+pt.h)}V.emplaceBack(gt,gt+1,gt+2),V.emplaceBack(gt+1,gt+2,gt+3),H.vertexLength+=4,H.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ht[0]),pe!==a.length-1&&qt===a[pe+1].sectionIndex||o.programConfigurations.populatePaintArrays(q.length,y,y.index,{},T,A,O,me&&me[qt])}const ue=S?S.anchor:I;o.placedSymbolArray.emplaceBack(ue.x,ue.y,ue.z,I.x,I.y,Z,this.glyphOffsetArray.length-Z,ee,b,D,I.segment,u?u[0]:0,u?u[1]:0,g[0],g[1],C,0,!1,0,k,0)}_commitLayoutVertex(o,a,u,g,p,y,C){o.emplaceBack(a,u,g,p,y,Math.round(C.x),Math.round(C.y))}_addCollisionDebugVertices(o,a,u,g,p,y,C){const S=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),I=S.vertexLength,b=C.tileAnchorX,D=C.tileAnchorY;for(let T=0;T<4;T++)u.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(u.collisionVertexArrayExt,a,o.padding,C.zOffset),this._commitLayoutVertex(u.layoutVertexArray,g,p,y,b,D,new Ot(o.x1,o.y1)),this._commitLayoutVertex(u.layoutVertexArray,g,p,y,b,D,new Ot(o.x2,o.y1)),this._commitLayoutVertex(u.layoutVertexArray,g,p,y,b,D,new Ot(o.x2,o.y2)),this._commitLayoutVertex(u.layoutVertexArray,g,p,y,b,D,new Ot(o.x1,o.y2)),S.vertexLength+=4;const k=u.indexArray;k.emplaceBack(I,I+1),k.emplaceBack(I+1,I+2),k.emplaceBack(I+2,I+3),k.emplaceBack(I+3,I),S.primitiveLength+=4}_addTextDebugCollisionBoxes(o,a,u,g,p,y){for(let C=g;C<p;C++){const S=u.get(C),I=this.getSymbolInstanceTextSize(o,y,a,C);this._addCollisionDebugVertices(S,I,this.textCollisionBox,S.projectedAnchorX,S.projectedAnchorY,S.projectedAnchorZ,y)}}_addIconDebugCollisionBoxes(o,a,u,g,p,y){for(let C=g;C<p;C++){const S=u.get(C),I=this.getSymbolInstanceIconSize(o,a,y.placedIconSymbolIndex);this._addCollisionDebugVertices(S,I,this.iconCollisionBox,S.projectedAnchorX,S.projectedAnchorY,S.projectedAnchorZ,y)}}generateCollisionDebugBuffers(o,a,u){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new wS(zm,rw.members,Ec),this.iconCollisionBox=new wS(zm,rw.members,Ec);const g=og(this.iconSizeData,o),p=og(this.textSizeData,o,u);for(let y=0;y<this.symbolInstances.length;y++){const C=this.symbolInstances.get(y);this._addTextDebugCollisionBoxes(p,o,a,C.textBoxStartIndex,C.textBoxEndIndex,C),this._addTextDebugCollisionBoxes(p,o,a,C.verticalTextBoxStartIndex,C.verticalTextBoxEndIndex,C),this._addIconDebugCollisionBoxes(g,o,a,C.iconBoxStartIndex,C.iconBoxEndIndex,C),this._addIconDebugCollisionBoxes(g,o,a,C.verticalIconBoxStartIndex,C.verticalIconBoxEndIndex,C)}}getSymbolInstanceTextSize(o,a,u,g){const p=this.text.placedSymbolArray.get(a.rightJustifiedTextSymbolIndex>=0?a.rightJustifiedTextSymbolIndex:a.centerJustifiedTextSymbolIndex>=0?a.centerJustifiedTextSymbolIndex:a.leftJustifiedTextSymbolIndex>=0?a.leftJustifiedTextSymbolIndex:a.verticalPlacedTextSymbolIndex>=0?a.verticalPlacedTextSymbolIndex:g),y=fp(this.textSizeData,o,p)/24;return this.tilePixelRatio*y}getSymbolInstanceIconSize(o,a,u){const g=this.icon.placedSymbolArray.get(u),p=fp(this.iconSizeData,o,g);return this.tilePixelRatio*p}_commitDebugCollisionVertexUpdate(o,a,u,g){o.emplaceBack(a,-u,-u,g),o.emplaceBack(a,u,-u,g),o.emplaceBack(a,u,u,g),o.emplaceBack(a,-u,u,g)}_updateTextDebugCollisionBoxes(o,a,u,g,p,y,C){for(let S=g;S<p;S++){const I=u.get(S),b=this.getSymbolInstanceTextSize(o,y,a,S);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,b,I.padding,y.zOffset)}}_updateIconDebugCollisionBoxes(o,a,u,g,p,y,C){for(let S=g;S<p;S++){const I=u.get(S),b=this.getSymbolInstanceIconSize(o,a,y.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,b,I.padding,y.zOffset)}}updateCollisionDebugBuffers(o,a,u,g){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const p=og(this.iconSizeData,o,g),y=og(this.textSizeData,o,u);for(let C=0;C<this.symbolInstances.length;C++){const S=this.symbolInstances.get(C);this._updateTextDebugCollisionBoxes(y,o,a,S.textBoxStartIndex,S.textBoxEndIndex,S,u),this._updateTextDebugCollisionBoxes(y,o,a,S.verticalTextBoxStartIndex,S.verticalTextBoxEndIndex,S,u),this._updateIconDebugCollisionBoxes(p,o,a,S.iconBoxStartIndex,S.iconBoxEndIndex,S,g),this._updateIconDebugCollisionBoxes(p,o,a,S.verticalIconBoxStartIndex,S.verticalIconBoxEndIndex,S,g)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(o,a,u,g,p,y,C,S,I){const b={};if(a<u){const{x1:D,y1:k,x2:T,y2:A,padding:O,projectedAnchorX:B,projectedAnchorY:V,projectedAnchorZ:q,tileAnchorX:G,tileAnchorY:H,featureIndex:Z}=o.get(a);b.textBox={x1:D,y1:k,x2:T,y2:A,padding:O,projectedAnchorX:B,projectedAnchorY:V,projectedAnchorZ:q,tileAnchorX:G,tileAnchorY:H},b.textFeatureIndex=Z}if(g<p){const{x1:D,y1:k,x2:T,y2:A,padding:O,projectedAnchorX:B,projectedAnchorY:V,projectedAnchorZ:q,tileAnchorX:G,tileAnchorY:H,featureIndex:Z}=o.get(g);b.verticalTextBox={x1:D,y1:k,x2:T,y2:A,padding:O,projectedAnchorX:B,projectedAnchorY:V,projectedAnchorZ:q,tileAnchorX:G,tileAnchorY:H},b.verticalTextFeatureIndex=Z}if(y<C){const{x1:D,y1:k,x2:T,y2:A,padding:O,projectedAnchorX:B,projectedAnchorY:V,projectedAnchorZ:q,tileAnchorX:G,tileAnchorY:H,featureIndex:Z}=o.get(y);b.iconBox={x1:D,y1:k,x2:T,y2:A,padding:O,projectedAnchorX:B,projectedAnchorY:V,projectedAnchorZ:q,tileAnchorX:G,tileAnchorY:H},b.iconFeatureIndex=Z}if(S<I){const{x1:D,y1:k,x2:T,y2:A,padding:O,projectedAnchorX:B,projectedAnchorY:V,projectedAnchorZ:q,tileAnchorX:G,tileAnchorY:H,featureIndex:Z}=o.get(S);b.verticalIconBox={x1:D,y1:k,x2:T,y2:A,padding:O,projectedAnchorX:B,projectedAnchorY:V,projectedAnchorZ:q,tileAnchorX:G,tileAnchorY:H},b.verticalIconFeatureIndex=Z}return b}deserializeCollisionBoxes(o){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){const u=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(o,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(o,a){const u=o.placedSymbolArray.get(a),g=u.vertexStartIndex+4*u.numGlyphs;for(let p=u.vertexStartIndex;p<g;p+=4)o.indexArray.emplaceBack(p,p+1,p+2),o.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(o){if(this.sortedAngle===o&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const a=Math.sin(o),u=Math.cos(o),g=[],p=[],y=[];for(let C=0;C<this.symbolInstances.length;++C){y.push(C);const S=this.symbolInstances.get(C);g.push(0|Math.round(a*S.tileAnchorX+u*S.tileAnchorY)),p.push(S.featureIndex)}return y.sort((C,S)=>g[C]-g[S]||p[S]-p[C]),y}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let o=0;o<this.symbolInstances.length;++o)this.symbolInstanceIndexesSortedZOffset.push(o)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((o,a)=>this.symbolInstances.get(a).zOffset-this.symbolInstances.get(o).zOffset)}addToSortKeyRanges(o,a){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===a?u.symbolInstanceEnd=o+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:o,symbolInstanceEnd:o+1})}sortFeatures(o){if(this.sortFeaturesByY&&this.sortedAngle!==o&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(o),this.sortedAngle=o,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const a of this.symbolInstanceIndexes){const u=this.symbolInstances.get(a);this.featureSortOrder.push(u.featureIndex);const{rightJustifiedTextSymbolIndex:g,centerJustifiedTextSymbolIndex:p,leftJustifiedTextSymbolIndex:y,verticalPlacedTextSymbolIndex:C,placedIconSymbolIndex:S,verticalPlacedIconSymbolIndex:I}=u;g>=0&&this.addIndicesForPlacedSymbol(this.text,g),p>=0&&p!==g&&this.addIndicesForPlacedSymbol(this.text,p),y>=0&&y!==p&&y!==g&&this.addIndicesForPlacedSymbol(this.text,y),C>=0&&this.addIndicesForPlacedSymbol(this.text,C),S>=0&&this.addIndicesForPlacedSymbol(this.icon,S),I>=0&&this.addIndicesForPlacedSymbol(this.icon,I)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let HI,$I,CS;Zt(ug,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),ug.addDynamicAttributes=Ib;class GI{constructor(o){this.type=o.property.overrides?o.property.overrides.runtimeType:Xp,this.defaultValue=o}evaluate(o){if(o.formattedSection){const a=this.defaultValue.property.overrides;if(a&&a.hasOverride(o.formattedSection))return a.getOverride(o.formattedSection)}return o.feature&&o.featureState?this.defaultValue.evaluate(o.feature,o.featureState):this.defaultValue.property.specification.default}eachChild(o){this.defaultValue.isConstant()||o(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Zt(GI,"FormatSectionOverride",{omit:["defaultValue"]});const ES=()=>CS||(CS={layout:HI||(HI=new Br({"symbol-placement":new Mt(Ye.layout_symbol["symbol-placement"]),"symbol-spacing":new Mt(Ye.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Mt(Ye.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Vt(Ye.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Mt(Ye.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Mt(Ye.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Mt(Ye.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Mt(Ye.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Mt(Ye.layout_symbol["icon-ignore-placement"]),"icon-optional":new Mt(Ye.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Mt(Ye.layout_symbol["icon-rotation-alignment"]),"icon-size":new Vt(Ye.layout_symbol["icon-size"]),"icon-size-scale-range":new Mt(Ye.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Vt(Ye.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Vt(Ye.layout_symbol["icon-text-fit-padding"]),"icon-image":new Vt(Ye.layout_symbol["icon-image"]),"icon-rotate":new Vt(Ye.layout_symbol["icon-rotate"]),"icon-padding":new Mt(Ye.layout_symbol["icon-padding"]),"icon-keep-upright":new Mt(Ye.layout_symbol["icon-keep-upright"]),"icon-offset":new Vt(Ye.layout_symbol["icon-offset"]),"icon-anchor":new Vt(Ye.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Mt(Ye.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Mt(Ye.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Mt(Ye.layout_symbol["text-rotation-alignment"]),"text-field":new Vt(Ye.layout_symbol["text-field"]),"text-font":new Vt(Ye.layout_symbol["text-font"]),"text-size":new Vt(Ye.layout_symbol["text-size"]),"text-size-scale-range":new Mt(Ye.layout_symbol["text-size-scale-range"]),"text-max-width":new Vt(Ye.layout_symbol["text-max-width"]),"text-line-height":new Vt(Ye.layout_symbol["text-line-height"]),"text-letter-spacing":new Vt(Ye.layout_symbol["text-letter-spacing"]),"text-justify":new Vt(Ye.layout_symbol["text-justify"]),"text-radial-offset":new Vt(Ye.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Mt(Ye.layout_symbol["text-variable-anchor"]),"text-anchor":new Vt(Ye.layout_symbol["text-anchor"]),"text-max-angle":new Mt(Ye.layout_symbol["text-max-angle"]),"text-writing-mode":new Mt(Ye.layout_symbol["text-writing-mode"]),"text-rotate":new Vt(Ye.layout_symbol["text-rotate"]),"text-padding":new Mt(Ye.layout_symbol["text-padding"]),"text-keep-upright":new Mt(Ye.layout_symbol["text-keep-upright"]),"text-transform":new Vt(Ye.layout_symbol["text-transform"]),"text-offset":new Vt(Ye.layout_symbol["text-offset"]),"text-allow-overlap":new Mt(Ye.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Mt(Ye.layout_symbol["text-ignore-placement"]),"text-optional":new Mt(Ye.layout_symbol["text-optional"]),visibility:new Mt(Ye.layout_symbol.visibility)})),paint:$I||($I=new Br({"icon-opacity":new Vt(Ye.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Vt(Ye.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Vt(Ye.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Vt(Ye.paint_symbol["text-emissive-strength"]),"icon-color":new Vt(Ye.paint_symbol["icon-color"]),"icon-halo-color":new Vt(Ye.paint_symbol["icon-halo-color"]),"icon-halo-width":new Vt(Ye.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Vt(Ye.paint_symbol["icon-halo-blur"]),"icon-translate":new Mt(Ye.paint_symbol["icon-translate"]),"icon-translate-anchor":new Mt(Ye.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Vt(Ye.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Vt(Ye.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Vt(Ye.paint_symbol["text-occlusion-opacity"]),"text-color":new Vt(Ye.paint_symbol["text-color"],{runtimeType:Ns,getOverride:d=>d.textColor,hasOverride:d=>!!d.textColor}),"text-halo-color":new Vt(Ye.paint_symbol["text-halo-color"]),"text-halo-width":new Vt(Ye.paint_symbol["text-halo-width"]),"text-halo-blur":new Vt(Ye.paint_symbol["text-halo-blur"]),"text-translate":new Mt(Ye.paint_symbol["text-translate"]),"text-translate-anchor":new Mt(Ye.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Mt(Ye.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Mt(Ye.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Mt(Ye.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Mt(Ye.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Vt(Ye.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"})}))},CS);class Ab extends go{constructor(o,a,u,g){super(o,ES(),a,u,g),this._colorAdjustmentMatrix=ge.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=void 0!==o.paint&&("icon-occlusion-opacity"in o.paint||"text-occlusion-opacity"in o.paint)}recalculate(o,a){super.recalculate(o,a),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const g=[];for(const p of u)g.indexOf(p)<0&&g.push(p);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(o,a,u,g){return this._saturation===o&&this._contrast===a&&this._brightnessMin===u&&this._brightnessMax===g||(this._colorAdjustmentMatrix=function(p,y,C,S){p=it(p),y=ku(y);const I=ge.mat4.create(),b=p/3,D=1-2*b,k=[D,b,b,0,b,D,b,0,b,b,D,0,0,0,0,1],T=.5-.5*y,A=S-C;return ge.mat4.multiply(I,[A,0,0,0,0,A,0,0,0,0,A,0,C,C,C,1],[y,0,0,0,0,y,0,0,0,0,y,0,T,T,T,1]),ge.mat4.multiply(I,I,k),I}(o,a,u,g),this._saturation=o,this._contrast=a,this._brightnessMin=u,this._brightnessMax=g),this._colorAdjustmentMatrix}getValueAndResolveTokens(o,a,u,g){const p=this.layout.get(o).evaluate(a,{},u,g),y=this._unevaluatedLayout._values[o];return y.isDataDriven()||Va(y.value)||!p?p:(C=a.properties,p.replace(/{([^{}]+)}/g,(I,b)=>b in C?String(C[b]):""));var C}createBucket(o){return new ug(o)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const o of ES().paint.overridableProperties){if(!Ab.hasPaintOverride(this.layout,o))continue;const a=this.paint.get(o),u=new GI(a),g=new Ba(u,a.property.specification,this.scope,this.options);let p=null;p="constant"===a.value.kind||"source"===a.value.kind?new Qd("source",g):new zr("composite",g,a.value.zoomStops,a.value._interpolationType),this.paint._values[o]=new Ku(a.property,p,a.parameters)}}_handleOverridablePaintPropertyUpdate(o,a,u){return!(!this.layout||a.isDataDriven()||u.isDataDriven())&&Ab.hasPaintOverride(this.layout,o)}static hasPaintOverride(o,a){const u=o.get("text-field"),g=ES().paint.properties[a];let p=!1;const y=C=>{for(const S of C)if(g.overrides&&g.overrides.hasOverride(S))return void(p=!0)};if("constant"===u.value.kind&&u.value.value instanceof Ko)y(u.value.value.sections);else if("source"===u.value.kind){const C=I=>{p||(I instanceof Hd&&Yr(I.value)===jd?y(I.value.sections):I instanceof $d?y(I.sections):I.eachChild(C))},S=u.value;S._styleExpression&&C(S._styleExpression.expression)}return p}getProgramIds(){return["symbol"]}getDefaultProgramParams(o,a,u){return{config:new bl(this,{zoom:a,lut:u}),overrideFog:!1}}}let ay,ly,Aw,kw;var kb=ki([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function Rw(d){switch(d){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function Pw(d){switch(d){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class Rb{constructor(o,a,u,g){this.context=o,this.format=u,this.useMipmap=g&&g.useMipmap,this.texture=o.gl.createTexture(),this.update(a,{premultiply:g&&g.premultiply})}update(o,a){const u=o&&o instanceof HTMLVideoElement&&0===o.width?o.videoWidth:o.width,g=o&&o instanceof HTMLVideoElement&&0===o.height?o.videoHeight:o.height,{context:p}=this,{gl:y}=p,{x:C,y:S}=a&&a.position?a.position:{x:0,y:0},I=C+u,b=S+g;!this.size||this.size[0]===I&&this.size[1]===b||(y.bindTexture(y.TEXTURE_2D,null),y.deleteTexture(this.texture),this.texture=y.createTexture(),this.size=null),y.bindTexture(y.TEXTURE_2D,this.texture),p.pixelStoreUnpackFlipY.set(!1),p.pixelStoreUnpack.set(1),p.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA8&&(!a||!1!==a.premultiply));const D=o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||ImageBitmap&&o instanceof ImageBitmap;if(!this.size&&I>0&&b>0){const k=this.useMipmap?Math.floor(Math.log2(Math.max(I,b)))+1:1;y.texStorage2D(y.TEXTURE_2D,k,this.format,I,b),this.size=[I,b]}if(this.size)if(D)y.texSubImage2D(y.TEXTURE_2D,0,C,S,Rw(this.format),Pw(this.format),o);else{const k=o.data;k&&y.texSubImage2D(y.TEXTURE_2D,0,C,S,u,g,Rw(this.format),Pw(this.format),k)}this.useMipmap&&y.generateMipmap(y.TEXTURE_2D)}bind(o,a,u=!1){const{context:g}=this,{gl:p}=g;p.bindTexture(p.TEXTURE_2D,this.texture),o!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,o),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap&&!u?o===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_LINEAR:o),this.minFilter=o),a!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,a),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,a),this.wrapS=a)}bindExtraParam(o,a,u,g){const{context:p}=this,{gl:y}=p;y.bindTexture(y.TEXTURE_2D,this.texture),a!==this.magFilter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,a),this.magFilter=a),o!==this.minFilter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,this.useMipmap?o===y.NEAREST?y.NEAREST_MIPMAP_NEAREST:y.LINEAR_MIPMAP_LINEAR:o),this.minFilter=o),u!==this.wrapS&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,u),this.wrapS=u),g!==this.wrapT&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,g),this.wrapT=g)}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}class fh{constructor(o,a){this.context=o,this.texture=a}bind(o,a){const{context:u}=this,{gl:g}=u;g.bindTexture(g.TEXTURE_2D,this.texture),o!==this.minFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,o),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,o),this.minFilter=o),a!==this.wrapS&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,a),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,a),this.wrapS=a)}}function ec(d,o,a,u,g,p,y,C){const S=[d,o,1,a,u,1,g,p,1],I=[y,C,1],b=ge.mat3.adjoint([],S),[D,k,T]=ge.vec3.transformMat3(I,I,b);return ge.mat3.multiply(S,S,[D,0,0,0,k,0,0,0,T])}function Ow(d,o,a,u,g,p,y,C){const S=function(I,b,D,k,T,A,O,B){const V=ec(0,0,1,0,1,1,0,1),q=ec(I,b,D,k,T,A,O,B),G=ge.mat3.adjoint([],V);return ge.mat3.multiply(q,q,G)}(d,o,a,u,g,p,y,C);return[S[2]/S[8]/kt,S[5]/S[8]/kt]}function Fw(d){return[d[0],Math.min(Math.max(d[1],-br),br)]}class SS extends po{constructor(o,a,u,g){super(),this.id=o,this.dispatcher=u,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(g),this.options=a,this._dirty=!1}load(o,a){if(this._loaded=a||!1,this.fire(new da("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return o&&(this.coordinates=o),this._loaded=!0,void this._finishLoading();this._imageRequest=hv(this.map._requestManager.transformRequest(this.url,Zo.Image),(u,g)=>{this._imageRequest=null,this._loaded=!0,u?this.fire(new ur(u)):g&&(this.image=g instanceof HTMLImageElement?nt.getImageData(g):g,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,o&&(this.coordinates=o),this._finishLoading())})}loaded(){return this._loaded}updateImage(o){return o.url?(this._imageRequest&&o.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=o.url,this.load(o.coordinates,this._loaded),this):this}setTexture(o){if(!(o.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new fh(this.map.painter.context,o.handle),this.width=o.dimensions[0],this.height=o.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new da("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}onRemove(o){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof fh||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(o){if(this.coordinates=o,this._boundsArray=void 0,this._unsupportedCoords=!1,!o.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let a=o[0][1],u=o[0][1];for(const p of o)p[1]>u&&(u=p[1]),p[1]<a&&(a=p[1]);const g=(u+a)/2;if(g>br?this.onNorthPole=!0:g<-br&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const p=o.map(s.fromLngLat);this.tileID=function(y){let C=1/0,S=1/0,I=-1/0,b=-1/0;for(const O of y)C=Math.min(C,O.x),S=Math.min(S,O.y),I=Math.max(I,O.x),b=Math.max(b,O.y);const D=Math.max(I-C,b-S),k=Math.max(0,Math.floor(-Math.log(D)/Math.LN2)),T=Math.pow(2,k);let A=Math.floor((C+I)/2*T);return A>1&&(A-=1),new $e(k,A,Math.floor((S+b)/2*T))}(p),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new da("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(o){for(const V in this.tiles){const q=this.tiles[V];"loaded"!==q.state&&(q.state="loaded",q.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const a=iy(new $e(0,0,0),this.map.transform.projection),u=[a.projection.project(this.coordinates[0][0],this.coordinates[0][1]),a.projection.project(this.coordinates[1][0],this.coordinates[1][1]),a.projection.project(this.coordinates[2][0],this.coordinates[2][1]),a.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(V){const q=V[1].x-V[0].x,G=V[1].y-V[0].y,H=V[2].x-V[1].x,Z=V[2].y-V[1].y,ee=V[3].x-V[2].x,ie=V[3].y-V[2].y,me=V[0].x-V[3].x,ue=V[0].y-V[3].y,pe=q*Z-H*G,Te=H*ie-ee*Z,_e=ee*ue-me*ie,Ie=me*G-q*ue;return pe>0&&Te>0&&_e>0&&Ie>0||pe<0&&Te<0&&_e<0&&Ie<0}(u))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const g=iy(this.tileID,this.map.transform.projection),[p,y,C,S]=this.coordinates.map(V=>{const q=g.projection.project(V[0],V[1]);return Sw(g,q)._round()});this.perspectiveTransform=Ow(p.x,p.y,y.x,y.y,C.x,C.y,S.x,S.y);const I=this._boundsArray=new cd;I.emplaceBack(p.x,p.y,0,0),I.emplaceBack(y.x,y.y,kt,0),I.emplaceBack(S.x,S.y,0,kt),I.emplaceBack(C.x,C.y,kt,kt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=o.createVertexBuffer(I,kb.members),this.boundsSegments=hr.simpleSegment(0,0,4,2);const b=[],D=[Fw((k=this.coordinates)[0]),Fw(k[1]),Fw(k[2]),Fw(k[3])];var k;const[T,A,O,B]=function(V){let q=V[0][0],G=q,H=V[0][1],Z=H;for(let ee=1;ee<V.length;ee++)V[ee][0]<q?q=V[ee][0]:V[ee][0]>G&&(G=V[ee][0]),V[ee][1]<H?H=V[ee][1]:V[ee][1]>Z&&(Z=V[ee][1]);return[q,H,G-q,Z-H]}(D);{const V=new cd,[q,G,H,Z]=function(ze){let We=ze[0].x,Ue=We,Ze=ze[0].y,ht=Ze;for(let ut=1;ut<ze.length;ut++)ze[ut].x<We?We=ze[ut].x:ze[ut].x>Ue&&(Ue=ze[ut].x),ze[ut].y<Ze?Ze=ze[ut].y:ze[ut].y>ht&&(ht=ze[ut].y);return[We,Ze,Ue-We,ht-Ze]}(u),ee=ze=>[(ze.x-q)/H,(ze.y-G)/Z],[ie,me,ue,pe]=u.map(ee),Te=function(ze,We,Ue,Ze,ht,ut,qt,gt){const yt=ec(0,0,1,0,1,1,0,1),pt=ec(ze,We,Ue,Ze,ht,ut,qt,gt),fn=ge.mat3.adjoint([],pt);return ge.mat3.multiply(yt,yt,fn)}(ie[0],ie[1],me[0],me[1],ue[0],ue[1],pe[0],pe[1]);this.elevatedGlobePerspectiveTransform=Ow(ie[0],ie[1],me[0],me[1],ue[0],ue[1],pe[0],pe[1]);const _e=(ze,We)=>{b.push(ze.lng);const Ue=Math.round((ze.lng-T)/O*kt),Ze=Math.round((ze.lat-A)/B*kt),ht=ee(We),ut=ge.vec3.transformMat3([],[ht[0],ht[1],1],Te),qt=Math.round(ut[0]/ut[2]*kt),gt=Math.round(ut[1]/ut[2]*kt);V.emplaceBack(Ue,Ze,qt,gt)},Ie=u[3].x-u[0].x,Le=u[3].y-u[0].y,Fe=u[2].x-u[1].x,Ve=u[2].y-u[1].y;for(let ze=0;ze<65;ze++){const We=ze/64,Ue=[u[0].x+We*Ie,u[0].y+We*Le],Ze=[u[1].x+We*Fe,u[1].y+We*Ve],ht=Ze[0]-Ue[0],ut=Ze[1]-Ue[1];for(let qt=0;qt<65;qt++){const gt=qt/64,yt={x:Ue[0]+ht*gt,y:Ue[1]+ut*gt,z:0};_e(a.projection.unproject(yt.x,yt.y),yt)}}this.elevatedGlobeVertexBuffer=o.createVertexBuffer(V,kb.members)}{this.maxLongitudeTriangleSize=0;let V=[],q=new Vo;const G=(H,Z,ee)=>{q.emplaceBack(H,Z,ee);const ie=b[H],me=b[Z],ue=b[ee],pe=Math.min(Math.min(ie,me),ue),Te=Math.max(Math.max(ie,me),ue)-pe;Te>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Te),V.push(pe+Te/2)};for(let H=0;H<64;H++)for(let Z=0;Z<64;Z++){const ee=65*H+Z,ie=ee+1,me=ee+65,ue=me+1;G(ee,me,ie),G(ie,me,ue)}[V,q]=function(H,Z){const ee=Array.from({length:H.length},(ue,pe)=>pe);ee.sort((ue,pe)=>H[ue]-H[pe]);const ie=[],me=new Vo;for(let ue=0;ue<ee.length;ue++){const pe=ee[ue];ie.push(H[pe]);const Te=3*pe,_e=Te+1;me.emplaceBack(Z.uint16[Te],Z.uint16[_e],Z.uint16[_e+1])}return[ie,me]}(V,q),this.elevatedGlobeTrianglesCenterLongitudes=V,this.elevatedGlobeIndexBuffer=o.createIndexBuffer(q)}this.elevatedGlobeSegments=hr.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,O/kt,0,B/kt,0,0,A,T,0])}prepare(){const o=0!==Object.keys(this.tiles).length;if(this.tileID&&!o)return;const a=this.map.painter.context,u=a.gl;!this._dirty||this.texture instanceof fh||(this.texture?this.texture.update(this.image):(this.texture=new Rb(a,this.image,u.RGBA8),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE)),this._dirty=!1),o&&this._prepareData(a)}loadTile(o,a){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={},a(null)):(o.state="errored",a(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(o){const a=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!a)return null;const u=this.elevatedGlobeTrianglesCenterLongitudes;let g=(p=o+180)+360*Math.round((u[0]-p)/360);var p;const y=new hr,C=(D,k)=>{y.segments.push({vertexOffset:0,primitiveOffset:D,vertexLength:a.segments[0].vertexLength,primitiveLength:k,sortKey:void 0,vaos:{}})},S=.51*this.maxLongitudeTriangleSize;if(Math.abs(u[0]-g)<=S){const D=fm(u,0,u.length,g+S);return D===u.length||C(D,Uh(u,D+1,u.length,g+360-S)-D),y}g<u[0]&&(g+=360);const I=Uh(u,0,u.length,g-S);if(I===u.length)return C(0,u.length),y;C(0,I-0);const b=fm(u,I+1,u.length,g+S);return b!==u.length&&C(b,u.length-b),y}}const fO=(Math.pow(256,2)-1)/16907520;class qI extends go{constructor(o,a,u,g){super(o,{layout:Aw||(Aw=new Br({visibility:new Mt(Ye.layout_raster.visibility)})),paint:kw||(kw=new Br({"raster-opacity":new Mt(Ye.paint_raster["raster-opacity"]),"raster-color":new Bo(Ye.paint_raster["raster-color"]),"raster-color-mix":new Mt(Ye.paint_raster["raster-color-mix"]),"raster-color-range":new Mt(Ye.paint_raster["raster-color-range"]),"raster-hue-rotate":new Mt(Ye.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Mt(Ye.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Mt(Ye.paint_raster["raster-brightness-max"]),"raster-saturation":new Mt(Ye.paint_raster["raster-saturation"]),"raster-contrast":new Mt(Ye.paint_raster["raster-contrast"]),"raster-resampling":new Mt(Ye.paint_raster["raster-resampling"]),"raster-fade-duration":new Mt(Ye.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Mt(Ye.paint_raster["raster-emissive-strength"]),"raster-array-band":new Mt(Ye.paint_raster["raster-array-band"]),"raster-elevation":new Mt(Ye.paint_raster["raster-elevation"]),"raster-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"})}))},a,u,g),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(o){return!(o&&o._source instanceof SS&&(o._source.onNorthPole||o._source.onSouthPole))&&0===this.paint.get("raster-elevation")}_handleSpecialPaintPropertyUpdate(o){"raster-color"!==o&&"raster-color-range"!==o||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(o){if(!this.hasColorMap()||!this._curRampRange)return;const a=this._transitionablePaint._values["raster-color"].value.expression,[u,g]=o||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(u)&&isNaN(g)||u===this._curRampRange[0]&&g===this._curRampRange[1]||(this.colorRamp=lh({expression:a,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:u,end:g}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[u,g])}}let Lw,Nw,WI,DS,zw;class MS extends go{constructor(o,a,u,g){super(o,{layout:Lw||(Lw=new Br({visibility:new Mt(Ye["layout_raster-particle"].visibility)})),paint:Nw||(Nw=new Br({"raster-particle-array-band":new Mt(Ye["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Mt(Ye["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Bo(Ye["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Mt(Ye["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Mt(Ye["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Mt(Ye["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Mt(Ye["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Mt(Ye["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"})}))},a,u,g),this._updateColorRamp(),this.lastInvalidatedAt=nt.now()}onRemove(o){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return"none"!==this.visibility}isDraped(o){return!1}_handleSpecialPaintPropertyUpdate(o){"raster-particle-color"!==o&&"raster-particle-max-speed"!==o||(this._updateColorRamp(),this._invalidateAnimationState()),"raster-particle-count"===o&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const o=this._transitionablePaint._values["raster-particle-color"].value.expression,a=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=lh({expression:o,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:a}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=nt.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class Bw extends go{constructor(o,a){super(o,{},a,null),this.implementation=o,o.slot&&(this.slot=o.slot)}is3D(o){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isDraped(o){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(o){this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)}onRemove(o){this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)}}function Vw(d,o,a){const u=[0,0,1],g=ge.quat.identity([]);return ge.quat.rotateY(g,g,a?-yi(d)+Math.PI:yi(d)),ge.quat.rotateX(g,g,-yi(o)),ge.vec3.transformQuat(u,u,g),ge.vec3.normalize(u,u)}function TS(d,o){const a=Pb(d.projection,d.zoom,d.width,d.height),u=function(p,y,C,S,I){const b=new Ri(C.lng-180*mh,C.lat),D=new Ri(C.lng+180*mh,C.lat),k=p.project(b.lng,b.lat),T=p.project(D.lng,D.lat),A=-Math.atan2(T.y-k.y,T.x-k.x),O=s.fromLngLat(C);O.y=Qn(O.y,-1+mh,1-mh);const B=O.toLngLat(),V=p.project(B.lng,B.lat),q=s.fromLngLat(B);q.x+=mh;const G=q.toLngLat(),H=p.project(G.lng,G.lat),Z=IS(H.x-V.x,H.y-V.y,A),ee=s.fromLngLat(B);ee.y+=mh;const ie=ee.toLngLat(),me=p.project(ie.lng,ie.lat),ue=IS(me.x-V.x,me.y-V.y,A),pe=Math.abs(Z.x)/Math.abs(ue.y),Te=ge.mat4.identity([]);ge.mat4.rotateZ(Te,Te,-A*(1-(I?0:S)));const _e=ge.mat4.identity([]);return ge.mat4.scale(_e,_e,[1,1-(1-pe)*S,1]),_e[4]=-ue.x/ue.y*S,ge.mat4.rotateZ(_e,_e,A),ge.mat4.multiply(_e,Te,_e),_e}(d.projection,0,d.center,a,o),g=kc(d);return ge.mat4.scale(u,u,[g,g,1]),u}function kc(d){const o=d.projection,a=Pb(d.projection,d.zoom,d.width,d.height),u=Uw(o,d.center),g=Uw(o,Ri.convert(o.center));return Math.pow(2,u*a+(1-a)*g)}function Pb(d,o,a,u,g=1/0){const p=d.range;if(!p)return 0;const y=Math.min(g,Math.max(a,u)),C=Math.log(y/1024)/Math.LN2;return aa(p[0]+C,p[1]+C,o)}const mh=1/4e4;function Uw(d,o){const a=Qn(o.lat,-br,br),u=new Ri(o.lng-180*mh,a),g=new Ri(o.lng+180*mh,a),p=d.project(u.lng,a),y=d.project(g.lng,a),C=s.fromLngLat(u),S=s.fromLngLat(g),I=y.x-p.x,b=y.y-p.y,D=S.x-C.x,k=S.y-C.y,T=Math.sqrt((D*D+k*k)/(I*I+b*b));return Math.log(T)/Math.LN2}function IS(d,o,a){const u=Math.cos(a),g=Math.sin(a);return{x:d*u-o*g,y:d*g+o*u}}function AS(d,o,a){ge.mat4.identity(d),ge.mat4.rotateZ(d,d,yi(o[2])),ge.mat4.rotateX(d,d,yi(o[0])),ge.mat4.rotateY(d,d,yi(o[1])),ge.mat4.scale(d,d,a),ge.mat4.multiply(d,d,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Ob(d,o,a,u,g,p,y,C){const S=[a[0]-o[0],a[1]-o[1],0],I=[u[0]-o[0],u[1]-o[1],0];if(ge.vec3.length(S)<1e-12||ge.vec3.length(I)<1e-12)return ge.quat.identity(d);const b=ge.vec3.cross([],S,I);ge.vec3.normalize(b,b),ge.vec3.subtract(I,u,o),S[2]=(p-g)*C,I[2]=(y-g)*C;const D=S;return ge.vec3.cross(D,S,I),ge.vec3.normalize(D,D),ge.quat.rotationTo(d,b,D)}function Fb(d,o,a=!1){const u=js(o.zoom),g=function(p,y,C){const S=y.worldSize,I=[p[12],p[13],p[14]],b=Uo(I[1]/S),D=xa(I[0]/S),k=ge.mat4.identity([]),T=Co(1,b)*S,A=Co(1,0)*S*Ur(b,y.zoom),O=1/md(S);let B=A*O;if(C){const H=Pb(y.projection,y.zoom,y.width,y.height,1024);B=O*y.projection.pixelSpaceConversion(y.center.lat,S,H)}const V=su(b,D);ge.vec3.add(V,V,ge.vec3.scale([],ge.vec3.normalize([],V),T*B*I[2]));const q=function(H){const Z=[H[0],H[1],H[2]];let ee=[0,1,0];const ie=ge.vec3.cross([],ee,Z);return ge.vec3.cross(ee,Z,ie),0===ge.vec3.squaredLength(ee)&&(ee=[0,1,0],ge.vec3.cross(ie,Z,ee)),ge.vec3.normalize(ie,ie),ge.vec3.normalize(ee,ee),ge.vec3.normalize(Z,Z),[ie[0],ie[1],ie[2],0,ee[0],ee[1],ee[2],0,Z[0],Z[1],Z[2],0,H[0],H[1],H[2],1]}(V);ge.mat4.scale(k,k,[B,B,B*T]),ge.mat4.translate(k,k,[-I[0],-I[1],-I[2]]);const G=ge.mat4.multiply([],y.globeMatrix,q);return ge.mat4.multiply(G,G,k),ge.mat4.multiply(G,G,p),G}(d,o,a);return u>0?function(y,C,S){const I=(A,O,B)=>{const V=ge.vec3.length(A),q=ge.vec3.length(O),G=jo(A,O,B);return ge.vec3.scale(G,G,1/ge.vec3.length(G)*_n(V,q,B))},b=I([y[0],y[1],y[2]],[C[0],C[1],C[2]],S),D=I([y[4],y[5],y[6]],[C[4],C[5],C[6]],S),k=I([y[8],y[9],y[10]],[C[8],C[9],C[10]],S),T=jo([y[12],y[13],y[14]],[C[12],C[13],C[14]],S);return[b[0],b[1],b[2],0,D[0],D[1],D[2],0,k[0],k[1],k[2],0,T[0],T[1],T[2],1]}(g,function(y,C){const S=C.worldSize,I=Co(1,0)*S*Ur(C.center.lat,C.zoom)/md(S),b=Co(1,C.center.lat)*S,D=ge.mat4.identity([]);return ge.mat4.rotateY(D,D,yi(C.center.lng)),ge.mat4.rotateX(D,D,yi(C.center.lat)),ge.mat4.translate(D,D,[0,0,ts]),ge.mat4.scale(D,D,[I,I,I*b]),ge.mat4.translate(D,D,[C.point.x-.5*S,C.point.y-.5*S,0]),ge.mat4.multiply(D,D,y),ge.mat4.multiply(D,C.globeMatrix,D)}(d,o),u):g}function kS(d,o,a,u){const g=tn.projectAabbCorners(u,a);let p=Number.MAX_VALUE,y=-1;for(let I=0;I<g.length;++I){const b=g[I];b[0]=(.5*b[0]+.5)*o.width,b[1]=(.5-.5*b[1])*o.height,b[2]<p&&(y=I,p=b[2])}const C=I=>new Ot(g[I][0],g[I][1]);let S;switch(y){case 0:case 6:S=[C(1),C(5),C(4),C(7),C(3),C(2),C(1)];break;case 1:case 7:S=[C(0),C(4),C(5),C(6),C(2),C(3),C(0)];break;case 3:case 5:S=[C(1),C(0),C(4),C(7),C(6),C(2),C(1)];break;default:S=[C(1),C(5),C(6),C(7),C(3),C(0),C(1)]}if(ne(d,S))return p}const YI=ki([{name:"a_pos_3f",components:3,type:"Float32"}]),ZI=ki([{name:"a_color_3f",components:3,type:"Float32"}]),Gi=ki([{name:"a_color_4f",components:4,type:"Float32"}]),jw=ki([{name:"a_uv_2f",components:2,type:"Float32"}]),RS=ki([{name:"a_normal_3f",components:3,type:"Float32"}]),Hw=ki([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),Lb=ki([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),bp={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class cy{constructor(o,a,u,g){this.message=(o?`${o}: `:"")+u,g&&(this.identifier=g),null!=a&&a.__line__&&(this.line=a.__line__)}}function $w(d,o){const a=-1===d.indexOf("://");try{return new URL(d,a&&o?"http://example.com":void 0),!0}catch{return!1}}class hg{constructor(o,a){this.feature=o,this.instancedDataOffset=a,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class Gw{constructor(){this.instancedDataArray=new Um,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class qw{constructor(o){this.zoom=o.zoom,this.canonical=o.canonical,this.layers=o.layers,this.layerIds=this.layers.map(a=>a.fqid),this.projection=o.projection,this.index=o.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(o,a){}populate(o,a,u,g){this.tileToMeter=m(u);const p=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:y,id:C,index:S,sourceLayerIndex:I}of o){const b=C??(y.properties&&y.properties.hasOwnProperty("id")?y.properties.id:void 0),D=z(y,p);if(!this.layers[0]._featureFilter.filter(new sr(this.zoom),D,u))continue;const k={id:b,sourceLayerIndex:I,index:S,geometry:p?D.geometry:N(y,u,g),properties:y.properties,type:y.type,patterns:{}},T=this.addFeature(k,k.geometry,D);T&&a.featureIndex.insert(y,k.geometry,S,I,this.index,this.instancesPerModel[T].instancedDataArray.length,256)}this.lookup=null}update(o,a,u,g){for(const p in this.instancesPerModel){const y=this.instancesPerModel[p];for(const C in o)y.idToFeaturesIndex.hasOwnProperty(C)&&(this.evaluate(y.features[y.idToFeaturesIndex[C]],o[C],y,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let o=!1;for(const a in this.instancesPerModel){const u=this.instancesPerModel[a];for(const g of u.features){const p=this.layers[0],y=g.feature,C=this.canonical,S=p.paint.get("model-rotation").evaluate(y,{},C),I=p.paint.get("model-scale").evaluate(y,{},C),b=p.paint.get("model-translation").evaluate(y,{},C);ge.vec3.exactEquals(g.rotation,S)&&ge.vec3.exactEquals(g.scale,I)&&ge.vec3.exactEquals(g.translation,b)||(this.evaluate(g,g.featureStates,u,!0),o=!0)}}return o}updateReplacement(o,a,u,g){if(a.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=a.updateTime;const p=a.getReplacementRegionsForTile(o.toUnwrapped(),!0);if(Hx(this.activeReplacements,p))return!1;this.activeReplacements=p;let y=!1;for(const C in this.instancesPerModel){const S=this.instancesPerModel[C],I=S.instancedDataArray;for(const b of S.features){const D=b.instancedDataOffset,k=b.instancedDataCount;for(let T=0;T<k;T++){const A=16*(T+D);let O=I.float32[A+0];const B=O>kt;O=B?O-kt:O;const V=Math.floor(O),q=I.float32[A+1];let G=!1;for(const H of this.activeReplacements)if(!jx(H,u,bp.Model,g)&&!(H.min.x>V||V>H.max.x||H.min.y>q||q>H.max.y)&&(G=qr(Gx(V,q,o.canonical,H.footprintTileId.canonical),H.footprint),G))break;I.float32[A]=G?O+kt:O,y=y||G!==B}}}return y}isEmpty(){for(const o in this.instancesPerModel)if(0!==this.instancesPerModel[o].instancedDataArray.length)return!1;return!0}uploadPending(){return!this.uploaded}upload(o){if(!this.uploaded)for(const a in this.instancesPerModel){const u=this.instancesPerModel[a];u.instancedDataArray.length<0||0===u.instancedDataArray.length||(u.instancedDataBuffer?u.instancedDataBuffer.updateData(u.instancedDataArray):u.instancedDataBuffer=o.createVertexBuffer(u.instancedDataArray,Hw.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const a in this.instancesPerModel){const u=this.instancesPerModel[a];0!==u.instancedDataArray.length&&u.instancedDataBuffer&&u.instancedDataBuffer.destroy()}const o=this.layers[0].modelManager;if(o&&this.modelUris)for(const a of this.modelUris)o.removeModel(a,"")}addFeature(o,a,u){const g=this.layers[0],p=g.layout.get("model-id").evaluate(u,{},this.canonical);if(!p)return Ir(`modelId is not evaluated for layer ${g.id} and it is not going to get rendered.`),p;$w(p,!1)&&(this.modelUris.includes(p)||this.modelUris.push(p)),this.instancesPerModel[p]||(this.instancesPerModel[p]=new Gw);const y=this.instancesPerModel[p],C=y.instancedDataArray,S=new hg(u,C.length);for(const I of a)for(const b of I){if(b.x<0||b.x>=kt||b.y<0||b.y>=kt)continue;const D=(this.lookupDim-1)/kt,k=this.lookupDim*(b.y*D|0)+b.x*D|0;if(this.lookup){if(0!==this.lookup[k])continue;this.lookup[k]=1}this.instanceCount++;const T=C.length;C.resize(T+1),y.instancesEvaluatedElevation.push(0),C.float32[16*T]=b.x,C.float32[16*T+1]=b.y}return S.instancedDataCount=y.instancedDataArray.length-S.instancedDataOffset,S.instancedDataCount>0&&(o.id&&(y.idToFeaturesIndex[o.id]=y.features.length),y.features.push(S),this.evaluate(S,{},y,!1)),p}getModelUris(){return this.modelUris}evaluate(o,a,u,g){const p=this.layers[0],y=o.feature,C=this.canonical,S=o.rotation=p.paint.get("model-rotation").evaluate(y,a,C),I=o.scale=p.paint.get("model-scale").evaluate(y,a,C),b=o.translation=p.paint.get("model-translation").evaluate(y,a,C),D=p.paint.get("model-color").evaluate(y,a,C);D.a=p.paint.get("model-color-mix-intensity").evaluate(y,a,C);const k=[];this.maxVerticalOffset<b[2]&&(this.maxVerticalOffset=b[2]),this.maxScale=Math.max(Math.max(this.maxScale,I[0]),Math.max(I[1],I[2])),AS(k,S,I);const T=Math.round(100*D.a)+D.b/1.05;for(let A=0;A<o.instancedDataCount;++A){const O=o.instancedDataOffset+A,B=16*O,V=u.instancedDataArray.float32;let q=0;g&&(q=V[B+6]-u.instancesEvaluatedElevation[O]);const G=0|V[B+1];V[B]=(0|V[B])+D.r/1.05,V[B+1]=G+D.g/1.05,V[B+2]=T,V[B+3]=1/(C.z>10?this.tileToMeter:m(C,G)),V[B+4]=b[0],V[B+5]=b[1],V[B+6]=b[2]+q,V[B+7]=k[0],V[B+8]=k[1],V[B+9]=k[2],V[B+10]=k[4],V[B+11]=k[5],V[B+12]=k[6],V[B+13]=k[8],V[B+14]=k[9],V[B+15]=k[10],u.instancesEvaluatedElevation[O]=b[2]}}}let PS,Ww;Zt(qw,"ModelBucket",{omit:["layers"]}),Zt(Gw,"PerModelAttributes"),Zt(hg,"ModelFeature");const pg={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function Yw(d,o,a,u,g,p,y,C,S,I=!1){const b=a.zoom,D=a.project(u),k=Ur(u.lat,b),T=1/k;ge.mat4.identity(d),ge.mat4.translate(d,d,[D.x+y[0]*T,D.y+y[1]*T,y[2]]);let A=1,O=1;const B=a.worldSize;if(I){if("mercator"===a.projection.name){let H=0;a.elevation&&(H=a.elevation.getAtPointOrZero(new s(D.x/B,D.y/B),0));const Z=ge.vec4.transformMat4([],[D.x,D.y,H,1],a.projMatrix)[3]/a.cameraToCenterDistance;A=Z,O=Z*Ur(a.center.lat,b)}else if("globe"===a.projection.name){const H=Fb(d,a),Z=ge.mat4.multiply([],a.projMatrix,H),ee=[0,0,0,1];ge.vec4.transformMat4(ee,ee,Z);const ie=ee[3]/a.cameraToCenterDistance,me=js(b),ue=a.projection.pixelsPerMeter(u.lat,B)*Ur(u.lat,b),pe=a.projection.pixelsPerMeter(a.center.lat,B)*Ur(a.center.lat,b);A=ie/_n(ue,au(a.center.lat),me),O=ie*k/ue,A*=pe,O*=pe}}else A=T;ge.mat4.scale(d,d,[A,A,O]);const V=[...d],q=o.orientation,G=[];if(AS(G,[q[0]+g[0],q[1]+g[1],q[2]+g[2]],p),ge.mat4.multiply(d,V,G),C&&a.elevation){let H=0;const Z=[];if(S&&a.elevation){H=function(me,ue,pe,Te,_e){const Ie=ue.elevation;if(!Ie)return 0;const Le=tn.projectAabbCorners(pe,Te),Fe=Co(1,_e.lat)*ue.worldSize,Ve=function(fn,Ut){const Jt=[0,0,1],xn=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Bn of xn){const En=fn[Bn.corners[0]],ti=fn[Bn.corners[1]],Vn=fn[Bn.corners[2]],ui=[ti[0]-En[0],ti[1]-En[1],Ut*(ti[2]-En[2])],Si=ge.vec3.cross(ui,ui,[Vn[0]-En[0],Vn[1]-En[1],Ut*(Vn[2]-En[2])]);ge.vec3.normalize(Si,Si),Bn.dotProductWithUp=ge.vec3.dot(Si,Jt)}return xn.sort((Bn,En)=>Bn.dotProductWithUp-En.dotProductWithUp),xn[0].corners}(Le,Fe),ze=Le[Ve[0]],We=Le[Ve[1]],Ue=Le[Ve[2]],Ze=Le[Ve[3]],ht=Ie.getAtPointOrZero(new s(ze[0]/ue.worldSize,ze[1]/ue.worldSize),0),ut=Ie.getAtPointOrZero(new s(We[0]/ue.worldSize,We[1]/ue.worldSize),0),qt=Ie.getAtPointOrZero(new s(Ue[0]/ue.worldSize,Ue[1]/ue.worldSize),0),gt=Ie.getAtPointOrZero(new s(Ze[0]/ue.worldSize,Ze[1]/ue.worldSize),0),yt=(ht+gt)/2,pt=(ut+qt)/2;return yt>pt?ut<qt?Ob(me,We,Ze,ze,ut,gt,ht,Fe):Ob(me,Ue,ze,Ze,qt,ht,gt,Fe):ht<gt?Ob(me,ze,We,Ue,ht,ut,qt,Fe):Ob(me,Ze,Ue,We,gt,qt,ut,Fe),Math.max(yt,pt)}(Z,a,o.aabb,d,u);const ee=ge.mat4.fromQuat([],Z),ie=ge.mat4.multiply([],ee,G);ge.mat4.multiply(d,V,ie)}else H=a.elevation.getAtPointOrZero(new s(D.x/B,D.y/B),0);0!==H&&(d[14]+=H)}}function xp(d,o,a=!1){d.uploaded||(d.gfxTexture=new Rb(o,d.image,a?o.gl.R8:o.gl.RGBA8,{useMipmap:d.sampler.minFilter>=o.gl.NEAREST_MIPMAP_NEAREST}),d.uploaded=!0,d.image=null)}function XI(d,o,a){d.indexBuffer=o.createIndexBuffer(d.indexArray,!1,!0),d.vertexBuffer=o.createVertexBuffer(d.vertexArray,YI.members,!1,!0),d.normalArray&&(d.normalBuffer=o.createVertexBuffer(d.normalArray,RS.members,!1,!0)),d.texcoordArray&&(d.texcoordBuffer=o.createVertexBuffer(d.texcoordArray,jw.members,!1,!0)),d.colorArray&&(d.colorBuffer=o.createVertexBuffer(d.colorArray,(12===d.colorArray.bytesPerElement?ZI:Gi).members,!1,!0)),d.featureArray&&(d.pbrBuffer=o.createVertexBuffer(d.featureArray,Lb.members,!0)),d.segments=hr.simpleSegment(0,0,d.vertexArray.length,d.indexArray.length);const u=d.material;u.pbrMetallicRoughness.baseColorTexture&&xp(u.pbrMetallicRoughness.baseColorTexture,o),u.pbrMetallicRoughness.metallicRoughnessTexture&&xp(u.pbrMetallicRoughness.metallicRoughnessTexture,o),u.normalTexture&&xp(u.normalTexture,o),u.occlusionTexture&&xp(u.occlusionTexture,o,a),u.emissionTexture&&xp(u.emissionTexture,o)}function dy(d,o,a){if(d.meshes)for(const u of d.meshes)XI(u,o,a);if(d.children)for(const u of d.children)dy(u,o,a)}function wp(d){if(d.meshes)for(const o of d.meshes)o.indexArray.destroy(),o.vertexArray.destroy(),o.colorArray&&o.colorArray.destroy(),o.normalArray&&o.normalArray.destroy(),o.texcoordArray&&o.texcoordArray.destroy(),o.featureArray&&o.featureArray.destroy();if(d.children)for(const o of d.children)wp(o)}function uy(d){if(d.meshes)for(const a of d.meshes)a.vertexBuffer&&(a.vertexBuffer.destroy(),a.indexBuffer.destroy(),a.normalBuffer&&a.normalBuffer.destroy(),a.texcoordBuffer&&a.texcoordBuffer.destroy(),a.colorBuffer&&a.colorBuffer.destroy(),a.pbrBuffer&&a.pbrBuffer.destroy(),a.segments.destroy(),a.material&&((o=a.material).pbrMetallicRoughness.baseColorTexture&&o.pbrMetallicRoughness.baseColorTexture.gfxTexture&&o.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),o.pbrMetallicRoughness.metallicRoughnessTexture&&o.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&o.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),o.normalTexture&&o.normalTexture.gfxTexture&&o.normalTexture.gfxTexture.destroy(),o.emissionTexture&&o.emissionTexture.gfxTexture&&o.emissionTexture.gfxTexture.destroy(),o.occlusionTexture&&o.occlusionTexture.gfxTexture&&o.occlusionTexture.gfxTexture.destroy()));var o;if(d.children)for(const a of d.children)uy(a)}class xe{constructor(o,a,u){this._demTile=o,this._dem=this._demTile.dem,this._scale=a,this._offset=u}static create(o,a,u){const g=u||o.findDEMTileFor(a);if(!g||!g.dem)return;const p=g.dem,y=g.tileID,C=1<<a.canonical.z-y.canonical.z;return new xe(g,p.dim/kt/C,[(a.canonical.x/C-y.canonical.x)*p.dim,(a.canonical.y/C-y.canonical.y)*p.dim])}tileCoordToPixel(o,a){const u=a*this._scale+this._offset[1],g=Math.floor(o*this._scale+this._offset[0]),p=Math.floor(u);return new Ot(g,p)}getElevationAt(o,a,u,g){const p=o*this._scale+this._offset[0],y=a*this._scale+this._offset[1],C=Math.floor(p),S=Math.floor(y),I=this._dem;return g=!!g,u?_n(_n(I.get(C,S,g),I.get(C,S+1,g),y-S),_n(I.get(C+1,S,g),I.get(C+1,S+1,g),y-S),p-C):I.get(C,S,g)}getElevationAtPixel(o,a,u){return this._dem.get(o,a,!!u)}getMeterToDEM(o){return(1<<this._demTile.tileID.canonical.z)*Co(1,o)*this._dem.stride}}const Nb=new Float32Array(262144),gu=new Uint8Array(262144);function zb(d){let o=0;if(d.meshes)for(const a of d.meshes)o=Math.max(o,a.aabb.max[2]);if(d.children)for(const a of d.children)o=Math.max(o,zb(a));return o}function Zw(d,o,a){if(d.meshes)for(const u of d.meshes){if(u.aabb.min[0]===1/0)continue;const g=tn.applyTransform(u.aabb,d.matrix);a.insert(o,g.min[0],g.min[1],g.max[0],g.max[1])}if(d.children)for(const u of d.children)Zw(u,o,a)}const hy=["","wall","door","roof","window","lamp","logo"];class Bb{constructor(o){this.node=o,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:o.id,geometry:[],properties:{height:zb(o)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new tn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let o=0;const a=new tn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const u of this.node.meshes)this.node.lightMeshIndex!==o&&(u.transformedAabb=tn.applyTransformFast(u.aabb,this.node.matrix),a.encapsulate(u.transformedAabb)),o++;this.aabb=a}return this.aabb}}class Vb{constructor(o,a,u,g,p,y,C){this.id=u,this.layers=o,this.layerIds=this.layers.map(S=>S.fqid),this.stateDependentLayerIds=this.layers.filter(S=>S.isStateDependent()).map(S=>S.id),this.modelTraits|=pg.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,g&&(this.modelTraits|=pg.HasMapboxMeshFeatures),p&&(this.modelTraits|=pg.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=y,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const S of a)this.nodesInfo.push(new Bb(S)),Zw(S,C.featureIndexArray.length,C.grid),C.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,C.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(o,a){for(const u of this.getNodesInfo()){const g=u.node;g.footprint&&a.push({footprint:g.footprint,id:o})}}update(o){const a=0!==Object.keys(o).length;if(a&&!this.stateDependentLayers.length)return;const u=a?this.stateDependentLayers:this.layers;if(!Bl(o,this.states))for(const g of u)this.evaluate(g,o);this.states=structuredClone(o)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(o){if(!this.needsUpload)return;const a=this.getNodesInfo();for(const u of a){const g=u.node;this.uploaded?this.updatePbrBuffer(g):dy(g,o,!0)}for(const u of a)wp(u.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(o){let a=!1;if(!o.meshes)return a;for(const u of o.meshes)u.pbrBuffer&&(u.pbrBuffer.updateData(u.featureArray),a=!0);return a}needsReEvaluation(o,a,u){const g=o.transform.projectionOptions,p=o.style.getBrightness(),y=this.brightness!==p;if(!this.uploaded||this.dirty||g.name!==this.projection.name||py(u.paint.get("model-color").value,y)||py(u.paint.get("model-color-mix-intensity").value,y)||py(u.paint.get("model-roughness").value,y)||py(u.paint.get("model-emissive-strength").value,y)||py(u.paint.get("model-height-based-emissive-strength-multiplier").value,y)){this.projection=g,this.brightness=p;const C=this.getNodesInfo();for(const S of C)S.state=null;return!0}return!1}evaluateScale(o,a){if(o.transform.zoom===this.zoom)return;this.zoom=o.transform.zoom;const u=this.getNodesInfo(),g=this.id.canonical;for(const p of u){const y=p.feature;p.evaluatedScale=a.paint.get("model-scale").evaluate(y,{},g)}}evaluate(o,a){const u=this.getNodesInfo();for(const g of u){if(!g.node.meshes)continue;const p=g.feature,y=a&&a[p.id];if(Bl(y,g.state))continue;g.state=structuredClone(y);const C=g.node.meshes&&g.node.meshes[0].featureData,S=g.evaluatedColor[2],I=g.evaluatedRMEA[2],b=this.id.canonical;if(g.hasTranslucentParts=!1,C){for(let D=0;D<hy.length;D++){const k=hy[D];k.length&&(p.properties.part=k);const T=o.paint.get("model-color").evaluate(p,y,b).toRenderColor(null),A=o.paint.get("model-color-mix-intensity").evaluate(p,y,b);g.evaluatedColor[D]=[T.r,T.g,T.b,A],g.evaluatedRMEA[D][0]=o.paint.get("model-roughness").evaluate(p,y,b),g.evaluatedRMEA[D][2]=o.paint.get("model-emissive-strength").evaluate(p,y,b),g.evaluatedRMEA[D][3]=T.a,g.emissionHeightBasedParams[D]=o.paint.get("model-height-based-emissive-strength-multiplier").evaluate(p,y,b),!g.hasTranslucentParts&&T.a<1&&(g.hasTranslucentParts=!0)}delete p.properties.part,KI(g,S!==g.evaluatedColor[2]||I!==g.evaluatedRMEA[2],this.modelTraits)}else g.evaluatedRMEA[0][2]=o.paint.get("model-emissive-strength").evaluate(p,y,b);g.evaluatedScale=o.paint.get("model-scale").evaluate(p,y,b),this.updatePbrBuffer(g.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(o,a,u,g){const p=o.findDEMTileFor(u);if(p&&(p.tileID.canonical!==this.terrainTile||a!==this.terrainExaggeration)){if(p.dem&&p.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=p.tileID.overscaledZ;const y=xe.create(o,u,p);if(!y)return;this.modelTraits&pg.HasMapboxMeshFeatures&&this.updateDEM(o,y,u,g);for(const C of this.getNodesInfo()){const S=C.node;if(!S.footprint||!S.footprint.vertices||!S.footprint.vertices.length)continue;const I=S.footprint.vertices;let b=y.getElevationAt(I[0].x,I[0].y,!0,!0);for(let D=1;D<I.length;D++)b=Math.min(b,y.getElevationAt(I[D].x,I[D].y,!0,!0));S.elevation=b}}this.terrainTile=p.tileID.canonical,this.terrainExaggeration=a}}updateDEM(o,a,u,g){let p=a._dem._modifiedForSources[g];if(void 0===p&&(a._dem._modifiedForSources[g]=[],p=a._dem._modifiedForSources[g]),p.includes(u.canonical))return;const y=a._dem.dim;p.push(u.canonical);let C=!1;for(const S of this.getNodesInfo()){const I=S.node;if(!I.footprint||!I.footprint.grid)continue;const b=I.footprint.grid,D=a.tileCoordToPixel(b.min.x,b.min.y),k=a.tileCoordToPixel(b.max.x,b.max.y),T=Math.min(Math.min(y-k.y,D.x),Math.min(D.y,y-k.x));if(T<0)continue;const A=Qn(T,2,5);let O=Math.max(0,D.x-A),B=Math.max(0,D.y-A),V=Math.min(k.x+A,y-1),q=Math.min(k.y+A,y-1);for(let ee=B;ee<=q;++ee)for(let ie=O;ie<=V;++ie)gu[ee*y+ie]=255;let G=0,H=0;for(let ee=0;ee<b.cellsY;++ee)for(let ie=0;ie<b.cellsX;++ie){if(!b.cells[ee*b.cellsX+ie])continue;const me=a.tileCoordToPixel(b.min.x+ie/b.xScale,b.min.y+ee/b.yScale),ue=a.tileCoordToPixel(b.min.x+(ie+1)/b.xScale,b.min.y+(ee+1)/b.yScale);for(let pe=me.y;pe<=Math.min(ue.y+1,y-1);++pe)for(let Te=me.x;Te<=Math.min(ue.x+1,y-1);++Te)255===gu[pe*y+Te]&&(gu[pe*y+Te]=0,G+=a.getElevationAtPixel(Te,pe),H++)}const Z=G/H;O=Math.max(1,D.x-A),B=Math.max(1,D.y-A),V=Math.min(k.x+A,y-2),q=Math.min(k.y+A,y-2),C=!0;for(let ee=B;ee<=q;++ee)for(let ie=O;ie<=V;++ie)0===gu[ee*y+ie]&&(Nb[ee*y+ie]=a._dem.set(ie,ee,Z));for(let ee=1;ee<A;++ee){O=Math.max(1,D.x-ee),B=Math.max(1,D.y-ee),V=Math.min(k.x+ee,y-2),q=Math.min(k.y+ee,y-2);for(let ie=B;ie<=q;++ie)for(let me=O;me<=V;++me){const ue=ie*y+me;if(255===gu[ue]){let pe=0,Te=0,_e=-1,Ie=-1;for(let Le=-1;Le<=1;++Le)for(let Fe=-1;Fe<=1;++Fe){const Ve=(ie+Le)*y+me+Fe;if(gu[Ve]>=ee)continue;const ze=Nb[Ve],We=Math.abs(ze);We>Te&&(pe=ze,Te=We,_e=Fe,Ie=Le)}if(Te>.1){const Le=1-(ee+.5*Math.abs(_e*Ie))/A;let Fe=a._dem.get(me,ie)+pe*Le;const Ve=a._dem.get(me+_e,ie+Ie),ze=a._dem.get(me-_e,ie-Ie,!0);(Fe-Ve)*(Fe-ze)>0&&(Fe=(Ve+ze)/2),Nb[ue]=a._dem.set(me,ie,Fe),gu[ue]=ee}}}}}C&&(a._demTile.needsDEMTextureUpload=!0,a._dem._timestamp=nt.now())}setFilter(o){this.filter=o?mf(o):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(o=>this.filter.filter(new sr(this.id.overscaledZ),o.feature,this.id.canonical)):this.nodesInfo}destroy(){const o=this.getNodesInfo();for(const a of o)wp(a.node),uy(a.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(o,a){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const u=a.getReplacementRegionsForTile(o.toUnwrapped()),g=this.getNodesInfo();for(let p=0;p<this.nodesInfo.length;p++){const y=g[p].node;g[p].hiddenByReplacement=!!y.footprint&&!u.find(C=>C.footprint===y.footprint)}}getHeightAtTileCoord(o,a){const u=this.getNodesInfo(),g=[],p=[0,0,0],y=ge.mat4.identity([]);for(let C=0;C<this.nodesInfo.length;C++){const S=u[C],I=S.node.meshes[0],b=I.transformedAabb;if(o<b.min[0]||a<b.min[1]||o>b.max[0]||a>b.max[1])continue;if(!0===S.node.hidden)return{height:1/0,maxHeight:S.feature.properties.height,hidden:!1,verticalScale:S.evaluatedScale[2]};ge.mat4.invert(y,S.node.matrix),p[0]=o,p[1]=a,ge.vec3.transformMat4(p,p,y);const D=(p[0]-I.aabb.min[0])/(I.aabb.max[0]-I.aabb.min[0])*64|0,k=64*Math.min(63,(p[1]-I.aabb.min[1])/(I.aabb.max[1]-I.aabb.min[1])*64|0)+Math.min(63,D),T=I.heightmap[k];if(!(T<0&&S.node.footprint))return S.hiddenByReplacement?void 0:{height:T,maxHeight:S.feature.properties.height,hidden:!1,verticalScale:S.evaluatedScale[2]};if(S.node.footprint.grid.query(new Ot(o,a),new Ot(o,a),g),g.length>0)return{height:void 0,maxHeight:S.feature.properties.height,hidden:S.hiddenByReplacement,verticalScale:S.evaluatedScale[2]}}}}function py(d,o){return!d.isLightConstant&&o}function OS(d,o,a,u,g,p,y,C){let S=(61440&o|(61440&o)>>4)>>8,I=(3840&o|(3840&o)>>4)>>4,b=240&o|(240&o)>>4;a[3]>0&&(S=_n(S,255*a[0],a[3]),I=_n(I,255*a[1],a[3]),b=_n(b,255*a[2],a[3]));const D=S<<8|I,k=b<<8|Math.floor(255*u[3]),T=function(ee){const ie=Qn(ee,0,2);return Math.min(Math.round(.5*ie*255),255)}(u[2])<<8|15*u[0]<<4|15*u[1],A=Qn(g[0],0,1),O=Qn(g[1],0,1),B=Qn(g[2],0,1),V=Qn(g[3],0,1);let q,G,H,Z;if(A!==O&&y!==p&&O!==A){const ee=y-p;G=1/(ee*(O-A)),H=-(p+ee*A)/(ee*(O-A));const ie=Qn(g[4],-1,1);Z=Math.pow(10,ie),q=255*B<<8|255*V}else q=65535,G=0,H=1,Z=1;if(d.emplaceBack(D,k,T,q,G,H,Z),C){const ee=C.length;C.clear();for(let ie=0;ie<ee;ie++)C.emplaceBack(D,k,T,q,G,H,Z)}}function KI(d,o,a){const u=d.node;let g=0;const p=a&pg.HasMeshoptCompression;for(const y of u.meshes){if(u.lights&&u.lightMeshIndex===g||!y.featureData)continue;y.featureArray=new tp,y.featureArray.reserve(y.featureData.length);let C=o;for(const S of y.featureData){const I=p?65535&S:S>>16&65535,b=p?S>>16&65535:65535&S,D=(15&b)<8?15&b:0,k=d.evaluatedRMEA[D],T=d.evaluatedColor[D],A=d.emissionHeightBasedParams[D];let O;if(C&&2===D&&u.lights&&(O=new tp,O.resize(10*u.lights.length)),OS(y.featureArray,I,T,k,A,y.aabb.min[2],y.aabb.max[2],O),O&&C){C=!1;const B=u.meshes[u.lightMeshIndex];B.featureArray=O,B.featureArray._trim()}}y.featureArray._trim(),g++}}function FS(d,o,a,u){const g=1<<d.z;o.lat=Uo((u/kt+d.y)/g),o.lng=xa((a/kt+d.x)/g)}Zt(Vb,"Tiled3dModelBucket",{omit:["layers"]}),Zt(Bb,"Tiled3dModelFeature");const QI={circle:class extends go{constructor(d,o,a,u){super(d,{layout:He||(He=new Br({"circle-sort-key":new Vt(Ye.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Mt(Ye.layout_circle["circle-elevation-reference"]),visibility:new Mt(Ye.layout_circle.visibility)})),paint:st||(st=new Br({"circle-radius":new Vt(Ye.paint_circle["circle-radius"]),"circle-color":new Vt(Ye.paint_circle["circle-color"]),"circle-blur":new Vt(Ye.paint_circle["circle-blur"]),"circle-opacity":new Vt(Ye.paint_circle["circle-opacity"]),"circle-translate":new Mt(Ye.paint_circle["circle-translate"]),"circle-translate-anchor":new Mt(Ye.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Mt(Ye.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Mt(Ye.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Vt(Ye.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Vt(Ye.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Vt(Ye.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Mt(Ye.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"})}))},o,a,u)}createBucket(d){return new W(d)}queryRadius(d){const o=d;return qe("circle-radius",this,o)+qe("circle-stroke-width",this,o)+ot(this.paint.get("circle-translate"))}queryIntersectsFeature(d,o,a,u,g,p,y,C){const S=Ct(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,d.pixelToTileUnitsFactor),I=this.paint.get("circle-radius").evaluate(o,a)+this.paint.get("circle-stroke-width").evaluate(o,a);return lu(d,u,p,y,C,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),S,I)}getProgramIds(){return["circle"]}getDefaultProgramParams(d,o,a){const u=Tc(this);return{config:new bl(this,{zoom:o,lut:a}),defines:u,overrideFog:!1}}},heatmap:class extends go{createBucket(d){return new EE(d)}constructor(d,o,a,u){super(d,{layout:SE||(SE=new Br({visibility:new Mt(Ye.layout_heatmap.visibility)})),paint:Tx||(Tx=new Br({"heatmap-radius":new Vt(Ye.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Vt(Ye.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Mt(Ye.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Bo(Ye.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Mt(Ye.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"})}))},o,a,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(d){"heatmap-color"===d&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=lh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(d){return qe("heatmap-radius",this,d)}queryIntersectsFeature(d,o,a,u,g,p,y,C){const S=this.paint.get("heatmap-radius").evaluate(o,a);return lu(d,u,p,y,C,!0,!0,new Ot(0,0),S)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(d,o,a){return"heatmap"===d?{config:new bl(this,{zoom:o,lut:a}),overrideFog:!1}:{}}},hillshade:class extends go{constructor(d,o,a,u){super(d,{layout:$v||($v=new Br({visibility:new Mt(Ye.layout_hillshade.visibility)})),paint:DE||(DE=new Br({"hillshade-illumination-direction":new Mt(Ye.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Mt(Ye.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Mt(Ye.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Mt(Ye.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Mt(Ye.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Mt(Ye.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Mt(Ye.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"})}))},o,a,u)}shouldRedrape(){return this.hasOffscreenPass()&&"viewport"===this.paint.get("hillshade-illumination-anchor")}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(d,o,a){return{overrideFog:!1}}},fill:class extends go{constructor(d,o,a,u){super(d,{layout:zx||(zx=new Br({"fill-sort-key":new Vt(Ye.layout_fill["fill-sort-key"]),visibility:new Mt(Ye.layout_fill.visibility),"fill-elevation-reference":new Mt(Ye.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Vt(Ye.layout_fill["fill-construct-bridge-guard-rail"])})),paint:eb||(eb=new Br({"fill-antialias":new Mt(Ye.paint_fill["fill-antialias"]),"fill-opacity":new Vt(Ye.paint_fill["fill-opacity"]),"fill-color":new Vt(Ye.paint_fill["fill-color"]),"fill-outline-color":new Vt(Ye.paint_fill["fill-outline-color"]),"fill-translate":new Mt(Ye.paint_fill["fill-translate"]),"fill-translate-anchor":new Mt(Ye.paint_fill["fill-translate-anchor"]),"fill-pattern":new Vt(Ye.paint_fill["fill-pattern"]),"fill-emissive-strength":new Mt(Ye.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Vt(Ye.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Vt(Ye.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Vt(Ye.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"})}))},o,a,u)}getProgramIds(){const d=this.paint.get("fill-pattern"),o=d&&d.constantOr(1),a=[o?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&a.push(o&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),a}getDefaultProgramParams(d,o,a){return{config:new bl(this,{zoom:o,lut:a}),overrideFog:!1}}recalculate(d,o){super.recalculate(d,o);const a=this.paint._values["fill-outline-color"];"constant"===a.value.kind&&void 0===a.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(d){return new Qm(d)}queryRadius(){return ot(this.paint.get("fill-translate"))}queryIntersectsFeature(d,o,a,u,g,p){return!d.queryGeometry.isAboveHorizon&&oe(lt(d.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,d.pixelToTileUnitsFactor),u)}isTileClipped(){return 0===this.paint.get("fill-z-offset").constantOr(1)}is3D(d){if(0!==this.paint.get("fill-z-offset").constantOr(1))return!0;const o=this.layout&&"none"!==this.layout.get("fill-elevation-reference");return null!=d?o&&!d:o}},"fill-extrusion":class extends go{constructor(d,o,a,u){super(d,{layout:cb||(cb=new Br({visibility:new Mt(Ye["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Mt(Ye["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:db||(db=new Br({"fill-extrusion-opacity":new Mt(Ye["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Vt(Ye["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Mt(Ye["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Mt(Ye["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Vt(Ye["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Vt(Ye["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Vt(Ye["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Mt(Ye["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Mt(Ye["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Mt(Ye["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Mt(Ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Mt(Ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Mt(Ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Mt(Ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Mt(Ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Mt(Ye["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Mt(Ye["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Vt(Ye["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Vt(Ye["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Mt(Ye["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Mt(Ye["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Mt(Ye["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Mt(Ye["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Vt(Ye["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Vt(Ye["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Mt(Ye["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"})}))},o,a,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(d){return new sb(d)}queryRadius(){return ot(this.paint.get("fill-extrusion-translate"))}is3D(d){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(d,o,a,u,g,p,y,C,S){const I=Ct(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,d.pixelToTileUnitsFactor),b=this.paint.get("fill-extrusion-height").evaluate(o,a),D=this.paint.get("fill-extrusion-base").evaluate(o,a),k=[0,0],T=C&&p.elevation,A=p.elevation?p.elevation.exaggeration():1,O=d.tile.getBucket(this);if(T&&O instanceof sb){const H=O.centroidVertexArray,Z=S+1;Z<H.length&&(k[0]=H.geta_centroid_pos0(Z),k[1]=H.geta_centroid_pos1(Z))}if(0===k[0]&&1===k[1])return!1;"globe"===p.projection.name&&(u=bI([u],[new Ot(0,0),new Ot(kt,kt)],d.tileID.canonical).map(H=>H.polygon).flat());const B=T?C:null,[V,q]=(Z=u,ee=D,ie=b,me=I,ue=y,pe=B,Te=k,_e=A,Ie=p.center.lat,"globe"===(H=p).projection.name?function(Fe,Ve,ze,We,Ue,Ze,ht,ut,qt,gt,yt){const pt=[],fn=[],Ut=Fe.projection.upVectorScale(yt,Fe.center.lat,Fe.worldSize).metersToTile,Jt=[0,0,0,1],xn=[0,0,0,1],Bn=(ti,Vn,ui,Si)=>{ti[0]=Vn,ti[1]=ui,ti[2]=Si,ti[3]=1},En=GE();ze>0&&(ze+=En),We+=En;for(const ti of Ve){const Vn=[],ui=[];for(const Si of ti){const Ui=Si.x+Ue.x,wn=Si.y+Ue.y,hi=Fe.projection.projectTilePoint(Ui,wn,yt),lr=Fe.projection.upVector(yt,Si.x,Si.y);let Cr=ze,ft=We;if(ht){const Or=H_(Ui,wn,ze,We,ht,ut,qt,gt);Cr+=Or.base,ft+=Or.top}0!==ze?Bn(Jt,hi.x+lr[0]*Ut*Cr,hi.y+lr[1]*Ut*Cr,hi.z+lr[2]*Ut*Cr):Bn(Jt,hi.x,hi.y,hi.z),Bn(xn,hi.x+lr[0]*Ut*ft,hi.y+lr[1]*Ut*ft,hi.z+lr[2]*Ut*ft),ge.vec3.transformMat4(Jt,Jt,Ze),ge.vec3.transformMat4(xn,xn,Ze),Vn.push(new eg(Jt[0],Jt[1],Jt[2])),ui.push(new eg(xn[0],xn[1],xn[2]))}pt.push(Vn),fn.push(ui)}return[pt,fn]}(H,Z,ee,ie,me,ue,pe,Te,_e,Ie,d.tileID.canonical):pe?function(Fe,Ve,ze,We,Ue,Ze,ht,ut,qt){const gt=[],yt=[],pt=[0,0,0,1];for(const fn of Fe){const Ut=[],Jt=[];for(const xn of fn){const Bn=xn.x+We.x,En=xn.y+We.y,ti=H_(Bn,En,Ve,ze,Ze,ht,ut,qt);pt[0]=Bn,pt[1]=En,pt[2]=ti.base,pt[3]=1,ge.vec4.transformMat4(pt,pt,Ue),pt[3]=Math.max(pt[3],1e-5);const Vn=new eg(pt[0]/pt[3],pt[1]/pt[3],pt[2]/pt[3]);pt[0]=Bn,pt[1]=En,pt[2]=ti.top,pt[3]=1,ge.vec4.transformMat4(pt,pt,Ue),pt[3]=Math.max(pt[3],1e-5);const ui=new eg(pt[0]/pt[3],pt[1]/pt[3],pt[2]/pt[3]);Ut.push(Vn),Jt.push(ui)}gt.push(Ut),yt.push(Jt)}return[gt,yt]}(Z,ee,ie,me,ue,pe,Te,_e,Ie):function(Fe,Ve,ze,We,Ue){const Ze=[],ht=[],ut=Ue[8]*Ve,qt=Ue[9]*Ve,gt=Ue[10]*Ve,yt=Ue[11]*Ve,pt=Ue[8]*ze,fn=Ue[9]*ze,Ut=Ue[10]*ze,Jt=Ue[11]*ze;for(const xn of Fe){const Bn=[],En=[];for(const ti of xn){const Vn=ti.x+We.x,ui=ti.y+We.y,Si=Ue[0]*Vn+Ue[4]*ui+Ue[12],Ui=Ue[1]*Vn+Ue[5]*ui+Ue[13],wn=Ue[2]*Vn+Ue[6]*ui+Ue[14],hi=Ue[3]*Vn+Ue[7]*ui+Ue[15],lr=Si+ut,Cr=Ui+qt,ft=wn+gt,Or=Math.max(hi+yt,1e-5),Ki=Si+pt,ko=Ui+fn,ta=wn+Ut,co=Math.max(hi+Jt,1e-5);Bn.push(new eg(lr/Or,Cr/Or,ft/Or)),En.push(new eg(Ki/co,ko/co,ta/co))}Ze.push(Bn),ht.push(En)}return[Ze,ht]}(Z,ee,ie,me,ue)),G=d.queryGeometry;var H,Z,ee,ie,me,ue,pe,Te,_e,Ie;return function(H,Z,ee){let ie=1/0;oe(ee,Z)&&(ie=j_(ee,Z[0]));for(let me=0;me<Z.length;me++){const ue=Z[me],pe=H[me];for(let Te=0;Te<ue.length-1;Te++){const _e=ue[Te],Ie=[_e,ue[Te+1],pe[Te+1],pe[Te],_e];ne(ee,Ie)&&(ie=Math.min(ie,j_(ee,Ie)))}}return ie!==1/0&&ie}(V,q,G.isPointQuery()?G.screenBounds:G.screenGeometry)}},line:class extends go{constructor(d,o,a,u){const g=G_();super(d,g,o,a,u),g.layout&&(this.layout=new tr(g.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(d){if("line-gradient"===d){const o=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=o._styleExpression&&o._styleExpression.expression instanceof hl,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(d,o){super.recalculate(d,o),this.paint._values["line-floorwidth"]=(()=>{if(W_)return W_;const a=G_();return W_=new q_(a.paint.properties["line-width"].specification),W_.useIntegerZoom=!0,W_})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,d)}createBucket(d){return new ew(d)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(d,o,a){const u=CI(this);return{config:new bl(this,{zoom:o,lut:a}),defines:u,overrideFog:!1}}queryRadius(d){const o=d,a=iw(qe("line-width",this,o),qe("line-gap-width",this,o)),u=qe("line-offset",this,o);return a/2+Math.abs(u)+ot(this.paint.get("line-translate"))}queryIntersectsFeature(d,o,a,u,g,p){if(d.queryGeometry.isAboveHorizon)return!1;const y=lt(d.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,d.pixelToTileUnitsFactor),C=d.pixelToTileUnitsFactor/2*iw(this.paint.get("line-width").evaluate(o,a),this.paint.get("line-gap-width").evaluate(o,a)),S=this.paint.get("line-offset").evaluate(o,a);return S&&(u=function(I,b){const D=[],k=new Ot(0,0);for(let T=0;T<I.length;T++){const A=I[T],O=[];for(let B=0;B<A.length;B++){const V=A[B],q=A[B+1],G=0===B?k:V.sub(A[B-1])._unit()._perp(),H=B===A.length-1?k:q.sub(V)._unit()._perp(),Z=G._add(H)._unit();Z._mult(1/(Z.x*H.x+Z.y*H.y)),O.push(Z._mult(b)._add(V))}D.push(O)}return D}(u,S*d.pixelToTileUnitsFactor)),function(I,b,D){for(let k=0;k<b.length;k++){const T=b[k];if(I.length>=3)for(let A=0;A<T.length;A++)if(De(I,T[A]))return!0;if(se(I,T,D))return!0}return!1}(y,u,C)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(d){return!this.hasElevatedBuckets}},symbol:Ab,background:class extends go{constructor(d,o,a,u){super(d,{layout:ay||(ay=new Br({visibility:new Mt(Ye.layout_background.visibility)})),paint:ly||(ly=new Br({"background-pitch-alignment":new Mt(Ye.paint_background["background-pitch-alignment"]),"background-color":new Mt(Ye.paint_background["background-color"]),"background-pattern":new Mt(Ye.paint_background["background-pattern"]),"background-opacity":new Mt(Ye.paint_background["background-opacity"]),"background-emissive-strength":new Mt(Ye.paint_background["background-emissive-strength"]),"background-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"})}))},o,a,u)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(d,o,a){return{overrideFog:!1}}is3D(d){return"viewport"===this.paint.get("background-pitch-alignment")}},raster:qI,"raster-particle":MS,sky:class extends go{constructor(d,o,a,u){super(d,{layout:WI||(WI=new Br({visibility:new Mt(Ye.layout_sky.visibility)})),paint:DS||(DS=new Br({"sky-type":new Mt(Ye.paint_sky["sky-type"]),"sky-atmosphere-sun":new Mt(Ye.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Mt(Ye.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Mt(Ye.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Mt(Ye.paint_sky["sky-gradient-radius"]),"sky-gradient":new Bo(Ye.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Mt(Ye.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Mt(Ye.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Mt(Ye.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"})}))},o,a,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(d){"sky-gradient"===d?this._updateColorRamp():"sky-atmosphere-sun"!==d&&"sky-atmosphere-halo-color"!==d&&"sky-atmosphere-color"!==d&&"sky-atmosphere-sun-intensity"!==d||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=lh({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(d){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const o=d.style.light.properties.get("position");return this._lightPosition.azimuthal!==o.azimuthal||this._lightPosition.polar!==o.polar}return!1}getCenter(d,o){if("atmosphere"===this.paint.get("sky-type")){const u=this.paint.get("sky-atmosphere-sun"),g=!u,p=d.style.light,y=p.properties.get("position");return g&&"viewport"===p.properties.get("anchor")&&Ir("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),g?Vw(y.azimuthal,90-y.polar,o):Vw(u[0],90-u[1],o)}const a=this.paint.get("sky-gradient-center");return Vw(a[0],90-a[1],o)}isSky(){return!0}markSkyboxValid(d){this._skyboxInvalidated=!1,this._lightPosition=d.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const d=this.paint.get("sky-type");return"atmosphere"===d?["skyboxCapture","skybox"]:"gradient"===d?["skyboxGradient"]:null}},slot:class extends go{constructor(d,o,a,u){super(d,{paint:zw||(zw=new Br({}))},o,null)}},model:class extends go{constructor(d,o,a,u){super(d,{layout:PS||(PS=new Br({visibility:new Mt(Ye.layout_model.visibility),"model-id":new Vt(Ye.layout_model["model-id"])})),paint:Ww||(Ww=new Br({"model-opacity":new Vt(Ye.paint_model["model-opacity"]),"model-rotation":new Vt(Ye.paint_model["model-rotation"]),"model-scale":new Vt(Ye.paint_model["model-scale"]),"model-translation":new Vt(Ye.paint_model["model-translation"]),"model-color":new Vt(Ye.paint_model["model-color"]),"model-color-mix-intensity":new Vt(Ye.paint_model["model-color-mix-intensity"]),"model-type":new Mt(Ye.paint_model["model-type"]),"model-cast-shadows":new Mt(Ye.paint_model["model-cast-shadows"]),"model-receive-shadows":new Mt(Ye.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Mt(Ye.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Vt(Ye.paint_model["model-emissive-strength"]),"model-roughness":new Vt(Ye.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Vt(Ye.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Mt(Ye.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Mt(Ye.paint_model["model-front-cutoff"]),"model-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"})}))},o,a,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(d){return new qw(d)}getProgramIds(){return["model"]}is3D(d){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(d){return d instanceof Vb?8191:0}queryIntersectsFeature(d,o,a,u,g,p){if(!this.modelManager)return!1;const y=this.modelManager,C=d.tile.getBucket(this);if(!(C&&C instanceof qw))return!1;for(const S in C.instancesPerModel){const I=C.instancesPerModel[S],b=void 0!==o.id?o.id:o.properties&&o.properties.hasOwnProperty("id")?o.properties.id:void 0;if(I.idToFeaturesIndex.hasOwnProperty(b)){const D=I.features[I.idToFeaturesIndex[b]],k=y.getModel(S,this.scope);if(!k)return!1;let T=ge.mat4.create();const A=new Ri(0,0),O=C.canonical;let B=Number.MAX_VALUE;for(let V=0;V<D.instancedDataCount;++V){const q=16*(D.instancedDataOffset+V),G=I.instancedDataArray.float32,H=[G[q+4],G[q+5],G[q+6]];FS(O,A,G[q],0|G[q+1]),Yw(T,k,p,A,D.rotation,D.scale,H,!1,!1,!1),"globe"===p.projection.name&&(T=Fb(T,p));const Z=ge.mat4.multiply([],p.projMatrix,T),ee=d.queryGeometry,ie=kS(ee.isPointQuery()?ee.screenBounds:ee.screenGeometry,p,Z,k.aabb);null!=ie&&(B=Math.min(ie,B))}return B!==Number.MAX_VALUE&&B}}return!1}_handleOverridablePaintPropertyUpdate(d,o,a){return!(!this.layout||o.isDataDriven()||a.isDataDriven()||"model-color"!==d&&"model-color-mix-intensity"!==d&&"model-rotation"!==d&&"model-scale"!==d&&"model-translation"!==d&&"model-emissive-strength"!==d)}_isPropertyZoomDependent(d){const o=this._transitionablePaint._values[d];return null!=o&&null!=o.value&&null!=o.value.expression&&o.value.expression instanceof zr}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends go{constructor(d,o,a,u){super(d,{layout:kf||(kf=new Br({"clip-layer-types":new Mt(Ye.layout_clip["clip-layer-types"]),"clip-layer-scope":new Mt(Ye.layout_clip["clip-layer-scope"])})),paint:Bx||(Bx=new Br({}))},o,a,u)}recalculate(d,o){super.recalculate(d,o)}createBucket(d){return new nb(d)}is3D(d){return!0}}};class Dl{constructor(o){this._callback=o,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class JI{constructor(){this.tasks={},this.taskQueue=[],zh(["process"],this),this.invoker=new Dl(this.process),this.nextId=0}add(o,a){const u=this.nextId++,g=function({type:p,isSymbolTile:y,zoom:C}){return C=C||0,"message"===p?0:"maybePrepare"!==p||y?"parseTile"!==p||y?"parseTile"===p&&y?300-C:"maybePrepare"===p&&y?400-C:500:200-C:100-C}(a);if(0===g){try{o()}finally{}return null}return this.tasks[u]={fn:o,metadata:a,priority:g,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;const o=this.pick();if(null===o)return;const a=this.tasks[o];if(delete this.tasks[o],this.taskQueue.length&&this.invoker.trigger(),!a)return;a.fn()}finally{}}pick(){let o=null,a=1/0;for(let g=0;g<this.taskQueue.length;g++){const p=this.tasks[this.taskQueue[g]];p.priority<a&&(a=p.priority,o=g)}if(null===o)return null;const u=this.taskQueue[o];return this.taskQueue.splice(o,1),u}remove(){this.invoker.remove()}}class Xw{constructor(o,a,u){this.target=o,this.parent=a,this.mapId=u,this.callbacks={},this.cancelCallbacks={},zh(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new JI}send(o,a,u,g,p=!1,y){const C=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(u.metadata=y,this.callbacks[C]=u);const S=new Set;return this.target.postMessage({id:C,type:o,hasCallback:!!u,targetMapId:g,mustQueue:p,sourceMapId:this.mapId,data:Jd(a,S)},S),{cancel:()=>{u&&delete this.callbacks[C],this.target.postMessage({id:C,type:"<cancel>",targetMapId:g,sourceMapId:this.mapId})}}}receive(o){const a=o.data;if(!a)return;const u=a.id;if(u&&(!a.targetMapId||this.mapId===a.targetMapId))if("<cancel>"===a.type){const g=this.cancelCallbacks[u];delete this.cancelCallbacks[u],g&&g.cancel()}else if(a.mustQueue||ws()){const g=this.callbacks[u],p=this.scheduler.add(()=>this.processTask(u,a),g&&g.metadata||{type:"message"});p&&(this.cancelCallbacks[u]=p)}else this.processTask(u,a)}processTask(o,a){if(delete this.cancelCallbacks[o],"<response>"===a.type){const u=this.callbacks[o];delete this.callbacks[o],u&&(a.error?u(Vs(a.error)):u(null,Vs(a.data)))}else{const u=new Set,g=a.hasCallback?(y,C)=>{this.target.postMessage({id:o,type:"<response>",sourceMapId:this.mapId,error:y?Jd(y):null,data:Jd(C,u)},u)}:()=>{},p=Vs(a.data);if(this.parent[a.type])this.parent[a.type](a.sourceMapId,p,g);else if(this.parent.getWorkerSource){const y=a.type.split(".");this.parent.getWorkerSource(a.sourceMapId,y[0],p.source,p.scope)[y[1]](p,g)}else g(new Error(`Could not find function ${a.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var Ub={workerUrl:"",workerClass:null,workerParams:void 0};const Kw="mapboxgl_preloaded_worker_pool";let Lf,Rc,jb=(()=>{class d{constructor(){this.active={}}acquire(a,u=d.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<u;)this.workers.push(null!=Ub.workerClass?new Ub.workerClass:new self.Worker(Ub.workerUrl,Ub.workerParams));return this.active[a]=!0,this.workers.slice()}release(a){delete this.active[a],this.workers&&0===this.numActive()&&(this.workers.forEach(u=>{u.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Kw]}numActive(){return Object.keys(this.active).length}}return d.workerCount=2,d})();class fg{constructor(o,a,u="Worker",g=jb.workerCount){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=Mi();const p=this.workerPool.acquire(this.id,g);for(let y=0;y<p.length;y++){const C=new fg.Actor(p[y],a,this.id);C.name=`${u} ${y}`,this.actors.push(C)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(o,a,u){Gc(this.actors,(g,p)=>{g.send(o,a,p)},u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(o=>{o.remove()}),this.actors=[],this.workerPool.release(this.id)}}function mg(){return Lf||(Lf=new jb),Lf}fg.Actor=Xw;const Qw=new Yi(0,0,0);var d,LS=((d=LS||{})[d.PATH_RULE_UNSPECIFIED=0]="PATH_RULE_UNSPECIFIED",d[d.PATH_RULE_NON_ZERO=1]="PATH_RULE_NON_ZERO",d[d.PATH_RULE_EVEN_ODD=2]="PATH_RULE_EVEN_ODD",d),fy=(d=>(d[d.LINE_CAP_UNSPECIFIED=0]="LINE_CAP_UNSPECIFIED",d[d.LINE_CAP_BUTT=1]="LINE_CAP_BUTT",d[d.LINE_CAP_ROUND=2]="LINE_CAP_ROUND",d[d.LINE_CAP_SQUARE=3]="LINE_CAP_SQUARE",d))(fy||{}),Nf=(d=>(d[d.LINE_JOIN_UNSPECIFIED=0]="LINE_JOIN_UNSPECIFIED",d[d.LINE_JOIN_MITER=1]="LINE_JOIN_MITER",d[d.LINE_JOIN_MITER_CLIP=2]="LINE_JOIN_MITER_CLIP",d[d.LINE_JOIN_ROUND=3]="LINE_JOIN_ROUND",d[d.LINE_JOIN_BEVEL=4]="LINE_JOIN_BEVEL",d))(Nf||{}),Hb=(d=>(d[d.PAINT_ORDER_UNSPECIFIED=0]="PAINT_ORDER_UNSPECIFIED",d[d.PAINT_ORDER_FILL_AND_STROKE=1]="PAINT_ORDER_FILL_AND_STROKE",d[d.PAINT_ORDER_STROKE_AND_FILL=2]="PAINT_ORDER_STROKE_AND_FILL",d))(Hb||{}),gg=(d=>(d[d.PATH_COMMAND_UNSPECIFIED=0]="PATH_COMMAND_UNSPECIFIED",d[d.PATH_COMMAND_MOVE=1]="PATH_COMMAND_MOVE",d[d.PATH_COMMAND_LINE=2]="PATH_COMMAND_LINE",d[d.PATH_COMMAND_QUAD=3]="PATH_COMMAND_QUAD",d[d.PATH_COMMAND_CUBIC=4]="PATH_COMMAND_CUBIC",d[d.PATH_COMMAND_CLOSE=5]="PATH_COMMAND_CLOSE",d))(gg||{}),NS=(d=>(d[d.MASK_TYPE_UNSPECIFIED=0]="MASK_TYPE_UNSPECIFIED",d[d.MASK_TYPE_LUMINANCE=1]="MASK_TYPE_LUMINANCE",d[d.MASK_TYPE_ALPHA=2]="MASK_TYPE_ALPHA",d))(NS||{});function $b(d,o,a){var u,g;1===d&&o.icons.push((u=a,g=a.readVarint()+a.pos,function(p){if(p.usvg_tree.height||(p.usvg_tree.height=p.usvg_tree.width),!p.metadata)return p;const{metadata:y}=p;if(y.content_area){const{content_area:C}=y;null==C.top&&(C.top=C.left),null==C.width&&(C.width=p.usvg_tree.width),null==C.height&&(C.height=C.width)}return y.stretch_x&&y.stretch_x.length&&zS(y,"x"),y.stretch_y&&y.stretch_y.length&&zS(y,"y"),p}(u.readFields(_g,{name:void 0},g))))}function zS(d,o){const a=[],u=d[`stretch_${o}`];let g=null;for(let p=0;p<u.length;p++)null===g?g=0===a.length?u[0]:a[a.length-1][1]+u[p]:(a.push([g,g+u[p]]),g=null);d[`stretch_${o}_areas`]=a}function _g(d,o,a){var u,g;1===d?o.name=a.readString():2===d?o.metadata=(u=a,g=a.readVarint()+a.pos,u.readFields(zf,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},g)):3===d&&(o.usvg_tree=function(u,g){return u.readFields(eA,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},g)}(a,a.readVarint()+a.pos),o.data="usvg_tree")}function zf(d,o,a){var u,g;1===d?o.stretch_x=a.readPackedVarint():2===d?o.stretch_y=a.readPackedVarint():3===d?o.content_area=(u=a,g=a.readVarint()+a.pos,u.readFields(Jw,{left:0},g)):4===d&&o.variables.push(function(u,g){return u.readFields(e1,{name:void 0},g)}(a,a.readVarint()+a.pos))}function Jw(d,o,a){1===d?o.left=a.readVarint():2===d?o.width=a.readVarint():3===d?o.top=a.readVarint():4===d&&(o.height=a.readVarint())}function e1(d,o,a){1===d?o.name=a.readString():2===d&&(o.rgb_color=vg(a.readVarint()),o.value="rgb_color")}function eA(d,o,a){var u,g;1===d?o.width=o.height=a.readVarint():2===d?o.height=a.readVarint():3===d?o.children.push(xd(a,a.readVarint()+a.pos)):4===d?o.linear_gradients.push((u=a,g=a.readVarint()+a.pos,u.readFields(t1,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},g))):5===d?o.radial_gradients.push(function(u,g){return u.readFields(n1,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},g)}(a,a.readVarint()+a.pos)):7===d?o.clip_paths.push(function(u,g){return u.readFields(US,{children:[]},g)}(a,a.readVarint()+a.pos)):8===d&&o.masks.push(function(u,g){const p=u.readFields(jS,{left:0,width:20,mask_type:1,children:[]},g);return null==p.height&&(p.height=p.width),null==p.top&&(p.top=p.left),p}(a,a.readVarint()+a.pos))}function xd(d,o){return d.readFields(Cp,{},o)}function Cp(d,o,a){var u,g;1===d?(o.group=(u=a,g=a.readVarint()+a.pos,u.readFields(yg,{opacity:255,children:[]},g)),o.node="group"):2===d&&(o.path=function(u,g){return u.readFields(BS,{paint_order:1,commands:[],step:1,diffs:[],rule:1},g)}(a,a.readVarint()+a.pos),o.node="path")}function yg(d,o,a){1===d?o.transform=my(a,a.readVarint()+a.pos):2===d?o.opacity=a.readVarint():5===d?o.clip_path_idx=a.readVarint():6===d?o.mask_idx=a.readVarint():7===d&&o.children.push(xd(a,a.readVarint()+a.pos))}function my(d,o){return d.readFields(tA,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},o)}function tA(d,o,a){1===d?o.sx=a.readFloat():2===d?o.ky=a.readFloat():3===d?o.kx=a.readFloat():4===d?o.sy=a.readFloat():5===d?o.tx=a.readFloat():6===d&&(o.ty=a.readFloat())}function BS(d,o,a){var u,g;1===d?o.fill=(u=a,g=a.readVarint()+a.pos,u.readFields(nA,{rgb_color:Qw,paint:"rgb_color",opacity:255},g)):2===d?o.stroke=function(u,g){return u.readFields(gy,{rgb_color:Qw,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},g)}(a,a.readVarint()+a.pos):3===d?o.paint_order=a.readVarint():5===d?a.readPackedVarint(o.commands):6===d?o.step=a.readFloat():7===d?a.readPackedSVarint(o.diffs):8===d&&(o.rule=a.readVarint())}function nA(d,o,a){1===d?(o.rgb_color=vg(a.readVarint()),o.paint="rgb_color"):2===d?(o.linear_gradient_idx=a.readVarint(),o.paint="linear_gradient_idx"):3===d?(o.radial_gradient_idx=a.readVarint(),o.paint="radial_gradient_idx"):5===d&&(o.opacity=a.readVarint())}function vg(d){return new Yi((d>>16&255)/255,(d>>8&255)/255,(255&d)/255,1)}function gy(d,o,a){1===d?(o.rgb_color=vg(a.readVarint()),o.paint="rgb_color"):2===d?(o.linear_gradient_idx=a.readVarint(),o.paint="linear_gradient_idx"):3===d?(o.radial_gradient_idx=a.readVarint(),o.paint="radial_gradient_idx"):5===d?a.readPackedFloat(o.dasharray):6===d?o.dashoffset=a.readFloat():7===d?o.miterlimit=a.readFloat():8===d?o.opacity=a.readVarint():9===d?o.width=a.readFloat():10===d?o.linecap=a.readVarint():11===d&&(o.linejoin=a.readVarint())}function t1(d,o,a){1===d?o.transform=my(a,a.readVarint()+a.pos):2===d?o.spread_method=a.readVarint():3===d?o.stops.push(VS(a,a.readVarint()+a.pos)):4===d?o.x1=a.readFloat():5===d?o.y1=a.readFloat():6===d?o.x2=a.readFloat():7===d&&(o.y2=a.readFloat())}function VS(d,o){return d.readFields(iA,{offset:0,opacity:255,rgb_color:Qw},o)}function iA(d,o,a){1===d?o.offset=a.readFloat():2===d?o.opacity=a.readVarint():3===d&&(o.rgb_color=vg(a.readVarint()))}function n1(d,o,a){1===d?o.transform=my(a,a.readVarint()+a.pos):2===d?o.spread_method=a.readVarint():3===d?o.stops.push(VS(a,a.readVarint()+a.pos)):4===d?o.cx=a.readFloat():5===d?o.cy=a.readFloat():6===d?o.r=a.readFloat():7===d?o.fx=a.readFloat():8===d?o.fy=a.readFloat():9===d&&(o.fr=a.readFloat())}function US(d,o,a){1===d?o.transform=my(a,a.readVarint()+a.pos):2===d?o.clip_path_idx=a.readVarint():3===d&&o.children.push(xd(a,a.readVarint()+a.pos))}function jS(d,o,a){1===d?o.left=o.top=a.readFloat():2===d?o.width=o.height=a.readFloat():3===d?o.top=a.readFloat():4===d?o.height=a.readFloat():5===d?o.mask_type=a.readVarint():6===d?o.mask_idx=a.readVarint():7===d&&o.children.push(xd(a,a.readVarint()+a.pos))}class HS{static calculate(o={},a=[]){const u=new Map,g=new Map;if(0===Object.keys(o).length)return u;a.forEach(p=>{g.set(p.name,p.rgb_color||new Yi(0,0,0))});for(const[p,y]of Object.entries(o))g.has(p)?u.set(g.get(p).toStringPremultipliedAlpha(),y):console.warn(`Ignoring unknown image variable "${p}"`);return u}}function Bf(d,o=255,a){const u=o/255,g=d.toStringPremultipliedAlpha(),p=a.has(g)?a.get(g).clone():d.clone();return p.a*=u,p.toString()}function Vf(d,o){if(!Qe()){const a=document.createElement("canvas");return a.width=d,a.height=o,a}return new OffscreenCanvas(d,o)}function $S(d,o){const a=HS.calculate(o.params,d.metadata?d.metadata.variables:[]),u=d.usvg_tree,g=u.width,p=u.height,y=o.transform?o.transform:new DOMMatrix,C=Math.max(1,Math.round(g*y.a)),S=Math.max(1,Math.round(p*y.d)),I=new DOMMatrix([C/g,0,0,S/p,0,0]),b=Vf(C,S).getContext("2d");return bg(b,I,u,u,a),b.getImageData(0,0,C,S)}function bg(d,o,a,u,g){for(const p of u.children)Ep(d,o,a,p,g)}function Ep(d,o,a,u,g){u.group?(d.save(),function(p,y,C,S,I){const b=null!=S.mask_idx?C.masks[S.mask_idx]:null,D=null!=S.clip_path_idx?C.clip_paths[S.clip_path_idx]:null;if(S.transform&&(y=_h(S.transform).preMultiplySelf(y)),255===S.opacity&&!(null!=D)&&!(null!=b))return void bg(p,y,C,S,I);const k=Vf(p.canvas.width,p.canvas.height),T=k.getContext("2d");bg(T,y,C,S,I),D&&qS(T,y,C,D),b&&WS(T,y,C,b,I),p.globalAlpha=S.opacity/255,p.drawImage(k,0,0)}(d,o,a,u.group,g),d.restore()):u.path&&(d.save(),function(p,y,C,S,I){const b=Wb(S);p.setTransform(y),S.paint_order===Hb.PAINT_ORDER_FILL_AND_STROKE?(i1(p,C,S,b,I),qb(p,C,S,b,I)):(qb(p,C,S,b,I),i1(p,C,S,b,I))}(d,o,a,u.path,g),d.restore())}function i1(d,o,a,u,g){const p=a.fill;if(!p)return;const y=p.opacity/255;switch(p.paint){case"rgb_color":d.fillStyle=Bf(p.rgb_color,p.opacity,g);break;case"linear_gradient_idx":d.fillStyle=_y(d,o.linear_gradients[p.linear_gradient_idx],y,g);break;case"radial_gradient_idx":d.fillStyle=GS(d,o.radial_gradients[p.radial_gradient_idx],y,g)}d.fill(u,Gb(a))}function Gb(d){return d.rule===LS.PATH_RULE_NON_ZERO?"nonzero":d.rule===LS.PATH_RULE_EVEN_ODD?"evenodd":void 0}function qb(d,o,a,u,g){const p=a.stroke;if(!p)return;d.lineWidth=p.width,d.miterLimit=p.miterlimit,d.setLineDash(p.dasharray),d.lineDashOffset=p.dashoffset;const y=p.opacity/255;switch(p.paint){case"rgb_color":d.strokeStyle=Bf(p.rgb_color,p.opacity,g);break;case"linear_gradient_idx":d.strokeStyle=_y(d,o.linear_gradients[p.linear_gradient_idx],y,g);break;case"radial_gradient_idx":d.strokeStyle=GS(d,o.radial_gradients[p.radial_gradient_idx],y,g)}switch(p.linejoin){case Nf.LINE_JOIN_MITER_CLIP:case Nf.LINE_JOIN_MITER:d.lineJoin="miter";break;case Nf.LINE_JOIN_ROUND:d.lineJoin="round";break;case Nf.LINE_JOIN_BEVEL:d.lineJoin="bevel"}switch(p.linecap){case fy.LINE_CAP_BUTT:d.lineCap="butt";break;case fy.LINE_CAP_ROUND:d.lineCap="round";break;case fy.LINE_CAP_SQUARE:d.lineCap="square"}d.stroke(u)}function _y(d,o,a,u){if(1===o.stops.length){const k=o.stops[0];return Bf(k.rgb_color,k.opacity*a,u)}const g=_h(o.transform),{x1:p,y1:y,x2:C,y2:S}=o,I=g.transformPoint(new DOMPoint(p,y)),b=g.transformPoint(new DOMPoint(C,S)),D=d.createLinearGradient(I.x,I.y,b.x,b.y);for(const k of o.stops)D.addColorStop(k.offset,Bf(k.rgb_color,k.opacity*a,u));return D}function GS(d,o,a,u){if(1===o.stops.length){const k=o.stops[0];return Bf(k.rgb_color,k.opacity*a,u)}const g=_h(o.transform),{fx:p,fy:y,cx:C,cy:S}=o,I=g.transformPoint(new DOMPoint(p,y)),b=g.transformPoint(new DOMPoint(C,S)),D=d.createRadialGradient(I.x,I.y,0,b.x,b.y,o.r*((g.a+g.d)/2));for(const k of o.stops)D.addColorStop(k.offset,Bf(k.rgb_color,k.opacity*a,u));return D}function r1(d,o,a,u){const g=u.transform?_h(u.transform).preMultiplySelf(o):o,p=Vf(d.canvas.width,d.canvas.height),y=p.getContext("2d");for(const S of u.children)if(S.group)r1(y,g,a,S.group);else if(S.path){const I=S.path,b=new Path2D;b.addPath(Wb(I),g),y.fill(b,Gb(I))}const C=null!=u.clip_path_idx?a.clip_paths[u.clip_path_idx]:null;C&&qS(y,g,a,C),d.globalCompositeOperation="source-over",d.drawImage(p,0,0)}function qS(d,o,a,u){const g=Vf(d.canvas.width,d.canvas.height);r1(g.getContext("2d"),o,a,u),d.globalCompositeOperation="destination-in",d.drawImage(g,0,0)}function WS(d,o,a,u,g){if(0===u.children.length)return;const p=null!=u.mask_idx?a.masks[u.mask_idx]:null;p&&WS(d,o,a,p,g);const y=d.canvas.width,C=d.canvas.height,S=Vf(y,C),I=S.getContext("2d"),b=u.width,D=u.height,k=u.left,T=u.top,A=new Path2D,O=new Path2D;O.rect(k,T,b,D),A.addPath(O,o),I.clip(A);for(const q of u.children)Ep(I,o,a,q,g);const B=I.getImageData(0,0,y,C),V=B.data;if(u.mask_type===NS.MASK_TYPE_LUMINANCE)for(let q=0;q<V.length;q+=4)V[q+3]=V[q+3]/255*(.2126*V[q]+.7152*V[q+1]+.0722*V[q+2]);I.putImageData(B,0,0),d.globalCompositeOperation="destination-in",d.drawImage(S,0,0)}function _h(d){return d?new DOMMatrix([d.sx,d.ky,d.kx,d.sy,d.tx,d.ty]):new DOMMatrix}function Wb(d){const o=new Path2D,a=d.step;let u=d.diffs[0]*a,g=d.diffs[1]*a;o.moveTo(u,g);for(let p=0,y=2;p<d.commands.length;p++)switch(d.commands[p]){case gg.PATH_COMMAND_MOVE:u+=d.diffs[y++]*a,g+=d.diffs[y++]*a,o.moveTo(u,g);break;case gg.PATH_COMMAND_LINE:u+=d.diffs[y++]*a,g+=d.diffs[y++]*a,o.lineTo(u,g);break;case gg.PATH_COMMAND_QUAD:{const C=u+d.diffs[y++]*a,S=g+d.diffs[y++]*a;u=C+d.diffs[y++]*a,g=S+d.diffs[y++]*a,o.quadraticCurveTo(C,S,u,g);break}case gg.PATH_COMMAND_CUBIC:{const C=u+d.diffs[y++]*a,S=g+d.diffs[y++]*a,I=C+d.diffs[y++]*a,b=S+d.diffs[y++]*a;u=I+d.diffs[y++]*a,g=b+d.diffs[y++]*a,o.bezierCurveTo(C,S,I,b,u,g);break}case gg.PATH_COMMAND_CLOSE:o.closePath()}return o}class yy{constructor(o){this.capacity=o,this.cache=new Map}get(o){if(!this.cache.has(o))return;const a=this.cache.get(o);return this.cache.delete(o),this.cache.set(o,a),a}put(o,a){this.cache.has(o)?this.cache.delete(o):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(o,a)}delete(o){this.cache.delete(o)}}Zt(yy,"LRUCache");class Yb{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(o){return new Ho(o,o.data)}getFromCache(o,a,u){return this.cacheMap.has(u)||this.cacheMap.set(u,new yy(150)),this.cacheMap.get(u).get(tu(o.toString(),a))}setInCache(o,a,u,g){this.cacheDependenciesMap.has(g)||this.cacheDependenciesMap.set(g,new Map),this.cacheMap.has(g)||this.cacheMap.set(g,new yy(150));const p=this.cacheDependenciesMap.get(g),y=tu(o.id.toString(),u);p.get(y)||p.set(y,new Set);const C=this.cacheMap.get(g),S=o.toString();p.get(y).add(S),C.put(tu(o.toString(),u),a)}removeImagesFromCacheByIds(o,a,u=0){if(!this.cacheMap.has(u)||!this.cacheDependenciesMap.has(u))return;const g=this.cacheMap.get(u),p=this.cacheDependenciesMap.get(u);for(const y of o){const C=tu(y.toString(),a);if(p.has(C)){for(const S of p.get(C))g.delete(S);p.delete(C)}}}rasterize(o,a,u,g,p=$S){const y=this.getFromCache(o,u,g);if(y)return y.clone();const C=p(a.icon,o.options),S=Yb._getImage(C);return this.setInCache(o,S,u,g),S.clone()}}class YS{constructor(o){this.size=o,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(o,a){const u=this.toIdx(o,a);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(o,a){return this.leaves[this.toIdx(o,a)]}toIdx(o,a){return a*this.size+o}}function ZS(d,o,a,u){let g=0,p=Number.MAX_VALUE;for(let y=0;y<3;y++)if(Math.abs(u[y])<1e-15){if(a[y]<d[y]||a[y]>o[y])return null}else{const C=1/u[y];let S=(d[y]-a[y])*C,I=(o[y]-a[y])*C;if(S>I){const b=S;S=I,I=b}if(S>g&&(g=S),I<p&&(p=I),g>p)return null}return g}function XS(d,o,a,u,g,p,y,C,S,I,b){const D=u-d,k=g-o,T=p-a,A=y-d,O=C-o,B=S-a,V=b[1]*B-b[2]*O,q=b[2]*A-b[0]*B,G=b[0]*O-b[1]*A,H=D*V+k*q+T*G;if(Math.abs(H)<1e-15)return null;const Z=1/H,ee=I[0]-d,ie=I[1]-o,me=I[2]-a,ue=(ee*V+ie*q+me*G)*Z;if(ue<0||ue>1)return null;const pe=ie*T-me*k,Te=me*D-ee*T,_e=ee*k-ie*D,Ie=(b[0]*pe+b[1]*Te+b[2]*_e)*Z;return Ie<0||ue+Ie>1?null:(A*pe+O*Te+B*_e)*Z}function KS(d,o,a){return(d-o)/(a-o)}function QS(d,o,a,u,g,p,y,C,S){const I=1<<a,b=p-u,D=y-g,k=(d+1)/I*b+u,T=(o+0)/I*D+g,A=(o+1)/I*D+g;C[0]=(d+0)/I*b+u,C[1]=T,S[0]=k,S[1]=A}class JS{constructor(o){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=o,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const a=function(p){const y=Math.ceil(Math.log2(p.dim/8)),C=[];let S=Math.ceil(Math.pow(2,y));const I=1/S,b=(T,A,O,B,V)=>{const q=B?1:0,G=(T+1)*O-q,H=A*O,Z=(A+1)*O-q;V[0]=T*O,V[1]=H,V[2]=G,V[3]=Z};let D=new YS(S);const k=[];for(let T=0;T<S*S;T++){b(T%S,Math.floor(T/S),I,!1,k);const A=yh(k[0],k[1],p),O=yh(k[2],k[1],p),B=yh(k[2],k[3],p),V=yh(k[0],k[3],p);D.minimums.push(Math.min(A,O,B,V)),D.maximums.push(Math.max(A,O,B,V)),D.leaves.push(1)}for(C.push(D),S/=2;S>=1;S/=2){const T=C[C.length-1];D=new YS(S);for(let A=0;A<S*S;A++){b(A%S,Math.floor(A/S),2,!0,k);const O=T.getElevation(k[0],k[1]),B=T.getElevation(k[2],k[1]),V=T.getElevation(k[2],k[3]),q=T.getElevation(k[0],k[3]),G=T.isLeaf(k[0],k[1]),H=T.isLeaf(k[2],k[1]),Z=T.isLeaf(k[2],k[3]),ee=T.isLeaf(k[0],k[3]),ie=Math.min(O.min,B.min,V.min,q.min),me=Math.max(O.max,B.max,V.max,q.max),ue=G&&H&&Z&&ee;D.maximums.push(me),D.minimums.push(ie),D.leaves.push(me-ie<=5&&ue?1:0)}C.push(D)}return C}(this.dem),u=a.length-1,g=a[u];this._addNode(g.minimums[0],g.maximums[0],g.leaves[0]),this._construct(a,0,0,u,0)}raycastRoot(o,a,u,g,p,y,C=1){return ZS([o,a,-100],[u,g,this.maximums[0]*C],p,y)}raycast(o,a,u,g,p,y,C=1){if(!this.nodeCount)return null;const S=this.raycastRoot(o,a,u,g,p,y,C);if(null==S)return null;const I=[],b=[],D=[],k=[],T=[{idx:0,t:S,nodex:0,nodey:0,depth:0}];for(;T.length>0;){const{idx:A,t:O,nodex:B,nodey:V,depth:q}=T.pop();if(this.leaves[A]){QS(B,V,q,o,a,u,g,D,k);const H=1<<q,Z=(B+0)/H,ee=(B+1)/H,ie=(V+0)/H,me=(V+1)/H,ue=yh(Z,ie,this.dem)*C,pe=yh(ee,ie,this.dem)*C,Te=yh(ee,me,this.dem)*C,_e=yh(Z,me,this.dem)*C,Ie=XS(D[0],D[1],ue,k[0],D[1],pe,k[0],k[1],Te,p,y),Le=XS(k[0],k[1],Te,D[0],k[1],_e,D[0],D[1],ue,p,y),Fe=Math.min(null!==Ie?Ie:Number.MAX_VALUE,null!==Le?Le:Number.MAX_VALUE);if(Fe!==Number.MAX_VALUE)return Fe;{const Ve=ge.vec3.scaleAndAdd([],p,y,O);if(o1(ue,pe,_e,Te,KS(Ve[0],D[0],k[0]),KS(Ve[1],D[1],k[1]))>=Ve[2])return O}continue}let G=0;for(let H=0;H<this._siblingOffset.length;H++){QS((B<<1)+this._siblingOffset[H][0],(V<<1)+this._siblingOffset[H][1],q+1,o,a,u,g,D,k),D[2]=-100,k[2]=this.maximums[this.childOffsets[A]+H]*C;const Z=ZS(D,k,p,y);if(null!=Z){const ee=Z;I[H]=ee;let ie=!1;for(let me=0;me<G&&!ie;me++)ee>=I[b[me]]&&(b.splice(me,0,H),ie=!0);ie||(b[G]=H),G++}}for(let H=0;H<G;H++){const Z=b[H];T.push({idx:this.childOffsets[A]+Z,t:I[Z],nodex:(B<<1)+this._siblingOffset[Z][0],nodey:(V<<1)+this._siblingOffset[Z][1],depth:q+1})}}return null}_addNode(o,a,u){return this.minimums.push(o),this.maximums.push(a),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(o,a,u,g,p){if(1===o[g].isLeaf(a,u))return;this.childOffsets[p]||(this.childOffsets[p]=this.nodeCount);const y=g-1,C=o[y];let S=0,I=0;for(let b=0;b<this._siblingOffset.length;b++){const D=2*a+this._siblingOffset[b][0],k=2*u+this._siblingOffset[b][1],T=C.getElevation(D,k),A=C.isLeaf(D,k),O=this._addNode(T.min,T.max,A);A&&(S|=1<<b),I||(I=O)}for(let b=0;b<this._siblingOffset.length;b++)S&1<<b||this._construct(o,2*a+this._siblingOffset[b][0],2*u+this._siblingOffset[b][1],y,I+b)}}function o1(d,o,a,u,g,p){return _n(_n(d,a,p),_n(o,u,p),g)}function yh(d,o,a){const u=a.dim,g=Qn(d*u-.5,0,u-1),p=Qn(o*u-.5,0,u-1),y=Math.floor(g),C=Math.floor(p),S=Math.min(y+1,u-1),I=Math.min(C+1,u-1);return o1(a.get(y,C),a.get(S,C),a.get(y,I),a.get(S,I),g-y,p-C)}const rA={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function Zb(d,o,a){return(256*d*256+256*o+a)/10-1e4}function oA(d,o,a){return 256*d+o+a/256-32768}class vy{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(o,a,u,g=!1){if(this.uid=o,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(u&&"mapbox"!==u&&"terrarium"!==u)return void Ir(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=a.height;const p=this.dim=a.height-2,y=new Uint32Array(a.data.buffer);if(this.pixels=new Uint8Array(a.data.buffer),this.floatView=new Float32Array(a.data.buffer),this.borderReady=g,this._modifiedForSources={},!g){for(let S=0;S<p;S++)y[this._idx(-1,S)]=y[this._idx(0,S)],y[this._idx(p,S)]=y[this._idx(p-1,S)],y[this._idx(S,-1)]=y[this._idx(S,0)],y[this._idx(S,p)]=y[this._idx(S,p-1)];y[this._idx(-1,-1)]=y[this._idx(0,0)],y[this._idx(p,-1)]=y[this._idx(p-1,0)],y[this._idx(-1,p)]=y[this._idx(0,p-1)],y[this._idx(p,p)]=y[this._idx(p-1,p-1)]}const C="terrarium"===u?oA:Zb;for(let S=0;S<y.length;++S){const I=4*S;this.floatView[S]=C(this.pixels[I],this.pixels[I+1],this.pixels[I+2])}this._timestamp=nt.now()}_buildQuadTree(){this._tree=new JS(this)}get(o,a,u=!1){u&&(o=Qn(o,-1,this.dim),a=Qn(a,-1,this.dim));const g=this._idx(o,a);return this.floatView[g]}set(o,a,u){const g=this._idx(o,a),p=this.floatView[g];return this.floatView[g]=u,u-p}static getUnpackVector(o){return rA[o]}_idx(o,a){if(o<-1||o>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(o+1)}static pack(o,a){const u=[0,0,0,0],g=vy.getUnpackVector(a);let p=Math.floor((o+g[3])/g[2]);return u[2]=p%256,p=Math.floor(p/256),u[1]=p%256,p=Math.floor(p/256),u[0]=p,u}getPixels(){return new Za({width:this.stride,height:this.stride},this.pixels)}backfillBorder(o,a,u){if(this.dim!==o.dim)throw new Error("dem dimension mismatch");let g=a*this.dim,p=a*this.dim+this.dim,y=u*this.dim,C=u*this.dim+this.dim;switch(a){case-1:g=p-1;break;case 1:p=g+1}switch(u){case-1:y=C-1;break;case 1:C=y+1}const S=-a*this.dim,I=-u*this.dim;for(let b=y;b<C;b++)for(let D=g;D<p;D++){const k=4*this._idx(D,b),T=4*this._idx(D+S,b+I);this.pixels[k+0]=o.pixels[T+0],this.pixels[k+1]=o.pixels[T+1],this.pixels[k+2]=o.pixels[T+2],this.pixels[k+3]=o.pixels[T+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function eD(d,o,a){var u,g;1===d?o.headerLength=a.readFixed32():2===d?o.x=a.readVarint():3===d?o.y=a.readVarint():4===d?o.z=a.readVarint():5===d&&o.layers.push((u=a,g=a.readVarint()+a.pos,u.readFields(s1,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},g)))}function tD(d,o,a){var u,g;1===d?(o.delta_filter=(u=a,g=a.readVarint()+a.pos,u.readFields(sA,{blockSize:0},g)),o.filter="delta_filter"):2===d?(a.readVarint(),o.filter="zigzag_filter"):3===d?(a.readVarint(),o.filter="bitshuffle_filter"):4===d&&(a.readVarint(),o.filter="byteshuffle_filter")}function sA(d,o,a){1===d&&(o.blockSize=a.readVarint())}function aA(d,o,a){1===d?(a.readVarint(),o.codec="gzip_data"):2===d?(a.readVarint(),o.codec="jpeg_image"):3===d?(a.readVarint(),o.codec="webp_image"):4===d&&(a.readVarint(),o.codec="png_image")}function nD(d,o,a){let u=0,g=0;var p,y;1===d?o.firstByte=a.readFixed64():2===d?o.lastByte=a.readFixed64():3===d?o.filters.push((p=a,y=a.readVarint()+a.pos,p.readFields(tD,{},y))):4===d?o.codec=function(p,y){return p.readFields(aA,{},y)}(a,a.readVarint()+a.pos):5===d?g=a.readFloat():6===d?u=a.readFloat():7===d?o.bands.push(a.readString()):8===d?o.offset=a.readDouble():9===d&&(o.scale=a.readDouble()),0===o.offset&&(o.offset=g),0===o.scale&&(o.scale=u)}function s1(d,o,a){var u,g;1===d?o.version=a.readVarint():2===d?o.name=a.readString():3===d?o.units=a.readString():4===d?o.tileSize=a.readVarint():5===d?o.buffer=a.readVarint():6===d?o.pixelFormat=a.readVarint():7===d&&o.dataIndex.push((u=a,g=a.readVarint()+a.pos,u.readFields(nD,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},g)))}function iD(d,o,a){if(2===d)u=a,g=a.readVarint()+a.pos,u.readFields(lA,o,g);else if(3===d)throw new Error("Not implemented");var u,g}function lA(d,o,a){if(1===d){let u=0;const g=a.readVarint()+a.pos;for(;a.pos<g;)o[u++]=a.readVarint()}}function by(d,o){if(4!==o.length)throw new Error(`Expected data of dimension 4 but got ${o.length}.`);let a=o[3];for(let u=2;u>=1;u--){const g=1===u?1:0,p=2===u?1:0;for(let y=0;y<o[0];y++){const C=o[1]*y;for(let S=g;S<o[1];S++){const I=o[2]*(S+C);for(let b=p;b<o[2];b++){const D=o[3]*(b+I);for(let k=0;k<o[3];k++){const T=D+k;d[T]+=d[T-a]}}}}a*=o[u]}return d}function rD(d){for(let o=0,a=d.length;o<a;o++)d[o]=d[o]>>>1^-(1&d[o]);return d}function oD(d,o){switch(o){case"uint32":return d;case"uint16":for(let a=0;a<d.length;a+=2){const u=d[a],g=d[a+1];d[a]=(240&u)>>4|(61440&u)>>8|(240&g)<<4|61440&g,d[a+1]=15&u|(3840&u)>>4|(15&g)<<8|(3840&g)<<4}return d;case"uint8":for(let a=0;a<d.length;a+=4){const u=d[a],g=d[a+1],p=d[a+2],y=d[a+3];d[a+0]=(192&u)>>6|(192&g)>>4|(192&p)>>2|192&y,d[a+1]=(48&u)>>4|(48&g)>>2|48&p|(48&y)<<2,d[a+2]=(12&u)>>2|12&g|(12&p)<<2|(12&y)<<4,d[a+3]=3&u|(3&g)<<2|(3&p)<<4|(3&y)<<6}return d;default:throw new Error(`Invalid pixel format, "${o}"`)}}Zt(vy,"DEMData"),Zt(JS,"DemMinMaxQuadTree",{omit:["dem"]});var Hs=Uint8Array,Uf=Uint16Array,xy=Int32Array,sD=new Hs([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),a1=new Hs([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),wy=new Hs([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),cA=function(d,o){for(var a=new Uf(31),u=0;u<31;++u)a[u]=o+=1<<d[u-1];var g=new xy(a[30]);for(u=1;u<30;++u)for(var p=a[u];p<a[u+1];++p)g[p]=p-a[u]<<5|u;return{b:a,r:g}},dA=cA(sD,2),is=dA.b,uA=dA.r;is[28]=258,uA[258]=28;for(var hA=cA(a1,0).b,aD=new Uf(32768),Xr=0;Xr<32768;++Xr){var Sp=(43690&Xr)>>1|(21845&Xr)<<1;aD[Xr]=((65280&(Sp=(61680&(Sp=(52428&Sp)>>2|(13107&Sp)<<2))>>4|(3855&Sp)<<4))>>8|(255&Sp)<<8)>>1}var Cy=function(d,o,a){for(var u=d.length,g=0,p=new Uf(o);g<u;++g)d[g]&&++p[d[g]-1];var y,C=new Uf(o);for(g=1;g<o;++g)C[g]=C[g-1]+p[g-1]<<1;y=new Uf(1<<o);var S=15-o;for(g=0;g<u;++g)if(d[g])for(var I=g<<4|d[g],b=o-d[g],D=C[d[g]-1]++<<b,k=D|(1<<b)-1;D<=k;++D)y[aD[D]>>S]=I;return y},Xb=new Hs(288);for(Xr=0;Xr<144;++Xr)Xb[Xr]=8;for(Xr=144;Xr<256;++Xr)Xb[Xr]=9;for(Xr=256;Xr<280;++Xr)Xb[Xr]=7;for(Xr=280;Xr<288;++Xr)Xb[Xr]=8;var pA=new Hs(32);for(Xr=0;Xr<32;++Xr)pA[Xr]=5;var fA=Cy(Xb,9),mA=Cy(pA,5),lD=function(d){for(var o=d[0],a=1;a<d.length;++a)d[a]>o&&(o=d[a]);return o},wd=function(d,o,a){var u=o/8|0;return(d[u]|d[u+1]<<8)>>(7&o)&a},cD=function(d,o){var a=o/8|0;return(d[a]|d[a+1]<<8|d[a+2]<<16)>>(7&o)},gA=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Cd=function(d,o,a){var u=new Error(o||gA[d]);if(u.code=d,Error.captureStackTrace&&Error.captureStackTrace(u,Cd),!a)throw u;return u},_A=new Hs(0),l1=typeof TextDecoder<"u"&&new TextDecoder;try{l1.decode(_A,{stream:!0})}catch{}const Ey={gzip_data:"gzip"};class Ml extends Error{constructor(o){super(o),this.name="MRTError"}}const Kb={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},c1={uint32:1,uint16:2,uint8:4},Sy={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let Qb;class Jb{constructor(o=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=o}getLayer(o){const a=this.layers[o];if(!a)throw new Ml(`Layer '${o}' not found`);return a}getHeaderLength(o){const a=new Uint8Array(o),u=new DataView(o);if(13!==a[0])throw new Ml("File is not a valid MRT.");return u.getUint32(1,!0)}parseHeader(o){const a=new Uint8Array(o),u=this.getHeaderLength(o);if(a.length<u)throw new Ml(`Expected header with length >= ${u} but got buffer of length ${a.length}`);const g=new Qb(a.subarray(0,u)).readFields(eD,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==g.x||this.y!==g.y||this.z!==g.z))throw new Ml(`Invalid attempt to parse header ${g.z}/${g.x}/${g.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=g.x,this.y=g.y,this.z=g.z;for(const p of g.layers)this.layers[p.name]=new xg(p,{cacheSize:this._cacheSize});return this}createDecodingTask(o){const a=[],u=this.getLayer(o.layerName);for(let g of o.blockIndices){const p=u.dataIndex[g],y=p.firstByte-o.firstByte,C=p.lastByte-o.firstByte;if(u._blocksInProgress.has(g))continue;const S={layerName:u.name,firstByte:y,lastByte:C,pixelFormat:u.pixelFormat,blockIndex:g,blockShape:[p.bands.length].concat(u.bandShape),buffer:u.buffer,codec:p.codec.codec,filters:p.filters.map(I=>I.filter)};u._blocksInProgress.add(g),a.push(S)}return new d1(a,()=>{a.forEach(g=>u._blocksInProgress.delete(g.blockIndex))},(g,p)=>{if(a.forEach(y=>u._blocksInProgress.delete(y.blockIndex)),g)throw g;p.forEach(y=>{this.getLayer(y.layerName).processDecodedData(y)})})}}class xg{constructor({version:o,name:a,units:u,tileSize:g,pixelFormat:p,buffer:y,dataIndex:C},S){if(this.version=o,1!==this.version)throw new Ml(`Cannot parse raster layer encoded with MRT version ${o}`);this.name=a,this.units=u,this.tileSize=g,this.buffer=y,this.pixelFormat=Kb[p],this.dataIndex=C,this.bandShape=[g+2*y,g+2*y,c1[this.pixelFormat]],this._decodedBlocks=new yy(S?S.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return c1[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:o})=>o).flat()}processDecodedData(o){const a=o.blockIndex.toString();this._decodedBlocks.get(a)||this._decodedBlocks.put(a,o.data)}getBlockForBand(o){let a=0;switch(typeof o){case"string":for(const[u,g]of this.dataIndex.entries()){for(const[p,y]of g.bands.entries())if(y===o)return{bandIndex:a+p,blockIndex:u,blockBandIndex:p};a+=g.bands.length}break;case"number":for(const[u,g]of this.dataIndex.entries()){if(o>=a&&o<a+g.bands.length)return{bandIndex:o,blockIndex:u,blockBandIndex:o-a};a+=g.bands.length}break;default:throw new Ml(`Invalid band \`${JSON.stringify(o)}\`. Expected string or integer.`)}throw new Ml(`Band not found: ${JSON.stringify(o)}`)}getDataRange(o){let a=1/0,u=-1/0;const g=[],p=new Set;for(const y of o){const{blockIndex:C}=this.getBlockForBand(y);if(C<0)throw new Ml(`Invalid band: ${JSON.stringify(y)}`);const S=this.dataIndex[C];g.includes(C)||g.push(C),p.add(C),a=Math.min(a,S.firstByte),u=Math.max(u,S.lastByte)}if(p.size>this.cacheSize)throw new Ml(`Number of blocks to decode (${p.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:a,lastByte:u,blockIndices:g}}hasBand(o){const{blockIndex:a}=this.getBlockForBand(o);return a>=0}hasDataForBand(o){const{blockIndex:a}=this.getBlockForBand(o);return a>=0&&!!this._decodedBlocks.get(a.toString())}getBandView(o){const{blockIndex:a,blockBandIndex:u}=this.getBlockForBand(o),g=this._decodedBlocks.get(a.toString());if(!g)throw new Ml(`Data for band ${JSON.stringify(o)} of layer "${this.name}" not decoded.`);const p=this.dataIndex[a],y=this.bandShape.reduce((I,b)=>I*b,1),C=u*y,S=g.subarray(C,C+y);return{data:S,bytes:new Uint8Array(S.buffer).subarray(S.byteOffset,S.byteOffset+S.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:p.offset,scale:p.scale}}}Jb.setPbf=function(d){Qb=d};class d1{constructor(o,a,u){this.tasks=o,this._onCancel=a,this._onComplete=u,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(o,a){this._finalized||(this._onComplete(o,a),this._finalized=!0)}}Jb.performDecoding=function(d,o){const a=new Uint8Array(d);return Promise.all(o.tasks.map(u=>{const{layerName:g,firstByte:p,lastByte:y,pixelFormat:C,blockShape:S,blockIndex:I,filters:b,codec:D}=u,k=a.subarray(p,y+1),T=new Uint32Array(S[0]*S[1]*S[2]);let A;if("gzip_data"!==D)throw new Ml(`Unhandled codec: ${D}`);return A=function(O,B){if(!globalThis.DecompressionStream&&"gzip_data"===B)return Promise.resolve(((H=function(ie){31==ie[0]&&139==ie[1]&&8==ie[2]||Cd(6,"invalid gzip data");var me=ie[3],ue=10;4&me&&(ue+=2+(ie[10]|ie[11]<<8));for(var pe=(me>>3&1)+(me>>4&1);pe>0;pe-=!ie[ue++]);return ue+(2&me)}(G=O))+8>G.length&&Cd(6,"invalid gzip data"),function(ie,me,ue){var Te=ie.length;if(!Te||me.f&&!me.l)return ue||new Hs(0);var _e=!ue,Ie=_e||2!=me.i,Le=me.i;_e&&(ue=new Hs(3*Te));var Fe,Ve,ze=function(Mp){var Tp=ue.length;if(Mp>Tp){var Gf=new Hs(Math.max(2*Tp,Mp));Gf.set(ue),ue=Gf}},We=me.f||0,Ue=me.p||0,Ze=me.b||0,ht=me.l,ut=me.d,qt=me.m,gt=me.n,yt=8*Te;do{if(!ht){We=wd(ie,Ue,1);var pt=wd(ie,Ue+1,3);if(Ue+=3,!pt){var fn=ie[(wn=4+((Ue+7)/8|0))-4]|ie[wn-3]<<8,Ut=wn+fn;if(Ut>Te){Le&&Cd(0);break}Ie&&ze(Ze+fn),ue.set(ie.subarray(wn,Ut),Ze),me.b=Ze+=fn,me.p=Ue=8*Ut,me.f=We;continue}if(1==pt)ht=fA,ut=mA,qt=9,gt=5;else if(2==pt){var Jt=wd(ie,Ue,31)+257,xn=wd(ie,Ue+10,15)+4,Bn=Jt+wd(ie,Ue+5,31)+1;Ue+=14;for(var En=new Hs(Bn),ti=new Hs(19),Vn=0;Vn<xn;++Vn)ti[wy[Vn]]=wd(ie,Ue+3*Vn,7);Ue+=3*xn;var ui=lD(ti),Si=(1<<ui)-1,Ui=Cy(ti,ui);for(Vn=0;Vn<Bn;){var wn,hi=Ui[wd(ie,Ue,Si)];if(Ue+=15&hi,(wn=hi>>4)<16)En[Vn++]=wn;else{var lr=0,Cr=0;for(16==wn?(Cr=3+wd(ie,Ue,3),Ue+=2,lr=En[Vn-1]):17==wn?(Cr=3+wd(ie,Ue,7),Ue+=3):18==wn&&(Cr=11+wd(ie,Ue,127),Ue+=7);Cr--;)En[Vn++]=lr}}var ft=En.subarray(0,Jt),Or=En.subarray(Jt);qt=lD(ft),gt=lD(Or),ht=Cy(ft,qt),ut=Cy(Or,gt)}else Cd(1);if(Ue>yt){Le&&Cd(0);break}}Ie&&ze(Ze+131072);for(var Ki=(1<<qt)-1,ko=(1<<gt)-1,ta=Ue;;ta=Ue){var co=(lr=ht[cD(ie,Ue)&Ki])>>4;if((Ue+=15&lr)>yt){Le&&Cd(0);break}if(lr||Cd(2),co<256)ue[Ze++]=co;else{if(256==co){ta=Ue,ht=null;break}var yo=co-254;co>264&&(yo=wd(ie,Ue,(1<<(Tl=sD[Vn=co-257]))-1)+is[Vn],Ue+=Tl);var Rs=ut[cD(ie,Ue)&ko],rs=Rs>>4;if(Rs||Cd(3),Ue+=15&Rs,Or=hA[rs],rs>3){var Tl=a1[rs];Or+=cD(ie,Ue)&(1<<Tl)-1,Ue+=Tl}if(Ue>yt){Le&&Cd(0);break}Ie&&ze(Ze+131072);var bh=Ze+yo;if(Ze<Or){var nc=0-Or,Pc=Math.min(Or,bh);for(nc+Ze<0&&Cd(3);Ze<Pc;++Ze)ue[Ze]=(void 0)[nc+Ze]}for(;Ze<bh;++Ze)ue[Ze]=ue[Ze-Or]}}me.l=ht,me.p=ta,me.b=Ze,me.f=We,ht&&(We=1,me.m=qt,me.d=ut,me.n=gt)}while(!We);return Ze!=ue.length&&_e?(Fe=ue,(null==(Ve=Ze)||Ve>Fe.length)&&(Ve=Fe.length),new Hs(Fe.subarray(0,Ve))):ue.subarray(0,Ze)}(G.subarray(H,-8),{i:2},new Hs(((V=G)[(q=V.length)-4]|V[q-3]<<8|V[q-2]<<16|V[q-1]<<24)>>>0))));var V,q,G,H;const Z=Ey[B];if(!Z)throw new Error(`Unhandled codec: ${B}`);const ee=new globalThis.DecompressionStream(Z);return new Response(new Blob([O]).stream().pipeThrough(ee)).arrayBuffer().then(ie=>new Uint8Array(ie))}(k,D).then(O=>(new Qb(O).readFields(iD,T),new Sy[C](T.buffer))),A.then(O=>{for(let B=b.length-1;B>=0;B--)switch(b[B]){case"delta_filter":by(O,S);break;case"zigzag_filter":rD(O);break;case"bitshuffle_filter":oD(O,C);break;default:throw new Ml(`Unhandled filter "${b[B]}"`)}return{layerName:g,blockIndex:I,data:O}}).catch(O=>{throw O})}))},Zt(d1,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Zt(Jb,"MapboxRasterTile"),Zt(xg,"MapboxRasterLayer",{omit:["_blocksInProgress"]});let wg,Dp,tc,Cg,u1,jf=null;function h1(){return ws()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Dp||re.DRACO_URL}function dD(){if(ws()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Cg)return Cg;const d=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if("object"!=typeof WebAssembly)throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Cg=WebAssembly.validate(d)?re.MESHOPT_SIMD_URL:re.MESHOPT_URL,Cg}const e0={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},yA={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},vh={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function uD(d,o,a){const u=a.json.bufferViews.length,g=a.buffers.length;o.bufferView=u,a.json.bufferViews[u]={buffer:g,byteLength:d.byteLength},a.buffers[g]=d}const p1="KHR_draco_mesh_compression";function vA(d,o){const a=d.extensions&&d.extensions[p1];if(!a)return;const u=new tc.Decoder,g=t0(o,a.bufferView),p=new tc.Mesh;if(!u.DecodeArrayToMesh(g,g.byteLength,p))throw new Error("Failed to decode Draco mesh");const y=o.json.accessors[d.indices],C=e0[y.componentType],S=y.count*C.BYTES_PER_ELEMENT,I=tc._malloc(S);C===Uint16Array?u.GetTrianglesUInt16Array(p,S,I):u.GetTrianglesUInt32Array(p,S,I),uD(tc.memory.buffer.slice(I,I+S),y,o),tc._free(I);for(const b of Object.keys(a.attributes)){const D=u.GetAttributeByUniqueId(p,a.attributes[b]),k=o.json.accessors[d.attributes[b]],T=yA[k.componentType],A=k.count*vh[k.type]*e0[k.componentType].BYTES_PER_ELEMENT,O=tc._malloc(A);u.GetAttributeDataArrayForAllPoints(p,D,tc[T],A,O),uD(tc.memory.buffer.slice(O,O+A),k,o),tc._free(O)}u.destroy(),p.destroy(),delete d.extensions[p1]}const Hf="EXT_meshopt_compression";function hD(d,o){if(!d.extensions||!d.extensions[Hf])return;const a=d.extensions[Hf],u=new Uint8Array(o.buffers[a.buffer],a.byteOffset||0,a.byteLength||0),g=new Uint8Array(a.count*a.byteStride);u1.decodeGltfBuffer(g,a.count,a.byteStride,u,a.mode,a.filter),d.buffer=o.buffers.length,d.byteOffset=0,o.buffers[d.buffer]=g.buffer,delete d.extensions[Hf]}const f1=1179937895,m1=new TextDecoder("utf8");function pD(d,o){return new URL(d,o).href}function fD(d,o,a,u){return fetch(pD(d.uri,u)).then(g=>g.arrayBuffer()).then(g=>{o.buffers[a]=g})}function t0(d,o){const a=d.json.bufferViews[o];return new Uint8Array(d.buffers[a.buffer],a.byteOffset||0,a.byteLength)}function n0(d,o,a,u){if(d.uri){const g=pD(d.uri,u);return fetch(g).then(p=>p.blob()).then(p=>createImageBitmap(p)).then(p=>{o.images[a]=p})}if(void 0!==d.bufferView){const g=t0(o,d.bufferView),p=new Blob([g],{type:d.mimeType});return createImageBitmap(p).then(y=>{o.images[a]=y})}}function mD(d,o=0,a){const u={json:null,images:[],buffers:[]};if(new Uint32Array(d,o,1)[0]===f1){const b=new Uint32Array(d,o);let D=2;const k=(b[D++]>>2)-3,T=b[D++]>>2;if(D++,u.json=JSON.parse(m1.decode(b.subarray(D,D+T))),D+=T,D<k){const A=b[D++];D++;const O=o+(D<<2);u.buffers[0]=d.slice(O,O+A)}}else u.json=JSON.parse(m1.decode(new Uint8Array(d,o)));const{buffers:g,images:p,meshes:y,extensionsUsed:C,bufferViews:S}=u.json;let I=Promise.resolve();if(g){const b=[];for(let D=0;D<g.length;D++){const k=g[D];k.uri?b.push(fD(k,u,D,a)):u.buffers[D]||(u.buffers[D]=null)}I=Promise.all(b)}return I.then(()=>{const b=[],D=C&&C.includes(p1),k=C&&C.includes(Hf);if(D&&b.push(function(){if(!tc)return wg??(wg=function(T){let A,O=null;function B(){A=new Uint8Array(O.buffer)}function V(){throw new Error("Unexpected Draco error.")}const q={a:{a:V,d:function(G,H,Z){return A.copyWithin(G,H,H+Z)},c:function(G){const H=A.length,Z=Math.max(G>>>0,Math.ceil(1.2*H)),ee=Math.ceil((Z-H)/65536);try{return O.grow(ee),B(),!0}catch{return!1}},b:V}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(T,q):T.then(G=>G.arrayBuffer()).then(G=>WebAssembly.instantiate(G,q))).then(G=>{const{Rb:H,Qb:Z,P:ee,T:ie,X:me,Ja:ue,La:pe,Qa:Te,Va:_e,Wa:Ie,eb:Le,jb:Fe,f:Ve,e:ze,yb:We,zb:Ue,Ab:Ze,Bb:ht,Db:ut,Gb:qt}=G.instance.exports;O=ze;const gt=(()=>{let yt=0,pt=0,fn=0,Ut=0;return Jt=>{fn&&(H(Ut),H(yt),pt+=fn,fn=yt=0),yt||(pt+=128,yt=Z(pt));const xn=Jt.length+7&-8;let Bn=yt;xn>=pt&&(fn=xn,Bn=Ut=Z(xn));for(let En=0;En<Jt.length;En++)A[Bn+En]=Jt[En];return Bn}})();return B(),Ve(),{memory:ze,_free:H,_malloc:Z,Mesh:class{constructor(){this.ptr=ee()}destroy(){ie(this.ptr)}},Decoder:class{constructor(){this.ptr=ue()}destroy(){Fe(this.ptr)}DecodeArrayToMesh(yt,pt,fn){const Ut=gt(yt),Jt=pe(this.ptr,Ut,pt,fn.ptr);return!!me(Jt)}GetAttributeByUniqueId(yt,pt){return{ptr:Te(this.ptr,yt.ptr,pt)}}GetTrianglesUInt16Array(yt,pt,fn){_e(this.ptr,yt.ptr,pt,fn)}GetTrianglesUInt32Array(yt,pt,fn){Ie(this.ptr,yt.ptr,pt,fn)}GetAttributeDataArrayForAllPoints(yt,pt,fn,Ut,Jt){Le(this.ptr,yt.ptr,pt.ptr,fn,Ut,Jt)}},DT_INT8:We(),DT_UINT8:Ue(),DT_INT16:Ze(),DT_UINT16:ht(),DT_UINT32:ut(),DT_FLOAT32:qt()}})}(fetch(h1())),wg.then(T=>{tc=T,wg=void 0}))}()),k&&b.push(function(){if(u1)return;const T=function(A){let O;const B=WebAssembly.instantiateStreaming(A,{}).then(G=>{O=G.instance,O.exports.__wasm_call_ctors()}),V={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},q={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:B,supported:!0,decodeGltfBuffer(G,H,Z,ee,ie,me){!function(ue,pe,Te,_e,Ie,Le,Fe){const Ve=ue.exports.sbrk,ze=_e+3&-4,We=Ve(ze*Ie),Ue=Ve(Le.length),Ze=new Uint8Array(ue.exports.memory.buffer);Ze.set(Le,Ue);const ht=pe(We,_e,Ie,Ue,Le.length);if(0===ht&&Fe&&Fe(We,ze,Ie),Te.set(Ze.subarray(We,We+_e*Ie)),Ve(We-Ve(0)),0!==ht)throw new Error(`Malformed buffer data: ${ht}`)}(O,O.exports[q[ie]],G,H,Z,ee,O.exports[V[me]])}}}(fetch(dD()));return T.ready.then(()=>{u1=T})}()),p)for(let T=0;T<p.length;T++)b.push(n0(p[T],u,T,a));return(b.length?Promise.all(b):Promise.resolve()).then(()=>{if(D&&y)for(const{primitives:T}of y)for(const A of T)vA(A,u);if(k&&y&&S)for(const T of S)hD(T,u);return u})})}function $f(d,o){const a=d.json.bufferViews[o.bufferView],u=e0[o.componentType];return new u(d.buffers[a.buffer],(o.byteOffset||0)+(a.byteOffset||0),o.count*(a.byteStride&&a.byteStride!==vh[o.type]*u.BYTES_PER_ELEMENT?a.byteStride/u.BYTES_PER_ELEMENT:vh[o.type]))}function g1(d,o,a,u){const g=e0[o.componentType],p=function(b){switch(b){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(g),y=d.json.bufferViews[o.bufferView],C=y.byteStride?y.byteStride/g.BYTES_PER_ELEMENT:vh[o.type],S=a.float32,I=S.length/a.capacity;for(let b=0,D=0;b<o.count*C;b+=C,D+=I)for(let k=0;k<I;k++)S[D+k]=u[b+k]*p;a._trim()}function bA(d,o,a){const u=d.indices,g=d.attributes,p={};p.indexArray=new Vo;const y=o.json.accessors[u],C=y.count/3;p.indexArray.reserve(C);const S=$f(o,y);for(let k=0;k<C;k++)p.indexArray.emplaceBack(S[3*k],S[3*k+1],S[3*k+2]);p.indexArray._trim(),p.vertexArray=new Wn;const I=o.json.accessors[g.POSITION];p.vertexArray.reserve(I.count);const b=$f(o,I);for(let k=0;k<I.count;k++)p.vertexArray.emplaceBack(b[3*k],b[3*k+1],b[3*k+2]);if(p.vertexArray._trim(),p.aabb=new tn(I.min,I.max),p.centroid=function(k,T){const A=[0,0,0],O=k.length;if(O>0){for(let B=0;B<O;B++){const V=3*k[B];A[0]+=T[V],A[1]+=T[V+1],A[2]+=T[V+2]}A[0]/=O,A[1]/=O,A[2]/=O}return A}(S,b),void 0!==g.COLOR_0){const k=o.json.accessors[g.COLOR_0],T=vh[k.type],A=$f(o,k);p.colorArray=3===T?new Wn:new Is,p.colorArray.resize(k.count),g1(o,k,p.colorArray,A)}if(void 0!==g.NORMAL){p.normalArray=new Wn;const k=o.json.accessors[g.NORMAL];p.normalArray.resize(k.count);const T=$f(o,k);g1(o,k,p.normalArray,T)}if(void 0!==g.TEXCOORD_0&&a.length>0){p.texcoordArray=new Jh;const k=o.json.accessors[g.TEXCOORD_0];p.texcoordArray.resize(k.count);const T=$f(o,k);g1(o,k,p.texcoordArray,T)}if(void 0!==g._FEATURE_ID_RGBA4444){const k=o.json.accessors[g._FEATURE_ID_RGBA4444];o.json.extensionsUsed&&o.json.extensionsUsed.includes("EXT_meshopt_compression")&&(p.featureData=$f(o,k))}void 0!==g._FEATURE_RGBA4444&&(p.featureData=new Uint32Array($f(o,o.json.accessors[g._FEATURE_RGBA4444]).buffer));const D=d.material;return p.material=function(k,T){const{emissiveFactor:A=[0,0,0],alphaMode:O="OPAQUE",alphaCutoff:B=.5,normalTexture:V,occlusionTexture:q,emissiveTexture:G,doubleSided:H}=k,{baseColorFactor:Z=[1,1,1,1],metallicFactor:ee=1,roughnessFactor:ie=1,baseColorTexture:me,metallicRoughnessTexture:ue}=k.pbrMetallicRoughness||{},pe=q?T[q.index]:void 0;if(q&&q.extensions&&q.extensions.KHR_texture_transform&&pe){const Te=q.extensions.KHR_texture_transform;pe.offsetScale=[Te.offset[0],Te.offset[1],Te.scale[0],Te.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Yi(...Z),metallicFactor:ee,roughnessFactor:ie,baseColorTexture:me?T[me.index]:void 0,metallicRoughnessTexture:ue?T[ue.index]:void 0},doubleSided:H,emissiveFactor:A,alphaMode:O,alphaCutoff:B,normalTexture:V?T[V.index]:void 0,occlusionTexture:pe,emissionTexture:G?T[G.index]:void 0,defined:void 0===k.defined}}(void 0!==D?o.json.materials[D]:{defined:!1},a),p}function gD(d,o,a){const{matrix:u,rotation:g,translation:p,scale:y,mesh:C,extras:S,children:I}=d,b={};if(b.matrix=u||ge.mat4.fromRotationTranslationScale([],g||[0,0,0,1],p||[0,0,0],y||[1,1,1]),void 0!==C){b.meshes=a[C];const D=b.anchor=[0,0];for(const k of b.meshes){const{min:T,max:A}=k.aabb;D[0]+=T[0]+A[0],D[1]+=T[1]+A[1]}D[0]=Math.floor(D[0]/b.meshes.length/2),D[1]=Math.floor(D[1]/b.meshes.length/2)}if(S&&(S.id&&(b.id=S.id),S.lights&&(b.lights=function(D){if(!D.length)return[];const k=function(V){const q=atob(V),G=new Uint8Array(q.length);for(let H=0;H<q.length;H++)G[H]=q.codePointAt(H);return G}(D),T=[],A=k.length/24,O=new Uint16Array(k.buffer),B=new Float32Array(k.buffer);for(let V=0;V<A;V++){const q=O[2*V*6]/30,G=O[2*V*6+1]/30,H=O[2*V*6+10]/100,Z=B[6*V+1],ee=B[6*V+2],ie=B[6*V+3],me=B[6*V+4],ue=ie-Z,pe=me-ee,Te=Math.hypot(ue,pe);T.push({pos:[Z+.5*ue,ee+.5*pe,G],normal:[pe/Te,-ue/Te,0],width:Te,height:q,depth:H,points:[Z,ee,ie,me]})}return T}(S.lights))),I){const D=[];for(const k of I)D.push(gD(o.json.nodes[k],o,a));b.children=D}return b}function xA(d){if(0===d.vertices.length||0===d.indices.length)return null;const o=new tb(d.vertices,d.indices,8,256),[a,u]=[o.min.clone(),o.max.clone()];return{vertices:d.vertices,indices:d.indices,grid:o,min:a,max:u}}function _1(d){if(!d.extras||!d.extras.ground)return null;const o=d.extras.ground;if(!o||!Array.isArray(o)||0===o.length)return null;const a=o[0];if(!a||!Array.isArray(a)||0===a.length)return null;const u=[];for(const y of a){if(!Array.isArray(y)||2!==y.length)continue;const C=y[0],S=y[1];"number"==typeof C&&"number"==typeof S&&u.push(new Ot(C,S))}if(u.length<3)return null;u.length>1&&u[u.length-1].equals(u[0])&&u.pop();let g=0;for(let y=0;y<u.length;y++){const C=u[y],S=u[(y+1)%u.length],I=u[(y+2)%u.length];g+=(C.x-S.x)*(I.y-S.y)-(I.x-S.x)*(C.y-S.y)}g>0&&u.reverse();const p=T_(u.flatMap(y=>[y.x,y.y]),[]);return 0===p.length?null:{vertices:u,indices:p}}function Dy(d,o){const a=[],u=[];let g=0;const p=[];for(const y of d){g=a.length;const C=y.vertexArray.float32,S=y.indexArray.uint16;for(let I=0;I<y.vertexArray.length;I++)p[0]=C[3*I+0],p[1]=C[3*I+1],p[2]=C[3*I+2],ge.vec3.transformMat4(p,p,o),a.push(new Ot(p[0],p[1]));for(let I=0;I<3*y.indexArray.length;I++)u.push(S[I]+g)}if(u.length%3!=0)return null;for(let y=0;y<u.length;y+=3){const C=a[u[y+0]],S=a[u[y+1]],I=a[u[y+2]];(C.x-S.x)*(I.y-S.y)-(I.x-S.x)*(C.y-S.y)>0&&([u[y+1],u[y+2]]=[u[y+2],u[y+1]])}return{vertices:a,indices:u}}function y1(d){const a=function(S,I){const b=[];for(const D of S.json.meshes){const k=[];for(const T of D.primitives)k.push(bA(T,S,I));b.push(k)}return b}(d,function(S,I){const b=[],D=WebGL2RenderingContext;if(S.json.textures)for(const k of S.json.textures){const T={magFilter:D.LINEAR,minFilter:D.NEAREST,wrapS:D.REPEAT,wrapT:D.REPEAT};void 0!==k.sampler&&Object.assign(T,S.json.samplers[k.sampler]),b.push({image:I[k.source],sampler:T,uploaded:!1})}return b}(d,d.images)),{scenes:u,scene:g,nodes:p}=d.json,y=u?u[g||0].nodes:p,C=[];for(const S of y)C.push(gD(p[S],d,a));return function(S,I,b){const D={},k=new Set;for(let T=0;T<S.length;T++){const A=b[I[T]];if(!A.extras)continue;const O=A.extras["mapbox:footprint:version"],B=A.extras["mapbox:footprint:id"];(O||B)&&k.add(T),"1.0.0"===O&&B&&(D[B]=T)}for(let T=0;T<S.length;T++){if(k.has(T))continue;const A=S[T],O=b[I[T]];if(!O.extras)continue;let B=null;A.id in D&&(B=Dy(S[D[A.id]].meshes,A.matrix)),B||(B=_1(O)),B&&(A.footprint=xA(B))}if(k.size>0){const T=Array.from(k.values()).sort((A,O)=>A-O);for(let A=T.length-1;A>=0;A--)S.splice(T[A],1)}}(C,y,d.json.nodes),C}function _D(d){d.heightmap=new Float32Array(4096),d.heightmap.fill(-1);const o=d.vertexArray.float32,a=d.aabb.min[0]-1,u=d.aabb.min[1]-1,g=64/(d.aabb.max[0]-a+2),p=64/(d.aabb.max[1]-u+2);for(let y=0;y<o.length;y+=3){const C=o[y+2],S=(o[y+0]-a)*g|0,I=(o[y+1]-u)*p|0;C>d.heightmap[64*I+S]&&(d.heightmap[64*I+S]=C)}}function wA(d,o){const a={};a.indexArray=new Vo,a.indexArray.reserve(4*d.length),a.vertexArray=new Wn,a.vertexArray.reserve(10*d.length),a.colorArray=new Is,a.vertexArray.reserve(10*d.length);let u=0;for(const y of d){const C=Math.min(10,Math.max(4,1.3*y.height))*o,S=[-y.normal[1],y.normal[0],0],I=Math.min(.29,.1*y.width/y.depth),b=y.width-2*y.depth*o*(I+.01),D=ge.vec3.scaleAndAdd([],y.pos,S,b/2),k=ge.vec3.scaleAndAdd([],y.pos,S,-b/2),T=[D[0],D[1],D[2]+y.height],A=[k[0],k[1],k[2]+y.height],O=ge.vec3.scaleAndAdd([],y.normal,S,I);ge.vec3.scale(O,O,C);const B=ge.vec3.scaleAndAdd([],y.normal,S,-I);ge.vec3.scale(B,B,C),ge.vec3.add(O,D,O),ge.vec3.add(B,k,B),D[2]+=.1,k[2]+=.1,a.vertexArray.emplaceBack(O[0],O[1],O[2]),a.vertexArray.emplaceBack(B[0],B[1],B[2]),a.vertexArray.emplaceBack(D[0],D[1],D[2]),a.vertexArray.emplaceBack(k[0],k[1],k[2]),a.vertexArray.emplaceBack(T[0],T[1],T[2]),a.vertexArray.emplaceBack(A[0],A[1],A[2]),a.vertexArray.emplaceBack(D[0],D[1],D[2]),a.vertexArray.emplaceBack(k[0],k[1],k[2]),a.vertexArray.emplaceBack(O[0],O[1],O[2]),a.vertexArray.emplaceBack(B[0],B[1],B[2]);const V=b/C/2;a.colorArray.emplaceBack(-V-I,-1,V,.8),a.colorArray.emplaceBack(V+I,-1,V,.8),a.colorArray.emplaceBack(-V,0,V,1.3),a.colorArray.emplaceBack(V,0,V,1.3),a.colorArray.emplaceBack(V+I,-.8,V,.7),a.colorArray.emplaceBack(V+I,-.8,V,.7),a.colorArray.emplaceBack(0,0,V,1.3),a.colorArray.emplaceBack(0,0,V,1.3),a.colorArray.emplaceBack(V+I,-1.2,V,.8),a.colorArray.emplaceBack(V+I,-1.2,V,.8),a.indexArray.emplaceBack(6+u,4+u,8+u),a.indexArray.emplaceBack(7+u,9+u,5+u),a.indexArray.emplaceBack(0+u,1+u,2+u),a.indexArray.emplaceBack(1+u,3+u,2+u),u+=10}const g={defined:!0,emissiveFactor:[0,0,0]},p={};return p.baseColorFactor=Yi.white,g.pbrMetallicRoughness=p,a.material=g,a.aabb=new tn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),a}class Eg{constructor(o){this._stringToNumber={},this._numberToString=[];for(let a=0;a<o.length;a++){const u=o[a];this._stringToNumber[u]=a,this._numberToString[a]=u}}encode(o){return this._stringToNumber[o]}decode(o){return this._numberToString[o]}}const r0=["id","tile","layer","source","sourceLayer","state"];class My{constructor(o,a,u,g,p){this.type="Feature",this._vectorTileFeature=o,this._z=a,this._x=u,this._y=g,this.properties=o.properties,this.id=p}clone(){const o=new My(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(o.state=Object.assign({},this.state)),this.layer&&(o.layer=Object.assign({},this.layer)),this.source&&(o.source=this.source),this.sourceLayer&&(o.sourceLayer=this.sourceLayer),o}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(o){this._geometry=o}toJSON(){const o={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const a of r0)void 0!==this[a]&&(o[a]=this[a]);return o}}class yD{constructor(o,a){this.tileID=o,this.x=o.canonical.x,this.y=o.canonical.y,this.z=o.canonical.z,this.grid=new ga(kt,16,0),this.featureIndexArray=new va,this.promoteId=a,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(o,a,u,g,p,y=0,C=0){const S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,g,p,y);const I=this.grid;for(let b=0;b<a.length;b++){const D=a[b],k=[1/0,1/0,-1/0,-1/0];for(let T=0;T<D.length;T++){const A=D[T];k[0]=Math.min(k[0],A.x),k[1]=Math.min(k[1],A.y),k[2]=Math.max(k[2],A.x),k[3]=Math.max(k[3],A.y)}0!==C&&(k[0]-=C,k[1]-=C,k[2]+=C,k[3]+=C),k[0]<kt&&k[1]<kt&&k[2]>=0&&k[3]>=0&&I.insert(S,k[0],k[1],k[2],k[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new dp.VectorTile(new X_(this.rawTileData)).layers,this.sourceLayerCoder=new Eg(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const o in this.vtLayers)this.vtFeatures[o]=[]}return this.vtLayers}query(o,a){const{tilespaceGeometry:u,transform:g,tileTransform:p,pixelPosMatrix:y,availableImages:C}=a;this.loadVTLayers(),this.serializedLayersCache.clear();const S=u.bufferedTilespaceBounds,I=this.grid.query(S.min.x,S.min.y,S.max.x,S.max.y,(T,A,O,B)=>Me(u.bufferedTilespaceGeometry,T,A,O,B));I.sort(b1);let b=null;g.elevation&&I.length>0&&(b=xe.create(g.elevation,this.tileID));const D={};let k;for(let T=0;T<I.length;T++){const A=I[T];if(A===k)continue;k=A;const O=this.featureIndexArray.get(A);let B=null;this.is3DTile?this.loadMatchingModelFeature(D,O,o,u,g):this.loadMatchingFeature(D,O,o,C,(V,q,G,H=0)=>(B||(B=N(V,this.tileID.canonical,p)),q.queryIntersectsFeature(u,V,G,B,this.z,g,y,b,H)))}return D}loadMatchingFeature(o,a,u,g,p){const{featureIndex:y,bucketIndex:C,sourceLayerIndex:S,layoutVertexArrayOffset:I}=a,b=this.bucketLayerIDs[C],D=u.layers,k=Object.keys(D);if(k.length&&!function(V,q){for(let G=0;G<V.length;G++)if(q.indexOf(V[G])>=0)return!0;return!1}(k,b))return;const T=u.sourceCache,A=this.sourceLayerCoder.decode(S),O=this.vtLayers[A].feature(y),B=this.getId(O,A);for(let V=0;V<b.length;V++){const q=b[V];if(!D[q])continue;const{styleLayer:G,targets:H}=D[q];let Z={};void 0!==B&&(Z=T.getFeatureState(G.sourceLayer,B));const ee=!p||p(O,G,Z,I);if(!ee)continue;const ie=new My(O,this.z,this.x,this.y,B);ie.tile=this.tileID.canonical,ie.state=Z;let me=this.serializedLayersCache.get(q);me||(me=G.serialize(),me.id=q,this.serializedLayersCache.set(q,me)),ie.source=me.source,ie.sourceLayer=me["source-layer"],ie.layer=ls({},me),ie.layer.paint=v1(me.paint,G.paint,O,Z,g),ie.layer.layout=v1(me.layout,G.layout,O,Z,g);let ue=!1;for(const pe of H){this.updateFeatureProperties(ie,pe);const{filter:Te}=pe;if(Te)if(O.properties=ie.properties,Te.needGeometry){const _e=z(O,!0);if(!Te.filter(new sr(this.tileID.overscaledZ),_e,this.tileID.canonical))continue}else if(!Te.filter(new sr(this.tileID.overscaledZ),O))continue;ue=!0,pe.targetId&&this.addFeatureVariant(ie,pe)}ue&&this.appendToResult(o,q,y,ie,ee)}}loadMatchingModelFeature(o,a,u,g,p){const y=this.bucketLayerIDs[0][0],C=u.layers;if(!C[y])return;const{styleLayer:S,targets:I}=C[y];if("model"!==S.type)return;const b=g.tile,D=a.featureIndex,k=b.getBucket(S);if(!(k&&k instanceof Vb))return;const T=function(me,ue,pe,Te){const _e=me.getNodesInfo()[ue];if(_e.hiddenByReplacement||!_e.node.meshes)return;let Ie=Number.MAX_VALUE;const Le=_e.node,Fe=pe.tile,Ve=Te.calculatePosMatrix(Fe.tileID.toUnwrapped(),Te.worldSize),ze=_e.evaluatedScale;let We=0;Te.elevation&&Le.elevation&&(We=Le.elevation*Te.elevation.exaggeration()),ge.mat4.translate(Ve,Ve,[(Le.anchor?Le.anchor[0]:0)*(ze[0]-1),(Le.anchor?Le.anchor[1]:0)*(ze[1]-1),We]),ge.mat4.scale(Ve,Ve,ze);const Ue=pe.queryGeometry,Ze=Ue.isPointQuery()?Ue.screenBounds:Ue.screenGeometry,ht=function(qt){const gt=ge.mat4.multiply([],Ve,qt.matrix);ge.mat4.multiply(gt,Te.expandedFarZProjMatrix,gt);for(let yt=0;yt<qt.meshes.length;++yt){const pt=qt.meshes[yt];if(yt===qt.lightMeshIndex)continue;const fn=kS(Ze,Te,gt,pt.aabb);null!=fn&&(Ie=Math.min(fn,Ie))}if(qt.children)for(const yt of qt.children)ht(yt)};if(ht(Le),Ie===Number.MAX_VALUE)return;const ut=new Ri(0,0);return FS(Fe.tileID.canonical,ut,_e.node.anchor[0],_e.node.anchor[1]),{intersectionZ:Ie,position:ut,feature:_e.feature}}(k,D,g,p);if(!T)return;const{z:A,x:O,y:B}=b.tileID.canonical,{feature:V,intersectionZ:q,position:G}=T;let H={};void 0!==V.id&&(H=u.sourceCache.getFeatureState(S.sourceLayer,V.id));const Z=new My({},A,O,B,V.id);Z.tile=this.tileID.canonical,Z.state=H,Z.properties=V.properties,Z.geometry={type:"Point",coordinates:[G.lng,G.lat]};let ee=this.serializedLayersCache.get(y);ee||(ee=S.serialize(),ee.id=y,this.serializedLayersCache.set(y,ee)),Z.source=ee.source,Z.sourceLayer=ee["source-layer"],Z.layer=ls({},ee);let ie=!1;for(const me of I){this.updateFeatureProperties(Z,me);const{filter:ue}=me;if(ue)if(V.properties=Z.properties,ue.needGeometry){if(!ue.filter(new sr(this.tileID.overscaledZ),V,this.tileID.canonical))continue}else if(!ue.filter(new sr(this.tileID.overscaledZ),V))continue;ie=!0,me.targetId&&this.addFeatureVariant(Z,me)}ie&&this.appendToResult(o,y,D,Z,q)}updateFeatureProperties(o,a,u){if(a.properties){const g={};for(const p in a.properties){const y=a.properties[p].evaluate({zoom:this.z},o._vectorTileFeature,o.state,o.tile,u);null!=y&&(g[p]=y)}o.properties=g}}addFeatureVariant(o,a,u){const g={target:a.target,namespace:a.namespace,uniqueFeatureID:a.uniqueFeatureID};a.properties&&(g.properties=o.properties),o.variants=o.variants||{},o.variants[a.targetId]=o.variants[a.targetId]||[],o.variants[a.targetId].push(g)}appendToResult(o,a,u,g,p){let y=o[a];void 0===y&&(y=o[a]=[]),y.push({featureIndex:u,feature:g,intersectionZ:p})}lookupSymbolFeatures(o,a,u,g,p){const y={};this.loadVTLayers();for(const C of o)this.loadMatchingFeature(y,{bucketIndex:a,sourceLayerIndex:u,featureIndex:C,layoutVertexArrayOffset:0},g,p);return y}loadFeature(o){const{featureIndex:a,sourceLayerIndex:u}=o;this.loadVTLayers();const g=this.sourceLayerCoder.decode(u),p=this.vtFeatures[g];if(p[a])return p[a];const y=this.vtLayers[g].feature(a);return p[a]=y,y}hasLayer(o){for(const a of this.bucketLayerIDs)for(const u of a)if(o===u)return!0;return!1}getId(o,a){let u=o.id;if(this.promoteId){const g=Array.isArray(this.promoteId)||"object"!=typeof this.promoteId?this.promoteId:this.promoteId[a];if(null!=g)if(Array.isArray(g)){if(!this.promoteIdExpression){const p=ad(g);if("success"!==p.result)return void Ir(`Failed to create expression for promoteId: ${p.value.map(C=>`${C.key}: ${C.message}`).join(", ")}`);this.promoteIdExpression=p.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new Gd),u=this.promoteIdExpression.evaluate({zoom:0},o)}else u=o.properties[g];"boolean"==typeof u&&(u=Number(u))}return u}}function v1(d,o,a,u,g){return Bd(d,(p,y)=>{const C=o instanceof tr?o.get(y):null;return C&&C.evaluate?C.evaluate(a,u,g):C})}function b1(d,o){return o-d}Zt(yD,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const vD=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class o0{static from(o){if(!(o instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[a,u]=new Uint8Array(o,0,2);if(219!==a)throw new Error("Data does not appear to be in a KDBush format.");const g=u>>4;if(1!==g)throw new Error(`Got v${g} data when expected v1.`);const p=vD[15&u];if(!p)throw new Error("Unrecognized array type.");const[y]=new Uint16Array(o,2,1),[C]=new Uint32Array(o,4,1);return new o0(C,y,p,o)}constructor(o,a=64,u=Float64Array,g){if(isNaN(o)||o<0)throw new Error(`Unpexpected numItems value: ${o}.`);this.numItems=+o,this.nodeSize=Math.min(Math.max(+a,2),65535),this.ArrayType=u,this.IndexArrayType=o<65536?Uint16Array:Uint32Array;const p=vD.indexOf(this.ArrayType),y=2*o*this.ArrayType.BYTES_PER_ELEMENT,C=o*this.IndexArrayType.BYTES_PER_ELEMENT,S=(8-C%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${u}.`);g&&g instanceof ArrayBuffer?(this.data=g,this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+C+S,2*o),this._pos=2*o,this._finished=!0):(this.data=new ArrayBuffer(8+y+C+S),this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+C+S,2*o),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=a,new Uint32Array(this.data,4,1)[0]=o)}add(o,a){const u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=o,this.coords[this._pos++]=a,u}finish(){const o=this._pos>>1;if(o!==this.numItems)throw new Error(`Added ${o} items when expected ${this.numItems}.`);return x1(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(o,a,u,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:y,nodeSize:C}=this,S=[0,p.length-1,0],I=[];for(;S.length;){const b=S.pop()||0,D=S.pop()||0,k=S.pop()||0;if(D-k<=C){for(let B=k;B<=D;B++){const V=y[2*B],q=y[2*B+1];V>=o&&V<=u&&q>=a&&q<=g&&I.push(p[B])}continue}const T=k+D>>1,A=y[2*T],O=y[2*T+1];A>=o&&A<=u&&O>=a&&O<=g&&I.push(p[T]),(0===b?o<=A:a<=O)&&(S.push(k),S.push(T-1),S.push(1-b)),(0===b?u>=A:g>=O)&&(S.push(T+1),S.push(D),S.push(1-b))}return I}within(o,a,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:p,nodeSize:y}=this,C=[0,g.length-1,0],S=[],I=u*u;for(;C.length;){const b=C.pop()||0,D=C.pop()||0,k=C.pop()||0;if(D-k<=y){for(let B=k;B<=D;B++)w1(p[2*B],p[2*B+1],o,a)<=I&&S.push(g[B]);continue}const T=k+D>>1,A=p[2*T],O=p[2*T+1];w1(A,O,o,a)<=I&&S.push(g[T]),(0===b?o-u<=A:a-u<=O)&&(C.push(k),C.push(T-1),C.push(1-b)),(0===b?o+u>=A:a+u>=O)&&(C.push(T+1),C.push(D),C.push(1-b))}return S}}function x1(d,o,a,u,g,p){if(g-u<=a)return;const y=u+g>>1;bD(d,o,y,u,g,p),x1(d,o,a,u,y-1,1-p),x1(d,o,a,y+1,g,1-p)}function bD(d,o,a,u,g,p){for(;g>u;){if(g-u>600){const I=g-u+1,b=a-u+1,D=Math.log(I),k=.5*Math.exp(2*D/3),T=.5*Math.sqrt(D*k*(I-k)/I)*(b-I/2<0?-1:1);bD(d,o,a,Math.max(u,Math.floor(a-b*k/I+T)),Math.min(g,Math.floor(a+(I-b)*k/I+T)),p)}const y=o[2*a+p];let C=u,S=g;for(Ty(d,o,u,a),o[2*g+p]>y&&Ty(d,o,u,g);C<S;){for(Ty(d,o,C,S),C++,S--;o[2*C+p]<y;)C++;for(;o[2*S+p]>y;)S--}o[2*u+p]===y?Ty(d,o,u,S):(S++,Ty(d,o,S,g)),S<=a&&(u=S+1),a<=S&&(g=S-1)}}function Ty(d,o,a,u){s0(d,a,u),s0(o,2*a,2*u),s0(o,2*a+1,2*u+1)}function s0(d,o,a){const u=d[o];d[o]=d[a],d[a]=u}function w1(d,o,a,u){const g=d-a,p=o-u;return g*g+p*p}h.$=Ss,h.A=da,h.B=Oa,h.C=tu,h.D=fg,h.E=po,h.F=2,h.G=J_,h.H=gp,h.I=ua,h.J=class extends cy{},h.K=jl,h.L=Ti,h.M=eu,h.N=qu,h.O=fl,h.P=Ot,h.Q=wc,h.R=Zo,h.S=Va,h.T=Rb,h.U=ps,h.V=cy,h.W=ao,h.X=ad,h.Y=Em,h.Z=nd,h._=td,h.a=function(d){return re.API_CDN_URL_REGEX.test(d)},h.a$=z,h.a0=cs,h.a1=p_,h.a2=sf,h.a3=od,h.a4=function(d){const o=d.value;let a=[];if(!o)return a;const u=jl(o);return"string"!==u?(a=a.concat([new cy(d.key,o,`string expected, "${u}" found`)]),a):($w(o,!0)||(a=a.concat([new cy(d.key,o,`invalid url "${o}"`)])),a)},h.a5=Ye,h.a6=ff,h.a7=Br,h.a8=Mt,h.a9=class{constructor(d){this.specification=d}possiblyEvaluate(d,o){return Bh(d.expression.evaluate(o))}interpolate(d,o,a){return{x:_n(d.x,o.x,a),y:_n(d.y,o.y,a),z:_n(d.z,o.z,a),azimuthal:_n(d.azimuthal,o.azimuthal,a),polar:_n(d.polar,o.polar,a)}}},h.aA=function(d,o){const a={};for(let u=0;u<o.length;u++){const g=o[u];g in d&&(a[g]=d[g])}return a},h.aB=fd,h.aC=As,h.aD=class{constructor(d){this.entries={},this.scheduler=d}request(d,o,a,u){const g=this.entries[d]=this.entries[d]||{callbacks:[]};if(g.result){const[p,y]=g.result;return this.scheduler?this.scheduler.add(()=>{u(p,y)},o):u(p,y),()=>{}}return g.callbacks.push(u),g.cancel||(g.cancel=a((p,y)=>{g.result=[p,y];for(const C of g.callbacks)this.scheduler?this.scheduler.add(()=>{C(p,y)},o):C(p,y);setTimeout(()=>delete this.entries[d],3e3)})),()=>{g.result||(g.callbacks=g.callbacks.filter(p=>p!==u),g.callbacks.length||(g.cancel(),delete this.entries[d]))}}},h.aE=function(d,o,a){const u=JSON.stringify(d.request);return d.data&&(this.deduped.entries[u]={result:[null,d.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:d.isSymbolTile,zoom:d.tileZoom},g=>{const p=ca(d.request,(y,C,S,I)=>{y?g(y):C&&g(null,{vectorTile:a?void 0:new dp.VectorTile(new X_(C)),rawData:C,cacheControl:S,expires:I})});return()=>{p.cancel(),g()}},o)},h.aF=function(d){an++,an>Ln&&(d.getActor().send("enforceCacheSizeLimit",Et),an=0)},h.aG=function(d){return d<=1?1:Math.pow(2,Math.floor(Math.log(d)/Math.LN2))},h.aH=dt,h.aI=qI,h.aJ=MS,h.aK=SS,h.aL=function(d,o){const a=document.createElement("video");a.muted=!0,a.onloadstart=function(){o(null,a)};for(let u=0;u<d.length;u++){const g=document.createElement("source");Ud(d[u])||(a.crossOrigin="Anonymous"),g.src=d[u],a.appendChild(g)}return{cancel:()=>{}}},h.aM=fh,h.aN=function(d){return fetch(d).then(o=>o.arrayBuffer()).then(o=>mD(o,0,d))},h.aO=y1,h.aP=class{constructor(d,o,a,u){this.id=d,this.position=null!=o?new Ri(o[0],o[1]):new Ri(0,0),this.orientation=a??[0,0,0],this.nodes=u,this.uploaded=!1,this.aabb=new tn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(d,o){if(ge.mat4.multiply(d.matrix,o,d.matrix),d.meshes)for(const a of d.meshes){const u=tn.applyTransformFast(a.aabb,d.matrix);this.aabb.encapsulate(u)}if(d.children)for(const a of d.children)this._applyTransformations(a,d.matrix)}computeBoundsAndApplyParent(){const d=ge.mat4.identity([]);for(const o of this.nodes)this._applyTransformations(o,d)}computeModelMatrix(d,o,a,u,g,p,y=!1){Yw(this.matrix,this,d.transform,this.position,o,a,u,g,p,y)}upload(d){if(!this.uploaded){for(const o of this.nodes)dy(o,d);for(const o of this.nodes)wp(o);this.uploaded=!0}}destroy(){for(const d of this.nodes)uy(d)}},h.aQ=zh,h.aR=iy,h.aS=xa,h.aT=Uo,h.aU=cd,h.aV=Vo,h.aW=Mi,h.aX=xf,h.aY=ug,h.aZ=function(){ml.isLoading()||ml.isLoaded()||"deferred"!==pf()||Ov()},h.a_=mf,h.aa=sr,h.ab=zr,h.ac=s,h.ad=ge,h.ae=aa,h.af=tr,h.ag=js,h.ah=_n,h.ai=kt,h.aj=yx,h.ak=yi,h.al=Yi,h.am=class{constructor(d){this.specification=d}possiblyEvaluate(d,o){return function([a,u]){const g=Bh([1,a,u]);return{x:g.x,y:g.y,z:g.z}}(d.expression.evaluate(o))}interpolate(d,o,a){return{x:_n(d.x,o.x,a),y:_n(d.y,o.y,a),z:_n(d.z,o.z,a)}}},h.an=function(d,o,a=0,u=!0){const g=new Ot(a,a),p=d.sub(g),y=o.add(g),C=[p,new Ot(y.x,p.y),y,new Ot(p.x,y.y)];return u&&C.push(p.clone()),C},h.ao=function(d,o){const a=[];for(let u=0;u<d.length;u++){const g=Dr(u-1,-1,d.length-1),p=Dr(u+1,-1,d.length-1),y=d[u],C=d[p],S=d[g].sub(y).unit(),I=C.sub(y).unit(),b=I.angleWithSep(S.x,S.y),D=S.add(I).unit().mult(-1*o/Math.sin(b/2));a.push(y.add(D))}return a},h.ap=Sw,h.aq=Me,h.ar=function(d,o,a=0){return ge.vec3.fromValues(((o.x-a)*d.scale-d.x)*kt,(o.y*d.scale-d.y)*kt,qm(o.z,o.y))},h.as=vn,h.at=XE,h.au=function(d){let o=1/0,a=1/0,u=-1/0,g=-1/0;for(const p of d)o=Math.min(o,p.x),a=Math.min(a,p.y),u=Math.max(u,p.x),g=Math.max(g,p.y);return{min:new Ot(o,a),max:new Ot(u,g)}},h.av=Dc,h.aw=De,h.ax=_,h.ay=Qn,h.az=ts,h.b=function(d){return re.API_FONTS_REGEX.test(d)},h.b$=Pb,h.b0=My,h.b1=Ra,h.b2=ew,h.b3=Qm,h.b4=N,h.b5=Yl,h.b6=Vm,h.b7=wt,h.b8=hr,h.b9=T_,h.bA=qr,h.bB=fS,h.bC=ww,h.bD=mb,h.bE=o0,h.bF=Dr,h.bG=Vh,h.bH=Co,h.bI=function(d,o,a){d[4*o+0]=a[0],d[4*o+1]=a[1],d[4*o+2]=a[2],d[4*o+3]=a[3]},h.bJ=sh,h.bK=$a,h.bL=rh,h.bM=$r,h.bN=iu,h.bO=Ri,h.bP=Tw,h.bQ=Je,h.bR=An,h.bS=kc,h.bT=$e,h.bU=ms,h.bV=function(d,o,a,u,g,p,y,C,S){if("globe"===S.name)return ms(d,o,new $e(a,u,g),!1);const I=iy({z:a,x:u,y:g},S);return new tn([(p+I.x/I.scale)*o,o*(I.y/I.scale),y],[(p+I.x2/I.scale)*o,o*(I.y2/I.scale),C])},h.bW=function(d,o,a){let u=0;for(let g=0;g<2;++g)d[g]>0&&(u+=(d[g]-0)*(d[g]-0)),o[g]<0&&(u+=(0-o[g])*(0-o[g]));return u},h.bX=br,h.bY=6,h.bZ=function(d){const o=ge.mat4.identity(new Float64Array(16));ge.mat4.multiply(o,d.pixelMatrix,d.globeMatrix);const a=[0,qa,0],u=[0,Us,0];return ge.vec3.transformMat4(a,a,o),ge.vec3.transformMat4(u,u,o),[a[0]>0&&a[0]<=d.width&&a[1]>0&&a[1]<=d.height&&!gs(d,new Ri(d.center.lat,90)),u[0]>0&&u[0]<=d.width&&u[1]>0&&u[1]<=d.height&&!gs(d,new Ri(d.center.lat,-90))]},h.b_=function(d,o){const{scale:a}=d.tileTransform,u=a*kt/(d.tileSize*Math.pow(2,o.zoom-d.tileID.overscaledZ+d.tileID.canonical.z));return ge.mat2.scale(new Float32Array(4),o.inverseAdjustmentMatrix,[u,u])},h.ba=kb,h.bb=function(d,o){const a=js(o.zoom);if(0===a)return _o(d);const u=wi(d),g=Tr(u),p=Dc(u.getWest())*o.worldSize,y=Dc(u.getEast())*o.worldSize,C=As(u.getNorth())*o.worldSize,S=As(u.getSouth())*o.worldSize,I=[p,C,0],b=[y,C,0],D=[p,S,0],k=[y,S,0],T=ge.mat4.invert([],o.globeMatrix);return ge.vec3.transformMat4(I,I,T),ge.vec3.transformMat4(b,b,T),ge.vec3.transformMat4(D,D,T),ge.vec3.transformMat4(k,k,T),g[0]=jo(g[0],D,a),g[1]=jo(g[1],k,a),g[2]=jo(g[2],b,a),g[3]=jo(g[3],I,a),tn.fromPoints(g)},h.bc=vr,h.bd=Oi,h.be=jo,h.bf=gl,h.bg=In,h.bh=Jb,h.bi=X_,h.bj=ca,h.bk=function(d,o){const a=[];for(const u in d)u in o||a.push(u);return a},h.bl=Gc,h.bm=["type","source","source-layer","minzoom","maxzoom","filter","layout"],h.bn=Bl,h.bo=function(d,o){const{x:a,y:u}=d.point,g=ea(a,u,d.worldSize/d._pixelsPerMercatorPixel,0,0);return ge.mat4.multiply(g,g,Gr(_o(o)))},h.bp=og,h.bq=Ka,h.br=fp,h.bs=function(d,o,a,u,g){const p=5*o+2;d.float32[p+0]=a,d.float32[p+1]=u,d.float32[p+2]=g},h.bt=Ib,h.bu=bw,h.bv=ne,h.bw=24,h.bx=jx,h.by=bp,h.bz=Gx,h.c=Se,h.c$=CI,h.c0=TS,h.c1=function(d){const o=TS(d,!0);return ge.mat2.invert([],[o[0],o[1],o[4],o[5]])},h.c2=di,h.c3=function(d){const{x:o,y:a}=d.point,{lng:u,lat:g}=d._center;return ea(o,a,d.worldSize,u,g)},h.c4=Po,h.c5=Ft,h.c6=5,h.c7=function(d){const o=Math.round((d+45+360)%360/90)%4;return sl[o]},h.c8=45,h.c9=_v,h.cA=oh,h.cB=class extends Ha{constructor(d){super(d),this.current=Ef}set(d,o,a){if(this.fetchUniformLocation(d,o))for(let u=0;u<9;u++)if(a[u]!==this.current[u]){this.current=a,this.gl.uniformMatrix3fv(this.location,!1,a);break}}},h.cC=gc,h.cD=function(d,o,a){const u=js(a.zoom),g=d.style.map._antialias,p=d.terrain&&d.terrain.exaggeration()>0;return 0===u&&!g&&!p},h.cE=function(d){const o=d.pixelsPerMeter,a=o/Co(1,d.center.lat),u=ge.mat4.identity(new Float64Array(16));return ge.mat4.translate(u,u,[d.point.x,d.point.y,0]),ge.mat4.scale(u,u,[a,a,o]),Float32Array.from(u)},h.cF=wi,h.cG=function(d){const o=br-5;d=Qn(d,-o,o)/o*90;const a=Math.pow(Math.abs(Math.sin(yi(d))),3);return Math.round(a*(Ga.length-1))},h.cH=function(d,o,a,u){const g=o.getNorth(),p=o.getSouth(),y=o.getWest(),C=o.getEast(),S=1<<d.z,I=C-y,b=g-p,D=I/64,k=-b/Ga[a],T=[0,D,0,k,0,0,g,y,0];if(d.z>0){const A=180/u;ge.mat3.multiply(T,T,[A/I+1,0,0,0,A/b+1,0,-.5*A/D,.5*A/k,1])}return T[2]=S,T[5]=d.x,T[8]=d.y,T},h.cI=_o,h.cJ=function(d,o,a){const u=ge.mat4.identity(new Float64Array(16)),g=(o/(1<<d)-.5)*Math.PI*2;return ge.mat4.rotateY(u,a.globeMatrix,g),Float32Array.from(u)},h.cK=class{isDataAvailableAtPoint(d){const o=this._source();if(this.isUsingMockSource()||!o||d.y<0||d.y>1)return!1;const a=o.getSource().maxzoom,u=1<<a,g=Math.floor(d.x),p=Math.floor((d.x-g)*u),y=Math.floor(d.y*u),C=this.findDEMTileFor(new dt(a,g,a,p,y));return!(!C||!C.dem)}getAtPointOrZero(d,o=0){return this.getAtPoint(d,o)||0}getAtPoint(d,o,a=!0){if(this.isUsingMockSource())return null;null==o&&(o=null);const u=this._source();if(!u||d.y<0||d.y>1)return o;const g=u.getSource().maxzoom,p=1<<g,y=Math.floor(d.x),C=d.x-y,S=new dt(g,y,g,Math.floor(C*p),Math.floor(d.y*p)),I=this.findDEMTileFor(S);if(!I||!I.dem)return o;const b=I.dem,D=1<<I.tileID.canonical.z,k=(C*D-I.tileID.canonical.x)*b.dim,T=(d.y*D-I.tileID.canonical.y)*b.dim,A=Math.floor(k),O=Math.floor(T);return(a?this.exaggeration():1)*_n(_n(b.get(A,O),b.get(A,O+1),T-O),_n(b.get(A+1,O),b.get(A+1,O+1),T-O),k-A)}getAtTileOffset(d,o,a){const u=1<<d.canonical.z;return this.getAtPointOrZero(new s(d.wrap+(d.canonical.x+o/kt)/u,(d.canonical.y+a/kt)/u))}getAtTileOffsetFunc(d,o,a,u){return g=>{const p=this.getAtTileOffset(d,g.x,g.y),y=u.upVector(d.canonical,g.x,g.y),C=u.upVectorScale(d.canonical,o,a).metersToTile;return ge.vec3.scale(y,y,p*C),y}}getForTilePoints(d,o,a,u){if(this.isUsingMockSource())return!1;const g=xe.create(this,d,u);return!!g&&(o.forEach(p=>{p[2]=this.exaggeration()*g.getElevationAt(p[0],p[1],a)}),!0)}getMinMaxForTile(d){if(this.isUsingMockSource())return null;const o=this.findDEMTileFor(d);if(!o||!o.dem)return null;const a=o.dem.tree,u=o.tileID,g=1<<d.canonical.z-u.canonical.z;let p=d.canonical.x/g-u.canonical.x,y=d.canonical.y/g-u.canonical.y,C=0;for(let S=0;S<d.canonical.z-u.canonical.z&&!a.leaves[C];S++){p*=2,y*=2;const I=2*Math.floor(y)+Math.floor(p);C=a.childOffsets[C]+I,p%=1,y%=1}return{min:this.exaggeration()*a.minimums[C],max:this.exaggeration()*a.maximums[C]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(d,o,a){throw new Error("Pure virtual method called.")}pointCoordinate(d){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(d){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const d=this.visibleDemTiles;if(0===d.length)return null;let o=!1,a=Number.MAX_VALUE,u=Number.MIN_VALUE;for(const g of d){const p=this.getMinMaxForTile(g.tileID);p&&(a=Math.min(a,p.min),u=Math.max(u,p.max),o=!0)}return o?{min:a,max:u}:null}},h.cL=Za,h.cM=gi,h.cN=function(d,o){return[Math.pow(d[0],2.2)*o,Math.pow(d[1],2.2)*o,Math.pow(d[2],2.2)*o]},h.cO=wr,h.cP=it,h.cQ=ku,h.cR=256,h.cS=function(d,o){const a=[0,0,0],u=vr(_o(o.canonical));return ge.vec3.transformMat4(a,a,u),ge.vec3.transformMat4(a,a,d),a},h.cT=d=>({u_camera_to_center_distance:new $r(d),u_extrude_scale:new x_(d),u_device_pixel_ratio:new $r(d),u_matrix:new sh(d),u_inv_rot_matrix:new sh(d),u_merc_center:new $a(d),u_tile_id:new rh(d),u_zoom_transition:new $r(d),u_up_dir:new rh(d),u_emissive_strength:new $r(d)}),h.cU=d=>({u_matrix:new sh(d),u_pixels_to_tile_units:new x_(d),u_device_pixel_ratio:new $r(d),u_width_scale:new $r(d),u_floor_width_scale:new $r(d),u_units_to_pixels:new $a(d),u_dash_image:new iu(d),u_gradient_image:new iu(d),u_image_height:new $r(d),u_texsize:new $a(d),u_tile_units_to_pixels:new $r(d),u_alpha_discard_threshold:new $r(d),u_trim_offset:new $a(d),u_trim_fade_range:new $a(d),u_trim_color:new Cf(d),u_emissive_strength:new $r(d),u_zbias_factor:new $r(d),u_tile_to_meter:new $r(d)}),h.cV=d=>({u_matrix:new sh(d),u_texsize:new $a(d),u_pixels_to_tile_units:new x_(d),u_device_pixel_ratio:new $r(d),u_width_scale:new $r(d),u_floor_width_scale:new $r(d),u_image:new iu(d),u_units_to_pixels:new $a(d),u_tile_units_to_pixels:new $r(d),u_alpha_discard_threshold:new $r(d),u_trim_offset:new $a(d),u_trim_fade_range:new $a(d),u_trim_color:new Cf(d),u_emissive_strength:new $r(d),u_zbias_factor:new $r(d),u_tile_to_meter:new $r(d)}),h.cW=zv,h.cX=ow,h.cY=pb,h.cZ=Tc,h.c_=(d,o,a,u,g,p)=>{const y=d.transform,C="globe"===y.projection.name;let S;if("map"===p.paint.get("circle-pitch-alignment"))if(C){const b=wr(y.zoom,o.canonical)*y._pixelsPerMercatorPixel;S=Float32Array.from([b,0,0,b])}else S=y.calculatePixelsToTileUnitsMatrix(a);else S=new Float32Array([y.pixelsToGLUnits[0],0,0,y.pixelsToGLUnits[1]]);const I={u_camera_to_center_distance:d.transform.getCameraToCenterDistance(y.projection),u_matrix:d.translatePosMatrix(o.projMatrix,a,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_device_pixel_ratio:nt.devicePixelRatio,u_extrude_scale:S,u_inv_rot_matrix:Wm,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:p.paint.get("circle-emissive-strength")};if(C){I.u_inv_rot_matrix=u,I.u_merc_center=g,I.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],I.u_zoom_transition=js(y.zoom);const b=g[0]*kt,D=g[1]*kt;I.u_up_dir=y.projection.upVector(new $e(0,0,0),b,D)}return I},h.ca=Tf,h.cb=Cf,h.cc=function(d,o,a){const u=Math.sqrt(d*d+o*o+a*a),g=u>0?Math.acos(a/u)*mc:0;let p=0!==d||0!==o?Math.atan2(-o,-d)*mc+90:0;return p<0&&(p+=360),[u,p,g]},h.cd=m,h.ce=tn,h.cf=Bh,h.cg=function(d){return[Math.pow(d[0],1/2.2),Math.pow(d[1],1/2.2),Math.pow(d[2],1/2.2)]},h.ch=function(d,o){return d.readFields($b,{icons:[]},o)},h.ci=function(d){return d({pluginStatus:_a,pluginURL:Yu}),Mr.on("pluginStateChange",d),d},h.cj=mg,h.ck=lg,h.cl=xw,h.cm=la,h.cn=uf,h.co=Yt,h.cp=ll,h.cq=Ls,h.cr=function(d){const o=d.indexOf("\x1f");return o>=0?d.slice(0,o):d},h.cs=function(d){return d.indexOf("\x1f")>=0},h.ct=function(d){const o=d.indexOf("\x1f");return o>=0?d.slice(o+1):""},h.cu=function(d){const o=[],a=d.id;return void 0===a&&o.push({message:`layers.${a}: missing required property "id"`}),void 0===d.render&&o.push({message:`layers.${a}: missing required method "render"`}),d.renderingMode&&"2d"!==d.renderingMode&&"3d"!==d.renderingMode&&o.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),o},h.cv=function(d,o,a,u){return"custom"===d.type?new Bw(d,o):new QI[d.type](d,o,a,u)},h.cw=ka,h.cx=class extends My{constructor(d,o){super(d._vectorTileFeature,d._z,d._x,d._y,d.id),d.state&&(this.state=Object.assign({},d.state)),this.target=o.target,this.namespace=o.namespace,o.properties&&(this.properties=o.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=d.source,this.sourceLayer=d.sourceLayer,this.layer=d.layer)}toJSON(){const d=super.toJSON();return d.target=this.target,d.namespace=this.namespace,d}},h.cy=Mr,h.cz=Es,h.d=function(d){return re.API_TILEJSON_REGEX.test(d)},h.d$=Eg,h.d0=ds,h.d1=(d,o,a,u,g,p,y,C)=>{const S=d.transform,I=S.pitch<15?nw(.07,.7,Qn((14-S.zoom)/5,0,1)):.07,b="none"===a.paint.get("line-trim-color-use-theme").constantOr("default");return{u_matrix:KE(d,o,a,u),u_texsize:o.imageAtlasTexture?o.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:S.calculatePixelsToTileUnitsMatrix(o),u_device_pixel_ratio:g,u_width_scale:p,u_floor_width_scale:y,u_image:0,u_tile_units_to_pixels:pu(o,S),u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:C,u_trim_fade_range:a.paint.get("line-trim-fade-range"),u_trim_color:a.paint.get("line-trim-color").toRenderColor(b?null:a.lut).toArray01(),u_emissive_strength:a.paint.get("line-emissive-strength"),u_zbias_factor:I,u_tile_to_meter:m(o.tileID.canonical,0)}},h.d2=(d,o,a,u,g,p,y,C,S)=>{const I=d.transform,b=I.calculatePixelsToTileUnitsMatrix(o),D="none"===a.paint.get("line-trim-color-use-theme").constantOr("default"),k=I.pitch<15?nw(.07,.7,Qn((14-I.zoom)/5,0,1)):.07;return{u_matrix:KE(d,o,a,u),u_pixels_to_tile_units:b,u_device_pixel_ratio:p,u_width_scale:y,u_floor_width_scale:C,u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:g,u_texsize:hb(a)&&o.lineAtlasTexture?o.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:pu(o,d.transform),u_alpha_discard_threshold:0,u_trim_offset:S,u_trim_fade_range:a.paint.get("line-trim-fade-range"),u_trim_color:a.paint.get("line-trim-color").toRenderColor(D?null:a.lut).toArray01(),u_emissive_strength:a.paint.get("line-emissive-strength"),u_zbias_factor:k,u_tile_to_meter:m(o.tileID.canonical,0)}},h.d3=Nh,h.d4=lh,h.d5=qm,h.d6=GE,h.d7=zt,h.d8=sb,h.d9=pp,h.dA=F_,h.dB=Fs,h.dC=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},h.dD=zd,h.dE=Mx,h.dF=su,h.dG=function([d,o,a]){const u=Math.hypot(d,o,a),g=Math.atan2(d,a),p=.5*Math.PI-Math.acos(-o/u);return new Ri(Po(g),Po(p))},h.dH=Uw,h.dI=function(d){const o=d.navigator?d.navigator.userAgent:null;return!!function(a){if(null==Vd){const u=a.navigator?a.navigator.userAgent:null;Vd=!!a.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return Vd}(d)&&o&&(o.match("Version/15.4")||o.match("Version/15.5")||o.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},h.dJ=function(d,o){Et=d,Ln=o},h.dK=gs,h.dL=wl,h.dM=function(d){const o=[0,0,0],a=ge.mat4.identity(new Float64Array(16));return ge.mat4.multiply(a,d.pixelMatrix,d.globeMatrix),ge.vec3.transformMat4(o,o,a),new Ot(o[0],o[1])},h.dN=function(d,o,a=!1){if(_a===Rv||_a===df||_a===Om)throw new Error("setRTLTextPlugin cannot be called multiple times.");Yu=nt.resolveURL(d),_a=Rv,Pv=o,hf(),a||Ov()},h.dO=pf,h.dP=function(){mg().acquire(Kw)},h.dQ=function(){const d=Lf;d&&(d.isPreloaded()&&1===d.numActive()?(d.release(Kw),Lf=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},h.dR=jb,h.dS=function(d){const o=li();if(!o)return;const a=o.delete(Qt);d&&a.catch(d).then(()=>d())},h.dT=Ub,h.dU=h1,h.dV=function(d){Dp=nt.resolveURL(d),jf||(jf=new fg(mg(),new po)),jf.broadcast("setDracoUrl",Dp)},h.dW=dD,h.dX=function(d){Cg=nt.resolveURL(d),jf||(jf=new fg(mg(),new po)),jf.broadcast("setMeshoptUrl",Cg)},h.dY=Zt,h.dZ=ah,h.d_=2,h.da=450,h.db=7,h.dc=fO,h.dd=ki,h.de=np,h.df=256,h.dg=Gr,h.dh=Wn,h.di=wo,h.dj=vf,h.dk=function(d,o,a,u,g){return Qn((d-o)/(a-o)*(g-u)+u,u,g)},h.dl=Ts,h.dm=Ur,h.dn=class{constructor(d,o,a,u){this.context=d,this.format=u,this.size=a,this.texture=d.gl.createTexture();const[g,p,y]=this.size,{gl:C}=d;C.bindTexture(C.TEXTURE_3D,this.texture),d.pixelStoreUnpackFlipY.set(!1),d.pixelStoreUnpack.set(1),d.pixelStoreUnpackPremultiplyAlpha.set(!1),C.texImage3D(C.TEXTURE_3D,0,this.format,g,p,y,0,Rw(this.format),Pw(this.format),o.data)}bind(d,o){const{context:a}=this,{gl:u}=a;u.bindTexture(u.TEXTURE_3D,this.texture),d!==this.minFilter&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MAG_FILTER,d),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MIN_FILTER,d),this.minFilter=d),o!==this.wrapS&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_S,o),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_T,o),this.wrapS=o)}destroy(){const{gl:d}=this.context;d.deleteTexture(this.texture),this.texture=null}},h.dp=Fb,h.dq=[1,1,1],h.dr=xe,h.ds=pg,h.dt=Ec,h.du=Jh,h.dv=Sc,h.dw=Zl,h.dx=ya,h.dy=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Ot(1/0,1/0),max:new Ot(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(d,o=!1){const a=$x(new Ot(0,0),new Ot(kt,kt),d),u=[];if(o&&!El(a,this._globalClipBounds))return u;for(const g of this._activeRegions){if(g.hiddenByOverlap||!El(a,g))continue;const p=cO(g.min,g.max,d);u.push({min:p.min,max:p.max,sourceId:this._sourceIds[g.priority],footprint:g.footprint,footprintTileId:g.tileId,order:g.order,clipMask:g.clipMask,clipScope:g.clipScope})}return u}setSources(d){this._setSources(d.map(o=>({getSourceId:()=>o.cache.id,getFootprints:()=>{const a=[];for(const u of o.cache.getVisibleCoordinates()){const g=o.cache.getTile(u).buckets[o.layer];g&&g.updateFootprints(u.toUnwrapped(),a)}return a},getOrder:()=>o.order,getClipMask:()=>o.clipMask,getClipScope:()=>o.clipScope})))}_addSource(d){const o=d.getFootprints();if(0===o.length)return;const a=d.getOrder(),u=d.getClipMask(),g=d.getClipScope();for(const p of o){if(!p.footprint)continue;const y=$x(p.footprint.min,p.footprint.max,p.id);this._activeRegions.push({min:y.min,max:y.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:p.id,footprint:p.footprint,order:a,clipMask:u,clipScope:g})}this._sourceIds.push(d.getSourceId())}_computeReplacement(){this._activeRegions.sort((o,a)=>o.priority-a.priority||L_(o.min,a.min)||L_(o.max,a.max)||o.order-a.order||o.clipMask-a.clipMask||function(u,g){const p=(y,C)=>y+C;return u.length-g.length||u.reduce(p,"").localeCompare(g.reduce(p,""))}(o.clipScope,a.clipScope));let d=this._activeRegions.length!==this._prevRegions.length;if(!d){let o=0;for(;!d&&o!==this._activeRegions.length;){const a=this._activeRegions[o],u=this._prevRegions[o];d=a.priority!==u.priority||!tg(a,u)||a.order!==u.order||a.clipMask!==u.clipMask||!Bl(a.clipScope,u.clipScope),++o}}if(d){++this._updateTime;for(const a of this._activeRegions)a.order!==F_&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,a.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,a.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,a.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,a.max.y));const o=a=>{const u=this._activeRegions;if(a>=u.length)return a;const g=u[a].priority;for(;a<u.length&&u[a].priority===g;)++a;return a};if(this._sourceIds.length>1){let a=0,u=o(a);for(;a!==u;){let g=a;const p=a;for(;g!==u;){const y=this._activeRegions[g];y.hiddenByOverlap=!1;for(let C=0;C<p;C++){const S=this._activeRegions[C];if(!S.hiddenByOverlap&&y.order===F_&&El(y,S)&&(y.hiddenByOverlap=N_(y.footprint,y.tileId,S.footprint,S.tileId),y.hiddenByOverlap))break}++g}a=u,u=o(a)}}}}_setSources(d){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let o=d.length-1;o>=0;o--)this._addSource(d[o]);this._computeReplacement()}},h.dz=class{constructor(d){this._createGrid(d),this._createPoles(d)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const d of this._poleSegments)d.destroy();for(const d of this._gridSegments)d.withSkirts.destroy(),d.withoutSkirts.destroy()}_fillGridMeshWithLods(d,o){const a=new Yl,u=new Vo,g=[],p=d+1+2,y=o[0]+1,C=o[0]+1+(1+o.length),S=(I,b,D)=>{let k=I===p-1?I-2:0===I?I:I-1;return k+=D?24575:0,[k,b]};for(let I=0;I<p;++I)a.emplaceBack(...S(I,0,!0));for(let I=0;I<y;++I)for(let b=0;b<p;++b)a.emplaceBack(...S(b,I,(0===b||b===p-1)&&!0));for(let I=0;I<o.length;++I){const b=o[I];for(let D=0;D<p;++D)a.emplaceBack(...S(D,b,!0))}for(let I=0;I<o.length;++I){const b=u.length,D=o[I]+1+2,k=new Vo;for(let O=0;O<D-1;O++){const B=O===D-2,V=B?p*(C-o.length+I-O):p;for(let q=0;q<p-1;q++){const G=O*p+q;0===O||B||0===q||q===p-2?(k.emplaceBack(G+1,G,G+V),k.emplaceBack(G+V,G+V+1,G+1)):(u.emplaceBack(G+1,G,G+V),u.emplaceBack(G+V,G+V+1,G+1))}}const T=hr.simpleSegment(0,b,a.length,u.length-b);for(let O=0;O<k.uint16.length;O+=3)u.emplaceBack(k.uint16[O],k.uint16[O+1],k.uint16[O+2]);const A=hr.simpleSegment(0,b,a.length,u.length-b);g.push({withoutSkirts:T,withSkirts:A})}return{vertices:a,indices:u,segments:g}}_createGrid(d){const o=this._fillGridMeshWithLods(64,Ga);this._gridSegments=o.segments,this._gridBuffer=d.createVertexBuffer(o.vertices,wt.members),this._gridIndexBuffer=d.createIndexBuffer(o.indices,!0)}_createPoles(d){const o=new Vo;for(let y=0;y<=64;y++)o.emplaceBack(0,y+1,y+2);this._poleIndexBuffer=d.createIndexBuffer(o,!0);const a=new wo,u=new wo,g=new wo,p=new wo;this._poleSegments=[];for(let y=0,C=0;y<5;y++){const S=360/(1<<y);a.emplaceBack(0,-ts,0,.5,0),u.emplaceBack(0,-ts,0,.5,1),g.emplaceBack(0,-ts,0,.5,.5),p.emplaceBack(0,-ts,0,.5,.5);for(let I=0;I<=64;I++){let b=I/64,D=0;const k=_n(0,S,b),[T,A,O]=ou(Mc,Xl,k,ts);a.emplaceBack(T,A,O,b,D),u.emplaceBack(T,A,O,b,1-D);const B=yi(k);b=.5+.5*Math.sin(B),D=.5+.5*Math.cos(B),g.emplaceBack(T,A,O,b,D),p.emplaceBack(T,A,O,b,1-D)}this._poleSegments.push(hr.simpleSegment(C,0,66,64)),C+=66}this._poleNorthVertexBuffer=d.createVertexBuffer(a,en,!1),this._poleSouthVertexBuffer=d.createVertexBuffer(u,en,!1),this._texturedPoleNorthVertexBuffer=d.createVertexBuffer(g,en,!1),this._texturedPoleSouthVertexBuffer=d.createVertexBuffer(p,en,!1)}getGridBuffers(d,o){return[this._gridBuffer,this._gridIndexBuffer,o?this._gridSegments[d].withSkirts:this._gridSegments[d].withoutSkirts]}getPoleBuffers(d,o){return[o?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,o?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[d]]}},h.e=re,h.e0=yD,h.e1=YE,h.e2=ch,h.e3="hd_road_elevation",h.e4=class{static parseFrom(d,o){const a=Kl.parse(d);if(!a)return[];let{vertices:u,features:g}=a;const p=1/m(o);g.sort((I,b)=>I.id-b.id),u.sort((I,b)=>I.id-b.id||I.idx-b.idx),u=u.filter((I,b,D)=>b===D.findIndex(k=>k.id===I.id&&k.idx===I.idx));const y=new Array;let C=0;const S=u.length;for(const I of g){if(I.constantHeight){y.push(new Km(I.id,I.bounds,I.constantHeight));continue}for(;C!==S&&u[C].id<I.id;)C++;if(C===S||u[C].id!==I.id)continue;const b=new Array,D=new Array,k=C;for(;C!==S&&u[C].id===I.id;){const T=u[C];if(b.push({position:T.position,height:T.height,extent:T.extent}),C!==k&&u[C-1].idx===T.idx-1){const A=C-k;D.push({a:A-1,b:A})}C++}y.push(new Km(I.id,I.bounds,void 0,b,D,p))}return y}},h.e5=Bd,h.e6=du,h.e7=lS,h.e8=1,h.e9=function(d,o,a,u,g,p,y,C=1,S){d.createArrays(),d.tilePixelRatio=kt/(512*d.overscaling),d.compareText={},d.iconsNeedLinear=!1;const I=d.layers[0].layout,b=d.layers[0]._unevaluatedLayout._values,D={};D.scaleFactor=C,D.textSizeScaleRange=I.get("text-size-scale-range"),D.iconSizeScaleRange=I.get("icon-size-scale-range");const[k,T]=D.textSizeScaleRange,[A,O]=D.iconSizeScaleRange;D.textScaleFactor=Qn(D.scaleFactor,k,T),D.iconScaleFactor=Qn(D.scaleFactor,A,O);const B=b["text-size"],V=b["icon-size"];if("composite"===d.textSizeData.kind){const{minZoom:ie,maxZoom:me}=d.textSizeData;D.compositeTextSizes=[B.possiblyEvaluate(new sr(ie),p),B.possiblyEvaluate(new sr(me),p)]}if("composite"===d.iconSizeData.kind){const{minZoom:ie,maxZoom:me}=d.iconSizeData;D.compositeIconSizes=[V.possiblyEvaluate(new sr(ie),p),V.possiblyEvaluate(new sr(me),p)]}D.layoutTextSize=B.possiblyEvaluate(new sr(y+1),p),D.layoutIconSize=V.possiblyEvaluate(new sr(y+1),p),D.textMaxSize=B.possiblyEvaluate(new sr(18),p);const q=I.get("symbol-placement"),G="map"===I.get("text-rotation-alignment")&&"point"!==q,H=I.get("text-size");let Z=!1;const ee=[];for(const ie of d.features){const me=I.get("text-font").evaluate(ie,{},p).join(","),ue=H.evaluate(ie,{},p)*D.textScaleFactor,pe=D.layoutTextSize.evaluate(ie,{},p)*D.textScaleFactor,Te=D.layoutIconSize.evaluate(ie,{},p)*D.iconScaleFactor,_e={horizontal:{},vertical:void 0},Ie=ie.text;let Le,Fe=[0,0];if(Ie){const pt=Ie.toString(),fn=24*I.get("text-letter-spacing").evaluate(ie,{},p),Ut=24*I.get("text-line-height").evaluate(ie,{},p),Jt=CE(pt)?fn:0,xn=I.get("text-anchor").evaluate(ie,{},p),Bn=I.get("text-variable-anchor");if(!Bn){const Si=I.get("text-radial-offset").evaluate(ie,{},p);Fe=Si?ww(xn,[24*Si,bb]):I.get("text-offset").evaluate(ie,{},p).map(Ui=>24*Ui)}let En=G?"center":I.get("text-justify").evaluate(ie,{},p);const ti="point"===q,Vn=ti?24*I.get("text-max-width").evaluate(ie,{},p):1/0,ui=Si=>{d.allowVerticalPlacement&&Iv(pt)&&(_e.vertical=hw(Ie,o,a,g,me,Vn,Ut,xn,Si,Jt,Fe,Ka.vertical,!0,pe,ue,S))};if(!G&&Bn){const Si="auto"===En?Bn.map(wn=>fS(wn)):[En];let Ui=!1;for(let wn=0;wn<Si.length;wn++){const hi=Si[wn];if(!_e.horizontal[hi])if(Ui)_e.horizontal[hi]=_e.horizontal[0];else{const lr=hw(Ie,o,a,g,me,Vn,Ut,"center",hi,Jt,Fe,Ka.horizontal,!1,pe,ue,S);lr&&(_e.horizontal[hi]=lr,Ui=1===lr.positionedLines.length)}}ui("left")}else{if("auto"===En&&(En=fS(xn)),ti||I.get("text-writing-mode").indexOf("horizontal")>=0||!Iv(pt)){const Si=hw(Ie,o,a,g,me,Vn,Ut,xn,En,Jt,Fe,Ka.horizontal,!1,pe,ue,S);Si&&(_e.horizontal[En]=Si)}ui(ti?"left":En)}}let Ve,ze,We,Ue,Ze,ht=!1;if(ie.icon&&ie.icon.hasPrimary()){const pt=OI(ie.icon,d.iconSizeData,b["icon-size"],p,d.zoom,ie,S,D.iconScaleFactor);Ve=pt.iconPrimary,ze=pt.iconSecondary;const fn=Ve.toString(),Ut=u.get(fn);Ut&&(We=I.get("icon-offset").evaluate(ie,{},p),Ue=I.get("icon-anchor").evaluate(ie,{},p),Ze=I.get("icon-text-fit").evaluate(ie,{},p),Le=gw(g.get(fn),ze?g.get(ze.toString()):void 0,We,Ue),ht=Ut.sdf,void 0===d.sdfIcons?d.sdfIcons=Ut.sdf:d.sdfIcons!==Ut.sdf&&Ir("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ut.pixelRatio!==d.pixelRatio||0!==I.get("icon-rotate").constantOr(1))&&(d.iconsNeedLinear=!0))}Z=Z||!(!ie.icon||!ie.icon.hasSecondary());const ut=Ew(_e.horizontal)||_e.vertical;d.iconsInText||(d.iconsInText=!!ut&&ut.iconsInText);const qt=pe*D.textScaleFactor/24,{defaultShapedIcon:gt,verticallyShapedIcon:yt}=hO(d,Le,I,ie,p,_e,qt,We,Ze);Le=gt,ee.push({feature:ie,shapedTextOrientations:_e,shapedText:ut,shapedIcon:Le,iconPrimary:Ve,iconSecondary:ze,iconOffset:We,iconAnchor:Ue,verticallyShapedIcon:yt,layoutTextSize:pe,layoutIconSize:Te,textOffset:Fe,isSDFIcon:ht,iconTextFit:Ze})}return{featureData:ee,sizes:D,hasAnySecondaryIcon:Z,textAlongLine:G,symbolPlacement:q}},h.ea=cS,h.eb=function(d,o,a,u,g,p,y,C,S,I){const{featureData:b,hasAnySecondaryIcon:D,sizes:k,textAlongLine:T,symbolPlacement:A}=o;for(const O of b){const{shapedIcon:B,verticallyShapedIcon:V,feature:q,shapedTextOrientations:G,shapedText:H,layoutTextSize:Z,textOffset:ee,isSDFIcon:ie,iconPrimary:me,iconSecondary:ue,iconTextFit:pe,iconOffset:Te}=O;FI(B,I.iconPositions,me,ue),FI(V,I.iconPositions,me,ue),Cw(G,I.iconPositions),(H||B)&&mS(d,q,G,B,V,S,k,Z,0,ee,ie,u,g,y,C,D,pe,Te,T,A)}a&&d.generateCollisionDebugBuffers(p,d.collisionBoxArray,k.textScaleFactor)},h.ec=dp,h.ed=vy,h.ee=Nd,h.ef=cp,h.eg=mp,h.eh=Jr,h.ei=function(d){let o=0;if(new Uint32Array(d,0,1)[0]!==f1){const a=new Uint32Array(d,0,7),[,,u,g,p,y]=a;o=a.byteLength+g+p+y+p,(u!==d.byteLength||o>=d.byteLength)&&Ir("Invalid b3dm header information.")}return mD(d,o)},h.ej=function(d,o){const a=y1(d);for(const u of a){for(const g of u.meshes)_D(g);u.lights&&(u.lightMeshIndex=u.meshes.length,u.meshes.push(wA(u.lights,o)))}return a},h.ek=Vb,h.el=Xw,h.em=ml,h.en=function(d){si(),Hn?.then(o=>{o.keys().then(a=>{for(let u=0;u<a.length-d;u++)o.delete(a[u])})})},h.f=function(d){return 0===d.indexOf("mapbox:")},h.g=function(d,o){return Es(ls(d,{method:"GET"}),o)},h.h=ce,h.i=function(d){return re.API_STYLE_REGEX.test(d)&&!Se(d)},h.j=function(d){return decodeURIComponent(atob(d).split("").map(o=>"%"+("00"+o.charCodeAt(0).toString(16)).slice(-2)).join(""))},h.k=function(d){return btoa(encodeURIComponent(d).replace(/%([0-9A-F]{2})/g,(o,a)=>String.fromCharCode(+("0x"+a))))},h.l=ls,h.m=Wi,h.n=function(d,o){return Es(ls(d,{type:"json"}),o)},h.o=hv,h.p=function(d,o){return Es(ls(d,{method:"POST"}),o)},h.q=nt,h.r=Ho,h.s=function(d){try{const o=self[d];return o.setItem("_mapbox_test_",1),o.removeItem("_mapbox_test_"),!0}catch{return!1}},h.t=Qe,h.u=function(){return function d(o){return o?(o^Math.random()*(16>>o/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,d)}()},h.v=function(d){return!!d&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(d)},h.w=Ir,h.x=function(){return Rc||(Rc=new jb),Rc},h.y=Yb,h.z=ur}),nl(0,function(h){function Jr(it){const re=it?it.url.toString():void 0;return re?performance.getEntriesByName(re):[]}function Ro(it){if("number"==typeof it||"boolean"==typeof it||"string"==typeof it||null==it)return JSON.stringify(it);if(Array.isArray(it)){let ce="[";for(const Se of it)ce+=`${Ro(Se)},`;return`${ce}]`}let re="{";for(const ce of Object.keys(it).sort())re+=`${ce}:${Ro(it[ce])},`;return`${re}}`}function Kn(it){let re="";for(const ce of h.bm)("model"!==it.type||"minzoom"!==ce&&"maxzoom"!==ce)&&(re+=`/${Ro(it[ce])}`);return re}class Gn{constructor(re){this.keyCache={},this._layers={},this._layerConfigs={},re&&this.replace(re)}replace(re,ce){this._layerConfigs={},this._layers={},this.update(re,[],ce)}update(re,ce,Se){this._options=Se;for(const Ae of re)this._layerConfigs[Ae.id]=Ae,(this._layers[Ae.id]=h.cv(Ae,this.scope,null,this._options)).compileFilter(Se),this.keyCache[Ae.id]&&delete this.keyCache[Ae.id];for(const Ae of ce)delete this.keyCache[Ae],delete this._layerConfigs[Ae],delete this._layers[Ae];this.familiesBySource={};const Pe=function(Ae,Ne){const Ke={};for(let tt=0;tt<Ae.length;tt++){const Qe=Ae[tt];let nt=Ne&&Ne[Qe.id];!nt&&(nt=Kn(Qe),"line"===Qe.type&&Qe.paint)&&function Yt(Qt){return"string"==typeof Qt&&"line-progress"===Qt||(Array.isArray(Qt)?Qt.some(Yt):!(!Qt||"object"!=typeof Qt)&&Object.values(Qt).some(Yt))}(Qe.paint["line-width"])&&(nt+=`/${Ro(Qe.paint["line-width"])}`),Ne&&(Ne[Qe.id]=nt);let Dt=Ke[nt];Dt||(Dt=Ke[nt]=[]),Dt.push(Qe)}const je=[];for(const tt in Ke)je.push(Ke[tt]);return je}(Object.values(this._layerConfigs),this.keyCache);for(const Ae of Pe){const Ne=Ae.map(Dt=>this._layers[Dt.id]),Ke=Ne[0];if("none"===Ke.visibility)continue;const je=Ke.source||"";let tt=this.familiesBySource[je];tt||(tt=this.familiesBySource[je]={});const Qe=Ke.sourceLayer||"_geojsonTileLayer";let nt=tt[Qe];nt||(nt=tt[Qe]=[]),nt.push(Ne)}}}const To=1*h.d_;class nr{constructor(re){const ce={},Se=[];for(const Ke in re){const je=re[Ke],tt=ce[Ke]={};for(const Qe in je.glyphs){const nt=je.glyphs[+Qe];if(!nt||0===nt.bitmap.width||0===nt.bitmap.height)continue;const Dt=nt.metrics.localGlyph?To:1,Yt={x:0,y:0,w:nt.bitmap.width+2*Dt,h:nt.bitmap.height+2*Dt};Se.push(Yt),tt[Qe]=Yt}}const{w:Pe,h:Ae}=h.H(Se),Ne=new h.dZ({width:Pe||1,height:Ae||1});for(const Ke in re){const je=re[Ke];for(const tt in je.glyphs){const Qe=je.glyphs[+tt];if(!Qe||0===Qe.bitmap.width||0===Qe.bitmap.height)continue;const nt=ce[Ke][tt],Dt=Qe.metrics.localGlyph?To:1;h.dZ.copy(Qe.bitmap,Ne,{x:0,y:0},{x:nt.x+Dt,y:nt.y+Dt},Qe.bitmap)}}this.image=Ne,this.positions=ce}}h.dY(nr,"GlyphAtlas");class jn{constructor(re){this.tileID=new h.aH(re.tileID.overscaledZ,re.tileID.wrap,re.tileID.canonical.z,re.tileID.canonical.x,re.tileID.canonical.y),this.tileZoom=re.tileZoom,this.uid=re.uid,this.zoom=re.zoom,this.lut=re.lut,this.canonical=re.tileID.canonical,this.pixelRatio=re.pixelRatio,this.tileSize=re.tileSize,this.source=re.source,this.scope=re.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=re.showCollisionBoxes,this.collectResourceTiming=!!re.request&&re.request.collectResourceTiming,this.promoteId=re.promoteId,this.isSymbolTile=re.isSymbolTile,this.tileTransform=h.aR(re.tileID.canonical,re.projection),this.projection=re.projection,this.worldview=re.worldview,this.localizableLayerIds=re.localizableLayerIds,this.brightness=re.brightness,this.extraShadowCaster=!!re.extraShadowCaster,this.tessellationStep=re.tessellationStep,this.scaleFactor=re.scaleFactor}parse(re,ce,Se,Pe,Ae){this.status="parsing",this.data=re,this.collisionBoxArray=new h.aX;const Ne=new h.d$(Object.keys(re.layers).sort()),Ke=new h.e0(this.tileID,this.promoteId);Ke.bucketLayerIDs=[];const je={},tt=new h.e1(256,256),Qe={featureIndex:Ke,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:tt,availableImages:Se,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},nt=ce.familiesBySource[this.source];for(const si in nt){const an=re.layers[si];if(!an)continue;let Wi=!1,ji=!1,bt=!1;for(const Cs of nt[si])"symbol"===Cs[0].type?Wi=!0:ji=!0,Cs[0].is3D()&&"model"!==Cs[0].type&&(bt=!0);if(this.extraShadowCaster&&!bt||!0===this.isSymbolTile&&!Wi||!1===this.isSymbolTile&&!ji)continue;1===an.version&&h.w(`Vector tile source "${this.source}" layer "${si}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Oo=Ne.encode(si),eo=[];let Ks=!1;for(let Cs=0,Zo=0;Cs<an.length;Cs++){const Fo=an.feature(Cs),la=Ke.getId(Fo,si);if(this.localizableLayerIds&&this.localizableLayerIds.has(si)){const Es=Fo.properties?Fo.properties.worldview:null;if(this.worldview&&"string"==typeof Es)if("all"===Es)Fo.properties.$localized=!0;else{if(!Es.split(",").includes(this.worldview))continue;Fo.properties.$localized=!0,Fo.properties.worldview=this.worldview}}!Ks&&Fo.properties&&Fo.properties.hasOwnProperty(h.e2)&&(Ks=!0),eo.push({feature:Fo,id:la,index:Zo,sourceLayerIndex:Oo}),Zo++}Ks&&!Qe.elevationFeatures&&re.layers.hasOwnProperty(h.e3)&&(Qe.elevationFeatures=h.e4.parseFrom(re.layers[h.e3],this.canonical));for(const Cs of nt[si]){const Zo=Cs[0];(!this.extraShadowCaster||Zo.is3D()&&"model"!==Zo.type)&&(void 0!==this.isSymbolTile&&"symbol"===Zo.type!==this.isSymbolTile||Zo.minzoom&&this.zoom<Math.floor(Zo.minzoom)||Zo.maxzoom&&this.zoom>=Zo.maxzoom||"none"!==Zo.visibility&&(ri(Cs,this.zoom,Qe.brightness,Se),(je[Zo.id]=Zo.createBucket({index:Ke.bucketLayerIDs.length,layers:Cs,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Oo,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(eo,Qe,this.tileID.canonical,this.tileTransform),Ke.bucketLayerIDs.push(Cs.map(Fo=>h.C(Fo.id,Fo.scope)))))}}let Dt,Yt,Qt,Et,Ln,pn;tt.trim();const Hn={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Jn=()=>{if(Dt)return this.status="done",Ae(Dt);if(this.extraShadowCaster)this.status="done",Ae(null,{buckets:Object.values(je).filter(si=>!si.isEmpty()),featureIndex:Ke,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Qe.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Yt&&Qt&&Et){const si=new nr(Yt),an=new Map;for(const[bt,Oo]of Qt.entries()){const{imagePosition:eo}=h.e7(bt,Oo,h.e8);an.set(bt,eo)}const Wi={};for(const bt in je){const Oo=je[bt];Oo instanceof h.aY&&(ri(Oo.layers,this.zoom,Qe.brightness,Se),Wi[bt]=h.e9(Oo,Yt,si.positions,Qt,an,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio))}const ji={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Pe,Qt,Ln,()=>{ji.iconsPending=!1,li(Wi,si,ji)}),this.rasterizeIfNeeded(Pe,Et,pn,()=>{ji.patternsPending=!1,li(Wi,si,ji)})}},li=(si,an,Wi,ji)=>{if(Wi.iconsPending||Wi.patternsPending)return;const bt=new h.ea(Qt,Et,this.lut);for(const Oo in je){const eo=je[Oo];if(Oo in si)h.eb(eo,si[Oo],this.showCollisionBoxes,Se,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Qt,bt);else if(eo.hasPattern&&(eo instanceof h.b2||eo instanceof h.b3||eo instanceof h.d8)){ri(eo.layers,this.zoom,Qe.brightness,Se);const Ks=Object.fromEntries(bt.patternPositions);eo.addFeatures(Qe,this.tileID.canonical,Ks,Se,this.tileTransform,this.brightness)}}this.status="done",Ae(null,{buckets:Object.values(je).filter(Oo=>!Oo.isEmpty()),featureIndex:Ke,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:an.image,lineAtlas:tt,imageAtlas:bt,brightness:Qe.brightness})};if(!this.extraShadowCaster){const si=h.e5(Qe.glyphDependencies,ji=>Object.keys(ji).map(Number));Object.keys(si).length?Pe.send("getGlyphs",{uid:this.uid,stacks:si,scope:this.scope},(ji,bt)=>{Dt||(Dt=ji,Yt=bt,Jn())},void 0,!1,Hn):Yt={};const an=Array.from(Qe.iconDependencies.keys()).map(ji=>h.I.parse(ji));an.length?Pe.send("getImages",{images:an,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(ji,bt)=>{Dt||(Dt=ji,Qt=new Map,Ln=this.updateImageMapAndGetImageTaskQueue(Qt,bt,Qe.iconDependencies),Jn())},void 0,!1,Hn):(Qt=new Map,Ln=new Map);const Wi=Array.from(Qe.patternDependencies.keys()).map(ji=>h.I.parse(ji));Wi.length?Pe.send("getImages",{images:Wi,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(ji,bt)=>{Dt||(Dt=ji,Et=new Map,pn=this.updateImageMapAndGetImageTaskQueue(Et,bt,Qe.patternDependencies),Jn())},void 0,!1,Hn):(Et=new Map,pn=new Map)}if(Qe.elevationFeatures&&Qe.elevationFeatures.length>0){const si=[];for(const Wi of Object.values(je))if(Wi instanceof h.b3){const ji=Wi.getUnevaluatedPortalGraph();ji&&si.push(ji)}const an=h.e6.evaluate(si);for(const Wi of Object.values(je))Wi instanceof h.b3&&Wi.setEvaluatedPortalGraph(an)}Jn()}rasterizeIfNeeded(re,ce,Se,Pe){Array.from(ce.values()).some(Ae=>Ae.usvg)?this.rasterize(re,ce,Se,Pe):Pe()}updateImageMapAndGetImageTaskQueue(re,ce,Se){const Pe=new Map;for(const Ae of ce.keys()){const Ne=Se.get(Ae)||[];for(const Ke of Ne){const je=Ke.toString(),tt=ce.get(Ke.id.toString());tt.usvg?Pe.has(je)||(Pe.set(je,Ke),re.set(je,Object.assign({},tt))):re.set(je,tt)}}return Pe}rasterize(re,ce,Se,Pe){this.rasterizeTask=re.send("rasterizeImages",{scope:this.scope,tasks:Se},(Ae,Ne)=>{if(!Ae)for(const[Ke,je]of Ne.entries()){const tt=Object.assign(ce.get(Ke),{data:je});ce.set(Ke,tt)}Pe()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function ri(it,re,ce,Se){const Pe=new h.aa(re,{brightness:ce});for(const Ae of it)Ae.recalculate(Pe,Se)}class Bi extends h.E{constructor(re,ce,Se,Pe,Ae,Ne){super(),this.actor=re,this.layerIndex=ce,this.availableImages=Se,this.loadVectorData=Ae||h.aE,this.loading={},this.loaded={},this.deduped=new h.aD(re.scheduler),this.isSpriteLoaded=Pe,this.scheduler=re.scheduler,this.brightness=Ne}loadTile(re,ce){const Se=re.uid,Pe=re&&re.request,Ae=Pe&&Pe.collectResourceTiming,Ne=this.loading[Se]=new jn(re);Ne.abort=this.loadVectorData(re,(Ke,je)=>{const tt=!this.loading[Se];if(delete this.loading[Se],Ne.cancelRasterize(),tt||Ke||!je)return Ne.status="done",tt||(this.loaded[Se]=Ne),ce(Ke);const Qe=je.rawData,nt={};je.expires&&(nt.expires=je.expires),je.cacheControl&&(nt.cacheControl=je.cacheControl),Ne.vectorTile=je.vectorTile||new h.ec.VectorTile(new h.bi(Qe));const Dt=()=>{Ne.parse(Ne.vectorTile,this.layerIndex,this.availableImages,this.actor,(Yt,Qt)=>{if(Yt||!Qt)return ce(Yt);const Et={};if(Ae){const Ln=Jr(Pe);Ln.length>0&&(Et.resourceTiming=JSON.parse(JSON.stringify(Ln)))}ce(null,h.l({rawTileData:Qe.slice(0)},Qt,nt,Et))})};this.isSpriteLoaded?Dt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Dt,{type:"parseTile",isSymbolTile:re.isSymbolTile,zoom:re.tileZoom}):Dt()}),this.loaded=this.loaded||{},this.loaded[Se]=Ne})}reloadTile(re,ce){const Se=this.loaded,Pe=re.uid;if(Se&&Se[Pe]){const Ae=Se[Pe];Ae.scaleFactor=re.scaleFactor,Ae.showCollisionBoxes=re.showCollisionBoxes,Ae.projection=re.projection,Ae.brightness=re.brightness,Ae.tileTransform=h.aR(re.tileID.canonical,re.projection),Ae.extraShadowCaster=re.extraShadowCaster,Ae.lut=re.lut;const Ne=(Ke,je)=>{const tt=Ae.reloadCallback;tt&&(delete Ae.reloadCallback,Ae.parse(Ae.vectorTile,this.layerIndex,this.availableImages,this.actor,tt)),ce(Ke,je)};"parsing"===Ae.status?Ae.reloadCallback=Ne:"done"===Ae.status&&(Ae.vectorTile?Ae.parse(Ae.vectorTile,this.layerIndex,this.availableImages,this.actor,Ne):Ne())}else ce(null,void 0)}abortTile(re,ce){const Se=re.uid,Pe=this.loading[Se];Pe&&(Pe.abort&&Pe.abort(),delete this.loading[Se]),ce()}removeTile(re,ce){const Se=this.loaded,Pe=re.uid;Se&&Se[Pe]&&delete Se[Pe],ce()}}class fi{loadTile(re,ce){const{uid:Se,encoding:Pe,rawImageData:Ae,padding:Ne}=re,Ke=ImageBitmap&&Ae instanceof ImageBitmap?this.getImageData(Ae,Ne):Ae;ce(null,new h.ed(Se,Ke,Pe,Ne<1))}reloadTile(re,ce){ce(null,null)}abortTile(re,ce){ce()}removeTile(re,ce){ce()}getImageData(re,ce){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(re.width,re.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=re.width,this.offscreenCanvas.height=re.height,this.offscreenCanvasContext.drawImage(re,0,0,re.width,re.height);const Se=this.offscreenCanvasContext.getImageData(-ce,-ce,re.width+2*ce,re.height+2*ce);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Se}}h.bh.setPbf(h.bi);class Ta{constructor(re){this._mrt=new h.bh(re.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=re.uid,this.tileID=re.tileID,this.source=re.source}parse(re,ce){const Se=this._mrt;this.status="parsing",this._entireBuffer=re;try{Se.parseHeader(re),this._isHeaderLoaded=!0;const Pe=[];for(const Ae in Se.layers){const Ne=Se.getLayer(Ae),Ke=Ne.getDataRange(Ne.getBandList()),je=Se.createDecodingTask(Ke),tt=re.slice(Ke.firstByte,Ke.lastByte+1),Qe=h.bh.performDecoding(tt,je).then(nt=>je.complete(null,nt)).catch(nt=>je.complete(nt,null));Pe.push(Qe)}Promise.allSettled(Pe).then(()=>ce(null,Se))}catch(Pe){ce(Pe)}}}class jc{constructor(re){this.actor=re,this.loading={},this.loaded={}}loadTile(re,ce){const Se=re.uid,Pe=re.request,Ae=this.loading[Se]=new Ta(re),{cancel:Ne}=h.bj(Pe,(Ke,je,tt,Qe)=>{const nt=!this.loading[Se];if(delete this.loading[Se],nt||Ke||!je)return Ae.status="done",nt||(this.loaded[Se]=Ae),ce(Ke);Ae.parse(je,(Dt,Yt)=>{if(Dt||!Yt)return ce(Dt);ce(null,Yt,tt,Qe)}),this.loaded[Se]=Ae});Ae.abort=Ne}reloadTile(re,ce){ce(null,void 0)}abortTile(re,ce){const Se=re.uid,Pe=this.loading[Se];Pe&&(Pe.abort&&Pe.abort(),delete this.loading[Se]),ce()}removeTile(re,ce){const Se=re.uid;this.loaded[Se]&&delete this.loaded[Se],ce()}decodeRasterArray({task:re,buffer:ce},Se){h.bh.performDecoding(ce,re).then(Pe=>Se(null,Pe)).catch(Pe=>Se(Pe))}}const Li=h.ec.VectorTileFeature.prototype.toGeoJSON;class Ld{constructor(re){this._feature=re,this.extent=h.ai,this.type=re.type,this.properties=re.tags,"id"in re&&!isNaN(re.id)&&(this.id=parseInt(re.id,10))}loadGeometry(){if(1===this._feature.type){const re=[];for(const ce of this._feature.geometry)re.push([new h.P(ce[0],ce[1])]);return re}{const re=[];for(const ce of this._feature.geometry){const Se=[];for(const Pe of ce)Se.push(new h.P(Pe[0],Pe[1]));re.push(Se)}return re}}toGeoJSON(re,ce,Se){return Li.call(this,re,ce,Se)}}class Ia{constructor(re){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=h.ai,this.length=re.length,this._features=re}feature(re){return new Ld(this._features[re])}}const Sn=64/4096;class pc{constructor(){this.features=new Map}clear(){this.features.clear()}load(re=[],ce){for(const Se of re){const Pe=Se.id;if(null==Pe)continue;let Ae=this.features.get(Pe);Ae&&this.updateCache(Ae,ce),Se.geometry?(Ae=zn(Se),this.updateCache(Ae,ce),this.features.set(Pe,Ae)):this.features.delete(Pe),this.updateCache(Ae,ce)}}updateCache(re,ce){for(const{canonical:Se,uid:Pe}of Object.values(ce)){const{z:Ae,x:Ne,y:Ke}=Se;On(re,Math.pow(2,Ae),Ne,Ke)&&delete ce[Pe]}}getTile(re,ce,Se){const Pe=Math.pow(2,re),Ae=[];for(const Ne of this.features.values())On(Ne,Pe,ce,Se)&&Ae.push(oi(Ne,Pe,ce,Se));return{features:Ae}}getFeatures(){return[...this.features.values()]}}function On({minX:it,minY:re,maxX:ce,maxY:Se},Pe,Ae,Ne){return it<(Ae+1+Sn)/Pe&&re<(Ne+1+Sn)/Pe&&ce>(Ae-Sn)/Pe&&Se>(Ne-Sn)/Pe}function zn(it){const{id:re,geometry:ce,properties:Se}=it;if(!ce)return;if("GeometryCollection"===ce.type)throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Pe,coordinates:Ae}=ce,Ne={id:re,type:1,geometry:[],tags:Se,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Ke=Ne.geometry;if("Point"===Pe)Nl(Ae,Ke,Ne);else if("MultiPoint"===Pe)for(const je of Ae)Nl(je,Ke,Ne);else if("LineString"===Pe)Ne.type=2,zl(Ae,Ke,Ne);else if("MultiLineString"===Pe)Ne.type=2,Hc(Ae,Ke,Ne);else if("Polygon"===Pe)Ne.type=3,Hc(Ae,Ke,Ne,!0);else{if("MultiPolygon"!==Pe)throw new Error("Input data is not a valid GeoJSON object.");Ne.type=3;for(const je of Ae)Hc(je,Ke,Ne,!0)}return Ne}function Nl([it,re],ce,Se){const Pe=h.av(it);let Ae=h.aC(re);Ae=Ae<0?0:Ae>1?1:Ae,ce.push(Pe,Ae),Se.minX=Math.min(Se.minX,Pe),Se.minY=Math.min(Se.minY,Ae),Se.maxX=Math.max(Se.maxX,Pe),Se.maxY=Math.max(Se.maxY,Ae)}function zl(it,re,ce,Se=!1,Pe=!1){const Ae=[];for(const Ne of it)Nl(Ne,Ae,ce);re.push(Ae),Se&&function(Ne,Ke){let je=0;for(let tt=0,Qe=Ne.length,nt=Qe-2;tt<Qe;nt=tt,tt+=2)je+=(Ne[tt]-Ne[nt])*(Ne[tt+1]+Ne[nt+1]);if(je>0===Ke)for(let tt=0,Qe=Ne.length;tt<Qe/2;tt+=2){const nt=Ne[tt],Dt=Ne[tt+1];Ne[tt]=Ne[Qe-2-tt],Ne[tt+1]=Ne[Qe-1-tt],Ne[Qe-2-tt]=nt,Ne[Qe-1-tt]=Dt}}(Ae,Pe)}function Hc(it,re,ce,Se=!1){for(let Pe=0;Pe<it.length;Pe++)zl(it[Pe],re,ce,Se,0===Pe)}function oi(it,re,ce,Se){const{id:Pe,type:Ae,geometry:Ne,tags:Ke}=it,je=[];if(1===Ae)!function(tt,Qe,nt,Dt,Yt){for(let Qt=0;Qt<tt.length;Qt+=2){const Et=Math.round(h.ai*(tt[Qt+0]*Qe-nt)),Ln=Math.round(h.ai*(tt[Qt+1]*Qe-Dt));Yt.push([Et,Ln])}}(Ne,re,ce,Se,je);else for(const tt of Ne)Ys(tt,re,ce,Se,je);return{id:Pe,type:Ae,geometry:je,tags:Ke}}function Ys(it,re,ce,Se,Pe){const Ae=-128,Ne=h.ai+128;let Ke;for(let je=0;je<it.length-2;je+=2){let tt=Math.round(h.ai*(it[je+0]*re-ce)),Qe=Math.round(h.ai*(it[je+1]*re-Se)),nt=Math.round(h.ai*(it[je+2]*re-ce)),Dt=Math.round(h.ai*(it[je+3]*re-Se));const Yt=nt-tt,Qt=Dt-Qe;tt<Ae&&nt<Ae||(tt<Ae?(Qe+=Math.round(Qt*((Ae-tt)/Yt)),tt=Ae):nt<Ae&&(Dt=Qe+Math.round(Qt*((Ae-tt)/Yt)),nt=Ae),Qe<Ae&&Dt<Ae||(Qe<Ae?(tt+=Math.round(Yt*((Ae-Qe)/Qt)),Qe=Ae):Dt<Ae&&(nt=tt+Math.round(Yt*((Ae-Qe)/Qt)),Dt=Ae),tt>=Ne&&nt>=Ne||(tt>=Ne?(Qe+=Math.round(Qt*((Ne-tt)/Yt)),tt=Ne):nt>=Ne&&(Dt=Qe+Math.round(Qt*((Ne-tt)/Yt)),nt=Ne),Qe>=Ne&&Dt>=Ne||(Qe>=Ne?(tt+=Math.round(Yt*((Ne-Qe)/Qt)),Qe=Ne):Dt>=Ne&&(nt=tt+Math.round(Yt*((Ne-Qe)/Qt)),Dt=Ne),Ke&&tt===Ke[Ke.length-1][0]&&Qe===Ke[Ke.length-1][1]||(Ke=[[tt,Qe]],Pe.push(Ke)),Ke.push([nt,Dt])))))}}var il,rl,qn,Yo={exports:{}},Gp=function(){if(qn)return Yo.exports;qn=1;var it=h.eg(),re=function(){if(rl)return il;rl=1;var Qe=h.ee(),nt=h.ef().VectorTileFeature;function Dt(Qt,Et){this.options=Et||{},this.features=Qt,this.length=Qt.length}function Yt(Qt,Et){this.id="number"==typeof Qt.id?Qt.id:void 0,this.type=Qt.type,this.rawGeometry=1===Qt.type?[Qt.geometry]:Qt.geometry,this.properties=Qt.tags,this.extent=Et||4096}return il=Dt,Dt.prototype.feature=function(Qt){return new Yt(this.features[Qt],this.options.extent)},Yt.prototype.loadGeometry=function(){var Qt=this.rawGeometry;this.geometry=[];for(var Et=0;Et<Qt.length;Et++){for(var Ln=Qt[Et],pn=[],Hn=0;Hn<Ln.length;Hn++)pn.push(new Qe(Ln[Hn][0],Ln[Hn][1]));this.geometry.push(pn)}return this.geometry},Yt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Qt=this.geometry,Et=1/0,Ln=-1/0,pn=1/0,Hn=-1/0,Jn=0;Jn<Qt.length;Jn++)for(var li=Qt[Jn],si=0;si<li.length;si++){var an=li[si];Et=Math.min(Et,an.x),Ln=Math.max(Ln,an.x),pn=Math.min(pn,an.y),Hn=Math.max(Hn,an.y)}return[Et,pn,Ln,Hn]},Yt.prototype.toGeoJSON=nt.prototype.toGeoJSON,il}();function ce(Qe){var nt=new it;return function(Dt,Yt){for(var Qt in Dt.layers)Yt.writeMessage(3,Se,Dt.layers[Qt])}(Qe,nt),nt.finish()}function Se(Qe,nt){var Dt;nt.writeVarintField(15,Qe.version||1),nt.writeStringField(1,Qe.name||""),nt.writeVarintField(5,Qe.extent||4096);var Yt={keys:[],values:[],keycache:{},valuecache:{}};for(Dt=0;Dt<Qe.length;Dt++)Yt.feature=Qe.feature(Dt),nt.writeMessage(2,Pe,Yt);var Qt=Yt.keys;for(Dt=0;Dt<Qt.length;Dt++)nt.writeStringField(3,Qt[Dt]);var Et=Yt.values;for(Dt=0;Dt<Et.length;Dt++)nt.writeMessage(4,tt,Et[Dt])}function Pe(Qe,nt){var Dt=Qe.feature;void 0!==Dt.id&&nt.writeVarintField(1,Dt.id),nt.writeMessage(2,Ae,Qe),nt.writeVarintField(3,Dt.type),nt.writeMessage(4,je,Dt)}function Ae(Qe,nt){var Dt=Qe.feature,Yt=Qe.keys,Qt=Qe.values,Et=Qe.keycache,Ln=Qe.valuecache;for(var pn in Dt.properties){var Hn=Dt.properties[pn],Jn=Et[pn];if(null!==Hn){void 0===Jn&&(Yt.push(pn),Et[pn]=Jn=Yt.length-1),nt.writeVarint(Jn);var li=typeof Hn;"string"!==li&&"boolean"!==li&&"number"!==li&&(Hn=JSON.stringify(Hn));var si=li+":"+Hn,an=Ln[si];void 0===an&&(Qt.push(Hn),Ln[si]=an=Qt.length-1),nt.writeVarint(an)}}}function Ne(Qe,nt){return(nt<<3)+(7&Qe)}function Ke(Qe){return Qe<<1^Qe>>31}function je(Qe,nt){for(var Dt=Qe.loadGeometry(),Yt=Qe.type,Qt=0,Et=0,Ln=Dt.length,pn=0;pn<Ln;pn++){var Hn=Dt[pn],Jn=1;1===Yt&&(Jn=Hn.length),nt.writeVarint(Ne(1,Jn));for(var li=3===Yt?Hn.length-1:Hn.length,si=0;si<li;si++){1===si&&1!==Yt&&nt.writeVarint(Ne(2,li-1));var an=Hn[si].x-Qt,Wi=Hn[si].y-Et;nt.writeVarint(Ke(an)),nt.writeVarint(Ke(Wi)),Qt+=an,Et+=Wi}3===Yt&&nt.writeVarint(Ne(7,1))}}function tt(Qe,nt){var Dt=typeof Qe;"string"===Dt?nt.writeStringField(1,Qe):"boolean"===Dt?nt.writeBooleanField(7,Qe):"number"===Dt&&(Qe%1!=0?nt.writeDoubleField(3,Qe):Qe<0?nt.writeSVarintField(6,Qe):nt.writeVarintField(5,Qe))}return Yo.exports=ce,Yo.exports.fromVectorTileJs=ce,Yo.exports.fromGeojsonVt=function(Qe,nt){nt=nt||{};var Dt={};for(var Yt in Qe)Dt[Yt]=new re(Qe[Yt].features,nt),Dt[Yt].name=Yt,Dt[Yt].version=nt.version,Dt[Yt].extent=nt.extent;return ce({layers:Dt})},Yo.exports.GeoJSONWrapper=re,Yo.exports}(),Oh=h.eh(Gp);const $n={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:it=>it},qp=Math.fround||(Fh=new Float32Array(1),it=>(Fh[0]=+it,Fh[0]));var Fh;class $c{constructor(re){this.options=Object.assign(Object.create($n),re),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(re){const{log:ce,minZoom:Se,maxZoom:Pe}=this.options;ce&&console.time("total time");const Ae=`prepare ${re.length} points`;ce&&console.time(Ae),this.points=re;const Ne=[];for(let je=0;je<re.length;je++){const tt=re[je];if(!tt.geometry)continue;const[Qe,nt]=tt.geometry.coordinates,Dt=qp(fc(Qe)),Yt=qp(Nd(nt));Ne.push(Dt,Yt,1/0,je,-1,1),this.options.reduce&&Ne.push(0)}let Ke=this.trees[Pe+1]=this._createTree(Ne);ce&&console.timeEnd(Ae);for(let je=Pe;je>=Se;je--){const tt=+Date.now();Ke=this.trees[je]=this._createTree(this._cluster(Ke,je)),ce&&console.log("z%d: %d clusters in %dms",je,Ke.numItems,+Date.now()-tt)}return ce&&console.timeEnd("total time"),this}getClusters(re,ce){let Se=((re[0]+180)%360+360)%360-180;const Pe=Math.max(-90,Math.min(90,re[1]));let Ae=180===re[2]?180:((re[2]+180)%360+360)%360-180;const Ne=Math.max(-90,Math.min(90,re[3]));if(re[2]-re[0]>=360)Se=-180,Ae=180;else if(Se>Ae){const nt=this.getClusters([Se,Pe,180,Ne],ce),Dt=this.getClusters([-180,Pe,Ae,Ne],ce);return nt.concat(Dt)}const Ke=this.trees[this._limitZoom(ce)],je=Ke.range(fc(Se),Nd(Ne),fc(Ae),Nd(Pe)),tt=Ke.data,Qe=[];for(const nt of je){const Dt=this.stride*nt;Qe.push(tt[Dt+5]>1?ge(tt,Dt,this.clusterProps):this.points[tt[Dt+3]])}return Qe}getChildren(re){const ce=this._getOriginId(re),Se=this._getOriginZoom(re),Pe="No cluster with the specified id.",Ae=this.trees[Se];if(!Ae)throw new Error(Pe);const Ne=Ae.data;if(ce*this.stride>=Ne.length)throw new Error(Pe);const Ke=this.options.radius/(this.options.extent*Math.pow(2,Se-1)),je=Ae.within(Ne[ce*this.stride],Ne[ce*this.stride+1],Ke),tt=[];for(const Qe of je){const nt=Qe*this.stride;Ne[nt+4]===re&&tt.push(Ne[nt+5]>1?ge(Ne,nt,this.clusterProps):this.points[Ne[nt+3]])}if(0===tt.length)throw new Error(Pe);return tt}getLeaves(re,ce,Se){const Pe=[];return this._appendLeaves(Pe,re,ce=ce||10,Se=Se||0,0),Pe}getTile(re,ce,Se){const Pe=this.trees[this._limitZoom(re)],Ae=Math.pow(2,re),{extent:Ne,radius:Ke}=this.options,je=Ke/Ne,tt=(Se-je)/Ae,Qe=(Se+1+je)/Ae,nt={features:[]};return this._addTileFeatures(Pe.range((ce-je)/Ae,tt,(ce+1+je)/Ae,Qe),Pe.data,ce,Se,Ae,nt),0===ce&&this._addTileFeatures(Pe.range(1-je/Ae,tt,1,Qe),Pe.data,Ae,Se,Ae,nt),ce===Ae-1&&this._addTileFeatures(Pe.range(0,tt,je/Ae,Qe),Pe.data,-1,Se,Ae,nt),nt.features.length?nt:null}getClusterExpansionZoom(re){let ce=this._getOriginZoom(re)-1;for(;ce<=this.options.maxZoom;){const Se=this.getChildren(re);if(ce++,1!==Se.length)break;re=Se[0].properties.cluster_id}return ce}_appendLeaves(re,ce,Se,Pe,Ae){const Ne=this.getChildren(ce);for(const Ke of Ne){const je=Ke.properties;if(je&&je.cluster?Ae+je.point_count<=Pe?Ae+=je.point_count:Ae=this._appendLeaves(re,je.cluster_id,Se,Pe,Ae):Ae<Pe?Ae++:re.push(Ke),re.length===Se)break}return Ae}_createTree(re){const ce=new h.bE(re.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Se=0;Se<re.length;Se+=this.stride)ce.add(re[Se],re[Se+1]);return ce.finish(),ce.data=re,ce}_addTileFeatures(re,ce,Se,Pe,Ae,Ne){for(const Ke of re){const je=Ke*this.stride,tt=ce[je+5]>1;let Qe,nt,Dt;if(tt)Qe=Lh(ce,je,this.clusterProps),nt=ce[je],Dt=ce[je+1];else{const Et=this.points[ce[je+3]];Qe=Et.properties;const[Ln,pn]=Et.geometry.coordinates;nt=fc(Ln),Dt=Nd(pn)}const Yt={type:1,geometry:[[Math.round(this.options.extent*(nt*Ae-Se)),Math.round(this.options.extent*(Dt*Ae-Pe))]],tags:Qe};let Qt;Qt=tt||this.options.generateId?ce[je+3]:this.points[ce[je+3]].id,void 0!==Qt&&(Yt.id=Qt),Ne.features.push(Yt)}}_limitZoom(re){return Math.max(this.options.minZoom,Math.min(Math.floor(+re),this.options.maxZoom+1))}_cluster(re,ce){const{radius:Se,extent:Pe,reduce:Ae,minPoints:Ne}=this.options,Ke=Se/(Pe*Math.pow(2,ce)),je=re.data,tt=[],Qe=this.stride;for(let nt=0;nt<je.length;nt+=Qe){if(je[nt+2]<=ce)continue;je[nt+2]=ce;const Dt=je[nt],Yt=je[nt+1],Qt=re.within(je[nt],je[nt+1],Ke),Et=je[nt+5];let Ln=Et;for(const pn of Qt){const Hn=pn*Qe;je[Hn+2]>ce&&(Ln+=je[Hn+5])}if(Ln>Et&&Ln>=Ne){let pn,Hn=Dt*Et,Jn=Yt*Et,li=-1;const si=(nt/Qe<<5)+(ce+1)+this.points.length;for(const an of Qt){const Wi=an*Qe;if(je[Wi+2]<=ce)continue;je[Wi+2]=ce;const ji=je[Wi+5];Hn+=je[Wi]*ji,Jn+=je[Wi+1]*ji,je[Wi+4]=si,Ae&&(pn||(pn=this._map(je,nt,!0),li=this.clusterProps.length,this.clusterProps.push(pn)),Ae(pn,this._map(je,Wi)))}je[nt+4]=si,tt.push(Hn/Ln,Jn/Ln,1/0,si,-1,Ln),Ae&&tt.push(li)}else{for(let pn=0;pn<Qe;pn++)tt.push(je[nt+pn]);if(Ln>1)for(const pn of Qt){const Hn=pn*Qe;if(!(je[Hn+2]<=ce)){je[Hn+2]=ce;for(let Jn=0;Jn<Qe;Jn++)tt.push(je[Hn+Jn])}}}}return tt}_getOriginId(re){return re-this.points.length>>5}_getOriginZoom(re){return(re-this.points.length)%32}_map(re,ce,Se){if(re[ce+5]>1){const Ne=this.clusterProps[re[ce+6]];return Se?Object.assign({},Ne):Ne}const Pe=this.points[re[ce+3]].properties,Ae=this.options.map(Pe);return Se&&Ae===Pe?Object.assign({},Ae):Ae}}function ge(it,re,ce){return{type:"Feature",id:it[re+3],properties:Lh(it,re,ce),geometry:{type:"Point",coordinates:[(Se=it[re],360*(Se-.5)),Ot(it[re+1])]}};var Se}function Lh(it,re,ce){const Se=it[re+5],Pe=Se>=1e4?`${Math.round(Se/1e3)}k`:Se>=1e3?Math.round(Se/100)/10+"k":Se,Ae=it[re+6],Ne=-1===Ae?{}:Object.assign({},ce[Ae]);return Object.assign(Ne,{cluster:!0,cluster_id:it[re+3],point_count:Se,point_count_abbreviated:Pe})}function fc(it){return it/360+.5}function Nd(it){const re=Math.sin(it*Math.PI/180),ce=.5-.25*Math.log((1+re)/(1-re))/Math.PI;return ce<0?0:ce>1?1:ce}function Ot(it){const re=(180-360*it)*Math.PI/180;return 360*Math.atan(Math.exp(re))/Math.PI-90}function Bl(it,re,ce,Se){let Pe=Se;const Ae=re+(ce-re>>1);let Ne,Ke=ce-re;const je=it[re],tt=it[re+1],Qe=it[ce],nt=it[ce+1];for(let Dt=re+3;Dt<ce;Dt+=3){const Yt=Xs(it[Dt],it[Dt+1],je,tt,Qe,nt);if(Yt>Pe)Ne=Dt,Pe=Yt;else if(Yt===Pe){const Qt=Math.abs(Dt-Ae);Qt<Ke&&(Ne=Dt,Ke=Qt)}}Pe>Se&&(Ne-re>3&&Bl(it,re,Ne,Se),it[Ne+2]=Pe,ce-Ne>3&&Bl(it,Ne,ce,Se))}function Xs(it,re,ce,Se,Pe,Ae){let Ne=Pe-ce,Ke=Ae-Se;if(0!==Ne||0!==Ke){const je=((it-ce)*Ne+(re-Se)*Ke)/(Ne*Ne+Ke*Ke);je>1?(ce=Pe,Se=Ae):je>0&&(ce+=Ne*je,Se+=Ke*je)}return Ne=it-ce,Ke=re-Se,Ne*Ne+Ke*Ke}function mc(it,re,ce,Se){const Pe={id:it??null,type:re,geometry:ce,tags:Se,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if("Point"===re||"MultiPoint"===re||"LineString"===re)yi(Pe,ce);else if("Polygon"===re)yi(Pe,ce[0]);else if("MultiLineString"===re)for(const Ae of ce)yi(Pe,Ae);else if("MultiPolygon"===re)for(const Ae of ce)yi(Pe,Ae[0]);return Pe}function yi(it,re){for(let ce=0;ce<re.length;ce+=3)it.minX=Math.min(it.minX,re[ce]),it.minY=Math.min(it.minY,re[ce+1]),it.maxX=Math.max(it.maxX,re[ce]),it.maxY=Math.max(it.maxY,re[ce+1])}function Po(it,re,ce,Se){if(!re.geometry)return;const Pe=re.geometry.coordinates;if(Pe&&0===Pe.length)return;const Ae=re.geometry.type,Ne=Math.pow(ce.tolerance/((1<<ce.maxZoom)*ce.extent),2);let Ke=[],je=re.id;if(ce.promoteId?je=re.properties[ce.promoteId]:ce.generateId&&(je=Se||0),"Point"===Ae)sl(Pe,Ke);else if("MultiPoint"===Ae)for(const tt of Pe)sl(tt,Ke);else if("LineString"===Ae)gc(Pe,Ke,Ne,!1);else if("MultiLineString"===Ae){if(ce.lineMetrics){for(const tt of Pe)Ke=[],gc(tt,Ke,Ne,!1),it.push(mc(je,"LineString",Ke,re.properties));return}Fs(Pe,Ke,Ne,!1)}else if("Polygon"===Ae)Fs(Pe,Ke,Ne,!0);else{if("MultiPolygon"!==Ae){if("GeometryCollection"===Ae){for(const tt of re.geometry.geometries)Po(it,{id:je,geometry:tt,properties:re.properties},ce,Se);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const tt of Pe){const Qe=[];Fs(tt,Qe,Ne,!0),Ke.push(Qe)}}it.push(mc(je,Ae,Ke,re.properties))}function sl(it,re){re.push(zd(it[0]),Qn(it[1]),0)}function gc(it,re,ce,Se){let Pe,Ae,Ne=0;for(let je=0;je<it.length;je++){const tt=zd(it[je][0]),Qe=Qn(it[je][1]);re.push(tt,Qe,0),je>0&&(Ne+=Se?(Pe*Qe-tt*Ae)/2:Math.sqrt(Math.pow(tt-Pe,2)+Math.pow(Qe-Ae,2))),Pe=tt,Ae=Qe}const Ke=re.length-3;re[2]=1,Bl(re,0,Ke,ce),re[Ke+2]=1,re.size=Math.abs(Ne),re.start=0,re.end=re.size}function Fs(it,re,ce,Se){for(let Pe=0;Pe<it.length;Pe++){const Ae=[];gc(it[Pe],Ae,ce,Se),re.push(Ae)}}function zd(it){return it/360+.5}function Qn(it){const re=Math.sin(it*Math.PI/180),ce=.5-.25*Math.log((1+re)/(1-re))/Math.PI;return ce<0?0:ce>1?1:ce}function aa(it,re,ce,Se,Pe,Ae,Ne,Ke){if(Se/=re,Ae>=(ce/=re)&&Ne<Se)return it;if(Ne<ce||Ae>=Se)return null;const je=[];for(const tt of it){const Qe=tt.geometry;let nt=tt.type;const Dt=0===Pe?tt.minX:tt.minY,Yt=0===Pe?tt.maxX:tt.maxY;if(Dt>=ce&&Yt<Se){je.push(tt);continue}if(Yt<ce||Dt>=Se)continue;let Qt=[];if("Point"===nt||"MultiPoint"===nt)Dr(Qe,Qt,ce,Se,Pe);else if("LineString"===nt)Gc(Qe,Qt,ce,Se,Pe,!1,Ke.lineMetrics);else if("MultiLineString"===nt)al(Qe,Qt,ce,Se,Pe,!1);else if("Polygon"===nt)al(Qe,Qt,ce,Se,Pe,!0);else if("MultiPolygon"===nt)for(const Et of Qe){const Ln=[];al(Et,Ln,ce,Se,Pe,!0),Ln.length&&Qt.push(Ln)}if(Qt.length){if(Ke.lineMetrics&&"LineString"===nt){for(const Et of Qt)je.push(mc(tt.id,nt,Et,tt.tags));continue}"LineString"!==nt&&"MultiLineString"!==nt||(1===Qt.length?(nt="LineString",Qt=Qt[0]):nt="MultiLineString"),"Point"!==nt&&"MultiPoint"!==nt||(nt=3===Qt.length?"Point":"MultiPoint"),je.push(mc(tt.id,nt,Qt,tt.tags))}}return je.length?je:null}function Dr(it,re,ce,Se,Pe){for(let Ae=0;Ae<it.length;Ae+=3){const Ne=it[Ae+Pe];Ne>=ce&&Ne<=Se&&Mi(re,it[Ae],it[Ae+1],it[Ae+2])}}function Gc(it,re,ce,Se,Pe,Ae,Ne){let Ke=ls(it);const je=0===Pe?Nh:zh;let tt,Qe,nt=it.start;for(let Ln=0;Ln<it.length-3;Ln+=3){const pn=it[Ln],Hn=it[Ln+1],Jn=it[Ln+2],li=it[Ln+3],si=it[Ln+4],an=0===Pe?pn:Hn,Wi=0===Pe?li:si;let ji=!1;Ne&&(tt=Math.sqrt(Math.pow(pn-li,2)+Math.pow(Hn-si,2))),an<ce?Wi>ce&&(Qe=je(Ke,pn,Hn,li,si,ce),Ne&&(Ke.start=nt+tt*Qe)):an>Se?Wi<Se&&(Qe=je(Ke,pn,Hn,li,si,Se),Ne&&(Ke.start=nt+tt*Qe)):Mi(Ke,pn,Hn,Jn),Wi<ce&&an>=ce&&(Qe=je(Ke,pn,Hn,li,si,ce),ji=!0),Wi>Se&&an<=Se&&(Qe=je(Ke,pn,Hn,li,si,Se),ji=!0),!Ae&&ji&&(Ne&&(Ke.end=nt+tt*Qe),re.push(Ke),Ke=ls(it)),Ne&&(nt+=tt)}let Dt=it.length-3;const Yt=it[Dt],Qt=it[Dt+1],Et=0===Pe?Yt:Qt;Et>=ce&&Et<=Se&&Mi(Ke,Yt,Qt,it[Dt+2]),Dt=Ke.length-3,Ae&&Dt>=3&&(Ke[Dt]!==Ke[0]||Ke[Dt+1]!==Ke[1])&&Mi(Ke,Ke[0],Ke[1],Ke[2]),Ke.length&&re.push(Ke)}function ls(it){const re=[];return re.size=it.size,re.start=it.start,re.end=it.end,re}function al(it,re,ce,Se,Pe,Ae){for(const Ne of it)Gc(Ne,re,ce,Se,Pe,Ae,!1)}function Mi(it,re,ce,Se){it.push(re,ce,Se)}function Nh(it,re,ce,Se,Pe,Ae){const Ne=(Ae-re)/(Se-re);return Mi(it,Ae,ce+(Pe-ce)*Ne,1),Ne}function zh(it,re,ce,Se,Pe,Ae){const Ne=(Ae-ce)/(Pe-ce);return Mi(it,re+(Se-re)*Ne,Ae,1),Ne}function Bd(it,re){const ce=[];for(let Se=0;Se<it.length;Se++){const Pe=it[Se],Ae=Pe.type;let Ne;if("Point"===Ae||"MultiPoint"===Ae||"LineString"===Ae)Ne=ka(Pe.geometry,re);else if("MultiLineString"===Ae||"Polygon"===Ae){Ne=[];for(const Ke of Pe.geometry)Ne.push(ka(Ke,re))}else if("MultiPolygon"===Ae){Ne=[];for(const Ke of Pe.geometry){const je=[];for(const tt of Ke)je.push(ka(tt,re));Ne.push(je)}}ce.push(mc(Pe.id,Ae,Ne,Pe.tags))}return ce}function ka(it,re){const ce=[];ce.size=it.size,void 0!==it.start&&(ce.start=it.start,ce.end=it.end);for(let Se=0;Se<it.length;Se+=3)ce.push(it[Se]+re,it[Se+1],it[Se+2]);return ce}function Ls(it,re){if(it.transformed)return it;const ce=1<<it.z,Se=it.x,Pe=it.y;for(const Ae of it.features){const Ne=Ae.geometry,Ke=Ae.type;if(Ae.geometry=[],1===Ke)for(let je=0;je<Ne.length;je+=2)Ae.geometry.push(Au(Ne[je],Ne[je+1],re,ce,Se,Pe));else for(let je=0;je<Ne.length;je++){const tt=[];for(let Qe=0;Qe<Ne[je].length;Qe+=2)tt.push(Au(Ne[je][Qe],Ne[je][Qe+1],re,ce,Se,Pe));Ae.geometry.push(tt)}}return it.transformed=!0,it}function Au(it,re,ce,Se,Pe,Ae){return[Math.round(ce*(it*Se-Pe)),Math.round(ce*(re*Se-Ae))]}function Ir(it,re,ce,Se,Pe){const Ae=re===Pe.maxZoom?0:Pe.tolerance/((1<<re)*Pe.extent),Ne={features:[],numPoints:0,numSimplified:0,numFeatures:it.length,source:null,x:ce,y:Se,z:re,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ke of it)ir(Ne,Ke,Ae,Pe);return Ne}function ir(it,re,ce,Se){const Pe=re.geometry,Ae=re.type,Ne=[];if(it.minX=Math.min(it.minX,re.minX),it.minY=Math.min(it.minY,re.minY),it.maxX=Math.max(it.maxX,re.maxX),it.maxY=Math.max(it.maxY,re.maxY),"Point"===Ae||"MultiPoint"===Ae)for(let Ke=0;Ke<Pe.length;Ke+=3)Ne.push(Pe[Ke],Pe[Ke+1]),it.numPoints++,it.numSimplified++;else if("LineString"===Ae)Yp(Ne,Pe,it,ce,!1,!1);else if("MultiLineString"===Ae||"Polygon"===Ae)for(let Ke=0;Ke<Pe.length;Ke++)Yp(Ne,Pe[Ke],it,ce,"Polygon"===Ae,0===Ke);else if("MultiPolygon"===Ae)for(let Ke=0;Ke<Pe.length;Ke++){const je=Pe[Ke];for(let tt=0;tt<je.length;tt++)Yp(Ne,je[tt],it,ce,!0,0===tt)}if(Ne.length){let Ke=re.tags||null;if("LineString"===Ae&&Se.lineMetrics){Ke={};for(const tt in re.tags)Ke[tt]=re.tags[tt];Ke.mapbox_clip_start=Pe.start/Pe.size,Ke.mapbox_clip_end=Pe.end/Pe.size}const je={geometry:Ne,type:"Polygon"===Ae||"MultiPolygon"===Ae?3:"LineString"===Ae||"MultiLineString"===Ae?2:1,tags:Ke};null!==re.id&&(je.id=re.id),it.features.push(je)}}function Yp(it,re,ce,Se,Pe,Ae){const Ne=Se*Se;if(Se>0&&re.size<(Pe?Ne:Se))return void(ce.numPoints+=re.length/3);const Ke=[];for(let je=0;je<re.length;je+=3)(0===Se||re[je+2]>Ne)&&(ce.numSimplified++,Ke.push(re[je],re[je+1])),ce.numPoints++;Pe&&function(je,tt){let Qe=0;for(let nt=0,Dt=je.length,Yt=Dt-2;nt<Dt;Yt=nt,nt+=2)Qe+=(je[nt]-je[Yt])*(je[nt+1]+je[Yt+1]);if(Qe>0===tt)for(let nt=0,Dt=je.length;nt<Dt/2;nt+=2){const Yt=je[nt],Qt=je[nt+1];je[nt]=je[Dt-2-nt],je[nt+1]=je[Dt-1-nt],je[Dt-2-nt]=Yt,je[Dt-1-nt]=Qt}}(Ke,Ae),it.push(Ke)}const Bh={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ws{constructor(re,ce){const Se=(ce=this.options=function(Ae,Ne){for(const Ke in Ne)Ae[Ke]=Ne[Ke];return Ae}(Object.create(Bh),ce)).debug;if(Se&&console.time("preprocess data"),ce.maxZoom<0||ce.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ce.promoteId&&ce.generateId)throw new Error("promoteId and generateId cannot be used together.");let Pe=function(Ae,Ne){const Ke=[];if("FeatureCollection"===Ae.type)for(let je=0;je<Ae.features.length;je++)Po(Ke,Ae.features[je],Ne,je);else Po(Ke,"Feature"===Ae.type?Ae:{geometry:Ae},Ne);return Ke}(re,ce);this.tiles={},this.tileCoords=[],Se&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ce.indexMaxZoom,ce.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Pe=function(Ae,Ne){const Ke=Ne.buffer/Ne.extent;let je=Ae;const tt=aa(Ae,1,-1-Ke,Ke,0,-1,2,Ne),Qe=aa(Ae,1,1-Ke,2+Ke,0,-1,2,Ne);return(tt||Qe)&&(je=aa(Ae,1,-Ke,1+Ke,0,-1,2,Ne)||[],tt&&(je=Bd(tt,1).concat(je)),Qe&&(je=je.concat(Bd(Qe,-1)))),je}(Pe,ce),Pe.length&&this.splitTile(Pe,0,0,0),Se&&(Pe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(re,ce,Se,Pe,Ae,Ne,Ke){const je=[re,ce,Se,Pe],tt=this.options,Qe=tt.debug;for(;je.length;){Pe=je.pop(),Se=je.pop(),ce=je.pop(),re=je.pop();const nt=1<<ce,Dt=Ra(ce,Se,Pe);let Yt=this.tiles[Dt];if(!Yt&&(Qe>1&&console.time("creation"),Yt=this.tiles[Dt]=Ir(re,ce,Se,Pe,tt),this.tileCoords.push({z:ce,x:Se,y:Pe}),Qe)){Qe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ce,Se,Pe,Yt.numFeatures,Yt.numPoints,Yt.numSimplified),console.timeEnd("creation"));const ji=`z${ce}`;this.stats[ji]=(this.stats[ji]||0)+1,this.total++}if(Yt.source=re,null==Ae){if(ce===tt.indexMaxZoom||Yt.numPoints<=tt.indexMaxPoints)continue}else{if(ce===tt.maxZoom||ce===Ae)continue;if(null!=Ae){const ji=Ae-ce;if(Se!==Ne>>ji||Pe!==Ke>>ji)continue}}if(Yt.source=null,0===re.length)continue;Qe>1&&console.time("clipping");const Qt=.5*tt.buffer/tt.extent,Et=.5-Qt,Ln=.5+Qt,pn=1+Qt;let Hn=null,Jn=null,li=null,si=null,an=aa(re,nt,Se-Qt,Se+Ln,0,Yt.minX,Yt.maxX,tt),Wi=aa(re,nt,Se+Et,Se+pn,0,Yt.minX,Yt.maxX,tt);re=null,an&&(Hn=aa(an,nt,Pe-Qt,Pe+Ln,1,Yt.minY,Yt.maxY,tt),Jn=aa(an,nt,Pe+Et,Pe+pn,1,Yt.minY,Yt.maxY,tt),an=null),Wi&&(li=aa(Wi,nt,Pe-Qt,Pe+Ln,1,Yt.minY,Yt.maxY,tt),si=aa(Wi,nt,Pe+Et,Pe+pn,1,Yt.minY,Yt.maxY,tt),Wi=null),Qe>1&&console.timeEnd("clipping"),je.push(Hn||[],ce+1,2*Se,2*Pe),je.push(Jn||[],ce+1,2*Se,2*Pe+1),je.push(li||[],ce+1,2*Se+1,2*Pe),je.push(si||[],ce+1,2*Se+1,2*Pe+1)}}getTile(re,ce,Se){re=+re,ce=+ce,Se=+Se;const Pe=this.options,{extent:Ae,debug:Ne}=Pe;if(re<0||re>24)return null;const Ke=1<<re,je=Ra(re,ce=ce+Ke&Ke-1,Se);if(this.tiles[je])return Ls(this.tiles[je],Ae);Ne>1&&console.log("drilling down to z%d-%d-%d",re,ce,Se);let tt,Qe=re,nt=ce,Dt=Se;for(;!tt&&Qe>0;)Qe--,nt>>=1,Dt>>=1,tt=this.tiles[Ra(Qe,nt,Dt)];return tt&&tt.source?(Ne>1&&(console.log("found parent tile z%d-%d-%d",Qe,nt,Dt),console.time("drilling down")),this.splitTile(tt.source,Qe,nt,Dt,re,ce,Se),Ne>1&&console.timeEnd("drilling down"),this.tiles[je]?Ls(this.tiles[je],Ae):null):null}}function Ra(it,re,ce){return 32*((1<<it)*ce+re)+it}function Vd(it,re){const ce=it.tileID.canonical;if(!this._geoJSONIndex)return void re(null,null);const Se=this._geoJSONIndex.getTile(ce.z,ce.x,ce.y);if(!Se)return void re(null,null);const Pe=new Ia(Se.features);let Ae=Oh(Pe);0===Ae.byteOffset&&Ae.byteLength===Ae.buffer.byteLength||(Ae=new Uint8Array(Ae)),re(null,{vectorTile:Pe,rawData:Ae.buffer})}class Vh extends Bi{constructor(re,ce,Se,Pe,Ae,Ne){super(re,ce,Se,Pe,Vd,Ne),Ae&&(this.loadGeoJSON=Ae),this._dynamicIndex=new pc}loadData(re,ce){const Se=re&&re.request,Pe=Se&&Se.collectResourceTiming;this.loadGeoJSON(re,(Ae,Ne)=>{if(Ae||!Ne)return ce(Ae);if("object"!=typeof Ne)return ce(new Error(`Input data given to '${re.source}' is not a valid GeoJSON object.`));{try{if(re.filter){const je=h.X(re.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===je.result)throw new Error(je.value.map(tt=>`${tt.key}: ${tt.message}`).join(", "));Ne.features=Ne.features.filter(tt=>je.value.evaluate({zoom:0},tt))}re.dynamic?("Feature"===Ne.type&&(Ne={type:"FeatureCollection",features:[Ne]}),re.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Ne.features,this.loaded),re.cluster&&(Ne.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=re.cluster?new $c(function({superclusterOptions:je,clusterProperties:tt}){if(!tt||!je)return je;const Qe={},nt={},Dt={accumulated:null,zoom:0},Yt={properties:null},Qt=Object.keys(tt);for(const Et of Qt){const[Ln,pn]=tt[Et],Hn=h.X(pn),Jn=h.X("string"==typeof Ln?[Ln,["accumulated"],["get",Et]]:Ln);Qe[Et]=Hn.value,nt[Et]=Jn.value}return je.map=Et=>{Yt.properties=Et;const Ln={};for(const pn of Qt)Ln[pn]=Qe[pn].evaluate(Dt,Yt);return Ln},je.reduce=(Et,Ln)=>{Yt.properties=Ln;for(const pn of Qt)Dt.accumulated=Et[pn],Et[pn]=nt[pn].evaluate(Dt,Yt)},je}(re)).load(Ne.features):re.dynamic?this._dynamicIndex:new ws(je=Ne,re.geojsonVtOptions)}catch(je){return ce(je)}const Ke={};if(Pe){const je=Jr(Se);je&&(Ke.resourceTiming={},Ke.resourceTiming[re.source]=JSON.parse(JSON.stringify(je)))}ce(null,Ke)}var je})}reloadTile(re,ce){const Se=this.loaded;return Se&&Se[re.uid]?re.partial?ce(null,void 0):super.reloadTile(re,ce):this.loadTile(re,ce)}loadGeoJSON(re,ce){if(re.request)h.n(re.request,ce);else{if("string"!=typeof re.data)return ce(new Error(`Input data given to '${re.source}' is not a valid GeoJSON object.`));try{return ce(null,JSON.parse(re.data))}catch{return ce(new Error(`Input data given to '${re.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(re,ce){try{ce(null,this._geoJSONIndex.getClusterExpansionZoom(re.clusterId))}catch(Se){ce(Se)}}getClusterChildren(re,ce){try{ce(null,this._geoJSONIndex.getChildren(re.clusterId))}catch(Se){ce(Se)}}getClusterLeaves(re,ce){try{ce(null,this._geoJSONIndex.getLeaves(re.clusterId,re.limit,re.offset))}catch(Se){ce(Se)}}}class Uh{constructor(re,ce){this.tileID=new h.aH(re.tileID.overscaledZ,re.tileID.wrap,re.tileID.canonical.z,re.tileID.canonical.x,re.tileID.canonical.y),this.tileZoom=re.tileZoom,this.uid=re.uid,this.zoom=re.zoom,this.canonical=re.tileID.canonical,this.pixelRatio=re.pixelRatio,this.tileSize=re.tileSize,this.source=re.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=re.projection,this.brightness=ce}parse(re,ce,Se,Pe){this.status="parsing";const Ae=new h.aH(Se.tileID.overscaledZ,Se.tileID.wrap,Se.tileID.canonical.z,Se.tileID.canonical.x,Se.tileID.canonical.y),Ne=[],Ke=ce.familiesBySource[Se.source],je=new h.e0(Ae,Se.promoteId);return je.bucketLayerIDs=[],je.is3DTile=!0,h.ei(re).then(tt=>{if(!tt)return Pe(new Error("Could not parse tile"));const Qe=h.ej(tt,1/h.cd(Se.tileID.canonical)),nt=tt.json.extensionsUsed&&tt.json.extensionsUsed.includes("MAPBOX_mesh_features")||tt.json.asset.extras&&tt.json.asset.extras.MAPBOX_mesh_features,Dt=tt.json.extensionsUsed&&tt.json.extensionsUsed.includes("EXT_meshopt_compression"),Yt=new h.aa(this.zoom,{brightness:this.brightness});for(const Qt in Ke)for(const Et of Ke[Qt]){const Ln=Et[0];je.bucketLayerIDs.push(Et.map(Hn=>h.C(Hn.id,Hn.scope))),Ln.recalculate(Yt,[]);const pn=new h.ek(Et,Qe,Ae,nt,Dt,this.brightness,je);nt||(pn.needsUpload=!0),Ne.push(pn),pn.evaluate(Ln)}this.status="done",Pe(null,{buckets:Ne,featureIndex:je,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(tt=>Pe(new Error(tt.message)))}}class fm{constructor(re,ce,Se,Pe,Ae,Ne){this.actor=re,this.layerIndex=ce,this.availableImages=Se,this.brightness=Ne,this.loading={},this.loaded={}}loadTile(re,ce){const Se=re.uid,Pe=this.loading[Se]=new Uh(re,this.brightness);h.bj(re.request,(Ae,Ne)=>{const Ke=!this.loading[Se];return delete this.loading[Se],Ke||Ae?(Pe.status="done",Ke||(this.loaded[Se]=Pe),ce(Ae)):Ne&&0!==Ne.byteLength?void Pe.parse(Ne,this.layerIndex,re,(je,tt)=>{Pe.status="done",this.loaded=this.loaded||{},this.loaded[Se]=Pe,je||!tt?ce(je):ce(null,tt)}):(Pe.status="done",this.loaded[Se]=Pe,ce())})}reloadTile(re,ce){const Se=this.loaded,Pe=re.uid;if(Se&&Se[Pe]){const Ae=Se[Pe];Ae.projection=re.projection,Ae.brightness=re.brightness;const Ne=(Ke,je)=>{Ae.reloadCallback&&(delete Ae.reloadCallback,this.loadTile(re,ce)),ce(Ke,je)};"parsing"===Ae.status?Ae.reloadCallback=Ne:"done"===Ae.status&&this.loadTile(re,ce)}}abortTile(re,ce){const Se=re.uid;this.loading[Se]&&delete this.loading[Se],ce()}removeTile(re,ce){const Se=this.loaded,Pe=re.uid;Se&&Se[Pe]&&delete Se[Pe],ce()}}class ku{constructor(re){this.self=re,this.actor=new h.el(re,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.imageRasterizer=new h.y,this.projections={},this.defaultProjection=h.bP({name:"mercator"}),this.workerSourceTypes={vector:Bi,geojson:Vh,"raster-dem":fi,"raster-array":jc,"batched-model":fm},this.workerSources={},this.self.registerWorkerSource=(ce,Se)=>{if(this.workerSourceTypes[ce])throw new Error(`Worker source with name "${ce}" already registered.`);this.workerSourceTypes[ce]=Se},this.self.registerRTLTextPlugin=ce=>{if(h.em.isParsed())throw new Error("RTL text plugin already registered.");h.em.applyArabicShaping=ce.applyArabicShaping,h.em.processBidirectionalText=ce.processBidirectionalText,h.em.processStyledBidirectionalText=ce.processStyledBidirectionalText}}clearCaches(re,ce,Se){delete this.layerIndexes[re],delete this.availableImages[re],delete this.workerSources[re],Se()}checkIfReady(re,ce,Se){Se()}setReferrer(re,ce){this.referrer=ce}spriteLoaded(re,{scope:ce,isLoaded:Se}){if(this.isSpriteLoaded[re]||(this.isSpriteLoaded[re]={}),this.isSpriteLoaded[re][ce]=Se,this.workerSources[re]&&this.workerSources[re][ce])for(const Pe in this.workerSources[re][ce]){const Ae=this.workerSources[re][ce][Pe];for(const Ne in Ae){const Ke=Ae[Ne];Ke instanceof Bi&&(Ke.isSpriteLoaded=Se,Ke.fire(new h.A("isSpriteLoaded")))}}}setImages(re,{scope:ce,images:Se},Pe){if(this.availableImages[re]||(this.availableImages[re]={}),this.availableImages[re][ce]=Se,this.workerSources[re]&&this.workerSources[re][ce]){for(const Ae in this.workerSources[re][ce]){const Ne=this.workerSources[re][ce][Ae];for(const Ke in Ne)Ne[Ke].availableImages=Se}Pe()}else Pe()}setProjection(re,ce){this.projections[re]=h.bP(ce)}setBrightness(re,ce,Se){this.brightness=ce,Se()}setLayers(re,ce,Se){this.getLayerIndex(re,ce.scope).replace(ce.layers,ce.options),Se()}updateLayers(re,ce,Se){this.getLayerIndex(re,ce.scope).update(ce.layers,ce.removedIds,ce.options),Se()}loadTile(re,ce,Se){ce.projection=this.projections[re]||this.defaultProjection,this.getWorkerSource(re,ce.type,ce.source,ce.scope).loadTile(ce,Se)}decodeRasterArray(re,ce,Se){this.getWorkerSource(re,ce.type,ce.source,ce.scope).decodeRasterArray(ce,Se)}reloadTile(re,ce,Se){ce.projection=this.projections[re]||this.defaultProjection,this.getWorkerSource(re,ce.type,ce.source,ce.scope).reloadTile(ce,Se)}abortTile(re,ce,Se){this.getWorkerSource(re,ce.type,ce.source,ce.scope).abortTile(ce,Se)}removeTile(re,ce,Se){this.getWorkerSource(re,ce.type,ce.source,ce.scope).removeTile(ce,Se)}removeSource(re,ce,Se){if(!(this.workerSources[re]&&this.workerSources[re][ce.scope]&&this.workerSources[re][ce.scope][ce.type]&&this.workerSources[re][ce.scope][ce.type][ce.source]))return;const Pe=this.workerSources[re][ce.scope][ce.type][ce.source];delete this.workerSources[re][ce.scope][ce.type][ce.source],void 0!==Pe.removeSource?Pe.removeSource(ce,Se):Se()}loadWorkerSource(re,ce,Se){try{this.self.importScripts(ce.url),Se()}catch(Pe){Se(Pe.toString())}}syncRTLPluginState(re,ce,Se){try{h.em.setState(ce);const Pe=h.em.getPluginURL();if(h.em.isLoaded()&&!h.em.isParsed()&&null!=Pe){this.self.importScripts(Pe);const Ae=h.em.isParsed();Se(Ae?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Pe}`),Ae)}}catch(Pe){Se(Pe.toString())}}setDracoUrl(re,ce){this.dracoUrl=ce}getAvailableImages(re,ce){this.availableImages[re]||(this.availableImages[re]={});let Se=this.availableImages[re][ce];return Se||(Se=[]),Se}getLayerIndex(re,ce){this.layerIndexes[re]||(this.layerIndexes[re]={});let Se=this.layerIndexes[re][ce];return Se||(Se=this.layerIndexes[re][ce]=new Gn,Se.scope=ce),Se}getWorkerSource(re,ce,Se,Pe){const Ae=this.workerSources;return Ae[re]||(Ae[re]={}),Ae[re][Pe]||(Ae[re][Pe]={}),Ae[re][Pe][ce]||(Ae[re][Pe][ce]={}),this.isSpriteLoaded[re]||(this.isSpriteLoaded[re]={}),Ae[re][Pe][ce][Se]||(Ae[re][Pe][ce][Se]=new this.workerSourceTypes[ce]({send:(Ne,Ke,je,tt,Qe,nt)=>{this.actor.send(Ne,Ke,je,re,Qe,nt)},scheduler:this.actor.scheduler},this.getLayerIndex(re,Pe),this.getAvailableImages(re,Pe),this.isSpriteLoaded[re][Pe],void 0,this.brightness)),Ae[re][Pe][ce][Se]}rasterizeImages(re,ce,Se){const Pe=new Map;for(const[Ae,{image:Ne,imageVariant:Ke}]of ce.tasks.entries()){const je=this.imageRasterizer.rasterize(Ke,Ne,ce.scope,re);Pe.set(Ae,je)}Se(void 0,Pe)}removeRasterizedImages(re,ce,Se){this.imageRasterizer.removeImagesFromCacheByIds(ce.imageIds,ce.scope,re),Se()}enforceCacheSizeLimit(re,ce){h.en(ce)}getWorkerPerformanceMetrics(re,ce,Se){Se(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new ku(self)),ku}),nl(0,function(h){var Jr="3.11.0";const Ro={create:"create",load:"load",fullLoad:"fullLoad"},Kn={mark(m){performance.mark(m)},measure(m,s,c){performance.measure(m,s,c)}};function Gn(m){const s=m.name.split("?")[0];return h.a(s)&&s.includes("mapbox-gl.js")?"javascript":h.a(s)&&s.includes("mapbox-gl.css")?"css":h.b(s)?"fontRange":h.c(s)?"sprite":h.i(s)?"style":h.d(s)?"tilejson":"other"}var To,nr={},jn=function(){if(To)return nr;function m(_){return!s(_)}function s(_){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var x,E,R=new Blob([""],{type:"text/javascript"}),F=URL.createObjectURL(R);try{E=new Worker(F),x=!0}catch{x=!1}return E&&E.terminate(),URL.revokeObjectURL(F),x}()?function(){var x=document.createElement("canvas");x.width=x.height=1;var E=x.getContext("2d");if(!E)return!1;var R=E.getImageData(0,0,1,1);return R&&R.width===x.width}()?(void 0===c[v=_&&_.failIfMajorPerformanceCaveat]&&(c[v]=function(x){var E,F,N,z,R=(F=x,N=document.createElement("canvas"),(z=Object.create(m.webGLContextAttributes)).failIfMajorPerformanceCaveat=F,N.getContext("webgl2",z));if(!R)return!1;try{E=R.createShader(R.VERTEX_SHADER)}catch{return!1}return!(!E||R.isContextLost())&&(R.shaderSource(E,"void main() {}"),R.compileShader(E),!0===R.getShaderParameter(E,R.COMPILE_STATUS))}(v)),c[v]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var v}To=1,nr.supported=m,nr.notSupportedReason=s;var c={};return m.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},nr}();function ri(m,s,c){const _=document.createElement(m);return null!=s&&(_.className=s),c&&c.appendChild(_),_}function Bi(m,s,c){const _=document.createElementNS("http://www.w3.org/2000/svg",m);for(const v of Object.keys(s))_.setAttributeNS(null,v,String(s[v]));return c&&c.appendChild(_),_}const fi=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Ta=fi&&void 0!==fi.userSelect?"userSelect":"WebkitUserSelect";let jc;function Li(){fi&&Ta&&(jc=fi[Ta],fi[Ta]="none")}function Ld(){fi&&Ta&&(fi[Ta]=jc)}function Ia(m){m.preventDefault(),m.stopPropagation(),window.removeEventListener("click",Ia,!0)}function Sn(){window.addEventListener("click",Ia,!0),window.setTimeout(()=>{window.removeEventListener("click",Ia,!0)},0)}function Aa(m,s){const c=m.getBoundingClientRect();return zn(m,c,s)}function pc(m,s){const c=m.getBoundingClientRect(),_=[];for(let v=0;v<s.length;v++)_.push(zn(m,c,s[v]));return _}function On(m){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&2===m.button&&m.ctrlKey?0:m.button}function zn(m,s,c){const _=m.offsetWidth===s.width?1:m.offsetWidth/s.width;return new h.P((c.clientX-s.left)*_,(c.clientY-s.top)*_)}const Nl="01",zl="NO_ACCESS_TOKEN";class Hc{constructor(s,c,_){this._transformRequestFn=s,this._customAccessToken=c,this._silenceAuthErrors=!!_,this._createSkuToken()}_createSkuToken(){const s=function(){let c="";for(let _=0;_<10;_++)c+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Nl,c].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=s.token,this._skuTokenExpiresAt=s.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(s,c){return this._transformRequestFn&&this._transformRequestFn(s,c)||{url:s}}normalizeStyleURL(s,c){if(!h.f(s))return s;const _=Ys(s);return _.params.push(`sdk=js-${Jr}`),_.path=`/styles/v1${_.path}`,this._makeAPIURL(_,this._customAccessToken||c)}normalizeGlyphsURL(s,c){if(!h.f(s))return s;const _=Ys(s);return _.path=`/fonts/v1${_.path}`,this._makeAPIURL(_,this._customAccessToken||c)}normalizeModelURL(s,c){if(!h.f(s))return s;const _=Ys(s);return _.path=`/models/v1${_.path}`,this._makeAPIURL(_,this._customAccessToken||c)}normalizeSourceURL(s,c,_,v){if(!h.f(s))return s;const x=Ys(s);return x.path=`/v4/${x.authority}.json`,x.params.push("secure"),_&&x.params.push(`language=${_}`),v&&x.params.push(`worldview=${v}`),this._makeAPIURL(x,this._customAccessToken||c)}normalizeIconsetURL(s,c){const _=Ys(s);return h.f(s)?(_.path=`/styles/v1${_.path}/iconset.pbf`,this._makeAPIURL(_,this._customAccessToken||c)):il(_)}normalizeSpriteURL(s,c,_,v){const x=Ys(s);return h.f(s)?(x.path=`/styles/v1${x.path}/sprite${c}${_}`,this._makeAPIURL(x,this._customAccessToken||v)):(x.path+=`${c}${_}`,il(x))}normalizeTileURL(s,c,_){if(this._isSkuTokenExpired()&&this._createSkuToken(),s&&!h.f(s))return s;const v=Ys(s);v.path=v.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${c||_&&"raster"!==v.authority&&512===_?"@2x":""}${h.m.supported?".webp":"$1"}`),"raster"===v.authority?v.path=`/${h.e.RASTER_URL_PREFIX}${v.path}`:"rasterarrays"===v.authority?v.path=`/${h.e.RASTERARRAYS_URL_PREFIX}${v.path}`:"3dtiles"===v.authority?v.path=`/${h.e.TILES3D_URL_PREFIX}${v.path}`:(v.path=v.path.replace(/^.+\/v4\//,"/"),v.path=`/${h.e.TILE_URL_VERSION}${v.path}`);const x=this._customAccessToken||function(E){for(const R of E){const F=R.match(/^access_token=(.*)$/);if(F)return F[1]}return null}(v.params)||h.e.ACCESS_TOKEN;return h.e.REQUIRE_ACCESS_TOKEN&&x&&this._skuToken&&v.params.push(`sku=${this._skuToken}`),this._makeAPIURL(v,x)}canonicalizeTileURL(s,c){const _=Ys(s);if(!_.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!_.path.match(/\.[\w]+$/))return s;let v="mapbox://";_.path.match(/^\/raster\/v1\//)?v+=`raster/${_.path.replace(`/${h.e.RASTER_URL_PREFIX}/`,"")}`:_.path.match(/^\/rasterarrays\/v1\//)?v+=`rasterarrays/${_.path.replace(`/${h.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:v+=`tiles/${_.path.replace(`/${h.e.TILE_URL_VERSION}/`,"")}`;let x=_.params;return c&&(x=x.filter(E=>!E.match(/^access_token=/))),x.length&&(v+=`?${x.join("&")}`),v}canonicalizeTileset(s,c){const _=!!c&&h.f(c),v=[];for(const x of s.tiles||[])h.h(x)?v.push(this.canonicalizeTileURL(x,_)):v.push(x);return v}_makeAPIURL(s,c){const _="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",v=Ys(h.e.API_URL);if(s.protocol=v.protocol,s.authority=v.authority,"http"===s.protocol){const x=s.params.indexOf("secure");x>=0&&s.params.splice(x,1)}if("/"!==v.path&&(s.path=`${v.path}${s.path}`),!h.e.REQUIRE_ACCESS_TOKEN)return il(s);if(c=c||h.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!c)throw new Error(`An API access token is required to use Mapbox GL. ${_}`);if("s"===c[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${_}`)}return s.params=s.params.filter(x=>-1===x.indexOf("access_token")),s.params.push(`access_token=${c||""}`),il(s)}}const oi=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ys(m){const s=m.match(oi);if(!s)throw new Error("Unable to parse URL object");return{protocol:s[1],authority:s[2],path:s[3]||"/",params:s[4]?s[4].split("&"):[]}}function il(m){const s=m.params.length?`?${m.params.join("&")}`:"";return`${m.protocol}://${m.authority}${m.path}${s}`}const rl="mapbox.eventData";function qn(m){if(!m)return null;const s=m.split(".");if(!s||3!==s.length)return null;try{return JSON.parse(h.j(s[1]))}catch{return null}}class Yo{constructor(s){this.type=s,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(s){const c=qn(h.e.ACCESS_TOKEN);let _="";return _=c&&c.u?h.k(c.u):h.e.ACCESS_TOKEN||"",s?`${rl}.${s}:${_}`:`${rl}:${_}`}fetchEventData(){const s=h.s("localStorage"),c=this.getStorageKey(),_=this.getStorageKey("uuid");if(s)try{const v=localStorage.getItem(c);v&&(this.eventData=JSON.parse(v));const x=localStorage.getItem(_);x&&(this.anonId=x)}catch{h.w("Unable to read from LocalStorage")}}saveEventData(){const s=h.s("localStorage"),c=this.getStorageKey(),_=this.getStorageKey("uuid"),v=this.anonId;if(s&&v)try{localStorage.setItem(_,v),Object.keys(this.eventData).length>=1&&localStorage.setItem(c,JSON.stringify(this.eventData))}catch{h.w("Unable to write to LocalStorage")}}processRequests(s){}postEvent(s,c,_,v){if(!h.e.EVENTS_URL)return;const x=Ys(h.e.EVENTS_URL);x.params.push(`access_token=${v||h.e.ACCESS_TOKEN||""}`);const E={event:this.type,created:new Date(s).toISOString()},R=c?h.l(E,c):E,F={url:il(x),headers:{"Content-Type":"text/plain"},body:JSON.stringify([R])};this.pendingRequest=h.p(F,N=>{this.pendingRequest=null,_(N),this.saveEventData(),this.processRequests(v)})}queueRequest(s,c){this.queue.push(s),this.processRequests(c)}}const Gp=new class extends Yo{constructor(m){super("appUserTurnstile"),this._customAccessToken=m}postTurnstileEvent(m,s){h.e.EVENTS_URL&&h.e.ACCESS_TOKEN&&Array.isArray(m)&&m.some(c=>h.f(c)||h.h(c))&&this.queueRequest(Date.now(),s)}processRequests(m){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const s=qn(h.e.ACCESS_TOKEN),c=s?s.u:h.e.ACCESS_TOKEN;let _=c!==this.eventData.tokenU;h.v(this.anonId)||(this.anonId=h.u(),_=!0);const v=this.queue.shift();if(this.eventData.lastSuccess){const x=new Date(this.eventData.lastSuccess),E=new Date(v),R=(v-this.eventData.lastSuccess)/864e5;_=_||R>=1||R<-1||x.getDate()!==E.getDate()}else _=!0;_?this.postEvent(v,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Jr,skuId:Nl,"enabled.telemetry":!1,userId:this.anonId},x=>{x||(this.eventData.lastSuccess=v,this.eventData.tokenU=c)},m):this.processRequests()}},Oh=Gp.postTurnstileEvent.bind(Gp),$n=new class extends Yo{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(m,s,c,_){this.skuToken=s,this.errorCb=_,h.e.EVENTS_URL&&(c||h.e.ACCESS_TOKEN?this.queueRequest({id:m,timestamp:Date.now()},c):this.errorCb(new Error(zl)))}processRequests(m){if(this.pendingRequest||0===this.queue.length)return;const{id:s,timestamp:c}=this.queue.shift();s&&this.success[s]||(this.anonId||this.fetchEventData(),h.v(this.anonId)||(this.anonId=h.u()),this.postEvent(c,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Jr,skuId:Nl,skuToken:this.skuToken,userId:this.anonId},_=>{_?this.errorCb(_):s&&(this.success[s]=!0)},m))}remove(){this.errorCb=null}},qp=$n.postMapLoadEvent.bind($n),Fh=new class extends Yo{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(m){let s=this.mapInstanceIdMap.get(m);return s||(s=h.u(),this.mapInstanceIdMap.set(m,s)),s}getEventId(m){const s=this.eventIdPerMapInstanceMap.get(m)||0;return this.eventIdPerMapInstanceMap.set(m,s+1),s}postStyleLoadEvent(m,s){const{map:c,style:_,importedStyles:v}=s;if(!h.e.EVENTS_URL||!m&&!h.e.ACCESS_TOKEN)return;const x=this.getMapInstanceId(c),E={mapInstanceId:x,eventId:this.getEventId(x),style:_};v.length&&(E.importedStyles=v),this.queueRequest({timestamp:Date.now(),payload:E},m)}processRequests(m){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:s,payload:c}=this.queue.shift();this.postEvent(s,c,()=>{},m)}},Zs=Fh.postStyleLoadEvent.bind(Fh),ol=new class extends Yo{constructor(){super("gljs.performance")}postPerformanceEvent(m,s){h.e.EVENTS_URL&&(m||h.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:s},m)}processRequests(m){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:s,performanceData:c}=this.queue.shift(),_=function(v){const x=performance.getEntriesByType("resource"),E=performance.getEntriesByType("mark"),R=function(W){const ne={};if(W)for(const J in W)if("other"!==J)for(const oe of W[J]){const se=`${J}ResolveRangeMin`,fe=`${J}ResolveRangeMax`,be=`${J}RequestCount`,ve=`${J}RequestCachedCount`;ne[se]=Math.min(ne[se]||1/0,oe.startTime),ne[fe]=Math.max(ne[fe]||-1/0,oe.responseEnd);const we=Ee=>{void 0===ne[Ee]&&(ne[Ee]=0),++ne[Ee]};void 0!==oe.transferSize&&0===oe.transferSize&&we(ve),we(be)}return ne}(function(W,ne){const J={};if(W)for(const oe of W){const se=ne(oe);void 0===J[se]&&(J[se]=[]),J[se].push(oe)}return J}(x,Gn)),F=window.devicePixelRatio,N=navigator.connection||navigator.mozConnection||navigator.webkitConnection,z=N?N.effectiveType:void 0,U={counters:[],metadata:[],attributes:[]},j=(W,ne,J)=>{null!=J&&W.push({name:ne,value:J.toString()})};for(const W in R)j(U.counters,W,R[W]);if(v.interactionRange[0]!==1/0&&v.interactionRange[1]!==-1/0&&(j(U.counters,"interactionRangeMin",v.interactionRange[0]),j(U.counters,"interactionRangeMax",v.interactionRange[1])),E)for(const W of Object.keys(Ro)){const ne=Ro[W],J=E.find(oe=>oe.name===ne);J&&j(U.counters,ne,J.startTime)}return j(U.counters,"visibilityHidden",v.visibilityHidden),j(U.attributes,"style",function(W){if(W)for(const ne of W){const J=ne.name.split("?")[0];if(h.i(J)){const oe=J.split("/").slice(-2);if(2===oe.length)return`mapbox://styles/${oe[0]}/${oe[1]}`}}}(x)),j(U.attributes,"terrainEnabled",v.terrainEnabled?"true":"false"),j(U.attributes,"fogEnabled",v.fogEnabled?"true":"false"),j(U.attributes,"projection",v.projection),j(U.attributes,"zoom",v.zoom),j(U.metadata,"devicePixelRatio",F),j(U.metadata,"connectionEffectiveType",z),j(U.metadata,"navigatorUserAgent",navigator.userAgent),j(U.metadata,"screenWidth",window.screen.width),j(U.metadata,"screenHeight",window.screen.height),j(U.metadata,"windowWidth",window.innerWidth),j(U.metadata,"windowHeight",window.innerHeight),j(U.metadata,"mapWidth",v.width/F),j(U.metadata,"mapHeight",v.height/F),j(U.metadata,"webglRenderer",v.renderer),j(U.metadata,"webglVendor",v.vendor),j(U.metadata,"sdkVersion",Jr),j(U.metadata,"sdkIdentifier","mapbox-gl-js"),U}(c);for(const v of _.metadata);for(const v of _.counters);for(const v of _.attributes);this.postEvent(s,_,()=>{},m)}},Wp=ol.postPerformanceEvent.bind(ol),$c=new class extends Yo{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(m,s,c,_){if(!h.e.API_URL||!h.e.SESSION_PATH)return;const v=Ys(h.e.API_URL+h.e.SESSION_PATH);v.params.push(`sku=${s||""}`),v.params.push(`access_token=${_||h.e.ACCESS_TOKEN||""}`);const x={url:il(v),headers:{"Content-Type":"text/plain"}};this.pendingRequest=h.g(x,E=>{this.pendingRequest=null,c(E),this.saveEventData(),this.processRequests(_)})}getSessionAPI(m,s,c,_){this.skuToken=s,this.errorCb=_,h.e.SESSION_PATH&&h.e.API_URL&&(c||h.e.ACCESS_TOKEN?this.queueRequest({id:m,timestamp:Date.now()},c):this.errorCb(new Error(zl)))}processRequests(m){if(this.pendingRequest||0===this.queue.length)return;const{id:s,timestamp:c}=this.queue.shift();s&&this.success[s]||this.getSession(c,this.skuToken,_=>{_?this.errorCb(_):s&&(this.success[s]=!0)},m)}remove(){this.errorCb=null}},ge=$c.getSessionAPI.bind($c),Lh=new Set;function fc(m,s){s?Lh.add(m):Lh.delete(m)}class Nd{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(s,c){this._updatedSourceCaches[s]=c,this.setDirty()}discardSourceCacheUpdate(s){delete this._updatedSourceCaches[s]}updateLayer(s){const c=s.scope;this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._updatedLayers[c].add(s.id),this.setDirty()}removeLayer(s){const c=s.scope;this._removedLayers[c]=this._removedLayers[c]||{},this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._removedLayers[c][s.id]=s,this._updatedLayers[c].delete(s.id),this._updatedPaintProps.delete(s.fqid),this.setDirty()}getRemovedLayer(s){return this._removedLayers[s.scope]?this._removedLayers[s.scope][s.id]:null}discardLayerRemoval(s){this._removedLayers[s.scope]&&delete this._removedLayers[s.scope][s.id]}getLayerUpdatesByScope(){const s={};for(const c in this._updatedLayers)s[c]=s[c]||{},s[c].updatedIds=Array.from(this._updatedLayers[c].values());for(const c in this._removedLayers)s[c]=s[c]||{},s[c].removedIds=Object.keys(this._removedLayers[c]);return s}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(s){this._updatedPaintProps.add(s.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(s){this._updatedImages.add(h.I.toString(s)),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}function Ot(m){const{userImage:s}=m;return!!(s&&s.render&&s.render())&&(m.data.replace(new Uint8Array(s.data.buffer)),!0)}class Bl extends h.E{constructor(s){super(),this._images={},this._iconsets={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.patternsInFlight=new Set,this.atlasImage={},this.atlasTexture={},this.dirty=!0,this.spriteFormat=s,"raster"!==s&&h.t()&&(this.imageRasterizerDispatcher=new h.D(h.x(),this,"Image Rasterizer Worker",1))}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new h.y),this._imageRasterizer}createScope(s){this._images[s]={},this._iconsets[s]={},this.loaded[s]=!1,this.updatedImages[s]=new Set,this.patterns[s]={},this.callbackDispatchedThisFrame[s]=new Set,this.atlasImage[s]=new h.r({width:1,height:1})}createIconset(s,c){this._iconsets[s][c]={}}isLoaded(){for(const s in this.loaded)if(!this.loaded[s])return!1;return!0}setLoaded(s,c){if(this.loaded[c]!==s&&(this.loaded[c]=s,s)){for(const{ids:_,callback:v}of this.requestors)this._notify(_,c,v);this.requestors=[]}}hasImage(s,c){return!!this.getImage(s,c)}getImage(s,c){return(s.iconsetId?this._iconsets[c][s.iconsetId]:this._images[c])[s.name]}addImage(s,c,_){const v=s.iconsetId?this._iconsets[c][s.iconsetId]:this._images[c];this._validate(s,_)&&(v[s.name]=_)}_validate(s,c){let _=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new h.z(new Error(`Image "${s.name}" has invalid "stretchX" value`))),_=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new h.z(new Error(`Image "${s.name}" has invalid "stretchY" value`))),_=!1),this._validateContent(c.content,c)||(this.fire(new h.z(new Error(`Image "${s.name}" has invalid "content" value`))),_=!1),_}_validateStretch(s,c){if(!s)return!0;let _=0;for(const v of s){if(v[0]<_||v[1]<v[0]||c<v[1])return!1;_=v[1]}return!0}_validateContent(s,c){return!s||!(4!==s.length||!c.usvg&&(s[0]<0||c.data.width<s[0]||s[1]<0||c.data.height<s[1]||s[2]<0||c.data.width<s[2]||s[3]<0||c.data.height<s[3]))&&!(s[2]<s[0]||s[3]<s[1])}updateImage(s,c,_){const v=s.iconsetId?this._iconsets[c][s.iconsetId]:this._images[c];_.version=v[s.name].version+1,v[s.name]=_,this.updatedImages[c].add(s),this.removeFromImageRasterizerCache(s,c)}clearUpdatedImages(s){this.updatedImages[s].clear()}removeFromImageRasterizerCache(s,c){if("raster"!==this.spriteFormat)if(h.t()){const _={imageIds:[s],scope:c};this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",_)}else this.imageRasterizer.removeImagesFromCacheByIds([s],c)}removeImage(s,c){const _=s.iconsetId?this._iconsets[c][s.iconsetId]:this._images[c],v=_[s.name];delete _[s.name],delete this.patterns[c][s.name],this.removeFromImageRasterizerCache(s,c),v.userImage&&v.userImage.onRemove&&v.userImage.onRemove()}listImages(s){const c=[];for(const _ of Object.keys(this._images[s]))c.push(new h.I(_));for(const _ in this._iconsets[s])for(const v of Object.keys(this._iconsets[s][_]))c.push(new h.I({name:v,iconsetId:_}));return c}getImages(s,c,_){let v=!0;const x=!!this.loaded[c];if(!x)for(const E of s)(E.iconsetId?this._iconsets[c][E.iconsetId]:this._images[c])[E.name]||(v=!1);x||v?this._notify(s,c,_):this.requestors.push({ids:s,scope:c,callback:_})}rasterizeImages({scope:s,tasks:c},_){const v=new Map;for(const[x,E]of c.entries()){const R=this.getImage(E.id,s);R&&v.set(x,{image:R,imageVariant:E})}this._rasterizeImages(s,v,_)}_rasterizeImages(s,c,_){if(h.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImages",{tasks:c,scope:s},_);else{const v=new Map;for(const[x,{image:E,imageVariant:R}]of c.entries())v.set(x,this.imageRasterizer.rasterize(R,E,s,0));_(void 0,v)}}getUpdatedImages(s){return this.updatedImages[s]||new Set}_notify(s,c,_){const v=new Map;for(const x of s){x.iconsetId&&(this._iconsets[c][x.iconsetId]=this._iconsets[c][x.iconsetId]||{});const E=(x.iconsetId?this._iconsets[c][x.iconsetId]:this._images[c])[x.name];if(!E){if(x.iconsetId)continue;h.w(`Image "${x.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`),this.fire(new h.A("styleimagemissing",{id:x.name}));continue}const R={data:E.usvg?null:E.data.clone(),pixelRatio:E.pixelRatio,sdf:E.sdf,usvg:E.usvg,version:E.version,stretchX:E.stretchX,stretchY:E.stretchY,content:E.content,hasRenderCallback:!(!E.userImage||!E.userImage.render)};E.usvg&&Object.assign(R,{width:E.icon.usvg_tree.width,height:E.icon.usvg_tree.height}),v.set(h.I.toString(x),R)}_(null,v)}getPixelSize(s){const{width:c,height:_}=this.atlasImage[s];return{width:c,height:_}}getPattern(s,c,_){const v=this.patterns[c][s.name],x=this.getImage(s,c);if(!x)return null;if(v){if(v.position.version===x.version)return v.position;v.position.version=x.version}else{if(x.usvg&&!x.data){const E=this.getPatternInFlightId(s.toString(),c);if(this.patternsInFlight.has(E))return null;this.patternsInFlight.add(E);const R=new h.B(s).scaleSelf(h.q.devicePixelRatio),F=new Map([[R.toString(),{image:x,imageVariant:R}]]);return this._rasterizeImages(c,F,(N,z)=>this.storePatternImage(R,c,x,_,z)),null}this.storePattern(s,c,x)}return this._updatePatternAtlas(c,_),this.patterns[c][s.name].position}getPatternInFlightId(s,c){return h.C(s,c)}hasPatternsInFlight(){return 0!==this.patternsInFlight.size}storePatternImage(s,c,_,v,x){const E=s.toString(),R=x?x.get(E):void 0;R&&(_.data=R,this.storePattern(s.id,c,_),this._updatePatternAtlas(c,v),this.patternsInFlight.delete(this.getPatternInFlightId(s.id.toString(),c)))}storePattern(s,c,_){const v={w:_.data.width+2*h.F,h:_.data.height+2*h.F,x:0,y:0},x=new h.G(v,_,h.F);this.patterns[c][s.name]={bin:v,position:x}}bind(s,c){const _=s.gl;let v=this.atlasTexture[c];v?this.dirty&&(v.update(this.atlasImage[c]),this.dirty=!1):(v=new h.T(s,this.atlasImage[c],_.RGBA8),this.atlasTexture[c]=v),v.bind(_.LINEAR,_.CLAMP_TO_EDGE)}_updatePatternAtlas(s,c){const _=[];for(const R in this.patterns[s])_.push(this.patterns[s][R].bin);const{w:v,h:x}=h.H(_),E=this.atlasImage[s];E.resize({width:v||1,height:x||1});for(const R in this.patterns[s]){const{bin:F,position:N}=this.patterns[s][R];let z=N.padding;const U=F.x+z,j=F.y+z,W=this._images[s][R].data,ne=W.width,J=W.height;z=z>1?z-1:z,h.r.copy(W,E,{x:0,y:0},{x:U,y:j},{width:ne,height:J},c),h.r.copy(W,E,{x:0,y:J-z},{x:U,y:j-z},{width:ne,height:z},c),h.r.copy(W,E,{x:0,y:0},{x:U,y:j+J},{width:ne,height:z},c),h.r.copy(W,E,{x:ne-z,y:0},{x:U-z,y:j},{width:z,height:J},c),h.r.copy(W,E,{x:0,y:0},{x:U+ne,y:j},{width:z,height:J},c),h.r.copy(W,E,{x:ne-z,y:J-z},{x:U-z,y:j-z},{width:z,height:z},c),h.r.copy(W,E,{x:0,y:J-z},{x:U+ne,y:j-z},{width:z,height:z},c),h.r.copy(W,E,{x:0,y:0},{x:U+ne,y:j+J},{width:z,height:z},c),h.r.copy(W,E,{x:ne-z,y:0},{x:U-z,y:j+J},{width:z,height:z},c)}this.dirty=!0}beginFrame(){for(const s in this._images)this.callbackDispatchedThisFrame[s]=new Set}dispatchRenderCallbacks(s,c){for(const _ of s){if(this.callbackDispatchedThisFrame[c].has(_.toString()))continue;this.callbackDispatchedThisFrame[c].add(_.toString());const v=(_.iconsetId?this._iconsets[c][_.iconsetId]:this._images[c])[_.name];Ot(v)&&this.updateImage(_,c,v)}}}function Xs(m){const s=m.key,c=m.value,_=m.valueSpec||{},v=m.objectElementValidators||{},x=m.style,E=m.styleSpec;let R=[];const F=h.K(c);if("object"!==F)return[new h.V(s,c,`object expected, ${F} found`)];for(const N in c){const z=N.split(".")[0];let U;v[z]?U=v[z]:_[z]?U=ir:v["*"]?U=v["*"]:_["*"]&&(U=ir),U?R=R.concat(U({key:(s&&`${s}.`)+N,value:c[N],valueSpec:_[z]||_["*"],style:x,styleSpec:E,object:c,objectKey:N},c)):R.push(new h.J(s,c[N],`unknown property "${N}"`))}for(const N in _)v[N]||_[N].required&&void 0===_[N].default&&void 0===c[N]&&R.push(new h.V(s,c,`missing required property "${N}"`));return R}function mc(m){const s=m.value,c=m.valueSpec,_=m.style,v=m.styleSpec,x=m.key,E=m.arrayElementValidator||ir;if("array"!==h.K(s))return[new h.V(x,s,`array expected, ${h.K(s)} found`)];if(c.length&&s.length!==c.length)return[new h.V(x,s,`array length ${c.length} expected, length ${s.length} found`)];if(c["min-length"]&&s.length<c["min-length"])return[new h.V(x,s,`array length at least ${c["min-length"]} expected, length ${s.length} found`)];let R={type:c.value,values:c.values,minimum:c.minimum,maximum:c.maximum,function:void 0};v.$version<7&&(R.function=c.function),"object"===h.K(c.value)&&(R=c.value);let F=[];for(let N=0;N<s.length;N++)F=F.concat(E({array:s,arrayIndex:N,value:s[N],valueSpec:R,style:_,styleSpec:v,key:`${x}[${N}]`},!0));return F}function yi(m){const s=m.key,c=m.value,_=m.valueSpec;let v=h.K(c);if("number"===v&&c!=c&&(v="NaN"),"number"!==v)return[new h.V(s,c,`number expected, ${v} found`)];if("minimum"in _){let x=_.minimum;if("array"===h.K(_.minimum)&&(x=_.minimum[m.arrayIndex]),c<x)return[new h.V(s,c,`${c} is less than the minimum value ${x}`)]}if("maximum"in _){let x=_.maximum;if("array"===h.K(_.maximum)&&(x=_.maximum[m.arrayIndex]),c>x)return[new h.V(s,c,`${c} is greater than the maximum value ${x}`)]}return[]}function Po(m){const s=m.valueSpec,c=h.M(m.value.type);let _,v,x,E={};const R="categorical"!==c&&void 0===m.value.property,F=!R,N="array"===h.K(m.value.stops)&&"array"===h.K(m.value.stops[0])&&"object"===h.K(m.value.stops[0][0]),z=Xs({key:m.key,value:m.value,valueSpec:m.styleSpec.function,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{stops:function(W){if("identity"===c)return[new h.V(W.key,W.value,'identity function may not have a "stops" property')];let ne=[];const J=W.value;return ne=ne.concat(mc({key:W.key,value:J,valueSpec:W.valueSpec,style:W.style,styleSpec:W.styleSpec,arrayElementValidator:U})),"array"===h.K(J)&&0===J.length&&ne.push(new h.V(W.key,J,"array must have at least one stop")),ne},default:function(W){return ir({key:W.key,value:W.value,valueSpec:s,style:W.style,styleSpec:W.styleSpec})}}});return"identity"===c&&R&&z.push(new h.V(m.key,m.value,'missing required property "property"')),"identity"===c||m.value.stops||z.push(new h.V(m.key,m.value,'missing required property "stops"')),"exponential"===c&&m.valueSpec.expression&&!h.N(m.valueSpec)&&z.push(new h.V(m.key,m.value,"exponential functions not supported")),m.styleSpec.$version>=8&&(F&&!h.O(m.valueSpec)?z.push(new h.V(m.key,m.value,"property functions not supported")):R&&!h.Q(m.valueSpec)&&z.push(new h.V(m.key,m.value,"zoom functions not supported"))),"categorical"!==c&&!N||void 0!==m.value.property||z.push(new h.V(m.key,m.value,'"property" property is required')),z;function U(W){let ne=[];const J=W.value,oe=W.key;if("array"!==h.K(J))return[new h.V(oe,J,`array expected, ${h.K(J)} found`)];if(2!==J.length)return[new h.V(oe,J,`array length 2 expected, length ${J.length} found`)];if(N){if("object"!==h.K(J[0]))return[new h.V(oe,J,`object expected, ${h.K(J[0])} found`)];if(void 0===J[0].zoom)return[new h.V(oe,J,"object stop key must have zoom")];if(void 0===J[0].value)return[new h.V(oe,J,"object stop key must have value")];const se=h.M(J[0].zoom);if("number"!=typeof se)return[new h.V(oe,J[0].zoom,"stop zoom values must be numbers")];if(x&&x>se)return[new h.V(oe,J[0].zoom,"stop zoom values must appear in ascending order")];se!==x&&(x=se,v=void 0,E={}),ne=ne.concat(Xs({key:`${oe}[0]`,value:J[0],valueSpec:{zoom:{}},style:W.style,styleSpec:W.styleSpec,objectElementValidators:{zoom:yi,value:j}}))}else ne=ne.concat(j({key:`${oe}[0]`,value:J[0],valueSpec:{},style:W.style,styleSpec:W.styleSpec},J));return h.S(h.U(J[1]))?ne.concat([new h.V(`${oe}[1]`,J[1],"expressions are not allowed in function stops.")]):ne.concat(ir({key:`${oe}[1]`,value:J[1],valueSpec:s,style:W.style,styleSpec:W.styleSpec}))}function j(W,ne){const J=h.K(W.value),oe=h.M(W.value),se=null!==W.value?W.value:ne;if(_){if(J!==_)return[new h.V(W.key,se,`${J} stop domain type must match previous stop domain type ${_}`)]}else _=J;if("number"!==J&&"string"!==J&&"boolean"!==J&&"number"!=typeof oe&&"string"!=typeof oe&&"boolean"!=typeof oe)return[new h.V(W.key,se,"stop domain value must be a number, string, or boolean")];if("number"!==J&&"categorical"!==c){let fe=`number expected, ${J} found`;return h.O(s)&&void 0===c&&(fe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new h.V(W.key,se,fe)]}return"categorical"!==c||"number"!==J||"number"==typeof oe&&isFinite(oe)&&Math.floor(oe)===oe?"categorical"!==c&&"number"===J&&"number"==typeof oe&&"number"==typeof v&&void 0!==v&&oe<v?[new h.V(W.key,se,"stop domain values must appear in ascending order")]:(v=oe,"categorical"===c&&oe in E?[new h.V(W.key,se,"stop domain values must be unique")]:(E[oe]=!0,[])):[new h.V(W.key,se,`integer expected, found ${String(oe)}`)]}}function sl(m){const s=("property"===m.expressionContext?h.W:h.X)(h.U(m.value),m.valueSpec);if("error"===s.result)return s.value.map(_=>new h.V(`${m.key}${_.key}`,m.value,_.message));const c=s.value.expression||s.value._styleExpression.expression;if("property"===m.expressionContext&&"text-font"===m.propertyKey&&!c.outputDefined())return[new h.V(m.key,m.value,`Invalid data expression for "${m.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===m.expressionContext&&"layout"===m.propertyType&&!h.Y(c))return[new h.V(m.key,m.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===m.expressionContext)return gc(c,m);if(m.expressionContext&&0===m.expressionContext.indexOf("cluster")){if(!h.Z(c,["zoom","feature-state"]))return[new h.V(m.key,m.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===m.expressionContext&&!h._(c))return[new h.V(m.key,m.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function gc(m,s){const c=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(s.valueSpec&&s.valueSpec.expression)for(const v of s.valueSpec.expression.parameters)c.delete(v);if(0===c.size)return[];const _=[];return m instanceof h.$&&c.has(m.name)?[new h.V(s.key,s.value,`["${m.name}"] expression is not supported in a filter for a ${s.object.type} layer with id: ${s.object.id}`)]:(m.eachChild(v=>{_.push(...gc(v,s))}),_)}function Fs(m){const s=m.key,c=m.value,_=m.valueSpec,v=[];return Array.isArray(_.values)?-1===_.values.indexOf(h.M(c))&&v.push(new h.V(s,c,`expected one of [${_.values.join(", ")}], ${JSON.stringify(c)} found`)):-1===Object.keys(_.values).indexOf(h.M(c))&&v.push(new h.V(s,c,`expected one of [${Object.keys(_.values).join(", ")}], ${JSON.stringify(c)} found`)),v}function zd(m){return h.a1(h.U(m.value))?sl(h.L({},m,{expressionContext:"filter",valueSpec:m.styleSpec[`filter_${m.layerType||"fill"}`]})):Qn(m)}function Qn(m){const s=m.value,c=m.key;if("array"!==h.K(s))return[new h.V(c,s,`array expected, ${h.K(s)} found`)];const _=m.styleSpec;let v,x=[];if(s.length<1)return[new h.V(c,s,"filter array must have at least 1 element")];switch(x=x.concat(Fs({key:`${c}[0]`,value:s[0],valueSpec:_.filter_operator,style:m.style,styleSpec:m.styleSpec})),h.M(s[0])){case"<":case"<=":case">":case">=":s.length>=2&&"$type"===h.M(s[1])&&x.push(new h.V(c,s,`"$type" cannot be use with operator "${s[0]}"`));case"==":case"!=":3!==s.length&&x.push(new h.V(c,s,`filter array for operator "${s[0]}" must have 3 elements`));case"in":case"!in":s.length>=2&&(v=h.K(s[1]),"string"!==v&&x.push(new h.V(`${c}[1]`,s[1],`string expected, ${v} found`)));for(let E=2;E<s.length;E++)v=h.K(s[E]),"$type"===h.M(s[1])?x=x.concat(Fs({key:`${c}[${E}]`,value:s[E],valueSpec:_.geometry_type,style:m.style,styleSpec:m.styleSpec})):"string"!==v&&"number"!==v&&"boolean"!==v&&x.push(new h.V(`${c}[${E}]`,s[E],`string, number, or boolean expected, ${v} found`));break;case"any":case"all":case"none":for(let E=1;E<s.length;E++)x=x.concat(Qn({key:`${c}[${E}]`,value:s[E],style:m.style,styleSpec:m.styleSpec}));break;case"has":case"!has":v=h.K(s[1]),2!==s.length?x.push(new h.V(c,s,`filter array for "${s[0]}" operator must have 2 elements`)):"string"!==v&&x.push(new h.V(`${c}[1]`,s[1],`string expected, ${v} found`))}return x}function aa(m,s){const c=m.key,_=m.style,v=m.layer,x=m.styleSpec,E=m.value,R=m.objectKey,F=x[`${s}_${m.layerType}`];if(!F)return[];const N=R.match(/^(.*)-use-theme$/);if("paint"===s&&N&&F[N[1]])return h.S(E)?[].concat(ir({key:m.key,value:E,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:_,styleSpec:x,expressionContext:"property",propertyType:s,propertyKey:R})):ir({key:c,value:E,valueSpec:{type:"string"},style:_,styleSpec:x});const z=R.match(/^(.*)-transition$/);if("paint"===s&&z&&F[z[1]]&&F[z[1]].transition)return ir({key:c,value:E,valueSpec:x.transition,style:_,styleSpec:x});const U=m.valueSpec||F[R];if(!U)return[new h.J(c,E,`unknown property "${R}"`)];let j;if("string"===h.K(E)&&h.O(U)&&!U.tokens&&(j=/^{([^}]+)}$/.exec(E))){const ne=`\`{ "type": "identity", "property": ${j?JSON.stringify(j[1]):'"_"'} }\``;return[new h.V(c,E,`"${R}" does not support interpolation syntax\nUse an identity property function instead: ${ne}.`)]}const W=[];if("symbol"===m.layerType)"text-field"!==R||!_||_.glyphs||_.imports||W.push(new h.V(c,E,'use of "text-field" requires a style "glyphs" property')),"text-font"===R&&h.a2(h.U(E))&&"identity"===h.M(E.type)&&W.push(new h.V(c,E,'"text-font" does not support identity functions'));else if("model"===m.layerType&&"paint"===s&&v&&v.layout&&v.layout.hasOwnProperty("model-id")&&h.O(U)&&(h.a3(U)||h.Q(U))){const ne=h.W(h.U(E),U),J=ne.value.expression||ne.value._styleExpression.expression;J&&!h.Z(J,["measure-light"])&&("model-emissive-strength"===R&&h._(J)&&h.Y(J)||W.push(new h.V(c,E,`${R} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return W.concat(ir({key:m.key,value:E,valueSpec:U,style:_,styleSpec:x,expressionContext:"property",propertyType:s,propertyKey:R}))}function Dr(m){return aa(m,"paint")}function Gc(m){return aa(m,"layout")}function ls(m){let s=[];const c=m.value,_=m.key,v=m.style,x=m.styleSpec;c.type||c.ref||s.push(new h.V(_,c,'either "type" or "ref" is required'));let E=h.M(c.type);const R=h.M(c.ref);if(c.id){const F=h.M(c.id);for(let N=0;N<m.arrayIndex;N++){const z=v.layers[N];h.M(z.id)===F&&s.push(new h.V(_,c.id,`duplicate layer id "${c.id}", previously used at line ${z.id.__line__}`))}}if("ref"in c){let F;["type","source","source-layer","filter","layout"].forEach(N=>{N in c&&s.push(new h.V(_,c[N],`"${N}" is prohibited for ref layers`))}),v.layers.forEach(N=>{h.M(N.id)===R&&(F=N)}),F?F.ref?s.push(new h.V(_,c.ref,"ref cannot reference another ref layer")):E=h.M(F.type):"string"==typeof R&&s.push(new h.V(_,c.ref,`ref layer "${R}" not found`))}else if("background"!==E&&"sky"!==E&&"slot"!==E)if(c.source){const F=v.sources&&v.sources[c.source],N=F&&h.M(F.type);F?"vector"===N&&"raster"===E?s.push(new h.V(_,c.source,`layer "${c.id}" requires a raster source`)):"raster"===N&&"raster"!==E?s.push(new h.V(_,c.source,`layer "${c.id}" requires a vector source`)):"vector"!==N||c["source-layer"]?"raster-dem"===N&&"hillshade"!==E?s.push(new h.V(_,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):"raster-array"!==N||["raster","raster-particle"].includes(E)?"line"!==E||!c.paint||!c.paint["line-gradient"]&&!c.paint["line-trim-offset"]||"geojson"===N&&F.lineMetrics?"raster-particle"===E&&"raster-array"!==N&&s.push(new h.V(_,c.source,`layer "${c.id}" requires a 'raster-array' source.`)):s.push(new h.V(_,c,`layer "${c.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):s.push(new h.V(_,c.source,"raster-array source can only be used with layer type 'raster'.")):s.push(new h.V(_,c,`layer "${c.id}" must specify a "source-layer"`)):s.push(new h.V(_,c.source,`source "${c.source}" not found`))}else s.push(new h.V(_,c,'missing required property "source"'));return s=s.concat(Xs({key:_,value:c,valueSpec:x.layer,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ir({key:`${_}.type`,value:c.type,valueSpec:x.layer.type,style:m.style,styleSpec:m.styleSpec,object:c,objectKey:"type"}),filter:F=>zd(h.L({layerType:E},F)),layout:F=>Xs({layer:c,key:F.key,value:F.value,valueSpec:{},style:F.style,styleSpec:F.styleSpec,objectElementValidators:{"*":N=>Gc(h.L({layerType:E},N))}}),paint:F=>Xs({layer:c,key:F.key,value:F.value,valueSpec:{},style:F.style,styleSpec:F.styleSpec,objectElementValidators:{"*":N=>Dr(h.L({layerType:E,layer:c},N))}})}})),s}function al(m){const s=m.value,c=m.key,_=h.K(s);return"string"!==_?[new h.V(c,s,`string expected, ${_} found`)]:[]}const Mi={promoteId:function m({key:s,value:c}){if("string"===h.K(c))return al({key:s,value:c});if(Array.isArray(c)){const _=[],v=h.U(c),x=h.X(v);return"error"===x.result&&x.value.forEach(E=>{_.push(new h.V(`${s}${E.key}`,null,`${E.message}`))}),h.Z(x.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||_.push(new h.V(`${s}`,null,"promoteId expression should be only feature dependent")),_}{const _=[];for(const v in c)_.push(...m({key:`${s}.${v}`,value:c[v]}));return _}}};function Nh(m){const s=m.value,c=m.key,_=m.styleSpec,v=m.style;if(!s.type)return[new h.V(c,s,'"type" is required')];const x=h.M(s.type);let E=[];switch(["vector","raster","raster-dem","raster-array"].includes(x)&&(s.url||s.tiles||E.push(new h.J(c,s,'Either "url" or "tiles" is required.'))),x){case"vector":case"raster":case"raster-dem":case"raster-array":return E=E.concat(Xs({key:c,value:s,valueSpec:_[`source_${x.replace("-","_")}`],style:m.style,styleSpec:_,objectElementValidators:Mi})),E;case"geojson":if(E=Xs({key:c,value:s,valueSpec:_.source_geojson,style:v,styleSpec:_,objectElementValidators:Mi}),s.cluster)for(const R in s.clusterProperties){const[F,N]=s.clusterProperties[R],z="string"==typeof F?[F,["accumulated"],["get",R]]:F;E.push(...sl({key:`${c}.${R}.map`,value:N,expressionContext:"cluster-map"})),E.push(...sl({key:`${c}.${R}.reduce`,value:z,expressionContext:"cluster-reduce"}))}return E;case"video":return Xs({key:c,value:s,valueSpec:_.source_video,style:v,styleSpec:_});case"image":return Xs({key:c,value:s,valueSpec:_.source_image,style:v,styleSpec:_});case"canvas":return[new h.V(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Fs({key:`${c}.type`,value:s.type,valueSpec:{values:zh(_)},style:v,styleSpec:_})}}function zh(m){return m.source.reduce((s,c)=>{const _=m[c];return"enum"===_.type.type&&(s=s.concat(Object.keys(_.type.values))),s},[])}function Bd(m){const s=m.value,c=m.styleSpec,_=c.light,v=m.style;let x=[];const E=h.K(s);if(void 0===s)return x;if("object"!==E)return x=x.concat([new h.V("light",s,`object expected, ${E} found`)]),x;for(const R in s){const F=R.match(/^(.*)-transition$/),N=R.match(/^(.*)-use-theme$/);x=x.concat(N&&_[N[1]]?ir({key:R,value:s[R],valueSpec:{type:"string"},style:v,styleSpec:c}):F&&_[F[1]]&&_[F[1]].transition?ir({key:R,value:s[R],valueSpec:c.transition,style:v,styleSpec:c}):_[R]?ir({key:R,value:s[R],valueSpec:_[R],style:v,styleSpec:c}):[new h.V(R,s[R],`unknown property "${R}"`)])}return x}function ka(m){const s=m.value;let c=[];if(!s)return c;const _=h.K(s);if("object"!==_)return c=c.concat([new h.V("light-3d",s,`object expected, ${_} found`)]),c;const v=m.styleSpec,x=v["light-3d"],E=m.key,R=m.style,F=m.style.lights;for(const U of["type","id"])if(!(U in s))return c=c.concat([new h.V("light-3d",s,`missing property ${U} on light`)]),c;if(s.type&&F)for(let U=0;U<m.arrayIndex;U++){const j=h.M(s.type),W=F[U];h.M(W.type)===j&&c.push(new h.V(E,s.id,`duplicate light type "${s.type}", previously defined at line ${W.id.__line__}`))}const N=`properties_light_${s.type}`;if(!(N in v))return c=c.concat([new h.V("light-3d",s,`Invalid light type ${s.type}`)]),c;const z=v[N];for(const U in s)if("properties"===U){const j=s[U],W=h.K(j);if("object"!==W)return c=c.concat([new h.V("properties",j,`object expected, ${W} found`)]),c;for(const ne in j)c=c.concat(z[ne]?ir({key:ne,value:j[ne],valueSpec:z[ne],style:R,styleSpec:v}):[new h.J(m.key,j[ne],`unknown property "${ne}"`)])}else{const j=U.match(/^(.*)-transition$/),W=U.match(/^(.*)-use-theme$/);c=c.concat(W&&x[W[1]]?ir({key:U,value:s[U],valueSpec:{type:"string"},style:R,styleSpec:v}):j&&x[j[1]]&&x[j[1]].transition?ir({key:U,value:s[U],valueSpec:v.transition,style:R,styleSpec:v}):x[U]?ir({key:U,value:s[U],valueSpec:x[U],style:R,styleSpec:v}):[new h.J(U,s[U],`unknown property "${U}"`)])}return c}function Ls(m){const s=m.value,c=m.key,_=m.style,v=m.styleSpec,x=v.terrain;let E=[];const R=h.K(s);if(void 0===s||"null"===R)return E;if("object"!==R)return E=E.concat([new h.V("terrain",s,`object expected, ${R} found`)]),E;for(const F in s){const N=F.match(/^(.*)-transition$/),z=F.match(/^(.*)-use-theme$/);E=E.concat(z&&x[z[1]]?ir({key:F,value:s[F],valueSpec:{type:"string"},style:_,styleSpec:v}):N&&x[N[1]]&&x[N[1]].transition?ir({key:F,value:s[F],valueSpec:v.transition,style:_,styleSpec:v}):x[F]?ir({key:F,value:s[F],valueSpec:x[F],style:_,styleSpec:v}):[new h.J(F,s[F],`unknown property "${F}"`)])}if(s.source){const F=_.sources&&_.sources[s.source],N=F&&h.M(F.type);F?"raster-dem"!==N&&E.push(new h.V(c,s.source,`terrain cannot be used with a source of type ${String(N)}, it only be used with a "raster-dem" source type`)):E.push(new h.V(c,s.source,`source "${s.source}" not found`))}else E.push(new h.V(c,s,'terrain is missing required property "source"'));return E}function Au(m){const s=m.value,c=m.style,_=m.styleSpec,v=_.fog;let x=[];const E=h.K(s);if(void 0===s)return x;if("object"!==E)return x=x.concat([new h.V("fog",s,`object expected, ${E} found`)]),x;for(const R in s){const F=R.match(/^(.*)-transition$/),N=R.match(/^(.*)-use-theme$/);x=x.concat(N&&v[N[1]]?ir({key:R,value:s[R],valueSpec:{type:"string"},style:c,styleSpec:_}):F&&v[F[1]]&&v[F[1]].transition?ir({key:R,value:s[R],valueSpec:_.transition,style:c,styleSpec:_}):v[R]?ir({key:R,value:s[R],valueSpec:v[R],style:c,styleSpec:_}):[new h.J(R,s[R],`unknown property "${R}"`)])}return x}const Ir={"*":()=>[],array:mc,boolean:function(m){const s=m.value,c=m.key,_=h.K(s);return"boolean"!==_?[new h.V(c,s,`boolean expected, ${_} found`)]:[]},number:yi,color:function(m){const s=m.key,c=m.value,_=h.K(c);return"string"!==_?[new h.V(s,c,`color expected, ${_} found`)]:null===h.a0.parseCSSColor(c)?[new h.V(s,c,`color expected, "${c}" found`)]:[]},enum:Fs,filter:zd,function:Po,layer:ls,object:Xs,source:Nh,model:h.a4,light:Bd,"light-3d":ka,terrain:Ls,fog:Au,string:al,formatted:function(m){return 0===al(m).length?[]:sl(m)},resolvedImage:function(m){return 0===al(m).length?[]:sl(m)},projection:function(m){const s=m.value,c=m.styleSpec,_=c.projection,v=m.style;let x=[];const E=h.K(s);if("object"===E)for(const R in s)x=x.concat(ir({key:R,value:s[R],valueSpec:_[R],style:v,styleSpec:c}));else"string"!==E&&(x=x.concat([new h.V("projection",s,`object or string expected, ${E} found`)]));return x},import:function(m){const{value:s,styleSpec:c}=m,{data:_,...v}=s;Object.defineProperty(v,"__line__",{value:s.__line__,enumerable:!1});let x=Xs(h.L({},m,{value:v,valueSpec:c.import}));return""===h.M(v.id)&&x.push(new h.V(`${m.key}.id`,v,"import id can't be an empty string")),_&&(x=x.concat(Bh(_,c,{key:`${m.key}.data`}))),x},iconset:function(m){const s=m.value,c=m.key,_=m.styleSpec,v=m.style;if(!s.type)return[new h.V(c,s,'"type" is required')];const x=h.M(s.type);let E=[];if(E=E.concat(Xs({key:c,value:s,valueSpec:_[`iconset_${x}`],style:v,styleSpec:_})),"source"===x&&s.source){const R=v.sources&&v.sources[s.source],F=R&&h.M(R.type);R?"raster-array"!==F&&E.push(new h.V(c,s.source,`iconset cannot be used with a source of type ${String(F)}, it only be used with a "raster-array" source type`)):E.push(new h.V(c,s.source,`source "${s.source}" not found`))}return E}};function ir(m,s=!1){const c=m.value,_=m.valueSpec,v=m.styleSpec;if(_.expression&&h.a2(h.M(c)))return Po(m);if(_.expression&&h.S(h.U(c)))return sl(m);if(_.type&&Ir[_.type]){const x=Ir[_.type](m);return!0===s&&x.length>0&&"array"===h.K(m.value)?sl(m):x}return Xs(h.L({},m,{valueSpec:_.type?v[_.type]:_}))}function Yp(m){const s=m.value,c=m.key,_=al(m);return _.length||(-1===s.indexOf("{fontstack}")&&_.push(new h.V(c,s,'"glyphs" url must include a "{fontstack}" token')),-1===s.indexOf("{range}")&&_.push(new h.V(c,s,'"glyphs" url must include a "{range}" token'))),_}function Bh(m,s=h.a5,c={}){return ir({key:c.key||"",value:m,valueSpec:s.$root,styleSpec:s,style:m,objectElementValidators:{glyphs:Yp,"*":()=>[]}})}function ws(m,s=h.a5){return Ne(Bh(m,s))}const Ra=m=>Ne(Nh(m)),Vd=m=>Ne(Bd(m)),Vh=m=>Ne(ka(m)),Uh=m=>Ne(Ls(m)),fm=m=>Ne(Au(m)),ku=m=>Ne(function(s){const c=s.value,_=s.style,v=s.styleSpec,x=v.snow;let E=[];const R=h.K(c);if(void 0===c)return E;if("object"!==R)return E=E.concat([new h.V("snow",c,`object expected, ${R} found`)]),E;for(const F in c){const N=F.match(/^(.*)-transition$/);E=E.concat(N&&x[N[1]]&&x[N[1]].transition?ir({key:F,value:c[F],valueSpec:v.transition,style:_,styleSpec:v}):x[F]?ir({key:F,value:c[F],valueSpec:x[F],style:_,styleSpec:v}):[new h.J(F,c[F],`unknown property "${F}"`)])}return E}(m)),it=m=>Ne(function(s){const c=s.value,_=s.style,v=s.styleSpec,x=v.rain;let E=[];const R=h.K(c);if(void 0===c)return E;if("object"!==R)return E=E.concat([new h.V("rain",c,`object expected, ${R} found`)]),E;for(const F in c){const N=F.match(/^(.*)-transition$/);E=E.concat(N&&x[N[1]]&&x[N[1]].transition?ir({key:F,value:c[F],valueSpec:v.transition,style:_,styleSpec:v}):x[F]?ir({key:F,value:c[F],valueSpec:x[F],style:_,styleSpec:v}):[new h.J(F,c[F],`unknown property "${F}"`)])}return E}(m)),re=m=>Ne(ls(m)),ce=m=>Ne(zd(m)),Se=m=>Ne(Dr(m)),Pe=m=>Ne(Gc(m)),Ae=m=>Ne(h.a4(m));function Ne(m){return m.slice().sort((s,c)=>s.line&&c.line?s.line-c.line:0)}function Ke(m,s){let c=!1;if(s&&s.length)for(const _ of s)_ instanceof h.J?h.w(_.message):(m.fire(new h.z(new Error(_.message))),c=!0);return c}let je;class tt extends h.E{constructor(s,c="flat"){super(),this._transitionable=new h.a6(je||(je=new h.a7({anchor:new h.a8(h.a5.light.anchor),position:new h.a9(h.a5.light.position),color:new h.a8(h.a5.light.color),intensity:new h.a8(h.a5.light.intensity)}))),this.setLight(s,c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,c,_={}){this._validate(Vd,s,_)||(this._transitionable.setTransitionOrValue(s),this.id=c)}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,c,_){return(!_||!1!==_.validate)&&Ke(this,s.call(ws,h.l({value:c,style:{glyphs:!0,sprite:!0},styleSpec:h.a5})))}}let Qe=class extends h.E{constructor(m,s,c,_){super(),this.scope=c,this._transitionable=new h.a6(new h.a7({source:new h.a8(h.a5.terrain.source),exaggeration:new h.a8(h.a5.terrain.exaggeration)}),c,_),this._transitionable.setTransitionOrValue(m,_),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=s}get(){return this._transitionable.serialize()}set(m,s){this._transitionable.setTransitionOrValue(m,s)}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}getExaggeration(m){return this._transitioning.possiblyEvaluate(new h.aa(m)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const m=this._transitionable._values.exaggeration;if(!m)return null;const s=m.value.expression;if(!s)return null;let c=-1,_=-1,v=1;for(const x of s.zoomStops)v=s.evaluate(new h.aa(x)),v>.01?(c=x,_=-1):_=x;return v<.01&&c>0&&_>c?[c,_]:null}isZoomDependent(){const m=this._transitionable._values.exaggeration;return null!=m&&null!=m.value&&null!=m.value.expression&&m.value.expression instanceof h.ab}};const Yt=.05;function Qt(m,s,c,_){const v=h.ae(45,65,c),[x,E]=Et(m,_);let R=1-Math.min(1,Math.exp((s-x)/(E-x)*-6));return R*=R*R,R=Math.min(1,1.00747*R),R*v*m.alpha}function Et(m,s){const c=.5/Math.tan(.5*s);return[m.range[0]+c,m.range[1]+c]}function Ln(m,s,c,_,v){const x=h.ad.vec3.transformMat4([],[s,c,_],v.mercatorFogMatrix);return Qt(m,h.ad.vec3.length(x),v.pitch,v._fov)}function pn(m,s,c,_,v,x,E){const R=[[c,_,0],[v,_,0],[v,x,0],[c,x,0]];let F=Number.MAX_VALUE,N=-Number.MAX_VALUE;for(const z of R){const U=h.ad.vec3.transformMat4([],z,s),j=h.ad.vec3.length(U);F=Math.min(F,j),N=Math.max(N,j)}return[Qt(m,F,E.pitch,E._fov),Qt(m,N,E.pitch,E._fov)]}class Hn extends h.E{constructor(s,c,_,v){super();const x=new h.a7({range:new h.a8(h.a5.fog.range),color:new h.a8(h.a5.fog.color),"color-use-theme":new h.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new h.a8(h.a5.fog["high-color"]),"high-color-use-theme":new h.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new h.a8(h.a5.fog["space-color"]),"space-color-use-theme":new h.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new h.a8(h.a5.fog["horizon-blend"]),"star-intensity":new h.a8(h.a5.fog["star-intensity"]),"vertical-range":new h.a8(h.a5.fog["vertical-range"])});this._transitionable=new h.a6(x,_,new Map(v)),this.set(s,v),this._transitioning=this._transitionable.untransitioned(),this._transform=c,this.properties=new h.af(x),this.scope=_}get state(){const s=this._transform,c="globe"===s.projection.name,_=h.ag(s.zoom),v=this.properties.get("range"),x=[.5,3];return{range:c?[h.ah(x[0],v[0],_),h.ah(x[1],v[1],_)]:v,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(s,c,_={}){if(this._validate(fm,s,_))return;const v=h.l({},s);for(const x of Object.keys(h.a5.fog))void 0===v[x]&&(v[x]=h.a5.fog[x].default);this._options=v,this._transitionable.setTransitionOrValue(this._options,c)}getOpacity(s){if(!this._transform.projection.supportsFog)return 0;const c=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:h.ae(45,65,s))*c.a}getOpacityAtLatLng(s,c){return this._transform.projection.supportsFog?function(_,v,x){const E=h.ac.fromLngLat(v),R=x.elevation?x.elevation.getAtPointOrZero(E):0;return Ln(_,E.x,E.y,R,x)}(this.state,s,c):0}getOpacityForTile(s){if(!this._transform.projection.supportsFog)return[1,1];const c=this._transform.calculateFogTileMatrix(s.toUnwrapped());return pn(this.state,c,0,0,h.ai,h.ai,this._transform)}getOpacityForBounds(s,c,_,v,x){return this._transform.projection.supportsFog?pn(this.state,s,c,_,v,x,this._transform):[1,1]}getFovAdjustedRange(s){return this._transform.projection.supportsFog?Et(this.state,s):[0,1]}isVisibleOnFrustum(s){if(!this._transform.projection.supportsFog)return!1;const c=[4,5,6,7];for(const _ of c){const v=s.points[_];let x;if(v[2]>=0)x=v;else{const E=s.points[_-4];x=h.aj(E,v,E[2]/(E[2]-v[2]))}if(Ln(this.state,x[0],x[1],0,this._transform)>=Yt)return!0}return!1}updateConfig(s){this._transitionable.setTransitionOrValue(this._options,new Map(s))}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,c,_){return(!_||!1!==_.validate)&&Ke(this,s.call(ws,h.l({value:c,style:{glyphs:!0,sprite:!0},styleSpec:h.a5})))}}let Jn,li,si,an,Wi=class extends h.E{constructor(m,s,c,_){super();const v=Jn||(Jn=new h.a7({density:new h.a8(h.a5.snow.density),intensity:new h.a8(h.a5.snow.intensity),color:new h.a8(h.a5.snow.color),opacity:new h.a8(h.a5.snow.opacity),vignette:new h.a8(h.a5.snow.vignette),"vignette-color":new h.a8(h.a5.snow["vignette-color"]),"center-thinning":new h.a8(h.a5.snow["center-thinning"]),direction:new h.a8(h.a5.snow.direction),"flake-size":new h.a8(h.a5.snow["flake-size"])}));this._transitionable=new h.a6(v,c,new Map(_)),this.set(m,_),this._transitioning=this._transitionable.untransitioned(),this.properties=new h.af(v),this.scope=c}get state(){const m=this.properties.get("opacity"),s=this.properties.get("color"),c=this.properties.get("direction"),_=h.ak(c[0]),v=-Math.max(h.ak(c[1]),.01),x=[Math.cos(_)*Math.cos(v),Math.sin(_)*Math.cos(v),Math.sin(v)],E=this.properties.get("vignette"),R=this.properties.get("vignette-color");return R.a=E,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new h.al(s.r,s.g,s.b,s.a*m),direction:x,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:R}}get(){return this._transitionable.serialize()}set(m,s,c={}){if(this._validate(ku,m,c))return;const _=h.l({},m);for(const v of Object.keys(h.a5.snow))void 0===_[v]&&(_[v]=h.a5.snow[v].default);this._options=_,this._transitionable.setTransitionOrValue(this._options,s)}updateConfig(m){this._transitionable.setTransitionOrValue(this._options,new Map(m))}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}_validate(m,s,c){return(!c||!1!==c.validate)&&Ke(this,m.call(ws,h.l({value:s,style:{glyphs:!0,sprite:!0},styleSpec:h.a5})))}},ji=class extends h.E{constructor(m,s,c,_){super();const v=li||(li=new h.a7({density:new h.a8(h.a5.rain.density),intensity:new h.a8(h.a5.rain.intensity),color:new h.a8(h.a5.rain.color),opacity:new h.a8(h.a5.rain.opacity),vignette:new h.a8(h.a5.rain.vignette),"vignette-color":new h.a8(h.a5.rain["vignette-color"]),"center-thinning":new h.a8(h.a5.rain["center-thinning"]),direction:new h.a8(h.a5.rain.direction),"droplet-size":new h.a8(h.a5.rain["droplet-size"]),"distortion-strength":new h.a8(h.a5.rain["distortion-strength"])}));this._transitionable=new h.a6(v,c,new Map(_)),this.set(m,_),this._transitioning=this._transitionable.untransitioned(),this.properties=new h.af(v),this.scope=c}get state(){const m=this.properties.get("opacity"),s=this.properties.get("color"),c=this.properties.get("direction"),_=h.ak(c[0]),v=-Math.max(h.ak(c[1]),.01),x=[Math.cos(_)*Math.cos(v),Math.sin(_)*Math.cos(v),Math.sin(v)],E=this.properties.get("vignette-color");return E.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new h.al(s.r,s.g,s.b,s.a*m),direction:x,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:E}}get(){return this._transitionable.serialize()}set(m,s,c={}){if(this._validate(it,m,c))return;const _=h.l({},m);for(const v of Object.keys(h.a5.rain))void 0===_[v]&&(_[v]=h.a5.rain[v].default);this._options=_,this._transitionable.setTransitionOrValue(this._options,s)}updateConfig(m){this._transitionable.setTransitionOrValue(this._options,new Map(m))}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}_validate(m,s,c){return(!c||!1!==c.validate)&&Ke(this,m.call(ws,h.l({value:s,style:{glyphs:!0,sprite:!0},styleSpec:h.a5})))}};class bt extends h.E{constructor(s,c,_,v){super(),this.scope=_,this._options=s,this.properties=new h.af(c),this._transitionable=new h.a6(c,_,new Map(v)),this._transitionable.setTransitionOrValue(s.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(s){this._transitionable.setTransitionOrValue(this._options.properties,new Map(s))}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(s,c){this._options=s,this._transitionable.setTransitionOrValue(s.properties,c)}shadowsEnabled(){return!!this.properties&&!0===this.properties.get("cast-shadows")}}class Oo{constructor(s,c,_,v){this.screenBounds=s,this.cameraPoint=c,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=_,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,v)}static createFromScreenPoints(s,c){let _,v;if(s instanceof h.P||"number"==typeof s[0]){const x=h.P.convert(s);_=[x],v=c.isPointAboveHorizon(x)}else{const x=h.P.convert(s[0]),E=h.P.convert(s[1]);_=[x,E],v=h.an(x,E).every(R=>c.isPointAboveHorizon(R))}return new Oo(_,c.getCameraPoint(),v,c)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(s){return h.an(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],s)}bufferedCameraGeometry(s){const c=this.screenBounds[0],_=1===this.screenBounds.length?this.screenBounds[0].add(new h.P(1,1)):this.screenBounds[1],v=h.an(c,_,0,!1);return this.cameraPoint.y>_.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<_.x?v.splice(3,0,this.cameraPoint):this.cameraPoint.x>=_.x?v[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(v[3]=this.cameraPoint)),h.ao(v,s)}bufferedCameraGeometryGlobe(s){const c=this.screenBounds[0],_=1===this.screenBounds.length?this.screenBounds[0].add(new h.P(1,1)):this.screenBounds[1],v=h.an(c,_,s),x=this.cameraPoint.clone();switch(3*((x.y>c.y)+(x.y>_.y))+((x.x>c.x)+(x.x>_.x))){case 0:v[0]=x,v[4]=x.clone();break;case 1:v.splice(1,0,x);break;case 2:v[1]=x;break;case 3:v.splice(4,0,x);break;case 5:v.splice(2,0,x);break;case 6:v[3]=x;break;case 7:v.splice(3,0,x);break;case 8:v[2]=x}return v}containsTile(s,c,_,v=0){const x=s.queryPadding/c._pixelsPerMercatorPixel+1,E=_?this._bufferedCameraMercator(x,c):this._bufferedScreenMercator(x,c);let R=s.tileID.wrap+(E.unwrapped?v:0);const F=E.polygon.map(oe=>h.ap(s.tileTransform,oe,R));if(!h.aq(F,0,0,h.ai,h.ai))return;R=s.tileID.wrap+(this.screenGeometryMercator.unwrapped?v:0);const N=this.screenGeometryMercator.polygon.map(oe=>h.ar(s.tileTransform,oe,R)),z=N.map(oe=>new h.P(oe[0],oe[1])),U=c.getFreeCameraOptions().position||new h.ac(0,0,0),j=h.ar(s.tileTransform,U,R),W=N.map(oe=>{const se=h.ad.vec3.sub(oe,oe,j);return h.ad.vec3.normalize(se,se),new h.as(j,se)}),ne=h.at(s,1,c.zoom)*c._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:z,tilespaceRays:W,bufferedTilespaceGeometry:F,bufferedTilespaceBounds:(J=h.au(F),J.min.x=h.ay(J.min.x,0,h.ai),J.min.y=h.ay(J.min.y,0,h.ai),J.max.x=h.ay(J.max.x,0,h.ai),J.max.y=h.ay(J.max.y,0,h.ai),J),tile:s,tileID:s.tileID,pixelToTileUnitsFactor:ne};var J}_bufferedScreenMercator(s,c){const _=Cs(s);if(this._screenRaycastCache[_])return this._screenRaycastCache[_];{let v;return v="globe"===c.projection.name?this._projectAndResample(this.bufferedScreenGeometry(s),c):{polygon:this.bufferedScreenGeometry(s).map(x=>c.pointCoordinate3D(x)),unwrapped:!0},this._screenRaycastCache[_]=v,v}}_bufferedCameraMercator(s,c){const _=Cs(s);if(this._cameraRaycastCache[_])return this._cameraRaycastCache[_];{let v;return v="globe"===c.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(s),c):{polygon:this.bufferedCameraGeometry(s).map(x=>c.pointCoordinate3D(x)),unwrapped:!0},this._cameraRaycastCache[_]=v,v}}_projectAndResample(s,c){const _=function(x,E){const R=h.ad.mat4.multiply([],E.pixelMatrix,E.globeMatrix),F=[0,-h.az,0,1],N=[0,h.az,0,1],z=[0,0,0,1];h.ad.vec4.transformMat4(F,F,R),h.ad.vec4.transformMat4(N,N,R),h.ad.vec4.transformMat4(z,z,R);const U=new h.P(F[0]/F[3],F[1]/F[3]),j=new h.P(N[0]/N[3],N[1]/N[3]),W=h.aw(x,U)&&F[3]<z[3],ne=h.aw(x,j)&&N[3]<z[3];if(!W&&!ne)return null;const J=function(De,Me,ke){for(let Oe=1;Oe<De.length;Oe++){const et=Ks(Me.pointCoordinate3D(De[Oe-1]).x),qe=Ks(Me.pointCoordinate3D(De[Oe]).x);if(ke<0){if(et<qe)return{idx:Oe,t:-et/(qe-1-et)}}else if(qe<et)return{idx:Oe,t:(1-et)/(qe+1-et)}}return null}(x,E,W?-1:1);if(!J)return null;const{idx:oe,t:se}=J;let fe=oe>1?eo(x.slice(0,oe),E):[],be=oe<x.length?eo(x.slice(oe),E):[];fe=fe.map(De=>new h.P(Ks(De.x),De.y)),be=be.map(De=>new h.P(Ks(De.x),De.y));const ve=[...fe];0===ve.length&&ve.push(be[be.length-1]);const we=h.ah(ve[ve.length-1].y,(0===be.length?fe[0]:be[0]).y,se);let Ee;return Ee=W?[new h.P(0,we),new h.P(0,0),new h.P(1,0),new h.P(1,we)]:[new h.P(1,we),new h.P(1,1),new h.P(0,1),new h.P(0,we)],ve.push(...Ee),0===be.length?ve.push(fe[0]):ve.push(...be),{polygon:ve.map(De=>new h.ac(De.x,De.y)),unwrapped:!1}}(s,c);if(_)return _;const v=function(x,E){let R=!1,F=-1/0,N=0;for(let U=0;U<x.length-1;U++)x[U].x>F&&(F=x[U].x,N=U);for(let U=0;U<x.length-1;U++){const j=(N+U)%(x.length-1),W=x[j],ne=x[j+1];Math.abs(W.x-ne.x)>.5&&(W.x<ne.x?(W.x+=1,0===j&&(x[x.length-1].x+=1)):(ne.x+=1,j+1===x.length-1&&(x[0].x+=1)),R=!0)}const z=h.av(E.center.lng);return R&&z<Math.abs(z-1)&&x.forEach(U=>{U.x-=1}),{polygon:x,unwrapped:R}}(eo(s,c).map(x=>new h.P(Ks(x.x),x.y)),c);return{polygon:v.polygon.map(x=>new h.ac(x.x,x.y)),unwrapped:v.unwrapped}}}function eo(m,s){return h.ax(m,c=>{const _=s.pointCoordinate3D(c);c.x=_.x,c.y=_.y},1/256)}function Ks(m){return m<0?1+m%1:m%1}function Cs(m){return 100*m|0}function Zo(m,s,c,_,v){const x=function(R,F){if(R)return v(R);if(F){if(m.url&&F.tiles&&m.tiles&&delete m.tiles,F.variants){if(!Array.isArray(F.variants))return v(new Error("variants must be an array"));for(const z of F.variants){if(null==z||"object"!=typeof z||z.constructor!==Object)return v(new Error("variant must be an object"));if(!Array.isArray(z.capabilities))return v(new Error("capabilities must be an array"));if(1===z.capabilities.length&&"meshopt"===z.capabilities[0]){F=h.l(F,z);break}}}const N=h.aA(h.l({},F,m),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);N.tiles=s.canonicalizeTileset(N,m.url),v(null,N)}},E=function(R,F,N){if(!R)return null;if(!F&&!N)return R;N=N||R.worldview_default;const z=Object.values(R.language||{});if(0===z.length)return null;const U=Object.values(R.worldview||{});if(0===U.length)return null;const j=z.every(ne=>ne===F),W=U.every(ne=>ne===N);return j&&W?R:F in(R.language_options||{})||N in(R.worldview_options||{})?null:R.language_options&&R.worldview_options?R:null}(m.data,c,_);return E?h.q.frame(()=>x(null,E)):m.url?h.n(s.transformRequest(s.normalizeSourceURL(m.url,null,c,_),h.R.Source),x):h.q.frame(()=>{const{data:R,...F}=m;x(null,F)})}class Fo{constructor(s,c,_){this.bounds=h.aB.convert(this.validateBounds(s)),this.minzoom=c||0,this.maxzoom=_||24}validateBounds(s){return Array.isArray(s)&&4===s.length?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){const c=Math.pow(2,s.z),_=Math.floor(h.av(this.bounds.getWest())*c),v=Math.floor(h.aC(this.bounds.getNorth())*c),x=Math.ceil(h.av(this.bounds.getEast())*c),E=Math.ceil(h.aC(this.bounds.getSouth())*c);return s.x>=_&&s.x<x&&s.y>=v&&s.y<E}}class la extends h.E{constructor(s,c,_,v){if(super(),this.id=s,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,h.l(this,h.aA(c,["url","scheme","tileSize","promoteId"])),this._options=h.l({type:"vector"},c),this._collectResourceTiming=!!c.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v),this._tileWorkers={},this._deduped=new h.aD}load(s){this._loaded=!1,this.fire(new h.A("dataloading",{dataType:"source"}));const c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,_=this.map.getWorldview();this._tileJSONRequest=Zo(this._options,this.map._requestManager,c,_,(v,x)=>{if(this._tileJSONRequest=null,this._loaded=!0,v)c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),_&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${_}`),this.fire(new h.z(v));else if(x){if(h.l(this,x),this.hasWorldviews=!!x.worldview_options,x.worldview_default&&(this.worldviewDefault=x.worldview_default),x.vector_layers){this.vectorLayers=x.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const E of x.vector_layers)this.vectorLayerIds.push(E.id),x.worldview&&x.worldview[E.source]&&this.localizableLayerIds.add(E.id)}x.bounds&&(this.tileBounds=new Fo(x.bounds,this.minzoom,this.maxzoom)),Oh(x.tiles,this.map._requestManager._customAccessToken),this.fire(new h.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.A("data",{dataType:"source",sourceDataType:"content"}))}s&&s(v)})}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest();const s=h.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(s))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(s){this.cancelTileJSONRequest()}serialize(){return h.l({},this._options)}loadTile(s,c){const _=s.tileID.canonical.url(this.tiles,this.scheme),v=this.map._requestManager.normalizeTileURL(_),x=this.map._requestManager.transformRequest(v,h.R.Tile),E=this.map.style?this.map.style.getLut(this.scope):null,R=E?{image:E.image.clone()}:null,F={request:x,data:void 0,uid:s.uid,tileID:s.tileID,tileZoom:s.tileZoom,zoom:s.tileID.overscaledZ,maxZoom:this.maxzoom,lut:R,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:h.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:s.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:s.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&h.f(_)&&(F.worldview=this.map.getWorldview()||this.worldviewDefault,F.localizableLayerIds=this.localizableLayerIds),F.request.collectResourceTiming=this._collectResourceTiming,s.actor&&"expired"!==s.state)"loading"===s.state?s.reloadCallback=c:s.request=s.actor.send("reloadTile",F,N.bind(this));else if(s.actor=this._tileWorkers[v]=this._tileWorkers[v]||this.dispatcher.getActor(),this.dispatcher.ready)s.request=s.actor.send("loadTile",F,N.bind(this),void 0,!0);else{const z=h.aE.call({deduped:this._deduped},F,(U,j)=>{U||!j?N.call(this,U):(F.data={cacheControl:j.cacheControl,expires:j.expires,rawData:j.rawData.slice(0)},s.actor&&s.actor.send("loadTile",F,N.bind(this),void 0,!0))},!0);s.request={cancel:z}}function N(z,U){return delete s.request,s.aborted?c(null):z&&404!==z.status?c(z):(U&&U.resourceTiming&&(s.resourceTiming=U.resourceTiming),this.map._refreshExpiredTiles&&U&&s.setExpiryData(U),s.loadVectorData(U,this.map.painter),h.aF(this.dispatcher),c(null),void(s.reloadCallback&&(this.loadTile(s,s.reloadCallback),s.reloadCallback=null)))}}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.actor&&s.actor.send("abortTile",{uid:s.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(s,c){s.actor&&s.actor.send("removeTile",{uid:s.uid,type:this.type,source:this.id,scope:this.scope}),s.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Es extends h.E{constructor(s,c,_,v){super(),this.id=s,this.dispatcher=_,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=h.l({type:"raster"},c),h.l(this,h.aA(c,["url","scheme","tileSize"]))}load(s){this._loaded=!1,this.fire(new h.A("dataloading",{dataType:"source"})),this._tileJSONRequest=Zo(this._options,this.map._requestManager,null,null,(c,_)=>{this._tileJSONRequest=null,this._loaded=!0,c?this.fire(new h.z(c)):_&&(h.l(this,_),_.raster_layers&&(this.rasterLayers=_.raster_layers,this.rasterLayerIds=this.rasterLayers.map(v=>v.id)),_.bounds&&(this.tileBounds=new Fo(_.bounds,this.minzoom,this.maxzoom)),Oh(_.tiles),this.fire(new h.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.A("data",{dataType:"source",sourceDataType:"content"}))),s&&s(c)})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest();const s=h.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(s))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(s){this.cancelTileJSONRequest()}serialize(){return h.l({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s,c){const _=h.q.devicePixelRatio>=2,v=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),_,this.tileSize);s.request=h.o(this.map._requestManager.transformRequest(v,h.R.Tile),(x,E,R,F)=>(delete s.request,s.aborted?(s.state="unloaded",c(null)):x?(s.state="errored",c(x)):E?(this.map._refreshExpiredTiles&&s.setExpiryData({cacheControl:R,expires:F}),s.setTexture(E,this.map.painter),s.state="loaded",h.aF(this.dispatcher),void c(null)):c(null)))}abortTile(s,c){s.request&&(s.request.cancel(),delete s.request),c&&c()}unloadTile(s,c){s.texture&&s.texture instanceof h.T?(s.destroy(!0),s.texture&&s.texture instanceof h.T&&this.map.painter.saveTileTexture(s.texture)):s.destroy(),c&&c()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ca extends Es{constructor(s,c,_,v){super(s,c,_,v),this.type="raster-array",this.maxzoom=22,this.partial=!0,this.iconsets={},this._options=h.l({type:"raster-array"},c)}triggerRepaint(s){const c=this.map.painter._terrain,_=this.map.style.getSourceCache(this.id);c&&c.enabled&&_&&c._clearRenderCacheForTile(_.id,s.tileID),this.map.triggerRepaint()}loadTile(s,c){const _=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),v=this.map._requestManager.transformRequest(_,h.R.Tile),x={request:v,uid:s.uid,tileID:s.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};s.source=this.id,s.scope=this.scope,s.requestParams=v,s.actor||(s.actor=this.dispatcher.getActor());const E=(R,F,N,z)=>{if(delete s.request,s.aborted)return s.state="unloaded",c(null);if(R)return"AbortError"===R.name?void 0:(s.state="errored",c(R));if(this.map._refreshExpiredTiles&&F&&s.setExpiryData({cacheControl:N,expires:z}),this.partial)s.state="empty";else{if(!F)return c(null);s.state="loaded",s._isHeaderLoaded=!0,s._mrt=F;const U=new Map;for(const j in s._mrt.layers){const W=s.getLayer(j);if(W)for(const ne of W.getBandList()){const{bytes:J,tileSize:oe,buffer:se}=W.getBandView(ne),fe=oe+2*se,be={data:new h.r({width:fe,height:fe},J),pixelRatio:2,sdf:!1,usvg:!1,version:0};U.set(`${j}/${ne}`,be)}}for(const j in this.iconsets)this.iconsets[j].addIcons(U)}c(null)};s.request=this.partial?s.fetchHeader(void 0,E.bind(this)):s.actor.send("loadTile",x,E.bind(this),void 0,!0)}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.actor&&s.actor.send("abortTile",{uid:s.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(s,c){const _=s.texture;_&&_ instanceof h.T?(s.destroy(!0),this.map.painter.saveTileTexture(_)):(s.destroy(),s.flushQueues(),s._isHeaderLoaded=!1,delete s._mrt,delete s.textureDescriptor),s.fbo&&(s.fbo.destroy(),delete s.fbo),delete s.request,delete s.requestParams,delete s.neighboringTiles,s.state="unloaded"}prepareTile(s,c,_){s._isHeaderLoaded&&("empty"!==s.state&&(s.state="reloading"),s.fetchBand(c,_,(v,x)=>{if(v)return s.state="errored",this.fire(new h.z(v)),void this.triggerRepaint(s);x&&(s._isHeaderLoaded=!0,s.setTexture(x,this.map.painter),s.state="loaded",this.triggerRepaint(s))}))}getInitialBand(s){if(!this.rasterLayers)return 0;const c=this.rasterLayers.find(({id:x})=>x===s),_=c&&c.fields,v=_&&_.bands&&_.bands;return v?v[0]:0}getTextureDescriptor(s,c,_){if(!s)return;const v=c.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!v)return;let x=null;c instanceof h.aI?x=c.paint.get("raster-array-band"):c instanceof h.aJ&&(x=c.paint.get("raster-particle-array-band"));const E=x||this.getInitialBand(v);if(null!=E)if(s.textureDescriptor){if(!s.updateNeeded(v,E)||_)return Object.assign({},s.textureDescriptor,{texture:s.texture})}else this.prepareTile(s,v,E)}addIconset(s,c){this.iconsets[s]=c,this.partial=!1}}const Ud={vector:la,raster:Es,"raster-dem":class extends Es{constructor(m,s,c,_){super(m,s,c,_),this.type="raster-dem",this.maxzoom=22,this._options=h.l({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox"}loadTile(m,s){const c=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function _(v,x){v&&(m.state="errored",s(v)),x&&(m.dem=x,m.dem.onDeserialize(),m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0,m.state="loaded",s(null))}m.request=h.o(this.map._requestManager.transformRequest(c,h.R.Tile),function(v,x,E,R){if(delete m.request,m.aborted)m.state="unloaded",s(null);else if(v)m.state="errored",s(v);else if(x){this.map._refreshExpiredTiles&&m.setExpiryData({cacheControl:E,expires:R});const F=ImageBitmap&&x instanceof ImageBitmap&&h.t(),N=1-(x.width-h.aG(x.width))/2;N<1||m.neighboringTiles||(m.neighboringTiles=this._getNeighboringTiles(m.tileID));const z=F?x:h.q.getImageData(x,N),U={uid:m.uid,tileID:m.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:z,encoding:this.encoding,padding:N};m.actor&&"expired"!==m.state||(m.actor=this.dispatcher.getActor(),m.actor.send("loadTile",U,_.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(m){const s=m.canonical,c=Math.pow(2,s.z),_=(s.x-1+c)%c,v=0===s.x?m.wrap-1:m.wrap,x=(s.x+1+c)%c,E=s.x+1===c?m.wrap+1:m.wrap,R={};return R[new h.aH(m.overscaledZ,v,s.z,_,s.y).key]={backfilled:!1},R[new h.aH(m.overscaledZ,E,s.z,x,s.y).key]={backfilled:!1},s.y>0&&(R[new h.aH(m.overscaledZ,v,s.z,_,s.y-1).key]={backfilled:!1},R[new h.aH(m.overscaledZ,m.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},R[new h.aH(m.overscaledZ,E,s.z,x,s.y-1).key]={backfilled:!1}),s.y+1<c&&(R[new h.aH(m.overscaledZ,v,s.z,_,s.y+1).key]={backfilled:!1},R[new h.aH(m.overscaledZ,m.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},R[new h.aH(m.overscaledZ,E,s.z,x,s.y+1).key]={backfilled:!1}),R}},"raster-array":ca,geojson:class extends h.E{constructor(m,s,c,_){super(),this.id=m,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(_),this._data=s.data,this._options=h.l({},s),this._collectResourceTiming=s.collectResourceTiming,void 0!==s.maxzoom&&(this.maxzoom=s.maxzoom),void 0!==s.minzoom&&(this.minzoom=s.minzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const v=h.ai/this.tileSize;this.workerOptions=h.l({source:this.id,scope:this.scope,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(void 0!==s.buffer?s.buffer:128)*v,tolerance:(void 0!==s.tolerance?s.tolerance:.375)*v,extent:h.ai,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:void 0!==s.clusterMaxZoom?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:h.ai,radius:(void 0!==s.clusterRadius?s.clusterRadius:50)*v,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter,dynamic:s.dynamic},s.workerOptions)}onAdd(m){this.map=m,this.setData(this._data)}setData(m){return this._data=m,this._updateWorkerData(),this}updateData(m){if(!this._options.dynamic)return this.fire(new h.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if("string"!=typeof m&&("Feature"===m.type&&(m={type:"FeatureCollection",features:[m]}),"FeatureCollection"!==m.type))return this.fire(new h.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&"string"!=typeof m&&"string"!=typeof this._data&&"FeatureCollection"===this._data.type){const s=new Map;for(const c of this._data.features)s.set(c.id,c);for(const c of m.features)s.set(c.id,c);this._data.features=[...s.values()]}else this._data=m;return this._updateWorkerData(!0),this}getClusterExpansionZoom(m,s){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:m,source:this.id,scope:this.scope},s),this}getClusterChildren(m,s){return this.actor.send("geojson.getClusterChildren",{clusterId:m,source:this.id,scope:this.scope},s),this}getClusterLeaves(m,s,c,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:m,limit:s,offset:c},_),this}_updateWorkerData(m=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new h.A("dataloading",{dataType:"source"})),this._loaded=!1;const s=h.l({append:m},this.workerOptions);s.scope=this.scope;const c=this._data;"string"==typeof c?(s.request=this.map._requestManager.transformRequest(h.q.resolveURL(c),h.R.Source),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(c),this._pendingLoad=this.actor.send(`${this.type}.loadData`,s,(_,v)=>{if(this._loaded=!0,this._pendingLoad=null,_)this.fire(new h.z(_));else{const x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&v&&v.resourceTiming&&v.resourceTiming[this.id]&&(x.resourceTiming=v.resourceTiming[this.id]),m&&(this._partialReload=!0),this.fire(new h.A("data",x)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(m),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const m=h.C(this.id,this.scope);this.map.style.clearSource(m),this._updateWorkerData()}loadTile(m,s){const c=m.actor?"reloadTile":"loadTile";m.actor=this.actor;const _=this.map.style?this.map.style.getLut(this.scope):null,v=_?{image:_.image.clone()}:null,x=this._partialReload,E={type:this.type,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:v,scope:this.scope,pixelRatio:h.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,scaleFactor:this.map.getScaleFactor(),partial:x};m.request=this.actor.send(c,E,(R,F)=>x&&!F?(m.state="loaded",s(null)):(delete m.request,m.destroy(),m.aborted?s(null):R?s(R):(m.loadVectorData(F,this.map.painter,"reloadTile"===c),s(null))),void 0,"loadTile"===c)}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.aborted=!0}unloadTile(m,s){this.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id,scope:this.scope}),m.destroy()}onRemove(m){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return h.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends h.aK{constructor(m,s,c,_){super(m,s,c,_),this.roundZoom=!0,this.type="video",this.options=s}load(){this._loaded=!1;const m=this.options;this.urls=[];for(const s of m.urls)this.urls.push(this.map._requestManager.transformRequest(s,h.R.Source).url);h.aL(this.urls,(s,c)=>{this._loaded=!0,s?this.fire(new h.z(s)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(m){if(this.video){const s=this.video.seekable;m<s.start(0)||m>s.end(0)?this.fire(new h.z(new h.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=m}}getVideo(){return this.video}onAdd(m){this.map||(this.map=m,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const m=this.map.painter.context,s=m.gl;this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new h.T(m,this.video,s.RGBA8),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(m)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:h.aK,model:class extends h.E{constructor(m,s,c,_){super(),this.id=m,this.type="model",this.models=[],this._loaded=!1,this._options=s}load(){const m=[];for(const s in this._options.models){const c=this._options.models[s],_=h.aN(this.map._requestManager.transformRequest(c.uri,h.R.Model).url).then(v=>{if(!v)return;const x=h.aO(v),E=new h.aP(s,c.position,c.orientation,x);E.computeBoundsAndApplyParent(),this.models.push(E)}).catch(v=>{this.fire(new h.z(new Error(`Could not load model ${s} from ${c.uri}: ${v.message}`)))});m.push(_)}return Promise.allSettled(m).then(()=>{this._loaded=!0,this.fire(new h.A("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(s=>{this.fire(new h.z(new Error(`Could not load models: ${s.message}`)))})}onAdd(m){this.map=m,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(m,s){}serialize(){return{type:"model"}}},"batched-model":class extends h.E{constructor(m,s,c,_){super(),this.type="batched-model",this.id=m,this.tileSize=512,this._options=s,this.tiles=this._options.tiles,this.maxzoom=s.maxzoom||19,this.minzoom=s.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=c,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(_)}onAdd(m){this.map=m,this.load()}reload(){this.cancelTileJSONRequest();const m=h.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(m))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(m){this._loaded=!1,this.fire(new h.A("dataloading",{dataType:"source"}));const s=Array.isArray(this.map._language)?this.map._language.join():this.map._language,c=this.map.getWorldview();this._tileJSONRequest=Zo(this._options,this.map._requestManager,s,c,(_,v)=>{this._tileJSONRequest=null,this._loaded=!0,_?(s&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${s}`),c&&2!==c.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${c}`),this.fire(new h.z(_))):v&&(h.l(this,v),v.bounds&&(this.tileBounds=new Fo(v.bounds,this.minzoom,this.maxzoom)),Oh(v.tiles,this.map._requestManager._customAccessToken),this.fire(new h.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.A("data",{dataType:"source",sourceDataType:"content"}))),m&&m(_)})}hasTransition(){return!1}hasTile(m){return!this.tileBounds||this.tileBounds.contains(m.canonical)}loaded(){return this._loaded}loadTile(m,s){const c=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme)),_={request:this.map._requestManager.transformRequest(c,h.R.Tile),data:void 0,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,tileSize:this.tileSize*m.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:m.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:h.q.devicePixelRatio,promoteId:this.promoteId};if(m.actor&&"expired"!==m.state)if("loading"===m.state)m.reloadCallback=s;else{if(m.buckets){const x=Object.values(m.buckets);for(const E of x)E.dirty=!0;return void(m.state="loaded")}m.request=m.actor.send("reloadTile",_,v.bind(this))}else m.actor=this.dispatcher.getActor(),m.request=m.actor.send("loadTile",_,v.bind(this),void 0,!0);function v(x,E){return m.aborted?s(null):x&&404!==x.status?s(x):(this.map._refreshExpiredTiles&&E&&m.setExpiryData(E),m.loadModelData(E,this.map.painter),m.state="loaded",void s(null))}}serialize(){return h.l({},this._options)}},canvas:class extends h.aK{constructor(m,s,c,_){super(m,s,c,_),s.coordinates?Array.isArray(s.coordinates)&&4===s.coordinates.length&&!s.coordinates.some(v=>!Array.isArray(v)||2!==v.length||v.some(x=>"number"!=typeof x))||this.fire(new h.z(new h.V(`sources.${m}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new h.z(new h.V(`sources.${m}`,null,'missing required property "coordinates"'))),s.animate&&"boolean"!=typeof s.animate&&this.fire(new h.z(new h.V(`sources.${m}`,null,'optional "animate" property must be a boolean value'))),s.canvas?"string"==typeof s.canvas||s.canvas instanceof HTMLCanvasElement||this.fire(new h.z(new h.V(`sources.${m}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new h.z(new h.V(`sources.${m}`,null,'missing required property "canvas"'))),this.options=s,this.animate=void 0===s.animate||s.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new h.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(m){this.map=m,this.load(),this.canvas&&this.animate&&this.play()}onRemove(m){this.pause()}prepare(){let m=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,m=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,m=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const s=this.map.painter.context;this.texture?!m&&!this._playing||this.texture instanceof h.aM||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new h.T(s,this.canvas,s.gl.RGBA8,{premultiply:!0}),this._prepareData(s)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const m of[this.canvas.width,this.canvas.height])if(isNaN(m)||m<=0)return!0;return!1}},custom:class extends h.E{constructor(m,s,c,_){super(),this.id=m,this.type="custom",this._dataType="raster",this._dispatcher=c,this._implementation=s,this.setEventedParent(_),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new h.z(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new h.z(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Fo(this._implementation.bounds,this.minzoom,this.maxzoom)),s.update=this._update.bind(this),s.clearTiles=this._clearTiles.bind(this),s.coveringTiles=this._coveringTiles.bind(this),h.l(this,h.aA(s,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return h.aA(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new h.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(m){this.map=m,this._loaded=!1,this.fire(new h.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(m),this.load()}onRemove(m){this._implementation.onRemove&&this._implementation.onRemove(m)}hasTile(m){if(this._implementation.hasTile){const{x:s,y:c,z:_}=m.canonical;return this._implementation.hasTile({x:s,y:c,z:_})}return!this.tileBounds||this.tileBounds.contains(m.canonical)}loadTile(m,s){const{x:c,y:_,z:v}=m.tileID.canonical,x=new AbortController;m.request=Promise.resolve(this._implementation.loadTile({x:c,y:_,z:v},{signal:x.signal})).then(function(E){return delete m.request,m.aborted?(m.state="unloaded",s(null)):void 0===E?(m.state="errored",s(null)):null===E?(this.loadTileData(m,{width:this.tileSize,height:this.tileSize,data:null}),m.state="loaded",s(null)):(R=E)instanceof ImageData||R instanceof HTMLCanvasElement||R instanceof ImageBitmap||R instanceof HTMLImageElement?(this.loadTileData(m,E),m.state="loaded",void s(null)):(m.state="errored",s(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var R}.bind(this)).catch(E=>{"AbortError"!==E.name&&(m.state="errored",s(E))}),m.request.cancel=()=>x.abort()}loadTileData(m,s){m.setTexture(s,this.map.painter)}unloadTile(m,s){if(m.texture&&m.texture instanceof h.T?(m.destroy(!0),m.texture&&m.texture instanceof h.T&&this.map.painter.saveTileTexture(m.texture)):m.destroy(),this._implementation.unloadTile){const{x:c,y:_,z:v}=m.tileID.canonical;this._implementation.unloadTile({x:c,y:_,z:v})}s&&s()}abortTile(m,s){m.request&&m.request.cancel&&(m.request.cancel(),delete m.request),s&&s()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(m=>({x:m.canonical.x,y:m.canonical.y,z:m.canonical.z}))}_clearTiles(){const m=h.C(this.id,this.scope);this.map.style.clearSource(m)}_update(){this.fire(new h.A("data",{dataType:"source",sourceDataType:"content"}))}}},Zp=function(m,s,c,_){const v=new Ud[s.type](m,s,c,_);if(v.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${v.id}`);return h.aQ(["load","abort","unload","serialize","prepare"],v),v};function Ru(m,s,c=""){return`${c}:${s.id||""}:${s.layer.id}:${function(_){if("layerId"in _)return`layer:${_.layerId}`;{const{featuresetId:v,importId:x}=_;return`featureset:${v}${x?`:import:${x}`:""}`}}(m.target)}`}function Vl(m,s,c,_=""){if(m.uniqueFeatureID){const v=Ru(m,s,_);if(c.has(v))return!0;c.add(v)}return!1}function hv(m,s,c,_,v=!1){const x=s.sourceCache.transform,E=s.sourceCache.tilesIn(m,s.has3DLayers,v);E.sort(pv);const R=[];for(const F of E){const N=F.tile.queryRenderedFeatures(s,F,c,_,x,v);Object.keys(N).length&&R.push({wrappedTileID:F.tile.tileID.wrapped().key,queryResults:N})}return 0===R.length?{}:function(F){const N={},z={};for(const U of F){const j=U.queryResults,W=U.wrappedTileID,ne=z[W]=z[W]||{};for(const J in j){const oe=j[J],se=ne[J]=ne[J]||{},fe=N[J]=N[J]||[];for(const be of oe)se[be.featureIndex]||(se[be.featureIndex]=!0,fe.push(be))}}return N}(R)}function ho(m,s,c,_,v){const x={},E=_.queryRenderedSymbols(m),R=[];for(const F of Object.keys(E).map(Number))R.push(v[F]);R.sort(pv);for(const F of R){const N=F.featureIndex.lookupSymbolFeatures(E[F.bucketInstanceId],F.bucketIndex,F.sourceLayerIndex,s,c);for(const z in N){const U=x[z]=x[z]||[],j=N[z];j.sort((W,ne)=>{const J=F.featureSortOrder;if(J){const oe=J.indexOf(W.featureIndex);return J.indexOf(ne.featureIndex)-oe}return ne.featureIndex-W.featureIndex});for(const W of j)U.push(W)}}return x}function _x(m,s){const c=m.getRenderableIds().map(x=>m.getTileByID(x)),_=[],v={};for(let x=0;x<c.length;x++){const E=c[x],R=E.tileID.canonical.key;v[R]||(v[R]=!0,E.querySourceFeatures(_,s))}return _}function pv(m,s){const c=m.tileID,_=s.tileID;return c.overscaledZ-_.overscaledZ||c.canonical.y-_.canonical.y||c.wrap-_.wrap||c.canonical.x-_.canonical.x}function gr(m,s){const c={};if(!s)return c;for(const _ of m){const v=_.layerIds.map(x=>s.getLayer(x)).filter(Boolean);if(0!==v.length){_.layers=v,_.stateDependentLayerIds&&(_.stateDependentLayers=_.stateDependentLayerIds.map(x=>v.filter(E=>E.id===x)[0]));for(const x of v)c[x.fqid]=_}}return c}const _c=new Uint16Array(8184);for(let m=0;m<2046;m++){let s=m+2,c=0,_=0,v=0,x=0,E=0,R=0;for(1&s?v=x=E=32:c=_=R=32;(s>>=1)>1;){const N=c+v>>1,z=_+x>>1;1&s?(v=c,x=_,c=E,_=R):(c=v,_=x,v=E,x=R),E=N,R=z}const F=4*m;_c[F+0]=c,_c[F+1]=_,_c[F+2]=v,_c[F+3]=x}const ll=new Uint16Array(2178),da=new Uint8Array(1089),ur=new Uint16Array(1089);function vi(m){return 0===m?-.03125:32===m?.03125:0}const Pu={type:2,extent:h.ai,loadGeometry:()=>[[new h.P(0,0),new h.P(h.ai+1,0),new h.P(h.ai+1,h.ai+1),new h.P(0,h.ai+1),new h.P(0,0)]]};class po{constructor(s,c,_,v,x){this.tileID=s,this.uid=h.aW(),this.uses=0,this.tileSize=c,this.tileZoom=_,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=x,v&&v.style&&(this._lastUpdatedBrightness=v.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",v&&v.transform&&(this.projection=v.transform.projection)}registerFadeDuration(s){const c=s+this.timeAdded;c<h.q.now()||this.fadeEndTime&&c<this.fadeEndTime||(this.fadeEndTime=c)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=h.aR(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(s,c,_){if(this.unloadVectorData(),this.state="loaded",s){s.featureIndex&&(this.latestFeatureIndex=s.featureIndex,s.rawTileData?(this.latestRawTileData=s.rawTileData,this.latestFeatureIndex.rawTileData=s.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=s.collisionBoxArray,this.buckets=gr(s.buckets,c.style),this.hasSymbolBuckets=!1;for(const v in this.buckets){const x=this.buckets[v];if(x instanceof h.aY){if(this.hasSymbolBuckets=!0,!_)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const v in this.buckets){const x=this.buckets[v];if(x instanceof h.aY&&x.hasRTLText){this.hasRTLText=!0,h.aZ();break}}this.queryPadding=0;for(const v in this.buckets){const x=this.buckets[v],E=c.style.getOwnLayer(v);if(!E)continue;const R=E.queryRadius(x);this.queryPadding=Math.max(this.queryPadding,R)}s.imageAtlas&&(this.imageAtlas=s.imageAtlas),s.glyphAtlasImage&&(this.glyphAtlasImage=s.glyphAtlasImage),s.lineAtlas&&(this.lineAtlas=s.lineAtlas),this._lastUpdatedBrightness=s.brightness}else this.collisionBoxArray=new h.aX}unloadVectorData(){if(this.hasData()){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(s,c,_){s&&(s.resourceTiming&&(this.resourceTiming=s.resourceTiming),this.buckets=Object.assign({},this.buckets,gr(s.buckets,c.style)),s.featureIndex&&(this.latestFeatureIndex=s.featureIndex))}getBucket(s){return this.buckets[s.fqid]}upload(s){for(const v in this.buckets){const x=this.buckets[v];x.uploadPending()&&x.upload(s)}const c=s.gl,_=this.imageAtlas;_&&!_.uploaded&&(this.imageAtlasTexture=new h.T(s,_.image,c.RGBA8,{useMipmap:!!_.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new h.T(s,this.glyphAtlasImage,c.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new h.T(s,this.lineAtlas.image,c.R8),this.lineAtlas.uploaded=!0)}prepare(s,c,_){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(s,this.imageAtlasTexture,_),!c||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const v=c.style.getBrightness();(this._lastUpdatedBrightness||v)&&(this._lastUpdatedBrightness&&v&&Math.abs(this._lastUpdatedBrightness-v)<.001||(this.updateBuckets(c,this._lastUpdatedBrightness!==v),this._lastUpdatedBrightness=v))}queryRenderedFeatures(s,c,_,v,x,E){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const R=function(F,N){const z=h.ad.mat4.fromScaling([],[.5*F.width,.5*-F.height,1]);return h.ad.mat4.translate(z,z,[1,-1,0]),h.ad.mat4.multiply(z,z,F.calculateProjMatrix(N.toUnwrapped())),Float32Array.from(z)}(x,this.tileID);return this.latestFeatureIndex.query(s,{tilespaceGeometry:c,pixelPosMatrix:R,transform:v,availableImages:_,tileTransform:this.tileTransform})}querySourceFeatures(s,c){const _=this.latestFeatureIndex;if(!_||!_.rawTileData)return;const v=_.loadVTLayers(),x=c?c.sourceLayer:"",E=v._geojsonTileLayer||v[x];if(!E)return;const R=h.a_(c&&c.filter),{z:F,x:N,y:z}=this.tileID.canonical,U={z:F,x:N,y:z};for(let j=0;j<E.length;j++){const W=E.feature(j);if(R.needGeometry){const oe=h.a$(W,!0);if(!R.filter(new h.aa(this.tileID.overscaledZ),oe,this.tileID.canonical))continue}else if(!R.filter(new h.aa(this.tileID.overscaledZ),W))continue;const ne=_.getId(W,x),J=new h.b0(W,F,N,z,ne);J.tile=U,s.push(J)}}loaded(){return"loaded"===this.state||"errored"===this.state}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(s){const c=this.expirationTime;if(s.cacheControl){const _=h.b1(s.cacheControl);_["max-age"]&&(this.expirationTime=Date.now()+1e3*_["max-age"])}else s.expires&&(this.expirationTime=new Date(s.expires).getTime());if(this.expirationTime){const _=Date.now();let v=!1;if(this.expirationTime>_)v=!1;else if(c)if(this.expirationTime<c)v=!0;else{const x=this.expirationTime-c;x?this.expirationTime=_+Math.max(x,3e4):v=!0}else v=!0;v?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}refreshFeatureState(s){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&s&&this.updateBuckets(s)}updateBuckets(s,c){if(!this.latestFeatureIndex||!s.style)return;const _=this.latestFeatureIndex.loadVTLayers(),v=s.style.listImages(),x=s.style.getBrightness();for(const E in this.buckets){if(!s.style.hasLayer(E))continue;const R=this.buckets[E],F=R.layers[0],N=F.sourceLayer||"_geojsonTileLayer",z=_[N],U=s.style.getLayerSourceCache(F);let j={};U&&(j=U._state.getState(N,void 0));const W=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},ne=Object.keys(j).length>0&&!c;ne&&!R.stateDependentLayers.length&&!c||R.update(j,z,v,W,ne?R.stateDependentLayers:R.layers,c,x),(R instanceof h.b2||R instanceof h.b3)&&s._terrain&&s._terrain.enabled&&U&&R.uploadPending()&&s._terrain._clearRenderCacheForTile(U.id,this.tileID);const J=s&&s.style&&s.style.getOwnLayer(E);J&&(this.queryPadding=Math.max(this.queryPadding,J.queryRadius(R)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<h.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(s){this.symbolFadeHoldUntil=h.q.now()+s}setTexture(s,c){const _=c.context,v=_.gl;this.texture=this.texture||c.getTileTexture(s.width),this.texture&&this.texture instanceof h.T?this.texture.update(s):(this.texture=new h.T(_,s,v.RGBA8,{useMipmap:!0}),this.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE))}setDependencies(s,c){const _={};for(const v of c)_[v]=!0;this.dependencies[s]=_}hasDependency(s,c){for(const _ of s){const v=this.dependencies[_];if(v)for(const x of c)if(v[x])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(s,c){if(!c||"mercator"===c.name||this._tileDebugBuffer)return;const _=h.b4(Pu,this.tileID.canonical,this.tileTransform)[0],v=new h.b5,x=new h.b6;for(let E=0;E<_.length;E++){const{x:R,y:F}=_[E];v.emplaceBack(R,F),x.emplaceBack(E)}x.emplaceBack(0),this._tileDebugIndexBuffer=s.createIndexBuffer(x),this._tileDebugBuffer=s.createVertexBuffer(v,h.b7.members),this._tileDebugSegments=h.b8.simpleSegment(0,0,v.length,x.length)}_makeTileBoundsBuffers(s,c){if(this._tileBoundsBuffer||!c||"mercator"===c.name)return;const _=h.b4(Pu,this.tileID.canonical,this.tileTransform)[0];let v,x;if(this.isRaster){const E=function(R,F){const N=h.aR(R,F),z=Math.pow(2,R.z);for(let oe=0;oe<33;oe++)for(let se=0;se<33;se++){const fe=h.aS((R.x+(se+vi(se))/32)/z),be=h.aT((R.y+(oe+vi(oe))/32)/z),ve=F.project(fe,be),we=33*oe+se;ll[2*we+0]=Math.round((ve.x*N.scale-N.x)*h.ai),ll[2*we+1]=Math.round((ve.y*N.scale-N.y)*h.ai)}da.fill(0),ur.fill(0);for(let oe=2045;oe>=0;oe--){const se=4*oe,fe=_c[se+0],be=_c[se+1],ve=_c[se+2],we=_c[se+3],Ee=fe+ve>>1,De=be+we>>1,Me=Ee+De-be,ke=De+fe-Ee,Oe=33*be+fe,et=33*we+ve,qe=33*De+Ee,ot=Math.hypot((ll[2*Oe+0]+ll[2*et+0])/2-ll[2*qe+0],(ll[2*Oe+1]+ll[2*et+1])/2-ll[2*qe+1])>=16;da[qe]=da[qe]||(ot?1:0),oe<1022&&(da[qe]=da[qe]||da[33*(be+ke>>1)+(fe+Me>>1)]||da[33*(we+ke>>1)+(ve+Me>>1)])}const U=new h.aU,j=new h.aV;let W=0;function ne(oe,se){const fe=33*se+oe;return 0===ur[fe]&&(U.emplaceBack(ll[2*fe+0],ll[2*fe+1],oe*h.ai/32,se*h.ai/32),ur[fe]=++W),ur[fe]-1}function J(oe,se,fe,be,ve,we){const Ee=oe+fe>>1,De=se+be>>1;if(Math.abs(oe-ve)+Math.abs(se-we)>1&&da[33*De+Ee])J(ve,we,oe,se,Ee,De),J(fe,be,ve,we,Ee,De);else{const Me=ne(oe,se),ke=ne(fe,be),Oe=ne(ve,we);j.emplaceBack(Me,ke,Oe)}}return J(0,0,32,32,32,0),J(32,32,0,0,0,32),{vertices:U,indices:j}}(this.tileID.canonical,c);v=E.vertices,x=E.indices}else{v=new h.aU,x=new h.aV;for(const{x:R,y:F}of _)v.emplaceBack(R,F,0,0);const E=h.b9(v.int16,void 0,4);for(let R=0;R<E.length;R+=3)x.emplaceBack(E[R],E[R+1],E[R+2])}this._tileBoundsBuffer=s.createVertexBuffer(v,h.ba.members),this._tileBoundsIndexBuffer=s.createIndexBuffer(x),this._tileBoundsSegments=h.b8.simpleSegment(0,0,v.length,x.length)}_makeGlobeTileDebugBuffers(s,c){const _=c.projection;if(!_||"globe"!==_.name||c.freezeTileCoverage)return;const v=this.tileID.canonical,x=h.bb(v,c),E=h.bc(x),R=h.ag(c.zoom);let F;R>0&&(F=h.ad.mat4.invert(new Float64Array(16),c.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(s,v,c,E,F,R),this._makeGlobeTileDebugTextBuffer(s,v,c,E,F,R)}_globePoint(s,c,_,v,x,E,R){let F=h.bd(s,c,_);if(E){const N=1<<_.z,z=h.av(v.center.lng),U=h.aC(v.center.lat),j=(_.x+.5)/N-z;let W=0;j>.5?W=-1:j<-.5&&(W=1);let ne=(s/h.ai+_.x)/N+W,J=(c/h.ai+_.y)/N;ne=(ne-z)*v._pixelsPerMercatorPixel+z,J=(J-U)*v._pixelsPerMercatorPixel+U;const oe=[ne*v.worldSize,J*v.worldSize,0];h.ad.vec3.transformMat4(oe,oe,E),F=h.be(F,oe,R)}return h.ad.vec3.transformMat4(F,F,x)}_makeGlobeTileDebugBorderBuffer(s,c,_,v,x,E){const R=new h.b5,F=new h.b6,N=new h.bf,z=(j,W,ne,J,oe)=>{const se=(ne-j)/(oe-1),fe=(J-W)/(oe-1),be=R.length;for(let ve=0;ve<oe;ve++){const we=j+ve*se,Ee=W+ve*fe;R.emplaceBack(we,Ee);const De=this._globePoint(we,Ee,c,_,v,x,E);N.emplaceBack(De[0],De[1],De[2]),F.emplaceBack(be+ve)}},U=h.ai;z(0,0,U,0,16),z(U,0,U,U,16),z(U,U,0,U,16),z(0,U,0,0,16),this._tileDebugIndexBuffer=s.createIndexBuffer(F),this._tileDebugBuffer=s.createVertexBuffer(R,h.b7.members),this._globeTileDebugBorderBuffer=s.createVertexBuffer(N,h.bg.members),this._tileDebugSegments=h.b8.simpleSegment(0,0,R.length,F.length)}_makeGlobeTileDebugTextBuffer(s,c,_,v,x,E){const R=h.ai/4,F=new h.b5,N=new h.aV,z=new h.bf,U=25;N.reserve(32),F.reserve(U),z.reserve(U);const j=(W,ne)=>U*W+ne;for(let W=0;W<U;W++){const ne=W*R;for(let J=0;J<U;J++){const oe=J*R;F.emplaceBack(oe,ne);const se=this._globePoint(oe,ne,c,_,v,x,E);z.emplaceBack(se[0],se[1],se[2])}}for(let W=0;W<4;W++)for(let ne=0;ne<4;ne++){const J=j(W,ne),oe=j(W,ne+1),se=j(W+1,ne),fe=j(W+1,ne+1);N.emplaceBack(J,oe,se),N.emplaceBack(se,oe,fe)}this._tileDebugTextIndexBuffer=s.createIndexBuffer(N),this._tileDebugTextBuffer=s.createVertexBuffer(F,h.b7.members),this._globeTileDebugTextBuffer=s.createVertexBuffer(z,h.bg.members),this._tileDebugTextSegments=h.b8.simpleSegment(0,0,U,32)}destroy(s=!1){for(const c in this.buckets)this.buckets[c].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!s&&this.texture&&this.texture instanceof h.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}h.bh.setPbf(h.bi);class ua extends po{constructor(s,c,_,v,x){super(s,c,_,v,x),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(s){return this._mrt&&this._mrt.getLayer(s)}setTexture(s,c){const _=c.context,v=_.gl;this.texture=this.texture||c.getTileTexture(s.width),this.texture&&this.texture instanceof h.T?this.texture.update(s,{premultiply:!1}):this.texture=new h.T(_,s,v.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(s=16384,c){const _=this._mrt=new h.bh(30),v=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(s-1)}});return this.entireBuffer=null,this.request=h.bj(v,(x,E,R,F)=>{if(x)c(x);else try{const N=_.getHeaderLength(E);if(N>s)return void(this.request=this.fetchHeader(N,c));_.parseHeader(E),this._isHeaderLoaded=!0;let z=0;for(const U of Object.values(_.layers))z=Math.max(z,U.dataIndex[U.dataIndex.length-1].lastByte);E.byteLength>=z&&(this.entireBuffer=E),c(null,this.entireBuffer||E,R,F)}catch(N){c(N)}}),this.request}fetchBand(s,c,_){const v=this._mrt;if(!this._isHeaderLoaded||!v)return void _(new Error("Tile header is not ready"));const x=this.actor;if(!x)return void _(new Error("Can't fetch tile band without an actor"));let E;const R=(U,j)=>{E.complete(U,j),U?_(U):(this.updateTextureDescriptor(s,c),_(null,this.textureDescriptor&&this.textureDescriptor.img))},F=(U,j)=>{if(U)return _(U);const W=x.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:j,task:E},R,void 0,!0);this._workQueue.push(()=>{W&&W.cancel(),E.cancel()})},N=v.getLayer(s);if(!N)return void _(new Error(`Unknown sourceLayer "${s}"`));if(N.hasDataForBand(c))return this.updateTextureDescriptor(s,c),void _(null,this.textureDescriptor?this.textureDescriptor.img:null);const z=N.getDataRange([c]);if(E=v.createDecodingTask(z),!E||E.tasks.length)if(this.flushQueues(),this.entireBuffer)F(null,this.entireBuffer.slice(z.firstByte,z.lastByte+1));else{const U=Object.assign({},this.requestParams,{headers:{Range:`bytes=${z.firstByte}-${z.lastByte}`}}),j=h.bj(U,F);this._fetchQueue.push(()=>{j.cancel(),E.cancel()})}else _(null)}updateNeeded(s,c){return(!this.textureDescriptor||this.textureDescriptor.band!==c||this.textureDescriptor.layer!==s)&&"errored"!==this.state}updateTextureDescriptor(s,c){if(!this._mrt)return;const _=this._mrt.getLayer(s);if(!_||!_.hasBand(c)||!_.hasDataForBand(c))return;const{bytes:v,tileSize:x,buffer:E,offset:R,scale:F}=_.getBandView(c),N=x+2*E,z=new h.r({width:N,height:N},v),U=this.texture;U&&U instanceof h.T&&U.update(z,{premultiply:!1}),this.textureDescriptor={layer:s,band:c,img:z,buffer:E,offset:R,tileSize:x,format:_.pixelFormat,mix:[F,256*F,65536*F,16777216*F]}}}class fv{constructor(s,c){this.max=s,this.onRemove=c,this.reset()}reset(){for(const s in this.data)for(const c of this.data[s])c.timeout&&clearTimeout(c.timeout),this.onRemove(c.value);return this.data={},this.order=[],this}add(s,c,_){const v=s.wrapped().key;void 0===this.data[v]&&(this.data[v]=[]);const x={value:c,timeout:void 0};if(void 0!==_&&(x.timeout=setTimeout(()=>{this.remove(s,x)},_)),this.data[v].push(x),this.order.push(v),this.order.length>this.max){const E=this._getAndRemoveByKey(this.order[0]);E&&this.onRemove(E)}return this}has(s){return s.wrapped().key in this.data}getAndRemove(s){return this.has(s)?this._getAndRemoveByKey(s.wrapped().key):null}_getAndRemoveByKey(s){const c=this.data[s].shift();return c.timeout&&clearTimeout(c.timeout),0===this.data[s].length&&delete this.data[s],this.order.splice(this.order.indexOf(s),1),c.value}getByKey(s){const c=this.data[s];return c?c[0].value:null}get(s){return this.has(s)?this.data[s.wrapped().key][0].value:null}remove(s,c){if(!this.has(s))return this;const _=s.wrapped().key,v=void 0===c?0:this.data[_].indexOf(c),x=this.data[_][v];return this.data[_].splice(v,1),x.timeout&&clearTimeout(x.timeout),0===this.data[_].length&&delete this.data[_],this.onRemove(x.value),this.order.splice(this.order.indexOf(_),1),this}setMaxSize(s){for(this.max=s;this.order.length>this.max;){const c=this._getAndRemoveByKey(this.order[0]);c&&this.onRemove(c)}return this}filter(s){const c=[];for(const _ in this.data)for(const v of this.data[_])s(v.value)||c.push(v);for(const _ of c)this.remove(_.value.tileID,_)}}class mv{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(s,c,_){const v=String(c);if(this.stateChanges[s]=this.stateChanges[s]||{},this.stateChanges[s][v]=this.stateChanges[s][v]||{},h.l(this.stateChanges[s][v],_),null===this.deletedStates[s]){this.deletedStates[s]={};for(const x in this.state[s])x!==v&&(this.deletedStates[s][x]=null)}else if(this.deletedStates[s]&&null===this.deletedStates[s][v]){this.deletedStates[s][v]={};for(const x in this.state[s][v])_[x]||(this.deletedStates[s][v][x]=null)}else for(const x in _)this.deletedStates[s]&&this.deletedStates[s][v]&&null===this.deletedStates[s][v][x]&&delete this.deletedStates[s][v][x]}removeFeatureState(s,c,_){if(null===this.deletedStates[s])return;const v=String(c);if(this.deletedStates[s]=this.deletedStates[s]||{},_&&void 0!==c)null!==this.deletedStates[s][v]&&(this.deletedStates[s][v]=this.deletedStates[s][v]||{},this.deletedStates[s][v][_]=null);else if(void 0!==c)if(this.stateChanges[s]&&this.stateChanges[s][v])for(_ in this.deletedStates[s][v]={},this.stateChanges[s][v])this.deletedStates[s][v][_]=null;else this.deletedStates[s][v]=null;else this.deletedStates[s]=null}getState(s,c){const _=this.state[s]||{},v=this.stateChanges[s]||{},x=this.deletedStates[s];if(null===x)return{};if(void 0!==c){const R=String(c),F=h.l({},_[R],v[R]);if(x){const N=x[c];if(null===N)return{};for(const z in N)delete F[z]}return F}const E=h.l({},_,v);if(x)for(const R in x)delete E[R];return E}initializeTileState(s,c){s.refreshFeatureState(c)}coalesceChanges(s,c){const _={};for(const v in this.stateChanges){this.state[v]=this.state[v]||{};const x={};for(const E in this.stateChanges[v])this.state[v][E]||(this.state[v][E]={}),h.l(this.state[v][E],this.stateChanges[v][E]),x[E]=this.state[v][E];_[v]=x}for(const v in this.deletedStates){this.state[v]=this.state[v]||{};const x={};if(null===this.deletedStates[v])for(const E in this.state[v])x[E]={},this.state[v][E]={};else for(const E in this.deletedStates[v]){if(null===this.deletedStates[v][E])this.state[v][E]={};else if(this.state[v][E])for(const R of Object.keys(this.deletedStates[v][E]))delete this.state[v][E][R];x[E]=this.state[v][E]}_[v]=_[v]||{},h.l(_[v],x)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(_).length)for(const v in s)s[v].refreshFeatureState(c)}}class cs extends h.E{constructor(s,c,_){super(),this.id=s,this._onlySymbols=_,c.on("data",v=>{"source"===v.dataType&&"metadata"===v.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===v.dataType&&"content"===v.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),c.on("error",()=>{this._sourceErrored=!0}),this._source=c,this._tiles={},this._cache=new fv(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new mv,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"raster-array"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(s){this.map=s,this._minTileCacheSize=void 0===this._minTileCacheSize&&s?s._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&s?s._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const s in this._tiles)if(!this._tiles[s].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const s=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,s&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(s,c){return s.isSymbolTile=this._onlySymbols,s.isExtraShadowCaster=this._shadowCasterTiles[s.tileID.key],this._source.loadTile(s,c)}_unloadTile(s){if(this._source.unloadTile)return this._source.unloadTile(s)}_abortTile(s){if(this._source.abortTile)return this._source.abortTile(s)}serialize(){return this._source.serialize()}prepare(s){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const c in this._tiles){const _=this._tiles[c];_.upload(s),_.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(s=>s.tileID).sort(Yi).map(s=>s.key)}getRenderableIds(s,c){const _=[];for(const v in this._tiles)this._isIdRenderable(+v,s,c)&&_.push(this._tiles[v]);return s?_.sort((v,x)=>{const E=v.tileID,R=x.tileID,F=new h.P(E.canonical.x,E.canonical.y)._rotate(this.transform.angle),N=new h.P(R.canonical.x,R.canonical.y)._rotate(this.transform.angle);return E.overscaledZ-R.overscaledZ||N.y-F.y||N.x-F.x}).map(v=>v.tileID.key):_.map(v=>v.tileID).sort(Yi).map(v=>v.key)}hasRenderableParent(s){const c=this.findLoadedParent(s,0);return!!c&&this._isIdRenderable(c.tileID.key)}_isIdRenderable(s,c,_){return this._tiles[s]&&this._tiles[s].hasData()&&!this._coveredTiles[s]&&(c||!this._tiles[s].holdingForFade())&&(_||!this._shadowCasterTiles[s])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const s in this._tiles)"errored"!==this._tiles[s].state&&this._reloadTile(+s,"reloading")}}_reloadTile(s,c){const _=this._tiles[s];_&&("loading"!==_.state&&(_.state=c),this._loadTile(_,this._tileLoaded.bind(this,_,s,c)))}_tileLoaded(s,c,_,v){if(v)if(s.state="errored",404!==v.status)this._source.fire(new h.z(v,{tile:s}));else{if(this._source.fire(new h.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:s})),!(s.tileID.key in this._loadedParentTiles))return;if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const x=this.map.painter.terrain;this.update(this.transform,x.getScaledDemTileSize(),!0),x.resetTileLookupCache(this.id)}else this.update(this.transform)}else s.timeAdded=h.q.now(),"expired"===_&&(s.refreshedUponExpiration=!0),this._setTileReloadTimer(c,s),"raster-dem"===this._source.type&&s.dem&&this._backfillDEM(s),this._state.initializeTileState(s,this.map?this.map.painter:null),this._source.fire(new h.A("data",{dataType:"source",tile:s,coord:s.tileID,sourceCacheId:this.id}))}_backfillDEM(s){const c=this.getRenderableIds();for(let v=0;v<c.length;v++){const x=c[v];if(s.neighboringTiles&&s.neighboringTiles[x]){const E=this.getTileByID(x);_(s,E),_(E,s)}}function _(v,x){if(!v.dem||v.dem.borderReady)return;v.needsHillshadePrepare=!0,v.needsDEMTextureUpload=!0;let E=x.tileID.canonical.x-v.tileID.canonical.x;const R=x.tileID.canonical.y-v.tileID.canonical.y,F=Math.pow(2,v.tileID.canonical.z),N=x.tileID.key;0===E&&0===R||Math.abs(R)>1||(Math.abs(E)>1&&(1===Math.abs(E+F)?E+=F:1===Math.abs(E-F)&&(E-=F)),x.dem&&v.dem&&(v.dem.backfillBorder(x.dem,E,R),v.neighboringTiles&&v.neighboringTiles[N]&&(v.neighboringTiles[N].backfilled=!0)))}}getTile(s){return this.getTileByID(s.key)}getTileByID(s){return this._tiles[s]}_retainLoadedChildren(s,c,_,v){for(const x in this._tiles){let E=this._tiles[x];if(v[x]||!E.hasData()||E.tileID.overscaledZ<=c||E.tileID.overscaledZ>_)continue;let R=E.tileID;for(;E&&E.tileID.overscaledZ>c+1;){const N=E.tileID.scaledTo(E.tileID.overscaledZ-1);E=this._tiles[N.key],E&&E.hasData()&&(R=N)}let F=R;for(;F.overscaledZ>c;)if(F=F.scaledTo(F.overscaledZ-1),s[F.key]){v[R.key]=R;break}}}findLoadedParent(s,c){if(s.key in this._loadedParentTiles){const _=this._loadedParentTiles[s.key];return _&&_.tileID.overscaledZ>=c?_:null}for(let _=s.overscaledZ-1;_>=c;_--){const v=s.scaledTo(_),x=this._getLoadedTile(v);if(x)return x}}_getLoadedTile(s){const c=this._tiles[s.key];return c&&c.hasData()?c:this._cache.getByKey(this._source.reparseOverscaled?s.wrapped().key:s.canonical.key)}updateCacheSize(s,c){c=c||this._source.tileSize;const _=Math.ceil(s.width/c)+1,v=Math.ceil(s.height/c)+1,x=Math.floor(_*v*5),E="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,x):x,R="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,E):E;this._cache.setMaxSize(R)}handleWrapJump(s){const c=Math.round((s-(void 0===this._prevLng?s:this._prevLng))/360);if(this._prevLng=s,c){const _={};for(const v in this._tiles){const x=this._tiles[v];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+c),_[x.tileID.key]=x}this._tiles=_;for(const v in this._timers)clearTimeout(this._timers[v]),delete this._timers[v];for(const v in this._tiles)this._setTileReloadTimer(+v,this._tiles[v])}}update(s,c,_,v){if(this.transform=s,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!_)return;this.updateCacheSize(s,c),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const x="batched-model"===this._source.type;let E,R=this._source.maxzoom;const F=this.map&&this.map.painter?this.map.painter._terrain:null;if(F&&F.sourceCache===this&&F.attenuationRange()){const U=F.attenuationRange()[0],j=Math.floor(U)-Math.log2(F.getDemUpscale());R>j&&(R=j)}if(this.used||this.usedForTerrain){if(this._source.tileID)E=s.getVisibleUnwrappedCoordinates(this._source.tileID).map(U=>new h.aH(U.canonical.z,U.wrap,U.canonical.z,U.canonical.x,U.canonical.y));else if(0!==this.tileCoverLift){const U=s.clone();U.tileCoverLift=this.tileCoverLift,E=U.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:R,roundZoom:this._source.roundZoom&&!_,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:x}),this._source.minzoom<=1&&"globe"===s.projection.name&&(E.push(new h.aH(1,0,1,0,0)),E.push(new h.aH(1,0,1,1,0)),E.push(new h.aH(1,0,1,0,1)),E.push(new h.aH(1,0,1,1,1)))}else if(E=s.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:R,roundZoom:this._source.roundZoom&&!_,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:x}),this._source.hasTile){const U=this._source.hasTile.bind(this._source);E=E.filter(j=>U(j))}}else E=[];if(E.length>0&&this.castsShadows&&v&&"globe"!==this.transform.projection.name&&!this.usedForTerrain&&!gv(this._source.type)){const U=s.coveringZoomLevel({tileSize:c||this._source.tileSize,roundZoom:this._source.roundZoom&&!_}),j=Math.min(U,this._source.maxzoom);if(x){const W=s.extendTileCover(E,j);for(const ne of W)E.push(ne)}else{const W=s.extendTileCover(E,j,v);for(const ne of W)this._shadowCasterTiles[ne.key]=!0,E.push(ne)}}const N=this._updateRetainedTiles(E);if(gv(this._source.type)&&0!==E.length){const U={},j={},W=Object.keys(N);for(const J of W){const oe=N[J],se=this._tiles[J];if(!se||se.fadeEndTime&&se.fadeEndTime<=h.q.now())continue;const fe=this.findLoadedParent(oe,Math.max(oe.overscaledZ-cs.maxOverzooming,this._source.minzoom));fe&&(this._addTile(fe.tileID),U[fe.tileID.key]=fe.tileID),j[J]=oe}const ne=E[E.length-1].overscaledZ;for(const J in this._tiles){const oe=this._tiles[J];if(N[J]||!oe.hasData())continue;let se=oe.tileID;for(;se.overscaledZ>ne;){se=se.scaledTo(se.overscaledZ-1);const fe=this._tiles[se.key];if(fe&&fe.hasData()&&j[se.key]){N[J]=oe.tileID;break}}}for(const J in U)N[J]||(this._coveredTiles[J]=!0,N[J]=U[J])}for(const U in N)this._tiles[U].clearFadeHold();const z=h.bk(this._tiles,N);for(const U of z){const j=this._tiles[U];j.hasSymbolBuckets&&!j.holdingForFade()?j.setHoldDuration(this.map._fadeDuration):j.hasSymbolBuckets&&!j.symbolFadeFinished()||this._removeTile(+U)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const s in this._tiles)this._tiles[s].holdingForFade()&&this._removeTile(+s)}_updateRetainedTiles(s){const c={};if(0===s.length)return c;const _={},v=s.reduce((N,z)=>Math.min(N,z.overscaledZ),1/0),x=s[0].overscaledZ,E=Math.max(x-cs.maxOverzooming,this._source.minzoom),R=Math.max(x+cs.maxUnderzooming,this._source.minzoom),F={};for(const N of s){const z=this._addTile(N);c[N.key]=N,z.hasData()||v<this._source.maxzoom&&(F[N.key]=N)}this._retainLoadedChildren(F,v,R,c);for(const N of s){let z=this._tiles[N.key];if(z.hasData())continue;if(N.canonical.z>=this._source.maxzoom){const j=N.children(this._source.maxzoom)[0],W=this.getTile(j);if(W&&W.hasData()){c[j.key]=j;continue}}else{const j=N.children(this._source.maxzoom);if(c[j[0].key]&&c[j[1].key]&&c[j[2].key]&&c[j[3].key])continue}let U=z.wasRequested();for(let j=N.overscaledZ-1;j>=E;--j){const W=N.scaledTo(j);if(_[W.key]||(_[W.key]=!0,z=this.getTile(W),!z&&U&&(z=this._addTile(W)),z&&(c[W.key]=W,U=z.wasRequested(),z.hasData())))break}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const s in this._tiles){const c=[];let _,v=this._tiles[s].tileID;for(;v.overscaledZ>0;){if(v.key in this._loadedParentTiles){_=this._loadedParentTiles[v.key];break}c.push(v.key);const x=v.scaledTo(v.overscaledZ-1);if(_=this._getLoadedTile(x),_)break;v=x}for(const x of c)this._loadedParentTiles[x]=_}}_addTile(s){let c=this._tiles[s.key];if(c)return!0!==c.isExtraShadowCaster||this._shadowCasterTiles[s.key]||this._reloadTile(s.key,"reloading"),c;c=this._cache.getAndRemove(s),c&&(this._setTileReloadTimer(s.key,c),c.tileID=s,this._state.initializeTileState(c,this.map?this.map.painter:null),this._cacheTimers[s.key]&&(clearTimeout(this._cacheTimers[s.key]),delete this._cacheTimers[s.key],this._setTileReloadTimer(s.key,c)));const _=!!c;if(!_){const v=this.map?this.map.painter:null,x=this._source.tileSize*s.overscaleFactor();c="raster-array"===this._source.type?new ua(s,x,this.transform.tileZoom,v,this._isRaster):new po(s,x,this.transform.tileZoom,v,this._isRaster),this._loadTile(c,this._tileLoaded.bind(this,c,s.key,c.state))}return c?(c.uses++,this._tiles[s.key]=c,_||this._source.fire(new h.A("dataloading",{tile:c,coord:c.tileID,dataType:"source"})),c):null}_setTileReloadTimer(s,c){s in this._timers&&(clearTimeout(this._timers[s]),delete this._timers[s]);const _=c.getExpiryTimeout();_&&(this._timers[s]=setTimeout(()=>{this._reloadTile(s,"expired"),delete this._timers[s]},_))}_removeTile(s){const c=this._tiles[s];c&&(c.uses--,delete this._tiles[s],this._timers[s]&&(clearTimeout(this._timers[s]),delete this._timers[s]),c.uses>0||(c.hasData()&&"reloading"!==c.state||"empty"===c.state?this._cache.add(c.tileID,c,c.getExpiryTimeout()):(c.aborted=!0,this._abortTile(c),this._unloadTile(c))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const s in this._tiles)this._removeTile(+s);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(s,c,_){const v=[],x=this.transform;if(!x)return v;const E="globe"===x.projection.name,R=h.av(x.center.lng);for(const F in this._tiles){const N=this._tiles[F];if(_&&N.clearQueryDebugViz(),N.holdingForFade())continue;let z;if(E){const U=N.tileID.canonical;if(0===U.z){const j=[Math.abs(h.ay(R,..._n(U,-1))-R),Math.abs(h.ay(R,..._n(U,1))-R)];z=[0,2*j.indexOf(Math.min(...j))-1]}else{const j=[Math.abs(h.ay(R,..._n(U,-1))-R),Math.abs(h.ay(R,..._n(U,0))-R),Math.abs(h.ay(R,..._n(U,1))-R)];z=[j.indexOf(Math.min(...j))-1]}}else z=[0];for(const U of z){const j=s.containsTile(N,x,c,U);j&&v.push(j)}}return v}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(s){return this._getRenderableCoordinates(s)}_getRenderableCoordinates(s,c){const _=this.getRenderableIds(s,c).map(x=>this._tiles[x].tileID),v="globe"===this.transform.projection.name;for(const x of _)x.projMatrix=this.transform.calculateProjMatrix(x.toUnwrapped()),x.expandedProjMatrix=v?this.transform.calculateProjMatrix(x.toUnwrapped(),!1,!0):x.projMatrix;return _}sortCoordinatesByDistance(s){const c=s.slice(),_=this.transform._camera.position,v=this.transform._camera.forward(),x={};for(const E of c){const R=1/(1<<E.canonical.z);x[E.key]=((E.canonical.x+.5)*R+E.wrap-_[0])*v[0]+((E.canonical.y+.5)*R-_[1])*v[1]-_[2]*v[2]}return c.sort((E,R)=>x[E.key]-x[R.key]),c}hasTransition(){if(this._source.hasTransition())return!0;if(gv(this._source.type))for(const s in this._tiles){const c=this._tiles[s];if(void 0!==c.fadeEndTime&&c.fadeEndTime>=h.q.now())return!0}return!1}setFeatureState(s,c,_){this._state.updateState(s=s||"_geojsonTileLayer",c,_)}removeFeatureState(s,c,_){this._state.removeFeatureState(s=s||"_geojsonTileLayer",c,_)}getFeatureState(s,c){return this._state.getState(s=s||"_geojsonTileLayer",c)}setDependencies(s,c,_){const v=this._tiles[s];v&&v.setDependencies(c,_)}reloadTilesForDependencies(s,c){for(const _ in this._tiles)this._tiles[_].hasDependency(s,c)&&this._reloadTile(+_,"reloading");this._cache.filter(_=>!_.hasDependency(s,c))}_preloadTiles(s,c){if(!this._sourceLoaded){const F=()=>{this._sourceLoaded&&(this._source.off("data",F),this._preloadTiles(s,c))};return void this._source.on("data",F)}const _=new Map,v=Array.isArray(s)?s:[s],x=this.map.painter.terrain,E=this.usedForTerrain&&x?x.getScaledDemTileSize():this._source.tileSize;for(const F of v){const N=F.coveringTiles({tileSize:E,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const z of N)_.set(z.key,z);this.usedForTerrain&&F.updateElevation(!1)}const R=Array.from(_.values());h.bl(R,(F,N)=>{const z=new po(F,this._source.tileSize*F.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(z,U=>{"raster-dem"===this._source.type&&z.dem&&this._backfillDEM(z),N(U,z)})},c)}}function Yi(m,s){const c=Math.abs(2*m.wrap)-+(m.wrap<0),_=Math.abs(2*s.wrap)-+(s.wrap<0);return m.overscaledZ-s.overscaledZ||_-c||s.canonical.y-m.canonical.y||s.canonical.x-m.canonical.x}function gv(m){return"raster"===m||"image"===m||"video"===m||"custom"===m}function _n(m,s){const c=1<<m.z;return[m.x/c+s,(m.x+1)/c+s]}cs.maxOverzooming=10,cs.maxUnderzooming=3;class yx{constructor(s){this.style=s,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const s=!1,c=!1;for(const _ in this.style._mergedLayers){const v=this.style._mergedLayers[_];if("fill-extrusion"===v.type)this.layers.push({layer:v,visible:s,visibilityChanged:c});else if("model"===v.type){const x=this.style.getLayerSource(v);x&&"batched-model"===x.type&&this.layers.push({layer:v,visible:s,visibilityChanged:c})}}}onNewFrame(s){this.layersGotHidden=!1;for(const c of this.layers){const _=c.layer;let v=!1;"fill-extrusion"===_.type?v=!_.isHidden(s)&&_.paint.get("fill-extrusion-opacity")>0:"model"===_.type&&(v=!_.isHidden(s)&&_.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!v&&c.visible,c.visible=v}}updateZOffset(s,c){this.currentBuildingBuckets=[];for(const v of this.layers){const x=v.layer,E=this.style.getLayerSourceCache(x);let R=1;"fill-extrusion"===x.type&&(R=v.visible?x.paint.get("fill-extrusion-vertical-scale"):0);let F=E?E.getTile(c):null;if(!F&&E&&c.canonical.z>E.getSource().minzoom){let N=c.scaledTo(Math.min(E.getSource().maxzoom,c.overscaledZ-1));for(;N.overscaledZ>=E.getSource().minzoom&&(F=E.getTile(N),!F&&0!==N.overscaledZ);)N=N.scaledTo(N.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:F?F.getBucket(x):null,tileID:F?F.tileID:c,verticalScale:R})}s.hasAnyZOffset=!1;let _=!1;for(let v=0;v<s.symbolInstances.length;v++){const x=s.symbolInstances.get(v),E=x.zOffset,R=this._getHeightAtTileOffset(c,x.tileAnchorX,x.tileAnchorY);x.zOffset=R!==Number.NEGATIVE_INFINITY?R:E,_||E===x.zOffset||(_=!0),s.hasAnyZOffset||0===x.zOffset||(s.hasAnyZOffset=!0)}_&&(s.zOffsetBuffersNeedUpload=!0,s.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(s,c,_,v){let x=c,E=_;if(s.canonical.z!==v.canonical.z){const R=v.canonical,F=1/(1<<s.canonical.z-R.z);x=(c+s.canonical.x*h.ai)*F-R.x*h.ai|0,E=(_+s.canonical.y*h.ai)*F-R.y*h.ai|0}return{tileX:x,tileY:E}}_getHeightAtTileOffset(s,c,_){let v,x;for(let E=0;E<this.layers.length;++E){if("fill-extrusion"!==this.layers[E].layer.type)continue;const{bucket:R,tileID:F,verticalScale:N}=this.currentBuildingBuckets[E];if(!R)continue;const{tileX:z,tileY:U}=this._mapCoordToOverlappingTile(s,c,_,F),j=R.getHeightAtTileCoord(z,U);j&&void 0!==j.height&&(j.hidden?v=j.height:x=Math.max(j.height*N,x||0))}if(void 0!==x)return x;for(let E=0;E<this.layers.length;++E){const R=this.layers[E];if("model"!==R.layer.type||!R.visible)continue;const{bucket:F,tileID:N}=this.currentBuildingBuckets[E];if(!F)continue;const{tileX:z,tileY:U}=this._mapCoordToOverlappingTile(s,c,_,N),j=F.getHeightAtTileCoord(z,U);if(j&&!j.hidden)return void 0===j.height&&void 0!==v?Math.min(j.maxHeight,v)*j.verticalScale:j.height?j.height*j.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function _v(m,s){const c={};for(const _ in m)"ref"!==_&&(c[_]=m[_]);return h.bm.forEach(_=>{_ in s&&(c[_]=s[_])}),c}function mm(m){m=m.slice();const s=Object.create(null);for(let c=0;c<m.length;c++)s[m[c].id]=m[c];for(let c=0;c<m.length;c++)"ref"in m[c]&&(m[c]=_v(m[c],s[m[c].ref]));return m}const Ti={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function to(m,s,c){c.push({command:Ti.addSource,args:[m,s[m]]})}function ni(m,s,c){s.push({command:Ti.removeSource,args:[m]}),c[m]=!0}function Xp(m,s,c,_){ni(m,c,_),to(m,s,c)}function rn(m,s,c){let _;for(_ in m[c])if(m[c].hasOwnProperty(_)&&"data"!==_&&!h.bn(m[c][_],s[c][_]))return!1;for(_ in s[c])if(s[c].hasOwnProperty(_)&&"data"!==_&&!h.bn(m[c][_],s[c][_]))return!1;return!0}function Hi(m,s,c,_,v,x){let E;for(E in s=s||{},m=m||{})m.hasOwnProperty(E)&&(h.bn(m[E],s[E])||c.push({command:x,args:[_,E,s[E],v]}));for(E in s)s.hasOwnProperty(E)&&!m.hasOwnProperty(E)&&(h.bn(m[E],s[E])||c.push({command:x,args:[_,E,s[E],v]}))}function Ii(m){return m.id}function Ns(m,s){return m[s.id]=s,m}class Nt{constructor(s,c){this.reset(s,c)}reset(s,c){this.points=s||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(1===this.points.length)return this.points[0];s=h.ay(s,0,1);let c=1,_=this._distances[c];const v=s*this.paddedLength+this.padding;for(;_<v&&c<this._distances.length;)_=this._distances[++c];const x=c-1,E=this._distances[x],R=_-E,F=R>0?(v-E)/R:0;return this.points[x].mult(1-F).add(this.points[c].mult(F))}}class Ni{constructor(s,c,_){const v=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(s/_),this.yCellCount=Math.ceil(c/_);for(let E=0;E<this.xCellCount*this.yCellCount;E++)v.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=c,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,c,_,v,x){this._forEachCell(c,_,v,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(c),this.bboxes.push(_),this.bboxes.push(v),this.bboxes.push(x)}insertCircle(s,c,_,v){this._forEachCell(c-v,_-v,c+v,_+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(c),this.circles.push(_),this.circles.push(v)}_insertBoxCell(s,c,_,v,x,E){this.boxCells[x].push(E)}_insertCircleCell(s,c,_,v,x,E){this.circleCells[x].push(E)}_query(s,c,_,v,x,E){if(_<0||s>this.width||v<0||c>this.height)return!x&&[];const R=[];if(s<=0&&c<=0&&this.width<=_&&this.height<=v){if(x)return!0;for(let F=0;F<this.boxKeys.length;F++)R.push({key:this.boxKeys[F],x1:this.bboxes[4*F],y1:this.bboxes[4*F+1],x2:this.bboxes[4*F+2],y2:this.bboxes[4*F+3]});for(let F=0;F<this.circleKeys.length;F++){const N=this.circles[3*F],z=this.circles[3*F+1],U=this.circles[3*F+2];R.push({key:this.circleKeys[F],x1:N-U,y1:z-U,x2:N+U,y2:z+U})}return E?R.filter(E):R}return this._forEachCell(s,c,_,v,this._queryCell,R,{hitTest:x,seenUids:{box:{},circle:{}}},E),x?R.length>0:R}_queryCircle(s,c,_,v,x){const E=s-_,R=s+_,F=c-_,N=c+_;if(R<0||E>this.width||N<0||F>this.height)return!v&&[];const z=[];return this._forEachCell(E,F,R,N,this._queryCellCircle,z,{hitTest:v,circle:{x:s,y:c,radius:_},seenUids:{box:{},circle:{}}},x),v?z.length>0:z}query(s,c,_,v,x){return this._query(s,c,_,v,!1,x)}hitTest(s,c,_,v,x){return this._query(s,c,_,v,!0,x)}hitTestCircle(s,c,_,v){return this._queryCircle(s,c,_,!0,v)}_queryCell(s,c,_,v,x,E,R,F){const N=R.seenUids,z=this.boxCells[x];if(null!==z){const j=this.bboxes;for(const W of z)if(!N.box[W]){N.box[W]=!0;const ne=4*W;if(s<=j[ne+2]&&c<=j[ne+3]&&_>=j[ne+0]&&v>=j[ne+1]&&(!F||F(this.boxKeys[W]))){if(R.hitTest)return E.push(!0),!0;E.push({key:this.boxKeys[W],x1:j[ne],y1:j[ne+1],x2:j[ne+2],y2:j[ne+3]})}}}const U=this.circleCells[x];if(null!==U){const j=this.circles;for(const W of U)if(!N.circle[W]){N.circle[W]=!0;const ne=3*W;if(this._circleAndRectCollide(j[ne],j[ne+1],j[ne+2],s,c,_,v)&&(!F||F(this.circleKeys[W]))){if(R.hitTest)return E.push(!0),!0;{const J=j[ne],oe=j[ne+1],se=j[ne+2];E.push({key:this.circleKeys[W],x1:J-se,y1:oe-se,x2:J+se,y2:oe+se})}}}}}_queryCellCircle(s,c,_,v,x,E,R,F){const N=R.circle,z=R.seenUids,U=this.boxCells[x];if(null!==U){const W=this.bboxes;for(const ne of U)if(!z.box[ne]){z.box[ne]=!0;const J=4*ne;if(this._circleAndRectCollide(N.x,N.y,N.radius,W[J+0],W[J+1],W[J+2],W[J+3])&&(!F||F(this.boxKeys[ne])))return E.push(!0),!0}}const j=this.circleCells[x];if(null!==j){const W=this.circles;for(const ne of j)if(!z.circle[ne]){z.circle[ne]=!0;const J=3*ne;if(this._circlesCollide(W[J],W[J+1],W[J+2],N.x,N.y,N.radius)&&(!F||F(this.circleKeys[ne])))return E.push(!0),!0}}}_forEachCell(s,c,_,v,x,E,R,F){const N=this._convertToXCellCoord(s),z=this._convertToYCellCoord(c),U=this._convertToXCellCoord(_),j=this._convertToYCellCoord(v);for(let W=N;W<=U;W++)for(let ne=z;ne<=j;ne++)if(x.call(this,s,c,_,v,this.xCellCount*ne+W,E,R,F))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,c,_,v,x,E){const R=v-s,F=x-c,N=_+E;return N*N>R*R+F*F}_circleAndRectCollide(s,c,_,v,x,E,R){const F=(E-v)/2,N=Math.abs(s-(v+F));if(N>F+_)return!1;const z=(R-x)/2,U=Math.abs(c-(x+z));if(U>z+_)return!1;if(N<=F||U<=z)return!0;const j=N-F,W=U-z;return j*j+W*W<=_*_}}const Ai_unknown=0,Ai_flipRequired=1,Ai_flipNotRequired=2,jd=Math.tan(85*Math.PI/180);function qc(m,s,c,_,v,x,E){const R=h.ad.mat4.create();if(c)if("globe"===x.name){const F=h.bo(v,s);h.ad.mat4.multiply(R,R,F)}else{const F=h.ad.mat2.invert([],E);R[0]=F[0],R[1]=F[1],R[4]=F[2],R[5]=F[3],_||h.ad.mat4.rotateZ(R,R,v.angle)}else h.ad.mat4.multiply(R,v.labelPlaneMatrix,m);return R}function Xo(m,s,c,_,v,x,E){const R=qc(m,s,c,_,v,x,E);return"globe"===x.name&&c||(R[2]=R[6]=R[10]=R[14]=0),R}function Wr(m,s,c,_,v,x,E){if(c){if("globe"===x.name){const R=qc(m,s,c,_,v,x,E);return h.ad.mat4.invert(R,R),h.ad.mat4.multiply(R,m,R),R}{const R=h.ad.mat4.clone(m),F=h.ad.mat4.identity([]);return F[0]=E[0],F[1]=E[1],F[4]=E[2],F[5]=E[3],h.ad.mat4.multiply(R,R,F),_||h.ad.mat4.rotateZ(R,R,-v.angle),R}}return v.glCoordMatrix}function ha(m,s,c,_){const v=[m,s,c,1];c?h.ad.vec4.transformMat4(v,v,_):Yr(v,v,_);const x=v[3];return v[0]/=x,v[1]/=x,v[2]/=x,v}function Wc(m,s){return Math.min(.5+m/s*.5,1.5)}function Kp(m,s){const c=m[0]/m[3],_=m[1]/m[3];return c>=-s[0]&&c<=s[0]&&_>=-s[1]&&_<=s[1]}function Ou(m,s,c,_,v,x,E,R,F,N){const z=c.transform,U=_?m.textSizeData:m.iconSizeData,j=h.bp(U,c.transform.zoom),W="globe"===z.projection.name,ne=[256/c.width*2+1,256/c.height*2+1],J=_?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;J.clear();let oe=null;W&&(oe=_?m.text.globeExtVertexArray:m.icon.globeExtVertexArray);const se=m.lineVertexArray,fe=_?m.text.placedSymbolArray:m.icon.placedSymbolArray,be=c.transform.width/c.transform.height;let ve,we=!1;for(let Ee=0;Ee<fe.length;Ee++){const De=fe.get(Ee),{numGlyphs:Me,writingMode:ke}=De;if(ke!==h.bq.vertical||we||ve===h.bq.horizontal||(we=!0),ve=ke,(De.hidden||ke===h.bq.vertical)&&!we){Ul(Me,J);continue}we=!1;const Oe=new h.P(De.tileAnchorX,De.tileAnchorY);let{x:et,y:qe,z:ot}=z.projection.projectTilePoint(Oe.x,Oe.y,N.canonical);if(F){const[zt,Bt,en]=F(Oe);et+=zt,qe+=Bt,ot+=en}const lt=[et,qe,ot,1];if(h.ad.vec4.transformMat4(lt,lt,s),!Kp(lt,ne)){Ul(Me,J);continue}const Ct=lt[3],He=Wc(c.transform.getCameraToCenterDistance(z.projection),Ct),st=h.br(U,j,De),Be=E?st/He:st*He,at=ha(et,qe,ot,v);if(at[3]<=0){Ul(Me,J);continue}let rt={};const $e=h.ak(m.layers[0].layout.get("text-max-angle")),Je=Math.cos($e),dt=E?null:F,Ft=Ko(De,Be,!1,R,s,v,x,m.glyphOffsetArray,se,J,oe,at,Oe,rt,be,dt,z.projection,N,E,Je);we=Ft.useVertical,dt&&Ft.needsFlipping&&(rt={}),(Ft.notEnoughRoom||we||Ft.needsFlipping&&Ko(De,Be,!0,R,s,v,x,m.glyphOffsetArray,se,J,oe,at,Oe,rt,be,dt,z.projection,N,E,Je).notEnoughRoom)&&Ul(Me,J)}_?(m.text.dynamicLayoutVertexBuffer.updateData(J),oe&&m.text.globeExtVertexBuffer&&m.text.globeExtVertexBuffer.updateData(oe)):(m.icon.dynamicLayoutVertexBuffer.updateData(J),oe&&m.icon.globeExtVertexBuffer&&m.icon.globeExtVertexBuffer.updateData(oe))}function gm(m,s,c,_,v,x,E,R,F,N,z,U,j,W,ne,J,oe){const{lineStartIndex:se,glyphStartIndex:fe,segment:be}=R,ve=fe+R.numGlyphs,we=se+R.lineLength,Ee=s.getoffsetX(fe),De=s.getoffsetX(ve-1),Me=Fu(m*Ee,c,_,v,x,E,be,se,we,F,N,z,U,j,!0,W,ne,J,oe);if(!Me)return null;const ke=Fu(m*De,c,_,v,x,E,be,se,we,F,N,z,U,j,!0,W,ne,J,oe);return ke?{first:Me,last:ke}:null}function _t(m,s,c,_){return m===h.bq.horizontal&&Math.abs(_)>Math.abs(c)?{useVertical:!0}:m===h.bq.vertical?_>0?{needsFlipping:!0}:null:s!==Ai_unknown&&(0===(v=c)||Math.abs(_/v)>jd)?s===Ai_flipRequired?{needsFlipping:!0}:null:c<0?{needsFlipping:!0}:null;var v}function Ko(m,s,c,_,v,x,E,R,F,N,z,U,j,W,ne,J,oe,se,fe,be){const ve=s/24,we=m.lineOffsetX*ve,Ee=m.lineOffsetY*ve,{lineStartIndex:De,glyphStartIndex:Me,numGlyphs:ke,segment:Oe,writingMode:et,flipState:qe}=m,ot=De+m.lineLength,lt=Ct=>{if(z){const[at,rt,$e]=Ct.up,Je=N.length;h.bs(z,Je+0,at,rt,$e),h.bs(z,Je+1,at,rt,$e),h.bs(z,Je+2,at,rt,$e),h.bs(z,Je+3,at,rt,$e)}const[He,st,Be]=Ct.point;h.bt(N,He,st,Be,Ct.angle)};if(ke>1){const Ct=gm(ve,R,we,Ee,c,U,j,m,F,x,W,J,!1,oe,se,fe,be);if(!Ct)return{notEnoughRoom:!0};if(_&&!c){let[He,st,Be]=Ct.first.point,[at,rt,$e]=Ct.last.point;[He,st]=ha(He,st,Be,E),[at,rt]=ha(at,rt,$e,E);const Je=_t(et,qe,(at-He)*ne,rt-st);if(m.flipState=Je&&Je.needsFlipping?Ai_flipRequired:Ai_flipNotRequired,Je)return Je}lt(Ct.first);for(let He=Me+1;He<Me+ke-1;He++){const st=Fu(ve*R.getoffsetX(He),we,Ee,c,U,j,Oe,De,ot,F,x,W,J,!1,!1,oe,se,fe,be);if(!st)return N.length-=4*(He-Me),{notEnoughRoom:!0};lt(st)}lt(Ct.last)}else{if(_&&!c){const He=ha(j.x,j.y,0,v),st=De+Oe+1,Be=new h.P(F.getx(st),F.gety(st)),at=ha(Be.x,Be.y,0,v),rt=at[3]>0?at:ds(j,Be,He,1,v,void 0,oe,se.canonical),$e=_t(et,qe,(rt[0]-He[0])*ne,rt[1]-He[1]);if(m.flipState=$e&&$e.needsFlipping?Ai_flipRequired:Ai_flipNotRequired,$e)return $e}const Ct=Fu(ve*R.getoffsetX(Me),we,Ee,c,U,j,Oe,De,ot,F,x,W,J,!1,!1,oe,se,fe,be);if(!Ct)return{notEnoughRoom:!0};lt(Ct)}return{}}function Oa(m,s,c,_,v){const{x,y:E,z:R}=_.projectTilePoint(m.x,m.y,s);if(!v)return ha(x,E,R,c);const[F,N,z]=v(m);return ha(x+F,E+N,R+z,c)}function ds(m,s,c,_,v,x,E,R){const F=Oa(m.sub(s)._unit()._add(m),R,v,E,x);return h.ad.vec3.sub(F,c,F),h.ad.vec3.normalize(F,F),h.ad.vec3.scaleAndAdd(F,c,F,_)}function Fu(m,s,c,_,v,x,E,R,F,N,z,U,j,W,ne,J,oe,se,fe){const be=_?m-s:m+s;let ve=be>0?1:-1,we=0;_&&(ve*=-1,we=Math.PI),ve<0&&(we+=Math.PI);let Ee=R+E+(ve>0?0:1)|0,De=v,Me=v,ke=0,Oe=0;const et=Math.abs(be),qe=[],ot=[];let lt=x,Ct=lt,He=h.ad.vec3.zero([]);const st=()=>ds(Ct,lt,Me,et-ke+1,z,j,J,oe.canonical);for(;ke+Oe<=et;){if(Ee+=ve,Ee<R||Ee>=F)return null;if(Me=De,Ct=lt,qe.push(Me),W&&ot.push(Ct),lt=new h.P(N.getx(Ee),N.gety(Ee)),De=U[Ee],!De){const en=Oa(lt,oe.canonical,z,J,j);De=en[3]>0?U[Ee]=en:st()}ke+=Oe;const zt=h.ad.vec3.sub([],De,Me),Bt=h.ad.vec3.distance(Me,De);if(c&&Bt>0&&Oe>0&&h.ad.vec3.dot(He,zt)/(Oe*Bt)<fe)return null;Oe=Bt,He=zt}ne&&j&&(U[Ee]&&(De=st(),Oe=h.ad.vec3.distance(Me,De),He=h.ad.vec3.sub([],De,Me)),U[Ee]=De);const Be=(et-ke)/Oe,at=lt.sub(Ct)._mult(Be)._add(Ct),rt=h.ad.vec3.scaleAndAdd([],Me,He,Be);let $e=[0,0,1],Je=He[0],dt=He[1];if(se&&($e=J.upVector(oe.canonical,at.x,at.y),0!==$e[0]||0!==$e[1]||1!==$e[2])){const zt=[$e[2],0,-$e[0]],Bt=h.ad.vec3.cross([],$e,zt);h.ad.vec3.normalize(zt,zt),h.ad.vec3.normalize(Bt,Bt),Je=h.ad.vec3.dot(He,zt),dt=h.ad.vec3.dot(He,Bt)}if(c){const zt=h.ad.vec3.cross([],$e,He);h.ad.vec3.normalize(zt,zt),h.ad.vec3.scaleAndAdd(rt,rt,zt,c*ve)}const Ft=we+Math.atan2(dt,Je);return qe.push(rt),W&&ot.push(at),{point:rt,angle:Ft,path:qe,tilePath:ot,up:$e}}function Ul(m,s){const c=s.length,_=c+4*m;s.resize(_),s.float32.fill(-1/0,4*c,4*_)}function Yr(m,s,c){const _=s[0],v=s[1];return m[0]=c[0]*_+c[4]*v+c[12],m[1]=c[1]*_+c[5]*v+c[13],m[3]=c[3]*_+c[7]*v+c[15],m}const Qo=100;class Hd{constructor(s,c,_=new Ni(s.width+200,s.height+200,25),v=new Ni(s.width+200,s.height+200,25)){this.transform=s,this.grid=_,this.ignoredGrid=v,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+Qo,this.screenBottomBoundary=s.height+Qo,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.fogState=c}placeCollisionBox(s,c,_,v,x,E,R,F){let N=_.projectedAnchorX,z=_.projectedAnchorY,U=_.projectedAnchorZ;const j=_.elevation,W=_.tileID,ne=s.getProjection();if(j&&W){const[Ee,De,Me]=ne.upVector(W.canonical,_.tileAnchorX,_.tileAnchorY),ke=ne.upVectorScale(W.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;N+=Ee*j*ke,z+=De*j*ke,U+=Me*j*ke}const J=this.projectAndGetPerspectiveRatio(R,N,z,U,_.tileID,"globe"===ne.name||!!j||this.transform.pitch>0,ne),oe=E*J.perspectiveRatio,se=(_.x1*c+v.x-_.padding)*oe+J.point.x,fe=(_.y1*c+v.y-_.padding)*oe+J.point.y,be=(_.x2*c+v.x+_.padding)*oe+J.point.x,ve=(_.y2*c+v.y+_.padding)*oe+J.point.y,we=J.perspectiveRatio<=.55||J.occluded;return!this.isInsideGrid(se,fe,be,ve)||!x&&this.grid.hitTest(se,fe,be,ve,F)||we?{box:[],offscreen:!1,occluded:J.occluded}:{box:[se,fe,be,ve],offscreen:this.isOffscreen(se,fe,be,ve),occluded:!1}}placeCollisionCircles(s,c,_,v,x,E,R,F,N,z,U,j,W,ne,J){const oe=[],se=this.transform.elevation,fe=s.getProjection(),be=se?se.getAtTileOffsetFunc(J,this.transform.center.lat,this.transform.worldSize,fe):null,ve=new h.P(_.tileAnchorX,_.tileAnchorY);let{x:we,y:Ee,z:De}=fe.projectTilePoint(ve.x,ve.y,J.canonical);if(be){const[$e,Je,dt]=be(ve);we+=$e,Ee+=Je,De+=dt}const Me="globe"===fe.name,ke=this.projectAndGetPerspectiveRatio(R,we,Ee,De,J,Me||!!se||this.transform.pitch>0,fe),{perspectiveRatio:Oe}=ke,et=(U?E/Oe:E*Oe)/h.bw,qe=ha(we,Ee,De,F),ot=_.lineOffsetX*et,lt=_.lineOffsetY*et,Ct=h.ak(s.layers[0].layout.get("text-max-angle")),He=Math.cos(Ct),st=ke.signedDistanceFromCamera>0?gm(et,x,ot,lt,!1,qe,ve,_,v,F,{},se&&!U?be:null,U&&!!se,fe,J,U,He):null;let Be=!1,at=!1,rt=!0;if(st&&!ke.occluded){const $e=.5*W*Oe+ne,Je=new h.P(-100,-100),dt=new h.P(this.screenRightBoundary,this.screenBottomBoundary),Ft=new Nt,{first:zt,last:Bt}=st,en=zt.path.length;let In=[];for(let vn=en-1;vn>=1;vn--)In.push(zt.path[vn]);for(let vn=1;vn<Bt.path.length;vn++)In.push(Bt.path[vn]);const wt=2.5*$e;N&&(In=In.map(([vn,di,Pi],ar)=>(be&&!Me&&(Pi=be(ar<en-1?zt.tilePath[en-1-ar]:Bt.tilePath[ar-en+2])[2]),ha(vn,di,Pi,N))),In.some(vn=>vn[3]<=0)&&(In=[]));let Tn=[];if(In.length>0){let vn=1/0,di=-1/0,Pi=1/0,ar=-1/0;for(const Yn of In)vn=Math.min(vn,Yn[0]),Pi=Math.min(Pi,Yn[1]),di=Math.max(di,Yn[0]),ar=Math.max(ar,Yn[1]);di>=Je.x&&vn<=dt.x&&ar>=Je.y&&Pi<=dt.y&&(Tn=[In.map(Yn=>new h.P(Yn[0],Yn[1]))],(vn<Je.x||di>dt.x||Pi<Je.y||ar>dt.y)&&(Tn=h.bu(Tn,Je.x,Je.y,dt.x,dt.y)))}for(const vn of Tn){Ft.reset(vn,.25*$e);let di=0;di=Ft.length<=.5*$e?1:Math.ceil(Ft.paddedLength/wt)+1;for(let Pi=0;Pi<di;Pi++){const ar=Pi/Math.max(di-1,1),Yn=Ft.lerp(ar),xr=Yn.x+Qo,An=Yn.y+Qo;oe.push(xr,An,$e,0);const tn=xr-$e,gi=An-$e,Vi=xr+$e,Ei=An+$e;if(rt=rt&&this.isOffscreen(tn,gi,Vi,Ei),at=at||this.isInsideGrid(tn,gi,Vi,Ei),!c&&this.grid.hitTestCircle(xr,An,$e,j)&&(Be=!0,!z))return{circles:[],offscreen:!1,collisionDetected:Be,occluded:!1}}}}return{circles:!z&&Be||!at?[]:oe,offscreen:rt,collisionDetected:Be,occluded:ke.occluded}}queryRenderedSymbols(s){if(0===s.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const c=[];let _=1/0,v=1/0,x=-1/0,E=-1/0;for(const z of s){const U=new h.P(z.x+Qo,z.y+Qo);_=Math.min(_,U.x),v=Math.min(v,U.y),x=Math.max(x,U.x),E=Math.max(E,U.y),c.push(U)}const R=this.grid.query(_,v,x,E).concat(this.ignoredGrid.query(_,v,x,E)),F={},N={};for(const z of R){const U=z.key;if(void 0===F[U.bucketInstanceId]&&(F[U.bucketInstanceId]={}),F[U.bucketInstanceId][U.featureIndex])continue;const j=[new h.P(z.x1,z.y1),new h.P(z.x2,z.y1),new h.P(z.x2,z.y2),new h.P(z.x1,z.y2)];h.bv(c,j)&&(F[U.bucketInstanceId][U.featureIndex]=!0,void 0===N[U.bucketInstanceId]&&(N[U.bucketInstanceId]=[]),N[U.bucketInstanceId].push(U.featureIndex))}return N}insertCollisionBox(s,c,_,v,x){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:v,collisionGroupID:x},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,c,_,v,x){const E=c?this.ignoredGrid:this.grid,R={bucketInstanceId:_,featureIndex:v,collisionGroupID:x};for(let F=0;F<s.length;F+=4)E.insertCircle(R,s[F],s[F+1],s[F+2])}projectAndGetPerspectiveRatio(s,c,_,v,x,E,R){const F=[c,_,v,1];let N=!1;v||this.transform.pitch>0?(h.ad.vec4.transformMat4(F,F,s),this.fogState&&x&&"globe"!==R.name&&(N=function(j,W,ne,J,oe,se){const fe=se.calculateFogTileMatrix(oe),be=[W,ne,J];return h.ad.vec3.transformMat4(be,be,fe),Qt(j,h.ad.vec3.length(be),se.pitch,se._fov)}(this.fogState,c,_,v,x.toUnwrapped(),this.transform)>.9)):Yr(F,F,s);const z=F[3];return{point:new h.P((F[0]/z+1)/2*this.transform.width+Qo,(-F[1]/z+1)/2*this.transform.height+Qo),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(R)/z*.5,1.5),signedDistanceFromCamera:z,occluded:E&&F[2]>z||N}}isOffscreen(s,c,_,v){return _<Qo||s>=this.screenRightBoundary||v<Qo||c>this.screenBottomBoundary}isInsideGrid(s,c,_,v){return _>=0&&s<this.gridRightBoundary&&v>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const s=h.ad.mat4.identity([]);return h.ad.mat4.translate(s,s,[-100,-100,0]),s}}function so(m,s,c){const _=s.createTileMatrix(m,m.worldSize,c.toUnwrapped());return h.ad.mat4.multiply(new Float32Array(16),m.projMatrix,_)}function yv(m,s,c){if(s.projection.name===c.projection.name)return m.projMatrix;const _=c.clone();return _.setProjection(s.projection),so(_,s.getProjection(),m)}function cl(m,s,c){return s.name===c.projection.name?m.projMatrix:so(c,s,m)}class $d{constructor(s,c,_,v){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?c:-c))):v&&_?1:0,this.placed=_}isHidden(){return 0===this.opacity&&!this.placed}}class Fa{constructor(s,c,_,v,x,E=!1){this.text=new $d(s?s.text:null,c,_,x),this.icon=new $d(s?s.icon:null,c,v,x),this.clipped=E}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class jl{constructor(s,c,_,v=!1){this.text=s,this.icon=c,this.skipFade=_,this.clipped=v}}class t_{constructor(){this.invProjMatrix=h.ad.mat4.create(),this.viewportMatrix=h.ad.mat4.create(),this.circles=[]}}class yc{constructor(s,c,_,v,x){this.bucketInstanceId=s,this.featureIndex=c,this.sourceLayerIndex=_,this.bucketIndex=v,this.tileID=x}}class Yc{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const c=++this.maxGroupID;this.collisionGroups[s]={ID:c,predicate:_=>_.collisionGroupID===c}}return this.collisionGroups[s]}}function Gd(m,s,c,_,v){const{horizontalAlign:x,verticalAlign:E}=h.bD(m),R=-(x-.5)*s,F=-(E-.5)*c,N=h.bC(m,_);return new h.P(R+N[0]*v,F+N[1]*v)}function Ss(m,s,c,_,v){const x=new h.P(m,s);return c&&x._rotate(_?v:-v),x}class zi{constructor(s,c,_,v,x,E){this.transform=s.clone(),this.projection=s.projection.name,this.collisionIndex=new Hd(this.transform,x),this.buildingIndex=E,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new Yc(_),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(s,c,_,v,x=1){const E=_.getBucket(c),R=_.latestFeatureIndex;if(!E||!R||c.fqid!==E.layerIds[0])return;const F=E.layers[0].layout,N=E.layers[0].paint,z=_.collisionBoxArray,U=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),j=_.tileSize/h.ai,W=_.tileID.toUnwrapped();this.transform.setProjection(E.projection);const ne=(J=_.tileID,oe=E.getProjection(),se=this.transform,oe.name===this.projection?se.calculateProjMatrix(J.toUnwrapped()):so(se,oe,J));var J,oe,se;const fe="map"===F.get("text-pitch-alignment"),be="map"===F.get("text-rotation-alignment");c.compileFilter(c.options);const ve=c.dynamicFilter(),we=c.dynamicFilterNeedsFeature(),Ee=this.transform.calculatePixelsToTileUnitsMatrix(_),De=Xo(ne,_.tileID.canonical,fe,be,this.transform,E.getProjection(),Ee);let Me=null;if(fe){const st=Wr(ne,_.tileID.canonical,fe,be,this.transform,E.getProjection(),Ee);Me=h.ad.mat4.multiply([],this.transform.labelPlaneMatrix,st)}let ke=null;ve&&_.latestFeatureIndex&&(ke={unwrappedTileID:W,dynamicFilter:ve,dynamicFilterNeedsFeature:we}),this.retainedQueryData[E.bucketInstanceId]=new yc(E.bucketInstanceId,R,E.sourceLayerIndex,E.index,_.tileID);const[Oe,et]=E.layers[0].layout.get("text-size-scale-range"),qe=h.ay(x,Oe,et),[ot,lt]=F.get("icon-size-scale-range"),Ct=h.ay(x,ot,lt),He={bucket:E,layout:F,paint:N,posMatrix:ne,textLabelPlaneMatrix:De,labelToScreenMatrix:Me,clippingData:ke,scale:U,textPixelRatio:j,holdingForFade:_.holdingForFade(),collisionBoxArray:z,partiallyEvaluatedTextSize:h.bp(E.textSizeData,this.transform.zoom,qe),partiallyEvaluatedIconSize:h.bp(E.iconSizeData,this.transform.zoom,Ct),collisionGroup:this.collisionGroups.get(E.sourceID),latestFeatureIndex:_.latestFeatureIndex};if(v)for(const st of E.sortKeyRanges){const{sortKey:Be,symbolInstanceStart:at,symbolInstanceEnd:rt}=st;s.push({sortKey:Be,symbolInstanceStart:at,symbolInstanceEnd:rt,parameters:He})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:He})}attemptAnchorPlacement(s,c,_,v,x,E,R,F,N,z,U,j,W,ne,J,oe,se,fe){const{textOffset0:be,textOffset1:ve,crossTileID:we}=j,Ee=[be,ve],De=Gd(s,_,v,Ee,x),Me=this.collisionIndex.placeCollisionBox(ne,x,c,Ss(De.x,De.y,E,R,this.transform.angle),U,F,N,z.predicate);if(oe){const ke=ne.getSymbolInstanceIconSize(fe,this.transform.zoom,j.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(ne,ke,oe,Ss(De.x,De.y,E,R,this.transform.angle),U,F,N,z.predicate).box.length)return}if(Me.box.length>0){let ke;return this.prevPlacement&&this.prevPlacement.variableOffsets[we]&&this.prevPlacement.placements[we]&&this.prevPlacement.placements[we].text&&(ke=this.prevPlacement.variableOffsets[we].anchor),this.variableOffsets[we]={textOffset:Ee,width:_,height:v,anchor:s,textScale:x,prevAnchor:ke},this.markUsedJustification(ne,s,j,J),ne.allowVerticalPlacement&&(this.markUsedOrientation(ne,J,j),this.placedOrientations[we]=J),{shift:De,placedGlyphBoxes:Me}}}placeLayerBucketPart(s,c,_,v,x=1){const{bucket:E,layout:R,paint:F,posMatrix:N,textLabelPlaneMatrix:z,labelToScreenMatrix:U,clippingData:j,textPixelRatio:W,holdingForFade:ne,collisionBoxArray:J,partiallyEvaluatedTextSize:oe,partiallyEvaluatedIconSize:se,collisionGroup:fe,latestFeatureIndex:be}=s.parameters,ve=R.get("text-optional"),we=R.get("icon-optional"),Ee=R.get("text-allow-overlap"),De=R.get("icon-allow-overlap"),Me="map"===R.get("text-rotation-alignment"),ke="map"===R.get("text-pitch-alignment"),Oe=F.get("symbol-z-offset"),et="sea"===R.get("symbol-elevation-reference"),[qe,ot]=R.get("text-size-scale-range"),[lt,Ct]=R.get("icon-size-scale-range"),He=h.ay(x,qe,ot),st=h.ay(x,lt,Ct);this.transform.setProjection(E.projection);let Be=Ee&&(De||!E.hasIconData()||we),at=De&&(Ee||!E.hasTextData()||ve);const rt=!Oe.isConstant();!E.collisionArrays&&J&&E.deserializeCollisionBoxes(J),_&&v&&E.updateCollisionDebugBuffers(this.transform.zoom,J,He,st);const $e=(Je,dt,Ft)=>{const{crossTileID:zt,numVerticalGlyphVertices:Bt}=Je;let en=null;if(j&&j.dynamicFilterNeedsFeature||rt){const wi=this.retainedQueryData[E.bucketInstanceId];en=be.loadFeature({featureIndex:Je.featureIndex,bucketIndex:wi.bucketIndex,sourceLayerIndex:wi.sourceLayerIndex,layoutVertexArrayOffset:0})}if(j&&!(0,j.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},en,this.retainedQueryData[E.bucketInstanceId].tileID.canonical,new h.P(Je.tileAnchorX,Je.tileAnchorY),this.transform.calculateDistanceTileData(j.unwrappedTileID)))return this.placements[zt]=new jl(!1,!1,!1,!0),void c.add(zt);const In=Oe.evaluate(en,{});if(c.has(zt))return;if(ne)return void(this.placements[zt]=new jl(!1,!1,!1));let wt=!1,Tn=!1,vn=!0,di=!1,Pi=!1,ar=null,Yn={box:null,offscreen:null,occluded:null},xr={box:null,offscreen:null,occluded:null},An=null,tn=null,gi=null,Vi=0,Ei=0,Xi=0;Ft.textFeatureIndex?Vi=Ft.textFeatureIndex:Je.useRuntimeCollisionCircles&&(Vi=Je.featureIndex),Ft.verticalTextFeatureIndex&&(Ei=Ft.verticalTextFeatureIndex);const lo=wi=>{wi.tileID=this.retainedQueryData[E.bucketInstanceId].tileID;const Tr=this.transform.elevation;wi.elevation=et?In:In+(Tr?Tr.getAtTileOffset(wi.tileID,wi.tileAnchorX,wi.tileAnchorY):0),wi.elevation+=Je.zOffset},_o=Ft.textBox;if(_o){lo(_o);const wi=Oi=>{let $i=h.bq.horizontal;if(E.allowVerticalPlacement&&!Oi&&this.prevPlacement){const Dn=this.prevPlacement.placedOrientations[zt];Dn&&(this.placedOrientations[zt]=Dn,$i=Dn,this.markUsedOrientation(E,$i,Je))}return $i},Tr=(Oi,$i)=>{if(E.allowVerticalPlacement&&Bt>0&&Ft.verticalTextBox){for(const Dn of E.writingModes)if(Dn===h.bq.vertical?(Yn=$i(),xr=Yn):Yn=Oi(),Yn&&Yn.box&&Yn.box.length)break}else Yn=Oi()};if(R.get("text-variable-anchor")){let Oi=R.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[zt]){const vr=this.prevPlacement.variableOffsets[zt];Oi.indexOf(vr.anchor)>0&&(Oi=Oi.filter(Gr=>Gr!==vr.anchor),Oi.unshift(vr.anchor))}const $i=(vr,Gr,md)=>{const wr=E.getSymbolInstanceTextSize(oe,Je,this.transform.zoom,dt),ea=(vr.x2-vr.x1)*wr+2*vr.padding,js=(vr.y2-vr.y1)*wr+2*vr.padding,wl=Je.hasIconTextFit&&!De?Gr:null;wl&&lo(wl);let gs={box:[],offscreen:!1,occluded:!1};const Wa=Ee?2*Oi.length:Oi.length;for(let Mc=0;Mc<Wa;++Mc){const Xl=this.attemptAnchorPlacement(Oi[Mc%Oi.length],vr,ea,js,wr,Me,ke,W,N,fe,Mc>=Oi.length,Je,dt,E,md,wl,oe,se);if(Xl&&(gs=Xl.placedGlyphBoxes,gs&&gs.box&&gs.box.length)){wt=!0,ar=Xl.shift;break}}return gs};Tr(()=>$i(_o,Ft.iconBox,h.bq.horizontal),()=>{const vr=Ft.verticalTextBox;return vr&&lo(vr),E.allowVerticalPlacement&&!(Yn&&Yn.box&&Yn.box.length)&&Bt>0&&vr?$i(vr,Ft.verticalIconBox,h.bq.vertical):{box:null,offscreen:null,occluded:null}}),Yn&&(wt=Yn.box,vn=Yn.offscreen,di=Yn.occluded);const Dn=wi(!(!Yn||!Yn.box));if(!wt&&this.prevPlacement){const vr=this.prevPlacement.variableOffsets[zt];vr&&(this.variableOffsets[zt]=vr,this.markUsedJustification(E,vr.anchor,Je,Dn))}}else{const Oi=($i,Dn)=>{const vr=E.getSymbolInstanceTextSize(oe,Je,this.transform.zoom,dt,x),Gr=this.collisionIndex.placeCollisionBox(E,vr,$i,new h.P(0,0),Ee,W,N,fe.predicate);return Gr&&Gr.box&&Gr.box.length&&(this.markUsedOrientation(E,Dn,Je),this.placedOrientations[zt]=Dn),Gr};Tr(()=>Oi(_o,h.bq.horizontal),()=>{const $i=Ft.verticalTextBox;return E.allowVerticalPlacement&&Bt>0&&$i?(lo($i),Oi($i,h.bq.vertical)):{box:null,offscreen:null,occluded:null}}),wi(!!(Yn&&Yn.box&&Yn.box.length))}}if(An=Yn,wt=An&&An.box&&An.box.length>0,vn=An&&An.offscreen,di=An&&An.occluded,Je.useRuntimeCollisionCircles){const wi=E.text.placedSymbolArray.get(Je.centerJustifiedTextSymbolIndex>=0?Je.centerJustifiedTextSymbolIndex:Je.verticalPlacedTextSymbolIndex),Tr=h.br(E.textSizeData,oe,wi),Oi=R.get("text-padding");tn=this.collisionIndex.placeCollisionCircles(E,Ee,wi,E.lineVertexArray,E.glyphOffsetArray,Tr,N,z,U,_,ke,fe.predicate,Je.collisionCircleDiameter*Tr/h.bw,Oi,this.retainedQueryData[E.bucketInstanceId].tileID),wt=Ee||tn.circles.length>0&&!tn.collisionDetected,vn=vn&&tn.offscreen,di=tn.occluded}if(Ft.iconFeatureIndex&&(Xi=Ft.iconFeatureIndex),Ft.iconBox){const wi=Tr=>{lo(Tr);const Oi=Je.hasIconTextFit&&ar?Ss(ar.x,ar.y,Me,ke,this.transform.angle):new h.P(0,0),$i=E.getSymbolInstanceIconSize(se,this.transform.zoom,Je.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(E,$i,Tr,Oi,De,W,N,fe.predicate)};xr&&xr.box&&xr.box.length&&Ft.verticalIconBox?(gi=wi(Ft.verticalIconBox),Tn=gi.box.length>0):(gi=wi(Ft.iconBox),Tn=gi.box.length>0),vn=vn&&gi.offscreen,Pi=gi.occluded}const jo=ve||0===Je.numHorizontalGlyphVertices&&0===Bt,xl=we||0===Je.numIconVertices;if(jo||xl?xl?jo||(Tn=Tn&&wt):wt=Tn&&wt:Tn=wt=Tn&&wt,wt&&An&&An.box&&this.collisionIndex.insertCollisionBox(An.box,R.get("text-ignore-placement"),E.bucketInstanceId,xr&&xr.box&&Ei?Ei:Vi,fe.ID),Tn&&gi&&this.collisionIndex.insertCollisionBox(gi.box,R.get("icon-ignore-placement"),E.bucketInstanceId,Xi,fe.ID),tn&&(wt&&this.collisionIndex.insertCollisionCircles(tn.circles,R.get("text-ignore-placement"),E.bucketInstanceId,Vi,fe.ID),_)){const wi=E.bucketInstanceId;let Tr=this.collisionCircleArrays[wi];void 0===Tr&&(Tr=this.collisionCircleArrays[wi]=new t_);for(let Oi=0;Oi<tn.circles.length;Oi+=4)Tr.circles.push(tn.circles[Oi+0]),Tr.circles.push(tn.circles[Oi+1]),Tr.circles.push(tn.circles[Oi+2]),Tr.circles.push(tn.collisionDetected?1:0)}const ms="globe"!==E.projection.name;Be=Be&&(ms||!di),at=at&&(ms||!Pi),this.placements[zt]=new jl(wt||Be,Tn||at,vn||E.justReloaded),c.add(zt)};if("offset"===E.elevationType&&this.buildingIndex&&this.buildingIndex.updateZOffset(E,this.retainedQueryData[E.bucketInstanceId].tileID),"road"===E.elevationType&&E.updateRoadElevation(),E.updateZOffset(),E.sortFeaturesByY){const Je=E.getSortedSymbolIndexes(this.transform.angle);for(let dt=Je.length-1;dt>=0;--dt){const Ft=Je[dt];$e(E.symbolInstances.get(Ft),Ft,E.collisionArrays[Ft])}E.hasAnyZOffset&&h.w(`${E.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(E.hasAnyZOffset){const Je=E.getSortedIndexesByZOffset();for(let dt=0;dt<Je.length;++dt){const Ft=Je[dt];$e(E.symbolInstances.get(Ft),Ft,E.collisionArrays[Ft])}}else for(let Je=s.symbolInstanceStart;Je<s.symbolInstanceEnd;Je++)$e(E.symbolInstances.get(Je),Je,E.collisionArrays[Je]);if(_&&E.bucketInstanceId in this.collisionCircleArrays){const Je=this.collisionCircleArrays[E.bucketInstanceId];h.ad.mat4.invert(Je.invProjMatrix,N),Je.viewportMatrix=this.collisionIndex.getViewportMatrix()}E.justReloaded=!1}markUsedJustification(s,c,_,v){const{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:E,rightJustifiedTextSymbolIndex:R,verticalPlacedTextSymbolIndex:F,crossTileID:N}=_,z=h.bB(c),U=v===h.bq.vertical?F:"left"===z?x:"center"===z?E:"right"===z?R:-1;x>=0&&(s.text.placedSymbolArray.get(x).crossTileID=U>=0&&x!==U?0:N),E>=0&&(s.text.placedSymbolArray.get(E).crossTileID=U>=0&&E!==U?0:N),R>=0&&(s.text.placedSymbolArray.get(R).crossTileID=U>=0&&R!==U?0:N),F>=0&&(s.text.placedSymbolArray.get(F).crossTileID=U>=0&&F!==U?0:N)}markUsedOrientation(s,c,_){const v=c===h.bq.horizontal||c===h.bq.horizontalOnly?c:0,x=c===h.bq.vertical?c:0,{leftJustifiedTextSymbolIndex:E,centerJustifiedTextSymbolIndex:R,rightJustifiedTextSymbolIndex:F,verticalPlacedTextSymbolIndex:N}=_,z=s.text.placedSymbolArray;E>=0&&(z.get(E).placedOrientation=v),R>=0&&(z.get(R).placedOrientation=v),F>=0&&(z.get(F).placedOrientation=v),N>=0&&(z.get(N).placedOrientation=x)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let _=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const v=c?c.symbolFadeChange(s):1,x=c?c.opacities:{},E=c?c.variableOffsets:{},R=c?c.placedOrientations:{};for(const F in this.placements){const N=this.placements[F],z=x[F];z?(this.opacities[F]=new Fa(z,v,N.text,N.icon,null,N.clipped),_=_||N.text!==z.text.placed||N.icon!==z.icon.placed):(this.opacities[F]=new Fa(null,v,N.text,N.icon,N.skipFade,N.clipped),_=_||N.text||N.icon)}for(const F in x){const N=x[F];if(!this.opacities[F]){const z=new Fa(N,v,!1,!1);z.isHidden()||(this.opacities[F]=z,_=_||N.text.placed||N.icon.placed)}}for(const F in E)this.variableOffsets[F]||!this.opacities[F]||this.opacities[F].isHidden()||(this.variableOffsets[F]=E[F]);for(const F in R)this.placedOrientations[F]||!this.opacities[F]||this.opacities[F].isHidden()||(this.placedOrientations[F]=R[F]);_?this.lastPlacementChangeTime=s:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:s)}updateLayerOpacities(s,c,_,v){const x=new Set;for(const E of c){const R=E.getBucket(s);R&&E.latestFeatureIndex&&s.fqid===R.layerIds[0]&&(this.updateBucketOpacities(R,x,E,E.collisionBoxArray,_,v,E.tileID,s.scope),"offset"===R.elevationType&&this.buildingIndex&&this.buildingIndex.updateZOffset(R,E.tileID),"road"===R.elevationType&&R.updateRoadElevation(),R.updateZOffset())}}updateBucketOpacities(s,c,_,v,x,E,R,F){s.hasTextData()&&s.text.opacityVertexArray.clear(),s.hasIconData()&&s.icon.opacityVertexArray.clear(),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();const N=s.layers[0].layout,z=s.layers[0].paint,U=!!s.layers[0].dynamicFilter(),j=new Fa(null,0,!1,!1,!0),W=N.get("text-allow-overlap"),ne=N.get("icon-allow-overlap"),J=N.get("text-variable-anchor"),oe="map"===N.get("text-rotation-alignment"),se="map"===N.get("text-pitch-alignment"),fe=z.get("symbol-z-offset"),be="sea"===N.get("symbol-elevation-reference"),ve=!fe.isConstant(),we=new Fa(null,0,W&&(ne||!s.hasIconData()||N.get("icon-optional")),ne&&(W||!s.hasTextData()||N.get("text-optional")),!0);!s.collisionArrays&&v&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(v);const Ee=(Me,ke,Oe)=>{for(let et=0;et<ke/4;et++)Me.opacityVertexArray.emplaceBack(Oe)};let De=0;E&&s.updateReplacement(R,E);for(let Me=0;Me<s.symbolInstances.length;Me++){const ke=s.symbolInstances.get(Me),{numHorizontalGlyphVertices:Oe,numVerticalGlyphVertices:et,crossTileID:qe,numIconVertices:ot,tileAnchorX:lt,tileAnchorY:Ct}=ke;let He=null;const st=this.retainedQueryData[s.bucketInstanceId];ve&&ke&&st&&(He=_.latestFeatureIndex.loadFeature({featureIndex:ke.featureIndex,bucketIndex:st.bucketIndex,sourceLayerIndex:st.sourceLayerIndex,layoutVertexArrayOffset:0}));const Be=fe.evaluate(He,{}),at=c.has(qe);let rt=this.opacities[qe];at?rt=j:rt||(rt=we,this.opacities[qe]=rt),c.add(qe);const $e=Oe>0||et>0,Je=ot>0,dt=this.placedOrientations[qe],Ft=dt===h.bq.vertical,zt=dt===h.bq.horizontal||dt===h.bq.horizontalOnly;!$e&&!Je||rt.isHidden()||De++;let Bt=!1;if(($e||Je)&&E)for(const en of s.activeReplacements){if(h.bx(en,x,h.by.Symbol,F)||en.min.x>lt||lt>en.max.x||en.min.y>Ct||Ct>en.max.y)continue;const In=h.bz(lt,Ct,R.canonical,en.footprintTileId.canonical);if(Bt=h.bA(In,en.footprint),Bt)break}if($e){const en=Bt?qd:Zc(rt.text);Ee(s.text,Oe,Ft?qd:en),Ee(s.text,et,zt?qd:en);const In=rt.text.isHidden(),{leftJustifiedTextSymbolIndex:wt,centerJustifiedTextSymbolIndex:Tn,rightJustifiedTextSymbolIndex:vn,verticalPlacedTextSymbolIndex:di}=ke,Pi=s.text.placedSymbolArray,ar=In||Ft?1:0;wt>=0&&(Pi.get(wt).hidden=ar),Tn>=0&&(Pi.get(Tn).hidden=ar),vn>=0&&(Pi.get(vn).hidden=ar),di>=0&&(Pi.get(di).hidden=In||zt?1:0);const Yn=this.variableOffsets[qe];Yn&&this.markUsedJustification(s,Yn.anchor,ke,dt);const xr=this.placedOrientations[qe];xr&&(this.markUsedJustification(s,"left",ke,xr),this.markUsedOrientation(s,xr,ke))}if(Je){const en=Bt?qd:Zc(rt.icon),{placedIconSymbolIndex:In,verticalPlacedIconSymbolIndex:wt}=ke,Tn=s.icon.placedSymbolArray,vn=rt.icon.isHidden()?1:0;In>=0&&(Ee(s.icon,ot,Ft?qd:en),Tn.get(In).hidden=vn),wt>=0&&(Ee(s.icon,ke.numVerticalIconVertices,zt?qd:en),Tn.get(wt).hidden=vn)}if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){const en=s.collisionArrays[Me];if(en){let In=new h.P(0,0),wt=!0;if(en.textBox||en.verticalTextBox){if(J){const vn=this.variableOffsets[qe];vn?(In=Gd(vn.anchor,vn.width,vn.height,vn.textOffset,vn.textScale),oe&&In._rotate(se?this.transform.angle:-this.transform.angle)):wt=!1}U&&(wt=!rt.clipped),en.textBox&&cr(s.textCollisionBox.collisionVertexArray,rt.text.placed,!wt||Ft,Be,be,In.x,In.y),en.verticalTextBox&&cr(s.textCollisionBox.collisionVertexArray,rt.text.placed,!wt||zt,Be,be,In.x,In.y)}const Tn=wt&&!(zt||!en.verticalIconBox);en.iconBox&&cr(s.iconCollisionBox.collisionVertexArray,rt.icon.placed,Tn,Be,be,ke.hasIconTextFit?In.x:0,ke.hasIconTextFit?In.y:0),en.verticalIconBox&&cr(s.iconCollisionBox.collisionVertexArray,rt.icon.placed,!Tn,Be,be,ke.hasIconTextFit?In.x:0,ke.hasIconTextFit?In.y:0)}}}if(s.fullyClipped=0===De,s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.bucketInstanceId in this.collisionCircleArrays){const Me=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=Me.invProjMatrix,s.placementViewportMatrix=Me.viewportMatrix,s.collisionCircleArray=Me.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return 0===this.fadeDuration?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,c){const _=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*_>s}setStale(){this.stale=!0}}function cr(m,s,c,_,v,x,E){m.emplaceBack(s?1:0,c?1:0,x||0,E||0,_,v?1:0),m.emplaceBack(s?1:0,c?1:0,x||0,E||0,_,v?1:0),m.emplaceBack(s?1:0,c?1:0,x||0,E||0,_,v?1:0),m.emplaceBack(s?1:0,c?1:0,x||0,E||0,_,v?1:0)}const vx=Math.pow(2,25),Qp=Math.pow(2,24),vv=Math.pow(2,17),xE=Math.pow(2,16),Jp=Math.pow(2,9),Lu=Math.pow(2,8),rr=Math.pow(2,1);function Zc(m){if(0===m.opacity&&!m.placed)return 0;if(1===m.opacity&&m.placed)return 4294967295;const s=m.placed?1:0,c=Math.floor(127*m.opacity);return c*vx+s*Qp+c*vv+s*xE+c*Jp+s*Lu+c*rr+s}const qd=0;class Ds{constructor(s){this._sortAcrossTiles="viewport-y"!==s.layout.get("symbol-z-order")&&void 0!==s.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(s,c,_,v,x,E){const R=this._bucketParts;for(;this._currentTileIndex<s.length;)if(c.getBucketParts(R,v,s[this._currentTileIndex],this._sortAcrossTiles,E),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,R.sort((F,N)=>F.sortKey-N.sortKey));this._currentPartIndex<R.length;){const F=R[this._currentPartIndex];if(c.placeLayerBucketPart(F,this._seenCrossTileIDs,_,0===F.symbolInstanceStart,E),this._currentPartIndex++,x())return!0}return!1}}class Xc{constructor(s,c,_,v,x,E,R,F,N){this.placement=new zi(s,x,E,R,F,N),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(s,c,_,v,x){const E=h.q.now(),R=()=>{const F=h.q.now()-E;return!this._forceFullPlacement&&F>2};for(;this._currentPlacementIndex>=0;){const F=c[s[this._currentPlacementIndex]],N=this.placement.collisionIndex.transform.zoom;if("symbol"===F.type&&(!F.minzoom||F.minzoom<=N)&&(!F.maxzoom||F.maxzoom>N)){const z=F,U=z.layout.get("symbol-z-elevate"),j=void 0!==z.layout.get("symbol-sort-key").constantOr(1),W=z.layout.get("symbol-z-order"),ne="viewport-y"===W||"auto"===W&&!("viewport-y"!==W&&j),J=z.layout.get("text-allow-overlap")||z.layout.get("icon-allow-overlap")||z.layout.get("text-ignore-placement")||z.layout.get("icon-ignore-placement"),oe=ne&&J,se=this._inProgressLayer=this._inProgressLayer||new Ds(z),fe=h.C(F.source,F.scope);if(se.continuePlacement(U||oe?v[fe]:_[fe],this.placement,this._showCollisionBoxes,F,R,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const bv=512/h.ai/2;class wE{constructor(s,c,_){this.tileID=s,this.bucketInstanceId=_,this.index=new h.bE(c.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const v=s.canonical.x*h.ai,x=s.canonical.y*h.ai;for(let E=0;E<c.length;E++){const{key:R,crossTileID:F,tileAnchorX:N,tileAnchorY:z}=c.get(E),U=Math.floor((v+N)*bv),j=Math.floor((x+z)*bv);this.index.add(U,j),this.keys.push(R),this.crossTileIDs.push(F)}this.index.finish()}findMatches(s,c,_){const v=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z),x=bv/Math.pow(2,c.canonical.z-this.tileID.canonical.z),E=c.canonical.x*h.ai,R=c.canonical.y*h.ai;for(let F=0;F<s.length;F++){const N=s.get(F);if(N.crossTileID)continue;const{key:z,tileAnchorX:U,tileAnchorY:j}=N,W=Math.floor((E+U)*x),ne=Math.floor((R+j)*x),J=this.index.range(W-v,ne-v,W+v,ne+v);for(const oe of J){const se=this.crossTileIDs[oe];if(this.keys[oe]===z&&!_.has(se)){_.add(se),N.crossTileID=se;break}}}}}class Nu{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class _m{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){const c=Math.round((s-this.lng)/360);if(0!==c)for(const _ in this.indexes){const v=this.indexes[_],x={};for(const E in v){const R=v[E];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+c),x[R.tileID.key]=R}this.indexes[_]=x}this.lng=s}addBucket(s,c,_){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let x=0;x<c.symbolInstances.length;x++)c.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]=new Set);const v=this.usedCrossTileIDs[s.overscaledZ];for(const x in this.indexes){const E=this.indexes[x];if(Number(x)>s.overscaledZ)for(const R in E){const F=E[R];F.tileID.isChildOf(s)&&F.findMatches(c.symbolInstances,s,v)}else{const R=E[s.scaledTo(Number(x)).key];R&&R.findMatches(c.symbolInstances,s,v)}}for(let x=0;x<c.symbolInstances.length;x++){const E=c.symbolInstances.get(x);E.crossTileID||(E.crossTileID=_.generate(),v.add(E.crossTileID))}return void 0===this.indexes[s.overscaledZ]&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new wE(s,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(s,c){for(const _ of c.crossTileIDs)this.usedCrossTileIDs[s].delete(_)}removeStaleBuckets(s){let c=!1;for(const _ in this.indexes){const v=this.indexes[_];for(const x in v)s[v[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,v[x]),delete v[x],c=!0)}return c}}class xv{constructor(){this.layerIndexes={},this.crossTileIDs=new Nu,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,c,_,v){let x=this.layerIndexes[s.fqid];void 0===x&&(x=this.layerIndexes[s.fqid]=new _m);let E=!1;const R={};"globe"!==v.name&&x.handleWrapJump(_);for(const F of c){const N=F.getBucket(s);N&&s.fqid===N.layerIds[0]&&(N.bucketInstanceId||(N.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(F.tileID,N,this.crossTileIDs)&&(E=!0),R[N.bucketInstanceId]=!0)}return x.removeStaleBuckets(R)&&(E=!0),E}pruneUnusedLayers(s){const c={};s.forEach(_=>{c[_]=!0});for(const _ in this.layerIndexes)c[_]||delete this.layerIndexes[_]}}class ei{constructor(s,c,_,v){this.blendFunction=s,this.blendColor=c,this.mask=_,this.blendEquation=v}}ei.Replace=[1,0,1,0],ei.disabled=new ei(ei.Replace,h.al.transparent,[!1,!1,!1,!1]),ei.unblended=new ei(ei.Replace,h.al.transparent,[!0,!0,!0,!0]),ei.alphaBlended=new ei([1,771,1,771],h.al.transparent,[!0,!0,!0,!0]),ei.alphaBlendedNonPremultiplied=new ei([770,771,770,771],h.al.transparent,[!0,!0,!0,!0]),ei.multiply=new ei([774,0,774,0],h.al.transparent,[!0,!0,!0,!0]);class cn{constructor(s,c,_){this.func=s,this.mask=c,this.range=_}}cn.ReadOnly=!1,cn.ReadWrite=!0,cn.disabled=new cn(519,cn.ReadOnly,[0,1]);class Rn{constructor(s,c,_,v,x,E){this.test=s,this.ref=c,this.mask=_,this.fail=v,this.depthFail=x,this.pass=E}}Rn.disabled=new Rn({func:519,mask:0},0,0,7680,7680,7680);class Mn{constructor(s,c,_){this.enable=s,this.mode=c,this.frontFace=_}}function te(m,s){const c=h.bG(m,3);h.ad.mat4.fromQuat(m,s),h.bI(m,3,c)}function vc(m,s){const c=h.ad.quat.identity([]);return h.ad.quat.rotateZ(c,c,-s),h.ad.quat.rotateX(c,c,-m),c}function Wd(m,s){const c=[m[0],m[1],0],_=[s[0],s[1],0];if(h.ad.vec3.length(c)>=1e-15){const E=h.ad.vec3.normalize([],c);h.ad.vec3.scale(_,E,h.ad.vec3.dot(_,E)),s[0]=_[0],s[1]=_[1]}const v=h.ad.vec3.cross([],s,m);if(h.ad.vec3.len(v)<1e-15)return null;const x=Math.atan2(-v[1],v[0]);return vc(Math.atan2(Math.sqrt(m[0]*m[0]+m[1]*m[1]),-m[2]),x)}Mn.disabled=new Mn(!1,1029,2305),Mn.backCCW=new Mn(!0,1029,2305),Mn.backCW=new Mn(!0,1029,2304),Mn.frontCW=new Mn(!0,1028,2304),Mn.frontCCW=new Mn(!0,1028,2305);class zu{constructor(s,c){this.position=s,this.orientation=c}get position(){return this._position}set position(s){if(s){const c=s instanceof h.ac?s:new h.ac(s[0],s[1],s[2]);this._renderWorldCopies&&(c.x=h.bF(c.x,0,1)),this._position=c}else this._position=null}lookAtPoint(s,c){if(this.orientation=null,!this.position)return;const _=this.position,v=this._elevation?this._elevation.getAtPointOrZero(h.ac.fromLngLat(s)):0,x=h.ac.fromLngLat(s,v),E=[x.x-_.x,x.y-_.y,x.z-_.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=Wd(E,c)}setPitchBearing(s,c){this.orientation=vc(h.ak(s),h.ak(-c))}}class jh{constructor(s,c){this._transform=h.ad.mat4.identity([]),this.orientation=c,this.position=s}get mercatorPosition(){const s=this.position;return new h.ac(s[0],s[1],s[2])}get position(){const s=h.bG(this._transform,3);return[s[0],s[1],s[2]]}set position(s){var c;s&&h.bI(this._transform,3,[(c=s)[0],c[1],c[2],1])}get orientation(){return this._orientation}set orientation(s){this._orientation=s||h.ad.quat.identity([]),s&&te(this._transform,this._orientation)}getPitchBearing(){const s=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(s[0]*s[0]+s[1]*s[1]),-s[2])}}setPitchBearing(s,c){this._orientation=vc(s,c),te(this._transform,this._orientation)}forward(){const s=h.bG(this._transform,2);return[-s[0],-s[1],-s[2]]}up(){const s=h.bG(this._transform,1);return[-s[0],-s[1],-s[2]]}right(){const s=h.bG(this._transform,0);return[s[0],s[1],s[2]]}getCameraToWorld(s,c){const _=new Float64Array(16);return h.ad.mat4.invert(_,this.getWorldToCamera(s,c)),_}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(s,c,_){const v=this.position;h.ad.vec3.scale(v,v,-s);const x=new Float64Array(16);return h.ad.mat4.fromScaling(x,[_,_,_]),h.ad.mat4.translate(x,x,v),x[10]*=c,x}getWorldToCamera(s,c){const _=new Float64Array(16),v=new Float64Array(4),x=this.position;return h.ad.quat.conjugate(v,this._orientation),h.ad.vec3.scale(x,x,-s),h.ad.mat4.fromQuat(_,v),h.ad.mat4.translate(_,_,x),_[1]*=-1,_[5]*=-1,_[9]*=-1,_[13]*=-1,_[8]*=c,_[9]*=c,_[10]*=c,_[11]*=c,_}getCameraToClipPerspective(s,c,_,v){const x=new Float64Array(16);return h.ad.mat4.perspective(x,s,c,_,v),x}getCameraToClipOrthographic(s,c,_,v,x,E){const R=new Float64Array(16);return h.ad.mat4.ortho(R,s,c,_,v,x,E),R}getDistanceToElevation(s,c=!1){const _=0===s?0:h.bH(s,c?h.aT(this.position[1]):this.position[1]),v=this.forward();return(_-this.position[2])/v[2]}clone(){return new jh([...this.position],[...this.orientation])}}const Hr_BaseColor=5,Hr_MetallicRoughness=6,Hr_Normal=7,Hr_Occlusion=8,Hr_Emission=9,Hr_LUT=10,Hr_ShadowMap0=11;class ef{constructor(s=0,c=0,_=0,v=0){if(isNaN(s)||s<0||isNaN(c)||c<0||isNaN(_)||_<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=c,this.left=_,this.right=v}interpolate(s,c,_){return null!=c.top&&null!=s.top&&(this.top=h.ah(s.top,c.top,_)),null!=c.bottom&&null!=s.bottom&&(this.bottom=h.ah(s.bottom,c.bottom,_)),null!=c.left&&null!=s.left&&(this.left=h.ah(s.left,c.left,_)),null!=c.right&&null!=s.right&&(this.right=h.ah(s.right,c.right,_)),this}getCenter(s,c){const _=h.ay((this.left+s-this.right)/2,0,s),v=h.ay((this.top+c-this.bottom)/2,0,c);return new h.P(_,v)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new ef(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class La{constructor(s,c,_,v,x,E,R){this.tileSize=512,this._renderWorldCopies=void 0===x||x,this._minZoom=s||0,this._maxZoom=c||22,this._minPitch=_??0,this._maxPitch=v??60,this.setProjection(E),this.setMaxBounds(R),this.width=0,this.height=0,this._center=new h.bO(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ef,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new jh,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const s=new La(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return s._elevation=this._elevation,s._centerAltitude=this._centerAltitude,s._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,s.tileSize=this.tileSize,s.mercatorFromTransition=this.mercatorFromTransition,s.width=this.width,s.height=this.height,s.cameraElevationReference=this.cameraElevationReference,s._center=this._center,s._setZoom(this.zoom),s._seaLevelZoom=this._seaLevelZoom,s.angle=this.angle,s._fov=this._fov,s._pitch=this._pitch,s._nearZ=this._nearZ,s._farZ=this._farZ,s._averageElevation=this._averageElevation,s._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,s._unmodified=this._unmodified,s._edgeInsets=this._edgeInsets.clone(),s._camera=this._camera.clone(),s._calcMatrices(),s.freezeTileCoverage=this.freezeTileCoverage,s.frustumCorners=this.frustumCorners,s._allowWorldUnderZoom=this._allowWorldUnderZoom,s}get isOrthographic(){return"globe"!==this.projection.name&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(s){this._elevation!==s&&(this._elevation=s,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return"globe"!==this.projection.name&&!this.isOrthographic}updateElevation(s,c=!1){const _=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||_)&&this._updateCameraOnTerrain(),(s||_)&&this._constrainCamera(c),this._calcMatrices()}getProjection(){return h.aA(this.projection,["name","center","parallels"])}setProjection(s){this.projectionOptions=s||{name:"mercator"};const c=this.projection?this.getProjection():void 0;this.projection=h.bP(this.projectionOptions);const _=this.getProjection(),v=!h.bn(c,_);return v&&this._calcMatrices(),this.mercatorFromTransition=!1,v}setOrthographicProjectionAtLowPitch(s){return this._orthographicProjectionAtLowPitch!==s&&(this._orthographicProjectionAtLowPitch=s,this._calcMatrices(),!0)}setMercatorFromTransition(){const s=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=h.bP({name:"mercator"});const c=s!==this.projection.name;return c&&this._calcMatrices(),c}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(s){void 0===s?s=!0:null===s&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const s=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get cameraWorldSize(){const s=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return h.bH(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new h.P(this.width,this.height)}get bearing(){return h.bF(this.rotation,-180,180)}set bearing(s){this.rotation=s}get rotation(){return-this.angle/Math.PI*180}set rotation(s){const c=-s*Math.PI/180;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=h.ad.mat2.create(),h.ad.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(s){const c=h.ay(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=h.ak(s),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const s=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/s)}get averageElevation(){return this._averageElevation}set averageElevation(s){this._averageElevation=s,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(s){const c=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(s){this._zoom=s,this.scale=this.zoomScale(s),this.tileZoom=Math.floor(s),this.zoomFraction=s-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(s){this._tileCoverLift!==s&&(this._tileCoverLift=s)}_updateCameraOnTerrain(){const s=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,c=this.elevation&&s===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||s===Number.NEGATIVE_INFINITY&&(!c||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const _=this._elevation;c||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&_.exaggeration()&&this._centerAltitudeValidForExaggeration!==_.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*_.exaggeration(),this._centerAltitudeValidForExaggeration=_.exaggeration()):(this._centerAltitude=s||0,this._centerAltitudeValidForExaggeration=_.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const s=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],_=this.horizonLineFromTop();let v=0,x=0;for(let E=0;E<c.length;E++){const R=new h.P(c[E][0]*this.width,_+c[E][1]*(this.height-_)),F=s.pointCoordinate(R);if(!F)continue;const N=1/Math.hypot(F[0]-this._camera.position[0],F[1]-this._camera.position[1]);v+=F[3]*N,x+=N}return 0===x?NaN:v/x}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const s=this._seaLevelZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),_=this.pixelsPerMeter/this.worldSize*c,v=this._mercatorZfromZoom(s),x=this._mercatorZfromZoom(this._maxZoom),E=Math.max(v-_,x);this._setZoom(this._zoomFromMercatorZ(E))}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}computeZoomRelativeTo(s){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,s.toAltitude()));let _;_=s.z<this._camera.position[2]?[c.x,c.y,c.z]:[s.x,s.y,s.z];const v=h.ad.vec3.length(h.ad.vec3.sub([],this._camera.position,_));return h.ay(this._zoomFromMercatorZ(v),this._minZoom,this._maxZoom)}setFreeCameraOptions(s){if(!this.height||!s.position&&!s.orientation)return;this._updateCameraState();let c=!1;if(s.orientation&&!h.ad.quat.exactEquals(s.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(s.orientation)),s.position){const _=[s.position.x,s.position.y,s.position.z];h.ad.vec3.exactEquals(_,this._camera.position)||(this._setCameraPosition(_),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const s=this._camera.position,c=new zu;return c.position=new h.ac(s[0],s[1],s[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(s){if(!h.ad.quat.length(s))return!1;h.ad.quat.normalize(s,s);const c=h.ad.vec3.transformQuat([],[0,0,-1],s),_=h.ad.vec3.transformQuat([],[0,-1,0],s);if(_[2]<0)return!1;const v=Wd(c,_);return!!v&&(this._camera.orientation=v,!0)}_setCameraPosition(s){const c=this.zoomScale(this.minZoom)*this.tileSize,_=this.zoomScale(this.maxZoom)*this.tileSize,v=this.cameraToCenterDistance;s[2]=h.ay(s[2],v/_,v/c),this._camera.position=s}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,c,_){this._unmodified=!1,this._edgeInsets.interpolate(s,c,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){const c=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(s){const c=[new h.bQ(0,s)];if(this.renderWorldCopies){const _=this.pointCoordinate(new h.P(0,0)),v=this.pointCoordinate(new h.P(this.width,0)),x=this.pointCoordinate(new h.P(this.width,this.height)),E=this.pointCoordinate(new h.P(0,this.height)),R=Math.floor(Math.min(_.x,v.x,x.x,E.x)),F=Math.floor(Math.max(_.x,v.x,x.x,E.x)),N=1;for(let z=R-N;z<=F+N;z++)0!==z&&c.push(new h.bQ(z,s))}return c}isLODDisabled(s){return(!s||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(s,c,_){let v=[];const x=void 0!==_,E=!x;if(E&&this.zoom<c||x&&0===_[0]&&0===_[1])return v;const R=new Set,F=(z,U,j,W,ne)=>{const J=h.c5(U,z,j,W,ne);R.has(J)||(v.push(new h.aH(z,U,j,W,ne)),R.add(J))};for(let z=0;z<s.length;z++){const U=s[z];if(E&&U.canonical.z!==c)continue;const j=U.canonical,W=U.overscaledZ,ne=U.wrap,J=1<<j.z,oe=j.x+1<J,se=j.x>0,fe=j.y+1<J,be=j.y>0,ve=U.wrap-(se?0:1),we=U.wrap+(oe?0:1),Ee=se?j.x-1:J-1,De=oe?j.x+1:0;if(x)_[0]<0?(F(W,we,j.z,De,j.y),_[1]<0&&fe&&(F(W,ne,j.z,j.x,j.y+1),F(W,we,j.z,De,j.y+1)),_[1]>0&&be&&(F(W,ne,j.z,j.x,j.y-1),F(W,we,j.z,De,j.y-1))):_[0]>0?(F(W,ve,j.z,Ee,j.y),_[1]<0&&fe&&(F(W,ne,j.z,j.x,j.y+1),F(W,ve,j.z,Ee,j.y+1)),_[1]>0&&be&&(F(W,ne,j.z,j.x,j.y-1),F(W,ve,j.z,Ee,j.y-1))):_[1]<0&&fe?F(W,ne,j.z,j.x,j.y+1):be&&F(W,ne,j.z,j.x,j.y-1);else{const Me=U.visibleQuadrants;1&Me&&(F(W,ve,j.z,Ee,j.y),be&&(F(W,ne,j.z,j.x,j.y-1),F(W,ve,j.z,Ee,j.y-1))),2&Me&&(F(W,we,j.z,De,j.y),be&&(F(W,ne,j.z,j.x,j.y-1),F(W,we,j.z,De,j.y-1))),4&Me&&(F(W,ve,j.z,Ee,j.y),fe&&(F(W,ne,j.z,j.x,j.y+1),F(W,ve,j.z,Ee,j.y+1))),8&Me&&(F(W,we,j.z,De,j.y),fe&&(F(W,ne,j.z,j.x,j.y+1),F(W,we,j.z,De,j.y+1)))}}const N=[];for(const z of v)v.some(U=>z.isChildOf(U))||N.push(z);if(v=N.filter(z=>!s.some(U=>!!(z.overscaledZ<c&&U.isChildOf(z))||z.equals(U)||z.isChildOf(U))),E){const z=1<<c,U="globe"===this.projection.name?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),j=[z*U.x,z*U.y],W=4,ne=W*W;v=v.filter(J=>{const oe=J.canonical.x+.5-j[0],se=J.canonical.y+.5-j[1];return oe*oe+se*se<ne})}return v}coveringTiles(s){let c=this.coveringZoomLevel(s);const _=c,v=this.elevation&&this.elevation.exaggeration(),x=v&&!s.isTerrainDEM,E="mercator"===this.projection.name;if(void 0!==s.minzoom&&c<s.minzoom)return[];void 0!==s.maxzoom&&c>s.maxzoom&&(c=s.maxzoom);const R=this.locationCoordinate(this.center),F=this.center.lat,N=1<<c,z=[N*R.x,N*R.y,0],U="globe"===this.projection.name,j=!U,W=h.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,j),ne=U?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),J=N*h.bH(1,this.center.lat),oe=this._camera.position[2]/h.bH(1,this.center.lat),se=[N*ne.x,N*ne.y,oe*(j?1:J)],fe=U||v,be=this.cameraToCenterDistance/s.tileSize*(s.roundZoom?1:.502),ve=this.isLODDisabled(!0)?c:0;let we;if(this._elevation&&s.isTerrainDEM)we=1e4*this._elevation.exaggeration();else if(this._elevation){const Be=this._elevation.getMinMaxForVisibleTiles();we=Be?Be.max:this._centerAltitude}else we=this._centerAltitude;const Ee=s.isTerrainDEM?-we:this._elevation?this._elevation.getMinElevationBelowMSL():0,De=this.projection.isReprojectedInTileSpace?h.bS(this):1,Me=Be=>{const rt=new h.ac(Be.x+25e-6,Be.y,Be.z),$e=new h.ac(Be.x,Be.y+25e-6,Be.z),Je=Be.toLngLat(),dt=rt.toLngLat(),Ft=$e.toLngLat(),zt=this.locationCoordinate(Je),Bt=this.locationCoordinate(dt),en=this.locationCoordinate(Ft),In=Math.hypot(Bt.x-zt.x,Bt.y-zt.y),wt=Math.hypot(en.x-zt.x,en.y-zt.y);return Math.sqrt(In*wt)*De/25e-6},ke=Be=>{const at=we,rt=Ee;return{aabb:h.bV(this,N,0,0,0,Be,rt,at,this.projection),zoom:0,x:0,y:0,minZ:rt,maxZ:at,wrap:Be,fullyVisible:!1}},Oe=[];let et=[];const qe=c,ot=s.reparseOverscaled?_:c,lt=(oe-this._centerAltitude)*J,Ct=Be=>{if(!this._elevation||!Be.tileID||!E)return;const at=this._elevation.getMinMaxForTile(Be.tileID),rt=Be.aabb;at?(rt.min[2]=at.min,rt.max[2]=at.max,rt.center[2]=(rt.min[2]+rt.max[2])/2):(Be.shouldSplit=st(Be),Be.shouldSplit||(rt.min[2]=rt.max[2]=rt.center[2]=this._centerAltitude))},He=(Be,at)=>{if(.707*at<Be)return 1;const rt=at/Be;return rt/(1.4144271570014144+(Math.pow(1.1,rt-1.4144271570014144+1)-1)/(1.1-1)-1)},st=Be=>{if(Be.zoom<ve)return!0;if(Be.zoom===qe)return!1;if(null!=Be.shouldSplit)return Be.shouldSplit;const at=Be.aabb.distanceX(se),rt=Be.aabb.distanceY(se);let $e=lt,Je=1;if(U){$e=Be.aabb.distanceZ(se);const wt=Math.pow(2,Be.zoom),Tn=h.aT((Be.y+1)/wt),vn=h.aT(Be.y/wt),di=Math.min(Math.max(F,Tn),vn),Pi=h.ca(di)/h.ca(F);if(Je=di===F?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Pi/this._mercatorScaleRatio),this.zoom<=h.c6&&Be.zoom===qe-1&&Pi>=.9)return!0}else if(x&&($e=Be.aabb.distanceZ(se)*J),this.projection.isReprojectedInTileSpace&&_<=5){const wt=Math.pow(2,Be.zoom),Tn=Me(new h.ac((Be.x+.5)/wt,(Be.y+.5)/wt));Je=Tn>.85?1:Tn}if(!E){const wt=Math.sqrt(at*at+rt*rt+$e*$e);let Tn=(1<<qe-Be.zoom)*be*Je;return Tn*=He(Math.max($e,lt),wt),wt<Tn}let dt=Number.MAX_VALUE,Ft=0;const zt=Be.aabb.getCorners(),Bt=[];for(const wt of zt){h.ad.vec3.sub(Bt,wt,se),U||(x?Bt[2]*=J:Bt[2]=lt);const Tn=h.ad.vec3.dot(Bt,this._camera.forward());Tn<dt&&(dt=Tn,Ft=Math.abs(Bt[2]))}let en=(1<<qe-Be.zoom)*be*Je;if(en*=He(Math.max(Ft,lt),dt),dt<en)return!0;const In=Be.aabb.closestPoint(z);return In[0]===z[0]&&In[1]===z[1]};if(this.renderWorldCopies)for(let Be=1;Be<=3;Be++)Oe.push(ke(-Be)),Oe.push(ke(Be));for(Oe.push(ke(0));Oe.length>0;){const Be=Oe.pop(),at=Be.x,rt=Be.y;let $e=Be.fullyVisible;const Je=()=>"globe"===this.projection.name&&(0===Be.y||Be.y===(1<<Be.zoom)-1);if(!$e){let dt=fe?Be.aabb.intersects(W):Be.aabb.intersectsFlat(W);if(0===dt&&Je()){const Ft=new h.bT(Be.zoom,at,rt);dt=h.bU(this,N,Ft,!0).intersects(W)}if(0===dt)continue;$e=2===dt}if(Be.zoom!==qe&&st(Be))for(let dt=0;dt<4;dt++){const Ft=(at<<1)+dt%2,zt=(rt<<1)+(dt>>1),Bt={aabb:E?Be.aabb.quadrant(dt):h.bV(this,N,Be.zoom+1,Ft,zt,Be.wrap,Be.minZ,Be.maxZ,this.projection),zoom:Be.zoom+1,x:Ft,y:zt,wrap:Be.wrap,fullyVisible:$e,tileID:void 0,shouldSplit:void 0,minZ:Be.minZ,maxZ:Be.maxZ};x&&!U&&(Bt.tileID=new h.aH(Be.zoom+1===qe?ot:Be.zoom+1,Be.wrap,Be.zoom+1,Ft,zt),Ct(Bt)),Oe.push(Bt)}else{const dt=Be.zoom===qe?ot:Be.zoom;if(s.minzoom&&s.minzoom>dt)continue;let Ft=0;if(!$e){let In=fe?Be.aabb.intersectsPrecise(W):Be.aabb.intersectsPreciseFlat(W);if(0===In&&Je()){const wt=new h.bT(Be.zoom,at,rt);In=h.bU(this,N,wt,!0).intersectsPrecise(W)}if(0===In)continue;if(s.calculateQuadrantVisibility)if(W.containsPoint(Be.aabb.center))Ft=15;else for(let wt=0;wt<4;wt++)0!==Be.aabb.quadrant(wt).intersects(W)&&(Ft|=1<<wt)}const zt=z[0]-(.5+at+(Be.wrap<<Be.zoom))*(1<<c-Be.zoom),Bt=z[1]-.5-rt,en=Be.tileID?Be.tileID:new h.aH(dt,Be.wrap,Be.zoom,at,rt);s.calculateQuadrantVisibility&&(en.visibleQuadrants=Ft),et.push({tileID:en,distanceSq:zt*zt+Bt*Bt})}}if(this.fogCullDistSq){const Be=this.fogCullDistSq,at=this.horizonLineFromTop();et=et.filter(rt=>{const $e=[0,0,0,1],Je=[h.ai,h.ai,0,1],dt=this.calculateFogTileMatrix(rt.tileID.toUnwrapped());h.ad.vec4.transformMat4($e,$e,dt),h.ad.vec4.transformMat4(Je,Je,dt);const Ft=h.ad.vec4.min([],$e,Je),zt=h.ad.vec4.max([],$e,Je),Bt=h.bW(Ft,zt);if(0===Bt)return!0;let en=!1;const In=this._elevation;if(In&&Bt>Be&&0!==at){const wt=this.calculateProjMatrix(rt.tileID.toUnwrapped());let Tn;s.isTerrainDEM||(Tn=In.getMinMaxForTile(rt.tileID)),Tn||(Tn={min:Ee,max:we});const vn=h.c7(this.rotation),di=[vn[0]*h.ai,vn[1]*h.ai,Tn.max];h.ad.vec3.transformMat4(di,di,wt),en=(1-di[1])*this.height*.5<at}return Bt<Be||en})}return et.sort((Be,at)=>Be.distanceSq-at.distanceSq).map(Be=>Be.tileID)}resize(s,c){this.width=s,this.height=c,this.pixelsToGLUnits=[2/s,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log(s)/Math.LN2}project(s){const c=h.ay(s.lat,-h.bX,h.bX),_=this.projection.project(s.lng,c);return new h.P(_.x*this.worldSize,_.y*this.worldSize)}unproject(s){return this.projection.unproject(s.x/this.worldSize,s.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/h.bH(1,this.center.lat)/this.worldSize}setLocationAtPoint(s,c){let _,v;const x=this.centerPoint;if("globe"===this.projection.name){const R=this.worldSize;_=(c.x-x.x)/R,v=(c.y-x.y)/R}else{const R=this.pointCoordinate(c),F=this.pointCoordinate(x);_=R.x-F.x,v=R.y-F.y}const E=this.locationCoordinate(s);this.setLocation(new h.ac(E.x-_,E.y-v))}setLocation(s){this.center=this.coordinateLocation(s),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(s,c){return this.projection.locationPoint(this,s,c)}locationPoint3D(s,c){return this.projection.locationPoint(this,s,c,!0)}pointLocation(s){return this.coordinateLocation(this.pointCoordinate(s))}pointLocation3D(s,c){return this.coordinateLocation(this.pointCoordinate3D(s,c))}locationCoordinate(s,c){const _=c?h.bH(c,s.lat):void 0,v=this.projection.project(s.lng,s.lat);return new h.ac(v.x,v.y,_)}coordinateLocation(s){return this.projection.unproject(s.x,s.y)}pointRayIntersection(s,c){const _=c??this._centerAltitude,v=[s.x,s.y,0,1],x=[s.x,s.y,1,1];h.ad.vec4.transformMat4(v,v,this.pixelMatrixInverse),h.ad.vec4.transformMat4(x,x,this.pixelMatrixInverse);const E=x[3];h.ad.vec4.scale(v,v,1/v[3]),h.ad.vec4.scale(x,x,1/E);const R=v[2],F=x[2];return{p0:v,p1:x,t:R===F?0:(_-R)/(F-R)}}screenPointToMercatorRay(s){const c=[s.x,s.y,0,1],_=[s.x,s.y,1,1];return h.ad.vec4.transformMat4(c,c,this.pixelMatrixInverse),h.ad.vec4.transformMat4(_,_,this.pixelMatrixInverse),h.ad.vec4.scale(c,c,1/c[3]),h.ad.vec4.scale(_,_,1/_[3]),c[2]=h.bH(c[2],this._center.lat)*this.worldSize,_[2]=h.bH(_[2],this._center.lat)*this.worldSize,h.ad.vec4.scale(c,c,1/this.worldSize),h.ad.vec4.scale(_,_,1/this.worldSize),new h.as([c[0],c[1],c[2]],h.ad.vec3.normalize([],h.ad.vec3.sub([],_,c)))}rayIntersectionCoordinate(s){const{p0:c,p1:_,t:v}=s,x=h.bH(c[2],this._center.lat),E=h.bH(_[2],this._center.lat);return new h.ac(h.ah(c[0],_[0],v)/this.worldSize,h.ah(c[1],_[1],v)/this.worldSize,h.ah(x,E,v))}pointCoordinate(s,c=this._centerAltitude){return this.projection.pointCoordinate(this,s.x,s.y,c)}pointCoordinate3D(s,c){if(!this.elevation)return this.pointCoordinate(s,c);let _=this.projection.pointCoordinate3D(this,s.x,s.y);if(_)return new h.ac(_[0],_[1],_[2]);let v=0,x=this.horizonLineFromTop();if(s.y>x)return this.pointCoordinate(s,c);const E=.02*x,R=s.clone();for(let F=0;F<10&&x-v>E;F++){R.y=h.ah(v,x,.66);const N=this.projection.pointCoordinate3D(this,R.x,R.y);N?(x=R.y,_=N):v=R.y}return _?new h.ac(_[0],_[1],_[2]):this.pointCoordinate(s)}isPointAboveHorizon(s){return this.projection.isPointAboveHorizon(this,s)}isPointOnSurface(s){if(s.y<0||s.y>this.height||s.x<0||s.x>this.width)return!1;if(this.elevation||this.zoom>=h.bY)return!this.isPointAboveHorizon(s);const c=this.pointCoordinate(s);return c.y>=0&&c.y<=1}_coordinatePoint(s,c){const _=c&&this.elevation?this.elevation.getAtPointOrZero(s,this._centerAltitude):this._centerAltitude,v=[s.x*this.worldSize,s.y*this.worldSize,_+s.toAltitude(),1];return h.ad.vec4.transformMat4(v,v,this.pixelMatrix),v[3]>0?new h.P(v[0]/v[3],v[1]/v[3]):new h.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:s,left:c}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,v=this.width-this._edgeInsets.right,x=this.pointLocation3D(new h.P(c,s)),E=this.pointLocation3D(new h.P(v,s)),R=this.pointLocation3D(new h.P(v,_)),F=this.pointLocation3D(new h.P(c,_));let N=Math.min(x.lng,E.lng,R.lng,F.lng),z=Math.max(x.lng,E.lng,R.lng,F.lng),U=Math.min(x.lat,E.lat,R.lat,F.lat),j=Math.max(x.lat,E.lat,R.lat,F.lat);const W=Math.pow(2,-this.zoom)/16*270,ne="globe"===this.projection.name?1:4,J=(oe,se,fe,be,ve)=>{const we=(oe+fe)/2,Ee=(se+be)/2,De=new h.P(we,Ee),{lng:Me,lat:ke}=this.pointLocation3D(De),Oe=Math.max(0,N-Me,U-ke,Me-z,ke-j);N=Math.min(N,Me),z=Math.max(z,Me),U=Math.min(U,ke),j=Math.max(j,ke),(ve<ne||Oe>W)&&(J(oe,se,we,Ee,ve+1),J(we,Ee,fe,be,ve+1))};if(J(c,s,v,s,1),J(v,s,v,_,1),J(v,_,c,_,1),J(c,_,c,s,1),"globe"===this.projection.name){const[oe,se]=h.bZ(this);oe?(j=90,z=180,N=-180):se&&(U=-90,z=180,N=-180)}return new h.aB(new h.bO(N,U),new h.bO(z,j))}_getBoundsRectangular(s,c){const{top:_,left:v}=this._edgeInsets,x=this.height-this._edgeInsets.bottom,E=this.width-this._edgeInsets.right,R=new h.P(v,_),F=new h.P(E,_),N=new h.P(E,x),z=new h.P(v,x);let U=this.pointCoordinate(R,s),j=this.pointCoordinate(F,s);const W=this.pointCoordinate(N,c),ne=this.pointCoordinate(z,c),J=(oe,se)=>(se.y-oe.y)/(se.x-oe.x);return U.y>1&&j.y>=0?U=new h.ac((1-ne.y)/J(ne,U)+ne.x,1):U.y<0&&j.y<=1&&(U=new h.ac(-ne.y/J(ne,U)+ne.x,0)),j.y>1&&U.y>=0?j=new h.ac((1-W.y)/J(W,j)+W.x,1):j.y<0&&U.y<=1&&(j=new h.ac(-W.y/J(W,j)+W.x,0)),(new h.aB).extend(this.coordinateLocation(U)).extend(this.coordinateLocation(j)).extend(this.coordinateLocation(ne)).extend(this.coordinateLocation(W))}_getBoundsRectangularTerrain(){const s=this.elevation;if(!s.visibleDemTiles.length||s.isUsingMockSource())return this._getBoundsRectangular(0,0);const c=s.visibleDemTiles.reduce((_,v)=>{if(v.dem){const x=v.dem.tree;_.min=Math.min(_.min,x.minimums[0]),_.max=Math.max(_.max,x.maximums[0])}return _},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(c.min*s.exaggeration(),c.max*s.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(s=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,_=this.height/2-c*(1-this._horizonShift);return s?Math.max(0,_):_}getMaxBounds(){return this.maxBounds}setMaxBounds(s){this.maxBounds=s,this.minLat=-h.bX,this.maxLat=h.bX,this.minLng=-180,this.maxLng=180,s&&(this.minLat=s.getSouth(),this.maxLat=s.getNorth(),this.minLng=s.getWest(),this.maxLng=s.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=h.av(this.minLng)*this.tileSize,this.worldMaxX=h.av(this.maxLng)*this.tileSize,this.worldMinY=h.aC(this.maxLat)*this.tileSize,this.worldMaxY=h.aC(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(s,c){return this.projection.createTileMatrix(this,c,s)}calculateDistanceTileData(s){const c=s.key,_=this._distanceTileDataCache;if(_[c])return _[c];const v=s.canonical,x=1/this.height,E=this.cameraWorldSize,R=E/this.zoomScale(v.z),F=(v.x+Math.pow(2,v.z)*s.wrap)*R,N=v.y*R,z=this.point;z.x*=E/this.worldSize,z.y*=E/this.worldSize;const U=this.angle,j=Math.sin(-U),W=-Math.cos(-U);return _[c]={bearing:[j,W],center:[(z.x-F)*x,(z.y-N)*x],scale:R/h.ai*x},_[c]}calculateFogTileMatrix(s){const c=s.key,_=this._fogTileMatrixCache;if(_[c])return _[c];const v=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,s);return h.ad.mat4.multiply(v,this.worldToFogMatrix,v),_[c]=new Float32Array(v),_[c]}calculateProjMatrix(s,c=!1,_=!1){const v=s.key;let x;if(x=_?this._expandedProjMatrixCache:c?this._alignedProjMatrixCache:this._projMatrixCache,x[v])return x[v];const E=this.calculatePosMatrix(s,this.worldSize);let R;return R=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:_?this.expandedFarZProjMatrix:c?this.alignedProjMatrix:this.projMatrix,h.ad.mat4.multiply(E,R,E),x[v]=new Float32Array(E),x[v]}calculatePixelsToTileUnitsMatrix(s){const c=s.tileID.key,_=this._pixelsToTileUnitsCache;if(_[c])return _[c];const v=h.b_(s,this);return _[c]=v,_[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const s=1/this.worldSize,c=h.ad.mat4.fromScaling([],[s,s,s]);return h.ad.mat4.multiply(c,c,this.globeMatrix),c}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const s=this._elevation;this._updateCameraState();const c=h.bH(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(c),v=this._camera.forward(),x=h.bH(1,this._center.lat);_[2]/=x,v[2]/=x,h.ad.vec3.normalize(v,v);const E=s.raycast(_,v,s.exaggeration());if(E){const R=h.ad.vec3.scaleAndAdd([],_,v,E),F=new h.ac(R[0],R[1],h.bH(R[2],h.aT(R[1]))),N=(F.z+h.ad.vec3.length([F.x-_[0],F.y-_[1],F.z-_[2]*x]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(N),this._centerAltitude=F.toAltitude(),this._center=this.coordinateLocation(F),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(s=!1){if(!this._elevation)return;const c=this._elevation,_=h.bH(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(_),x=c.getAtPointOrZero(new h.ac(...v)),E=this.pixelsPerMeter/this.worldSize*x,R=this._minimumHeightOverTerrain(),F=v[2]-E;if(F<=R)if(F<0||s){const N=this.locationCoordinate(this._center,this._centerAltitude),z=[v[0],v[1],N.z-v[2]],U=h.ad.vec3.length(z);z[2]-=(R-F)/this._pixelsPerMercatorPixel;const j=h.ad.vec3.length(z);if(0===j)return;h.ad.vec3.scale(z,z,U/j*this._pixelsPerMercatorPixel),this._camera.position=[v[0],v[1],N.z*this._pixelsPerMercatorPixel-z[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const s="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||s){const j=this.center;return j.lat=h.ay(j.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!s)&&(j.lng=h.ay(j.lng,this.minLng,this.maxLng)),this.center=j,void(this._constraining=!1)}const c=this._unmodified,{x:_,y:v}=this.point;let x=0,E=_,R=v;const F=this.width/2,N=this.height/2,z=this.worldMinY*this.scale,U=this.worldMaxY*this.scale;if(v-N<z&&(R=z+N),v+N>U&&(R=U-N),U-z<this.height&&(x=Math.max(x,this.height/(U-z)),R=(U+z)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const j=this.worldMinX*this.scale,W=this.worldMaxX*this.scale,ne=this.worldSize/2-(j+W)/2;E=(_+ne+this.worldSize)%this.worldSize-ne,E-F<j&&(E=j+F),E+F>W&&(E=W-F),W-j<this.width&&(x=Math.max(x,this.width/(W-j)),E=(W+j)/2)}E===_&&R===v||this._allowWorldUnderZoom||(this.center=this.unproject(new h.P(E,R))),x&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(x)),this._constrainCamera(),this._unmodified=c,this._constraining=!1}_minZoomForBounds(){let s=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(s=Math.max(s,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),s}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const s=this.centerOffset,c="globe"===this.projection.name,_=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=h.bH(1,this.center.lat)/h.bH(1,h.c8));const v=h.b$(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,v),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const x="meters"===this.projection.zAxisUnit?_:1,E=this._camera.getWorldToCamera(this.worldSize,x);let R;const F=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(F[8]=2*-s.x/this.width,F[9]=2*s.y/this.height,this.isOrthographic){let ke=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Oe=ke*this.aspect,et=-Oe,qe=-ke;Oe-=s.x,et-=s.x,ke+=s.y,qe+=s.y,R=this._camera.getCameraToClipOrthographic(et,Oe,qe,ke,this._nearZ,this._farZ),((ot,lt,Ct,He)=>{for(let st=0;st<16;st++)ot[st]=h.ah(lt[st],Ct[st],He)})(R,R,F,h.c9(this.pitch>=15?1:this.pitch/15))}else R=F;const N=h.ad.mat4.mul([],F,E);let z=h.ad.mat4.mul([],R,E);if(this.projection.isReprojectedInTileSpace){const ke=this.locationCoordinate(this.center),Oe=h.ad.mat4.identity([]);h.ad.mat4.translate(Oe,Oe,[ke.x*this.worldSize,ke.y*this.worldSize,0]),h.ad.mat4.multiply(Oe,Oe,h.c0(this)),h.ad.mat4.translate(Oe,Oe,[-ke.x*this.worldSize,-ke.y*this.worldSize,0]),h.ad.mat4.multiply(z,z,Oe),h.ad.mat4.multiply(N,N,Oe),this.inverseAdjustmentMatrix=h.c1(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=h.ad.mat4.scale([],z,[this.worldSize,this.worldSize,this.worldSize/x,1]),this.projMatrix=z,this.invProjMatrix=h.ad.mat4.invert(new Float64Array(16),this.projMatrix),c){const ke=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);ke[8]=2*-s.x/this.width,ke[9]=2*s.y/this.height,this.expandedFarZProjMatrix=h.ad.mat4.mul([],ke,E)}else this.expandedFarZProjMatrix=this.projMatrix;const U=h.ad.mat4.invert([],R);this.frustumCorners=h.c2.fromInvProjectionMatrix(U,this.horizonLineFromTop(),this.height),this.cameraFrustum=h.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!c);const j=new Float32Array(16);h.ad.mat4.identity(j),h.ad.mat4.scale(j,j,[1,-1,1]),h.ad.mat4.rotateX(j,j,this._pitch),h.ad.mat4.rotateZ(j,j,this.angle);const W=h.ad.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=h.ad.mat4.clone(W);const ne=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;W[8]=2*-s.x/this.width,W[9]=2*(s.y+ne)/this.height,this.skyboxMatrix=h.ad.mat4.multiply(j,W,j);const J=this.point,oe=J.x,se=J.y,fe=this.width%2/2,be=this.height%2/2,ve=Math.cos(this.angle),we=Math.sin(this.angle),Ee=oe-Math.round(oe)+ve*fe+we*be,De=se-Math.round(se)+ve*be+we*fe,Me=new Float64Array(z);if(h.ad.mat4.translate(Me,Me,[Ee>.5?Ee-1:Ee,De>.5?De-1:De,0]),this.alignedProjMatrix=Me,z=h.ad.mat4.create(),h.ad.mat4.scale(z,z,[this.width/2,-this.height/2,1]),h.ad.mat4.translate(z,z,[1,-1,0]),this.labelPlaneMatrix=z,z=h.ad.mat4.create(),h.ad.mat4.scale(z,z,[1,-1,1]),h.ad.mat4.translate(z,z,[-1,-1,0]),h.ad.mat4.scale(z,z,[2/this.width,2/this.height,1]),this.glCoordMatrix=z,this.pixelMatrix=h.ad.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,N),this._calcFogMatrices(),this._distanceTileDataCache={},z=h.ad.mat4.invert(new Float64Array(16),this.pixelMatrix),!z)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=z,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=h.c3(this);const ke=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=h.ad.vec3.transformMat4(ke,ke,E),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=z;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const s=this.cameraWorldSizeForFog,c=this.cameraPixelsPerMeter,_=this._camera.position,v=1/this.height/this._pixelsPerMercatorPixel,x=[s,s,c];h.ad.vec3.scale(x,x,v),h.ad.vec3.scale(_,_,-1),h.ad.vec3.multiply(_,_,x);const E=h.ad.mat4.create();h.ad.mat4.translate(E,E,_),h.ad.mat4.scale(E,E,x),this.mercatorFogMatrix=E,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(s,c,v)}_computeCameraPosition(s){const c=(s=s||this.pixelsPerMeter)/this.pixelsPerMeter,_=this._camera.forward(),v=this.point,x=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*c-s/this.worldSize*this._centerAltitude;return[v.x/this.worldSize-_[0]*x,v.y/this.worldSize-_[1]*x,s/this.worldSize*this._centerAltitude-_[2]*x]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(s){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),_=this._camera.position[2],v=s[2];let x=1;this.projection.wrap&&(this.center=this.center.wrap()),v>0&&(x=Math.min((c-_)/v,1)),this._camera.position=h.ad.vec3.scaleAndAdd([],this._camera.position,s,x),this._updateStateFromCamera()}_updateStateFromCamera(){const s=this._camera.position,c=this._camera.forward(),{pitch:_,bearing:v}=this._camera.getPitchBearing(),x=h.bH(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,E=this._mercatorZfromZoom(this._maxZoom)*Math.cos(h.ak(this._maxPitch)),R=Math.max((s[2]-x)/Math.cos(_),E),F=this._zoomFromMercatorZ(R);h.ad.vec3.scaleAndAdd(s,s,c,R),this._pitch=h.ay(_,h.ak(this.minPitch),h.ak(this.maxPitch)),this.angle=h.bF(v,-Math.PI,Math.PI),this._setZoom(h.ay(F,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new h.ac(s[0],s[1],s[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(s){return Math.pow(2,s)*this.tileSize}_mercatorZfromZoom(s){return this.cameraToCenterDistance/this._worldSizeFromZoom(s)}_minimumHeightOverTerrain(){const s=Math.min(null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(s)}_zoomFromMercatorZ(s){return this.scaleZoom(this.cameraToCenterDistance/(s*this.tileSize))}zoomFromMercatorZAdjusted(s){let c=0,_=h.bY,v=0,x=1/0;for(;_-c>1e-6&&_>c;){const E=c+.5*(_-c),R=this.tileSize*Math.pow(2,E),F=this.getCameraToCenterDistance(this.projection,E,R),N=this.scaleZoom(F/(s*this.tileSize)),z=Math.abs(E-N);z<x&&(x=z,v=E),E<N?c=E:_=E}return v}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(h.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(s,c){const _=Math.min(s.x,c.x),v=Math.max(s.x,c.x),x=Math.min(s.y,c.y),E=Math.max(s.y,c.y);if(x<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const R=[new h.P(_,x),new h.P(v,E),new h.P(_,E),new h.P(v,x)],F=this.renderWorldCopies?-3:0,N=this.renderWorldCopies?4:1;for(const z of R){const U=this.pointRayIntersection(z);if(U.t<0)return!0;const j=this.rayIntersectionCoordinate(U);if(j.x<F||j.y<0||j.x>N||j.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+h.c4(this.fovAboveCenter)>88||this.anyCornerOffEdge(new h.P(0,0),new h.P(this.width,this.height))}zoomDeltaToMovement(s,c){const _=h.ad.vec3.length(h.ad.vec3.sub([],this._camera.position,s)),v=this._zoomFromMercatorZ(_)+c;return _-this._mercatorZfromZoom(v)}getCameraPoint(){if("globe"===this.projection.name){const s=function([c,_,v],x){const E=[c,_,v,1];h.ad.vec4.transformMat4(E,E,x);const R=E[3]=Math.max(E[3],1e-6);return E[0]/=R,E[1]/=R,E[2]/=R,E}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new h.P(s[0],s[1])}{const s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new h.P(0,s))}}getCameraToCenterDistance(s,c=this.zoom,_=this.worldSize){const v=h.b$(s,c,this.width,this.height,1024),x=s.pixelSpaceConversion(this.center.lat,_,v);let E=.5/Math.tan(.5*this._fov)*this.height*x;return this.isOrthographic&&(E=h.ah(1,E,h.c9(this.pitch>=15?1:this.pitch/15))),E}getWorldToCameraMatrix(){const s=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&h.ad.mat4.multiply(s,s,this.globeMatrix),s}getFrustum(s){return h.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s,"meters"===this.projection.zAxisUnit)}}const Qc=(m,s)=>{if(s>0&&m.terrain&&h.w("Cutoff is currently disabled on terrain"),s<=0||m.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const c=m.transform,_=Math.max(Math.abs(c._zoom-(m.minCutoffZoom-1)),1),v=c.isLODDisabled(!1)?h.ae(60,45,c.pitch):h.ae(30,15,c.pitch),x=c._farZ-c._nearZ,E=s*c.height,R=((1-(F=v))*c.cameraToCenterDistance+F*(c._farZ+E))*_;var F;return{shouldRenderCutoff:v<1,uniformValues:{u_cutoff_params:[c._nearZ,c._farZ,(R-c._nearZ)/x,(R-E-c._nearZ)/x]}}},no={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class wv{constructor(s,c){this.aabb=s,this.lastCascade=c}}class bc{add(s,c){const _=this.receivers[s.key];void 0!==_?(_.aabb.min[0]=Math.min(_.aabb.min[0],c.min[0]),_.aabb.min[1]=Math.min(_.aabb.min[1],c.min[1]),_.aabb.min[2]=Math.min(_.aabb.min[2],c.min[2]),_.aabb.max[0]=Math.max(_.aabb.max[0],c.max[0]),_.aabb.max[1]=Math.max(_.aabb.max[1],c.max[1]),_.aabb.max[2]=Math.max(_.aabb.max[2],c.max[2])):this.receivers[s.key]=new wv(c,null)}clear(){this.receivers={}}get(s){return this.receivers[s.key]}computeRequiredCascades(s,c,_){const v=h.ce.fromPoints(s.points);let x=0;for(const E in this.receivers){const R=this.receivers[E];if(!R||!v.intersectsAabb(R.aabb))continue;R.aabb.min=v.closestPoint(R.aabb.min),R.aabb.max=v.closestPoint(R.aabb.max);const F=R.aabb.getCorners();for(let N=0;N<_.length;N++){let z=!0;for(const U of F){const j=[U[0]*c,U[1]*c,U[2]];if(h.ad.vec3.transformMat4(j,j,_[N].matrix),j[0]<-1||j[0]>1||j[1]<-1||j[1]>1){z=!1;break}}if(R.lastCascade=N,x=Math.max(x,N),z)break}}return x+1}}class Jc{constructor(s){this.painter=s,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new bc,this._depthMode=new cn(s.context.gl.LEQUAL,cn.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,s.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),s.tp.registerParameter(no,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),s.tp.registerParameter(no,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),s.tp.registerParameter(no,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),s.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const s of this._cascades)s.texture.destroy(),s.framebuffer.destroy();this._cascades=[]}updateShadowParameters(s,c){const _=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!c||!c.properties)return;const v=c.properties.get("shadow-intensity");if(!c.shadowsEnabled()||v<=0||(this._shadowLayerCount=_.style.order.reduce((ne,J)=>{const oe=_.style._mergedLayers[J];return ne+(oe.hasShadowPass()&&!oe.isHidden(s.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const x=_.context,E=no.shadowMapResolution,R=no.shadowMapResolution;if(0===this._cascades.length||no.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let ne=0;ne<no.cascadeCount;++ne){const J=_._shadowMapDebug,oe=x.gl,se=x.createFramebuffer(E,R,J,"texture"),fe=new h.T(x,{width:E,height:R,data:null},oe.DEPTH_COMPONENT16);if(se.depthAttachment.set(fe.texture),J){const be=new h.T(x,{width:E,height:R,data:null},oe.RGBA8);se.colorAttachment.set(be.texture)}this._cascades.push({framebuffer:se,texture:fe,matrix:[],far:0,boundingSphereRadius:0,frustum:new h.bR,scale:0})}}this.shadowDirection=Na(c);let F=0;if(s.elevation){const ne=s.elevation,J=[1e4,-1e4];ne.visibleDemTiles.filter(oe=>oe.dem).forEach(oe=>{const se=oe.dem.tree;J[0]=Math.min(J[0],se.minimums[0]),J[1]=Math.max(J[1],se.maximums[0])}),1e4!==J[0]&&(F=(J[1]-J[0])*ne.exaggeration())}const N=1.5*s.cameraToCenterDistance,z=3*N,U=new Float64Array(16);for(let ne=0;ne<this._cascades.length;++ne){const J=this._cascades[ne];let oe=s.height/50,se=1;1===no.cascadeCount?se=z:0===ne?se=N:(oe=N,se=z);const[fe,be]=ed(s,this.shadowDirection,oe,se,no.shadowMapResolution,F);J.scale=s.scale,J.matrix=fe,J.boundingSphereRadius=be,h.ad.mat4.invert(U,J.matrix),J.frustum=h.bR.fromInvProjectionMatrix(U,1,0,!0),J.far=se}const j=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[j].far,this._cascades[j].far],this._uniformValues.u_shadow_intensity=v,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/no.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=no.shadowMapResolution,this._uniformValues.u_shadowmap_0=Hr_ShadowMap0,this._uniformValues.u_shadowmap_1=Hr_ShadowMap0+1,this._groundShadowTiles=_.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const W=_.transform.elevation;for(const ne of this._groundShadowTiles){let J={min:0,max:0};if(W){const oe=W.getMinMaxForTile(ne);oe&&(J=oe)}this.addShadowReceiver(ne.toUnwrapped(),J.min,J.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(s){this._enabled=s}drawShadowPass(s,c){if(!this.enabled)return;const _=this.painter,v=_.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(_.transform.getFrustum(0),_.transform.worldSize,this._cascades),v.viewport.set([0,0,no.shadowMapResolution,no.shadowMapResolution]);for(let x=0;x<this._numCascadesToRender;++x){_.currentShadowCascade=x,v.bindFramebuffer.set(this._cascades[x].framebuffer.framebuffer),v.clear({color:h.al.white,depth:1});for(const E of s.order){const R=s._mergedLayers[E];if(!R.hasShadowPass()||R.isHidden(_.transform.zoom))continue;const F=s.getLayerSourceCache(R),N=F?c[F.id]:void 0;("model"===R.type||N&&N.length)&&_.renderLayer(_,F,R,N)}}_.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const s=this.painter,c=s.style,_=s.context,v=c.directionalLight,x=c.ambientLight;if(!v||!x)return;const E=[],R=Qc(s,s.longestCutoffRange);R.shouldRenderCutoff&&E.push("RENDER_CUTOFF"),E.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&E.push("NORMAL_OFFSET");const F=Bu(c,v,x),N=new cn(_.gl.LEQUAL,cn.ReadOnly,s.depthRangeFor3D);for(const z of this._groundShadowTiles){const U=z.toUnwrapped(),j=s.isTileAffectedByFog(z),W=s.getOrCreateProgram("groundShadow",{defines:E,overrideFog:j});this.setupShadows(U,W),s.uploadCommonUniforms(_,W,U,null,R);const ne={u_matrix:s.transform.calculateProjMatrix(U),u_ground_shadow_factor:F};W.draw(s,_.gl.TRIANGLES,N,Rn.disabled,ei.multiply,Mn.disabled,ne,"ground_shadow",s.tileExtentBuffer,s.quadTriangleIndexBuffer,s.tileExtentSegments,null,s.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?ei.unblended:ei.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(s){const c=this.painter.transform,_=c.calculatePosMatrix(s,c.worldSize);return h.ad.mat4.multiply(_,this._cascades[this.painter.currentShadowCascade].matrix,_),Float32Array.from(_)}calculateShadowPassMatrixFromMatrix(s){return h.ad.mat4.multiply(s,this._cascades[this.painter.currentShadowCascade].matrix,s),Float32Array.from(s)}setupShadows(s,c,_,v=0){if(!this.enabled)return;const x=this.painter.transform,E=this.painter.context,R=E.gl,F=this._uniformValues,N=new Float64Array(16),z=x.calculatePosMatrix(s,x.worldSize);for(let U=0;U<this._cascades.length;U++)h.ad.mat4.multiply(N,this._cascades[U].matrix,z),F[0===U?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(N),E.activeTexture.set(R.TEXTURE0+Hr_ShadowMap0+U),this._cascades[U].texture.bind(R.NEAREST,R.CLAMP_TO_EDGE);if(this.useNormalOffset=!!_,this.useNormalOffset){const U=h.cd(s.canonical),j=2/x.tileSize*h.ai/no.shadowMapResolution,W=j*this._cascades[0].boundingSphereRadius,ne=j*this._cascades[this._cascades.length-1].boundingSphereRadius,J=("vector-tile"===_?1:3)/Math.pow(2,v-s.canonical.z-(1-x.zoom+Math.floor(x.zoom)));F.u_shadow_normal_offset=[U,W*J,ne*J],F.u_shadow_bias=[6e-5,.0012,.012]}else F.u_shadow_bias=[36e-5,.0012,.012];c.setShadowUniformValues(E,F)}setupShadowsFromMatrix(s,c,_=!1){if(!this.enabled)return;const v=this.painter.context,x=v.gl,E=this._uniformValues,R=new Float64Array(16);for(let F=0;F<no.cascadeCount;F++)h.ad.mat4.multiply(R,this._cascades[F].matrix,s),E[0===F?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(R),v.activeTexture.set(x.TEXTURE0+Hr_ShadowMap0+F),this._cascades[F].texture.bind(x.NEAREST,x.CLAMP_TO_EDGE);if(this.useNormalOffset=_,_){const F=no.normalOffset;E.u_shadow_normal_offset=[1,F,F],E.u_shadow_bias=[6e-5,.0012,.012]}else E.u_shadow_bias=[36e-5,.0012,.012];c.setShadowUniformValues(v,E)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(s,c,_,v){if(v[2]>=0)return{};const x=function(F,N,z){const U=z/(1<<F.canonical.z);return new h.ce([F.canonical.x*U+F.wrap*z,F.canonical.y*U+F.wrap*z,0],[(F.canonical.x+1)*U+F.wrap*z,(F.canonical.y+1)*U+F.wrap*z,N])}(s,c,_).getCorners(),E=c/-v[2];v[0]<0?(h.ad.vec3.add(x[0],x[0],[v[0]*E,0,0]),h.ad.vec3.add(x[3],x[3],[v[0]*E,0,0])):v[0]>0&&(h.ad.vec3.add(x[1],x[1],[v[0]*E,0,0]),h.ad.vec3.add(x[2],x[2],[v[0]*E,0,0])),v[1]<0?(h.ad.vec3.add(x[0],x[0],[0,v[1]*E,0]),h.ad.vec3.add(x[1],x[1],[0,v[1]*E,0])):v[1]>0&&(h.ad.vec3.add(x[2],x[2],[0,v[1]*E,0]),h.ad.vec3.add(x[3],x[3],[0,v[1]*E,0]));const R={};return R.vertices=x,R.planes=[Jo(x[1],x[0],x[4]),Jo(x[2],x[1],x[5]),Jo(x[3],x[2],x[6]),Jo(x[0],x[3],x[7])],R}addShadowReceiver(s,c,_){this._receivers.add(s,h.ce.fromTileIdAndHeight(s,c,_))}getMaxCascadeForTile(s){const c=this._receivers.get(s);return c&&c.lastCascade?c.lastCascade:0}}function Jo(m,s,c){const _=h.ad.vec3.sub([],c,s),v=h.ad.vec3.sub([],m,s),x=h.ad.vec3.cross([],_,v),E=h.ad.vec3.length(x);return 0===E?[0,0,1,0]:(h.ad.vec3.scale(x,x,1/E),[x[0],x[1],x[2],-h.ad.vec3.dot(x,s)])}function Na(m){const s=m.properties.get("direction"),c=h.cc(s.x,s.y,s.z);c[2]=h.ay(c[2],0,75);const _=h.cf([c[0],c[1],c[2]]);return h.ad.vec3.fromValues(_.x,_.y,_.z)}function Bu(m,s,c){const _="none"===s.properties.get("color-use-theme"),v=s.properties.get("color"),x=s.properties.get("intensity"),E=s.properties.get("direction"),R=[E.x,E.y,E.z],F="none"===c.properties.get("color-use-theme"),N=c.properties.get("color"),z=c.properties.get("intensity"),U=Math.max(h.ad.vec3.dot([0,0,1],R),0),j=[0,0,0];h.ad.vec3.scale(j,N.toRenderColor(F?null:m.getLut(s.scope)).toArray01Linear().slice(0,3),z);const W=[0,0,0];return h.ad.vec3.scale(W,v.toRenderColor(_?null:m.getLut(c.scope)).toArray01Linear().slice(0,3),U*x),h.cg([j[0]>0?j[0]/(j[0]+W[0]):0,j[1]>0?j[1]/(j[1]+W[1]):0,j[2]>0?j[2]/(j[2]+W[2]):0])}function ed(m,s,c,_,v,x){const E=m.zoom,R=m.scale,F=m.worldSize,N=1/F,z=m.aspect,U=Math.sqrt(1+z*z)*Math.tan(.5*m.fovX),j=U*U,W=_-c,ne=_+c;let J,oe;j>W/ne?(J=_,oe=_*U):(J=.5*ne*(1+j),oe=.5*Math.sqrt(W*W+2*(_*_+c*c)*j+ne*ne*j*j));const se=m.projection.pixelsPerMeter(m.center.lat,F),fe=m._camera.getCameraToWorldMercator(),be=[0,0,-J*N];h.ad.vec3.transformMat4(be,be,fe);let ve=oe*N;const we=m._edgeInsets;if(!(0===we.left&&0===we.top&&0===we.right&&0===we.bottom||we.left===we.right&&we.top===we.bottom)){const $e=m._camera.getWorldToCamera(m.worldSize,"meters"===m.projection.zAxisUnit?se:1),Je=m._camera.getCameraToClipPerspective(m._fov,m.width/m.height,c,_);Je[8]=2*-m.centerOffset.x/m.width,Je[9]=2*m.centerOffset.y/m.height;const dt=new Float64Array(16);h.ad.mat4.mul(dt,Je,$e);const Ft=new Float64Array(16);h.ad.mat4.invert(Ft,dt);const zt=h.bR.fromInvProjectionMatrix(Ft,F,E,!0);for(const Bt of zt.points){const en=((Ee=Bt)[0]/=R,Ee[1]/=R,Ee[2]=h.bH(Ee[2],m._center.lat),Ee);ve=Math.max(ve,h.ad.vec3.len(h.ad.vec3.subtract([],be,en)))}}var Ee;ve*=v/(v-1);const De=Math.acos(s[2]),Me=Math.atan2(-s[0],-s[1]),ke=new jh;ke.position=be,ke.setPitchBearing(De,Me);const Oe=ke.getWorldToCamera(F,se),et=ve*F,qe=Math.min(m._mercatorZfromZoom(17)*F*-2,-2*et),ot=ke.getCameraToClipOrthographic(-et,et,-et,et,qe,(et+x*se)/s[2]),lt=new Float64Array(16);h.ad.mat4.multiply(lt,ot,Oe);const Ct=h.ad.vec3.fromValues(Math.floor(1e6*be[0])/1e6*F,Math.floor(1e6*be[1])/1e6*F,0),He=.5*v,st=[0,0,0];h.ad.vec3.transformMat4(st,Ct,lt),h.ad.vec3.scale(st,st,He);const Be=[Math.floor(st[0]),Math.floor(st[1]),Math.floor(st[2])],at=[0,0,0];h.ad.vec3.sub(at,st,Be),h.ad.vec3.scale(at,at,-1/He);const rt=new Float64Array(16);return h.ad.mat4.identity(rt),h.ad.mat4.translate(rt,rt,at),h.ad.mat4.multiply(lt,rt,lt),[lt,et]}class vm extends h.E{constructor(s){super(),this.requestManager=s,this.models={"":{}},this.modelUris={"":{}},this.numModelsLoading={}}loadModel(s,c){return h.aN(this.requestManager.transformRequest(c,h.R.Model).url).then(_=>{if(!_)return;const v=h.aO(_),x=new h.aP(s,void 0,void 0,v);return x.computeBoundsAndApplyParent(),x}).catch(_=>{if(_&&404===_.status)return null;this.fire(new h.z(new Error(`Could not load model ${s} from ${c}: ${_.message}`)))})}load(s,c,_={keepNumReferences:!1}){this.models[c]||(this.models[c]={});const v=Object.keys(s);this.numModelsLoading[c]=(this.numModelsLoading[c]||0)+v.length;const x=[];for(const E of v)x.push(this.loadModel(E,s[E]));Promise.allSettled(x).then(E=>{for(let R=0;R<E.length;R++){const{status:F,value:N}=E[R];if("fulfilled"===F&&N){const z=this.models[c][v[R]];this.models[c][v[R]]={model:N,numReferences:_.keepNumReferences&&z?z.numReferences:1}}}this.numModelsLoading[c]-=v.length,this.fire(new h.A("data",{dataType:"style"}))}).catch(E=>{this.fire(new h.z(new Error(`Could not load models: ${E.message}`)))})}isLoaded(){for(const s in this.numModelsLoading)if(this.numModelsLoading[s]>0)return!1;return!0}hasModel(s,c){return!!this.getModel(s,c)}getModel(s,c){return this.models[c]||(this.models[c]={}),this.models[c][s]?this.models[c][s].model:void 0}addModel(s,c,_){this.models[_]||(this.models[_]={}),this.modelUris[_]||(this.modelUris[_]={}),this.hasModel(s,_)&&this.models[_][s].numReferences++,this.modelUris[_][s]=this.requestManager.normalizeModelURL(c),this.load({[s]:this.modelUris[_][s]},_)}addModels(s,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});const _=this.modelUris[c];for(const v in s)this.models[c][v]={},_[v]=this.requestManager.normalizeModelURL(s[v]);this.load(_,c,{keepNumReferences:!0})}reloadModels(s){this.load(this.modelUris[s],s)}addModelsFromBucket(s,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});const _={};for(const v of s)this.hasModel(v,c)?this.models[c][v].numReferences++:(this.modelUris[c][v]=this.requestManager.normalizeModelURL(v),_[v]=this.modelUris[c][v]);this.load(_,c)}removeModel(s,c){if(this.models[c]&&this.models[c][s]&&(this.models[c][s].numReferences--,0===this.models[c][s].numReferences)){const _=this.models[c][s].model;delete this.models[c][s],delete this.modelUris[c][s],_.destroy()}}listModels(s){return this.models[s]||(this.models[s]={}),Object.keys(this.models[s])}upload(s,c){this.models[c]||(this.models[c]={});for(const _ in this.models[c])this.models[c][_].model&&this.models[c][_].model.upload(s.context)}}const Cv=new h.a7({data:new h.a8(h.a5.colorTheme.data)}),bm={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function pa(m){return m=m||{},Object.assign(m,bm)}class xm extends h.E{constructor(s){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._selectedLevel=void 0,this._floorplanStates={},h.aQ(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=s,this._checkFloorplanVisible(!0),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(s=>{s.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new h.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=s.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=s.stylesheet.indoor.buildingFeaturesetId,this._scope=s.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:s=>(s.feature&&s.feature.properties.floorplan&&this.selectFloorplan(s.feature.properties.floorplan),!0)}),this._checkFloorplanVisible(!0)}_onMove(){this._checkFloorplanVisible(!1)}_checkFloorplanVisible(s){if(!this._queryFeatureSetId||!this._map.isStyleLoaded()||this._map.transform.zoom<13)return;this._indoorData&&!function(E,R){const[F,N]=E,{center:z,radius:U}=R,[j,W]=z,ne=Math.abs(F-j);return Math.sqrt((ne>180?360-ne:ne)**2+(N-W)**2)<=U}([this._map.getCenter().lng,this._map.getCenter().lat],this._indoorData.circumCircle)&&(this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new h.A("floorplangone")));const c={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},_=new h.P(this._map.transform.width/2,this._map.transform.height/2),v=[new h.P(0,0),new h.P(this._map.transform.width,this._map.transform.height)],x=this._map.queryRenderedFeatures(s?v:_,c);x.length>0&&(this._selectedFloorplan&&x[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=x[0],this._floorplanSelected(!1)))}_floorplanSelected(s){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._indoorData.circumCircle=function(x){const[[E,R],[F,N]]=x,z=(F-E+360)%360,U=z>180?360-z:z;return{center:[(E+U/2+360)%360,(R+N)/2],radius:Math.sqrt(U**2+(N-R)**2)/2}}(this._indoorData.extent),this._floorplanStates[this._indoorData.id]||(this._floorplanStates[this._indoorData.id]={});const c=this._floorplanStates[this._indoorData.id].selectedBuilding,_=this._floorplanStates[this._indoorData.id].selectedLevel;let v;if(this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",this._indoorData.floorplanIDs),this._selectedLevel)for(const x of this._indoorData.levels)x.id===this._selectedLevel.id&&(v=x.id);if(this.fire(new h.A("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:v})),c){const x=this._indoorData.buildings.find(E=>E.id===c);this._buildingSelected(x,!1)}else this._indoorData.buildings.length>0&&this._buildingSelected(this._indoorData.buildings[0],!1);if(_){const x=this._indoorData.levels.find(E=>E.id===_);this._updateLevels(x,s)}else s&&this._indoorData["default-levels"].length>0&&this.selectLevel(this._indoorData["default-levels"][0])}_buildingSelected(s,c){c&&s&&s.extent&&this._map.fitBounds(s.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=s?s.id:void 0;const _=this._indoorData.levels.filter(v=>s.levels.includes(v.id));this.fire(new h.A("buildingselected",{buildingId:s.id,levels:_}))}_levelSelected(s){if("overview"===s)this._updateLevels(void 0,!0);else{const c=this._indoorData.levels.find(_=>_.id===s);this._updateLevels(c,!0)}this.fire(new h.A("levelselected",{levelId:"overview"===s?void 0:s}))}_updateLevels(s,c){if(!s)return this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",[]]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._floorplanStates[this._indoorData.id].selectedLevel=void 0,void(c&&this._indoorData.extent&&this._map.fitBounds(this._indoorData.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}));function _(N){const z=N.indexOf("/floor/");if(-1===z)return N;const U=z+7,j=N.indexOf("/",U);return-1===j?N.slice(U):N.slice(U,j)}this._selectedLevel=s,this._floorplanStates[this._indoorData.id].selectedLevel=s?s.id:void 0;const v=[],x={},E={},R={},F={};for(const N of this._indoorData.levels)if(v.push(N.id),x[N.id]=N.height,E[N.id]=N.base,s){if(this.mergeFloors){const z=_(s.id),U=_(N.id);R[N.id]=U===z?"true":"false"}else R[N.id]=N.id===s.id?"true":"false";F[N.id]=N.base<s.base?"true":"false"}else F[N.id]=!0;if(this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",v]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",x]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",E]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",R]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",F]),s&&(this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!!s.isUnderground),c&&s.extent)){const N=this._map.cameraForBounds(s.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),z=this._map.getZoom(),U=N.zoom?Math.abs(z-N.zoom):0;this._map.fitBounds(s.extent,U>=1?{pitch:this._map.getPitch(),bearing:this._map.getBearing()}:{pitch:this._map.getPitch(),bearing:this._map.getBearing(),zoom:z})}}selectFloorplan(s){const c={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},_=[new h.P(0,0),new h.P(this._map.transform.width,this._map.transform.height)],v=this._map.queryRenderedFeatures(_,c);if(v.length>0)for(const x of v)if(JSON.parse(x.properties["indoor-data"]).floorplanIDs.includes(s)){this._selectedFloorplan=x,this._floorplanSelected(!0);break}}selectBuilding(s){const c=this._indoorData.buildings.find(_=>_.id===s);this._buildingSelected(c,!0)}selectLevel(s){this._levelSelected(s)}}function Hh(m){if(!m.metadata||!m.metadata.content_area)return;const s=h.q.devicePixelRatio,{left:c,top:_,width:v,height:x}=m.metadata.content_area,E=c*s,R=_*s;return[E,R,E+v*s,R+x*s]}function wm(m){if(m)return m.map(([s,c])=>[s*h.q.devicePixelRatio,c*h.q.devicePixelRatio])}class $l{constructor(s,c){this.id=s,this.style=c}addIcons(s){const c=new Map;for(const[_,v]of s.entries()){const x=h.I.from({name:_,iconsetId:this.id});c.set(x,v)}this.style.addImages(c)}}const or=(m,s)=>Ke(m,s&&s.filter(c=>"source.canvas"!==c.identifier)),dl=h.aA(Ti,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport"]),Ev=h.aA(Ti,["setCenter","setZoom","setBearing","setPitch"]),$h=new Set(["background","sky","slot","custom"]),tf={version:8,layers:[],sources:{}},Ms={duration:300,delay:0};class bi extends h.E{constructor(s,c={}){super(),this.map=s,this.scope=c.scope||"",this.globalId=null,this.fragments=[],this.importDepth=c.importDepth||0,this.importsCache=c.importsCache||new Map,this.resolvedImports=c.resolvedImports||new Set,this.transition=h.l({},Ms),this._buildingIndex=new yx(this),this.crossTileSymbolIndex=new xv,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=c.styleChanges||new Nd,this.dispatcher=c.dispatcher?c.dispatcher:new h.D(h.cj(),this),c.imageManager?this.imageManager=c.imageManager:(this.imageManager=new Bl(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=c.glyphManager?c.glyphManager:new h.ck(s._requestManager,c.localFontFamily?h.cl.all:c.localIdeographFontFamily?h.cl.ideographs:h.cl.none,c.localFontFamily||c.localIdeographFontFamily),c.modelManager?this.modelManager=c.modelManager:(this.modelManager=new vm(s._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=c.configOptions?c.configOptions:new Map,this._configDependentLayers=c.configDependentLayers?c.configDependentLayers:new Set,this._config=c.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:c.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=c.initialConfig,this.dispatcher.broadcast("setReferrer",h.cm());const _=this;this._rtlTextPluginCallback=bi.registerForPluginStateChange(v=>{_.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},(x,E)=>{if(h.cn(x),E&&E.every(R=>R))for(const R in _._sourceCaches){const F=_._sourceCaches[R],N=F.getSource().type;"vector"!==N&&"geojson"!==N||F.reload()}})}),this.on("data",v=>{if("source"!==v.dataType||"metadata"!==v.sourceDataType)return;const x=this.getOwnSource(v.sourceId);if(x&&x.vectorLayerIds)for(const E in this._layers){const R=this._layers[E];R.source===x.id&&this._validateLayer(R)}})}load(s){return s?("string"==typeof s?this.loadURL(s):this.loadJSON(s),this):this}_getGlobalId(s){if(!s)return null;if("string"==typeof s){if(h.f(s))return s;const c=h.co(s);if(!c.startsWith("http"))try{return new URL(c,location.href).toString()}catch{return c}return c}return`json://${h.cp(JSON.stringify(s))}`}_diffStyle(s,c,_){this.globalId=this._getGlobalId(s);const v=(x,E)=>{try{E(null,this.setState(x,_))}catch(R){E(R,!1)}};if("string"==typeof s){const x=this.map._requestManager.normalizeStyleURL(s),E=this.map._requestManager.transformRequest(x,h.R.Style);h.n(E,(R,F)=>{R?this.fire(new h.z(R)):F&&v(F,c)})}else"object"==typeof s&&v(s,c)}loadURL(s,c={}){this.fire(new h.A("dataloading",{dataType:"style"}));const _="boolean"==typeof c.validate?c.validate:!h.f(s);this.globalId=this._getGlobalId(s),s=this.map._requestManager.normalizeStyleURL(s,c.accessToken),this.resolvedImports.add(s);const v=this.importsCache.get(s);if(v)return this._load(v,_);const x=this.map._requestManager.transformRequest(s,h.R.Style);this._request=h.n(x,(E,R)=>{if(this._request=null,E)this.fire(new h.z(E));else if(R)return this.importsCache.set(s,R),this._load(R,_)})}loadJSON(s,c={}){this.fire(new h.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(s),this._request=h.q.frame(()=>{this._request=null,this._load(s,!1!==c.validate)})}loadEmpty(){this.fire(new h.A("dataloading",{dataType:"style"})),this._load(tf,!1)}_loadImports(s,c,_){if(this.importDepth>=4)return h.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const v=[];for(const x of s){const E=this._createFragmentStyle(x),R=new Promise(z=>{E.once("style.import.load",z),E.once("error",z)}).then(()=>this.mergeAll());if(v.push(R),this.resolvedImports.has(x.url)){E.loadEmpty();continue}const F=x.data||this.importsCache.get(x.url);F?(E.loadJSON(F,{validate:c}),this._isInternalStyle(F)&&(E.globalId=null)):x.url?E.loadURL(x.url,{validate:c}):E.loadEmpty();const N={style:E,id:x.id,config:x.config};if(_){const z=this.fragments.findIndex(({id:U})=>U===_);this.fragments=this.fragments.slice(0,z).concat(N).concat(this.fragments.slice(z))}else this.fragments.push(N)}return Promise.allSettled(v)}getImportGlobalIds(s=this,c=new Set){for(const _ of s.fragments)_.style.globalId&&c.add(_.style.globalId),this.getImportGlobalIds(_.style,c);return[...c.values()]}_createFragmentStyle(s){const c=this.scope?h.C(s.id,this.scope):s.id;let _;const v=this._initialConfig&&this._initialConfig[c];(s.config||v)&&(_=h.l({},s.config,v));const x=new bi(this.map,{scope:c,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:_,configOptions:this.options,colorThemeOverride:s["color-theme"],configDependentLayers:this._configDependentLayers});return x.setEventedParent(this.map,{style:x}),x}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(s){return this.isRootStyle()&&(s.fragment||!!s.schema&&!1!==s.fragment)}_load(s,c){const _=s.indoor?pa(s.schema):s.schema;if(this._isInternalStyle(s)){const E=h.l({},tf,{imports:[{id:"basemap",data:s,url:""}]});return void this._load(E,c)}if(this.updateConfig(this._config,_),c&&or(this,ws(s)))return;this._loaded=!0,this.stylesheet=h.cq(s);const v=()=>{for(const N in s.sources)this.addSource(N,s.sources[N],{validate:!1,isInitialLoad:!0});if(s.iconsets)for(const N in s.iconsets)this.addIconset(N,s.iconsets[N]);s.sprite?this._loadIconset(s.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.setGlyphsUrl(s.glyphs);const E=mm(this.stylesheet.layers);if(this._order=E.map(N=>N.id),this.stylesheet.light&&h.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(1===this.stylesheet.lights.length&&"flat"===this.stylesheet.lights[0].type){const N=this.stylesheet.lights[0];this.light=new tt(N.properties,N.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new tt(this.stylesheet.light)),this._layers={};for(const N of E){const z=h.cv(N,this.scope,this._styleColorTheme.lut,this.options);0!==z.configDependencies.size&&this._configDependentLayers.add(z.fqid),z.setEventedParent(this,{layer:{id:z.id}}),this._layers[z.id]=z;const U=this.getOwnLayerSourceCache(z),j=!!this.directionalLight&&this.directionalLight.shadowsEnabled();U&&z.canCastShadows()&&j&&(U.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const R=this.stylesheet.terrain;R&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(R,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new h.A("data",{dataType:"style"}));const F=this.isRootStyle();s.imports?this._loadImports(s.imports,c).then(()=>{this._reloadImports(),this.fire(new h.A(F?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new h.A(F?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const x=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(x){const E=this._evaluateColorThemeData(x);this._loadColorTheme(E).then(()=>{v()}).catch(R=>{h.w(`Couldn't load color theme from the stylesheet: ${R}`),v()})}else this._styleColorTheme.lut=null,v()}isRootStyle(){return 0===this.importDepth}mergeAll(){let s,c,_,v,x,E,R,F,N,z;const U={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(j=>{if(j.stylesheet){if(null!=j.light&&(s=j.light),j.stylesheet.lights)for(const W of j.stylesheet.lights)"ambient"===W.type&&null!=j.ambientLight&&(c=j.ambientLight),"directional"===W.type&&null!=j.directionalLight&&(_=j.directionalLight);v=this._prioritizeTerrain(v,j.terrain,j.stylesheet.terrain),j.stylesheet.fog&&null!=j.fog&&(x=j.fog),j.stylesheet.snow&&null!=j.snow&&(E=j.snow),j.stylesheet.rain&&null!=j.rain&&(R=j.rain),null!=j.stylesheet.camera&&(z=j.stylesheet.camera),null!=j.stylesheet.projection&&(F=j.stylesheet.projection),null!=j.stylesheet.transition&&(N=j.stylesheet.transition),U[j.scope]=j._styleColorTheme}}),this.light=s,this.ambientLight=c,this.directionalLight=_,this.fog=x,this.snow=E,this.rain=R,this._styleColorThemeForScope=U,null===v?delete this.terrain:this.terrain=v,this.camera=z||{"camera-projection":"perspective"},this.projection=F||{name:"mercator"},this.transition=h.l({},Ms,N),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(s){const c=_=>{for(const v of _.fragments)c(v.style);s(_)};c(this)}_prioritizeTerrain(s,c,_){const v=s&&0===s.drapeRenderMode;return null===_?c&&0===c.drapeRenderMode?c:v?s:null:null!=c&&(!s||v||c&&1===c.drapeRenderMode)?c:s}mergeTerrain(){let s;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(c=>{s=this._prioritizeTerrain(s,c.terrain,c.stylesheet.terrain)}),null===s?delete this.terrain:this.terrain=s}mergeProjection(){let s;this.forEachFragmentStyle(c=>{null!=c.stylesheet.projection&&(s=c.stylesheet.projection)}),this.projection=s||{name:"mercator"}}mergeSources(){const s={},c={},_={};this.forEachFragmentStyle(v=>{for(const x in v._sourceCaches){const E=h.C(x,v.scope);s[E]=v._sourceCaches[x]}for(const x in v._otherSourceCaches){const E=h.C(x,v.scope);c[E]=v._otherSourceCaches[x]}for(const x in v._symbolSourceCaches){const E=h.C(x,v.scope);_[E]=v._symbolSourceCaches[x]}}),this._mergedSourceCaches=s,this._mergedOtherSourceCaches=c,this._mergedSymbolSourceCaches=_}mergeLayers(){const s={},c=[],_={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(x=>{for(const E of x._order){const R=x._layers[E];if("slot"===R.type){const F=h.cr(E);if(s[F])continue;s[F]=[]}R.slot&&s[R.slot]?s[R.slot].push(R):c.push(R)}}),this._mergedOrder=[];const v=(x=[])=>{for(const E of x)if("slot"===E.type){const R=h.cr(E.id);s[R]&&v(s[R]),this._mergedSlots.push(R)}else{const R=h.C(E.id,E.scope);this._mergedOrder.push(R),_[R]=E,E.is3D(!!this.terrain)&&(this._has3DLayers=!0),"circle"===E.type&&(this._hasCircleLayers=!0),"symbol"===E.type&&(this._hasSymbolLayers=!0),"clip"===E.type&&(this._clipLayerPresent=!0)}};v(c),this._mergedOrder.sort((x,E)=>{const R=_[x],F=_[E];return R.hasInitialOcclusionOpacityProperties?F.is3D(!!this.terrain)?1:0:R.is3D(!!this.terrain)&&F.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=_,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}getCamera(){return this.stylesheet.camera}setCamera(s){return this.stylesheet.camera=h.l({},this.stylesheet.camera,s),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(s){return s.data?function(c,_,v){const x=h.l({},_);for(const R of Object.keys(h.a5.colorTheme))void 0===x[R]&&(x[R]=h.a5.colorTheme[R].default);const E=new h.a6(Cv,c,new Map(v));return E.setTransitionOrValue(x,v),E.untransitioned().possiblyEvaluate(new h.aa(0))}(this.scope,s,this.options).get("data"):null}_loadColorTheme(s){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const c=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((_,v)=>{const x="data:image/png;base64,";if(!s||0===s.length)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void _();let E=s;E.startsWith(x)||(E=x+E);const R=h.I.from("mapbox-reserved-lut"),F=new Image;F.src=E,F.onerror=()=>{this._styleColorTheme.lutLoading=!1,v(new Error("Failed to load image data"))},F.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==c)return void _();this._styleColorTheme.lutLoading=!1;const{width:N,height:z,data:U}=h.q.getImageData(F);if(z>32)return void v(new Error("The height of the image must be less than or equal to 32 pixels."));if(N!==z*z)return void v(new Error("The width of the image must be equal to the height squared."));this.getImage(R)&&this.removeImage(R),this.addImage(R,{data:new h.r({width:N,height:z},U),pixelRatio:1,sdf:!1,usvg:!1,version:0});const j=this.imageManager.getImage(R,this.scope);j?(this._styleColorTheme.lut={image:j.data,data:s},_()):v(new Error("Missing LUT image."))}})}getLut(s){const c=this._styleColorThemeForScope[s];return c?c.lut:null}setProjection(s){s?this.stylesheet.projection=s:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(s){this._spriteRequest=function(c,_,v){let x,E,R;const F=h.q.devicePixelRatio>1?"@2x":"";let N=h.n(_.transformRequest(_.normalizeSpriteURL(c,F,".json"),h.R.SpriteJSON),(j,W)=>{N=null,R||(R=j,x=W,U())}),z=h.o(_.transformRequest(_.normalizeSpriteURL(c,F,".png"),h.R.SpriteImage),(j,W)=>{z=null,R||(R=j,E=W,U())});function U(){if(R)v(R);else if(x&&E){const j=h.q.getImageData(E),W={};for(const ne in x){const{width:J,height:oe,x:se,y:fe,sdf:be,pixelRatio:ve,stretchX:we,stretchY:Ee,content:De}=x[ne],Me=new h.r({width:J,height:oe});h.r.copy(j,Me,{x:se,y:fe},{x:0,y:0},{width:J,height:oe},null),W[ne]={data:Me,pixelRatio:ve,sdf:be,stretchX:we,stretchY:Ee,content:De,usvg:!1}}v(null,W)}}return{cancel(){N&&(N.cancel(),N=null),z&&(z.cancel(),z=null)}}}(s,this.map._requestManager,(c,_)=>{if(this._spriteRequest=null,c)this.fire(new h.z(c));else if(_){const v=new Map;for(const x in _)v.set(h.I.from(x),_[x]);this.addImages(v)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new h.A("data",{dataType:"style"}))})}addIconset(s,c){if("sprite"===c.type)return void this._loadSprite(c.url);const _=this.getOwnSource(c.source);if(!_)return void this.fire(new h.z(new Error(`Source "${c.source}" as specified by iconset "${s}" does not exist and cannot be used as an iconset source`)));if("raster-array"!==_.type)return void this.fire(new h.z(new Error(`Source "${c.source}" as specified by iconset "${s}" is not a "raster-array" source and cannot be used as an iconset source`)));this.imageManager.createIconset(this.scope,s);const v=new $l(s,this);_.addIconset(s,v)}_loadIconset(s){if(!h.f(s)&&"icon_set"!==this.map._spriteFormat||"raster"===this.map._spriteFormat)return void this._loadSprite(s);const c="auto"===this.map._spriteFormat;var _,v;this._spriteRequest=(v=(x,E)=>{if(this._spriteRequest=null,x)c?this._loadSprite(s):this.fire(new h.z(x));else if(E){const R=new Map;for(const F in E)R.set(h.I.from(F),E[F]);this.addImages(R)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new h.A("data",{dataType:"style"}))},h.bj((_=this.map._requestManager).transformRequest(_.normalizeIconsetURL(s),h.R.Iconset),(x,E)=>{if(x)return void v(x);const R={},F=h.ch(new h.bi(E));for(const N of F.icons){const z={version:1,pixelRatio:h.q.devicePixelRatio,content:Hh(N),stretchX:N.metadata?wm(N.metadata.stretch_x_areas):void 0,stretchY:N.metadata?wm(N.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:N};R[N.name]=z}v(null,R)}))}_validateLayer(s){const c=this.getOwnSource(s.source);if(!c)return;const _=s.sourceLayer;_&&("geojson"===c.type||c.vectorLayerIds&&-1===c.vectorLayerIds.indexOf(_))&&this.fire(new h.z(new Error(`Source layer "${_}" does not exist on source "${c.id}" as specified by style layer "${s.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const s in this._sourceCaches)if(!this._sourceCaches[s].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:s}of this.fragments)if(!s.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((s,c)=>{const _=this.fragments[c];return _&&_.style&&(s.data=_.style.serialize()),s})}_serializeSources(){const s={};for(const c in this._sourceCaches){const _=this._sourceCaches[c].getSource();s[_.id]||(s[_.id]=_.serialize())}return s}_serializeLayers(s){const c=[];for(const _ of s){const v=this._layers[_];v&&"custom"!==v.type&&c.push(v.serialize())}return c}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const s in this._sourceCaches)if(this._sourceCaches[s].hasTransition())return!0;for(const s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(s){return s?this.order:this._mergedOrder}isLayerDraped(s){return!!this.terrain&&s.isDraped(this.getLayerSourceCache(s))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(s){const c=this.getOwnLayer(s);if(c)return c;this.fire(new h.z(new Error(`The layer '${s}' does not exist in the map's style.`)))}_checkSource(s){const c=this.getOwnSource(s);if(c)return c;this.fire(new h.z(new Error(`The source '${s}' does not exist in the map's style.`)))}precompilePrograms(s,c){const _=this.map.painter;if(_)for(let v=s.minzoom||0;v<(s.maxzoom||25.5);v++){const x=s.getProgramIds();if(x)for(const E of x){const R=s.getDefaultProgramParams(E,c.zoom,this._styleColorTheme.lut);R&&(_.style=this,this.fog&&(_._fogVisible=!0,R.overrideFog=!0,_.getOrCreateProgram(E,R)),_._fogVisible=!1,R.overrideFog=!1,_.getOrCreateProgram(E,R),(this.stylesheet.terrain||this.stylesheet.projection&&"globe"===this.stylesheet.projection.name)&&(R.overrideRtt=!0,_.getOrCreateProgram(E,R)))}}}update(s){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(s),this.directionalLight&&this.directionalLight.recalculate(s);const c=this.calculateLightsBrightness();s.brightness=c||0,c!==this._brightness&&(this._brightness=c,this.dispatcher.broadcast("setBrightness",c));const _=this._changes.isDirty();let v=!1;if(this._changes.isDirty()){const E=this._changes.getLayerUpdatesByScope();for(const R in E){const{updatedIds:F,removedIds:N}=E[R];(F||N)&&(this._updateWorkerLayers(R,F,N),v=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(s),this.light&&this.light.updateTransitions(s),this.ambientLight&&this.ambientLight.updateTransitions(s),this.directionalLight&&this.directionalLight.updateTransitions(s),this.fog&&this.fog.updateTransitions(s),this.snow&&this.snow.updateTransitions(s),this.rain&&this.rain.updateTransitions(s),this._changes.reset()}const x={};for(const E in this._mergedSourceCaches){const R=this._mergedSourceCaches[E];x[E]=R.used,R.used=!1,R.tileCoverLift=0}for(const E of this._mergedOrder){const R=this._mergedLayers[E];if(R.recalculate(s,this._availableImages),!R.isHidden(s.zoom)){const F=this.getLayerSourceCache(R);F&&(F.used=!0,F.tileCoverLift=Math.max(F.tileCoverLift,R.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(R,s)}):this.precompilePrograms(R,s))}for(const E in this._mergedSourceCaches){const R=this._mergedSourceCaches[E];if(!R)continue;const F=R._source;"raster-array"===F.type&&F.iconsets&&(R.used=!0)}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&v&&this.mergeLayers();for(const E in x){const R=this._mergedSourceCaches[E];x[E]!==R.used&&R.getSource().fire(new h.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:R.getSource().id}))}this.light&&this.light.recalculate(s),this.terrain&&this.terrain.recalculate(s),this.fog&&this.fog.recalculate(s),this.snow&&this.snow.recalculate(s),this.rain&&this.rain.recalculate(s),this.z=s.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),_&&this.fire(new h.A("data",{dataType:"style"}))}_updateTilesForChangedImages(){const s=this._changes.getUpdatedImages();if(s.length){for(const c in this._mergedSourceCaches)this._mergedSourceCaches[c].reloadTilesForDependencies(["icons","patterns"],s);this._changes.resetUpdatedImages()}}_updateWorkerLayers(s,c,_){const v=this.getFragmentStyle(s);v&&this.dispatcher.broadcast("updateLayers",{layers:c?v._serializeLayers(c):[],scope:s,removedIds:_||[],options:v.options})}setState(s,c){if(this._checkLoaded(),or(this,ws(s)))return!1;(s=h.cq(s)).layers=mm(s.layers);const _=function(E,R){if(!E)return[{command:Ti.setStyle,args:[R]}];let F=[];try{if(!h.bn(E.version,R.version))return[{command:Ti.setStyle,args:[R]}];if(h.bn(E.center,R.center)||F.push({command:Ti.setCenter,args:[R.center]}),h.bn(E.zoom,R.zoom)||F.push({command:Ti.setZoom,args:[R.zoom]}),h.bn(E.bearing,R.bearing)||F.push({command:Ti.setBearing,args:[R.bearing]}),h.bn(E.pitch,R.pitch)||F.push({command:Ti.setPitch,args:[R.pitch]}),h.bn(E.sprite,R.sprite)||F.push({command:Ti.setSprite,args:[R.sprite]}),h.bn(E.glyphs,R.glyphs)||F.push({command:Ti.setGlyphs,args:[R.glyphs]}),h.bn(E.imports,R.imports)||function(W=[],ne=[],J){ne=ne||[];const oe=(W=W||[]).map(Ii),se=ne.map(Ii),fe=W.reduce(Ns,{}),be=ne.reduce(Ns,{}),ve=oe.slice();let we,Ee,De,Me;for(we=0,Ee=0;we<oe.length;we++)De=oe[we],be.hasOwnProperty(De)?Ee++:(J.push({command:Ti.removeImport,args:[De]}),ve.splice(ve.indexOf(De,Ee),1));for(we=0,Ee=0;we<se.length;we++)De=se[se.length-1-we],ve[ve.length-1-we]!==De&&(fe.hasOwnProperty(De)?(J.push({command:Ti.removeImport,args:[De]}),ve.splice(ve.lastIndexOf(De,ve.length-Ee),1)):Ee++,Me=ve[ve.length-we],J.push({command:Ti.addImport,args:[be[De],Me]}),ve.splice(ve.length-we,0,De));for(const ke of ne){const Oe=fe[ke.id];Oe&&!h.bn(Oe,ke)&&J.push({command:Ti.updateImport,args:[ke.id,ke]})}}(E.imports,R.imports,F),h.bn(E.transition,R.transition)||F.push({command:Ti.setTransition,args:[R.transition]}),h.bn(E.light,R.light)||F.push({command:Ti.setLight,args:[R.light]}),h.bn(E.fog,R.fog)||F.push({command:Ti.setFog,args:[R.fog]}),h.bn(E.snow,R.snow)||F.push({command:Ti.setSnow,args:[R.snow]}),h.bn(E.rain,R.rain)||F.push({command:Ti.setRain,args:[R.rain]}),h.bn(E.projection,R.projection)||F.push({command:Ti.setProjection,args:[R.projection]}),h.bn(E.lights,R.lights)||F.push({command:Ti.setLights,args:[R.lights]}),h.bn(E.camera,R.camera)||F.push({command:Ti.setCamera,args:[R.camera]}),!h.bn(E["color-theme"],R["color-theme"]))return[{command:Ti.setStyle,args:[R]}];const N={},z=[];!function(W,ne,J,oe){let se;for(se in ne=ne||{},W=W||{})W.hasOwnProperty(se)&&(ne.hasOwnProperty(se)||ni(se,J,oe));for(se in ne){if(!ne.hasOwnProperty(se))continue;const fe=ne[se];W.hasOwnProperty(se)?h.bn(W[se],fe)||("geojson"===W[se].type&&"geojson"===fe.type&&rn(W,ne,se)?J.push({command:Ti.setGeoJSONSourceData,args:[se,fe.data]}):Xp(se,ne,J,oe)):to(se,ne,J)}}(E.sources,R.sources,z,N);const U=[];E.layers&&E.layers.forEach(W=>{W.source&&N[W.source]?F.push({command:Ti.removeLayer,args:[W.id]}):U.push(W)});let j=E.terrain;j&&N[j.source]&&(F.push({command:Ti.setTerrain,args:[void 0]}),j=void 0),F=F.concat(z),h.bn(j,R.terrain)||F.push({command:Ti.setTerrain,args:[R.terrain]}),function(W,ne,J){ne=ne||[];const oe=(W=W||[]).map(Ii),se=ne.map(Ii),fe=W.reduce(Ns,{}),be=ne.reduce(Ns,{}),ve=oe.slice(),we=Object.create(null);let Ee,De,Me,ke,Oe,et,qe;for(Ee=0,De=0;Ee<oe.length;Ee++)Me=oe[Ee],be.hasOwnProperty(Me)?De++:(J.push({command:Ti.removeLayer,args:[Me]}),ve.splice(ve.indexOf(Me,De),1));for(Ee=0,De=0;Ee<se.length;Ee++)Me=se[se.length-1-Ee],ve[ve.length-1-Ee]!==Me&&(fe.hasOwnProperty(Me)?(J.push({command:Ti.removeLayer,args:[Me]}),ve.splice(ve.lastIndexOf(Me,ve.length-De),1)):De++,et=ve[ve.length-Ee],J.push({command:Ti.addLayer,args:[be[Me],et]}),ve.splice(ve.length-Ee,0,Me),we[Me]=!0);for(Ee=0;Ee<se.length;Ee++)if(Me=se[Ee],ke=fe[Me],Oe=be[Me],!we[Me]&&!h.bn(ke,Oe))if(h.bn(ke.source,Oe.source)&&h.bn(ke["source-layer"],Oe["source-layer"])&&h.bn(ke.type,Oe.type)){for(qe in Hi(ke.layout,Oe.layout,J,Me,null,Ti.setLayoutProperty),Hi(ke.paint,Oe.paint,J,Me,null,Ti.setPaintProperty),h.bn(ke.slot,Oe.slot)||J.push({command:Ti.setSlot,args:[Me,Oe.slot]}),h.bn(ke.filter,Oe.filter)||J.push({command:Ti.setFilter,args:[Me,Oe.filter]}),h.bn(ke.minzoom,Oe.minzoom)&&h.bn(ke.maxzoom,Oe.maxzoom)||J.push({command:Ti.setLayerZoomRange,args:[Me,Oe.minzoom,Oe.maxzoom]}),ke)ke.hasOwnProperty(qe)&&"layout"!==qe&&"paint"!==qe&&"filter"!==qe&&"metadata"!==qe&&"minzoom"!==qe&&"maxzoom"!==qe&&"slot"!==qe&&(0===qe.indexOf("paint.")?Hi(ke[qe],Oe[qe],J,Me,qe.slice(6),Ti.setPaintProperty):h.bn(ke[qe],Oe[qe])||J.push({command:Ti.setLayerProperty,args:[Me,qe,Oe[qe]]}));for(qe in Oe)Oe.hasOwnProperty(qe)&&!ke.hasOwnProperty(qe)&&"layout"!==qe&&"paint"!==qe&&"filter"!==qe&&"metadata"!==qe&&"minzoom"!==qe&&"maxzoom"!==qe&&"slot"!==qe&&(0===qe.indexOf("paint.")?Hi(ke[qe],Oe[qe],J,Me,qe.slice(6),Ti.setPaintProperty):h.bn(ke[qe],Oe[qe])||J.push({command:Ti.setLayerProperty,args:[Me,qe,Oe[qe]]}))}else J.push({command:Ti.removeLayer,args:[Me]}),et=ve[ve.lastIndexOf(Me)+1],J.push({command:Ti.addLayer,args:[Oe,et]})}(U,R.layers,F)}catch(N){console.warn("Unable to compute style diff:",N),F=[{command:Ti.setStyle,args:[R]}]}return F}(this.serialize(),s).filter(E=>!(E.command in Ev));if(0===_.length)return!1;const v=_.filter(E=>!(E.command in dl));if(v.length>0)throw new Error(`Unimplemented: ${v.map(E=>E.command).join(", ")}.`);const x=[];return _.forEach(E=>{x.push(this[E.command].apply(this,E.args))}),c&&Promise.all(x).then(c),this.stylesheet=s,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}addImages(s){for(const[c,_]of s.entries()){if(this.getImage(c)&&!c.iconsetId)return this.fire(new h.z(new Error(`An image with the name "${c.name}" already exists.`)));this.imageManager.addImage(c,this.scope,_),this._changes.updateImage(c)}return this._updateWorkerImages(),this.fire(new h.A("data",{dataType:"style"})),this}addImage(s,c){return this.getImage(s)&&!s.iconsetId?this.fire(new h.z(new Error(`An image with the name "${s.name}" already exists.`))):(this.imageManager.addImage(s,this.scope,c),this._changes.updateImage(s),this._updateWorkerImages(),this.fire(new h.A("data",{dataType:"style"})),this)}updateImage(s,c,_=!1){this.imageManager.updateImage(s,this.scope,c),_&&(this._changes.updateImage(s),this._updateWorkerImages(),this.fire(new h.A("data",{dataType:"style"})))}getImage(s){return this.imageManager.getImage(s,this.scope)}removeImage(s){return this.getImage(s)?(this.imageManager.removeImage(s,this.scope),this._changes.updateImage(s),this._updateWorkerImages(),this.fire(new h.A("data",{dataType:"style"})),this):this.fire(new h.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(s,c,_={}){return this._checkLoaded(),this._validate(Ae,`models.${s}`,c,null,_)||(this.modelManager.addModel(s,c,this.scope),this._changes.setDirty()),this}hasModel(s){return this.modelManager.hasModel(s,this.scope)}removeModel(s){return this.hasModel(s)?(this.modelManager.removeModel(s,this.scope),this):this.fire(new h.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(s,c,_={}){if(this._checkLoaded(),void 0!==this.getOwnSource(s))throw new Error(`There is already a source with ID "${s}".`);if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(Ra,`sources.${s}`,c,null,_))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const v=Zp(s,c,this.dispatcher,this);v.scope=this.scope,v.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(v.id),source:v.serialize(),sourceId:v.id}));const x=E=>{const R=(E?"symbol:":"other:")+v.id,F=h.C(R,this.scope),N=this._sourceCaches[R]=new cs(F,v,E);(E?this._symbolSourceCaches:this._otherSourceCaches)[v.id]=N,N.onAdd(this.map)};x(!1),"vector"!==c.type&&"geojson"!==c.type||x(!0),v.onAdd&&v.onAdd(this.map),_.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(s){this._checkLoaded();const c=this.getOwnSource(s);if(!c)throw new Error("There is no source with this ID");for(const v in this._layers)if(this._layers[v].source===s)return this.fire(new h.z(new Error(`Source "${s}" cannot be removed while layer "${v}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===s)return this.fire(new h.z(new Error(`Source "${s}" cannot be removed while terrain is using it.`)));const _=this.getOwnSourceCaches(s);for(const v of _){const x=h.cr(v.id);delete this._sourceCaches[x],this._changes.discardSourceCacheUpdate(v.id),v.fire(new h.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:v.getSource().id})),v.setEventedParent(null),v.clearTiles()}return delete this._otherSourceCaches[s],delete this._symbolSourceCaches[s],this.mergeSources(),c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(s,c){this._checkLoaded(),this.getOwnSource(s).setData(c),this._changes.setDirty()}getOwnSource(s){const c=this.getOwnSourceCache(s);return c&&c.getSource()}getOwnSources(){const s=[];for(const c in this._otherSourceCaches){const _=this.getOwnSourceCache(c);_&&s.push(_.getSource())}return s}areTilesLoaded(){const s=this._mergedSourceCaches;for(const c in s){const _=s[c]._tiles;for(const v in _){const x=_[v];if("loaded"!==x.state&&"errored"!==x.state)return!1}}return!0}setLights(s){if(this._checkLoaded(),!s)return delete this.ambientLight,void delete this.directionalLight;const c=this._getTransitionParameters();for(const v of s){if(this._validate(Vh,"lights",v))return;switch(v.type){case"ambient":if(this.ambientLight){const x=this.ambientLight;x.set(v),x.updateTransitions(c)}else this.ambientLight=new bt(v,si||(si=new h.a7({color:new h.a8(h.a5.properties_light_ambient.color),"color-use-theme":new h.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new h.a8(h.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const x=this.directionalLight;x.set(v),x.updateTransitions(c)}else this.directionalLight=new bt(v,an||(an=new h.a7({direction:new h.am(h.a5.properties_light_directional.direction),color:new h.a8(h.a5.properties_light_directional.color),"color-use-theme":new h.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new h.a8(h.a5.properties_light_directional.intensity),"cast-shadows":new h.a8(h.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new h.a8(h.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new h.a8(h.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const _=new h.aa(this.z||0,c);this.ambientLight&&this.ambientLight.recalculate(_),this.directionalLight&&this.directionalLight.recalculate(_),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const s=this.directionalLight,c=this.ambientLight;if(!s||!c)return;const _=j=>.2126*(j[0]<=.03928?j[0]/12.92:Math.pow((j[0]+.055)/1.055,2.4))+.7152*(j[1]<=.03928?j[1]/12.92:Math.pow((j[1]+.055)/1.055,2.4))+.0722*(j[2]<=.03928?j[2]/12.92:Math.pow((j[2]+.055)/1.055,2.4)),v=s.properties.get("color").toRenderColor(null).toArray01(),x=s.properties.get("intensity"),E=s.properties.get("direction"),R=1-h.cc(E.x,E.y,E.z)[2]/90,F=_(v)*x*R,N=c.properties.get("color").toRenderColor(null).toArray01(),z=c.properties.get("intensity"),U=_(N)*z;return Number(((F+U)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const s=[];return this.directionalLight&&s.push(this.directionalLight.get()),this.ambientLight&&s.push(this.ambientLight.get()),s}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(s){if(!s)return this;if(h.cs(s)){const c=h.ct(s),_=this.fragments.find(({id:x})=>x===c);if(!_)throw new Error(`Style import '${s}' not found`);const v=h.cr(s);return _.style.getFragmentStyle(v)}{const c=this.fragments.find(({id:_})=>_===s);return c?c.style:void 0}}setFeaturesetSelectors(s){if(!s)return;const c={},_=(v,x="")=>`${v}::${x}`;this._featuresetSelectors={};for(const v in s){const x=this._featuresetSelectors[v]=[];for(const E of s[v].selectors){if(E.featureNamespace){const F=this.getOwnLayer(E.layer);if(!F){h.w(`Layer is undefined for selector: ${E.layer}`);continue}const N=_(F.source,F.sourceLayer);if(N in c&&c[N]!==E.featureNamespace){h.w(`"featureNamespace ${E.featureNamespace} of featureset ${v}'s selector is not associated to the same source, skip this selector`);continue}c[N]=E.featureNamespace}let R;if(E.properties)for(const F in E.properties){const N=h.X(E.properties[F]);"success"===N.result&&(R=R||{},R[F]=N.value)}x.push({layerId:E.layer,namespace:E.featureNamespace,properties:R,uniqueFeatureID:E._uniqueFeatureID})}}}getFeaturesetDescriptors(s){const c=this.getFragmentStyle(s);if(!c||!c.stylesheet.featuresets)return[];const _=[];for(const v in c.stylesheet.featuresets)_.push({featuresetId:v,importId:c.scope?c.scope:void 0});return _}getFeaturesetLayers(s,c){const _=this.getFragmentStyle(c),v=_.stylesheet.featuresets;if(!v||!v[s])return this.fire(new h.z(new Error(`The featureset '${s}' does not exist in the map's style and cannot be queried.`))),[];const x=[];for(const E of v[s].selectors){const R=_.getOwnLayer(E.layer);R&&x.push(R)}return x}getConfigProperty(s,c){const _=this.getFragmentStyle(s);if(!_)return null;const v=h.C(c,_.scope),x=_.options.get(v),E=x?x.value||x.default:null;return E?E.serialize():null}setConfigProperty(s,c,_){const v=this.getFragmentStyle(s);if(!v)return;const x=v.stylesheet.indoor?pa(v.stylesheet.schema):v.stylesheet.schema;if(!x||!x[c])return;const E=h.X(_);if("success"!==E.result)return void or(this,E.value);const R=E.value.expression,F=h.C(c,v.scope),N=v.options.get(F);if(!N)return;let z;const{minValue:U,maxValue:j,stepValue:W,type:ne,values:J}=x[c],oe=h.X(x[c].default);"success"===oe.result&&(z=oe.value.expression),z?(this.options.set(F,Object.assign({},N,{value:R,default:z,minValue:U,maxValue:j,stepValue:W,type:ne,values:J})),this.updateConfigDependencies(c)):this.fire(new h.z(new Error(`No schema defined for the config option "${c}" in the "${s}" fragment.`)))}getConfig(s){const c=this.getFragmentStyle(s);if(!c)return null;const _=c.stylesheet.schema;if(!_)return null;const v={};for(const x in _){const E=h.C(x,c.scope),R=c.options.get(E),F=R?R.value||R.default:null;v[x]=F?F.serialize():null}return v}setConfig(s,c){const _=this.getFragmentStyle(s);_&&(_.updateConfig(c,_.stylesheet.schema),this.updateConfigDependencies())}getSchema(s){const c=this.getFragmentStyle(s);return c?c.stylesheet.schema:null}setSchema(s,c){const _=this.getFragmentStyle(s);_&&(_.stylesheet.schema=c,_.updateConfig(_._config,c),this.updateConfigDependencies())}updateConfig(s,c){if(this._config=s,s||c)if(c)for(const _ in c){let v,x;const E=h.X(c[_].default);if("success"===E.result&&(v=E.value.expression),s&&void 0!==s[_]){const j=h.X(s[_]);"success"===j.result&&(x=j.value.expression)}const{minValue:R,maxValue:F,stepValue:N,type:z,values:U}=c[_];if(v){const j=h.C(_,this.scope);this.options.set(j,{default:v,value:x,minValue:R,maxValue:F,stepValue:N,type:z,values:U})}else this.fire(new h.z(new Error(`No schema defined for config option "${_}".`)))}else this.fire(new h.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(s){for(const c of this._configDependentLayers){const _=this.getLayer(c);if(_){if(s&&!_.configDependencies.has(s))continue;_.possiblyEvaluateVisibility(),this._updateLayer(_)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(c=>{const _=c._styleColorTheme.colorThemeOverride?c._styleColorTheme.colorThemeOverride:c._styleColorTheme.colorTheme;if(_){const v=c._evaluateColorThemeData(_);(!c._styleColorTheme.lut&&""!==v||c._styleColorTheme.lut&&v!==c._styleColorTheme.lut.data)&&c.setColorTheme(_)}}),this._changes.setDirty()}addLayer(s,c,_={}){this._checkLoaded();const v=s.id;if(this._layers[v])return void this.fire(new h.z(new Error(`Layer with id "${v}" already exists on this map`)));let x;if("custom"===s.type){if(or(this,h.cu(s)))return;x=h.cv(s,this.scope,this._styleColorTheme.lut,this.options)}else{if("object"==typeof s.source&&(this.addSource(v,s.source),s=h.cq(s),s=h.l(s,{source:v})),this._validate(re,`layers.${v}`,s,{arrayIndex:-1},_))return;x=h.cv(s,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(x),x.setEventedParent(this,{layer:{id:v}})}0!==x.configDependencies.size&&this._configDependentLayers.add(x.fqid);let E=this._order.length;if(c){const z=this._order.indexOf(c);if(-1===z)return void this.fire(new h.z(new Error(`Layer with id "${c}" does not exist on this map.`)));x.slot===this._layers[c].slot?E=z:h.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(E,0,v),this._layerOrderChanged=!0,this._layers[v]=x;const R=this.getOwnLayerSourceCache(x),F=!!this.directionalLight&&this.directionalLight.shadowsEnabled();R&&x.canCastShadows()&&F&&(R.castsShadows=!0);const N=this._changes.getRemovedLayer(x);if(N&&x.source&&R&&"custom"!==x.type){this._changes.discardLayerRemoval(x);const z=h.C(x.source,x.scope);N.type!==x.type?this._changes.updateSourceCache(z,"clear"):(this._changes.updateSourceCache(z,"reload"),R.pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map),x.scope=this.scope,this.mergeLayers()}moveLayer(s,c){this._checkLoaded();const _=this._checkLayer(s);if(!_||s===c)return;const v=this._order.indexOf(s);this._order.splice(v,1);let x=this._order.length;if(c){const E=this._order.indexOf(c);if(-1===E)return void this.fire(new h.z(new Error(`Layer with id "${c}" does not exist on this map.`)));_.slot===this._layers[c].slot?x=E:h.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(x,0,s),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(s){this._checkLoaded();const c=this._checkLayer(s);if(!c)return;c.setEventedParent(null);const _=this._order.indexOf(s);this._order.splice(_,1),delete this._layers[s],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(c.fqid),this._changes.removeLayer(c);const v=this.getOwnLayerSourceCache(c);if(v&&v.castsShadows){let x=!1;for(const E in this._layers)if(this._layers[E].source===c.source&&this._layers[E].canCastShadows()){x=!0;break}v.castsShadows=x}c.onRemove&&c.onRemove(this.map),this.mergeLayers()}getOwnLayer(s){return this._layers[s]}hasLayer(s){return s in this._mergedLayers}hasLayerType(s){for(const c in this._layers)if(this._layers[c].type===s)return!0;return!1}setLayerZoomRange(s,c,_){this._checkLoaded();const v=this._checkLayer(s);v&&(v.minzoom===c&&v.maxzoom===_||(null!=c&&(v.minzoom=c),null!=_&&(v.maxzoom=_),this._updateLayer(v)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(s,c){this._checkLoaded();const _=this._checkLayer(s);_&&_.slot!==c&&(_.slot=c,this._updateLayer(_))}setFilter(s,c,_={}){this._checkLoaded();const v=this._checkLayer(s);if(v&&!h.bn(v.filter,c))return null==c?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(ce,`layers.${v.id}.filter`,c,{layerType:v.type},_)||(v.filter=h.cq(c),this._updateLayer(v)))}getFilter(s){const c=this._checkLayer(s);if(c)return h.cq(c.filter)}setLayoutProperty(s,c,_,v={}){this._checkLoaded();const x=this._checkLayer(s);if(x&&!h.bn(x.getLayoutProperty(c),_)){if(null!=_&&(!v||!1!==v.validate)&&or(x,Pe.call(ws,{key:`layers.${s}.layout.${c}`,layerType:x.type,objectKey:c,value:_,styleSpec:h.a5,style:{glyphs:!0,sprite:!0}})))return;x.setLayoutProperty(c,_),0!==x.configDependencies.size&&this._configDependentLayers.add(x.fqid),this._updateLayer(x)}}getLayoutProperty(s,c){const _=this._checkLayer(s);if(_)return _.getLayoutProperty(c)}setPaintProperty(s,c,_,v={}){this._checkLoaded();const x=this._checkLayer(s);if(!x||h.bn(x.getPaintProperty(c),_)||null!=_&&(!v||!1!==v.validate)&&or(x,Se.call(ws,{key:`layers.${s}.paint.${c}`,layerType:x.type,objectKey:c,value:_,styleSpec:h.a5})))return;const E=x.setPaintProperty(c,_);0!==x.configDependencies.size&&this._configDependentLayers.add(x.fqid),E&&this._updateLayer(x),this._changes.updatePaintProperties(x)}getPaintProperty(s,c){const _=this._checkLayer(s);if(_)return _.getPaintProperty(c)}setFeatureState(s,c){if(this._checkLoaded(),"target"in s){if("featuresetId"in s.target){const{featuresetId:F,importId:N}=s.target,z=this.getFragmentStyle(N),U=z.getFeaturesetLayers(F);for(const{source:j,sourceLayer:W}of U)z.setFeatureState({id:s.id,source:j,sourceLayer:W},c)}else if("layerId"in s.target){const{layerId:F}=s.target,N=this.getLayer(F);this.setFeatureState({id:s.id,source:N.source,sourceLayer:N.sourceLayer},c)}return}const _=s.source,v=s.sourceLayer,x=this._checkSource(_);if(!x)return;const E=x.type;if("geojson"===E&&v)return void this.fire(new h.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===E&&!v)return void this.fire(new h.z(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===s.id&&this.fire(new h.z(new Error("The feature id parameter must be provided.")));const R=this.getOwnSourceCaches(_);for(const F of R)F.setFeatureState(v,s.id,c)}removeFeatureState(s,c){if(this._checkLoaded(),"target"in s){if("featuresetId"in s.target){const{featuresetId:F,importId:N}=s.target,z=this.getFragmentStyle(N),U=z.getFeaturesetLayers(F);for(const{source:j,sourceLayer:W}of U)z.removeFeatureState({id:s.id,source:j,sourceLayer:W},c)}else if("layerId"in s.target){const{layerId:F}=s.target,N=this.getLayer(F);this.removeFeatureState({id:s.id,source:N.source,sourceLayer:N.sourceLayer},c)}return}const _=s.source,v=this._checkSource(_);if(!v)return;const x=v.type,E="vector"===x?s.sourceLayer:void 0;if("vector"===x&&!E)return void this.fire(new h.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&"string"!=typeof s.id&&"number"!=typeof s.id)return void this.fire(new h.z(new Error("A feature id is required to remove its specific state property.")));const R=this.getOwnSourceCaches(_);for(const F of R)F.removeFeatureState(E,s.id,c)}getFeatureState(s){if(this._checkLoaded(),"target"in s){let x;if("featuresetId"in s.target){const{featuresetId:E,importId:R}=s.target,F=this.getFragmentStyle(R),N=F.getFeaturesetLayers(E);for(const{source:z,sourceLayer:U}of N){const j=F.getFeatureState({id:s.id,source:z,sourceLayer:U});if(j&&!x)x=j;else if(!h.bn(x,j))return void this.fire(new h.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in s.target){const{layerId:E}=s.target,R=this.getLayer(E);x=this.getFeatureState({id:s.id,source:R.source,sourceLayer:R.sourceLayer})}return x}const c=s.source,_=s.sourceLayer,v=this._checkSource(c);if(v){if("vector"!==v.type||_)return void 0===s.id&&this.fire(new h.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(c)[0].getFeatureState(_,s.id);this.fire(new h.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(s){return this.stylesheet.transition=h.l({},this.stylesheet.transition,s),this.transition=this.stylesheet.transition,this}getTransition(){return h.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const s=this.getTerrain(),c=s&&this.terrain&&this.terrain.scope===this.scope?s:this.stylesheet.terrain;return h.cw({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:c,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},_=>void 0!==_)}_updateFilteredLayers(s){for(const c of Object.values(this._mergedLayers))s(c)&&this._updateLayer(c)}_updateLayer(s){this._changes.updateLayer(s);const c=this.getLayerSourceCache(s),_=h.C(s.source,s.scope),v=this._changes.getUpdatedSourceCaches();s.source&&!v[_]&&c&&"raster"!==c.getSource().type&&(this._changes.updateSourceCache(_,"reload"),c.pause()),s.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(s){const c=R=>this._mergedLayers[R].is3D(!!this.terrain),_=this.order,v={},x=[];for(let R=_.length-1;R>=0;R--){const F=_[R];if(c(F)){v[F]=R;for(const N of s){const z=N[F];if(z)for(const U of z)x.push(U)}}}x.sort((R,F)=>F.intersectionZ-R.intersectionZ);const E=[];for(let R=_.length-1;R>=0;R--){const F=_[R];if(c(F))for(let N=x.length-1;N>=0;N--){const z=x[N].feature;if(z.layer&&v[z.layer.id]<R)break;E.push(z),x.pop()}else for(const N of s){const z=N[F];if(z)for(const U of z)E.push(U.feature)}}return E}queryRenderedFeatures(s,c,_){let v;c&&!Array.isArray(c)&&c.filter&&(this._validate(ce,"queryRenderedFeatures.filter",c.filter,null,c),v=h.a_(c.filter));const x={},E=z=>{if($h.has(z.type))return;const U=this.getOwnLayerSourceCache(z),j=x[U.id]=x[U.id]||{sourceCache:U,layers:{},has3DLayers:!1};z.is3D(!!this.terrain)&&(j.has3DLayers=!0),j.layers[z.fqid]=j.layers[z.fqid]||{styleLayer:z,targets:[]},j.layers[z.fqid].targets.push({filter:v})};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new h.z(new Error("parameters.layers must be an Array."))),[];for(const z of c.layers){const U=this._layers[z];if(!U)return this.fire(new h.z(new Error(`The layer '${z}' does not exist in the map's style and cannot be queried for features.`))),[];E(U)}}else for(const z in this._layers)E(this._layers[z]);const R=this._queryRenderedFeatures(s,x,_),F=this._flattenAndSortRenderedFeatures(R),N=[];for(const z of F)h.ct(z.layer.id)===this.scope&&N.push(z);return N}queryRenderedFeatureset(s,c,_){let v;c&&!Array.isArray(c)&&c.filter&&(this._validate(ce,"queryRenderedFeatures.filter",c.filter,null,c),v=h.a_(c.filter));const x="mock",E=[];if(c&&c.target)E.push(Object.assign({},c,{targetId:x,filter:v}));else{const z=this.getFeaturesetDescriptors();for(const U of z)E.push({targetId:x,filter:v,target:U});for(const{style:U}of this.fragments){const j=U.getFeaturesetDescriptors();for(const W of j)E.push({targetId:x,filter:v,target:W})}}const R=this.queryRenderedTargets(s,E,_),F=[],N=new Set;for(const z of R)for(const U of z.variants[x])Vl(U,z,N)||F.push(new h.cx(z,U));return F}queryRenderedTargets(s,c,_){const v={},x=(R,F,N,z)=>{const U=v[F.id]=v[F.id]||{sourceCache:F,layers:{},has3DLayers:!1};if(U.layers[R.fqid]=U.layers[R.fqid]||{styleLayer:R,targets:[]},R.is3D(!!this.terrain)&&(U.has3DLayers=!0),!z)return N.uniqueFeatureID=!1,void U.layers[R.fqid].targets.push(N);U.layers[R.fqid].targets.push(Object.assign({},N,{namespace:z.namespace,properties:z.properties,uniqueFeatureID:z.uniqueFeatureID}))};for(const R of c)if("featuresetId"in R.target){const{featuresetId:F,importId:N}=R.target,z=this.getFragmentStyle(N);if(!z||!z._featuresetSelectors)continue;const U=z._featuresetSelectors[F];if(!U){this.fire(new h.z(new Error(`The featureset '${F}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const j of U){const W=z.getOwnLayer(j.layerId);W&&!$h.has(W.type)&&x(W,z.getOwnLayerSourceCache(W),R,j)}}else if("layerId"in R.target){const{layerId:F}=R.target,N=this.getLayer(F);if(!N||$h.has(N.type))continue;x(N,this.getLayerSourceCache(N),R)}const E=this._queryRenderedFeatures(s,v,_);return this._flattenAndSortRenderedFeatures(E)}_queryRenderedFeatures(s,c,_){const v=[],x=!!this.map._showQueryGeometry,E=Oo.createFromScreenPoints(s,_);for(const R in c){const F=hv(E,c[R],this._availableImages,_,x);Object.keys(F).length&&v.push(F)}if(this.placement)for(const R in c){if(!c[R].sourceCache._onlySymbols)continue;const F=ho(E.screenGeometry,c[R],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData);Object.keys(F).length&&v.push(F)}return v}querySourceFeatures(s,c){const _=c&&c.filter;_&&this._validate(ce,"querySourceFeatures.filter",_,null,c);let v=[];const x=this.getOwnSourceCaches(s);for(const E of x)v=v.concat(_x(E,c));return v}addSourceType(s,c,_){return bi.getSourceType(s)?_(new Error(`A source type called "${s}" already exists.`)):(bi.setSourceType(s,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:s,url:c.workerSourceURL},_):_(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(s,c,_={}){this._checkLoaded();const v=this.light.getLight();let x=!1;for(const R in s)if(!h.bn(s[R],v[R])){x=!0;break}if(!x)return;const E=this._getTransitionParameters();this.light.setLight(s,c,_),this.light.updateTransitions(E)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){void 0===this.disableElevatedTerrain&&(this.disableElevatedTerrain=h.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&h.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(s,c=1){if(this._checkLoaded(),!s)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),0===c&&delete this.terrain,null===s?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let _=s;const v=null==s.source;if(1===c){if(this.disableElevatedTerrain)return;if("object"==typeof _.source){const R="terrain-dem-src";this.addSource(R,_.source),_=h.cq(_),_=h.l(_,{source:R})}const x=h.l({},_),E={};if(this.terrain&&v){x.source=this.terrain.get().source;const R=this.terrain?this.getFragmentStyle(this.terrain.scope):null;R&&(E.style=R.serialize())}if(this._validate(Uh,"terrain",x,E))return}if(!this.terrain||this.terrain.scope!==this.scope&&!v||this.terrain&&c!==this.terrain.drapeRenderMode){if(!_)return;this._createTerrain(_,c),this.fire(new h.A("data",{dataType:"style"}))}else{const x=this.terrain,E=x.get();for(const R of Object.keys(h.a5.terrain))!_.hasOwnProperty(R)&&h.a5.terrain[R].default&&(_[R]=h.a5.terrain[R].default);for(const R in s)if(!h.bn(s[R],E[R])){x.set(s,this.options),this.stylesheet.terrain=s;const F=this._getTransitionParameters({duration:0});x.updateTransitions(F),this.fire(new h.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(s){const c=this.fog=new Hn(s,this.map.transform,this.scope,this.options);this.stylesheet.fog=c.get();const _=this._getTransitionParameters({duration:0});c.updateTransitions(_)}_createSnow(s){const c=this.snow=new Wi(s,this.map.transform,this.scope,this.options);this.stylesheet.snow=c.get();const _=this._getTransitionParameters({duration:0});c.updateTransitions(_)}_createRain(s){const c=this.rain=new ji(s,this.map.transform,this.scope,this.options);this.stylesheet.rain=c.get();const _=this._getTransitionParameters({duration:0});c.updateTransitions(_)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const s of this.map._markers)s._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(s){if(this._checkLoaded(),!s)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog;if(!h.bn(c.get(),s)){c.set(s,this.options),this.stylesheet.fog=c.get();const _=this._getTransitionParameters({duration:0});c.updateTransitions(_)}}else this._createFog(s);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(s){if(this._checkLoaded(),!s)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const c=this.snow;if(!h.bn(c.get(),s)){c.set(s,this.options),this.stylesheet.snow=c.get();const _=this._getTransitionParameters({duration:0});c.updateTransitions(_)}}else this._createSnow(s);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(s){if(this._checkLoaded(),!s)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const c=this.rain;if(!h.bn(c.get(),s)){c.set(s,this.options),this.stylesheet.rain=c.get();const _=this._getTransitionParameters({duration:0});c.updateTransitions(_)}}else this._createRain(s);this._markersNeedUpdate=!0}_reloadColorTheme(){const s=()=>{for(const v in this._layers)this._layers[v].lut=this._styleColorTheme.lut;for(const v in this._sourceCaches)this._sourceCaches[v].clearTiles()},c=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!c)return this._styleColorTheme.lut=null,void s();const _=this._evaluateColorThemeData(c);this._loadColorTheme(_).then(()=>{this.fire(new h.A("colorthemeset")),s()}).catch(v=>{h.w(`Couldn't set color theme: ${v}`)})}setColorTheme(s){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&h.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=s,this._reloadColorTheme()}setImportColorTheme(s,c){const _=this.getFragmentStyle(s);_&&(_._styleColorTheme.colorThemeOverride=c,_._reloadColorTheme())}_getTransitionParameters(s){return{now:h.q.now(),transition:h.l(this.transition,s)}}updateDrapeFirstLayers(){if(!this.terrain)return;const s=[],c=[];for(const _ of this._mergedOrder)this.isLayerDraped(this._mergedLayers[_])?s.push(_):c.push(_);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...s),this._drapedFirstOrder.push(...c)}_createTerrain(s,c){const _=this.terrain=new Qe(s,c,this.scope,this.options);1===c&&(this.stylesheet.terrain=s),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const v=this._getTransitionParameters({duration:0});_.updateTransitions(v)}_force3DLayerUpdate(){for(const s in this._layers){const c=this._layers[s];"fill-extrusion"===c.type&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(const s in this._layers){const c=this._layers[s];"symbol"===c.type&&this._updateLayer(c)}}_validate(s,c,_,v,x={}){if(x&&!1===x.validate)return!1;const E=h.l({},this.serialize());return or(this,s.call(ws,h.l({key:c,style:E,value:_,styleSpec:h.a5},v)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),h.cy.off("pluginStateChange",this._rtlTextPluginCallback);for(const s in this._mergedLayers)this._mergedLayers[s].setEventedParent(null);for(const s in this._mergedSourceCaches)this._mergedSourceCaches[s].clearTiles(),this._mergedSourceCaches[s].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(s){const c=this.getSourceCaches(s);for(const _ of c)_.clearTiles()}clearSources(){for(const s in this._mergedSourceCaches)this._mergedSourceCaches[s].clearTiles()}reloadSource(s){const c=this.getSourceCaches(s);for(const _ of c)_.resume(),_.reload()}reloadSources(){for(const s of this.getSources())s.reload&&s.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(s=>{s.modelManager.reloadModels(s.scope)})}updateSources(s){let c;this.directionalLight&&(c=Na(this.directionalLight));for(const _ in this._mergedSourceCaches)this._mergedSourceCaches[_].update(s,void 0,void 0,c)}_generateCollisionBoxes(){for(const s in this._sourceCaches){const c=this._sourceCaches[s];c.resume(),c.reload()}}_updatePlacement(s,c,_,v,x,E,R=!1){let F=!1,N=!1;const z={},U={};for(const j of this._mergedOrder){const W=this._mergedLayers[j];if("symbol"!==W.type)continue;const ne=h.C(W.source,W.scope);let J=z[ne];if(!J){const se=this.getLayerSourceCache(W);if(!se)continue;const fe=se.getRenderableIds(!0).map(be=>se.getTileByID(be));U[ne]=fe.slice(),J=z[ne]=fe.sort((be,ve)=>ve.tileID.overscaledZ-be.tileID.overscaledZ||(be.tileID.isLessThan(ve.tileID)?-1:1))}const oe=this.crossTileSymbolIndex.addLayer(W,J,c.center.lng,c.projection);F=F||oe}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),R=R||this._layerOrderChanged||0===v,this._layerOrderChanged&&this.fire(new h.A("neworder")),(R||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(h.q.now(),c.zoom))&&(this.pauseablePlacement=new Xc(c,this._mergedOrder,R,_,v,x,this.placement,this.fog&&c.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,z,U,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(h.q.now()),N=!0),F&&this.pauseablePlacement.placement.setStale()),N||F){this._buildingIndex.onNewFrame(c.zoom);for(let j=0;j<this._mergedOrder.length;j++){const W=this._mergedLayers[this._mergedOrder[j]];if("symbol"!==W.type)continue;const ne=this.isLayerClipped(W);this.placement.updateLayerOpacities(W,z[h.C(W.source,W.scope)],j,ne?E:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(h.q.now())}}_releaseSymbolFadeTiles(){for(const s in this._sourceCaches)this._sourceCaches[s].releaseSymbolFadeTiles()}addImport(s,c){this._checkLoaded();const _=this.stylesheet.imports=this.stylesheet.imports||[];if(-1!==_.findIndex(({id:x})=>x===s.id))return void this.fire(new h.z(new Error(`Import with id '${s.id}' already exists in the map's style.`)));if(!c)return _.push(s),this._loadImports([s],!0);const v=_.findIndex(({id:x})=>x===c);return-1===v&&this.fire(new h.z(new Error(`Import with id "${c}" does not exist on this map.`))),this.stylesheet.imports=_.slice(0,v).concat(s).concat(_.slice(v)),this._loadImports([s],!0,c)}updateImport(s,c){this._checkLoaded();const _=this.stylesheet.imports||[],v=this.getImportIndex(s);return-1===v?this:"string"==typeof c?(this.setImportUrl(s,c),this):(c.url&&c.url!==_[v].url&&this.setImportUrl(s,c.url),h.bn(c.config,_[v].config)||this.setImportConfig(s,c.config,c.data.schema),h.bn(c.data,_[v].data)||this.setImportData(s,c.data),this)}moveImport(s,c){this._checkLoaded();let _=this.stylesheet.imports||[];const v=this.getImportIndex(s);if(-1===v)return this;const x=this.getImportIndex(c);if(-1===x)return this;const E=_[v],R=this.fragments[v];return _=_.filter(({id:F})=>F!==s),this.fragments=this.fragments.filter(({id:F})=>F!==s),this.stylesheet.imports=_.slice(0,x).concat(E).concat(_.slice(x)),this.fragments=this.fragments.slice(0,x).concat(R).concat(this.fragments.slice(x)),this.mergeLayers(),this}setImportUrl(s,c){this._checkLoaded();const _=this.stylesheet.imports||[],v=this.getImportIndex(s);if(-1===v)return this;_[v].url=c;const x=this.fragments[v];return x.style=this._createFragmentStyle(_[v]),x.style.on("style.import.load",()=>this.mergeAll()),x.style.loadURL(c),this}setImportData(s,c){this._checkLoaded();const _=this.getImportIndex(s),v=this.stylesheet.imports||[];return-1===_?this:c?(this.fragments[_].style.setState(c),this._reloadImports(),this):(delete v[_].data,this.setImportUrl(s,v[_].url))}setImportConfig(s,c,_){this._checkLoaded();const v=this.getImportIndex(s),x=this.stylesheet.imports||[];if(-1===v)return this;c?x[v].config=c:delete x[v].config;const E=this.fragments[v];_&&E.style.stylesheet&&(E.style.stylesheet.schema=_);const R=E.style.stylesheet&&E.style.stylesheet.schema;return E.config=c,E.style.updateConfig(c,R),this.updateConfigDependencies(),this}removeImport(s){this._checkLoaded();const c=this.stylesheet.imports||[],_=this.getImportIndex(s);-1!==_&&(c.splice(_,1),this.fragments[_].style._remove(),this.fragments.splice(_,1),this._reloadImports())}getImportIndex(s){const c=(this.stylesheet.imports||[]).findIndex(_=>_.id===s);return-1===c&&this.fire(new h.z(new Error(`Import '${s}' does not exist in the map's style and cannot be updated.`))),c}getLayer(s){return this._mergedLayers[s]}getSources(){const s=[];for(const c in this._mergedOtherSourceCaches){const _=this._mergedOtherSourceCaches[c];_&&s.push(_.getSource())}return s}getSource(s,c){const _=this.getSourceCache(s,c);return _&&_.getSource()}getLayerSource(s){const c=this.getLayerSourceCache(s);return c&&c.getSource()}getSourceCache(s,c){const _=h.C(s,c);return this._mergedOtherSourceCaches[_]}getLayerSourceCache(s){const c=h.C(s.source,s.scope);return"symbol"===s.type?this._mergedSymbolSourceCaches[c]:this._mergedOtherSourceCaches[c]}getSourceCaches(s){if(null==s)return Object.values(this._mergedSourceCaches);const c=[];return this._mergedOtherSourceCaches[s]&&c.push(this._mergedOtherSourceCaches[s]),this._mergedSymbolSourceCaches[s]&&c.push(this._mergedSymbolSourceCaches[s]),c}updateSourceCaches(){const s=this._changes.getUpdatedSourceCaches();for(const c in s){const _=s[c];"reload"===_?this.reloadSource(c):"clear"===_&&this.clearSource(c)}}updateLayers(s){const c=this._changes.getUpdatedPaintProperties();for(const _ of c){const v=this.getLayer(_);v&&v.updateTransitions(s)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(s){this.stylesheet.glyphs=s,this.glyphManager.setURL(s,this.scope)}getImages(s,c,_){this.imageManager.getImages(c.images,c.scope,_),this._updateTilesForChangedImages();const v=E=>{if(E){const R=c.images.map(F=>h.I.toString(F));E.setDependencies(c.tileID.key,c.type,R)}},x=h.C(c.source,c.scope);v(this._mergedOtherSourceCaches[x]),v(this._mergedSymbolSourceCaches[x])}rasterizeImages(s,c,_){this.imageManager.rasterizeImages(c,_)}getGlyphs(s,c,_){this.glyphManager.getGlyphs(c.stacks,c.scope,_)}getResource(s,c,_){return h.cz(c,_)}getOwnSourceCache(s){return this._otherSourceCaches[s]}getOwnLayerSourceCache(s){return"symbol"===s.type?this._symbolSourceCaches[s.source]:this._otherSourceCaches[s.source]}getOwnSourceCaches(s){const c=[];return this._otherSourceCaches[s]&&c.push(this._otherSourceCaches[s]),this._symbolSourceCaches[s]&&c.push(this._symbolSourceCaches[s]),c}_isSourceCacheLoaded(s){const c=this.getOwnSourceCaches(s);return 0===c.length?(this.fire(new h.z(new Error(`There is no source with ID '${s}'`))),!1):c.every(_=>_.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(s,c){if(!this._clipLayerPresent&&"fill-extrusion"!==s.type)return!1;const _="fill-extrusion"===s.type&&"building"===s.sourceLayer;if(s.is3D(!!this.terrain)){if(_||c&&"batched-model"===c.type||"model"===s.type)return!0}else if("symbol"===s.type)return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(s=>{s.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}bi.getSourceType=function(m){return Ud[m]},bi.setSourceType=function(m,s){Ud[m]=s},bi.registerForPluginStateChange=h.ci;var es="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#ifdef RENDER_CUTOFF\nfloat cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}\n#endif",zs="\nout vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#ifdef INDICATOR_CUTOUT\nuniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;\n#endif\nvec4 applyCutout(vec4 color,float height) {\n#ifdef INDICATOR_CUTOUT\nfloat verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);\n#else\nreturn color;\n#endif\n}\n#ifdef DEBUG_WIREFRAME\n#define HANDLE_WIREFRAME_DEBUG \\\nglFragColor=vec4(0.7,0.0,0.0,0.7); \\\ngl_FragDepth=gl_FragCoord.z-0.0001;\n#else\n#define HANDLE_WIREFRAME_DEBUG\n#endif\n#ifdef RENDER_CUTOFF\nuniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;\n#endif\nvec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}",Gl="\n#define EXTENT 8192.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}\n#ifdef RENDER_CUTOFF\nuniform vec4 u_cutoff_params;out float v_cutoff_opacity;\n#endif\nconst vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}",ul="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Vu="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nvec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }\n#endif\n#ifdef DEPTH_OCCLUSION\nuniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;\n#ifdef DEPTH_D24\nfloat unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}\n#else\nhighp float unpack_depth_rgba(vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}\n#endif\nbool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;\n#ifdef DEPTH_D24\nfloat depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);\n#else\nfloat depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));\n#endif\nreturn coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;\n#ifdef DEPTH_D24\nhighp vec4 depth=vec4(\ntexture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r\n);depth=unpack_depth4(depth);\n#else\nhighp vec4 depth=vec4(\nunpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))\n);\n#endif\nreturn depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {\n#ifdef DEPTH_D24\nhighp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);\n#else\nhighp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));\n#endif\nres+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}\n#else\nbool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }\n#endif//DEPTH_OCCLUSION",Cm="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",nf="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif",Yd="#ifdef RASTER_ARRAY\nuniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)\n);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)\n);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}\n#endif",td="#ifdef RASTER_ARRAY\nuniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}\n#endif\nuniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}",Em="#ifdef RENDER_SHADOWS\nuniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}\n#endif//RENDER_SHADOWS",Uu="#ifdef RENDER_SHADOWS\n#ifdef DEPTH_TEXTURE\nuniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;\n#else\nuniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;\n#endif\nuniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_1,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_0,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;\n#ifdef TEXTURE_GATHER\nhighp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));\n#else\nhighp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(\nshadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)\n);\n#endif\nvec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return clamp(mix(lerpx.x,lerpx.y,f.y),0.0,1.0);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {\n#ifdef SHADOWS_SINGLE_CASCADE\nlight_view_pos0.xyz/=light_view_pos0.w;vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);\n#else\nlight_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);\n#endif\n}highp float calculate_shadow_bias(float NDotL) {\n#ifdef NORMAL_OFFSET\nreturn 0.5*u_shadow_bias.x;\n#else\nreturn 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));\n#endif\n}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)\n{highp vec2 biasUV=vec2(\npos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}\n#endif";const nd=[];hl(es,nd),hl(Gl,nd),hl(zs,nd);const id={"_prelude_fog.vertex.glsl":Cm,"_prelude_terrain.vertex.glsl":Vu,"_prelude_shadow.vertex.glsl":Em,"_prelude_fog.fragment.glsl":nf,"_prelude_shadow.fragment.glsl":Uu,"_prelude_lighting.glsl":"\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}\n#endif//LIGHTING_3D_MODE","_prelude_raster_array.glsl":Yd,"_prelude_raster_particle.glsl":td},ju={};ai("",Vu),ai(nf,Cm),ai(Uu,Em),ai(Yd,""),ai(td,"");const Sm=ai(zs,Gl),xc=es;var rf={background:ai('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nin vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_lighting.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),backgroundPattern:ai('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),circle:ai('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec3 v_data;in float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? \nsmoothstep(0.0,-antialiased_blur,1.0-extrude_length) : \nsmoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\nglFragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\n#ifdef ELEVATED_ROADS\nin float a_circle_z_offset;\n#endif\nout vec3 v_data;out float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\n#ifdef ELEVATED_ROADS\nworld_center.z+=a_circle_z_offset+ELEVATION_BIAS;\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}'),clippingMask:ai("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ai('#include "_prelude_fog.fragment.glsl"\nuniform highp float u_intensity;in vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),heatmapTexture:ai("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(0.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}","in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:ai("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",'#include "_prelude_terrain.vertex.glsl"\nin vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}'),collisionCircle:ai("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}","in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:ai("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",'#include "_prelude_terrain.vertex.glsl"\nin vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;\n#endif\nout vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}'),elevatedStructuresDepth:ai("void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=vec4(0.);\n#endif\n}","in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:ai("#ifdef DEPTH_RECONSTRUCTION\nin float v_height;\n#endif\nvoid main() {\n#ifdef DEPTH_RECONSTRUCTION\nif (v_height >=0.0)\ndiscard;\n#endif\nglFragColor=vec4(1.0,0.0,0.0,1.0);}","in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;\n#ifdef DEPTH_RECONSTRUCTION\nout float v_height;\n#endif\nvoid main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);\n#ifdef DEPTH_RECONSTRUCTION\nif (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;\n#endif\ngl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}"),elevatedStructures:ai('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nin vec3 v_normal;in float v_height;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;\n#endif\nvoid main() {vec3 color=vec3(241.0/255.0,236.0/255.0,225.0/255.0);\n#ifdef LIGHTING_3D_MODE\nvec3 normal=normalize(v_normal);\n#ifdef RENDER_SHADOWS\nfloat shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\n#else\ncolor=apply_lighting(color,normal);\n#endif\nif (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}\n#endif\n#ifdef FOG\ncolor=fog_apply(color,v_fog_pos);\n#endif\nvec4 out_color=vec4(color,1.0);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color,v_height);\n#endif\nglFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;\n#endif\nvoid main() {v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(v_normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fill:ai('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nuniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#ifdef INDICATOR_CUTOUT\nin highp float v_z_offset;\n#endif\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=opacity;\n#ifdef INDICATOR_CUTOUT\nif (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\n#ifdef INDICATOR_CUTOUT\nout highp float v_z_offset;\n#endif\nuniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp float z_offset\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#ifdef INDICATOR_CUTOUT\nv_z_offset=z_offset;\n#endif\n}'),fillOutline:ai('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nin highp vec2 v_pos;uniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\nuniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp float z_offset\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutlinePattern:ai('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\nin highp vec2 v_pos;in highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\nout highp vec2 v_pos;out highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize highp float z_offset\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillPattern:ai('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;in highp vec2 v_pos;uniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\nout highp vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize highp float z_offset\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillExtrusion:ai('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec4 v_color;in vec4 v_flat;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;\n#endif\nuniform lowp float u_opacity;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec2 v_ao;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nin vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nin highp vec3 v_normal;\n#endif\nuniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nin float v_flood_radius;in float v_has_floodlight;\n#endif\nin float v_height;\n#pragma mapbox: define highp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp float emissive_strength\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvec3 normal=normalize(v_normal);\n#endif\nfloat z;vec4 color=v_color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);\n#ifdef LIGHTING_3D_MODE\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#else\ncolor=mix(v_color,v_roof_color,z);\n#endif\n#endif\nfloat h=max(0.0,v_height);float ao_shade=1.0;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\ncolor.rgb*=mix(ao_shade,1.0,v_has_floodlight);\n#else\ncolor.rgb*=ao_shade;\n#endif\n#else\ncolor.rgb*=ao_shade;\n#endif\n#endif\n#ifdef LIGHTING_3D_MODE\nfloat flood_radiance=0.0;\n#ifdef FLOOD_LIGHT\nflood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef FLOOD_LIGHT\nfloat ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);\n#else\nfloat shadowed_lighting_factor;\n#ifdef RENDER_CUTOFF\nshadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}\n#else\nshadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);\n#endif\ncolor.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\n#endif\n#else\ncolor.rgb=apply_lighting(color.rgb,normal);\n#ifdef FLOOD_LIGHT\ncolor.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);\n#endif\n#endif\ncolor.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));\n#endif\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color,h);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec3 a_join_normal_inside;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\n#ifdef TERRAIN\nuniform int u_height_type;uniform int u_base_type;\n#endif\nuniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nout vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nout highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec2 v_ao;\n#endif\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nout float v_flood_radius;out float v_has_floodlight;\n#endif\nout float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define highp float flood_light_wall_radius\n#pragma mapbox: define highp float line_width\n#pragma mapbox: define highp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize highp float flood_light_wall_radius\n#pragma mapbox: initialize highp float line_width\n#pragma mapbox: initialize highp float emissive_strength\nbase*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nv_normal=normal;\n#endif\nbase=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;\n#ifdef TERRAIN\nbool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat cutoff=1.0;vec3 scaled_pos=pos;\n#ifdef RENDER_CUTOFF\nvec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;\n#endif\ngl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifndef LIGHTING_3D_MODE\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#endif\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\nfloat is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;\n#endif\nv_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);\n#else\nv_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),fillExtrusionDepth:ai("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;\n#ifdef TERRAIN\nuniform int u_height_type;uniform int u_base_type;\n#endif\nin vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec3 a_join_normal_inside;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp float line_width\n#pragma mapbox: define highp vec4 color\nout highp float v_depth;void main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp float line_width\n#pragma mapbox: initialize highp vec4 color\nbase*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nvec3 pos;\n#ifdef TERRAIN\nbool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);\n#else\npos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}'),fillExtrusionPattern:ai('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nin vec3 v_normal;\n#endif\nin highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color,height);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec3 a_join_normal_inside;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\n#ifdef TERRAIN\nuniform int u_height_type;uniform int u_base_type;\n#endif\nout highp vec2 v_pos;out vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nout vec3 v_normal;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\n#pragma mapbox: define highp float line_width\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\n#pragma mapbox: initialize highp float line_width\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_normal=normal;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}'),groundShadow:ai('#include "_prelude_shadow.fragment.glsl"\nprecision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\nvoid main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);\n#ifdef RENDER_CUTOFF\nshadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));\n#endif\n#ifdef FOG\nshadow=mix(shadow,vec3(1.0),v_fog_opacity);\n#endif\n#ifdef INDICATOR_CUTOUT\nshadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);\n#endif\nglFragColor=vec4(shadow,1.0);}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);\n#endif\n}'),fillExtrusionGroundEffect:ai("uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;\n#ifdef SDF_SUBPASS\nin highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}\n#ifdef FOG\nin highp float v_fog;\n#endif\n#endif\nvoid main() {\n#ifdef CLEAR_SUBPASS\nvec4 color=vec4(1.0);\n#ifdef CLEAR_FROM_TEXTURE\ncolor=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));\n#endif\nglFragColor=color;\n#else\n#ifdef SDF_SUBPASS\nhighp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;\n#ifdef FOG\nfog=v_fog;\n#endif\n#ifdef RENDER_CUTOFF\nfog*=v_cutoff_opacity;\n#endif\nglFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));\n#else\nvec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);\n#ifdef OVERDRAW_INSPECTOR\ncolor=vec4(1.0);\n#endif\nglFragColor=color;\n#endif\nHANDLE_WIREFRAME_DEBUG;\n#endif\n}",'#include "_prelude_fog.vertex.glsl"\nin highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;\n#ifdef SDF_SUBPASS\nout highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;\n#ifdef FOG\nout highp float v_fog;\n#endif\n#endif\nuniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;\n#pragma mapbox: define highp float flood_light_ground_radius\nconst float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {\n#pragma mapbox: initialize highp float flood_light_ground_radius\nvec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;\n#ifdef SDF_SUBPASS\nv_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);\n#ifdef FOG\nv_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);\n#endif\n#endif\nfloat hidden_by_landmark=0.0;\n#ifdef HAS_CENTROID\nhidden_by_landmark=a_hidden_by_landmark;\n#endif\nfloat isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),hillshadePrepare:ai("precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}","uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ai('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\nglFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);\n#endif\n#ifdef FOG\nglFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),line:ai('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;\n#ifdef ELEVATED_ROADS\nin highp float v_road_z_offset;\n#endif\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;in vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\n#ifdef INDICATOR_CUTOUT\nin highp float v_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\nfloat luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trim_alpha=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}\n#endif\nif (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#ifdef ELEVATED_ROADS\nout_color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);\n#else\nout_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color,v_z_offset);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define EXTRUDE_SCALE 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)\nin vec3 a_z_offset_width;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nin highp vec3 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nin float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;\n#ifdef ELEVATED\nuniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {\n#ifdef ELEVATION_REFERENCE_SEA\nreturn 0.0;\n#else\nreturn elevation(apos);\n#endif\n}\n#endif\nout vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;\n#ifdef ELEVATED_ROADS\nout highp float v_road_z_offset;\n#endif\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#ifdef INDICATOR_CUTOUT\nout highp float v_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat a_z_offset;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS)\na_z_offset=a_z_offset_width.x;\n#endif\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;\n#ifdef VARIABLE_LINE_WIDTH\nfloat left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;\n#else\nhalfwidth=(u_width_scale*width)/2.0;\n#endif\noffset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;\n#ifdef ELEVATED_ROADS\nv_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;\n#else\n#ifdef ELEVATED\nvec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;\n#ifdef CROSS_SLOPE_VERTICAL\nfloat top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);\n#else\n#ifdef CROSS_SLOPE_HORIZONTAL\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;\n#else\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;\n#endif\n#endif\ngl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);\n#else\ngl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);\n#endif\n#endif\n#ifdef ELEVATED_ROADS\n#ifdef RENDER_SHADOWS\nvec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;\n#ifdef NORMAL_OFFSET\nvec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#endif\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),0.001);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nhighp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);\n#else\nv_uv=vec3(a_uv_x,0.0,line_progress);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n#ifdef INDICATOR_CUTOUT\nv_z_offset=a_z_offset;\n#endif\n}'),linePattern:ai('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec3 v_uv;\n#endif\n#ifdef ELEVATED_ROADS\nin highp float v_road_z_offset;\n#endif\n#ifdef LINE_JOIN_NONE\nin vec2 v_pattern_data;\n#endif\n#ifdef INDICATOR_CUTOUT\nin highp float v_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\nuniform float u_emissive_strength;\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define mediump float pixel_ratio\n#pragma mapbox: define mediump float blur\n#pragma mapbox: define mediump float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize mediump float pixel_ratio\n#pragma mapbox: initialize mediump float blur\n#pragma mapbox: initialize mediump float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}\n#endif\n#ifdef LINE_JOIN_NONE\nhighp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}\n#endif\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting_with_emission_ground(color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#ifdef ELEVATED_ROADS\ncolor.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);\n#else\ncolor.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color,v_z_offset);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS)\nin vec3 a_z_offset_width;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec3 a_packed;\n#endif\nin highp float a_linesofar;\n#ifdef LINE_JOIN_NONE\nin highp vec3 a_pattern_data;out vec2 v_pattern_data;\n#endif\n#ifdef INDICATOR_CUTOUT\nout highp float v_z_offset;\n#endif\nuniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;\n#ifdef ELEVATED\nuniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {\n#ifdef ELEVATION_REFERENCE_SEA\nreturn 0.0;\n#else\nreturn elevation(apos);\n#endif\n}\n#endif\nout vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nout highp vec3 v_uv;\n#endif\n#ifdef ELEVATED_ROADS\nout highp float v_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\n#pragma mapbox: define mediump float blur\n#pragma mapbox: define mediump float opacity\n#pragma mapbox: define mediump float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define mediump float floorwidth\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define mediump float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize mediump float blur\n#pragma mapbox: initialize mediump float opacity\n#pragma mapbox: initialize mediump float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize mediump float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize mediump float pixel_ratio\nfloat a_z_offset;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS)\na_z_offset=a_z_offset_width.x;\n#endif\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;\n#ifdef ELEVATED_ROADS\nv_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;\n#else\n#ifdef ELEVATED\nvec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;\n#ifdef CROSS_SLOPE_VERTICAL\nfloat top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);\n#else\n#ifdef CROSS_SLOPE_HORIZONTAL\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;\n#else\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;\n#endif\n#endif\ngl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);\n#else\ngl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);\n#endif\n#endif\n#ifdef ELEVATED_ROADS\n#ifdef RENDER_SHADOWS\nvec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;\n#ifdef NORMAL_OFFSET\nvec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#endif\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);\n#ifdef LINE_JOIN_NONE\nv_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n#ifdef INDICATOR_CUTOUT\nv_z_offset=a_z_offset;\n#endif\n}'),raster:ai('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_raster_array.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nin float v_split_fade;\n#endif\nuniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;\n#ifndef RASTER_ARRAY\nuniform highp sampler2D u_image0;uniform sampler2D u_image1;\n#endif\n#ifdef RASTER_COLOR\nuniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;\n#endif\nvoid main() {vec4 color0,color1,color;vec2 value;\n#ifdef RASTER_COLOR\n#ifdef RASTER_ARRAY\n#ifdef RASTER_ARRAY_LINEAR\nvalue=mix(\nraTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#else\nvalue=mix(\nraTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#endif\nif (value.y > 0.0) value.x/=value.y;\n#else\ncolor=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);\n#endif\ncolor=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;\n#else\ncolor0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);\n#endif\ncolor.a*=u_opacity;\n#ifdef GLOBE_POLES\ncolor.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);\n#endif\nvec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef PROJECTION_GLOBE_VIEW\nglFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));\n#endif\n#ifdef RENDER_CUTOFF\nglFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;in vec2 a_texture_pos;\n#endif\nout vec2 v_pos0;out vec2 v_pos1;out float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nout float v_split_fade;\n#endif\nvoid main() {vec2 uv;\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);\n#endif\n#else\nfloat w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    \nv_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\ngl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;\n#ifdef RENDER_CUTOFF\nv_depth=gl_Position.z;\n#endif\n}'),rasterParticle:ai('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\nin vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\nuv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}'),rasterParticleDraw:ai("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",'#include "_prelude_raster_particle.glsl"\nin float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(\nmod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}'),rasterParticleTexture:ai("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:ai('#include "_prelude_raster_particle.glsl"\nuniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(\nlinearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)\n);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}',"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:ai('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;\n#ifdef ICON_TRANSITION\nuniform float u_icon_transition;\n#endif\n#ifdef COLOR_ADJUSTMENT\nuniform mat4 u_color_adj_mat;\n#endif\n#ifdef INDICATOR_CUTOUT\nin highp float v_z_offset;\n#endif\nin vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nin vec2 v_tex_b;\n#endif\nin float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;\n#ifdef RENDER_TEXT_AND_SYMBOL\nin float is_sdf;in vec2 v_tex_a_icon;\n#endif\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];\n#ifdef RENDER_TEXT_AND_SYMBOL\nif (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nreturn;}\n#endif\n#ifdef RENDER_SDF\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;\n#else\n#ifdef ICON_TRANSITION\nvec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);\n#else\nout_color=texture(u_texture,v_tex_a);\n#endif\n#ifdef COLOR_ADJUSTMENT\nout_color=u_color_adj_mat*out_color;\n#endif\n#endif\nout_color*=opacity*fade_opacity;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color,v_z_offset);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_auto_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\n#ifdef ICON_TRANSITION\nin vec2 a_texb;\n#endif\n#ifdef OCCLUSION_QUERIES\nin float a_occlusion_query_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\nout highp float v_z_offset;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nout vec2 v_tex_b;\n#endif\nout float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;\n#ifdef RENDER_TEXT_AND_SYMBOL\nout float is_sdf;out vec2 v_tex_a_icon;\n#endif\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\n#pragma mapbox: define lowp float occlusion_opacity\n#pragma mapbox: define lowp float z_offset\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\n#pragma mapbox: initialize lowp float occlusion_opacity\n#pragma mapbox: initialize lowp float z_offset\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_auto_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;\n#endif\nvec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\n#ifdef PROJECTED_POS_ON_VIEWPORT\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);\n#else\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    \n#endif\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\n#ifdef Z_OFFSET\nz+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;\n#else\nz+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;\n#endif\nfloat occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));\n#ifdef DEPTH_OCCLUSION\nfloat depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;\n#endif\n#ifdef OCCLUSION_QUERIES\nfloat occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;\n#endif\nfloat alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;\n#ifdef RENDER_TEXT_AND_SYMBOL\nis_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;\n#endif\n#ifdef ICON_TRANSITION\nv_tex_b=a_texb/u_texsize;\n#endif\n#ifdef INDICATOR_CUTOUT\nv_z_offset=e;\n#endif\n}'),terrainRaster:ai('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;in vec2 v_pos0;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#endif\nuniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;\n#ifdef LIGHTING_3D_MODE\nconst vec3 normal=vec3(0.0,0.0,1.0);\n#ifdef RENDER_SHADOWS\nfloat cutoffOpacity=1.0;\n#ifdef RENDER_CUTOFF\ncutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);\n#endif\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nvec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;\n#else\nfloat lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));\n#endif\n#else\nfloat lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;\n#endif\n#endif\n#else\ncolor=image_color;\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;\n#endif\nvoid main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);\n#endif\n}'),terrainDepth:ai("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}'),skybox:ai('#include "_prelude_fog.fragment.glsl"\nin lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',ul),skyboxGradient:ai('#include "_prelude_fog.fragment.glsl"\nin highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',ul),skyboxCapture:ai("\nin highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}","in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:ai('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nhighp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nraster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);\n#else\nraster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;\n#else\ncolor=apply_lighting_ground(color);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;\n#endif\nout vec2 v_pos0;void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);globe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}'),globeAtmosphere:ai('#include "_prelude_fog.fragment.glsl"\nuniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {\n#ifdef ALPHA_PASS\nglFragColor=vec4(0,0,0,0);return;\n#else\n#ifdef NATIVE\nglFragColor=vec4(1,1,1,1);\n#else\nglFragColor=vec4(0,0,0,1);\n#endif\nreturn;\n#endif\n}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;\n#ifdef ALPHA_PASS\nfloat a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);\n#else\nvec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);\n#endif\n}',"in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}"),model:ai('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;\n#endif\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nuniform vec4 u_occlusionTextureTransform;\n#endif\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#ifdef HAS_ATTRIBUTE_a_pbr\nin lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;\n#endif\n#ifdef HAS_TEXTURE_u_baseColorTexture\nuniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;\n#endif\n#ifdef HAS_TEXTURE_u_metallicRoughnessTexture\nuniform sampler2D u_metallicRoughnessTexture;\n#endif\n#ifdef HAS_TEXTURE_u_occlusionTexture\nuniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;\n#endif\n#ifdef HAS_TEXTURE_u_normalTexture\nuniform sampler2D u_normalTexture;\n#endif\n#ifdef HAS_TEXTURE_u_emissionTexture\nuniform sampler2D u_emissionTexture;\n#endif\n#ifdef APPLY_LUT_ON_GPU\nuniform highp sampler3D u_lutTexture;\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nin highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;\n#ifdef DEPTH_D24\nhighp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}\n#else\nhighp float unpack_depth_rgba(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}\n#endif\nbool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;\n#ifdef DEPTH_D24\nhighp float depth=unpack_depth(texture(u_depthTexture,coord).r);\n#else\nhighp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));\n#endif\nreturn v_depth > depth+0.0005;}\n#endif\n#define saturate(_x) clamp(_x,0.,1.)\nvec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)\n{\n#ifdef LIGHTING_3D_MODE\nvec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));\n#endif\nreturn apply_lighting(albedo,transformed_normal,lighting_factor);\n#else\nvec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;\n#endif\n}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;\n#ifdef HAS_ATTRIBUTE_a_color_3f\nalbedo*=vec4(color_3f,1.0);\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#else\n#ifdef HAS_ATTRIBUTE_a_color_4f\nalbedo*=color_4f;\n#endif\n#endif\n#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)\nvec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}\n#ifdef UNPREMULT_TEXTURE_IN_SHADER\nif(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;\n#endif\nif(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}\n#endif\nvec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);\n#ifdef APPLY_LUT_ON_GPU\ncolor=applyLUT(u_lutTexture,color);\n#endif\nreturn color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {\n#ifdef HAS_TEXTURE_u_normalTexture\nhighp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;\n#else\nreturn mat3(1.0);\n#endif\n}highp vec3 getNormal(){highp vec3 n;\n#ifdef HAS_ATTRIBUTE_a_normal_3f\nn=normalize(normal_3f);\n#else\nhighp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;\n#endif\n#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nvec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);\n#endif\nreturn n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;\n#ifdef HAS_ATTRIBUTE_a_pbr\nmat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;\n#endif\n#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) \nvec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;\n#endif\nconst float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)\n{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)\n{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)\n{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)\n{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)\n{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)\n{\n#ifdef LIGHTING_3D_MODE\nreturn mat.diffuseColor;\n#else\nreturn mat.diffuseColor/PI;\n#endif\n}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)\n{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)\n{vec3 env_light=vec3(0.65,0.65,0.65);\n#ifdef LIGHTING_3D_MODE\nfloat ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;\n#endif\nvec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)\n{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=NdotL;\n#endif\nvec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;\n#if !defined(LIGHTING_3D_MODE)\nconst vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);\n#endif\ncolor*=intensityFactor;return color;}void main() {\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nif (isOccluded()) {discard;}\n#endif\nvec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;\n#ifdef LIGHTING_3D_MODE\nlightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;\n#endif\nvec4 finalColor;\n#ifdef DIFFUSE_SHADED\nvec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);\n#ifdef HAS_TEXTURE_u_occlusionTexture\nfloat ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;\n#endif\nfinalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;\n#else\nMaterial mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;\n#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nvec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;\n#else\nvec2 uv=uv_2f;\n#endif\nao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;\n#endif\nvec4 emissive=u_emissiveFactor;\n#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nemissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);\n#endif\n#ifdef APPLY_LUT_ON_GPU\nfloat emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;\n#endif\ncolor+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;\n#ifdef HAS_ATTRIBUTE_a_pbr\nfloat resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;\n#ifdef APPLY_LUT_ON_GPU\ncolor_mix=applyLUT(u_lutTexture,color_mix);\n#endif\ncolor=mix(color,color_mix,min(1.0,resEmission));\n#ifdef HAS_ATTRIBUTE_a_color_4f\nfloat distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);\n#endif\n#endif\nvec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);\n#endif\n#ifdef FOG\nfinalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));\n#endif\n#ifdef RENDER_CUTOFF\nfinalColor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\nfinalColor=applyCutout(finalColor,v_position_height.w);\n#endif\nglFragColor=finalColor;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec3 a_pos_3f;\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr\n#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength\nuniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_normal_matrix;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;\n#endif\nout vec4 v_position_height;out lowp vec4 v_color_mix;\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nout highp float v_depth;\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\nout lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;\n#endif\nvec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute-custom highp vec4 pbr\n#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength\nhighp mat4 normal_matrix;\n#ifdef INSTANCED_ARRAYS\nnormal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\nnormal_matrix=u_normal_matrix;\n#endif\nvec3 local_pos;mat3 rs;\n#ifdef MODEL_POSITION_ON_GPU\nvec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;\n#else\nlocal_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);\n#endif\nv_position_height.w=a_pos_3f.z;\n#ifdef HAS_ATTRIBUTE_a_pbr\nvec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(local_pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nfloat x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);\n#else\nnormal_3f=vec3(normal_matrix*vec4(normal_3f,0));\n#endif\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#ifdef HAS_ATTRIBUTE_a_color_4f\nv_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);\n#ifdef NORMAL_OFFSET\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nvec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\n#else\nvec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\n#endif\n#endif\n#endif\nv_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;\n#endif\n}'),modelDepth:ai("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}","in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;\n#ifdef MODEL_POSITION_ON_GPU\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_instance;\n#endif\nuniform highp mat4 u_node_matrix;\n#endif\nvoid main() {\n#ifdef MODEL_POSITION_ON_GPU\nhighp mat4 instance;\n#ifdef INSTANCED_ARRAYS\ninstance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\ninstance=u_instance;\n#endif\nvec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);\n#else\ngl_Position=u_matrix*vec4(a_pos_3f,1);\n#endif\nv_depth=gl_Position.z/gl_Position.w;}"),stars:ai("in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)\n{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}","\nin vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}"),snowParticle:ai("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}","\nin highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; \nuniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; \nuniform float u_horizontalOscillationRate; \nuniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+\nlocalY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}"),rainParticle:ai("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}","\nin highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; \nuniform float u_velocity; \nuniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; \npos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+\nlocalY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}"),vignette:ai("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:ai("uniform vec4 u_color;void main() {glFragColor=u_color;}",'#include "_prelude_terrain.vertex.glsl"\nin highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;\n#ifdef TERRAIN\nfloat e=elevation(world_pos.xy);world_pos.z+=e;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}')};function hl(m,s){const c=m.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let _ of c)if(_=_.trim(),"#"===_[0]&&_.includes("if")&&!_.includes("endif")){_=_.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const v=_.split(" ");for(const x of v)s.includes(x)||s.push(x)}}function ai(m,s){const c=/#include\s+"([^"]+)"/g,_=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let v=s.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);v&&(v=v.map(N=>{const z=N.split(" ");return z[z.length-1]}),v=[...new Set(v)]);const x={},E=[],R=[];if(m=m.replace(c,(N,z)=>(R.push(z),"")),(s=s.replace(c,(N,z)=>(E.push(z),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let F=[...nd];hl(m,F),hl(s,F);for(const N of[...E,...R])id[N]||console.error(`Undefined include: ${N}`),ju[N]||(ju[N]=[],hl(id[N],ju[N])),F=[...F,...ju[N]];return{fragmentSource:m=m.replace(_,(N,z,U,j,W)=>(x[W]=!0,"define"===z?`\n#ifndef HAS_UNIFORM_u_${W}\nin ${U} ${j} ${W};\n#else\nuniform ${U} ${j} u_${W};\n#endif\n`:"initialize"===z?`\n#ifdef HAS_UNIFORM_u_${W}\n    ${U} ${j} ${W} = u_${W};\n#endif\n`:"define-attribute"===z?`\n#ifdef HAS_ATTRIBUTE_a_${W}\n    in ${U} ${j} ${W};\n#endif\n`:"initialize-attribute"===z?"":void 0)),vertexSource:s=s.replace(_,(N,z,U,j,W)=>{const ne="float"===j?"vec2":j,J=W.match(/color/)?"color":ne;return"define-attribute-vertex-shader-only"===z?`\n#ifdef HAS_ATTRIBUTE_a_${W}\nin ${U} ${j} a_${W};\n#endif\n`:x[W]?"define"===z?`\n#ifndef HAS_UNIFORM_u_${W}\nuniform lowp float u_${W}_t;\nin ${U} ${ne} a_${W};\nout ${U} ${j} ${W};\n#else\nuniform ${U} ${j} u_${W};\n#endif\n`:"initialize"===z?"vec4"===J?`\n#ifndef HAS_UNIFORM_u_${W}\n    ${W} = a_${W};\n#else\n    ${U} ${j} ${W} = u_${W};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${W}\n    ${W} = unpack_mix_${J}(a_${W}, u_${W}_t);\n#else\n    ${U} ${j} ${W} = u_${W};\n#endif\n`:"define-attribute"===z?`\n#ifdef HAS_ATTRIBUTE_a_${W}\n    in ${U} ${j} a_${W};\n    out ${U} ${j} ${W};\n#endif\n`:"initialize-attribute"===z?`\n#ifdef HAS_ATTRIBUTE_a_${W}\n    ${W} = a_${W};\n#endif\n`:void 0:"define"===z?`\n#ifndef HAS_UNIFORM_u_${W}\nuniform lowp float u_${W}_t;\nin ${U} ${ne} a_${W};\n#else\nuniform ${U} ${j} u_${W};\n#endif\n`:"define-instanced"===z?"mat4"===J?`\n#ifdef INSTANCED_ARRAYS\nin vec4 a_${W}0;\nin vec4 a_${W}1;\nin vec4 a_${W}2;\nin vec4 a_${W}3;\n#else\nuniform ${U} ${j} u_${W};\n#endif\n`:`\n#ifdef INSTANCED_ARRAYS\nin ${U} ${ne} a_${W};\n#else\nuniform ${U} ${j} u_${W};\n#endif\n`:"initialize-attribute-custom"===z?`\n#ifdef HAS_ATTRIBUTE_a_${W}\n    ${U} ${j} ${W} = a_${W};\n#endif\n`:"vec4"===J?`\n#ifndef HAS_UNIFORM_u_${W}\n    ${U} ${j} ${W} = a_${W};\n#else\n    ${U} ${j} ${W} = u_${W};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${W}\n    ${U} ${j} ${W} = unpack_mix_${J}(a_${W}, u_${W}_t);\n#else\n    ${U} ${j} ${W} = u_${W};\n#endif\n`}),staticAttributes:v,usedDefines:F,vertexIncludes:E,fragmentIncludes:R}}class n_{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(s,c,_,v,x,E,R,F){this.context=s;let N=this.boundPaintVertexBuffers.length!==v.length;for(let U=0;!N&&U<v.length;U++)this.boundPaintVertexBuffers[U]!==v[U]&&(N=!0);let z=this.boundDynamicVertexBuffers.length!==R.length;for(let U=0;!z&&U<R.length;U++)this.boundDynamicVertexBuffers[U]!==R[U]&&(z=!0);if(!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==_||N||z||this.boundIndexBuffer!==x||this.boundVertexOffset!==E)this.freshBind(c,_,v,x,E,R,F);else{s.bindVertexArrayOES.set(this.vao);for(const U of R)U&&(U.bind(),F&&U.instanceCount&&U.setVertexAttribDivisor(s.gl,c,F));x&&x.dynamicDraw&&x.bind()}}freshBind(s,c,_,v,x,E,R){const F=s.numAttributes,N=this.context,z=N.gl;this.vao&&this.destroy(),this.vao=N.gl.createVertexArray(),N.bindVertexArrayOES.set(this.vao),this.boundProgram=s,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=v,this.boundVertexOffset=x,this.boundDynamicVertexBuffers=E,c.enableAttributes(z,s),c.bind(),c.setVertexAttribPointers(z,s,x);for(const U of _)U.enableAttributes(z,s),U.bind(),U.setVertexAttribPointers(z,s,x);for(const U of E)U&&(U.enableAttributes(z,s),U.bind(),U.setVertexAttribPointers(z,s,x),R&&U.instanceCount&&U.setVertexAttribDivisor(z,s,R));v&&v.bind(),N.currentNumAttributes=F}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Dm(m,s){const c=Math.pow(2,s.canonical.z),_=s.canonical.y;return[new h.ac(0,_/c).toLngLat().lat,new h.ac(0,(_+1)/c).toLngLat().lat]}function rd(m,s,c,_,v,x,E){const R=m.context,F=R.gl,N=c.hillshadeFBO;if(!N)return;m.prepareDrawTile();const z=m.isTileAffectedByFog(s),U=m.getOrCreateProgram("hillshade",{overrideFog:z});R.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,N.colorAttachment.get());const j=((oe,se,fe,be)=>{const ve=fe.paint.get("hillshade-shadow-color"),we="none"===fe.paint.get("hillshade-shadow-color-use-theme").constantOr("default"),Ee=fe.paint.get("hillshade-highlight-color"),De="none"===fe.paint.get("hillshade-highlight-color-use-theme").constantOr("default"),Me=fe.paint.get("hillshade-accent-color"),ke="none"===fe.paint.get("hillshade-accent-color-use-theme").constantOr("default"),Oe=fe.paint.get("hillshade-emissive-strength");let et=h.ak(fe.paint.get("hillshade-illumination-direction"));if("viewport"===fe.paint.get("hillshade-illumination-anchor"))et-=oe.transform.angle;else if(oe.style&&oe.style.enable3dLights()&&oe.style.directionalLight){const ot=oe.style.directionalLight.properties.get("direction"),lt=h.cc(ot.x,ot.y,ot.z);et=h.ak(lt[1])}const qe=!oe.options.moving;return{u_matrix:be||oe.transform.calculateProjMatrix(se.tileID.toUnwrapped(),qe),u_image:0,u_latrange:Dm(0,se.tileID),u_light:[fe.paint.get("hillshade-exaggeration"),et],u_shadow:ve.toRenderColor(we?null:fe.lut),u_highlight:Ee.toRenderColor(De?null:fe.lut),u_emissive_strength:Oe,u_accent:Me.toRenderColor(ke?null:fe.lut)}})(m,c,_,m.terrain?s.projMatrix:null);m.uploadCommonUniforms(R,U,s.toUnwrapped());const{tileBoundsBuffer:W,tileBoundsIndexBuffer:ne,tileBoundsSegments:J}=m.getTileBoundsBuffers(c);U.draw(m,F.TRIANGLES,v,x,E,Mn.disabled,j,_.id,W,ne,J)}function Lo(m,s,c){if(!s.needsDEMTextureUpload)return;const _=m.context,v=_.gl;_.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||m.getTileTexture(c.stride);const x=c.getPixels();s.demTexture?s.demTexture.update(x,{premultiply:!1}):s.demTexture=new h.T(_,x,v.R32F,{premultiply:!1}),s.needsDEMTextureUpload=!1}function Hu(m,s,c){const _=m.context,v=_.gl;if(!s.dem)return;const x=s.dem;if(_.activeTexture.set(v.TEXTURE1),Lo(m,s,x),!s.demTexture)return;s.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE);const E=x.dim;_.activeTexture.set(v.TEXTURE0);let R=s.hillshadeFBO;if(!R){const j=new h.T(_,{width:E,height:E,data:null},v.RGBA8);j.bind(v.LINEAR,v.CLAMP_TO_EDGE),R=s.hillshadeFBO=_.createFramebuffer(E,E,!0,"renderbuffer"),R.colorAttachment.set(j.texture)}_.bindFramebuffer.set(R.framebuffer),_.viewport.set([0,0,E,E]);const{tileBoundsBuffer:F,tileBoundsIndexBuffer:N,tileBoundsSegments:z}=m.getMercatorTileBoundsBuffers(),U=[];m.linearFloatFilteringSupported()&&U.push("TERRAIN_DEM_FLOAT_FORMAT"),m.getOrCreateProgram("hillshadePrepare",{defines:U}).draw(m,v.TRIANGLES,cn.disabled,Rn.disabled,ei.unblended,Mn.disabled,((j,W)=>{const ne=W.stride,J=h.ad.mat4.create();return h.ad.mat4.ortho(J,0,h.ai,-h.ai,0,0,1),h.ad.mat4.translate(J,J,[0,-h.ai,0]),{u_matrix:J,u_image:1,u_dimension:[ne,ne],u_zoom:j.overscaledZ}})(s.tileID,x),c.id,F,N,z),s.needsHillshadePrepare=!1}class _r{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class bx extends _r{getDefault(){return h.al.transparent}set(s){const c=this.current;(s.r!==c.r||s.g!==c.g||s.b!==c.b||s.a!==c.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class i_ extends _r{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class Mm extends _r{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class $u extends _r{getDefault(){return[!0,!0,!0,!0]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||s[2]!==c[2]||s[3]!==c[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Zd extends _r{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class Sv extends _r{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class Dv extends _r{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){const c=this.current;(s.func!==c.func||s.ref!==c.ref||s.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class xx extends _r{getDefault(){const s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||s[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class Gu extends _r{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;s?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=s,this.dirty=!1}}class Bs extends _r{getDefault(){return[0,1]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class r_ extends _r{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;s?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=s,this.dirty=!1}}class us extends _r{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class Xd extends _r{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;s?c.enable(c.BLEND):c.disable(c.BLEND),this.current=s,this.dirty=!1}}class Tm extends _r{getDefault(){const s=this.gl;return[s.ONE,s.ZERO,s.ONE,s.ZERO]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||s[2]!==c[2]||s[3]!==c[3]||this.dirty)&&(this.gl.blendFuncSeparate(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Im extends _r{getDefault(){return h.al.transparent}set(s){const c=this.current;(s.r!==c.r||s.g!==c.g||s.b!==c.b||s.a!==c.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Io extends _r{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(s,s),this.current=s,this.dirty=!1)}}class Am extends _r{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;s?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=s,this.dirty=!1}}class o_ extends _r{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class Kd extends _r{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}let s_=class extends _r{getDefault(){return null}set(m){(m!==this.current||this.dirty)&&(this.gl.useProgram(m),this.current=m,this.dirty=!1)}};class a_ extends _r{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class km extends _r{getDefault(){const s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||s[2]!==c[2]||s[3]!==c[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Mv extends _r{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class Tv extends _r{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Gh extends _r{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class l_ extends _r{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class Rm extends _r{getDefault(){return null}set(s){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class Nr extends _r{getDefault(){return null}set(s){this.gl&&(s!==this.current||this.dirty)&&(this.gl.bindVertexArray(s),this.current=s,this.dirty=!1)}}class nn extends _r{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class mi extends _r{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class fo extends _r{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class No extends _r{constructor(s,c){super(s),this.context=s,this.parent=c}getDefault(){return null}}class zo extends No{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class Ts extends No{attachment(){return this.gl.DEPTH_ATTACHMENT}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class ql extends No{attachment(){return this.gl.DEPTH_ATTACHMENT}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,this.attachment(),c.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class Ar extends Ts{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const mo=(m,s,c)=>({u_matrix:m,u_image0:0,u_skirt_height:s,u_ground_shadow_factor:c}),pl=(m,s,c,_,v,x,E,R,F,N,z,U,j,W,ne,J)=>({u_proj_matrix:Float32Array.from(m),u_globe_matrix:s,u_normalize_matrix:Float32Array.from(_),u_merc_matrix:c,u_zoom_transition:v,u_merc_center:x,u_image0:0,u_frustum_tl:E,u_frustum_tr:R,u_frustum_br:F,u_frustum_bl:N,u_globe_pos:z,u_globe_radius:U,u_viewport:j,u_grid_matrix:J?Float32Array.from(J):new Float32Array(9),u_skirt_height:W,u_far_z_cutoff:ne});function ci(m,s){return null!=m&&null!=s&&!(!m.hasData()||!s.hasData())&&null!=m.demTexture&&null!=s.demTexture&&m.tileID.key!==s.tileID.key}const hs=new class{constructor(){this.operations={}}newMorphing(m,s,c,_,v){if(m in this.operations){const x=this.operations[m];x.to.tileID.key!==c.tileID.key&&(x.queued=c)}else this.operations[m]={startTime:_,phase:0,duration:v,from:s,to:c,queued:null}}getMorphValuesForProxy(m){if(!(m in this.operations))return null;const s=this.operations[m];return{from:s.from,to:s.to,phase:s.phase}}update(m){for(const s in this.operations){const c=this.operations[s];for(c.phase=(m-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,m)){delete this.operations[s];break}}}_nextOp(m,s){return!!m.queued&&(m.from=m.to,m.to=m.queued,m.queued=null,m.phase=0,m.startTime=s,!0)}_validOp(m){return m.from.hasData()&&m.to.hasData()}},qh={0:null,1:"TERRAIN_VERTEX_MORPHING"};function fa(m,s,c){if(0===s)return 0;const _=s<1&&514===c?.25/s:1;return 6*Math.pow(1.5,22-m)*Math.max(s,1)*_}function Zr(m,s){const c=1<<m.z;return!s&&(0===m.x||m.x===c-1)||0===m.y||m.y===c-1}const fl=m=>({u_matrix:m});function od(m,s,c,_,v){if(v>0){const x=h.q.now(),E=(x-m.timeAdded)/v,R=s?(x-s.timeAdded)/v:-1,F=c.getSource(),N=_.coveringZoomLevel({tileSize:F.tileSize,roundZoom:F.roundZoom}),z=!s||Math.abs(s.tileID.overscaledZ-N)>Math.abs(m.tileID.overscaledZ-N),U=z&&m.refreshedUponExpiration?1:h.ay(z?E:1-R,0,1);return m.refreshedUponExpiration&&E>=1&&(m.refreshedUponExpiration=!1),s?{opacity:1,mix:1-U}:{opacity:U,mix:0}}return{opacity:1,mix:0}}class wc extends cs{constructor(s){const c={type:"raster-dem",maxzoom:s.transform.maxZoom},_=new h.D(h.cj(),null),v=Zp("mock-dem",c,_,s.style);super("mock-dem",v,!1),v.setEventedParent(this),this._sourceLoaded=!0}_loadTile(s,c){s.state="loaded",c(null)}}class qu extends cs{constructor(s){const c=Zp("proxy",{type:"geojson",maxzoom:s.transform.maxZoom},new h.D(h.cj(),null),s.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=s,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(s,c,_){if(s.freezeTileCoverage)return;this.transform=s;const v=s.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((x,E)=>{if(x[E.key]="",!this._tiles[E.key]){const R=new po(E,this._source.tileSize*E.overscaleFactor(),s.tileZoom);R.state="loaded",this._tiles[E.key]=R}return x},{});for(const x in this._tiles)x in v||(this.freeFBO(x),this._tiles[x].unloadVectorData(),delete this._tiles[x])}freeFBO(s){const c=this.proxyCachedFBO[s];if(void 0!==c){const _=Object.values(c);this.renderCachePool.push(..._),delete this.proxyCachedFBO[s]}}deallocRenderCache(){this.renderCache.forEach(s=>s.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class sf extends h.aH{constructor(s,c,_){super(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,s.canonical.y),this.proxyTileKey=c,this.projMatrix=_}}class sd extends h.cK{constructor(s,c){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},s.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),s.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),s.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=s,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[_,v,x]=function(){const N=new h.b5,z=new h.aV,U=131;N.reserve(17161),z.reserve(33800);const j=h.ai/128,W=h.ai+j/2,ne=W+j;for(let oe=-j;oe<ne;oe+=j)for(let se=-j;se<ne;se+=j){const fe=se<0||se>W||oe<0||oe>W?24575:0,be=h.ay(Math.round(se),0,h.ai),ve=h.ay(Math.round(oe),0,h.ai);N.emplaceBack(be+fe,ve)}const J=(oe,se)=>{const fe=se*U+oe;z.emplaceBack(fe+1,fe,fe+U),z.emplaceBack(fe+U,fe+U+1,fe+1)};for(let oe=1;oe<129;oe++)for(let se=1;se<129;se++)J(se,oe);return[0,129].forEach(oe=>{for(let se=0;se<130;se++)J(se,oe),J(oe,se)}),[N,z,32768]}(),E=s.context;this.gridBuffer=E.createVertexBuffer(_,h.b7.members),this.gridIndexBuffer=E.createIndexBuffer(v),this.gridSegments=h.b8.simpleSegment(0,0,_.length,v.length),this.gridNoSkirtSegments=h.b8.simpleSegment(0,0,_.length,x),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new qu(c.map),this.orthoMatrix=h.ad.mat4.create(),h.ad.mat4.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,h.ai,0,h.ai,0,1);const R=E.gl;this._overlapStencilMode=new Rn({func:R.GEQUAL,mask:255},0,255,R.KEEP,R.KEEP,R.REPLACE),this._previousZoom=s.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new wc(c.map),this._pendingGroundEffectLayers=[]}set style(s){s.on("data",this._onStyleDataEvent.bind(this)),this._style=s,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(s,c,_){if(s&&s.terrain){this._style!==s&&(this.style=s,this._evaluationZoom=void 0);const v=s.terrain.properties,x=0===s.terrain.drapeRenderMode,E=s.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=h.q.now();const R=s.terrain&&s.terrain.scope,F=v.get("source"),N=x?this._mockSourceCache:s.getSourceCache(F,R);if(!N)return void h.w(`Couldn't find terrain source "${F}".`);if(this.sourceCache=N,this._attenuationRange=s.terrain.getAttenuationRange(),this._exaggeration=E?this.calculateExaggeration(c):v.get("exaggeration"),!c.projection.requiresDraping&&E&&0===this._exaggeration)return void this._disable();this.enabled=!0;const z=()=>{this.sourceCache.used&&h.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const U=this.getScaledDemTileSize();this.sourceCache.update(c,U,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,z(),this._initializing=!0),z(),c.updateElevation(!0,_),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0,this._previousZoom=c.zoom}else this._disable()}calculateExaggeration(s){if(this._attenuationRange&&s.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(s.zoom);const c=this._previousCameraAltitude,_=s.getFreeCameraOptions().position.z/s.pixelsPerMeter*s.worldSize;this._previousCameraAltitude=_;const v=null!=c?_-c:Number.MAX_VALUE;if(Math.abs(v)<2)return this._exaggeration;const x=s.zoom,E=this._style.terrain;if(!this._previousUpdateTimestamp)return E.getExaggeration(x);let R=x-this._previousZoom;const F=this._previousUpdateTimestamp;let N=x;null!=this._evaluationZoom&&(N=this._evaluationZoom,Math.abs(x-N)>.5&&(R=.5*(x-N+R)),R*v<0&&(N+=R)),this._evaluationZoom=N;const z=E.getExaggeration(N),U=z===E.getExaggeration(Math.max(0,N-.1));if(U&&Math.abs(z-this._exaggeration)<.01)return z;let j=Math.min(.1,.00375*(this._updateTimestamp-F));return(U||z<.1||Math.abs(R)<1e-4)&&(j=Math.min(.2,4*j)),h.ah(this._exaggeration,z,j)}resetTileLookupCache(s){this._findCoveringTileCache[s]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(s){s.coord&&"source"===s.dataType?this._clearRenderCacheForTile(s.sourceCacheId,s.coord):"style"===s.dataType&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const s in this._style._mergedSourceCaches)this._style._mergedSourceCaches[s].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(s=>s.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const s=2*this.proxySourceCache.getSource().tileSize;return[s,s]}set useVertexMorphing(s){this._useVertexMorphing=s}updateTileBinding(s){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,_=this.painter.transform;this._initializing&&(this._initializing=0===_._centerAltitude&&-1===this.getAtPointOrZero(h.ac.fromLngLat(_.center),-1),this._emptyDEMTextureDirty=!this._initializing);const v=this.proxyCoords=c.getIds().map(F=>{const N=c.getTileByID(F).tileID;return N.projMatrix=_.calculateProjMatrix(N.toUnwrapped()),N});!function(F,N){const z=N.transform.pointCoordinate(N.transform.getCameraPoint()),U=new h.P(z.x,z.y);F.sort((j,W)=>{if(W.overscaledZ-j.overscaledZ)return W.overscaledZ-j.overscaledZ;const ne=new h.P(j.canonical.x+(1<<j.canonical.z)*j.wrap,j.canonical.y),J=new h.P(W.canonical.x+(1<<W.canonical.z)*W.wrap,W.canonical.y),oe=U.mult(1<<j.canonical.z);return oe.x-=.5,oe.y-=.5,oe.distSqr(ne)-oe.distSqr(J)})}(v,this.painter);const x=this.proxyToSource||{};this.proxyToSource={},v.forEach(F=>{this.proxyToSource[F.key]={}}),this.terrainTileForTile={};const E=this._style._mergedSourceCaches;for(const F in E){const N=E[F];if(!N.used||(N!==this.sourceCache&&this.resetTileLookupCache(N.id),this._setupProxiedCoordsForOrtho(N,s[F],x),N.usedForTerrain))continue;const z=s[F];N.getSource().reparseOverscaled&&this._assignTerrainTiles(z)}this.proxiedCoords[c.id]=v.map(F=>new sf(F,F.key,this.orthoMatrix)),this._assignTerrainTiles(v),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(x),this.renderingToTexture=!1;const R={};this._visibleDemTiles=[];for(const F of this.proxyCoords){const N=this.terrainTileForTile[F.key];if(!N)continue;const z=N.tileID.key;z in R||(this._visibleDemTiles.push(N),R[z]=z)}}_assignTerrainTiles(s){this._initializing||s.forEach(c=>{if(this.terrainTileForTile[c.key])return;const _=this._findTileCoveringTileID(c,this.sourceCache);_&&(this.terrainTileForTile[c.key]=_)})}_prepareDEMTextures(){const s=this.painter.context,c=s.gl;for(const _ in this.terrainTileForTile){const v=this.terrainTileForTile[_],x=v.dem;!x||v.demTexture&&!v.needsDEMTextureUpload||(s.activeTexture.set(c.TEXTURE1),Lo(this.painter,v,x))}}_prepareDemTileUniforms(s,c,_,v){if(!c||null==c.demTexture)return!1;const x=s.tileID.canonical,E=Math.pow(2,c.tileID.canonical.z-x.z),R=v||"";return _[`u_dem_tl${R}`]=[x.x*E%1,x.y*E%1],_[`u_dem_scale${R}`]=E,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let s=0;const c=this._visibleDemTiles.reduce((_,v)=>{if(!v.dem)return _;const x=v.dem.tree.minimums[0];return x>0&&s++,_+x},0);return s?c/s:0}_updateEmptyDEMTexture(){const s=this.painter.context,c=s.gl;s.activeTexture.set(c.TEXTURE2);const _=this._getLoadedAreaMinimum(),v=new h.cL({width:1,height:1},new Float32Array([_]));this._emptyDEMTextureDirty=!1;let x=this._emptyDEMTexture;return x?x.update(v,{premultiply:!1}):x=this._emptyDEMTexture=new h.T(s,v,c.R32F,{premultiply:!1}),x}setupElevationDraw(s,c,_){const v=this.painter.context,x=v.gl,E={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};E.u_exaggeration=this.exaggeration();let R=null,F=null,N=1;if(_&&_.morphing&&this._useVertexMorphing){const W=_.morphing.srcDemTile,ne=_.morphing.dstDemTile;N=_.morphing.phase,W&&ne&&(this._prepareDemTileUniforms(s,W,E,"_prev")&&(F=W),this._prepareDemTileUniforms(s,ne,E)&&(R=ne))}const z=W=>W&&W.demTexture&&this.painter.linearFloatFilteringSupported()?x.LINEAR:x.NEAREST;let U=null;var j;if(this.enabled?F&&R?(U=R.demTexture,v.activeTexture.set(x.TEXTURE4),F.demTexture.bind(z(F),x.CLAMP_TO_EDGE),E.u_dem_lerp=N):(R=this.terrainTileForTile[s.tileID.key],U=this._prepareDemTileUniforms(s,R,E)?R.demTexture:this.emptyDEMTexture):U=this.emptyDEMTexture,v.activeTexture.set(x.TEXTURE2),U&&(E.u_dem_size=1===(j=U).size[0]?1:j.size[0]-2,U.bind(z(R),x.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(_&&_.useDepthForOcclusion,c,E),_&&_.useMeterToDem&&R){const W=(1<<R.tileID.canonical.z)*h.bH(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;E.u_meter_to_dem=W}if(_&&_.labelPlaneMatrixInv&&(E.u_label_plane_matrix_inv=_.labelPlaneMatrixInv),c.setTerrainUniformValues(v,E),"globe"===this.painter.transform.projection.name){const W=this.globeUniformValues(this.painter.transform,s.tileID.canonical,_&&_.useDenormalizedUpVectorScale);c.setGlobeUniformValues(v,W)}}globeUniformValues(s,c,_){const v=s.projection;return{u_tile_tl_up:v.upVector(c,0,0),u_tile_tr_up:v.upVector(c,h.ai,0),u_tile_br_up:v.upVector(c,h.ai,h.ai),u_tile_bl_up:v.upVector(c,0,h.ai),u_tile_up_scale:_?h.cM(1):v.upVectorScale(c,s.center.lat,s.worldSize).metersToTile}}renderToBackBuffer(s){const c=this.painter,_=this.painter.context;0!==s.length&&(_.bindFramebuffer.set(null),_.viewport.set([0,0,c.width,c.height]),c.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(v,x,E,R,F){if("globe"===v.transform.projection.name)!function(N,z,U,j,W){const ne=N.context,J=ne.gl;let oe,se;const fe=N.transform,be=h.cD(N,ne,fe),ve=(ot,lt)=>{if(se===lt)return;const Ct=[qh[lt],"PROJECTION_GLOBE_VIEW"];be&&Ct.push("CUSTOM_ANTIALIASING");const He=N.isTileAffectedByFog(ot);oe=N.getOrCreateProgram("globeRaster",{defines:Ct,overrideFog:He}),se=lt},we=N.colorModeForRenderPass(),Ee=new cn(J.LEQUAL,cn.ReadWrite,N.depthRangeFor3D);hs.update(W);const De=h.cE(fe),Me=[h.av(fe.center.lng),h.aC(fe.center.lat)],ke=N.globeSharedBuffers,Oe=[fe.width*h.q.devicePixelRatio,fe.height*h.q.devicePixelRatio],et=Float32Array.from(fe.globeMatrix),qe={useDenormalizedUpVectorScale:!0};{const ot=N.transform,lt=fa(ot.zoom,z.exaggeration(),z.sourceCache._source.tileSize);se=-1;const Ct=J.TRIANGLES;for(const He of j){const st=U.getTile(He),Be=Rn.disabled,at=z.prevTerrainTileForTile[He.key],rt=z.terrainTileForTile[He.key];ci(at,rt)&&hs.newMorphing(He.key,at,rt,W,250),ne.activeTexture.set(J.TEXTURE0),st.texture&&st.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE);const $e=hs.getMorphValuesForProxy(He.key),Je=$e?1:0;$e&&h.L(qe,{morphing:{srcDemTile:$e.from,dstDemTile:$e.to,phase:h.cC($e.phase)}});const dt=h.cF(He.canonical),Ft=h.cG(dt.getCenter().lat),zt=h.cH(He.canonical,dt,Ft,ot.worldSize/ot._pixelsPerMercatorPixel),Bt=h.bc(h.cI(He.canonical)),en=pl(ot.expandedFarZProjMatrix,et,De,Bt,h.ag(ot.zoom),Me,ot.frustumCorners.TL,ot.frustumCorners.TR,ot.frustumCorners.BR,ot.frustumCorners.BL,ot.globeCenterInViewSpace,ot.globeRadius,Oe,lt,ot._farZ,zt);if(ve(He,Je),oe&&(z.setupElevationDraw(st,oe,qe),N.uploadCommonUniforms(ne,oe,He.toUnwrapped()),ke)){const[In,wt,Tn]=ke.getGridBuffers(Ft,0!==lt);oe.draw(N,Ct,Ee,Be,we,Mn.backCCW,en,"globe_raster",In,wt,Tn)}}}if(ke&&(N.renderDefaultNorthPole||N.renderDefaultSouthPole)){const ot=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];be&&ot.push("CUSTOM_ANTIALIASING"),oe=N.getOrCreateProgram("globeRaster",{defines:ot});for(const lt of j){const{x:Ct,y:He,z:st}=lt.canonical,Be=0===He,at=He===(1<<st)-1,[rt,$e,Je,dt]=ke.getPoleBuffers(st,!1);if(dt&&(Be||at)){const Ft=U.getTile(lt);ne.activeTexture.set(J.TEXTURE0),Ft.texture&&Ft.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE);let zt=h.cJ(st,Ct,fe);const Bt=h.bc(h.cI(lt.canonical)),en=(In,wt)=>In.draw(N,J.TRIANGLES,Ee,Rn.disabled,we,Mn.disabled,pl(fe.expandedFarZProjMatrix,zt,zt,Bt,0,Me,fe.frustumCorners.TL,fe.frustumCorners.TR,fe.frustumCorners.BR,fe.frustumCorners.BL,fe.globeCenterInViewSpace,fe.globeRadius,Oe,0,fe._farZ),"globe_pole_raster",wt,Je,dt);z.setupElevationDraw(Ft,oe,qe),N.uploadCommonUniforms(ne,oe,lt.toUnwrapped()),Be&&N.renderDefaultNorthPole&&en(oe,rt),at&&N.renderDefaultSouthPole&&(zt=h.ad.mat4.scale(h.ad.mat4.create(),zt,[1,-1,1]),en(oe,$e))}}}}(v,x,E,R,F);else{const N=v.context,z=N.gl;let U,j;const W=v.shadowRenderer,ne=Qc(v,v.longestCutoffRange),J=we=>{if(j===we)return;const Ee=[];Ee.push(qh[we]),ne.shouldRenderCutoff&&Ee.push("RENDER_CUTOFF"),W&&(Ee.push("RENDER_SHADOWS","DEPTH_TEXTURE"),W.useNormalOffset&&Ee.push("NORMAL_OFFSET")),U=v.getOrCreateProgram("terrainRaster",{defines:Ee}),j=we},oe=v.colorModeForRenderPass(),se=new cn(z.LEQUAL,cn.ReadWrite,v.depthRangeFor3D);hs.update(F);const fe=v.transform,be=fa(fe.zoom,x.exaggeration(),x.sourceCache._source.tileSize);let ve=[0,0,0];if(W){const we=v.style.directionalLight,Ee=v.style.ambientLight;we&&Ee&&(ve=Bu(v.style,we,Ee))}{j=-1;const we=z.TRIANGLES,[Ee,De]=[x.gridIndexBuffer,x.gridSegments];for(const Me of R){const ke=E.getTile(Me),Oe=Rn.disabled,et=x.prevTerrainTileForTile[Me.key],qe=x.terrainTileForTile[Me.key];ci(et,qe)&&hs.newMorphing(Me.key,et,qe,F,250),N.activeTexture.set(z.TEXTURE0),ke.texture&&ke.texture.bind(z.LINEAR,z.CLAMP_TO_EDGE);const ot=hs.getMorphValuesForProxy(Me.key),lt=ot?1:0;let Ct;ot&&(Ct={morphing:{srcDemTile:ot.from,dstDemTile:ot.to,phase:h.cC(ot.phase)}});const He=mo(Me.projMatrix,Zr(Me.canonical,fe.renderWorldCopies)?be/10:be,ve);if(J(lt),!U)continue;x.setupElevationDraw(ke,U,Ct);const st=Me.toUnwrapped();W&&W.setupShadows(st,U),v.uploadCommonUniforms(N,U,st,null,ne),U.draw(v,we,se,Oe,oe,Mn.backCCW,He,"terrain_raster",x.gridBuffer,Ee,De)}}}}(c,this,this.proxySourceCache,s,this._updateTimestamp),this.renderingToTexture=!0,c.gpuTimingDeferredRenderEnd(),s.splice(0,s.length))}renderBatch(s){if(0===this._drapedRenderBatches.length)return s+1;this.renderingToTexture=!0;const c=this.painter,_=this.painter.context,v=this.proxySourceCache,x=this.proxiedCoords[v.id],E=this._drapedRenderBatches.shift(),R=c.style.order,F=[];let N=0;for(const z of x){const U=v.getTileByID(z.proxyTileKey),j=v.proxyCachedFBO[z.key]?v.proxyCachedFBO[z.key][s]:void 0,W=void 0!==j?v.renderCache[j]:this.pool[N++],ne=void 0!==j;if(U.texture=W.tex,ne&&!W.dirty){F.push(U.tileID);continue}let J;_.bindFramebuffer.set(W.fb.framebuffer),this.renderedToTile=!1,W.dirty&&(_.clear({color:h.al.transparent,stencil:0}),W.dirty=!1);for(let oe=E.start;oe<=E.end;++oe){const se=c.style._mergedLayers[R[oe]];if(se.isHidden(c.transform.zoom))continue;const fe=c.style.getLayerSourceCache(se),be=fe?this.proxyToSource[z.key][fe.id]:[z];if(!be)continue;const ve=be;_.viewport.set([0,0,W.fb.width,W.fb.height]),J!==(fe?fe.id:null)&&(this._setupStencil(W,be,se,fe),J=fe?fe.id:null),c.renderLayer(c,fe,se,ve)}if(0===this._drapedRenderBatches.length)for(const oe of this._pendingGroundEffectLayers){const se=c.style._mergedLayers[R[oe]];if(se.isHidden(c.transform.zoom))continue;const fe=c.style.getLayerSourceCache(se),be=fe?this.proxyToSource[z.key][fe.id]:[z];if(!be)continue;const ve=be;_.viewport.set([0,0,W.fb.width,W.fb.height]),J!==(fe?fe.id:null)&&(this._setupStencil(W,be,se,fe),J=fe?fe.id:null),c.renderLayer(c,fe,se,ve)}this.renderedToTile?(W.dirty=!0,F.push(U.tileID)):ne||--N,5===N&&(N=0,this.renderToBackBuffer(F))}return this.renderToBackBuffer(F),this.renderingToTexture=!1,_.bindFramebuffer.set(null),_.viewport.set([0,0,c.width,c.height]),E.end+1}postRender(){}isLayerOrderingCorrect(s){const c=s.order.length;let _=-1,v=c;for(let x=0;x<c;++x)this._style.isLayerDraped(s._mergedLayers[s.order[x]])?_=Math.max(_,x):v=Math.min(v,x);return v>_}getMinElevationBelowMSL(){let s=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{s=Math.min(s,c.dem.tree.minimums[0])}),0===s?s:(s-30)*this._exaggeration}raycast(s,c,_){if(!this._visibleDemTiles)return null;const v=this._visibleDemTiles.filter(x=>x.dem).map(x=>{const E=x.tileID,R=1<<E.overscaledZ,{x:F,y:N}=E.canonical,z=F/R,U=(F+1)/R,j=N/R,W=(N+1)/R;return{minx:z,miny:j,maxx:U,maxy:W,t:x.dem.tree.raycastRoot(z,j,U,W,s,c,_),tile:x}});v.sort((x,E)=>(null!==x.t?x.t:Number.MAX_VALUE)-(null!==E.t?E.t:Number.MAX_VALUE));for(const x of v){if(null==x.t)return null;const E=x.tile.dem.tree.raycast(x.minx,x.miny,x.maxx,x.maxy,s,c,_);if(null!=E)return E}return null}_createFBO(){const s=this.painter.context,c=s.gl,_=this.drapeBufferSize;s.activeTexture.set(c.TEXTURE0);const v=new h.T(s,{width:_[0],height:_[1],data:null},c.RGBA8);v.bind(c.LINEAR,c.CLAMP_TO_EDGE);const x=s.createFramebuffer(_[0],_[1],!0,null);return x.colorAttachment.set(v.texture),x.depthAttachment=new Ar(s,x.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=s.createRenderbuffer(s.gl.DEPTH_STENCIL,_[0],_[1]),this._stencilRef=0,x.depthAttachment.set(this._sharedDepthStencil),s.clear({stencil:0})):x.depthAttachment.set(this._sharedDepthStencil),s.extTextureFilterAnisotropic&&c.texParameterf(c.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax),{fb:x,tex:v,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const s in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[s].hasTransition())return!0;return this._style.order.some(s=>{const c=this._style._mergedLayers[s],_=c.isHidden(this.painter.transform.zoom);return"hillshade"===c.type||"custom"===c.type?!_&&c.shouldRedrape():!_&&c.hasTransition()})}_clearLineLayersFromRenderCache(){let s=!1;for(const _ of this._style.getSources())if(_ instanceof la){s=!0;break}if(!s)return;const c={};for(let _=0;_<this._style.order.length;++_){const v=this._style._mergedLayers[this._style.order[_]],x=this._style.getLayerSourceCache(v);if(x&&!c[x.id]&&!v.isHidden(this.painter.transform.zoom)&&"line"===v.type&&v.widthExpression()instanceof h.ab){c[x.id]=!0;for(const E of this.proxyCoords){const R=this.proxyToSource[E.key][x.id];if(R)for(const F of R)this._clearRenderCacheForTile(x.id,F)}}}}_clearRasterLayersFromRenderCache(){let s=!1;for(const _ in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[_]._source instanceof Es){s=!0;break}if(!s)return;const c={};for(let _=0;_<this._style.order.length;++_){const v=this._style._mergedLayers[this._style.order[_]],x=this._style.getLayerSourceCache(v);if(!x||c[x.id]||v.isHidden(this.painter.transform.zoom)||"raster"!==v.type)continue;const E=v.paint.get("raster-fade-duration");for(const R of this.proxyCoords){const F=this.proxyToSource[R.key][x.id];if(F)for(const N of F){const z=od(x.getTile(N),x.findLoadedParent(N,0),x,this.painter.transform,E);(1!==z.opacity||0!==z.mix)&&this._clearRenderCacheForTile(x.id,N)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const s=this._style.order,c=s.length;if(0===c)return;const _=[];this._pendingGroundEffectLayers=[];let v,x=0,E=this._style._mergedLayers[s[x]];for(;!this._style.isLayerDraped(E)&&E.isHidden(this.painter.transform.zoom)&&++x<c;)E=this._style._mergedLayers[s[x]];for(;x<c;++x){const R=this._style._mergedLayers[s[x]];R.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(R)?void 0===v&&(v=x):("fill-extrusion"===R.type&&this._pendingGroundEffectLayers.push(x),void 0!==v&&(_.push({start:v,end:x-1}),v=void 0)))}if(void 0!==v&&_.push({start:v,end:x-1}),0!==_.length){const R=_[_.length-1];this._pendingGroundEffectLayers.every(F=>F>R.end)||h.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=_}_setupRenderCache(s){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const E=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let R=0;R<E.length;++R){const F=Object.values(E[R]);c.renderCachePool.push(...F)}}return}this._clearRasterLayersFromRenderCache();const _=this.proxyCoords,v=this._tilesDirty;for(let E=_.length-1;E>=0;E--){const R=_[E];if(c.getTileByID(R.key),void 0!==c.proxyCachedFBO[R.key]){const F=s[R.key],N=this.proxyToSource[R.key];let z=0;for(const U in N){const j=N[U],W=F[U];if(!W||W.length!==j.length||j.some((ne,J)=>ne!==W[J]||v[U]&&v[U].hasOwnProperty(ne.key))){z=-1;break}++z}for(const U in c.proxyCachedFBO[R.key])c.renderCache[c.proxyCachedFBO[R.key][U]].dirty=z<0||z!==Object.values(F).length}}const x=[...this._drapedRenderBatches];x.sort((E,R)=>R.end-R.start-(E.end-E.start));for(const E of x)for(const R of _){if(c.proxyCachedFBO[R.key])continue;let F=c.renderCachePool.pop();void 0===F&&c.renderCache.length<50&&(F=c.renderCache.length,c.renderCache.push(this._createFBO())),void 0!==F&&(c.proxyCachedFBO[R.key]={},c.proxyCachedFBO[R.key][E.start]=F,c.renderCache[F].dirty=!0)}this._tilesDirty={}}_setupStencil(s,c,_,v){if(!v||!this._sourceTilesOverlap[v.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const x=this.painter.context,E=x.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let R;if(_.isTileClipped())R=c.length,this._overlapStencilMode.test={func:E.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);R=1,this._overlapStencilMode.test={func:E.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+R>255&&(x.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=R,this._overlapStencilMode.ref=this._stencilRef,_.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(s){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[s.key]),this._overlapStencilMode):Rn.disabled}_renderTileClippingMasks(s,c){const _=this.painter,v=this.painter.context,x=v.gl;_._tileClippingMaskIDs={},v.setColorMode(ei.disabled),v.setDepthMode(cn.disabled);const E=_.getOrCreateProgram("clippingMask");for(const R of s){const F=_._tileClippingMaskIDs[R.key]=--c;E.draw(_,x.TRIANGLES,cn.disabled,new Rn({func:x.ALWAYS,mask:0},F,255,x.KEEP,x.KEEP,x.REPLACE),ei.disabled,Mn.disabled,fl(R.projMatrix),"$clipping",_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}}pointCoordinate(s){const c=this.painter.transform;if(s.x<0||s.x>c.width||s.y<0||s.y>c.height)return null;const _=[s.x,s.y,1,1];h.ad.vec4.transformMat4(_,_,c.pixelMatrixInverse),h.ad.vec4.scale(_,_,1/_[3]),_[0]/=c.worldSize,_[1]/=c.worldSize;const v=c._camera.position,x=h.bH(1,c.center.lat),E=[v[0],v[1],v[2]/x,0],R=h.ad.vec3.subtract([],_.slice(0,3),E);h.ad.vec3.normalize(R,R);const F=this.raycast(E,R,this._exaggeration);return null!==F&&F?(h.ad.vec3.scaleAndAdd(E,E,R,F),E[3]=E[2],E[2]*=x,E):null}_setupProxiedCoordsForOrtho(s,c,_){if(s.getSource()instanceof h.aK)return this._setupProxiedCoordsForImageSource(s,c,_);this._findCoveringTileCache[s.id]=this._findCoveringTileCache[s.id]||{};const v=this.proxiedCoords[s.id]=[],x=this.proxyCoords;for(let F=0;F<x.length;F++){const N=x[F],z=this._findTileCoveringTileID(N,s);if(z){const U=this._createProxiedId(N,z,_[N.key]&&_[N.key][s.id]);v.push(U),this.proxyToSource[N.key][s.id]=[U]}}let E=!1;const R=new Set;for(let F=0;F<c.length;F++){const N=s.getTile(c[F]);if(!N||!N.hasData())continue;const z=this._findTileCoveringTileID(N.tileID,this.proxySourceCache);if(z&&z.tileID.canonical.z!==N.tileID.canonical.z){const U=this.proxyToSource[z.tileID.key][s.id],j=this._createProxiedId(z.tileID,N,_[z.tileID.key]&&_[z.tileID.key][s.id]);U?U.splice(U.length-1,0,j):this.proxyToSource[z.tileID.key][s.id]=[j];const W=this.proxyToSource[z.tileID.key][s.id];R.has(W)||R.add(W),v.push(j),E=!0}}if(this._sourceTilesOverlap[s.id]=E,E&&this._debugParams.sortTilesHiZFirst)for(const F of R)F.sort((N,z)=>z.overscaledZ-N.overscaledZ)}_setupProxiedCoordsForImageSource(s,c,_){if(!s.getSource().loaded())return;const v=this.proxiedCoords[s.id]=[],x=this.proxyCoords,E=s.getSource(),R=E.tileID;if(!R)return;const F=new h.P(R.x,R.y)._div(1<<R.z),N=E.coordinates.map(h.ac.fromLngLat).reduce((U,j)=>(U.min.x=Math.min(U.min.x,j.x-F.x),U.min.y=Math.min(U.min.y,j.y-F.y),U.max.x=Math.max(U.max.x,j.x-F.x),U.max.y=Math.max(U.max.y,j.y-F.y),U),{min:new h.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new h.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),z=(U,j)=>{const W=U.wrap+U.canonical.x/(1<<U.canonical.z),ne=U.canonical.y/(1<<U.canonical.z),J=h.ai/(1<<U.canonical.z),oe=j.wrap+j.canonical.x/(1<<j.canonical.z),se=j.canonical.y/(1<<j.canonical.z);return W+J<oe+N.min.x||W>oe+N.max.x||ne+J<se+N.min.y||ne>se+N.max.y};for(let U=0;U<x.length;U++){const j=x[U];for(let W=0;W<c.length;W++){const ne=s.getTile(c[W]);if(!ne||!ne.hasData()||z(j,ne.tileID))continue;const J=this._createProxiedId(j,ne,_[j.key]&&_[j.key][s.id]),oe=this.proxyToSource[j.key][s.id];oe?oe.push(J):this.proxyToSource[j.key][s.id]=[J],v.push(J)}}}_createProxiedId(s,c,_){let v=this.orthoMatrix;if(_){const x=_.find(E=>E.key===c.tileID.key);if(x)return x}if(c.tileID.key!==s.key){const x=s.canonical.z-c.tileID.canonical.z;let E,R,F;v=h.ad.mat4.create();const N=c.tileID.wrap-s.wrap<<s.overscaledZ;x>0?(E=h.ai>>x,R=E*((c.tileID.canonical.x<<x)-s.canonical.x+N),F=E*((c.tileID.canonical.y<<x)-s.canonical.y)):(E=h.ai<<-x,R=h.ai*(c.tileID.canonical.x-(s.canonical.x+N<<-x)),F=h.ai*(c.tileID.canonical.y-(s.canonical.y<<-x))),h.ad.mat4.ortho(v,0,E,0,E,0,1),h.ad.mat4.translate(v,v,[R,F,0])}return new sf(c.tileID,s.key,v)}_findTileCoveringTileID(s,c){let _=c.getTile(s);if(_&&_.hasData())return _;const v=this._findCoveringTileCache[c.id],x=v[s.key];if(_=x?c.getTileByID(x):null,_&&_.hasData()||null===x)return _;let E=_?_.tileID:s,R=E.overscaledZ;const F=c.getSource().minzoom,N=[];if(!x){const U=c.getSource().maxzoom;if(s.canonical.z>=U){const j=s.canonical.z-U;c.getSource().reparseOverscaled?(R=Math.max(s.canonical.z+2,c.transform.tileZoom),E=new h.aH(R,s.wrap,U,s.canonical.x>>j,s.canonical.y>>j)):0!==j&&(R=U,E=new h.aH(R,s.wrap,U,s.canonical.x>>j,s.canonical.y>>j))}E.key!==s.key&&(N.push(E.key),_=c.getTile(E))}const z=U=>{N.forEach(j=>{v[j]=U}),N.length=0};for(R-=1;R>=F&&(!_||!_.hasData());R--){_&&z(_.tileID.key);const U=E.calculateScaledKey(R);if(_=c.getTileByID(U),_&&_.hasData())break;const j=v[U];if(null===j)break;void 0===j?N.push(U):_=c.getTileByID(j)}return z(_?_.tileID.key:null),_&&_.hasData()?_:null}findDEMTileFor(s){return this.enabled?this._findTileCoveringTileID(s,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(s,c){let _=this._tilesDirty[s];_||(_=this._tilesDirty[s]={}),_[c.key]=!0}}function af(m,s,c){const _=function(R,F,N){const z=h.ad.vec3.dot(F,R),U=h.ad.vec3.dot(N,[.2126,.7152,.0722]),j=(ne,J,oe)=>(1-oe)*ne+oe*J,W=j(1-.3*Math.min(U,1),1,Math.min(z+1,1));return j(.92,1,Math.asin(h.ay(F[2],-1,1))/Math.PI+.5)*W}(m,[0,0,1],s),v=[0,0,0];h.ad.vec3.scale(v,c.slice(0,3),_);const x=[0,0,0];h.ad.vec3.scale(x,s.slice(0,3),m[2]);const E=[0,0,0];return h.ad.vec3.add(E,v,x),h.cg(E)}const Wl=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],za=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class Wu{static cacheKey(s,c,_,v){let x=`${c}${v?v.cacheKey:""}`;for(const E of _)s.usedDefines.includes(E)&&(x+=`/${E}`);return x}constructor(s,c,_,v,x,E){const R=s.gl;this.program=R.createProgram(),this.configuration=v,this.name=c,this.fixedDefines=[...E];const F=v?v.getBinderAttributes():[],N=(_.staticAttributes||[]).concat(F);let z=v?v.defines():[];z=z.concat(E.map(oe=>`#define ${oe}`));const U="#version 300 es\n";let j=U+z.concat("precision mediump float;",xc,Sm.fragmentSource).join("\n");for(const oe of _.fragmentIncludes)j+=`\n${id[oe]}`;j+=`\n${_.fragmentSource}`;let W=U+z.concat("precision highp float;",xc,Sm.vertexSource).join("\n");for(const oe of _.vertexIncludes)W+=`\n${id[oe]}`;this.forceManualRenderingForInstanceIDShaders=s.forceManualRenderingForInstanceIDShaders&&-1!==_.vertexSource.indexOf("gl_InstanceID"),this.forceManualRenderingForInstanceIDShaders&&(W+="\nuniform int u_instanceID;\n"),W+=`\n${_.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(W=W.replaceAll("gl_InstanceID","u_instanceID"));const ne=R.createShader(R.FRAGMENT_SHADER);if(R.isContextLost())return void(this.failedToCreate=!0);R.shaderSource(ne,j),R.compileShader(ne),R.attachShader(this.program,ne);const J=R.createShader(R.VERTEX_SHADER);if(R.isContextLost())this.failedToCreate=!0;else{R.shaderSource(J,W),R.compileShader(J),R.attachShader(this.program,J),this.attributes={},this.numAttributes=N.length;for(let oe=0;oe<this.numAttributes;oe++)if(N[oe]){const se=N[oe].startsWith("a_")?N[oe]:`a_${N[oe]}`;R.bindAttribLocation(this.program,oe,se),this.attributes[se]=oe}R.linkProgram(this.program),R.deleteShader(J),R.deleteShader(ne),this.fixedUniforms=x(s),this.binderUniforms=v?v.getUniforms(s):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms={u_instanceID:new h.bN(s)}),(E.includes("TERRAIN")||-1!==c.indexOf("symbol")||-1!==c.indexOf("circle"))&&(this.terrainUniforms={u_dem:new h.bN(oe=s),u_dem_prev:new h.bN(oe),u_dem_tl:new h.bK(oe),u_dem_scale:new h.bM(oe),u_dem_tl_prev:new h.bK(oe),u_dem_scale_prev:new h.bM(oe),u_dem_size:new h.bM(oe),u_dem_lerp:new h.bM(oe),u_exaggeration:new h.bM(oe),u_depth:new h.bN(oe),u_depth_size_inv:new h.bK(oe),u_depth_range_unpack:new h.bK(oe),u_occluder_half_size:new h.bM(oe),u_occlusion_depth_offset:new h.bM(oe),u_meter_to_dem:new h.bM(oe),u_label_plane_matrix_inv:new h.bJ(oe)}),E.includes("GLOBE")&&(this.globeUniforms=(oe=>({u_tile_tl_up:new h.bL(oe),u_tile_tr_up:new h.bL(oe),u_tile_br_up:new h.bL(oe),u_tile_bl_up:new h.bL(oe),u_tile_up_scale:new h.bM(oe)}))(s)),E.includes("FOG")&&(this.fogUniforms=(oe=>({u_fog_matrix:new h.bJ(oe),u_fog_range:new h.bK(oe),u_fog_color:new h.cb(oe),u_fog_horizon_blend:new h.bM(oe),u_fog_vertical_limit:new h.bK(oe),u_fog_temporal_offset:new h.bM(oe),u_frustum_tl:new h.bL(oe),u_frustum_tr:new h.bL(oe),u_frustum_br:new h.bL(oe),u_frustum_bl:new h.bL(oe),u_globe_pos:new h.bL(oe),u_globe_radius:new h.bM(oe),u_globe_transition:new h.bM(oe),u_is_globe:new h.bN(oe),u_viewport:new h.bK(oe)}))(s)),E.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(oe=>({u_cutoff_params:new h.cb(oe)}))(s)),E.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(oe=>({u_lighting_ambient_color:new h.bL(oe),u_lighting_directional_dir:new h.bL(oe),u_lighting_directional_color:new h.bL(oe),u_ground_radiance:new h.bL(oe)}))(s)),E.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(oe=>({u_light_matrix_0:new h.bJ(oe),u_light_matrix_1:new h.bJ(oe),u_fade_range:new h.bK(oe),u_shadow_normal_offset:new h.bL(oe),u_shadow_intensity:new h.bM(oe),u_shadow_texel_size:new h.bM(oe),u_shadow_map_resolution:new h.bM(oe),u_shadow_direction:new h.bL(oe),u_shadow_bias:new h.bL(oe),u_shadowmap_0:new h.bN(oe),u_shadowmap_1:new h.bN(oe)}))(s))}var oe}setTerrainUniformValues(s,c){if(!this.terrainUniforms)return;const _=this.terrainUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const v in c)_[v]&&_[v].set(this.program,v,c[v])}}setGlobeUniformValues(s,c){if(!this.globeUniforms)return;const _=this.globeUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const v in c)_[v]&&_[v].set(this.program,v,c[v])}}setFogUniformValues(s,c){if(!this.fogUniforms)return;const _=this.fogUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const v in c)_[v].set(this.program,v,c[v])}}setCutoffUniformValues(s,c){if(!this.cutoffUniforms)return;const _=this.cutoffUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const v in c)_[v].set(this.program,v,c[v])}}setLightsUniformValues(s,c){if(!this.lightsUniforms)return;const _=this.lightsUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const v in c)_[v].set(this.program,v,c[v])}}setShadowUniformValues(s,c){if(this.failedToCreate||!this.shadowUniforms)return;const _=this.shadowUniforms;s.program.set(this.program);for(const v in c)_[v].set(this.program,v,c[v])}_drawDebugWireframe(s,c,_,v,x,E,R,F,N,z){const U=s.options.wireframe;if(!1===U.terrain&&!1===U.layers2D&&!1===U.layers3D)return;const j=s.context;if(!(U.terrain&&("terrainRaster"===this.name||"globeRaster"===this.name)||!(!U.layers2D||s._terrain&&s._terrain.renderingToTexture)&&Wl.includes(this.name)||U.layers3D&&za.includes(this.name)))return;const W=j.gl,ne=s.wireframeDebugCache.getLinesFromTrianglesBuffer(s.frameCounter,x,j);if(!ne)return;const J=[...this.fixedDefines];J.push("DEBUG_WIREFRAME");const oe=s.getOrCreateProgram(this.name,{config:this.configuration,defines:J});j.program.set(oe.program);const se=(ve,we,Ee)=>{if(we[ve]&&Ee[ve])for(const De in we[ve])Ee[ve][De]&&Ee[ve][De].set(Ee.program,De,we[ve][De].current)};N&&N.setUniforms(oe.program,j,oe.binderUniforms,R,{zoom:F}),se("fixedUniforms",this,oe),se("terrainUniforms",this,oe),se("globeUniforms",this,oe),se("fogUniforms",this,oe),se("lightsUniforms",this,oe),se("shadowUniforms",this,oe),ne.bind(),j.setColorMode(new ei([W.ONE,W.ONE_MINUS_SRC_ALPHA,W.ZERO,W.ONE],h.al.transparent,[!0,!0,!0,!1])),j.setDepthMode(new cn(c.func===W.LESS?W.LEQUAL:c.func,cn.ReadOnly,c.range)),j.setStencilMode(Rn.disabled);const fe=3*E.primitiveLength*2,be=3*E.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const ve=z||1;for(let we=0;we<ve;++we)oe.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",we),W.drawElements(W.LINES,fe,W.UNSIGNED_SHORT,be)}else z&&z>1?W.drawElementsInstanced(W.LINES,fe,W.UNSIGNED_SHORT,be,z):W.drawElements(W.LINES,fe,W.UNSIGNED_SHORT,be);x.bind(),j.program.set(this.program),j.setDepthMode(c),j.setStencilMode(_),j.setColorMode(v)}checkUniforms(s,c,_){if(this.fixedDefines.includes(c))for(const v of Object.keys(_))if(!_[v].initialized)throw new Error(`Program '${this.name}', from draw '${s}': uniform ${v} not set but required by ${c} being defined`)}draw(s,c,_,v,x,E,R,F,N,z,U,j,W,ne,J,oe){const se=s.context,fe=se.gl;if(this.failedToCreate)return;se.program.set(this.program),se.setDepthMode(_),se.setStencilMode(v),se.setColorMode(x),se.setCullFace(E);for(const we of Object.keys(this.fixedUniforms))this.fixedUniforms[we].set(this.program,we,R[we]);ne&&ne.setUniforms(this.program,se,this.binderUniforms,j,{zoom:W});const be={[fe.POINTS]:1,[fe.LINES]:2,[fe.TRIANGLES]:3,[fe.LINE_STRIP]:1}[c];this.checkUniforms(F,"RENDER_SHADOWS",this.shadowUniforms);const ve=oe&&oe>0?1:void 0;for(const we of U.get()){const Ee=we.vaos||(we.vaos={});if((Ee[F]||(Ee[F]=new n_)).bind(se,this,N,ne?ne.getPaintVertexBuffers():[],z,we.vertexOffset,J||[],ve),this.forceManualRenderingForInstanceIDShaders){const De=oe||1;for(let Me=0;Me<De;++Me)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Me),z?fe.drawElements(c,we.primitiveLength*be,fe.UNSIGNED_SHORT,we.primitiveOffset*be*2):fe.drawArrays(c,we.vertexOffset,we.vertexLength)}else oe&&oe>1?fe.drawElementsInstanced(c,we.primitiveLength*be,fe.UNSIGNED_SHORT,we.primitiveOffset*be*2,oe):z?fe.drawElements(c,we.primitiveLength*be,fe.UNSIGNED_SHORT,we.primitiveOffset*be*2):fe.drawArrays(c,we.vertexOffset,we.vertexLength);c===fe.TRIANGLES&&z&&this._drawDebugWireframe(s,_,v,x,z,we,j,W,ne,oe)}}}function Pn(m,s){const c=Math.pow(2,s.tileID.overscaledZ),_=s.tileSize*Math.pow(2,m.transform.tileZoom)/c,v=_*(s.tileID.canonical.x+s.tileID.wrap*c),x=_*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture?s.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/h.at(s,1,m.transform.tileZoom),u_pixel_coord_upper:[v>>16,x>>16],u_pixel_coord_lower:[65535&v,65535&x]}}const Wh={terrain:0,flat:1},Ba=h.ad.mat4.create(),Va=(m,s,c,_,v,x,E,R,F,N,z,U,j,W,ne,J,oe,se)=>{const fe=s.style.light,be=fe.properties.get("position"),ve=[be.x,be.y,be.z],we=h.ad.mat3.create();"viewport"===fe.properties.get("anchor")&&(h.ad.mat3.fromRotation(we,-s.transform.angle),h.ad.vec3.transformMat3(ve,ve,we));const Ee=fe.properties.get("color"),De=s.transform,Me={u_matrix:m,u_lightpos:ve,u_lightintensity:fe.properties.get("intensity"),u_lightcolor:[Ee.r,Ee.g,Ee.b],u_vertical_gradient:+c,u_opacity:_,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ba,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Wh[N],u_base_type:Wh[z],u_ao:v,u_edge_radius:x,u_width_scale:E,u_flood_light_color:ne,u_vertical_scale:J,u_flood_light_intensity:oe,u_ground_shadow_factor:se};return"globe"===De.projection.name&&(Me.u_tile_id=[R.canonical.x,R.canonical.y,1<<R.canonical.z],Me.u_zoom_transition=U,Me.u_inv_rot_matrix=W,Me.u_merc_center=j,Me.u_up_dir=De.projection.upVector(new h.bT(0,0,0),j[0]*h.ai,j[1]*h.ai),Me.u_height_lift=F),Me},ad=(m,s,c,_,v,x)=>({u_matrix:m,u_edge_radius:s,u_width_scale:c,u_vertical_scale:_,u_height_type:Wh[v],u_base_type:Wh[x]}),Qd=(m,s,c,_,v,x,E,R,F,N,z,U,j,W,ne,J,oe)=>{const se=Va(m,s,c,_,v,x,E,R,N,z,U,j,W,ne,J,oe,1,[0,0,0]),fe={u_height_factor:-Math.pow(2,R.overscaledZ)/F.tileSize/8};return h.l(se,Pn(s,F),fe)},zr=(m,s)=>({u_matrix:m,u_emissive_strength:s}),ao=(m,s,c,_)=>h.l(zr(m,s),Pn(c,_)),xo=(m,s,c)=>({u_matrix:m,u_world:c,u_emissive_strength:s}),Yh=(m,s,c,_,v)=>h.l(ao(m,s,c,_),{u_world:v}),Qs=(m,s,c,_,v)=>({u_matrix:m,u_camera_pos:[s[0],s[1],s[2]],u_depth_bias:c,u_height_scale:_,u_reset_depth:v}),lf=(m,s,c,_)=>{const v=h.ai/c.tileSize;return{u_matrix:m,u_camera_to_center_distance:s.getCameraToCenterDistance(_),u_extrude_scale:[s.pixelsToGLUnits[0]/v,s.pixelsToGLUnits[1]/v]}},ma=(m,s,c=1)=>({u_matrix:m,u_color:s.toRenderColor(null),u_overlay:0,u_overlay_scale:c}),ga=h.ad.mat4.create(),cf=(m,s,c,_,v,x,E)=>{const R=m.transform,F="globe"===R.projection.name,N=F?h.cO(R.zoom,s.canonical)*R._pixelsPerMercatorPixel:h.at(c,1,x),z={u_matrix:s.projMatrix,u_extrude_scale:N,u_intensity:E,u_inv_rot_matrix:ga,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(F){z.u_inv_rot_matrix=_,z.u_merc_center=v,z.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],z.u_zoom_transition=h.ag(R.zoom);const U=v[0]*h.ai,j=v[1]*h.ai;z.u_up_dir=R.projection.upVector(new h.bT(0,0,0),U,j)}return z};function Zt(m,[s,c,_,v],[x,E]){if(x===E)return[0,0,0,0];const R=255*(m-1)/(m*(E-x));return[s*R,c*R,_*R,v*R]}function Cc(m,s,[c,_]){return c===_?0:.5/m+(s-c)*(m-1)/(m*(_-c))}const Pm=(m,s,c,_,v,x,E,R,F,N,z,U,j,W,ne,J,oe,se,fe,be,ve)=>({u_matrix:m,u_normalize_matrix:s,u_globe_matrix:c,u_merc_matrix:_,u_grid_matrix:v,u_tl_parent:x,u_scale_parent:N,u_fade_t:z.mix,u_opacity:z.opacity*U.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:U.paint.get("raster-brightness-min"),u_brightness_high:U.paint.get("raster-brightness-max"),u_saturation_factor:h.cP(U.paint.get("raster-saturation")),u_contrast_factor:h.cQ(U.paint.get("raster-contrast")),u_spin_weights:Jd(U.paint.get("raster-hue-rotate")),u_perspective_transform:j,u_raster_elevation:W,u_zoom_transition:E,u_merc_center:R,u_cutoff_params:F,u_colorization_mix:Zt(h.cR,J,se),u_colorization_offset:Cc(h.cR,oe,se),u_color_ramp:ne,u_texture_offset:[be/(fe+2*be),fe/(fe+2*be)],u_texture_res:[fe+2*be,fe+2*be],u_emissive_strength:ve});function Jd(m){m*=Math.PI/180;const s=Math.sin(m),c=Math.cos(m);return[(2*c+1)/3,(-Math.sqrt(3)*s-c+1)/3,(Math.sqrt(3)*s-c+1)/3]}const Vs=.05,hn=(m,s,c,_,v,x,E,R,F,N,z,U)=>({u_matrix:m,u_normalize_matrix:s,u_globe_matrix:c,u_merc_matrix:_,u_grid_matrix:v,u_tl_parent:x,u_scale_parent:N,u_fade_t:z.mix,u_opacity:z.opacity,u_image0:0,u_image1:1,u_raster_elevation:U,u_zoom_transition:E,u_merc_center:R,u_cutoff_params:F}),Iv=(m,s,c,_,v,x,E,R,F,N)=>({u_particle_texture:m,u_particle_texture_side_len:s,u_tile_offset:c,u_velocity:_,u_color_ramp:x,u_velocity_res:v,u_max_speed:E,u_uv_offset:R,u_data_scale:[255*F[0],255*F[1]],u_data_offset:N,u_particle_pos_scale:1.1,u_particle_pos_offset:[Vs,Vs]}),CE=(m,s,c,_,v,x,E,R,F,N)=>({u_particle_texture:m,u_particle_texture_side_len:s,u_velocity:c,u_velocity_res:_,u_max_speed:v,u_speed_factor:x,u_reset_rate:E,u_rand_seed:Math.random(),u_uv_offset:R,u_data_scale:[255*F[0],255*F[1]],u_data_offset:N,u_particle_pos_scale:1.1,u_particle_pos_offset:[Vs,Vs]}),wx=h.ad.mat4.create(),c_=(m,s,c,_,v,x,E,R,F,N,z,U,j,W,ne,J,oe,se,fe,be,ve,we)=>{const Ee=v.transform,De={u_is_size_zoom_constant:+("constant"===m||"source"===m),u_is_size_feature_constant:+("constant"===m||"camera"===m),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:Ee.getCameraToCenterDistance(fe),u_rotate_symbol:+c,u_aspect_ratio:Ee.width/Ee.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:E,u_coord_matrix:R,u_is_text:+N,u_elevation_from_sea:F?1:0,u_pitch_with_map:+_,u_texsize:z,u_texsize_icon:U,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:wx,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:wx,u_up_vector:[0,-1,0],u_color_adj_mat:be,u_icon_transition:ve||0,u_gamma_scale:_?v.transform.getCameraToCenterDistance(fe)*Math.cos(v.terrain?0:v.transform._pitch):1,u_device_pixel_ratio:h.q.devicePixelRatio,u_is_halo:+j,u_scale_factor:we||1};return"globe"===fe.name&&(De.u_tile_id=[W.canonical.x,W.canonical.y,1<<W.canonical.z],De.u_zoom_transition=ne,De.u_inv_rot_matrix=oe,De.u_merc_center=J,De.u_camera_forward=Ee._camera.forward(),De.u_ecef_origin=h.cS(Ee.globeMatrix,W.toUnwrapped()),De.u_tile_matrix=Float32Array.from(Ee.globeMatrix),De.u_up_vector=se),De},Av=(m,s,c,_)=>({u_matrix:m,u_emissive_strength:s,u_opacity:c,u_color:_}),d_=(m,s,c,_,v,x,E,R,F)=>h.l(function(N,z,U,j,W,ne){const{width:J,height:oe}=j.imageManager.getPixelSize(z),se=Math.pow(2,ne.tileID.overscaledZ),fe=ne.tileSize*Math.pow(2,j.transform.tileZoom)/se,be=fe*(ne.tileID.canonical.x+ne.tileID.wrap*se),ve=fe*ne.tileID.canonical.y;return{u_image:0,u_pattern_tl:U.tl,u_pattern_br:U.br,u_texsize:[J,oe],u_pattern_size:U.displaySize,u_pattern_units_to_pixels:W?[j.transform.width,-1*j.transform.height]:[1/h.at(ne,1,j.transform.tileZoom),1/h.at(ne,1,j.transform.tileZoom)],u_pixel_coord_upper:[be>>16,ve>>16],u_pixel_coord_lower:[65535&be,65535&ve]}}(0,x,E,_,R,F),{u_matrix:m,u_emissive_strength:s,u_opacity:c}),u_=new Float32Array(h.ad.mat4.identity([])),kv=(m,s,c,_,v,x,E,R,F,N,z,U,j,W=[0,0,0],ne)=>{const J=v.style.light,oe=J.properties.get("position"),se=[-oe.x,-oe.y,oe.z],fe=h.ad.mat3.create();"viewport"===J.properties.get("anchor")&&(h.ad.mat3.fromRotation(fe,-v.transform.angle),h.ad.vec3.transformMat3(se,se,fe));const be="MASK"===z.alphaMode,ve=J.properties.get("color").toRenderColor(null),we=j.paint.get("model-ambient-occlusion-intensity"),Ee=j.paint.get("model-color").constantOr(h.al.white).toRenderColor(null),De=j.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:m,u_lighting_matrix:s,u_normal_matrix:c,u_node_matrix:_||u_,u_lightpos:se,u_lightintensity:J.properties.get("intensity"),u_lightcolor:[ve.r,ve.g,ve.b],u_camera_pos:W,u_opacity:x,u_baseTextureIsAlpha:0,u_alphaMask:+be,u_alphaCutoff:z.alphaCutoff,u_baseColorFactor:[E.r,E.g,E.b,E.a],u_emissiveFactor:[R[0],R[1],R[2],1],u_metallicFactor:F,u_roughnessFactor:N,u_baseColorTexture:Hr_BaseColor,u_metallicRoughnessTexture:Hr_MetallicRoughness,u_normalTexture:Hr_Normal,u_occlusionTexture:Hr_Occlusion,u_emissionTexture:Hr_Emission,u_lutTexture:Hr_LUT,u_color_mix:[Ee.r,Ee.g,Ee.b,De],u_aoIntensity:we,u_emissive_strength:U,u_occlusionTextureTransform:ne||[0,0,0,0]}},Cx=(m,s=u_,c=u_)=>({u_matrix:m,u_instance:s,u_node_matrix:c}),Rv={fillExtrusion:m=>({u_matrix:new h.bJ(m),u_lightpos:new h.bL(m),u_lightintensity:new h.bM(m),u_lightcolor:new h.bL(m),u_vertical_gradient:new h.bM(m),u_opacity:new h.bM(m),u_edge_radius:new h.bM(m),u_width_scale:new h.bM(m),u_ao:new h.bK(m),u_height_type:new h.bN(m),u_base_type:new h.bN(m),u_tile_id:new h.bL(m),u_zoom_transition:new h.bM(m),u_inv_rot_matrix:new h.bJ(m),u_merc_center:new h.bK(m),u_up_dir:new h.bL(m),u_height_lift:new h.bM(m),u_flood_light_color:new h.bL(m),u_vertical_scale:new h.bM(m),u_flood_light_intensity:new h.bM(m),u_ground_shadow_factor:new h.bL(m)}),fillExtrusionDepth:m=>({u_matrix:new h.bJ(m),u_edge_radius:new h.bM(m),u_width_scale:new h.bM(m),u_vertical_scale:new h.bM(m),u_height_type:new h.bN(m),u_base_type:new h.bN(m)}),fillExtrusionPattern:m=>({u_matrix:new h.bJ(m),u_lightpos:new h.bL(m),u_lightintensity:new h.bM(m),u_lightcolor:new h.bL(m),u_vertical_gradient:new h.bM(m),u_height_factor:new h.bM(m),u_edge_radius:new h.bM(m),u_width_scale:new h.bM(m),u_ao:new h.bK(m),u_height_type:new h.bN(m),u_base_type:new h.bN(m),u_tile_id:new h.bL(m),u_zoom_transition:new h.bM(m),u_inv_rot_matrix:new h.bJ(m),u_merc_center:new h.bK(m),u_up_dir:new h.bL(m),u_height_lift:new h.bM(m),u_image:new h.bN(m),u_texsize:new h.bK(m),u_pixel_coord_upper:new h.bK(m),u_pixel_coord_lower:new h.bK(m),u_tile_units_to_pixels:new h.bM(m),u_opacity:new h.bM(m)}),fillExtrusionGroundEffect:m=>({u_matrix:new h.bJ(m),u_opacity:new h.bM(m),u_ao_pass:new h.bM(m),u_meter_to_tile:new h.bM(m),u_ao:new h.bK(m),u_flood_light_intensity:new h.bM(m),u_flood_light_color:new h.bL(m),u_attenuation:new h.bM(m),u_edge_radius:new h.bM(m),u_fb:new h.bN(m),u_fb_size:new h.bM(m),u_dynamic_offset:new h.bM(m)}),fill:m=>({u_matrix:new h.bJ(m),u_emissive_strength:new h.bM(m)}),fillPattern:m=>({u_matrix:new h.bJ(m),u_emissive_strength:new h.bM(m),u_image:new h.bN(m),u_texsize:new h.bK(m),u_pixel_coord_upper:new h.bK(m),u_pixel_coord_lower:new h.bK(m),u_tile_units_to_pixels:new h.bM(m)}),fillOutline:m=>({u_matrix:new h.bJ(m),u_emissive_strength:new h.bM(m),u_world:new h.bK(m)}),fillOutlinePattern:m=>({u_matrix:new h.bJ(m),u_emissive_strength:new h.bM(m),u_world:new h.bK(m),u_image:new h.bN(m),u_texsize:new h.bK(m),u_pixel_coord_upper:new h.bK(m),u_pixel_coord_lower:new h.bK(m),u_tile_units_to_pixels:new h.bM(m)}),elevatedStructures:m=>({u_matrix:new h.bJ(m)}),elevatedStructuresDepthReconstruct:m=>({u_matrix:new h.bJ(m),u_camera_pos:new h.bL(m),u_depth_bias:new h.bM(m),u_height_scale:new h.bM(m),u_reset_depth:new h.bM(m)}),circle:h.cT,collisionBox:m=>({u_matrix:new h.bJ(m),u_camera_to_center_distance:new h.bM(m),u_extrude_scale:new h.bK(m)}),collisionCircle:m=>({u_matrix:new h.bJ(m),u_inv_matrix:new h.bJ(m),u_camera_to_center_distance:new h.bM(m),u_viewport_size:new h.bK(m)}),debug:m=>({u_color:new h.cA(m),u_matrix:new h.bJ(m),u_overlay:new h.bN(m),u_overlay_scale:new h.bM(m)}),clippingMask:m=>({u_matrix:new h.bJ(m)}),heatmap:m=>({u_extrude_scale:new h.bM(m),u_intensity:new h.bM(m),u_matrix:new h.bJ(m),u_inv_rot_matrix:new h.bJ(m),u_merc_center:new h.bK(m),u_tile_id:new h.bL(m),u_zoom_transition:new h.bM(m),u_up_dir:new h.bL(m)}),heatmapTexture:m=>({u_image:new h.bN(m),u_color_ramp:new h.bN(m),u_opacity:new h.bM(m)}),hillshade:m=>({u_matrix:new h.bJ(m),u_image:new h.bN(m),u_latrange:new h.bK(m),u_light:new h.bK(m),u_shadow:new h.cA(m),u_highlight:new h.cA(m),u_emissive_strength:new h.bM(m),u_accent:new h.cA(m)}),hillshadePrepare:m=>({u_matrix:new h.bJ(m),u_image:new h.bN(m),u_dimension:new h.bK(m),u_zoom:new h.bM(m)}),line:h.cU,linePattern:h.cV,raster:m=>({u_matrix:new h.bJ(m),u_normalize_matrix:new h.bJ(m),u_globe_matrix:new h.bJ(m),u_merc_matrix:new h.bJ(m),u_grid_matrix:new h.cB(m),u_tl_parent:new h.bK(m),u_scale_parent:new h.bM(m),u_fade_t:new h.bM(m),u_opacity:new h.bM(m),u_image0:new h.bN(m),u_image1:new h.bN(m),u_brightness_low:new h.bM(m),u_brightness_high:new h.bM(m),u_saturation_factor:new h.bM(m),u_contrast_factor:new h.bM(m),u_spin_weights:new h.bL(m),u_perspective_transform:new h.bK(m),u_raster_elevation:new h.bM(m),u_zoom_transition:new h.bM(m),u_merc_center:new h.bK(m),u_cutoff_params:new h.cb(m),u_colorization_mix:new h.cb(m),u_colorization_offset:new h.bM(m),u_color_ramp:new h.bN(m),u_texture_offset:new h.bK(m),u_texture_res:new h.bK(m),u_emissive_strength:new h.bM(m)}),rasterParticle:m=>({u_matrix:new h.bJ(m),u_normalize_matrix:new h.bJ(m),u_globe_matrix:new h.bJ(m),u_merc_matrix:new h.bJ(m),u_grid_matrix:new h.cB(m),u_tl_parent:new h.bK(m),u_scale_parent:new h.bM(m),u_fade_t:new h.bM(m),u_opacity:new h.bM(m),u_image0:new h.bN(m),u_image1:new h.bN(m),u_raster_elevation:new h.bM(m),u_zoom_transition:new h.bM(m),u_merc_center:new h.bK(m),u_cutoff_params:new h.cb(m)}),rasterParticleTexture:m=>({u_texture:new h.bN(m),u_opacity:new h.bM(m)}),rasterParticleDraw:m=>({u_particle_texture:new h.bN(m),u_particle_texture_side_len:new h.bM(m),u_tile_offset:new h.bK(m),u_velocity:new h.bN(m),u_color_ramp:new h.bN(m),u_velocity_res:new h.bK(m),u_max_speed:new h.bM(m),u_uv_offset:new h.bK(m),u_data_scale:new h.bK(m),u_data_offset:new h.bM(m),u_particle_pos_scale:new h.bM(m),u_particle_pos_offset:new h.bK(m)}),rasterParticleUpdate:m=>({u_particle_texture:new h.bN(m),u_particle_texture_side_len:new h.bM(m),u_velocity:new h.bN(m),u_velocity_res:new h.bK(m),u_max_speed:new h.bM(m),u_speed_factor:new h.bM(m),u_reset_rate:new h.bM(m),u_rand_seed:new h.bM(m),u_uv_offset:new h.bK(m),u_data_scale:new h.bK(m),u_data_offset:new h.bM(m),u_particle_pos_scale:new h.bM(m),u_particle_pos_offset:new h.bK(m)}),symbol:m=>({u_is_size_zoom_constant:new h.bN(m),u_is_size_feature_constant:new h.bN(m),u_size_t:new h.bM(m),u_size:new h.bM(m),u_camera_to_center_distance:new h.bM(m),u_rotate_symbol:new h.bN(m),u_aspect_ratio:new h.bM(m),u_fade_change:new h.bM(m),u_matrix:new h.bJ(m),u_label_plane_matrix:new h.bJ(m),u_coord_matrix:new h.bJ(m),u_is_text:new h.bN(m),u_elevation_from_sea:new h.bN(m),u_pitch_with_map:new h.bN(m),u_texsize:new h.bK(m),u_texsize_icon:new h.bK(m),u_texture:new h.bN(m),u_texture_icon:new h.bN(m),u_gamma_scale:new h.bM(m),u_device_pixel_ratio:new h.bM(m),u_tile_id:new h.bL(m),u_zoom_transition:new h.bM(m),u_inv_rot_matrix:new h.bJ(m),u_merc_center:new h.bK(m),u_camera_forward:new h.bL(m),u_tile_matrix:new h.bJ(m),u_up_vector:new h.bL(m),u_ecef_origin:new h.bL(m),u_is_halo:new h.bN(m),u_icon_transition:new h.bM(m),u_color_adj_mat:new h.bJ(m),u_scale_factor:new h.bM(m)}),background:m=>({u_matrix:new h.bJ(m),u_emissive_strength:new h.bM(m),u_opacity:new h.bM(m),u_color:new h.cA(m)}),backgroundPattern:m=>({u_matrix:new h.bJ(m),u_emissive_strength:new h.bM(m),u_opacity:new h.bM(m),u_image:new h.bN(m),u_pattern_tl:new h.bK(m),u_pattern_br:new h.bK(m),u_texsize:new h.bK(m),u_pattern_size:new h.bK(m),u_pixel_coord_upper:new h.bK(m),u_pixel_coord_lower:new h.bK(m),u_pattern_units_to_pixels:new h.bK(m)}),terrainRaster:m=>({u_matrix:new h.bJ(m),u_image0:new h.bN(m),u_skirt_height:new h.bM(m),u_ground_shadow_factor:new h.bL(m)}),skybox:m=>({u_matrix:new h.bJ(m),u_sun_direction:new h.bL(m),u_cubemap:new h.bN(m),u_opacity:new h.bM(m),u_temporal_offset:new h.bM(m)}),skyboxGradient:m=>({u_matrix:new h.bJ(m),u_color_ramp:new h.bN(m),u_center_direction:new h.bL(m),u_radius:new h.bM(m),u_opacity:new h.bM(m),u_temporal_offset:new h.bM(m)}),skyboxCapture:m=>({u_matrix_3f:new h.cB(m),u_sun_direction:new h.bL(m),u_sun_intensity:new h.bM(m),u_color_tint_r:new h.cb(m),u_color_tint_m:new h.cb(m),u_luminance:new h.bM(m)}),globeRaster:m=>({u_proj_matrix:new h.bJ(m),u_globe_matrix:new h.bJ(m),u_normalize_matrix:new h.bJ(m),u_merc_matrix:new h.bJ(m),u_zoom_transition:new h.bM(m),u_merc_center:new h.bK(m),u_image0:new h.bN(m),u_grid_matrix:new h.cB(m),u_skirt_height:new h.bM(m),u_far_z_cutoff:new h.bM(m),u_frustum_tl:new h.bL(m),u_frustum_tr:new h.bL(m),u_frustum_br:new h.bL(m),u_frustum_bl:new h.bL(m),u_globe_pos:new h.bL(m),u_globe_radius:new h.bM(m),u_viewport:new h.bK(m)}),globeAtmosphere:m=>({u_frustum_tl:new h.bL(m),u_frustum_tr:new h.bL(m),u_frustum_br:new h.bL(m),u_frustum_bl:new h.bL(m),u_horizon:new h.bM(m),u_transition:new h.bM(m),u_fadeout_range:new h.bM(m),u_color:new h.cb(m),u_high_color:new h.cb(m),u_space_color:new h.cb(m),u_temporal_offset:new h.bM(m),u_horizon_angle:new h.bM(m)}),model:m=>({u_matrix:new h.bJ(m),u_lighting_matrix:new h.bJ(m),u_normal_matrix:new h.bJ(m),u_node_matrix:new h.bJ(m),u_lightpos:new h.bL(m),u_lightintensity:new h.bM(m),u_lightcolor:new h.bL(m),u_camera_pos:new h.bL(m),u_opacity:new h.bM(m),u_baseColorFactor:new h.cb(m),u_emissiveFactor:new h.cb(m),u_metallicFactor:new h.bM(m),u_roughnessFactor:new h.bM(m),u_baseTextureIsAlpha:new h.bN(m),u_alphaMask:new h.bN(m),u_alphaCutoff:new h.bM(m),u_baseColorTexture:new h.bN(m),u_metallicRoughnessTexture:new h.bN(m),u_normalTexture:new h.bN(m),u_occlusionTexture:new h.bN(m),u_emissionTexture:new h.bN(m),u_lutTexture:new h.bN(m),u_color_mix:new h.cb(m),u_aoIntensity:new h.bM(m),u_emissive_strength:new h.bM(m),u_occlusionTextureTransform:new h.cb(m)}),modelDepth:m=>({u_matrix:new h.bJ(m),u_instance:new h.bJ(m),u_node_matrix:new h.bJ(m)}),groundShadow:m=>({u_matrix:new h.bJ(m),u_ground_shadow_factor:new h.bL(m)}),stars:m=>({u_matrix:new h.bJ(m),u_up:new h.bL(m),u_right:new h.bL(m),u_intensity_multiplier:new h.bM(m)}),snowParticle:m=>({u_modelview:new h.bJ(m),u_projection:new h.bJ(m),u_time:new h.bM(m),u_cam_pos:new h.bL(m),u_velocityConeAperture:new h.bM(m),u_velocity:new h.bM(m),u_horizontalOscillationRadius:new h.bM(m),u_horizontalOscillationRate:new h.bM(m),u_boxSize:new h.bM(m),u_billboardSize:new h.bM(m),u_simpleShapeParameters:new h.bK(m),u_screenSize:new h.bK(m),u_thinningCenterPos:new h.bK(m),u_thinningShape:new h.bL(m),u_thinningAffectedRatio:new h.bM(m),u_thinningParticleOffset:new h.bM(m),u_particleColor:new h.cb(m),u_direction:new h.bL(m)}),rainParticle:m=>({u_modelview:new h.bJ(m),u_projection:new h.bJ(m),u_time:new h.bM(m),u_cam_pos:new h.bL(m),u_texScreen:new h.bN(m),u_velocityConeAperture:new h.bM(m),u_velocity:new h.bM(m),u_boxSize:new h.bM(m),u_rainDropletSize:new h.bK(m),u_distortionStrength:new h.bM(m),u_rainDirection:new h.bL(m),u_color:new h.cb(m),u_screenSize:new h.bK(m),u_thinningCenterPos:new h.bK(m),u_thinningShape:new h.bL(m),u_thinningAffectedRatio:new h.bM(m),u_thinningParticleOffset:new h.bM(m),u_shapeDirectionalPower:new h.bM(m),u_shapeNormalPower:new h.bM(m),u_mode:new h.bM(m)}),vignette:m=>({u_vignetteShape:new h.bL(m),u_vignetteColor:new h.cb(m)}),occlusion:m=>({u_matrix:new h.bJ(m),u_anchorPos:new h.bL(m),u_screenSizePx:new h.bK(m),u_occluderSizePx:new h.bK(m),u_color:new h.cb(m)})};let df=(()=>{class m{constructor(c,_,v,x){this.id=m.uniqueIdxCounter,m.uniqueIdxCounter++,this.context=c;const E=c.gl;this.buffer=E.createBuffer(),this.dynamicDraw=!!v,this.context.unbindVAO(),c.bindElementBuffer.set(this.buffer),E.bufferData(E.ELEMENT_ARRAY_BUFFER,_.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||x||_.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(c){this.id=m.uniqueIdxCounter,m.uniqueIdxCounter++;const _=this.context.gl;this.context.unbindVAO(),this.bind(),_.bufferSubData(_.ELEMENT_ARRAY_BUFFER,0,c.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return m.uniqueIdxCounter=0,m})();const Om={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Pv{constructor(s,c,_,v,x,E){this.length=c.length,this.attributes=_,this.itemSize=c.bytesPerElement,this.dynamicDraw=v,this.instanceCount=E,this.context=s;const R=s.gl;this.buffer=R.createBuffer(),s.bindVertexBuffer.set(this.buffer),R.bufferData(R.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?R.DYNAMIC_DRAW:R.STATIC_DRAW),this.dynamicDraw||x||c.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,c){for(let _=0;_<this.attributes.length;_++){const v=c.attributes[this.attributes[_].name];void 0!==v&&s.enableVertexAttribArray(v)}}setVertexAttribPointers(s,c,_){for(let v=0;v<this.attributes.length;v++){const x=this.attributes[v],E=c.attributes[x.name];void 0!==E&&s.vertexAttribPointer(E,x.components,s[Om[x.type]],!1,this.itemSize,x.offset+this.itemSize*(_||0))}}setVertexAttribDivisor(s,c,_){for(let v=0;v<this.attributes.length;v++){const x=c.attributes[this.attributes[v].name];void 0!==x&&this.instanceCount&&this.instanceCount>0&&s.vertexAttribDivisor(x,_)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class _a{constructor(s,c,_,v,x){this.context=s,this.width=c,this.height=_;const E=this.framebuffer=s.gl.createFramebuffer();v&&(this.colorAttachment=new zo(s,E)),x&&(this.depthAttachmentType=x,this.depthAttachment="renderbuffer"===x?new Ts(s,E):new ql(s,E))}destroy(){const s=this.context.gl;if(this.colorAttachment){const c=this.colorAttachment.get();c&&s.deleteTexture(c)}if(this.depthAttachment&&this.depthAttachmentType)if("renderbuffer"===this.depthAttachmentType){const c=this.depthAttachment.get();c&&s.deleteRenderbuffer(c)}else{const c=this.depthAttachment.get();c&&s.deleteTexture(c)}s.deleteFramebuffer(this.framebuffer)}}class Yu{constructor(s,c){this.gl=s,this.clearColor=new bx(this),this.clearDepth=new i_(this),this.clearStencil=new Mm(this),this.colorMask=new $u(this),this.depthMask=new Zd(this),this.stencilMask=new Sv(this),this.stencilFunc=new Dv(this),this.stencilOp=new xx(this),this.stencilTest=new Gu(this),this.depthRange=new Bs(this),this.depthTest=new r_(this),this.depthFunc=new us(this),this.blend=new Xd(this),this.blendFunc=new Tm(this),this.blendColor=new Im(this),this.blendEquation=new Io(this),this.cullFace=new Am(this),this.cullFaceSide=new o_(this),this.frontFace=new Kd(this),this.program=new s_(this),this.activeTexture=new a_(this),this.viewport=new km(this),this.bindFramebuffer=new Mv(this),this.bindRenderbuffer=new Tv(this),this.bindTexture=new Gh(this),this.bindVertexBuffer=new l_(this),this.bindElementBuffer=new Rm(this),this.bindVertexArrayOES=new Nr(this),this.pixelStoreUnpack=new nn(this),this.pixelStoreUnpackPremultiplyAlpha=new mi(this),this.pixelStoreUnpackFlipY=new fo(this),this.options=c?Object.assign({},c):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=s.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=s.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=s.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=c&&!!c.forceManualRenderingForInstanceIDShaders||this.renderer&&-1!==this.renderer.indexOf("PowerVR"),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=s.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=s.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=s.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE),this.maxPointSize=s.getParameter(s.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,c,_){return new df(this,s,c,_)}createVertexBuffer(s,c,_,v,x){return new Pv(this,s,c,_,v,x)}createRenderbuffer(s,c,_){const v=this.gl,x=v.createRenderbuffer();return this.bindRenderbuffer.set(x),v.renderbufferStorage(v.RENDERBUFFER,s,c,_),this.bindRenderbuffer.set(null),x}createFramebuffer(s,c,_,v){return new _a(this,s,c,_,v)}clear({color:s,depth:c,stencil:_,colorMask:v}){const x=this.gl;let E=0;s&&(E|=x.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set(v||[!0,!0,!0,!0])),void 0!==c&&(E|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),void 0!==_&&(E|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),x.clear(E)}setCullFace(s){!1===s.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){h.bn(s.blendFunction,ei.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor),s.blendEquation?this.blendEquation.set(s.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(s.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let uf;function hf(m,s,c,_,v,x,E){const R=m.context,F=R.gl,N=m.transform,z=m.getOrCreateProgram("collisionBox"),U=[];let j=0,W=0;for(let ve=0;ve<_.length;ve++){const we=_[ve],Ee=s.getTile(we),De=Ee.getBucket(c);if(!De)continue;const Me=yv(we,De,N);let ke=Me;0===v[0]&&0===v[1]||(ke=m.translatePosMatrix(Me,Ee,v,x));const Oe=E?De.textCollisionBox:De.iconCollisionBox,et=De.collisionCircleArray;if(et.length>0){const qe=h.ad.mat4.create(),ot=ke;h.ad.mat4.mul(qe,De.placementInvProjMatrix,N.glCoordMatrix),h.ad.mat4.mul(qe,qe,De.placementViewportMatrix),U.push({circleArray:et,circleOffset:W,transform:ot,invTransform:qe,projection:De.getProjection()}),j+=et.length/4,W=j}Oe&&(m.terrain&&m.terrain.setupElevationDraw(Ee,z),z.draw(m,F.LINES,cn.disabled,Rn.disabled,m.colorModeForRenderPass(),Mn.disabled,lf(ke,N,Ee,De.getProjection()),c.id,Oe.layoutVertexBuffer,Oe.indexBuffer,Oe.segments,null,N.zoom,null,[Oe.collisionVertexBuffer,Oe.collisionVertexBufferExt]))}if(!E||!U.length)return;const ne=m.getOrCreateProgram("collisionCircle"),J=new h.cW;J.resize(4*j),J._trim();let oe=0;for(const ve of U)for(let we=0;we<ve.circleArray.length/4;we++){const Ee=4*we,De=ve.circleArray[Ee+0],Me=ve.circleArray[Ee+1],ke=ve.circleArray[Ee+2],Oe=ve.circleArray[Ee+3];J.emplace(oe++,De,Me,ke,Oe,0),J.emplace(oe++,De,Me,ke,Oe,1),J.emplace(oe++,De,Me,ke,Oe,2),J.emplace(oe++,De,Me,ke,Oe,3)}(!uf||uf.length<2*j)&&(uf=function(ve){const we=2*ve,Ee=new h.aV;Ee.resize(we),Ee._trim();for(let De=0;De<we;De++){const Me=6*De;Ee.uint16[Me+0]=4*De+0,Ee.uint16[Me+1]=4*De+1,Ee.uint16[Me+2]=4*De+2,Ee.uint16[Me+3]=4*De+2,Ee.uint16[Me+4]=4*De+3,Ee.uint16[Me+5]=4*De+0}return Ee}(j));const se=R.createIndexBuffer(uf,!0),fe=R.createVertexBuffer(J,h.cX.members,!0);for(const ve of U){const we={u_matrix:ve.transform,u_inv_matrix:ve.invTransform,u_camera_to_center_distance:(be=N).getCameraToCenterDistance(ve.projection),u_viewport_size:[be.width,be.height]};ne.draw(m,F.TRIANGLES,cn.disabled,Rn.disabled,m.colorModeForRenderPass(),Mn.disabled,we,c.id,fe,se,h.b8.simpleSegment(0,2*ve.circleOffset,ve.circleArray.length,ve.circleArray.length/2),null,N.zoom)}var be;fe.destroy(),se.destroy()}const Mr=h.ad.mat4.create();function pf(m){const s=m._camera.getWorldToCamera(m.worldSize,1),c=h.ad.mat4.multiply([],s,m.globeMatrix);h.ad.mat4.invert(c,c);const _=[0,0,0],v=[0,1,0,0];return h.ad.vec4.transformMat4(v,v,c),_[0]=v[0],_[1]=v[1],_[2]=v[2],h.ad.vec3.normalize(_,_),_}function Ov({width:m,height:s,anchor:c,textOffset:_,textScale:v},x){const{horizontalAlign:E,verticalAlign:R}=h.bD(c),F=-(E-.5)*m,N=-(R-.5)*s,z=h.bC(c,_);return new h.P((F/v+z[0])*x,(N/v+z[1])*x)}function ml(m,s,c,_,v,x,E,R,F,N,z){const U=m.text.placedSymbolArray,j=m.text.dynamicLayoutVertexArray,W=m.icon.dynamicLayoutVertexArray,ne={},J=m.getProjection(),oe=cl(R,J,x),se=x.elevation,fe=J.upVectorScale(R.canonical,x.center.lat,x.worldSize).metersToTile;j.clear();for(let be=0;be<U.length;be++){const ve=U.get(be),{tileAnchorX:we,tileAnchorY:Ee,numGlyphs:De}=ve,Me=ve.hidden||!ve.crossTileID||m.allowVerticalPlacement&&!ve.placedOrientation?null:_[ve.crossTileID];if(Me){let ke=0,Oe=0,et=0;if(se){const rt=se?se.getAtTileOffset(R,we,Ee):0,[$e,Je,dt]=J.upVector(R.canonical,we,Ee);ke=rt*$e*fe,Oe=rt*Je*fe,et=rt*dt*fe}let[qe,ot,lt,Ct]=ha(ve.projectedAnchorX+ke,ve.projectedAnchorY+Oe,ve.projectedAnchorZ+et,c?oe:E);const He=Wc(x.getCameraToCenterDistance(J),Ct);let st=v.evaluateSizeForFeature(m.textSizeData,N,ve)*He/h.bw;c&&(st*=m.tilePixelRatio/F);const Be=Ov(Me,st);c?(({x:qe,y:ot,z:lt}=J.projectTilePoint(we+Be.x,Ee+Be.y,R.canonical)),[qe,ot,lt]=ha(qe+ke,ot+Oe,lt+et,E)):(s&&Be._rotate(-x.angle),qe+=Be.x,ot+=Be.y,lt=0);const at=m.allowVerticalPlacement&&ve.placedOrientation===h.bq.vertical?Math.PI/2:0;for(let rt=0;rt<De;rt++)h.bt(j,qe,ot,lt,at);z&&ve.associatedIconIndex>=0&&(ne[ve.associatedIconIndex]={x:qe,y:ot,z:lt,angle:at})}else Ul(De,j)}if(z){W.clear();const be=m.icon.placedSymbolArray;for(let ve=0;ve<be.length;ve++){const we=be.get(ve),{numGlyphs:Ee}=we,De=ne[ve];if(we.hidden||!De)Ul(Ee,W);else{const{x:Me,y:ke,z:Oe,angle:et}=De;for(let qe=0;qe<Ee;qe++)h.bt(W,Me,ke,Oe,et)}}m.icon.dynamicLayoutVertexBuffer.updateData(W)}m.text.dynamicLayoutVertexBuffer.updateData(j)}function sr(m,s,c,_,v,x,E={}){const R=c.paint.get("icon-translate"),F=c.paint.get("text-translate"),N=c.paint.get("icon-translate-anchor"),z=c.paint.get("text-translate-anchor"),U=c.layout.get("icon-rotation-alignment"),j=c.layout.get("text-rotation-alignment"),W=c.layout.get("icon-pitch-alignment"),ne=c.layout.get("text-pitch-alignment"),J=c.layout.get("icon-keep-upright"),oe=c.layout.get("text-keep-upright"),se=c.paint.get("icon-color-saturation"),fe=c.paint.get("icon-color-contrast"),be=c.paint.get("icon-color-brightness-min"),ve=c.paint.get("icon-color-brightness-max"),we="sea"===c.layout.get("symbol-elevation-reference"),Ee=m.context,De=Ee.gl,Me=m.transform,ke="map"===U,Oe="map"===j,et="map"===W,qe="map"===ne,ot=void 0!==c.layout.get("symbol-sort-key").constantOr(1);let lt=!1;const Ct=m.depthModeForSublayer(0,cn.ReadOnly),He=[h.av(Me.center.lng),h.aC(Me.center.lat)],st=c.layout.get("text-variable-anchor"),Be="globe"===Me.projection.name,at=[],rt=[0,-1,0];for(const $e of _){const Je=s.getTile($e),dt=Je.getBucket(c);if(!dt||"mercator"===dt.projection.name&&Be||dt.fullyClipped)continue;const Ft="globe"===dt.projection.name,zt=Ft?h.ag(Me.zoom):0,Bt=cl($e,dt.getProjection(),Me),en=Me.calculatePixelsToTileUnitsMatrix(Je),In=st&&dt.hasTextData(),wt=dt.hasIconTextFit()&&In&&dt.hasIconData(),Tn=dt.getProjection().createInversionMatrix(Me,$e.canonical),vn=Vi=>{Me.depthOcclusionForSymbolsAndCircles&&(c.hasInitialOcclusionOpacityProperties||m.terrain)&&(Vi.push("DEPTH_D24"),Vi.push("DEPTH_OCCLUSION"))},di=()=>{const Vi=ke&&"point"!==c.layout.get("symbol-placement"),Ei=[];vn(Ei);const Xi=Vi||wt,lo=c.paint.get("icon-image-cross-fade").constantOr(0);m.terrainRenderModeElevated()&&et&&Ei.push("PITCH_WITH_MAP_TERRAIN"),Ft&&(Ei.push("PROJECTION_GLOBE_VIEW"),Xi&&Ei.push("PROJECTED_POS_ON_VIEWPORT")),lo>0&&Ei.push("ICON_TRANSITION"),dt.icon.zOffsetVertexBuffer&&Ei.push("Z_OFFSET"),0===se&&0===fe&&0===be&&1===ve||Ei.push("COLOR_ADJUSTMENT"),dt.sdfIcons&&Ei.push("RENDER_SDF");const _o=dt.icon.programConfigurations.get(c.id),jo=m.getOrCreateProgram("symbol",{config:_o,defines:Ei}),xl=Je.imageAtlasTexture?Je.imageAtlasTexture.size:[0,0],ms=dt.iconSizeData,wi=h.bp(ms,Me.zoom),Tr=et||0!==Me.pitch,Oi=qc(Bt,Je.tileID.canonical,et,ke,Me,dt.getProjection(),en),$i=Wr(Bt,Je.tileID.canonical,et,ke,Me,dt.getProjection(),en),Dn=m.translatePosMatrix($i,Je,R,N,!0),vr=m.translatePosMatrix(Bt,Je,R,N),Gr=Xi?Mr:Oi,md=ke&&!et&&!Vi;let wr=rt;!Be&&!Me.mercatorFromTransition||ke||(wr=pf(Me));const ea=Ft?wr:rt,js=c.getColorAdjustmentMatrix(se,fe,be,ve),wl=c_(ms.kind,wi,md,et,m,vr,Gr,Dn,we,!1,xl,[0,0],!0,$e,zt,He,Tn,ea,dt.getProjection(),js,lo),gs=Je.imageAtlasTexture?Je.imageAtlasTexture:null,Wa=1!==c.layout.get("icon-size").constantOr(0)||dt.iconsNeedLinear,Mc=dt.sdfIcons||m.options.rotating||m.options.zooming||Wa||Tr?De.LINEAR:De.NEAREST,Xl=dt.sdfIcons&&0!==c.paint.get("icon-halo-width").constantOr(1),Wm=m.terrain&&et&&Vi?h.ad.mat4.invert(h.ad.mat4.create(),Oi):Mr;if(Vi&&dt.icon){const Tc=Me.elevation,lu=Tc?Tc.getAtTileOffsetFunc($e,Me.center.lat,Me.worldSize,dt.getProjection()):null,Ym=Xo(Bt,Je.tileID.canonical,et,ke,Me,dt.getProjection(),en);Ou(dt,Bt,m,!1,Ym,$i,et,J,lu,$e)}return{program:jo,buffers:dt.icon,uniformValues:wl,atlasTexture:gs,atlasTextureIcon:null,atlasInterpolation:Mc,atlasInterpolationIcon:null,isSDF:dt.sdfIcons,hasHalo:Xl,tile:Je,labelPlaneMatrixInv:Wm}},Pi=()=>{const Vi=Oe&&"point"!==c.layout.get("symbol-placement"),Ei=[],Xi=Vi||st||wt;m.terrainRenderModeElevated()&&qe&&Ei.push("PITCH_WITH_MAP_TERRAIN"),Ft&&(Ei.push("PROJECTION_GLOBE_VIEW"),Xi&&Ei.push("PROJECTED_POS_ON_VIEWPORT")),dt.text.zOffsetVertexBuffer&&Ei.push("Z_OFFSET"),dt.iconsInText&&Ei.push("RENDER_TEXT_AND_SYMBOL"),Ei.push("RENDER_SDF"),vn(Ei);const lo=dt.text.programConfigurations.get(c.id),_o=m.getOrCreateProgram("symbol",{config:lo,defines:Ei});let jo,xl=[0,0],ms=null;const wi=dt.textSizeData;dt.iconsInText&&(xl=Je.imageAtlasTexture?Je.imageAtlasTexture.size:[0,0],ms=Je.imageAtlasTexture?Je.imageAtlasTexture:null,jo=qe||0!==Me.pitch||m.options.rotating||m.options.zooming||"composite"===wi.kind||"camera"===wi.kind?De.LINEAR:De.NEAREST);const Tr=Je.glyphAtlasTexture?Je.glyphAtlasTexture.size:[0,0],Oi=c.layout.get("text-size-scale-range"),$i=h.ay(m.scaleFactor,Oi[0],Oi[1]),Dn=h.bp(wi,Me.zoom,$i),vr=qc(Bt,Je.tileID.canonical,qe,Oe,Me,dt.getProjection(),en),Gr=Wr(Bt,Je.tileID.canonical,qe,Oe,Me,dt.getProjection(),en),md=m.translatePosMatrix(Gr,Je,F,z,!0),wr=m.translatePosMatrix(Bt,Je,F,z),ea=Xi?Mr:vr,js=Oe&&!qe&&!Vi;let wl=rt;!Be&&!Me.mercatorFromTransition||Oe||(wl=pf(Me));const gs=c_(wi.kind,Dn,js,qe,m,wr,ea,md,we,!0,Tr,xl,!0,$e,zt,He,Tn,Ft?wl:rt,dt.getProjection(),null,null,$i),Wa=Je.glyphAtlasTexture?Je.glyphAtlasTexture:null,Mc=De.LINEAR,Xl=0!==c.paint.get("text-halo-width").constantOr(1),Wm=m.terrain&&qe&&Vi?h.ad.mat4.invert(h.ad.mat4.create(),vr):Mr;if(Vi&&dt.text){const Tc=Me.elevation,lu=Tc?Tc.getAtTileOffsetFunc($e,Me.center.lat,Me.worldSize,dt.getProjection()):null,Ym=Xo(Bt,Je.tileID.canonical,qe,Oe,Me,dt.getProjection(),en);Ou(dt,Bt,m,!0,Ym,Gr,qe,oe,lu,$e)}return{program:_o,buffers:dt.text,uniformValues:gs,atlasTexture:Wa,atlasTextureIcon:ms,atlasInterpolation:Mc,atlasInterpolationIcon:jo,isSDF:!0,hasHalo:Xl,tile:Je,labelPlaneMatrixInv:Wm}},ar=dt.icon.segments.get().length,Yn=dt.text.segments.get().length,xr=ar&&!E.onlyText?di():null,An=Yn&&!E.onlyIcons?Pi():null,tn=c.paint.get("icon-opacity").constantOr(1),gi=c.paint.get("text-opacity").constantOr(1);if(ot&&dt.canOverlap){lt=!0;const Vi=tn&&!E.onlyText?dt.icon.segments.get():[],Ei=gi&&!E.onlyIcons?dt.text.segments.get():[];for(const Xi of Vi)at.push({segments:new h.b8([Xi]),sortKey:Xi.sortKey,state:xr});for(const Xi of Ei)at.push({segments:new h.b8([Xi]),sortKey:Xi.sortKey,state:An})}else E.onlyText||at.push({segments:tn?dt.icon.segments:new h.b8([]),sortKey:0,state:xr}),E.onlyIcons||at.push({segments:gi?dt.text.segments:new h.b8([]),sortKey:0,state:An})}lt&&at.sort(($e,Je)=>$e.sortKey-Je.sortKey);for(const $e of at){const Je=$e.state;if(Je)if(m.terrain?m.terrain.setupElevationDraw(Je.tile,Je.program,{useDepthForOcclusion:Me.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Je.labelPlaneMatrixInv}):m.setupDepthForOcclusion(Me.depthOcclusionForSymbolsAndCircles,Je.program),Ee.activeTexture.set(De.TEXTURE0),Je.atlasTexture&&Je.atlasTexture.bind(Je.atlasInterpolation,De.CLAMP_TO_EDGE,!0),Je.atlasTextureIcon&&(Ee.activeTexture.set(De.TEXTURE1),Je.atlasTextureIcon&&Je.atlasTextureIcon.bind(Je.atlasInterpolationIcon,De.CLAMP_TO_EDGE,!0)),m.uploadCommonLightUniforms(m.context,Je.program),Je.hasHalo){const dt=Je.uniformValues;dt.u_is_halo=1,Zu(Je.buffers,$e.segments,c,m,Je.program,Ct,v,x,dt,2),dt.u_is_halo=0}else{if(Je.isSDF){const dt=Je.uniformValues;Je.hasHalo&&(dt.u_is_halo=1,Zu(Je.buffers,$e.segments,c,m,Je.program,Ct,v,x,dt,1)),dt.u_is_halo=0}Zu(Je.buffers,$e.segments,c,m,Je.program,Ct,v,x,Je.uniformValues,1)}}}function Zu(m,s,c,_,v,x,E,R,F,N){const z=[m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer,m.iconTransitioningVertexBuffer,m.globeExtVertexBuffer,m.zOffsetVertexBuffer];v.draw(_,_.context.gl.TRIANGLES,x,E,R,Mn.disabled,F,c.id,m.layoutVertexBuffer,m.indexBuffer,s,c.paint,_.transform.zoom,m.programConfigurations.get(c.id),z,N)}function h_(m,s){const c=1<<m.canonical.z,_=(s.x*c-m.canonical.x-m.wrap*c)*h.ai,v=(s.y*c-m.canonical.y)*h.ai,x=h.d5(s.z,s.y);return h.ad.vec3.fromValues(_,v,x)}function ff(m,s,c,_,v){if(!c.layout||"none"===c.layout.get("fill-elevation-reference"))return;const x=m.context.gl,E=new cn(m.context.gl.LEQUAL,cn.ReadWrite,m.depthRangeFor3D),R=new cn(m.context.gl.GREATER,cn.ReadWrite,m.depthRangeFor3D),F=function(W){const ne=h.c4(W.pitch);let J=.01;return W.isOrthographic&&(J=h.ah(1e-4,J,h.c9(ne>=15?1:ne/15))),2*J}(m.transform),N=m.transform.getFreeCameraOptions().position,z="elevatedStructuresDepthReconstruct",U=m.getOrCreateProgram(z,{defines:["DEPTH_RECONSTRUCTION"]}),j=m.getOrCreateProgram(z);for(const W of _){const ne=s.getTile(W),J=ne.getBucket(c);if(!J)continue;const oe=J.elevatedStructures;if(!oe)continue;const se=J.elevationBufferData.heightRange,fe=h_(W.toUnwrapped(),N),be=m.translatePosMatrix(W.projMatrix,ne,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));let ve,we,Ee,De;if("initialize"===v){if(!se||se.min>=1||0===oe.depthSegments.segments[0].primitiveLength)continue;ve=Qs(be,fe,F,1,0),we=E,Ee=oe.depthSegments,De=U}else if("reset"===v){if(!se||se.min>=0||0===oe.maskSegments.segments[0].primitiveLength)continue;ve=Qs(be,fe,0,0,1),we=R,Ee=oe.maskSegments,De=U}else if("geometry"===v){if(0===oe.depthSegments.segments[0].primitiveLength)continue;ve=Qs(be,fe,F,1,0),we=E,Ee=oe.depthSegments,De=j}De.draw(m,x.TRIANGLES,we,Rn.disabled,ei.disabled,Mn.disabled,ve,c.id,oe.vertexBuffer,oe.indexBuffer,Ee,c.paint,m.transform.zoom)}}function Fm(m,s,c){const{painter:_,sourceCache:v,layer:x,coords:E,colorMode:R,elevationType:F,terrainEnabled:N,pass:z}=m,U=_.context.gl,j=x.paint.get("fill-pattern");let W=F;"road"!==F||s&&!N||(W="none");const ne="road"===W,J=new cn(_.context.gl.LEQUAL,cn.ReadWrite,_.depthRangeFor3D),oe=j&&j.constantOr(1),se=(fe,be)=>{let ve,we,Ee,De,Me;be?(we=oe&&!x.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ve=U.LINES):(we=oe?"fillPattern":"fill",ve=U.TRIANGLES);for(const ke of E){const Oe=v.getTile(ke);if(oe&&!Oe.patternsLoaded())continue;const et=Oe.getBucket(x);if(!et)continue;const qe=s?et.elevationBufferData:et.bufferData;if(qe.isEmpty())continue;_.prepareDrawTile();const ot=qe.programConfigurations.get(x.id),lt=_.isTileAffectedByFog(ke),Ct=[],He=[];ne&&(Ct.push("ELEVATED_ROADS"),He.push(qe.elevatedLayoutVertexBuffer));const st=_.getOrCreateProgram(we,{config:ot,overrideFog:lt,defines:Ct});oe&&(_.context.activeTexture.set(U.TEXTURE0),Oe.imageAtlasTexture&&Oe.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),ot.updatePaintBuffers());const Be=j.constantOr(null);if(Be&&Oe.imageAtlas){const $e=Oe.imageAtlas,Je=h.d0.from(Be).getPrimary().scaleSelf(h.q.devicePixelRatio).toString(),dt=$e.patternPositions.get(Je);dt&&ot.setConstantPatternPositions(dt)}const at=_.translatePosMatrix(ke.projMatrix,Oe,x.paint.get("fill-translate"),x.paint.get("fill-translate-anchor")),rt=x.paint.get("fill-emissive-strength");if(be){De=qe.lineIndexBuffer,Me=qe.lineSegments;const $e=_.terrain&&_.terrain.renderingToTexture?_.terrain.drapeBufferSize:[U.drawingBufferWidth,U.drawingBufferHeight];Ee="fillOutlinePattern"===we&&oe?Yh(at,rt,_,Oe,$e):xo(at,rt,$e)}else De=qe.indexBuffer,Me=qe.triangleSegments,Ee=oe?ao(at,rt,_,Oe):zr(at,rt);_.uploadCommonUniforms(_.context,st,ke.toUnwrapped()),st.draw(_,ve,"none"!==W?J:fe,c||_.stencilModeForClipping(ke),R,Mn.disabled,Ee,x.id,qe.layoutVertexBuffer,De,Me,x.paint,_.transform.zoom,ot,He)}};_.renderPass===z&&se(_.depthModeForSublayer(1,"opaque"===_.renderPass?cn.ReadWrite:cn.ReadOnly),!1),"none"===W&&"translucent"===_.renderPass&&x.paint.get("fill-antialias")&&se(_.depthModeForSublayer(x.getPaintProperty("fill-outline-color")?2:0,cn.ReadOnly),!0)}function yr(m,s,c,_,v,x,E,R){c.resetLayerRenderingStats(m);const F=m.context,N=F.gl,z=m.transform,U=c.paint.get("fill-extrusion-pattern"),j=U.constantOr(1),W=c.paint.get("fill-extrusion-opacity"),ne=m.style.enable3dLights(),J=c.paint.get(ne&&!j?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),oe=[c.paint.get("fill-extrusion-ambient-occlusion-intensity"),J],se=c.layout.get("fill-extrusion-edge-radius"),fe=se>0&&!c.paint.get("fill-extrusion-rounded-roof"),be=fe?0:se,ve="globe"===z.projection.name?h.d6():0,we="globe"===z.projection.name,Ee=we?h.ag(z.zoom):0,De=[h.av(z.center.lng),h.aC(z.center.lat)],Me="none"===c.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default"),ke=c.paint.get("fill-extrusion-flood-light-color").toRenderColor(Me?null:c.lut).toArray01().slice(0,3),Oe=c.paint.get("fill-extrusion-flood-light-intensity"),et=c.paint.get("fill-extrusion-vertical-scale"),qe=0!==c.paint.get("fill-extrusion-line-width").constantOr(1),ot=c.paint.get("fill-extrusion-height-alignment"),lt=c.paint.get("fill-extrusion-base-alignment"),Ct=Qc(m,c.paint.get("fill-extrusion-cutoff-fade-range")),He=[];let st;we&&He.push("PROJECTION_GLOBE_VIEW"),oe[0]>0&&He.push("FAUX_AO"),fe&&He.push("ZERO_ROOF_RADIUS"),R&&He.push("HAS_CENTROID"),Oe>0&&He.push("FLOOD_LIGHT"),Ct.shouldRenderCutoff&&He.push("RENDER_CUTOFF"),qe&&He.push("RENDER_WALL_MODE");const Be="shadow"===m.renderPass,at=m.shadowRenderer,rt=Be&&!!at;m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!0);let $e=[0,0,0];if(at){const Ft=m.style.directionalLight,zt=m.style.ambientLight;Ft&&zt&&($e=Bu(m.style,Ft,zt)),Be||(He.push("RENDER_SHADOWS","DEPTH_TEXTURE"),at.useNormalOffset&&He.push("NORMAL_OFFSET")),st=He.concat(["SHADOWS_SINGLE_CASCADE"])}const Je=rt?"fillExtrusionDepth":j?"fillExtrusionPattern":"fillExtrusion",dt=c.getLayerRenderingStats();for(const Ft of _){const zt=s.getTile(Ft),Bt=zt.getBucket(c);if(!Bt||Bt.projection.name!==z.projection.name)continue;let en=!1;at&&(en=0===at.getMaxCascadeForTile(Ft.toUnwrapped()));const In=m.isTileAffectedByFog(Ft),wt=Bt.programConfigurations.get(c.id),Tn=m.getOrCreateProgram(Je,{config:wt,defines:en?st:He,overrideFog:In});if(m.terrain&&m.terrain.setupElevationDraw(zt,Tn,{useMeterToDem:!0}),!Bt.centroidVertexBuffer){const An=Tn.attributes.a_centroid_pos;void 0!==An&&N.vertexAttrib2f(An,0,0)}!Be&&at&&at.setupShadows(zt.tileID.toUnwrapped(),Tn,"vector-tile",zt.tileID.overscaledZ),j&&(m.context.activeTexture.set(N.TEXTURE0),zt.imageAtlasTexture&&zt.imageAtlasTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),wt.updatePaintBuffers());const vn=U.constantOr(null);if(vn&&zt.imageAtlas){const An=zt.imageAtlas,tn=h.d0.from(vn).getPrimary().scaleSelf(h.q.devicePixelRatio),gi=An.patternPositions.get(tn.toString());gi&&wt.setConstantPatternPositions(gi)}const di=c.paint.get("fill-extrusion-vertical-gradient"),Pi=1/Bt.tileToMeter;let ar;if(Be&&at){if(Bo(zt.tileID,Bt,m))continue;const An=at.calculateShadowPassMatrixFromTile(zt.tileID.toUnwrapped());ar=ad(An,be,Pi,et,ot,lt)}else{const An=m.translatePosMatrix(Ft.expandedProjMatrix,zt,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),tn=z.projection.createInversionMatrix(z,Ft.canonical);ar=j?Qd(An,m,di,W,oe,be,Pi,Ft,zt,ve,ot,lt,Ee,De,tn,ke,et):Va(An,m,di,W,oe,be,Pi,Ft,ve,ot,lt,Ee,De,tn,ke,et,Oe,$e)}m.uploadCommonUniforms(F,Tn,Ft.toUnwrapped(),null,Ct);let Yn=Bt.segments;if("mercator"===z.projection.name&&!Be&&(Yn=Bt.getVisibleSegments(zt.tileID,m.terrain,m.transform.getFrustum(0)),!Yn.get().length))continue;if(dt)if(Be)for(const An of Yn.get())dt.numRenderedVerticesInShadowPass+=An.primitiveLength;else for(const An of Yn.get())dt.numRenderedVerticesInTransparentPass+=An.primitiveLength;const xr=[];(m.terrain||R)&&xr.push(Bt.centroidVertexBuffer),we&&xr.push(Bt.layoutVertexExtBuffer),qe&&xr.push(Bt.wallVertexBuffer),Tn.draw(m,F.gl.TRIANGLES,v,x,E,Mn.backCCW,ar,c.id,Bt.layoutVertexBuffer,Bt.indexBuffer,Yn,c.paint,m.transform.zoom,wt,xr)}m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!1)}function Xu(m,s,c,_,v,x,E,R,F,N,z,U,j,W,ne,J,oe,se,fe){const be=m.context,ve=be.gl,we=m.transform,Ee=m.transform.zoom,De=[],Me=Qc(m,c.paint.get("fill-extrusion-cutoff-fade-range"));"clear"===N?(De.push("CLEAR_SUBPASS"),fe&&(De.push("CLEAR_FROM_TEXTURE"),be.activeTexture.set(ve.TEXTURE0),fe.bind(ve.LINEAR,ve.CLAMP_TO_EDGE))):"sdf"===N&&De.push("SDF_SUBPASS"),oe&&De.push("HAS_CENTROID"),Me.shouldRenderCutoff&&De.push("RENDER_CUTOFF");const ke=c.layout.get("fill-extrusion-edge-radius"),Oe=(et,qe,ot,lt,Ct)=>{const He=qe.programConfigurations.get(c.id),st=m.isTileAffectedByFog(et),Be=m.getOrCreateProgram("fillExtrusionGroundEffect",{config:He,defines:De,overrideFog:st}),at=(($e,Je,dt,Ft,zt,Bt,en,In,wt,Tn,vn)=>({u_matrix:Je,u_opacity:dt,u_ao_pass:Ft?1:0,u_meter_to_tile:zt,u_ao:Bt,u_flood_light_intensity:en,u_flood_light_color:In,u_attenuation:wt,u_edge_radius:Tn,u_fb:0,u_fb_size:vn,u_dynamic_offset:1}))(0,lt,z,F,Ct,[U,j*Ct],W,ne,J,Ee>=17?0:ke*Ct,fe?fe.size[0]:0),rt=[];oe&&rt.push(qe.hiddenByLandmarkVertexBuffer),m.uploadCommonUniforms(be,Be,et.toUnwrapped(),null,Me),Be.draw(m,be.gl.TRIANGLES,v,x,E,R,at,c.id,qe.vertexBuffer,qe.indexBuffer,ot,c.paint,Ee,He,rt)};for(const et of _){const qe=s.getTile(et),ot=qe.getBucket(c);if(!ot||ot.projection.name!==we.projection.name||!ot.groundEffect||ot.groundEffect&&!ot.groundEffect.hasData())continue;const lt=ot.groundEffect,Ct=1/ot.tileToMeter;{const He=m.translatePosMatrix(et.projMatrix,qe,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),st=lt.getDefaultSegment();Oe(et,lt,st,He,Ct)}if(se)for(let He=0;He<4;He++){const st=h.d7[He](et),Be=s.getTile(st);if(!Be)continue;const at=Be.getBucket(c);if(!at||at.projection.name!==we.projection.name||!at.groundEffect||at.groundEffect&&!at.groundEffect.hasData())continue;const rt=at.groundEffect;let $e,Je;0===He?($e=[-h.ai,0,0],Je=1):1===He?($e=[h.ai,0,0],Je=0):2===He?($e=[0,-h.ai,0],Je=3):($e=[0,h.ai,0],Je=2);const dt=rt.regionSegments[Je];if(!dt)continue;const Ft=new Float32Array(16);h.ad.mat4.translate(Ft,et.projMatrix,$e),Oe(et,rt,dt,m.translatePosMatrix(Ft,qe,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),Ct)}}}function Ku(m,s,c,_,v,x,E){0===_.centroidVertexArray.length&&_.createCentroidsBuffer();const R=x?x.findDEMTileFor(c):null;if(!(R&&R.dem||E))return;x&&R&&R.dem&&_.selfDEMTileTimestamp!==R.dem._timestamp&&(_.borderDoneWithNeighborZ=[-1,-1,-1,-1],_.selfDEMTileTimestamp=R.dem._timestamp);const F=se=>new h.P(Math.ceil((se+h.da)*h.db),0),N=se=>{const fe=s.getSource().minzoom,be=we=>{const Ee=s.getTileByID(we);if(Ee&&Ee.hasData())return Ee.getBucket(v)},ve=[0,-1,1];for(const we of ve){if(se.overscaledZ+we<fe)continue;const Ee=be(se.calculateScaledKey(se.overscaledZ+we));if(Ee)return Ee}},z=[0,0,0],U=(se,fe)=>(z[0]=Math.min(se.min.y,fe.min.y),z[1]=Math.max(se.max.y,fe.max.y),z[2]=h.ai-fe.min.x>se.max.x?fe.min.x-h.ai:se.max.x,z),j=(se,fe)=>(z[0]=Math.min(se.min.x,fe.min.x),z[1]=Math.max(se.max.x,fe.max.x),z[2]=h.ai-fe.min.y>se.max.y?fe.min.y-h.ai:se.max.y,z),W=[(se,fe)=>U(se,fe),(se,fe)=>U(fe,se),(se,fe)=>j(se,fe),(se,fe)=>j(fe,se)],ne=(se,fe,be,ve,we,Ee,De)=>{if(!x)return 0;const Me=[[Ee?be:se,Ee?se:be,0],[Ee?be:fe,Ee?fe:be,0]],ke=De<0?h.ai+De:De,Oe=[Ee?ke:(se+fe)/2,Ee?(se+fe)/2:ke,0];return 0===be&&De<0||0!==be&&De>0?x.getForTilePoints(we,[Oe],!0,ve):Me.push(Oe),x.getForTilePoints(c,Me,!0,R),Math.max(Me[0][2],Me[1][2],Oe[2])/x.exaggeration()};for(let se=0;se<4;se++){const fe=_.borderFeatureIndices[se];if(0===fe.length)continue;const be=h.d7[se](c),ve=N(be);if(!(ve&&ve instanceof h.d8))continue;const we=x?x.findDEMTileFor(be):null;if(!(we&&we.dem||E)||(x&&we&&we.dem&&_.borderDEMTileTimestamp[se]!==we.dem._timestamp&&(_.borderDoneWithNeighborZ[se]=-1,_.borderDEMTileTimestamp[se]=we.dem._timestamp),_.borderDoneWithNeighborZ[se]===ve.canonical.z))continue;0===ve.centroidVertexArray.length&&ve.createCentroidsBuffer();const Ee=(se<2?1:5)-se,De=ve.borderDoneWithNeighborZ[Ee]!==_.canonical.z,Me=ve.borderFeatureIndices[Ee];let ke=0;if(_.canonical.z!==ve.canonical.z){for(const Oe of fe)_.showCentroid(_.featuresOnBorder[Oe]);if(De)for(const Oe of Me)ve.showCentroid(ve.featuresOnBorder[Oe]);_.borderDoneWithNeighborZ[se]=ve.canonical.z,ve.borderDoneWithNeighborZ[Ee]=_.canonical.z}for(const Oe of fe){const et=_.featuresOnBorder[Oe],qe=_.centroidData[et.centroidDataIndex],ot=et.borders[se];let lt;for(;ke<Me.length;){lt=ve.featuresOnBorder[Me[ke]];const Ct=lt.borders[Ee];if(Ct[1]>ot[0]+3||Ct[0]>ot[0]-3)break;ve.showCentroid(lt),ke++}if(lt&&ke<Me.length){const Ct=ke;let He=0;for(;!(lt.borders[Ee][0]>ot[1]-3)&&(He++,++ke!==Me.length);)lt=ve.featuresOnBorder[Me[ke]];lt=ve.featuresOnBorder[Me[Ct]];let st=!1;if(He>=1){const rt=lt.borders[Ee];Math.abs(ot[0]-rt[0])<3&&Math.abs(ot[1]-rt[1])<3&&(He=1,st=!0,ke=Ct+1)}else if(0===He){_.showCentroid(et);continue}const Be=ve.centroidData[lt.centroidDataIndex];E&&st&&(((J=qe).flags|(oe=Be).flags)&h.d9?(J.flags|=h.d9,oe.flags|=h.d9):(J.flags&=~h.d9,oe.flags&=~h.d9));const at=et.intersectsCount()>1||lt.intersectsCount()>1;if(He>1)ke=Ct,qe.centroidXY=Be.centroidXY=new h.P(0,0);else if(we&&we.dem&&!at){const rt=W[se](qe,Be),$e=se%2?h.ai-1:0,Je=ne(rt[0],Math.min(h.ai-1,rt[1]),$e,we,be,se<2,rt[2]);qe.centroidXY=Be.centroidXY=F(Je)}else at?qe.centroidXY=Be.centroidXY=new h.P(0,0):(qe.centroidXY=_.encodeBorderCentroid(et),Be.centroidXY=ve.encodeBorderCentroid(lt));_.writeCentroidToBuffer(qe),ve.writeCentroidToBuffer(Be)}else _.showCentroid(et)}_.borderDoneWithNeighborZ[se]=ve.canonical.z,ve.borderDoneWithNeighborZ[Ee]=_.canonical.z}var J,oe;(_.needsCentroidUpdate||!_.centroidVertexBuffer&&0!==_.centroidVertexArray.length)&&_.uploadCentroid(m)}const tr=[1,0,0],Mt=[0,1,0],Vt=[0,0,1];function Bo(m,s,c){const _=c.transform,v=c.shadowRenderer;if(!v)return!0;const x=m.toUnwrapped(),E=_.tileSize*v._cascades[c.currentShadowCascade].scale;let R=s.maxHeight;if(_.elevation){const J=_.elevation.getMinMaxForTile(m);J&&(R+=J.max)}const F=[...v.shadowDirection];F[2]=-F[2];const N=v.computeSimplifiedTileShadowVolume(x,R,E,F);if(!N)return!1;const z=[tr,Mt,Vt,F,[F[0],0,F[2]],[0,F[1],F[2]]],U="globe"===_.projection.name,j=_.scaleZoom(E),W=h.bR.fromInvProjectionMatrix(_.invProjMatrix,_.worldSize,j,!U),ne=v.getCurrentCascadeFrustum();return 0===W.intersectsPrecise(N.vertices,N.planes,z)||0===ne.intersectsPrecise(N.vertices,N.planes,z)}function Br(m){return[m[0]*h.dc,m[1]*h.dc,m[2]*h.dc,0]}function Ye(m,s,c,_,v,x,E,R,F){const N=_.getSource(),z=c.globeSharedBuffers;if(!z)return;let U,j,W;if(s&&(U=_.getTile(s)),N instanceof h.aK?(j=N.texture,W=h.cJ(0,0,c.transform)):U&&s&&(j=U.texture,W=h.cJ(s.canonical.z,s.canonical.x,c.transform)),!j||!W)return;m||(W=h.ad.mat4.scale(h.ad.mat4.create(),W,[1,-1,1]));const ne=c.context,J=ne.gl,oe="nearest"===v.paint.get("raster-resampling")?J.NEAREST:J.LINEAR,se=c.colorModeForDrapableLayerRenderPass(x),fe=E.defines;fe.push("GLOBE_POLES");const be=new cn(J.LEQUAL,cn.ReadWrite,c.depthRangeFor3D),ve=Float32Array.from(c.transform.expandedFarZProjMatrix),we=Float32Array.from(h.bc(h.cI(new h.bT(0,0,0))));c.terrain&&c.terrain.prepareDrawTile(),ne.activeTexture.set(J.TEXTURE0),j.bind(oe,J.CLAMP_TO_EDGE),ne.activeTexture.set(J.TEXTURE1),j.bind(oe,J.CLAMP_TO_EDGE),"useMipmap"in j&&ne.extTextureFilterAnisotropic&&c.transform.pitch>20&&J.texParameterf(J.TEXTURE_2D,ne.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,ne.extTextureFilterAnisotropicMax);const[Ee,De,Me,ke]=s?z.getPoleBuffers(s.canonical.z,!1):z.getPoleBuffers(0,!0),Oe=v.paint.get("raster-elevation");let et;m?(et=Ee,c.renderDefaultNorthPole=0!==Oe):(et=De,c.renderDefaultSouthPole=0!==Oe);const qe=Br(E.mix),ot=(Ct=ve,He=we,st=W,Be=h.ag(c.transform.zoom),rt=v,Je=Oe,Ft=qe,zt=E.offset,Bt=E.range,en=x,Pm(Ct,He,st,new Float32Array(16),new Float32Array(9),[0,0],Be,[0,0],[0,0,0,0],1,{opacity:1,mix:0},rt,[0,0],Je,2,Ft,zt,Bt,1,0,en)),lt=c.getOrCreateProgram("raster",{defines:fe});var Ct,He,st,Be,rt,Je,Ft,zt,Bt,en;c.uploadCommonUniforms(ne,lt,null),lt.draw(c,J.TRIANGLES,be,F,se,R,ot,v.id,et,Me,ke)}function eu(m){const s=m._nearZ,c=m.projection.farthestPixelDistance(m),_=c-s,v=.2*m.height,x=s+v;return[s,c,(x-v-s)/_,(x-s)/_]}function ps(m,s,c,_){if(m)return s instanceof ca&&m instanceof ua?s.getTextureDescriptor(m,c,!0):{texture:m.texture,mix:Br(_.mix),offset:_.offset,buffer:0,tileSize:1}}var p_=h.dd([{name:"a_index",type:"Int16",components:1}]);class mf{constructor(s,c,_,v){const x={width:_[0],height:_[1],data:null},E=s.gl;this.targetColorTexture=new h.T(s,x,E.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new h.T(s,x,E.RGBA8,{useMipmap:!1}),this.context=s,this.updateParticleTexture(c,v),this.lastInvalidatedAt=0}updateParticleTexture(s,c){if(this.particleTextureDimension===c.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const _=this.context.gl,v=c.width*c.height;this.particleTexture0=new h.T(this.context,c,_.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new h.T(this.context,c,_.RGBA8,{premultiply:!1,useMipmap:!1});const x=new h.de;x.reserve(v);for(let E=0;E<v;E++)x.emplaceBack(E);this.particleIndexBuffer=this.context.createVertexBuffer(x,p_.members,!0),this.particleSegment=h.b8.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=c.width}update(s){return!(this.lastInvalidatedAt<s&&(this.lastInvalidatedAt=h.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Fv(m,s,c){if(!m)return null;const _=s.getTextureDescriptor(m,c,!0);if(!_)return null;let{texture:v,mix:x,offset:E,tileSize:R,buffer:F,format:N}=_;if(!v||!N)return null;let z=!1;return"uint32"===N&&(z=!0,x[3]=0,x=Zt(h.df,x,[0,c.paint.get("raster-particle-max-speed")]),E=Cc(h.df,E,[0,c.paint.get("raster-particle-max-speed")])),{texture:v,textureOffset:[F/(R+2*F),R/(R+2*F)],tileSize:R,scalarData:z,scale:x,offset:E,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[N]]}}function Ua(m){const s=m._nearZ,c=m.projection.farthestPixelDistance(m),_=c-s,v=.2*m.height,x=s+v;return[s,c,(x-v-s)/_,(x-s)/_]}const Qu=new h.al(1,0,0,1),f_=new h.al(0,1,0,1),Lv=new h.al(0,0,1,1),Zh=new h.al(1,0,1,1),Xh=new h.al(0,1,1,1);function ja(m,s,c,_,v,x,E){const R=m.context,F=m.transform,N=R.gl,z="globe"===F.projection.name,U=z?["PROJECTION_GLOBE_VIEW"]:[];let j=h.ad.mat4.clone(c.projMatrix);if(z&&h.ag(F.zoom)>0){const qe=h.bb(c.canonical,F),ot=h.dg(qe);j=h.ad.mat4.multiply(new Float32Array(16),F.globeMatrix,ot),h.ad.mat4.multiply(j,F.projMatrix,j)}const W=h.ad.mat4.create();W[12]+=2*v/(h.q.devicePixelRatio*F.width),W[13]+=2*x/(h.q.devicePixelRatio*F.height),h.ad.mat4.multiply(j,W,j);const ne=m.getOrCreateProgram("debug",{defines:U}),J=s.getTileByID(c.key);m.terrain&&m.terrain.setupElevationDraw(J,ne);const oe=cn.disabled,se=Rn.disabled,fe=m.colorModeForRenderPass();R.activeTexture.set(N.TEXTURE0),m.emptyTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),z?J._makeGlobeTileDebugBuffers(m.context,F):J._makeDebugTileBoundsBuffers(m.context,F.projection);const ve=J._tileDebugBuffer||m.debugBuffer,we=J._tileDebugIndexBuffer||m.debugIndexBuffer,Ee=J._tileDebugSegments||m.debugSegments;if(ne.draw(m,N.LINE_STRIP,oe,se,fe,Mn.disabled,ma(j,_),"$debug",ve,we,Ee,null,null,null,[J._globeTileDebugBorderBuffer]),E){const qe=J.latestRawTileData,ot=Math.floor((qe&&qe.byteLength||0)/1024);let lt=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(lt+=` => ${c.overscaledZ}`),lt+=` ${J.state}`,lt+=` ${ot}kb`,function(Ct,He){Ct.initDebugOverlayCanvas();const st=Ct.debugOverlayCanvas,Be=Ct.context.gl,at=Ct.debugOverlayCanvas.getContext("2d");at.clearRect(0,0,st.width,st.height),at.shadowColor="white",at.shadowBlur=2,at.lineWidth=1.5,at.strokeStyle="white",at.textBaseline="top",at.font="bold 36px Open Sans, sans-serif",at.fillText(He,5,5),at.strokeText(He,5,5),Ct.debugOverlayTexture.update(st),Ct.debugOverlayTexture.bind(Be.LINEAR,Be.CLAMP_TO_EDGE)}(m,lt)}const De=s.getTile(c).tileSize,Me=512/Math.min(De,512)*(c.overscaledZ/F.zoom)*.5,ke=J._tileDebugTextBuffer||m.debugBuffer,Oe=J._tileDebugTextIndexBuffer||m.quadTriangleIndexBuffer,et=J._tileDebugTextSegments||m.debugSegments;ne.draw(m,N.TRIANGLES,oe,se,ei.alphaBlended,Mn.disabled,ma(j,h.al.transparent,Me),"$debug",ke,Oe,et,null,null,null,[J._globeTileDebugTextBuffer])}function Kh(m,s,c,_){Js(m,0,s+c/2,m.transform.width,c,_)}function gf(m,s,c,_){Js(m,s-c/2,0,c,m.transform.height,_)}function Js(m,s,c,_,v,x){const E=m.context,R=E.gl;R.enable(R.SCISSOR_TEST),R.scissor(s*h.q.devicePixelRatio,c*h.q.devicePixelRatio,_*h.q.devicePixelRatio,v*h.q.devicePixelRatio),E.clear({color:x}),R.disable(R.SCISSOR_TEST)}const Qh=h.dd([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:tu}=Qh;function ld(m,s,c,_){m.emplaceBack(s,c,_)}class xi{constructor(s){this.vertexArray=new h.dh,this.indices=new h.aV,ld(this.vertexArray,-1,-1,1),ld(this.vertexArray,1,-1,1),ld(this.vertexArray,-1,1,1),ld(this.vertexArray,1,1,1),ld(this.vertexArray,-1,-1,-1),ld(this.vertexArray,1,-1,-1),ld(this.vertexArray,-1,1,-1),ld(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=s.createVertexBuffer(this.vertexArray,tu),this.indexBuffer=s.createIndexBuffer(this.indices),this.segment=h.b8.simpleSegment(0,0,36,12)}}function go(m,s,c,_,v,x){const E=m.context.gl,R=s.paint.get("sky-atmosphere-color"),F=s.paint.get("sky-atmosphere-halo-color"),N=s.paint.get("sky-atmosphere-sun-intensity"),z={u_matrix_3f:h.ad.mat3.fromMat4(h.ad.mat3.create(),_),u_sun_direction:v,u_sun_intensity:N,u_color_tint_r:[(ne=R).r,ne.g,ne.b,ne.a],u_color_tint_m:[(J=F).r,J.g,J.b,J.a],u_luminance:5e-5};var ne,J;E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_CUBE_MAP_POSITIVE_X+x,s.skyboxTexture,0),c.draw(m,E.TRIANGLES,cn.disabled,Rn.disabled,ei.unblended,Mn.frontCW,z,"skyboxCapture",s.skyboxGeometry.vertexBuffer,s.skyboxGeometry.indexBuffer,s.skyboxGeometry.segment)}const m_=h.dd([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Ju{constructor(s){const c=new h.di;c.emplaceBack(-1,1,1,0,0),c.emplaceBack(1,1,1,1,0),c.emplaceBack(1,-1,1,1,1),c.emplaceBack(-1,-1,1,0,1);const _=new h.aV;_.emplaceBack(0,1,2),_.emplaceBack(2,3,0),this.vertexBuffer=s.createVertexBuffer(c,m_.members),this.indexBuffer=s.createIndexBuffer(_),this.segments=h.b8.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const fr=h.dd([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class ki{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Nv{constructor(s){this.colorModeAlphaBlendedWriteRGB=new ei([1,771,1,771],h.al.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new ei([1,0,1,0],h.al.transparent,[!1,!1,!1,!0]),this.params=new ki,this.updateNeeded=!0,s.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),s.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),s.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),s.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(s){const c=s.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Ju(c);const _=this.params.sizeRange,v=this.params.intensityRange,x=function(z){const U=h.dl(30),j=[];for(let W=0;W<z;++W){const ne=2*Math.PI*U(),J=Math.acos(1-2*U())-.5*Math.PI;j.push(h.ad.vec3.fromValues(Math.cos(J)*Math.cos(ne),Math.cos(J)*Math.sin(ne),Math.sin(J)))}return j}(this.params.starsCount),E=h.dl(300),R=new h.dj,F=new h.aV;let N=0;for(let z=0;z<x.length;++z){const U=h.ad.vec3.scale([],x[z],200),j=Math.max(0,1+.01*_*(1*E()-.5)),W=Math.max(0,1+.01*v*(1*E()-.5));R.emplaceBack(U[0],U[1],U[2],-1,-1,j,W),R.emplaceBack(U[0],U[1],U[2],1,-1,j,W),R.emplaceBack(U[0],U[1],U[2],1,1,j,W),R.emplaceBack(U[0],U[1],U[2],-1,1,j,W),F.emplaceBack(N+0,N+1,N+2),F.emplaceBack(N+0,N+2,N+3),N+=4}this.starsVx=c.createVertexBuffer(R,fr.members),this.starsIdx=c.createIndexBuffer(F),this.starsSegments=h.b8.simpleSegment(0,0,R.length,F.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(s,c){const _=s.context,v=_.gl,x=s.transform,E=new cn(v.LEQUAL,cn.ReadOnly,[0,1]),R=h.ag(x.zoom),F=s.style.getLut(c.scope),N="none"===c.properties.get("color-use-theme"),z=c.properties.get("color").toRenderColor(N?null:F).toArray01(),U="none"===c.properties.get("high-color-use-theme"),j=c.properties.get("high-color").toRenderColor(U?null:F).toArray01(),W="none"===c.properties.get("space-color-use-theme"),ne=c.properties.get("space-color").toRenderColor(W?null:F).toArray01PremultipliedAlpha(),J=5e-4,oe=h.dk(c.properties.get("horizon-blend"),0,1,J,.25),se=h.cD(s,_,x)&&oe===J?x.worldSize/(2*Math.PI*1.025)-1:x.globeRadius,fe=s.frameCounter/1e3%1,be=h.ad.vec3.length(x.globeCenterInViewSpace),ve=Math.sqrt(Math.pow(be,2)-Math.pow(se,2)),we=Math.acos(ve/be),Ee=De=>{const Me="globe"===x.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];De&&Me.push("ALPHA_PASS");const ke=s.getOrCreateProgram("globeAtmosphere",{defines:Me}),Oe=((qe,ot,lt,Ct,He,st,Be,at,rt,$e,Je,dt)=>({u_frustum_tl:qe,u_frustum_tr:ot,u_frustum_br:lt,u_frustum_bl:Ct,u_horizon:He,u_transition:st,u_fadeout_range:Be,u_color:at,u_high_color:rt,u_space_color:$e,u_temporal_offset:Je,u_horizon_angle:dt}))(x.frustumCorners.TL,x.frustumCorners.TR,x.frustumCorners.BR,x.frustumCorners.BL,x.frustumCorners.horizon,R,oe,z,j,ne,fe,we);s.uploadCommonUniforms(_,ke);const et=this.atmosphereBuffer;et&&ke.draw(s,v.TRIANGLES,E,Rn.disabled,De?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Mn.backCW,Oe,De?"atmosphere_glow_alpha":"atmosphere_glow",et.vertexBuffer,et.indexBuffer,et.segments)};Ee(!1),Ee(!0)}drawStars(s,c){const _=h.ay(c.properties.get("star-intensity"),0,1);if(0===_)return;const v=s.context,x=v.gl,E=s.transform,R=s.getOrCreateProgram("stars"),F=h.ad.quat.identity([]);h.ad.quat.rotateX(F,F,-E._pitch),h.ad.quat.rotateZ(F,F,-E.angle),h.ad.quat.rotateX(F,F,h.ak(E._center.lat)),h.ad.quat.rotateY(F,F,-h.ak(E._center.lng));const N=h.ad.mat4.fromQuat(new Float32Array(16),F),z=h.ad.mat4.multiply([],E.starsProjMatrix,N),U=h.ad.mat3.fromMat4([],N),j=h.ad.mat3.invert([],U),W=[0,1,0];h.ad.vec3.transformMat3(W,W,j),h.ad.vec3.scale(W,W,this.params.sizeMultiplier);const ne=[1,0,0];h.ad.vec3.transformMat3(ne,ne,j),h.ad.vec3.scale(ne,ne,this.params.sizeMultiplier);const J=(oe=W,se=ne,fe=_,{u_matrix:Float32Array.from(z),u_up:oe,u_right:se,u_intensity_multiplier:fe});var oe,se,fe;s.uploadCommonUniforms(v,R),this.starsVx&&this.starsIdx&&R.draw(s,x.TRIANGLES,cn.disabled,Rn.disabled,this.colorModeAlphaBlendedWriteRGB,Mn.disabled,J,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Yl(m,s){const c=[...m],_=s.cameraWorldSizeForFog/s.worldSize,v=h.ad.mat4.identity([]);return h.ad.mat4.scale(v,v,[_,_,1]),h.ad.mat4.multiply(c,v,c),h.ad.mat4.multiply(c,s.worldToFogMatrix,c),c}function gl(m,s,c,_,v){const x=c.material,E=_.context,{baseColorTexture:R,metallicRoughnessTexture:F}=x.pbrMetallicRoughness,{normalTexture:N,occlusionTexture:z,emissionTexture:U}=x;function j(ne,J,oe){if(ne&&(m.push(J),E.activeTexture.set(E.gl.TEXTURE0+oe),ne.gfxTexture)){const{minFilter:se,magFilter:fe,wrapS:be,wrapT:ve}=ne.sampler;ne.gfxTexture.bindExtraParam(se,fe,be,ve)}}j(R,"HAS_TEXTURE_u_baseColorTexture",Hr_BaseColor),j(F,"HAS_TEXTURE_u_metallicRoughnessTexture",Hr_MetallicRoughness),j(N,"HAS_TEXTURE_u_normalTexture",Hr_Normal),j(z,"HAS_TEXTURE_u_occlusionTexture",Hr_Occlusion),j(U,"HAS_TEXTURE_u_emissionTexture",Hr_Emission),v&&(v.texture||(v.texture=new h.dn(_.context,v.image,[v.image.height,v.image.height,v.image.height],E.gl.RGBA8)),E.activeTexture.set(E.gl.TEXTURE0+Hr_LUT),v.texture&&v.texture.bind(E.gl.LINEAR,E.gl.CLAMP_TO_EDGE),m.push("APPLY_LUT_ON_GPU")),c.texcoordBuffer&&(m.push("HAS_ATTRIBUTE_a_uv_2f"),s.push(c.texcoordBuffer)),c.colorBuffer&&(m.push(12===c.colorBuffer.itemSize?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),s.push(c.colorBuffer)),c.normalBuffer&&(m.push("HAS_ATTRIBUTE_a_normal_3f"),s.push(c.normalBuffer)),c.pbrBuffer&&(m.push("HAS_ATTRIBUTE_a_pbr"),m.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),s.push(c.pbrBuffer)),"OPAQUE"!==x.alphaMode&&"MASK"!==x.alphaMode||m.push("UNPREMULT_TEXTURE_IN_SHADER"),x.defined||m.push("DIFFUSE_SHADED");const W=_.shadowRenderer;W&&(m.push("RENDER_SHADOWS","DEPTH_TEXTURE"),W.useNormalOffset&&m.push("NORMAL_OFFSET"))}function cd(m,s,c,_,v,x){const E=c.paint.get("model-opacity").constantOr(1),R=s.context,F=new cn(s.context.gl.LEQUAL,cn.ReadWrite,s.depthRangeFor3D),N=s.transform,z=m.mesh,U=z.material,j=U.pbrMetallicRoughness,W=s.style.fog;let ne;ne="pixels"===s.transform.projection.zAxisUnit?[...m.nodeModelMatrix]:h.ad.mat4.multiply([],_.zScaleMatrix,m.nodeModelMatrix),h.ad.mat4.multiply(ne,_.negCameraPosMatrix,ne);const J=h.ad.mat4.invert([],ne);h.ad.mat4.transpose(J,J);const oe="none"===c.paint.get("model-color-use-theme").constantOr("default"),se=c.paint.get("model-emissive-strength").constantOr(0),fe=kv(new Float32Array(m.worldViewProjection),new Float32Array(ne),new Float32Array(J),null,s,E,j.baseColorFactor.toRenderColor(null),U.emissiveFactor,j.metallicFactor,j.roughnessFactor,U,se,c),be={defines:[]},ve=[],we=s.shadowRenderer;we&&(we.useNormalOffset=!1),gl(be.defines,ve,z,s,oe?null:c.lut);let Ee=null;if(W){const ke=Yl(m.nodeModelMatrix,s.transform);if(Ee=new Float32Array(ke),"globe"!==N.projection.name){const Oe=z.aabb.min,et=z.aabb.max,[qe,ot]=W.getOpacityForBounds(ke,Oe[0],Oe[1],et[0],et[1]);be.overrideFog=qe>=Yt||ot>=Yt}}const De=Qc(s,c.paint.get("model-cutoff-fade-range"));De.shouldRenderCutoff&&be.defines.push("RENDER_CUTOFF");const Me=s.getOrCreateProgram("model",be);s.uploadCommonUniforms(R,Me,null,Ee,De),"shadow"!==s.renderPass&&we&&we.setupShadowsFromMatrix(m.nodeModelMatrix,Me),Me.draw(s,R.gl.TRIANGLES,F,v,x,z.material.doubleSided?Mn.disabled:Mn.backCCW,fe,c.id,z.vertexBuffer,z.indexBuffer,z.segments,c.paint,s.transform.zoom,void 0,ve)}function eh(m,s,c,_,v,x,E){let R;R="globe"===m.projection.name?h.dp(c,m):[...c],h.ad.mat4.multiply(R,R,s.matrix);const F=h.ad.mat4.multiply([],_,R);if(s.meshes)for(const N of s.meshes){if("BLEND"!==N.material.alphaMode){E.push({mesh:N,depth:0,modelIndex:v,worldViewProjection:F,nodeModelMatrix:R});continue}const z=h.ad.vec3.transformMat4([],N.centroid,F);!m.isOrthographic&&z[2]<=0||x.push({mesh:N,depth:z[2],modelIndex:v,worldViewProjection:F,nodeModelMatrix:R})}if(s.children)for(const N of s.children)eh(m,N,c,_,v,x,E)}function _f(m,s,c,_){const v=c.shadowRenderer;if(!v)return;const x=v.getShadowPassDepthMode(),E=v.getShadowPassColorMode(),R=v.calculateShadowPassMatrixFromMatrix(s),F=Cx(R);c.getOrCreateProgram("modelDepth",{defines:c._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(c,c.context.gl.TRIANGLES,x,Rn.disabled,E,Mn.backCCW,F,_.id,m.vertexBuffer,m.indexBuffer,m.segments,_.paint,c.transform.zoom,void 0,void 0)}function g_(m,s,c){const _=s.updateZoomBasedPaintProperties(),v=function(x,E,R){let F,N,z,U=x.terrain?x.terrain.exaggeration():0;if(x.terrain&&U>0){const j=x.terrain,W=j.findDEMTileFor(R);W&&W.dem?F=h.dr.create(j,R,W):U=0}if(0===U&&(E.terrainElevationMin=0,E.terrainElevationMax=0),U===E.validForExaggeration&&(0===U||F&&F._demTile&&F._demTile.tileID===E.validForDEMTile.id&&F._dem._timestamp===E.validForDEMTile.timestamp))return!1;for(const j in E.instancesPerModel){const W=E.instancesPerModel[j];for(let ne=0;ne<W.instancedDataArray.length;++ne){const J=(F?U*F.getElevationAt(0|W.instancedDataArray.float32[16*ne],0|W.instancedDataArray.float32[16*ne+1],!0,!0):0)+W.instancesEvaluatedElevation[ne];W.instancedDataArray.float32[16*ne+6]=J,N=N?Math.min(E.terrainElevationMin,J):J,z=z?Math.max(E.terrainElevationMax,J):J}}return E.terrainElevationMin=N||0,E.terrainElevationMax=z||0,E.validForExaggeration=U,E.validForDEMTile=F&&F._demTile?{id:F._demTile.tileID,timestamp:F._dem._timestamp}:{id:void 0,timestamp:0},!0}(m,s,c);(_||v)&&(s.uploaded=!1,s.upload(m.context))}const _l={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new h.ce([0,0,0],[h.ai,h.ai,0])};function xt(m,s){const c=1<<m.canonical.z,_=s.getFreeCameraOptions().position,v=s.elevation,x=m.canonical.x/c,E=(m.canonical.x+1)/c,R=m.canonical.y/c,F=(m.canonical.y+1)/c;let N=s._centerAltitude;if(v){const W=v.getMinMaxForTile(m);W&&W.max>N&&(N=W.max)}const z=h.ay(_.x,x,E)-_.x,U=h.ay(_.y,R,F)-_.y,j=h.bH(N,s.center.lat)-_.z;return s._zoomFromMercatorZ(Math.sqrt(z*z+U*U+j*j))}function Wn(m,s,c,_,v,x,E){const R=m.context,F="shadow"===m.renderPass,N=m.shadowRenderer,z=F&&N?N.getShadowPassDepthMode():new cn(R.gl.LEQUAL,cn.ReadWrite,m.depthRangeFor3D),U=m.isTileAffectedByFog(x);if(c.meshes)for(const j of c.meshes){const W=["MODEL_POSITION_ON_GPU"],ne=[];let J,oe,se;_.instancedDataArray.length>20&&W.push("INSTANCED_ARRAYS");const fe=Qc(m,s.paint.get("model-cutoff-fade-range"));if(fe.shouldRenderCutoff&&W.push("RENDER_CUTOFF"),F&&N)J=m.getOrCreateProgram("modelDepth",{defines:W}),oe=Cx(E.shadowTileMatrix,E.shadowTileMatrix,Float32Array.from(c.matrix)),se=N.getShadowPassColorMode();else{gl(W,ne,j,m,"none"===s.paint.get("model-color-use-theme").constantOr("default")?null:s.lut),J=m.getOrCreateProgram("model",{defines:W,overrideFog:U});const ve=j.material,we=ve.pbrMetallicRoughness,Ee=s.paint.get("model-opacity").constantOr(1),De=s.paint.get("model-emissive-strength").constantOr(0);oe=kv(x.expandedProjMatrix,Float32Array.from(c.matrix),new Float32Array(16),null,m,Ee,we.baseColorFactor.toRenderColor(null),ve.emissiveFactor,we.metallicFactor,we.roughnessFactor,ve,De,s,v),N&&(E.shadowUniformsInitialized?J.setShadowUniformValues(R,N.getShadowUniformValues()):(N.setupShadows(x.toUnwrapped(),J,"model-tile",x.overscaledZ),E.shadowUniformsInitialized=!0)),se=fe.shouldRenderCutoff||Ee<1||"OPAQUE"!==ve.alphaMode?ei.alphaBlended:ei.unblended}m.uploadCommonUniforms(R,J,x.toUnwrapped(),null,fe);const be=j.material.doubleSided?Mn.disabled:Mn.backCCW;if(_.instancedDataArray.length>20)ne.push(_.instancedDataBuffer),J.draw(m,R.gl.TRIANGLES,z,Rn.disabled,se,be,oe,s.id,j.vertexBuffer,j.indexBuffer,j.segments,s.paint,m.transform.zoom,void 0,ne,_.instancedDataArray.length);else{const ve=F?"u_instance":"u_normal_matrix";for(let we=0;we<_.instancedDataArray.length;++we)oe[ve]=new Float32Array(_.instancedDataArray.arrayBuffer,64*we,16),J.draw(m,R.gl.TRIANGLES,z,Rn.disabled,se,be,oe,s.id,j.vertexBuffer,j.indexBuffer,j.segments,s.paint,m.transform.zoom,void 0,ne)}}if(c.children)for(const j of c.children)Wn(m,s,j,_,v,x,E)}const on=[1,-1,1];function ln(m,s,c,_){if(!c.modelManager)return!0;const v=c.modelManager;if(!c.shadowRenderer)return!0;const x=c.shadowRenderer,E=s.aabb;let R=!0,F=m.maxHeight;if(0===F){let z=0;for(const U in m.instancesPerModel){const j=v.getModel(U,_);j?z=Math.max(z,Math.max(Math.max(j.aabb.max[0],j.aabb.max[1]),j.aabb.max[2])):R=!1}F=m.maxScale*z*1.41+m.maxVerticalOffset,R&&(m.maxHeight=F)}E.max[2]=F,E.min[2]+=m.terrainElevationMin,E.max[2]+=m.terrainElevationMax,h.ad.vec3.transformMat4(E.min,E.min,s.tileMatrix),h.ad.vec3.transformMat4(E.max,E.max,s.tileMatrix);const N=E.intersects(x.getCurrentCascadeFrustum());return 0===c.currentShadowCascade&&(m.isInsideFirstShadowMapFrustum=2===N),0===N}function Zi(m,s){const c=m.uniformValues.u_cutoff_params[0],_=m.uniformValues.u_cutoff_params[1],v=m.uniformValues.u_cutoff_params[2],x=m.uniformValues.u_cutoff_params[3];return _===c||x===v?1:h.ay(((s-c)/(_-c)-v)/(x-v),0,1)}function Lm(m,s,c,_){if(s.pitch<20)return 1;const v=s.getWorldToCameraMatrix();h.ad.mat4.multiply(v,v,m);const x=h.ad.vec4.fromValues(c.min[0],c.min[1],c.min[2],1);let E=h.ad.vec4.transformMat4(h.ad.vec4.create(),x,v),R=E,F=E;x[1]=c.max[1],E=h.ad.vec4.transformMat4(h.ad.vec4.create(),x,v),R=E[1]<R[1]?E:R,F=E[1]>F[1]?E:F,x[0]=c.max[0],E=h.ad.vec4.transformMat4(h.ad.vec4.create(),x,v),R=E[1]<R[1]?E:R,F=E[1]>F[1]?E:F,x[1]=c.min[1],E=h.ad.vec4.transformMat4(h.ad.vec4.create(),x,v),R=E[1]<R[1]?E:R,F=E[1]>F[1]?E:F;const N=h.ay(_[0],0,1),z=100*s.pixelsPerMeter*h.ay(_[1],0,1),U=h.ay(_[2],0,1),j=h.ad.vec4.lerp(h.ad.vec4.create(),R,F,N),W=Math.tan(.5*s.fovX),ne=-j[2]*W;if(0===z)return j[1]<-Math.abs(ne)?U:1;const J=(-Math.abs(ne)-j[1])/z,oe=(fe,be,ve)=>(1-ve)*fe+ve*be,se=h.ay(oe(1,U,J),U,1);return oe(1,se,h.ay((s.pitch-20)/20,0,1))}class th{}class Is{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(s,c,_){{const U=this._storage.get(c.id);if(U)return U.lastUsedFrameIdx=s,U.buf}const v=_.gl,x=v.getBufferParameter(v.ELEMENT_ARRAY_BUFFER,v.BUFFER_SIZE),E=new ArrayBuffer(x),R=new Int16Array(E);v.getBufferSubData(v.ELEMENT_ARRAY_BUFFER,0,new Int16Array(E));const F=new h.dt;for(let U=0;U<x/2;U+=3){const j=R[U],W=R[U+1],ne=R[U+2];F.emplaceBack(j,W),F.emplaceBack(W,ne),F.emplaceBack(ne,j)}const N=_.bindVertexArrayOES.current,z=new th;return z.buf=new df(_,F),z.lastUsedFrameIdx=s,this._storage.set(c.id,z),_.bindVertexArrayOES.set(N),z.buf}update(s){for(const[c,_]of this._storage)s-_.lastUsedFrameIdx>30&&(_.buf.destroy(),this._storage.delete(c))}destroy(){for(const[s,c]of this._storage)c.buf.destroy(),this._storage.delete(s)}}class yf{constructor(s){this.occluderSize=30,this.depthOffset=-1e-4,s.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),s.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Ec=h.dd([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Nm{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class zm{constructor(s,c){this.revealStart=11,this.revealRange=2,s.registerParameter(this,[...c,"Reveal"],"revealStart",{min:0,max:17,step:.05}),s.registerParameter(this,[...c,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const zv=h.dd([{type:"Float32",name:"a_pos_2f",components:2}]);class Bm{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(s,c){const _=s.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const E=new h.du,R=new h.aV;E.emplaceBack(-1,-1),E.emplaceBack(1,-1),E.emplaceBack(1,1),E.emplaceBack(-1,1),R.emplaceBack(0,1,2),R.emplaceBack(0,2,3),this.vignetteVx=s.context.createVertexBuffer(E,zv.members),this.vignetteIdx=s.context.createIndexBuffer(R)}const v=h.b8.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){s.uploadCommonUniforms(s.context,_);const E={u_vignetteShape:(x={vignetteShape:[c.start,c.range,Math.pow(10,c.fadePower)],vignetteColor:[c.color.r,c.color.g,c.color.b,c.color.a*c.strength]}).vignetteShape,u_vignetteColor:x.vignetteColor};_.draw(s,s.context.gl.TRIANGLES,cn.disabled,Rn.disabled,ei.alphaBlended,Mn.disabled,E,"vignette",this.vignetteVx,this.vignetteIdx,v)}var x}}class Vo{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(s,c){const _=s.getFreeCameraOptions().position,v=_.toAltitude(),x=_.toLngLat(),E=h.ak(x.lng),R=h.ak(x.lat),F=s.pixelsPerMeter/c,N=E*h.dv,z=h.dv*Math.log(Math.tan(Math.PI/4+R/2));if(void 0===this._offsetXPrev)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const U=-this._offsetYPrev+z,j=-this._elevationPrev+v;this._accumulatedOffsetX+=(-this._offsetXPrev+N)*F,this._accumulatedOffsetY+=U*F,this._accumulatedElevation+=j*F,this._offsetXPrev=N,this._offsetYPrev=z,this._elevationPrev=v}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function nh(m,s){return[-(m[0]-Math.floor(m[0]/s)*s),-(m[1]-Math.floor(m[1]/s)*s),-(m[2]-Math.floor(m[2]/s)*s)]}function fs(m){const s=h.dl(1323123451230),c=[];for(let _=0;_<m;++_){const v=2*s()-1,x=2*s()-1,E=2*s()-1;c.push(h.ad.vec3.fromValues(v,x,E))}return c}function wo(m,s,c,_,v){const x=h.ay((v-c)/(_-c),0,1);return(1-x)*m+x*s}class vf{constructor(s){this._movement=new Vo,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Bm,this._ppmScaleFactor=s}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(s,c){const _=s.transform;this._movement.update(_,this._ppmScaleFactor);const v=_.starsProjMatrix,x=h.ad.quat.identity([]);h.ad.quat.rotateX(x,x,h.ak(90)-_._pitch),h.ad.quat.rotateZ(x,x,-_.angle);const E=h.ad.mat4.fromQuat(new Float32Array(16),x),R=h.ad.mat4.fromValues(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),F=h.ad.mat4.transpose([],R),N=h.ad.mat4.multiply([],F,E),z=Date.now()/1e3;return this._accumulatedTimeFromStart+=(z-this._prevTime)*c,this._prevTime=z,{projectionMatrix:v,modelviewMatrix:N}}}class ya extends vf{constructor(s){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new zm(s.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(s){const c=s.context;if(!this.particlesVx){const _=fs(this.particlesCount),v=new h.dw,x=new h.aV;let E=0;const R=h.dl(1323123451230);for(let F=0;F<_.length;++F){const N=_[F],z=[2*R()-1,R(),R(),R()];v.emplaceBack(N[0],N[1],N[2],-1,-1,...z),v.emplaceBack(N[0],N[1],N[2],1,-1,...z),v.emplaceBack(N[0],N[1],N[2],1,1,...z),v.emplaceBack(N[0],N[1],N[2],-1,1,...z),x.emplaceBack(E+0,E+1,E+2),x.emplaceBack(E+0,E+2,E+3),E+=4}this.particlesVx=c.createVertexBuffer(v,Ec.members),this.particlesIdx=c.createIndexBuffer(x)}}draw(s){if(!this._params.overrideStyleParameters&&!s.style.rain)return;const c=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},_=s.transform.zoom;if(c.revealStart>_)return;const v=wo(0,1,c.revealStart,c.revealStart+c.revealRange,_);if(!this.particlesVx||!this.particlesIdx)return;const x=structuredClone(this._params);let E=[-x.direction.x,x.direction.y,-100];h.ad.vec3.normalize(E,E);const R=structuredClone(this._vignetteParams);R.strength*=v,x.overrideStyleParameters||(x.intensity=s.style.rain.state.density,x.timeFactor=s.style.rain.state.intensity,x.color=structuredClone(s.style.rain.state.color),E=structuredClone(s.style.rain.state.direction),x.screenThinning.intensity=s.style.rain.state.centerThinning,x.dropletSizeX=s.style.rain.state.dropletSize[0],x.dropletSizeYScale=s.style.rain.state.dropletSize[1]/s.style.rain.state.dropletSize[0],x.distortionStrength=100*s.style.rain.state.distortionStrength,R.strength=1,R.color=structuredClone(s.style.rain.state.vignetteColor));const F=this.updateOnRender(s,x.timeFactor),N=s.context,z=N.gl,U=s.transform;this.screenTexture&&this.screenTexture.size[0]===s.width&&this.screenTexture.size[1]===s.height||(this.screenTexture=new h.T(N,{width:s.width,height:s.height,data:null},z.RGBA8)),x.distortionStrength>0&&(N.activeTexture.set(z.TEXTURE0),this.screenTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),z.copyTexSubImage2D(z.TEXTURE_2D,0,0,0,0,0,s.width,s.height));const j=s.getOrCreateProgram("rainParticle");s.uploadCommonUniforms(N,j),N.activeTexture.set(z.TEXTURE0),this.screenTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE);const W=[x.color.r,x.color.g,x.color.b,x.color.a],ne=(J,oe)=>{const se=nh(this._movement.getPosition(),J),fe=x.dropletSizeX,be=x.dropletSizeX*x.dropletSizeYScale,ve=s.width/2,we=s.height/2,Ee=wo(0,x.screenThinning.start,0,1,x.screenThinning.intensity),De=wo(.001,x.screenThinning.range,0,1,x.screenThinning.intensity),Me=wo(0,x.screenThinning.particleOffset,0,1,x.screenThinning.intensity),ke=(Oe={modelview:F.modelviewMatrix,projection:F.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:se,velocityConeAperture:x.velocityConeAperture,velocity:x.velocity,boxSize:J,rainDropletSize:[fe,be],distortionStrength:x.distortionStrength,rainDirection:E,color:W,screenSize:[U.width,U.height],thinningCenterPos:[ve,we],thinningShape:[Ee,De,Math.pow(10,x.screenThinning.fadePower)],thinningAffectedRatio:x.screenThinning.affectedRatio,thinningParticleOffset:Me,shapeDirectionalPower:x.shapeDirPower,shapeNormalPower:x.shapeNormalPower,mode:oe?0:1},{u_modelview:Float32Array.from(Oe.modelview),u_projection:Float32Array.from(Oe.projection),u_time:Oe.time,u_cam_pos:Oe.camPos,u_texScreen:0,u_velocityConeAperture:Oe.velocityConeAperture,u_velocity:Oe.velocity,u_boxSize:Oe.boxSize,u_rainDropletSize:Oe.rainDropletSize,u_distortionStrength:Oe.distortionStrength,u_rainDirection:Oe.rainDirection,u_color:Oe.color,u_screenSize:Oe.screenSize,u_thinningCenterPos:Oe.thinningCenterPos,u_thinningShape:Oe.thinningShape,u_thinningAffectedRatio:Oe.thinningAffectedRatio,u_thinningParticleOffset:Oe.thinningParticleOffset,u_shapeDirectionalPower:Oe.shapeDirectionalPower,u_shapeNormalPower:Oe.shapeNormalPower,u_mode:Oe.mode});var Oe;const et=Math.round(x.intensity*this.particlesCount),qe=h.b8.simpleSegment(0,0,4*et,2*et);j.draw(s,z.TRIANGLES,cn.disabled,Rn.disabled,ei.alphaBlended,Mn.disabled,ke,"rain_particles",this.particlesVx,this.particlesIdx,qe)};x.distortionStrength>0&&ne(x.boxSize,!0),ne(x.boxSize,!1),this._vignette.draw(s,R)}}const Zl=h.dd([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Jh extends vf{constructor(s){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new zm(s.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(s){const c=s.context;if(!this.particlesVx){const _=fs(this.particlesCount),v=new h.dx,x=new h.aV;let E=0;const R=h.dl(1323123451230);for(let F=0;F<_.length;++F){const N=_[F],z=R(),U=R(),j=R(),W=[F/_.length,z,U,j],ne=[R(),R()];v.emplaceBack(N[0],N[1],N[2],-1,-1,...W,...ne),v.emplaceBack(N[0],N[1],N[2],1,-1,...W,...ne),v.emplaceBack(N[0],N[1],N[2],1,1,...W,...ne),v.emplaceBack(N[0],N[1],N[2],-1,1,...W,...ne),x.emplaceBack(E+0,E+1,E+2),x.emplaceBack(E+0,E+2,E+3),E+=4}this.particlesVx=c.createVertexBuffer(v,Zl.members),this.particlesIdx=c.createIndexBuffer(x)}}draw(s){if(!this._params.overrideStyleParameters&&!s.style.snow)return;const c=structuredClone(this._params);let _=[-c.direction.x,c.direction.y,-100];h.ad.vec3.normalize(_,_);const v=structuredClone(this._vignetteParams),x=c.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},E=s.transform.zoom;if(x.revealStart>E)return;const R=wo(0,1,x.revealStart,x.revealStart+x.revealRange,E);v.strength*=R,c.overrideStyleParameters||(c.intensity=s.style.snow.state.density,c.timeFactor=s.style.snow.state.intensity,c.color=structuredClone(s.style.snow.state.color),_=structuredClone(s.style.snow.state.direction),c.screenThinning.intensity=s.style.snow.state.centerThinning,c.billboardSize=2.79*s.style.snow.state.flakeSize,v.strength=1,v.color=structuredClone(s.style.snow.state.vignetteColor));const F=this.updateOnRender(s,c.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const N=s.context,z=N.gl,U=s.transform,j=s.getOrCreateProgram("snowParticle");s.uploadCommonUniforms(N,j),((W,ne,J)=>{const oe=nh(this._movement.getPosition(),W),se=U.width/2,fe=U.height/2,be=wo(0,J.screenThinning.start,0,1,J.screenThinning.intensity),ve=wo(.001,J.screenThinning.range,0,1,J.screenThinning.intensity),we=wo(0,J.screenThinning.particleOffset,0,1,J.screenThinning.intensity),Ee=(De={modelview:F.modelviewMatrix,projection:F.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:oe,velocityConeAperture:J.velocityConeAperture,velocity:J.velocity,horizontalOscillationRadius:J.horizontalOscillationRadius,horizontalOscillationRate:J.horizontalOscillationRate,boxSize:W,billboardSize:1*J.billboardSize,simpleShapeParameters:[J.shapeFadeStart,J.shapeFadePower],screenSize:[U.width,U.height],thinningCenterPos:[se,fe],thinningShape:[be,ve,Math.pow(10,J.screenThinning.fadePower)],thinningAffectedRatio:J.screenThinning.affectedRatio,thinningParticleOffset:we,color:[J.color.r,J.color.g,J.color.b,J.color.a],direction:_},{u_modelview:Float32Array.from(De.modelview),u_projection:Float32Array.from(De.projection),u_time:De.time,u_cam_pos:De.camPos,u_velocityConeAperture:De.velocityConeAperture,u_velocity:De.velocity,u_horizontalOscillationRadius:De.horizontalOscillationRadius,u_horizontalOscillationRate:De.horizontalOscillationRate,u_boxSize:De.boxSize,u_billboardSize:De.billboardSize,u_simpleShapeParameters:De.simpleShapeParameters,u_screenSize:De.screenSize,u_thinningCenterPos:De.thinningCenterPos,u_thinningShape:De.thinningShape,u_thinningAffectedRatio:De.thinningAffectedRatio,u_thinningParticleOffset:De.thinningParticleOffset,u_particleColor:De.color,u_direction:De.direction});var De;const Me=Math.round(J.intensity*this.particlesCount),ke=h.b8.simpleSegment(0,0,4*Me,2*Me);this.particlesVx&&this.particlesIdx&&j.draw(s,z.TRIANGLES,cn.disabled,Rn.disabled,ei.alphaBlended,Mn.disabled,Ee,"snow_particles",this.particlesVx,this.particlesIdx,ke)})(c.boxSize,0,c),this._vignette.draw(s,v)}}const ep={symbol:function(m,s,c,_,v){if("translucent"!==m.renderPass)return;const x=Rn.disabled,E=m.colorModeForRenderPass(),R=c.layout.get("text-variable-anchor"),F=c.layout.get("text-size-scale-range"),N=h.ay(m.scaleFactor,F[0],F[1]);R&&function(j,W,ne,J,oe,se,fe,be){const ve=W.transform,we="map"===oe,Ee="map"===se;for(const De of j){const Me=J.getTile(De),ke=Me.getBucket(ne);if(!ke||!ke.text||!ke.text.segments.get().length)continue;const Oe=h.bp(ke.textSizeData,ve.zoom,be),et=cl(De,ke.getProjection(),ve),qe=ve.calculatePixelsToTileUnitsMatrix(Me),ot=qc(et,Me.tileID.canonical,Ee,we,ve,ke.getProjection(),qe),lt=ke.hasIconTextFit()&&ke.hasIconData();if(Oe){const Ct=Math.pow(2,ve.zoom-Me.tileID.overscaledZ);ml(ke,we,Ee,fe,h.cY,ve,ot,De,Ct,Oe,lt)}}}(_,m,c,s,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),v,N);const z=0!==c.paint.get("icon-opacity").constantOr(1),U=0!==c.paint.get("text-opacity").constantOr(1);void 0!==c.layout.get("symbol-sort-key").constantOr(1)&&(z||U)?sr(m,s,c,_,x,E):(z&&sr(m,s,c,_,x,E,{onlyIcons:!0}),U&&sr(m,s,c,_,x,E,{onlyText:!0})),s.map.showCollisionBoxes&&(hf(m,s,c,_,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),hf(m,s,c,_,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(m,s,c,_){if("translucent"!==m.renderPass)return;const v=c.paint.get("circle-opacity"),x=c.paint.get("circle-stroke-width"),E=c.paint.get("circle-stroke-opacity"),R=void 0!==c.layout.get("circle-sort-key").constantOr(1),F=c.paint.get("circle-emissive-strength");if(0===v.constantOr(1)&&(0===x.constantOr(1)||0===E.constantOr(1)))return;const N=m.context,z=N.gl,U=m.transform,j=m.depthModeForSublayer(0,cn.ReadOnly),W=Rn.disabled,ne=m.colorModeForDrapableLayerRenderPass(F),J="globe"===U.projection.name,oe=[h.av(U.center.lng),h.aC(U.center.lat)],se=[];for(let be=0;be<_.length;be++){const ve=_[be],we=s.getTile(ve),Ee=we.getBucket(c);if(!Ee||Ee.projection.name!==U.projection.name)continue;const De=Ee.programConfigurations.get(c.id),Me=h.cZ(c),ke=m.isTileAffectedByFog(ve);J&&Me.push("PROJECTION_GLOBE_VIEW"),Me.push("DEPTH_D24"),m.terrain&&U.depthOcclusionForSymbolsAndCircles&&Me.push("DEPTH_OCCLUSION");const Oe=m.getOrCreateProgram("circle",{config:De,defines:Me,overrideFog:ke}),et=Ee.layoutVertexBuffer,qe=Ee.globeExtVertexBuffer,ot=Ee.indexBuffer,lt=U.projection.createInversionMatrix(U,ve.canonical),Ct={programConfiguration:De,program:Oe,layoutVertexBuffer:et,globeExtVertexBuffer:qe,indexBuffer:ot,uniformValues:h.c_(m,ve,we,lt,oe,c),tile:we};if(R){const He=Ee.segments.get();for(const st of He)se.push({segments:new h.b8([st]),sortKey:st.sortKey,state:Ct})}else se.push({segments:Ee.segments,sortKey:0,state:Ct})}R&&se.sort((be,ve)=>be.sortKey-ve.sortKey);const fe={useDepthForOcclusion:U.depthOcclusionForSymbolsAndCircles};for(const be of se){const{programConfiguration:ve,program:we,layoutVertexBuffer:Ee,globeExtVertexBuffer:De,indexBuffer:Me,uniformValues:ke,tile:Oe}=be.state,et=be.segments;m.terrain&&m.terrain.setupElevationDraw(Oe,we,fe),m.uploadCommonUniforms(N,we,Oe.tileID.toUnwrapped()),we.draw(m,z.TRIANGLES,j,W,ne,Mn.disabled,ke,c.id,Ee,Me,et,c.paint,U.zoom,ve,[De])}},heatmap:function(m,s,c,_){if(0!==c.paint.get("heatmap-opacity"))if("offscreen"===m.renderPass){const v=m.context,x=v.gl,E=Rn.disabled,R=new ei([x.ONE,x.ONE,x.ONE,x.ONE],h.al.transparent,[!0,!0,!0,!0]);(function(W,ne,J,oe){const se=W.gl,fe=ne.width*oe,be=ne.height*oe;W.activeTexture.set(se.TEXTURE1),W.viewport.set([0,0,fe,be]);let ve=J.heatmapFbo;if(!ve||ve&&(ve.width!==fe||ve.height!==be)){ve&&ve.destroy();const we=se.createTexture();se.bindTexture(se.TEXTURE_2D,we),se.texParameteri(se.TEXTURE_2D,se.TEXTURE_WRAP_S,se.CLAMP_TO_EDGE),se.texParameteri(se.TEXTURE_2D,se.TEXTURE_WRAP_T,se.CLAMP_TO_EDGE),se.texParameteri(se.TEXTURE_2D,se.TEXTURE_MIN_FILTER,se.LINEAR),se.texParameteri(se.TEXTURE_2D,se.TEXTURE_MAG_FILTER,se.LINEAR),ve=J.heatmapFbo=W.createFramebuffer(fe,be,!0,null),function(Ee,De,Me,ke,Oe,et){const qe=Ee.gl;qe.texImage2D(qe.TEXTURE_2D,0,Ee.extRenderToTextureHalfFloat?qe.RGBA16F:qe.RGBA,Oe,et,0,qe.RGBA,Ee.extRenderToTextureHalfFloat?qe.HALF_FLOAT:qe.UNSIGNED_BYTE,null),ke.colorAttachment.set(Me)}(W,0,we,ve,fe,be)}else se.bindTexture(se.TEXTURE_2D,ve.colorAttachment.get()),W.bindFramebuffer.set(ve.framebuffer)})(v,m,c,"globe"===m.transform.projection.name?.5:.25),v.clear({color:h.al.transparent});const F=m.transform,N="globe"===F.projection.name,z=N?["PROJECTION_GLOBE_VIEW"]:[],U=N?Mn.frontCCW:Mn.disabled,j=[h.av(F.center.lng),h.aC(F.center.lat)];for(let W=0;W<_.length;W++){const ne=_[W];if(s.hasRenderableParent(ne))continue;const J=s.getTile(ne),oe=J.getBucket(c);if(!oe||oe.projection.name!==F.projection.name)continue;const se=m.isTileAffectedByFog(ne),fe=oe.programConfigurations.get(c.id),be=m.getOrCreateProgram("heatmap",{config:fe,defines:z,overrideFog:se}),{zoom:ve}=m.transform;m.terrain&&m.terrain.setupElevationDraw(J,be),m.uploadCommonUniforms(v,be,ne.toUnwrapped());const we=F.projection.createInversionMatrix(F,ne.canonical);be.draw(m,x.TRIANGLES,cn.disabled,E,R,U,cf(m,ne,J,we,j,ve,c.paint.get("heatmap-intensity")),c.id,oe.layoutVertexBuffer,oe.indexBuffer,oe.segments,c.paint,m.transform.zoom,fe,N?[oe.globeExtVertexBuffer]:null)}v.viewport.set([0,0,m.width,m.height])}else"translucent"===m.renderPass&&(m.context.setColorMode(m.colorModeForRenderPass()),function(v,x){const E=v.context,R=E.gl,F=x.heatmapFbo;if(!F)return;E.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,F.colorAttachment.get()),E.activeTexture.set(R.TEXTURE1);let N=x.colorRampTexture;N||(N=x.colorRampTexture=new h.T(E,x.colorRamp,R.RGBA8)),N.bind(R.LINEAR,R.CLAMP_TO_EDGE),v.getOrCreateProgram("heatmapTexture").draw(v,R.TRIANGLES,cn.disabled,Rn.disabled,v.colorModeForRenderPass(),Mn.disabled,{u_image:0,u_color_ramp:1,u_opacity:x.paint.get("heatmap-opacity")},x.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,x.paint,v.transform.zoom)}(m,c))},line:function(m,s,c,_){if("translucent"!==m.renderPass)return;const v=c.paint.get("line-opacity"),x=c.paint.get("line-width");if(0===v.constantOr(1)||0===x.constantOr(1))return;const E=c.paint.get("line-emissive-strength"),R=c.paint.get("line-occlusion-opacity"),F=c.layout.get("line-elevation-reference"),N="meters"===c.layout.get("line-width-unit"),z="sea"===F,U=m.context,j=U.gl;if(c.hasElevatedBuckets&&"globe"===m.transform.projection.name)return;const W=c.layout.get("line-cross-slope"),ne=void 0!==W,J=W<1,oe=m.colorModeForDrapableLayerRenderPass(E),se=m.terrain&&m.terrain.renderingToTexture,fe=se?1:h.q.devicePixelRatio,be=c.paint.get("line-dasharray"),ve=be.constantOr(1),we=c.layout.get("line-cap"),Ee=be.constantOr(null),De=we.constantOr(null),Me=c.paint.get("line-pattern"),ke=Me.constantOr(1),Oe=Me.constantOr(null),et=c.paint.get("line-opacity").constantOr(1);let qe=!ke&&1!==et||m.depthOcclusion&&R>0&&R<1;const ot=c.paint.get("line-gradient"),lt=ke?"linePattern":"line",Ct=h.c$(c);let He;if(se&&m.terrain&&m.terrain.clipOrMaskOverlapStencilType()&&(qe=!1),0!==R&&m.depthOcclusion){const Be=c.paint._values["line-opacity"];Be&&Be.value&&"constant"===Be.value.kind?He=Be.value:h.w(`Occlusion opacity for layer ${c.id} is supported only when line-opacity isn't data-driven.`)}"constant"!==x.value.kind&&!1===x.value.isLineProgressConstant&&Ct.push("VARIABLE_LINE_WIDTH");const st=(Be,at,rt,$e,Je,dt)=>{for(const Ft of Be){const zt=s.getTile(Ft);if(ke&&!zt.patternsLoaded())continue;const Bt=zt.getBucket(c);if(!Bt||Bt.hasZOffset&&!Je||!Bt.hasZOffset&&Je)continue;m.prepareDrawTile();const en=Bt.programConfigurations.get(c.id),In=m.isTileAffectedByFog(Ft),wt=m.getOrCreateProgram(lt,{config:en,defines:at,overrideFog:In,overrideRtt:!Je&&void 0});if(Oe&&zt.imageAtlas){const An=h.d0.from(Oe).getPrimary().scaleSelf(fe).toString(),tn=zt.imageAtlas.patternPositions.get(An);tn&&en.setConstantPatternPositions(tn)}if(!ke&&Ee&&De&&zt.lineAtlas){const An=zt.lineAtlas.getDash(Ee,De);An&&en.setConstantPatternPositions(An)}let[Tn,vn]=c.paint.get("line-trim-offset");("round"===De||"square"===De)&&Tn!==vn&&(0===Tn&&(Tn-=1),1===vn&&(vn+=1));const di=se?Ft.projMatrix:null,Pi=N?1/Bt.tileToMeter/h.at(zt,1,m.transform.zoom):1,ar=N?1/Bt.tileToMeter/h.at(zt,1,Math.floor(m.transform.zoom)):1,Yn=ke?h.d1(m,zt,c,di,fe,Pi,ar,[Tn,vn]):h.d2(m,zt,c,di,Bt.lineClipsArray.length,fe,Pi,ar,[Tn,vn]);if(ot){const An=Bt.gradients[c.id];let tn=An.texture;if(c.gradientVersion!==An.version){let gi=256;if(c.stepInterpolant){const Vi=s.getSource().maxzoom,Ei=Ft.canonical.z===Vi?Math.ceil(1<<m.transform.maxZoom-Ft.canonical.z):1;gi=h.ay(h.d3(Bt.maxLineLength/h.ai*1024*Ei),256,U.maxTextureSize)}An.gradient=h.d4({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:gi,image:An.gradient||void 0,clips:Bt.lineClipsArray}),An.texture?An.texture.update(An.gradient):An.texture=new h.T(U,An.gradient,j.RGBA8),An.version=c.gradientVersion,tn=An.texture}U.activeTexture.set(j.TEXTURE1),tn.bind(c.stepInterpolant?j.NEAREST:j.LINEAR,j.CLAMP_TO_EDGE)}ve&&(U.activeTexture.set(j.TEXTURE0),zt.lineAtlasTexture&&zt.lineAtlasTexture.bind(j.LINEAR,j.REPEAT),en.updatePaintBuffers()),ke&&(U.activeTexture.set(j.TEXTURE0),zt.imageAtlasTexture&&zt.imageAtlasTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),en.updatePaintBuffers()),Je&&!z&&m.terrain.setupElevationDraw(zt,wt),m.uploadCommonUniforms(U,wt,Ft.toUnwrapped());const xr=An=>{null!=He&&(He.value=et*R),wt.draw(m,j.TRIANGLES,rt,An,oe,Mn.disabled,Yn,c.id,Bt.layoutVertexBuffer,Bt.indexBuffer,Bt.segments,c.paint,m.transform.zoom,en,[Bt.layoutVertexBuffer2,Bt.patternVertexBuffer,Bt.zOffsetVertexBuffer]),null!=He&&(He.value=et)};if(qe&&!Je){const An=m.stencilModeForClipping(Ft).ref;0===An&&se&&U.clear({stencil:0});const tn={func:j.EQUAL,mask:255};Yn.u_alpha_discard_threshold=.8,xr(new Rn(tn,An,255,j.KEEP,j.KEEP,j.INVERT)),Yn.u_alpha_discard_threshold=0,xr(new Rn(tn,An,255,j.KEEP,j.KEEP,j.KEEP))}else Yn.u_alpha_discard_threshold=qe&&Je&&dt?.8:0,xr(Je?$e:m.stencilModeForClipping(Ft))}};if(c.hasNonElevatedBuckets){const Be=!se&&m.terrain;0!==R&&Be?h.w(`Occlusion opacity for layer ${c.id} is supported on terrain only if the layer has line-z-offset enabled.`):Be?h.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${c.id}.`):st(_,Ct,m.depthModeForSublayer(0,cn.ReadOnly),Rn.disabled,!1,!0)}if(c.hasElevatedBuckets){Ct.push("ELEVATED"),ne&&Ct.push(J?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),z&&Ct.push("ELEVATION_REFERENCE_SEA");const Be=qe?m.stencilModeFor3D():Rn.disabled,at=new cn(m.depthOcclusion?j.GREATER:j.LEQUAL,cn.ReadOnly,m.depthRangeFor3D);m.forceTerrainMode=!0,st(_,Ct,at,Be,!0,!0),qe&&st(_,Ct,at,Be,!0,!1),m.forceTerrainMode=!1}qe&&(m.resetStencilClippingMasks(),se&&U.clear({stencil:0})),0===R||m.depthOcclusion||se||m.layersWithOcclusionOpacity.push(m.currentLayer)},fill:function(m,s,c,_){const v=c.paint.get("fill-color"),x=c.paint.get("fill-opacity");if(0===x.constantOr(1))return;const E=c.paint.get("fill-emissive-strength"),R=m.colorModeForDrapableLayerRenderPass(E),F=c.paint.get("fill-pattern"),N=m.opaquePassEnabledForLayer()&&!F.constantOr(1)&&1===v.constantOr(h.al.transparent).a&&1===x.constantOr(0)?"opaque":"translucent";let z="none";"none"!==c.layout.get("fill-elevation-reference")?z="road":0!==c.paint.get("fill-z-offset").constantOr(1)&&(z="offset");const U=!(!m.terrain||!m.terrain.enabled),j={painter:m,sourceCache:s,layer:c,coords:_,colorMode:R,elevationType:z,terrainEnabled:U,pass:N};if("offset"!==z){if(Fm(j,!1),"road"===z){const W=!U&&"translucent"===m.renderPass;W&&ff(m,s,c,_,"geometry"),Fm(j,!0,Rn.disabled),W&&function(ne){const{painter:J,sourceCache:oe,layer:se,coords:fe,colorMode:be}=ne,ve=J.context.gl,we=new cn(J.context.gl.LEQUAL,cn.ReadOnly,J.depthRangeFor3D);for(const Ee of fe){const De=oe.getTile(Ee),Me=De.getBucket(se);if(!Me)continue;const ke=Me.elevatedStructures;if(!ke||!ke.renderableSegments||0===ke.renderableSegments.segments[0].primitiveLength)continue;J.prepareDrawTile();const Oe=Me.bufferData.programConfigurations.get(se.id),et=J.isTileAffectedByFog(Ee),qe=J.getOrCreateProgram("elevatedStructures",{config:Oe,overrideFog:et,defines:["NORMAL_OFFSET"]}),ot={u_matrix:J.translatePosMatrix(Ee.projMatrix,De,se.paint.get("fill-translate"),se.paint.get("fill-translate-anchor"))};J.uploadCommonUniforms(J.context,qe,Ee.toUnwrapped()),qe.draw(J,ve.TRIANGLES,we,Rn.disabled,be,Mn.backCCW,ot,se.id,ke.vertexBuffer,ke.indexBuffer,ke.renderableSegments,se.paint,J.transform.zoom,Oe,[ke.vertexBufferNormal])}}(j)}}else Fm(j,!1,m.stencilModeFor3D())},"fill-extrusion":function(m,s,c,_){const v=c.paint.get("fill-extrusion-opacity"),x=m.context,E=x.gl,R=m.terrain,F=R&&R.renderingToTexture;if(0===v)return;const N=m.conflationActive&&m.style.isLayerClipped(c,s.getSource()),z=m.style.order.indexOf(c.fqid);if(N&&function(U,j,W,ne,J){for(const oe of ne){const se=j.getTile(oe).getBucket(W);se&&(se.updateReplacement(oe,U.replacementSource,J),se.uploadCentroid(U.context))}}(m,s,c,_,z),R||N)for(const U of _){const j=s.getTile(U).getBucket(c);j&&Ku(m.context,s,U,j,c,R,N)}if("shadow"===m.renderPass&&m.shadowRenderer){const U=m.shadowRenderer;if(R&&v<.65&&c._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof h.ab)return;const j=U.getShadowPassDepthMode(),W=U.getShadowPassColorMode();yr(m,s,c,_,j,Rn.disabled,W,N)}else if("translucent"===m.renderPass){const U=!c.paint.get("fill-extrusion-pattern").constantOr(1),j=c.paint.get("fill-extrusion-color").constantOr(h.al.white);if(!F&&0!==j.a){const W=new cn(m.context.gl.LEQUAL,cn.ReadWrite,m.depthRangeFor3D);1===v&&U?yr(m,s,c,_,W,Rn.disabled,ei.unblended,N):(yr(m,s,c,_,W,Rn.disabled,ei.disabled,N),yr(m,s,c,_,W,m.stencilModeFor3D(),m.colorModeForRenderPass(),N),m.resetStencilClippingMasks())}if(m.style.enable3dLights()&&U&&(!R&&"globe"!==m.transform.projection.name||F)){const W=c.paint.get("fill-extrusion-opacity"),ne=c.paint.get("fill-extrusion-ambient-occlusion-intensity"),J=c.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),oe=c.paint.get("fill-extrusion-flood-light-intensity"),se="none"===c.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default"),fe=c.paint.get("fill-extrusion-flood-light-color").toRenderColor(se?null:c.lut).toArray01().slice(0,3),be=ne>0&&J>0,ve=oe>0,we=(De,Me,ke)=>(1-ke)*De+ke*Me,Ee=De=>{const Me=m.depthModeForSublayer(1,cn.ReadOnly,E.LEQUAL,!0),ke=c.paint.get(De?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Oe=we(.1,3,ke),et=m._showOverdrawInspector;if(!et){const qe=new Rn({func:E.ALWAYS,mask:255},255,255,E.KEEP,E.KEEP,E.REPLACE),ot=new ei([E.ONE,E.ONE,E.ONE,E.ONE],h.al.transparent,[!1,!1,!1,!0],E.MIN);Xu(m,s,c,_,Me,qe,ot,Mn.disabled,De,"sdf",W,ne,J,oe,fe,Oe,N,!1)}{const qe=et?Rn.disabled:new Rn({func:E.EQUAL,mask:255},255,255,E.KEEP,E.DECR,E.DECR),ot=et?m.colorModeForRenderPass():new ei([E.ONE_MINUS_DST_ALPHA,E.DST_ALPHA,E.ONE,E.ONE],h.al.transparent,[!0,!0,!0,!0]);Xu(m,s,c,_,Me,qe,ot,Mn.disabled,De,"color",W,ne,J,oe,fe,Oe,N,!1)}};if(F){const De=(Me,ke,Oe)=>{const et=m.depthModeForSublayer(1,cn.ReadOnly,E.LEQUAL,!1),qe=c.paint.get(Me?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ot=we(.1,3,qe);{const lt=new ei([E.ONE,E.ONE,E.ONE,E.ONE],h.al.transparent,[!1,!1,!1,!0]);Xu(m,s,c,_,et,Rn.disabled,lt,Mn.disabled,Me,"clear",W,ne,J,oe,fe,ot,N,ke)}{const lt=new Rn({func:E.ALWAYS,mask:255},255,255,E.KEEP,E.KEEP,E.REPLACE),Ct=new ei([E.ONE,E.ONE,E.ONE,E.ONE],h.al.transparent,[!1,!1,!1,!0],E.MIN);Xu(m,s,c,_,et,lt,Ct,Mn.disabled,Me,"sdf",W,ne,J,oe,fe,ot,N,ke)}{const lt=Me?E.ZERO:E.ONE_MINUS_DST_ALPHA,Ct=new Rn({func:E.EQUAL,mask:255},255,255,E.KEEP,E.DECR,E.DECR),He=new ei([lt,E.DST_ALPHA,E.ONE_MINUS_DST_ALPHA,E.ZERO],h.al.transparent,[!0,!0,!0,!0]);Xu(m,s,c,_,et,Ct,He,Mn.disabled,Me,"color",W,ne,J,oe,fe,ot,N,ke)}{const lt=new ei([E.ONE,E.ONE,E.ONE,Me?E.ZERO:E.ONE],h.al.transparent,[!1,!1,!1,!0],Me?E.FUNC_ADD:E.MAX);Xu(m,s,c,_,et,Rn.disabled,lt,Mn.disabled,Me,"clear",W,ne,J,oe,fe,ot,N,ke,Oe)}};if(be||ve){let Me;if(m.prepareDrawTile(),R){const ke=R.drapeBufferSize[0],Oe=R.drapeBufferSize[1];Me=R.framebufferCopyTexture,Me&&(!Me||Me.size[0]===ke&&Me.size[1]===Oe)||(Me&&Me.destroy(),Me=R.framebufferCopyTexture=new h.T(x,new h.r({width:ke,height:Oe}),E.RGBA8)),Me.bind(E.LINEAR,E.CLAMP_TO_EDGE),E.copyTexSubImage2D(E.TEXTURE_2D,0,0,0,0,0,ke,Oe)}be&&De(!0,!1,Me),ve&&De(!1,!0,Me)}}else be&&Ee(!0),ve&&Ee(!1),(be||ve)&&m.resetStencilClippingMasks()}}},hillshade:function(m,s,c,_){if("offscreen"!==m.renderPass&&"translucent"!==m.renderPass||m.style.disableElevatedTerrain)return;const v=m.context,x=m.terrain&&m.terrain.renderingToTexture,[E,R]="translucent"!==m.renderPass||x?[{},_]:m.stencilConfigForOverlap(_);for(const F of R){const N=s.getTile(F);if(N.needsHillshadePrepare&&"offscreen"===m.renderPass)Hu(m,N,c);else if("translucent"===m.renderPass){const z=m.depthModeForSublayer(0,cn.ReadOnly),U=c.paint.get("hillshade-emissive-strength"),j=m.colorModeForDrapableLayerRenderPass(U),W=x&&m.terrain?m.terrain.stencilModeForRTTOverlap(F):E[F.overscaledZ];rd(m,F,N,c,z,W,j)}}v.viewport.set([0,0,m.width,m.height]),m.resetStencilClippingMasks()},raster:function(m,s,c,_,v,x){if("translucent"!==m.renderPass||0===c.paint.get("raster-opacity"))return;const E="globe"===m.transform.projection.name,R=0!==c.paint.get("raster-elevation"),F=R&&E;if(m.renderElevatedRasterBackface&&!F)return;const N=m.context,z=N.gl,U=s.getSource(),j=function(Ee,De,Me,ke){const Oe=De.paint.get("raster-color"),et="raster-array"===Ee.type,qe=[],ot=De.paint.get("raster-resampling"),lt=De.paint.get("raster-color-mix");let Ct=De.paint.get("raster-color-range");const He=[lt[0],lt[1],lt[2],0],st=lt[3];let Be="nearest"===ot?ke.NEAREST:ke.LINEAR;if(et&&(qe.push("RASTER_ARRAY"),Oe||qe.push("RASTER_COLOR"),"linear"===ot&&qe.push("RASTER_ARRAY_LINEAR"),Be=ke.NEAREST,!Ct&&Ee.rasterLayers)){const at=Ee.rasterLayers.find(({id:rt})=>rt===De.sourceLayer);at&&at.fields&&at.fields.range&&(Ct=at.fields.range)}if(Ct=Ct||[0,1],Oe){qe.push("RASTER_COLOR"),Me.activeTexture.set(ke.TEXTURE2),De.updateColorRamp(Ct);let at=De.colorRampTexture;at||(at=De.colorRampTexture=new h.T(Me,De.colorRamp,ke.RGBA8)),at.bind(ke.LINEAR,ke.CLAMP_TO_EDGE)}return{mix:He,range:Ct,offset:st,defines:qe,resampling:Be}}(U,c,N,z);if(U instanceof h.aK&&!_.length&&!E)return;const W=c.paint.get("raster-emissive-strength"),ne=m.colorModeForDrapableLayerRenderPass(W),J=m.terrain&&m.terrain.renderingToTexture,oe=!m.options.moving,se="nearest"===c.paint.get("raster-resampling")?z.NEAREST:z.LINEAR;if(U instanceof h.aK&&!_.length&&(U.onNorthPole||U.onSouthPole)){const Ee=R?m.stencilModeFor3D():Rn.disabled;return void Ye(!!U.onNorthPole,null,m,s,c,W,j,Mn.disabled,Ee)}if(!_.length)return;const[fe,be]=U instanceof h.aK||J?[{},_]:m.stencilConfigForOverlap(_),ve=be[be.length-1].overscaledZ;F&&j.defines.push("PROJECTION_GLOBE_VIEW"),R&&j.defines.push("RENDER_CUTOFF");const we=(Ee,De,Me)=>{for(const ke of Ee){const Oe=ke.toUnwrapped(),et=s.getTile(ke);if(J&&(!et||!et.hasData()))continue;N.activeTexture.set(z.TEXTURE0);const qe=ps(et,U,c,j);if(!qe||!qe.texture)continue;const{texture:ot,mix:lt,offset:Ct,tileSize:He,buffer:st}=qe;let Be,at;J?(Be=cn.disabled,at=ke.projMatrix):R?(Be=new cn(z.LEQUAL,cn.ReadWrite,m.depthRangeFor3D),at=E?Float32Array.from(m.transform.expandedFarZProjMatrix):m.transform.calculateProjMatrix(Oe,oe)):(Be=m.depthModeForSublayer(ke.overscaledZ-ve,1===c.paint.get("raster-opacity")?cn.ReadWrite:cn.ReadOnly,z.LESS),at=m.transform.calculateProjMatrix(Oe,oe));const rt=m.terrain&&J?m.terrain.stencilModeForRTTOverlap(ke):fe[ke.overscaledZ],$e=x?0:c.paint.get("raster-fade-duration");et.registerFadeDuration($e);const Je=s.findLoadedParent(ke,0),dt=od(et,Je,s,m.transform,$e);let Ft,zt;m.terrain&&m.terrain.prepareDrawTile(),N.activeTexture.set(z.TEXTURE0),ot.bind(se,z.CLAMP_TO_EDGE),N.activeTexture.set(z.TEXTURE1),Je?(Je.texture&&Je.texture.bind(se,z.CLAMP_TO_EDGE),Ft=Math.pow(2,Je.tileID.overscaledZ-et.tileID.overscaledZ),zt=[et.tileID.canonical.x*Ft%1,et.tileID.canonical.y*Ft%1]):ot.bind(se,z.CLAMP_TO_EDGE),"useMipmap"in ot&&N.extTextureFilterAnisotropic&&m.transform.pitch>20&&z.texParameterf(z.TEXTURE_2D,N.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,N.extTextureFilterAnisotropicMax);const Bt=m.transform;let en;const In=R?eu(Bt):[0,0,0,0];let wt,Tn,vn,di,Pi,ar=0;if(F&&U instanceof h.aK&&U.coordinates.length>3)wt=Float32Array.from(h.bc(h.cI(new h.bT(0,0,0)))),Tn=Float32Array.from(Bt.globeMatrix),vn=Float32Array.from(h.cE(Bt)),di=[h.av(Bt.center.lng),h.aC(Bt.center.lat)],en=U.elevatedGlobePerspectiveTransform,Pi=U.elevatedGlobeGridMatrix||new Float32Array(9);else if(F){const tn=h.cF(ke.canonical);ar=h.cG(tn.getCenter().lat),wt=Float32Array.from(h.bc(h.cI(ke.canonical))),Tn=Float32Array.from(Bt.globeMatrix),vn=Float32Array.from(h.cE(Bt)),di=[h.av(Bt.center.lng),h.aC(Bt.center.lat)],en=[0,0],Pi=Float32Array.from(h.cH(ke.canonical,tn,ar,Bt.worldSize/Bt._pixelsPerMercatorPixel))}else en=U instanceof h.aK?U.perspectiveTransform:[0,0],wt=new Float32Array(16),Tn=new Float32Array(9),vn=new Float32Array(16),di=[0,0],Pi=new Float32Array(9);const Yn=Pm(at,wt,Tn,vn,Pi,zt||[0,0],h.ag(m.transform.zoom),di,In,Ft||1,dt,c,en,R?c.paint.get("raster-elevation"):0,2,lt,Ct,j.range,He,st,W),xr=m.isTileAffectedByFog(ke),An=m.getOrCreateProgram("raster",{defines:j.defines,overrideFog:xr});if(m.uploadCommonUniforms(N,An,Oe),U instanceof h.aK){const tn=U.elevatedGlobeVertexBuffer,gi=U.elevatedGlobeIndexBuffer;if(J||!E)U.boundsBuffer&&U.boundsSegments&&An.draw(m,z.TRIANGLES,Be,Rn.disabled,ne,Mn.disabled,Yn,c.id,U.boundsBuffer,m.quadTriangleIndexBuffer,U.boundsSegments);else if(tn&&gi){const Vi=Bt.zoom<=h.c6?U.elevatedGlobeSegments:U.getSegmentsForLongitude(Bt.center.lng);Vi&&An.draw(m,z.TRIANGLES,Be,Rn.disabled,ne,De,Yn,c.id,tn,gi,Vi)}}else if(F){Be=new cn(z.LEQUAL,cn.ReadOnly,m.depthRangeFor3D);const tn=m.globeSharedBuffers;if(tn){const[gi,Vi,Ei]=tn.getGridBuffers(ar,!1);An.draw(m,z.TRIANGLES,Be,Me||rt,m.colorModeForRenderPass(),De,Yn,c.id,gi,Vi,Ei)}}else{const{tileBoundsBuffer:tn,tileBoundsIndexBuffer:gi,tileBoundsSegments:Vi}=m.getTileBoundsBuffers(et);An.draw(m,z.TRIANGLES,Be,rt,ne,Mn.disabled,Yn,c.id,tn,gi,Vi)}}if(!(U instanceof h.aK)&&F)for(const ke of Ee){const Oe=ke.canonical.y===(1<<ke.canonical.z)-1;0===ke.canonical.y&&Ye(!0,ke,m,s,c,W,j,De,Me||Rn.disabled),Oe&&Ye(!1,ke,m,s,c,W,j,De===Mn.frontCW?Mn.backCW:Mn.frontCW,Me||Rn.disabled)}};F?we(be,m.renderElevatedRasterBackface?Mn.backCW:Mn.frontCW,m.stencilModeFor3D()):we(be,Mn.disabled,void 0),m.resetStencilClippingMasks()},"raster-particle":function(m,s,c,_,v,x){"offscreen"===m.renderPass&&function(E,R,F,N){if(!N.length)return;const z=E.context,U=z.gl,j=R.getSource();if(!(j instanceof ca))return;const W=Math.ceil(Math.sqrt(F.paint.get("raster-particle-count")));let ne=F.particlePositionRGBAImage;if(!ne||ne.width!==W){const be=function(ve){const we=ve*ve,Ee=new Uint8Array(4*we),De=function(ke){return ke|=0,ke=Math.imul(2747636419^ke,2654435769),ke=Math.imul(ke^ke>>>16,2654435769),((ke=Math.imul(ke^ke>>>16,2654435769))>>>0)/4294967296},Me=1/1.1;for(let ke=0;ke<we;ke++){const Oe=Me*(De(2*ke+0)+Vs),et=Me*(De(2*ke+1)+Vs),qe=255*Oe%1,ot=255*et%1,lt=qe,Ct=et-ot/255,He=ot;Ee[4*ke+0]=255*(Oe-qe/255),Ee[4*ke+1]=255*lt,Ee[4*ke+2]=255*Ct,Ee[4*ke+3]=255*He}return Ee}(W);ne=F.particlePositionRGBAImage=new h.r({width:W,height:W},be)}let J=F.particleFramebuffer;J?J.width!==W&&(J.destroy(),J=F.particleFramebuffer=z.createFramebuffer(W,W,!0,null)):J=F.particleFramebuffer=z.createFramebuffer(W,W,!0,null);const oe=[];for(const be of N){const ve=R.getTile(be);if(!(ve instanceof ua))continue;const we=Fv(ve,j,F);if(!we)continue;const Ee=[ve.tileSize,ve.tileSize];let De=F.tileFramebuffer;De||(De=F.tileFramebuffer=z.createFramebuffer(Ee[0],Ee[1],!0,null));let Me=ve.rasterParticleState;Me||(Me=ve.rasterParticleState=new mf(z,be,Ee,ne));const ke=Me.update(F.lastInvalidatedAt);Me.particleTextureDimension!==W&&Me.updateParticleTexture(be,ne);const Oe=Me.targetColorTexture;Me.targetColorTexture=Me.backgroundColorTexture,Me.backgroundColorTexture=Oe;const et=Me.particleTexture0;Me.particleTexture0=Me.particleTexture1,Me.particleTexture1=et,oe.push([be,we,Me,ke])}if(0===oe.length)return;const se=h.q.now(),fe=F.previousDrawTimestamp?.001*(se-F.previousDrawTimestamp):.0167;if(F.previousDrawTimestamp=se,F.hasColorMap()){z.activeTexture.set(U.TEXTURE0+2);let be=F.colorRampTexture;be||(be=F.colorRampTexture=new h.T(z,F.colorRamp,U.RGBA8)),be.bind(U.LINEAR,U.CLAMP_TO_EDGE)}z.bindFramebuffer.set(F.tileFramebuffer.framebuffer),function(be,ve,we){const Ee=be.context,De=Ee.gl,Me=ve.tileFramebuffer;Ee.activeTexture.set(De.TEXTURE0);const ke={u_texture:0,u_opacity:1.05*(et=ve.paint.get("raster-particle-fade-opacity-factor"))/(et+.05)},Oe=be.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var et;for(const qe of we){const[,,ot,lt]=qe;Me.colorAttachment.set(ot.targetColorTexture.texture),Ee.viewport.set([0,0,Me.width,Me.height]),Ee.clear({color:h.al.transparent}),lt&&(ot.backgroundColorTexture.bind(De.NEAREST,De.CLAMP_TO_EDGE),Oe.draw(be,De.TRIANGLES,cn.disabled,Rn.disabled,ei.alphaBlended,Mn.disabled,ke,ve.id,be.viewportBuffer,be.quadTriangleIndexBuffer,be.viewportSegments))}}(E,F,oe),function(be,ve,we,Ee){const De=be.context,Me=De.gl,ke=we.tileFramebuffer,Oe="globe"===be.transform.projection.name,et=we.paint.get("raster-particle-max-speed");for(const qe of Ee){const[ot,lt,Ct]=qe;De.activeTexture.set(Me.TEXTURE0+0),lt.texture.bind(Me.LINEAR,Me.CLAMP_TO_EDGE),ke.colorAttachment.set(Ct.targetColorTexture.texture);const He=be.getOrCreateProgram("rasterParticleDraw",{defines:lt.defines,overrideFog:!1});De.activeTexture.set(Me.TEXTURE0+1);const st=lt.scalarData?[]:[0,1,2,3].map(rt=>h.d7[rt](ot));st.push(ot);const Be=ot.canonical.x,at=ot.canonical.y;for(const rt of st){const $e=ve.getTile(Oe?rt.wrapped():rt);if(!$e)continue;const Je=$e.rasterParticleState;if(!Je)continue;const dt=rt.canonical.x+(1<<rt.canonical.z)*(rt.wrap-ot.wrap),Ft=rt.canonical.y;Je.particleTexture0.bind(Me.NEAREST,Me.CLAMP_TO_EDGE);const zt=Iv(1,Je.particleTexture0.size[0],[dt-Be,Ft-at],0,lt.texture.size,2,et,lt.textureOffset,lt.scale,lt.offset);He.draw(be,Me.POINTS,cn.disabled,Rn.disabled,ei.alphaBlended,Mn.disabled,zt,we.id,Je.particleIndexBuffer,void 0,Je.particleSegment)}}}(E,R,F,oe),z.bindFramebuffer.set(F.particleFramebuffer.framebuffer),function(be,ve,we,Ee){const De=be.context,Me=De.gl,ke=ve.paint.get("raster-particle-max-speed"),Oe=Ee*ve.paint.get("raster-particle-speed-factor")*.15,et=(ot=.01+1*ve.paint.get("raster-particle-reset-rate-factor"),Math.pow(ot,6)),qe=ve.particleFramebuffer;var ot;De.viewport.set([0,0,qe.width,qe.height]);for(const ot of we){const[,lt,Ct]=ot;De.activeTexture.set(Me.TEXTURE0+0),lt.texture.bind(Me.LINEAR,Me.CLAMP_TO_EDGE),De.activeTexture.set(Me.TEXTURE0+1);const He=Ct.particleTexture0;He.bind(Me.NEAREST,Me.CLAMP_TO_EDGE);const st=CE(1,He.size[0],0,lt.texture.size,ke,Oe,et,lt.textureOffset,lt.scale,lt.offset);qe.colorAttachment.set(Ct.particleTexture1.texture),De.clear({color:h.al.transparent}),be.getOrCreateProgram("rasterParticleUpdate",{defines:lt.defines}).draw(be,Me.TRIANGLES,cn.disabled,Rn.disabled,ei.unblended,Mn.disabled,st,ve.id,be.viewportBuffer,be.quadTriangleIndexBuffer,be.viewportSegments)}}(E,F,oe,fe)}(m,s,c,_),"translucent"===m.renderPass&&(function(E,R,F,N){const U=E.context,j=U.gl,W=R.getSource().tileSize,ne=5*(1-h.ae(h.bY,h.bY+1,E.transform.zoom))*W+F.paint.get("raster-particle-elevation"),J=!E.options.moving,oe="globe"===E.transform.projection.name;if(!N.length)return;const[se,fe]=E.stencilConfigForOverlap(N),be=[];oe&&be.push("PROJECTION_GLOBE_VIEW");const ve=E.stencilModeFor3D();for(const we of fe){const Ee=we.toUnwrapped(),De=R.getTile(we);if(!De.rasterParticleState)continue;const Me=De.rasterParticleState,ke=100;De.registerFadeDuration(ke);const Oe=R.findLoadedParent(we,0),et=od(De,Oe,R,E.transform,ke);let qe,ot;E.terrain&&E.terrain.prepareDrawTile(),U.activeTexture.set(j.TEXTURE0),Me.targetColorTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),U.activeTexture.set(j.TEXTURE1),Oe&&Oe.rasterParticleState?(Oe.rasterParticleState.targetColorTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),qe=Math.pow(2,Oe.tileID.overscaledZ-De.tileID.overscaledZ),ot=[De.tileID.canonical.x*qe%1,De.tileID.canonical.y*qe%1]):Me.targetColorTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE);const lt=oe?Float32Array.from(E.transform.expandedFarZProjMatrix):E.transform.calculateProjMatrix(Ee,J),Ct=E.transform,He=Ua(Ct),st=h.cF(we.canonical),Be=h.cG(st.getCenter().lat);let at,rt,$e,Je,dt;oe?(at=Float32Array.from(h.bc(h.cI(we.canonical))),rt=Float32Array.from(Ct.globeMatrix),$e=Float32Array.from(h.cE(Ct)),Je=[h.av(Ct.center.lng),h.aC(Ct.center.lat)],dt=Float32Array.from(h.cH(we.canonical,st,Be,Ct.worldSize/Ct._pixelsPerMercatorPixel))):(at=new Float32Array(16),rt=new Float32Array(9),$e=new Float32Array(16),Je=[0,0],dt=new Float32Array(9));const Ft=hn(lt,at,rt,$e,dt,ot||[0,0],h.ag(E.transform.zoom),Je,He,qe||1,et,ne),zt=E.isTileAffectedByFog(we),Bt=E.getOrCreateProgram("rasterParticle",{defines:be,overrideFog:zt});if(E.uploadCommonUniforms(U,Bt,Ee),oe){const en=new cn(j.LEQUAL,cn.ReadOnly,E.depthRangeFor3D),In=0,wt=E.globeSharedBuffers;if(wt){const[Tn,vn,di]=wt.getGridBuffers(Be,0!==In);Bt.draw(E,j.TRIANGLES,en,ve,ei.alphaBlended,E.renderElevatedRasterBackface?Mn.frontCCW:Mn.backCCW,Ft,F.id,Tn,vn,di)}}else{const en=E.depthModeForSublayer(0,cn.ReadOnly),In=se[we.overscaledZ],{tileBoundsBuffer:wt,tileBoundsIndexBuffer:Tn,tileBoundsSegments:vn}=E.getTileBoundsBuffers(De);Bt.draw(E,j.TRIANGLES,en,In,ei.alphaBlended,Mn.disabled,Ft,F.id,wt,Tn,vn)}}E.resetStencilClippingMasks()}(m,s,c,_),m.style.map.triggerRepaint())},background:function(m,s,c,_){const v=c.paint.get("background-color"),x="none"===c.paint.get("background-color-use-theme").constantOr("default"),E=c.paint.get("background-opacity"),R=c.paint.get("background-emissive-strength"),F="viewport"===c.paint.get("background-pitch-alignment");if(0===E)return;const N=m.context,z=N.gl,U=m.transform,j=U.tileSize,W=c.paint.get("background-pattern");let ne;if(void 0!==W&&(null===W||(ne=m.imageManager.getPattern(h.I.from(W.toString()),c.scope,m.style.getLut(c.scope)),!ne)))return;const J=!W&&1===v.a&&1===E&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==J)return;const oe=Rn.disabled,se=m.depthModeForSublayer(0,"opaque"===J?cn.ReadWrite:cn.ReadOnly),fe=m.colorModeForDrapableLayerRenderPass(R),be=W?"backgroundPattern":"background";let ve,we=_;if(we||(ve=m.getBackgroundTiles(),we=Object.values(ve).map(Ee=>Ee.tileID)),W&&(N.activeTexture.set(z.TEXTURE0),m.imageManager.bind(m.context,c.scope)),F){const Ee=m.getOrCreateProgram(be,{overrideFog:!1,overrideRtt:!0}),De=new Float32Array(h.ad.mat4.identity([])),Me=new h.aH(0,0,0,0,0),ke=W?d_(De,R,E,m,0,c.scope,ne,F,{tileID:Me,tileSize:j}):Av(De,R,E,v.toRenderColor(x?null:c.lut));Ee.draw(m,z.TRIANGLES,se,oe,fe,Mn.disabled,ke,c.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments)}else for(const Ee of we){const De=m.isTileAffectedByFog(Ee),Me=m.getOrCreateProgram(be,{overrideFog:De}),ke=Ee.toUnwrapped(),Oe=_?Ee.projMatrix:m.transform.calculateProjMatrix(ke);m.prepareDrawTile();const et=s?s.getTile(Ee):ve?ve[Ee.key]:new po(Ee,j,U.zoom,m),qe=W?d_(Oe,R,E,m,0,c.scope,ne,F,{tileID:Ee,tileSize:j}):Av(Oe,R,E,v.toRenderColor(x?null:c.lut));m.uploadCommonUniforms(N,Me,ke);const{tileBoundsBuffer:ot,tileBoundsIndexBuffer:lt,tileBoundsSegments:Ct}=m.getTileBoundsBuffers(et);Me.draw(m,z.TRIANGLES,se,oe,fe,Mn.disabled,qe,c.id,ot,lt,Ct)}},sky:function(m,s,c){const _=m._atmosphere?h.ag(m.transform.zoom):1,v=c.paint.get("sky-opacity")*_;if(0===v)return;const x=m.context,E=c.paint.get("sky-type"),R=new cn(x.gl.LEQUAL,cn.ReadOnly,[0,1]),F=m.frameCounter/1e3%1;"atmosphere"===E?"offscreen"===m.renderPass?c.needsSkyboxCapture(m)&&(function(N,z){const W=N.context,ne=W.gl;let J=z.skyboxFbo;if(!J){J=z.skyboxFbo=W.createFramebuffer(32,32,!0,null),z.skyboxGeometry=new xi(W),z.skyboxTexture=W.gl.createTexture(),ne.bindTexture(ne.TEXTURE_CUBE_MAP,z.skyboxTexture),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_WRAP_S,ne.CLAMP_TO_EDGE),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_WRAP_T,ne.CLAMP_TO_EDGE),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_MIN_FILTER,ne.LINEAR),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_MAG_FILTER,ne.LINEAR);for(let be=0;be<6;++be)ne.texImage2D(ne.TEXTURE_CUBE_MAP_POSITIVE_X+be,0,ne.RGBA,32,32,0,ne.RGBA,ne.UNSIGNED_BYTE,null)}W.bindFramebuffer.set(J.framebuffer),W.viewport.set([0,0,32,32]);const oe=z.getCenter(N,!0),se=N.getOrCreateProgram("skyboxCapture"),fe=new Float64Array(16);h.ad.mat4.identity(fe),h.ad.mat4.rotateY(fe,fe,.5*-Math.PI),go(N,z,se,fe,oe,0),h.ad.mat4.identity(fe),h.ad.mat4.rotateY(fe,fe,.5*Math.PI),go(N,z,se,fe,oe,1),h.ad.mat4.identity(fe),h.ad.mat4.rotateX(fe,fe,.5*-Math.PI),go(N,z,se,fe,oe,2),h.ad.mat4.identity(fe),h.ad.mat4.rotateX(fe,fe,.5*Math.PI),go(N,z,se,fe,oe,3),h.ad.mat4.identity(fe),go(N,z,se,fe,oe,4),h.ad.mat4.identity(fe),h.ad.mat4.rotateY(fe,fe,Math.PI),go(N,z,se,fe,oe,5),W.viewport.set([0,0,N.width,N.height])}(m,c),c.markSkyboxValid(m)):"sky"===m.renderPass&&function(N,z,U,j,W){const ne=N.context,J=ne.gl,oe=N.transform,se=N.getOrCreateProgram("skybox");ne.activeTexture.set(J.TEXTURE0),J.bindTexture(J.TEXTURE_CUBE_MAP,z.skyboxTexture);const fe=((be,ve,we,Ee,De)=>({u_matrix:be,u_sun_direction:ve,u_cubemap:0,u_opacity:Ee,u_temporal_offset:De}))(oe.skyboxMatrix,z.getCenter(N,!1),0,j,W);N.uploadCommonUniforms(ne,se),se.draw(N,J.TRIANGLES,U,Rn.disabled,N.colorModeForRenderPass(),Mn.backCW,fe,"skybox",z.skyboxGeometry.vertexBuffer,z.skyboxGeometry.indexBuffer,z.skyboxGeometry.segment)}(m,c,R,v,F):"gradient"===E&&"sky"===m.renderPass&&function(N,z,U,j,W){const ne=N.context,J=ne.gl,oe=N.transform,se=N.getOrCreateProgram("skyboxGradient");z.skyboxGeometry||(z.skyboxGeometry=new xi(ne)),ne.activeTexture.set(J.TEXTURE0);let fe=z.colorRampTexture;fe||(fe=z.colorRampTexture=new h.T(ne,z.colorRamp,J.RGBA8)),fe.bind(J.LINEAR,J.CLAMP_TO_EDGE);const be=(ve=oe.skyboxMatrix,we=z.getCenter(N,!1),Ee=z.paint.get("sky-gradient-radius"),De=j,Me=W,{u_matrix:ve,u_color_ramp:0,u_center_direction:we,u_radius:h.ak(Ee),u_opacity:De,u_temporal_offset:Me});var ve,we,Ee,De,Me;N.uploadCommonUniforms(ne,se),se.draw(N,J.TRIANGLES,U,Rn.disabled,N.colorModeForRenderPass(),Mn.backCW,be,"skyboxGradient",z.skyboxGeometry.vertexBuffer,z.skyboxGeometry.indexBuffer,z.skyboxGeometry.segment)}(m,c,R,v,F)},debug:function(m,s,c,_,v,x){for(let E=0;E<c.length;E++)if(v){const N=new h.al(.8*_.r,.8*_.g,.8*_.b,1);ja(m,s,c[E],_,-1,-1,x),ja(m,s,c[E],_,-1,1,x),ja(m,s,c[E],_,1,1,x),ja(m,s,c[E],_,1,-1,x),ja(m,s,c[E],N,0,0,x)}else ja(m,s,c[E],_,0,0,x)},custom:function(m,s,c,_){const v=m.context,x=c.implementation;if(!m.transform.projection.unsupportedLayers||!m.transform.projection.unsupportedLayers.includes("custom")||m.terrain&&(m.terrain.renderingToTexture||"offscreen"===m.renderPass)&&c.isDraped(s)){if("offscreen"===m.renderPass){const E=x.prerender;if(E){if(m.setCustomLayerDefaults(),v.setColorMode(m.colorModeForRenderPass()),"globe"===m.transform.projection.name){const R=m.transform.pointMerc;E.call(x,v.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),h.ag(m.transform.zoom),[R.x,R.y],m.transform.pixelsPerMeterRatio)}else E.call(x,v.gl,m.transform.customLayerMatrix());v.setDirty(),m.setBaseState()}}else if("translucent"===m.renderPass){if(m.terrain&&m.terrain.renderingToTexture){const R=x.renderToTile;if(R){const F=_[0].canonical,N=new h.ac(F.x+_[0].wrap*(1<<F.z),F.y,F.z);v.setDepthMode(cn.disabled),v.setStencilMode(Rn.disabled),v.setColorMode(m.colorModeForRenderPass()),m.setCustomLayerDefaults(),R.call(x,v.gl,N),v.setDirty(),m.setBaseState()}return}m.setCustomLayerDefaults(),v.setColorMode(m.colorModeForRenderPass()),v.setStencilMode(Rn.disabled);const E="3d"===x.renderingMode?new cn(m.context.gl.LEQUAL,cn.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,cn.ReadOnly);if(v.setDepthMode(E),"globe"===m.transform.projection.name){const R=m.transform.pointMerc;x.render(v.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),h.ag(m.transform.zoom),[R.x,R.y],m.transform.pixelsPerMeterRatio)}else x.render(v.gl,m.transform.customLayerMatrix());v.setDirty(),m.setBaseState(),v.bindFramebuffer.set(null)}}else h.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(m,s,c,_){if("opaque"===m.renderPass)return;const v=c.paint.get("model-opacity").constantOr(1);if(0===v)return;const x=c.paint.get("model-cast-shadows");if("shadow"===m.renderPass&&(!x||m.terrain&&v<.65&&c._transitionablePaint._values["model-opacity"].value.expression instanceof h.ab))return;const E=m.shadowRenderer,R=c.paint.get("model-receive-shadows");E&&(E.useNormalOffset=!0,R||(E.enabled=!1));const F=()=>{E&&(E.useNormalOffset=!0,R||(E.enabled=!0))},N=s.getSource();if("light-beam"===m.renderPass&&"batched-model"!==N.type)return;if("vector"===N.type||"geojson"===N.type)return function(se,fe,be,ve,we){const Ee=se.transform;if("mercator"!==Ee.projection.name)return void h.w(`Drawing 3D models for ${Ee.projection.name} projection is not yet implemented`);const De=Ee.getFreeCameraOptions().position;if(!se.modelManager)return;const Me=se.modelManager;be.modelManager=Me;const ke=se.shadowRenderer;if(!be._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Oe=be._unevaluatedLayout._values["model-id"],et=Object.assign({},be.layout.get("model-id").parameters),qe=se.style.order.indexOf(be.fqid);for(const ot of ve){const lt=fe.getTile(ot).getBucket(be);if(!lt||lt.projection.name!==Ee.projection.name)continue;const Ct=lt.getModelUris();Ct&&!lt.modelsRequested&&(Me.addModelsFromBucket(Ct,we),lt.modelsRequested=!0);const He=xt(ot,Ee);et.zoom=He;const st=Oe.possiblyEvaluate(et);if(g_(se,lt,ot),_l.shadowUniformsInitialized=!1,_l.useSingleShadowCascade=!!ke&&0===ke.getMaxCascadeForTile(ot.toUnwrapped()),"shadow"===se.renderPass&&ke){if(1===se.currentShadowCascade&&lt.isInsideFirstShadowMapFrustum)continue;const rt=Ee.calculatePosMatrix(ot.toUnwrapped(),Ee.worldSize);if(_l.tileMatrix.set(rt),_l.shadowTileMatrix=Float32Array.from(ke.calculateShadowPassMatrixFromMatrix(rt)),_l.aabb.min.fill(0),_l.aabb.max[0]=_l.aabb.max[1]=h.ai,_l.aabb.max[2]=0,ln(lt,_l,se,be.scope))continue}const Be=1<<ot.canonical.z,at=[((De.x-ot.wrap)*Be-ot.canonical.x)*h.ai,(De.y*Be-ot.canonical.y)*h.ai,De.z*Be*h.ai];se.conflationActive&&Object.keys(lt.instancesPerModel).length>0&&se.style.isLayerClipped(be,fe.getSource())&&lt.updateReplacement(ot,se.replacementSource,qe,we)&&(lt.uploaded=!1,lt.upload(se.context));for(let rt in lt.instancesPerModel){const $e=lt.instancesPerModel[rt];$e.features.length>0&&(rt=st.evaluate($e.features[0].feature,{}));const Je=Me.getModel(rt,we);if(Je&&Je.uploaded)for(const dt of Je.nodes)Wn(se,be,dt,$e,at,ot,_l)}}}(m,s,c,_,"vector"===N.type?c.scope:""),void F();if(!N.loaded())return;if("batched-model"===N.type)return function(se,fe,be,ve){be.resetLayerRenderingStats(se);const we=se.context,Ee=se.transform,De=se.style.fog,Me=se.shadowRenderer;if("mercator"!==Ee.projection.name)return void h.w(`Drawing 3D landmark models for ${Ee.projection.name} projection is not yet implemented`);const ke=se.transform.getFreeCameraOptions().position,Oe=h.ad.vec3.scale([],[ke.x,ke.y,ke.z],se.transform.worldSize),et=h.ad.vec3.negate([],Oe),qe=h.ad.mat4.identity([]),ot=h.dm(Ee.center.lat,Ee.zoom),lt=h.ad.mat4.fromScaling([],[1,1,1/ot]);h.ad.mat4.translate(qe,qe,et);const Ct=be.paint.get("model-opacity").constantOr(1),He=new cn(we.gl.LEQUAL,cn.ReadWrite,se.depthRangeFor3D),st=new cn(we.gl.LEQUAL,cn.ReadOnly,se.depthRangeFor3D),Be=new h.ce([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),at="shadow"===se.renderPass,rt=at&&Me?Me.getCurrentCascadeFrustum():Ee.getFrustum(Ee.scaleZoom(Ee.worldSize)),$e=be.paint.get("model-front-cutoff"),Je=$e[2]<1,dt=Qc(se,be.paint.get("model-cutoff-fade-range")),Ft=be.getLayerRenderingStats();(function(zt,Bt,en,In){const wt=zt.terrain?zt.terrain.exaggeration():0,Tn=zt.transform.zoom;for(const vn of In){const di=Bt.getTile(vn).getBucket(en);di&&(di.setFilter(en.filter),zt.conflationActive&&di.updateReplacement(vn,zt.replacementSource),di.evaluateScale(zt,en),zt.terrain&&wt>0&&di.elevationUpdate(zt.terrain,wt,vn,en.source),di.needsReEvaluation(zt,Tn,en)&&di.evaluate(en))}})(se,fe,be,ve),function(){let zt,Bt,en;Je?(zt=ve.length-1,Bt=-1,en=-1):(zt=0,Bt=ve.length,en=1);const In=new Float64Array(16),wt=h.ad.vec3.create(),Tn=new h.P(0,0);for(let vn=zt;vn!==Bt;vn+=en){const di=ve[vn],Pi=fe.getTile(di).getBucket(be);if(!Pi||!Pi.uploaded)continue;let ar=!1;Me&&(ar=0===Me.getMaxCascadeForTile(di.toUnwrapped()));const Yn=Ee.calculatePosMatrix(di.toUnwrapped(),Ee.worldSize),xr=Pi.modelTraits;!at&&Je&&(h.ad.mat4.invert(In,Yn),h.ad.vec3.transformMat4(wt,Oe,In),Tn.x=wt[0],Tn.y=wt[1]);const An=[];Pi.setFilter(be.filter);for(const tn of Pi.getNodesInfo()){if(tn.hiddenByReplacement||!tn.node.meshes)continue;const gi=tn.node;let Vi=0;se.terrain&&gi.elevation&&(Vi=gi.elevation*se.terrain.exaggeration());const Ei=(()=>{const $i=tn.aabb;return Be.min=[...$i.min],Be.max=[...$i.max],Be.min[2]+=Vi,Be.max[2]+=Vi,h.ad.vec3.transformMat4(Be.min,Be.min,Yn),h.ad.vec3.transformMat4(Be.max,Be.max,Yn),Be})(),Xi=tn.evaluatedScale;if(Xi[0]<=1&&Xi[1]<=1&&Xi[2]<=1&&0===Ei.intersects(rt))continue;if(!at&&Je){const $i=.16666666666666666;tn.cameraCollisionOpacity=Oe[0]>Ei.min[0]&&Oe[0]<Ei.max[0]&&Oe[1]>Ei.min[1]&&Oe[1]<Ei.max[1]&&Oe[2]*ot<Ei.max[2]&&gi.footprint&&h.bA(Tn,gi.footprint)?Math.max(tn.cameraCollisionOpacity-$i,0):Math.min(1,tn.cameraCollisionOpacity+$i)}const lo=[...Yn],_o=gi.anchor?gi.anchor[0]:0,jo=gi.anchor?gi.anchor[1]:0;h.ad.mat4.translate(lo,lo,[_o*(Xi[0]-1),jo*(Xi[1]-1),Vi]),h.ad.vec3.exactEquals(Xi,h.dq)||h.ad.mat4.scale(lo,lo,Xi);const xl=h.ad.mat4.multiply([],lo,gi.matrix),ms=h.ad.mat4.multiply([],Ee.expandedFarZProjMatrix,xl),wi=h.ad.mat4.multiply([],Ee.expandedFarZProjMatrix,lo),Tr=h.ad.vec4.transformMat4([],[_o,jo,Vi,1],ms)[2];gi.hidden=!1;let Oi=Ct;at||(Je&&(Oi*=tn.cameraCollisionOpacity,Oi*=Lm(lo,Ee,tn.aabb,$e)),Oi*=Zi(dt,Tr)),0!==Oi?An.push({nodeInfo:tn,depth:Tr,opacity:Oi,wvpForNode:ms,wvpForTile:wi,nodeModelMatrix:xl,tileModelMatrix:lo}):gi.hidden=!0}at||An.sort((tn,gi)=>!Je||1===tn.opacity&&1===gi.opacity?tn.depth<gi.depth?-1:1:1===tn.opacity?-1:1===gi.opacity?1:tn.depth>gi.depth?-1:1);for(const tn of An){const gi=tn.nodeInfo,Vi=gi.node;let Ei=h.ad.mat4.multiply([],lt,tn.tileModelMatrix);h.ad.mat4.multiply(Ei,qe,Ei);const Xi=h.ad.mat4.invert([],Ei);h.ad.mat4.transpose(Xi,Xi),h.ad.mat4.scale(Xi,Xi,on),Ei=h.ad.mat4.multiply(Ei,Ei,Vi.matrix);const lo="light-beam"===se.renderPass,_o="none"===be.paint.get("model-color-use-theme").constantOr("default"),jo=xr&h.ds.HasMapboxMeshFeatures,xl=jo?0:gi.evaluatedRMEA[0][2];for(let ms=0;ms<Vi.meshes.length;++ms){const wi=Vi.meshes[ms],Tr=ms===Vi.lightMeshIndex;let Oi=tn.wvpForNode;if(Tr){if(!lo&&!se.terrain&&se.shadowRenderer){se.currentLayer<se.firstLightBeamLayer&&(se.firstLightBeamLayer=se.currentLayer);continue}Oi=tn.wvpForTile}else if(lo)continue;const $i={defines:[]},Dn=[];if(!at&&Me&&(Me.useNormalOffset=!!wi.normalBuffer),gl($i.defines,Dn,wi,se,_o?null:be.lut),jo||$i.defines.push("DIFFUSE_SHADED"),ar&&$i.defines.push("SHADOWS_SINGLE_CASCADE"),Ft&&(at?Ft.numRenderedVerticesInShadowPass+=wi.vertexArray.length:Ft.numRenderedVerticesInTransparentPass+=wi.vertexArray.length),at){_f(wi,tn.nodeModelMatrix,se,be);continue}let vr=null;if(De){const wl=Yl(tn.nodeModelMatrix,se.transform);if(vr=new Float32Array(wl),"globe"!==Ee.projection.name){const gs=wi.aabb.min,Wa=wi.aabb.max,[Mc,Xl]=De.getOpacityForBounds(wl,gs[0],gs[1],Wa[0],Wa[1]);$i.overrideFog=Mc>=Yt||Xl>=Yt}}const Gr=wi.material;let md;Gr.occlusionTexture&&Gr.occlusionTexture.offsetScale&&(md=Gr.occlusionTexture.offsetScale,$i.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const wr=se.getOrCreateProgram("model",$i);!at&&Me&&Me.setupShadowsFromMatrix(tn.tileModelMatrix,wr,Me.useNormalOffset),se.uploadCommonUniforms(we,wr,null,vr);const ea=Gr.pbrMetallicRoughness;ea.metallicFactor=.9,ea.roughnessFactor=.5;const js=kv(new Float32Array(Oi),new Float32Array(Ei),new Float32Array(Xi),new Float32Array(Vi.matrix),se,tn.opacity,ea.baseColorFactor.toRenderColor(null),Gr.emissiveFactor,ea.metallicFactor,ea.roughnessFactor,Gr,xl,be,[0,0,0],md);!Tr&&(gi.hasTranslucentParts||tn.opacity<1)&&wr.draw(se,we.gl.TRIANGLES,He,Rn.disabled,ei.disabled,Mn.backCCW,js,be.id,wi.vertexBuffer,wi.indexBuffer,wi.segments,be.paint,se.transform.zoom,void 0,Dn),wr.draw(se,we.gl.TRIANGLES,Tr?st:He,Rn.disabled,Tr||tn.opacity<1||gi.hasTranslucentParts?ei.alphaBlended:ei.unblended,Mn.backCCW,js,be.id,wi.vertexBuffer,wi.indexBuffer,wi.segments,be.paint,se.transform.zoom,void 0,Dn)}}}}()}(m,s,c,_),void F();if("model"!==N.type)return;const z=N.getModels(),U=[],j=m.transform.getFreeCameraOptions().position,W=h.ad.vec3.scale([],[j.x,j.y,j.z],m.transform.worldSize);h.ad.vec3.negate(W,W);const ne=[],J=[];let oe=0;for(const se of z){const fe=c.paint.get("model-rotation").constantOr(null),be=c.paint.get("model-scale").constantOr(null),ve=c.paint.get("model-translation").constantOr(null);se.computeModelMatrix(m,fe,be,ve,!0,!0,!1);const we=h.ad.mat4.identity([]),Ee=h.dm(se.position.lat,m.transform.zoom),De=h.ad.mat4.fromScaling([],[1,1,1/Ee]);h.ad.mat4.translate(we,we,W),U.push({zScaleMatrix:De,negCameraPosMatrix:we});for(const Me of se.nodes)eh(m.transform,Me,se.matrix,m.transform.expandedFarZProjMatrix,oe,ne,J);oe++}if(ne.sort((se,fe)=>fe.depth-se.depth),"shadow"!==m.renderPass){if(1===v)for(const se of J)cd(se,m,c,U[se.modelIndex],Rn.disabled,m.colorModeForRenderPass());else{for(const se of J)cd(se,m,c,U[se.modelIndex],Rn.disabled,ei.disabled);for(const se of J)cd(se,m,c,U[se.modelIndex],m.stencilModeFor3D(),m.colorModeForRenderPass());m.resetStencilClippingMasks()}for(const se of ne)cd(se,m,c,U[se.modelIndex],Rn.disabled,m.colorModeForRenderPass());F()}else{for(const se of J)_f(se.mesh,se.nodeModelMatrix,m,c);for(const se of ne)_f(se.mesh,se.nodeModelMatrix,m,c);F()}}},Vm={line:function(m,s,c){if(m.hasElevatedBuckets=!1,m.hasNonElevatedBuckets=!1,void 0!==m._unevaluatedLayout.getValue("line-elevation-reference")||void 0!==m._unevaluatedLayout.getValue("line-z-offset")){if(s){const _=s.getVisibleCoordinates();for(const v of _){const x=s.getTile(v).getBucket(m);if(x&&(x.hasZOffset?m.hasElevatedBuckets=!0:m.hasNonElevatedBuckets=!0,m.hasElevatedBuckets&&m.hasNonElevatedBuckets))break}}}else m.hasNonElevatedBuckets=!0},model:function(m,s,c){const _=s.getSource();if(!_.loaded())return;if("vector"===_.type||"geojson"===_.type)return void(c.modelManager&&c.modelManager.upload(c,"vector"===_.type?m.scope:""));if("batched-model"===_.type||"model"!==_.type)return;const v=_.getModels();for(const x of v)x.upload(c.context)},raster:function(m,s,c){const _=s.getSource();if(!(_ instanceof ca&&_.loaded()))return;const v=m.sourceLayer||_.rasterLayerIds&&_.rasterLayerIds[0];if(!v)return;const x=m.paint.get("raster-array-band")||_.getInitialBand(v);if(null==x)return;const E=s.getIds().map(R=>s.getTileByID(R));for(const R of E)R.updateNeeded(v,x)&&_.prepareTile(R,v,x)},"raster-particle":function(m,s,c){const _=s.getSource();if(!(_ instanceof ca&&_.loaded()))return;const v=m.sourceLayer||_.rasterLayerIds&&_.rasterLayerIds[0];if(!v)return;const x=m.paint.get("raster-particle-array-band")||_.getInitialBand(v);if(null==x)return;const E=s.getIds().map(R=>s.getTileByID(R));for(const R of E)R.updateNeeded(v,x)&&_.prepareTile(R,v,x)}},Um={fill:ff};class tp{constructor(s,c,_,v,x){this.context=new Yu(s,c),this.transform=_,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=x,this._timeStamp=h.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const E=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const F of E)this._debugParams.enabledLayers[F]=!0;x.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),x.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),x.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),x.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),x.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),x.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const F of E)x.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],F);this.occlusionParams=new yf(x),this.setup(),this.numSublayers=cs.maxUnderzooming+cs.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new h.dy,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Jc(this),this._wireframeDebugCache=new Is,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const R=new h.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new h.T(this.context,R,s.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=v}updateTerrain(s,c){const _=!!s&&!!s.terrain&&this.transform.projection.supportsTerrain;if(!(_||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new sd(this,s));const v=this._terrain;this.transform.elevation=_?v:null,v.update(s,this.transform,c),this.transform.elevation&&!v.enabled&&(this.transform.elevation=null)}_updateFog(s){const c=s.fog;if(!c||"globe"===this.transform.projection.name||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[_,v]=c.getFovAdjustedRange(this.transform._fov);if(_>v)return void(this.transform.fogCullDistSq=null);const x=_+.78*(v-_);this.transform.fogCullDistSq=x*x}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(s){s&&!this._terrain&&(this._terrain=new sd(this,this.style)),this._forceTerrainMode=s}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(s,c){if(this.width=s*h.q.devicePixelRatio,this.height=c*h.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style.order)this.style._mergedLayers[_].resize()}setup(){const s=this.context,c=new h.b5;c.emplaceBack(0,0),c.emplaceBack(h.ai,0),c.emplaceBack(0,h.ai),c.emplaceBack(h.ai,h.ai),this.tileExtentBuffer=s.createVertexBuffer(c,h.b7.members),this.tileExtentSegments=h.b8.simpleSegment(0,0,4,2);const _=new h.b5;_.emplaceBack(0,0),_.emplaceBack(h.ai,0),_.emplaceBack(0,h.ai),_.emplaceBack(h.ai,h.ai),this.debugBuffer=s.createVertexBuffer(_,h.b7.members),this.debugSegments=h.b8.simpleSegment(0,0,4,5);const v=new h.b5;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(-1,1),v.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(v,h.b7.members),this.viewportSegments=h.b8.simpleSegment(0,0,4,2);const x=new h.aU;x.emplaceBack(0,0,0,0),x.emplaceBack(h.ai,0,h.ai,0),x.emplaceBack(0,h.ai,0,h.ai),x.emplaceBack(h.ai,h.ai,h.ai,h.ai),this.mercatorBoundsBuffer=s.createVertexBuffer(x,h.ba.members),this.mercatorBoundsSegments=h.b8.simpleSegment(0,0,4,2);const E=new h.aV;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(E);const R=new h.b6;for(const N of[0,1,3,2,0])R.emplaceBack(N);this.debugIndexBuffer=s.createIndexBuffer(R),this.emptyTexture=new h.T(s,new h.r({width:1,height:1},Uint8Array.of(0,0,0,0)),s.gl.RGBA8),this.identityMat=h.ad.mat4.create();const F=this.context.gl;this.stencilClearMode=new Rn({func:F.ALWAYS,mask:0},0,255,F.ZERO,F.ZERO,F.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(s){return s._makeTileBoundsBuffers(this.context,this.transform.projection),s._tileBoundsBuffer?{tileBoundsBuffer:s._tileBoundsBuffer,tileBoundsIndexBuffer:s._tileBoundsIndexBuffer,tileBoundsSegments:s._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const s=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,s.TRIANGLES,cn.disabled,this.stencilClearMode,ei.disabled,Mn.disabled,fl(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(s,c,_){if(!c||this.currentStencilSource===c.id||!s.isTileClipped()||!_||0===_.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let R=!1;for(const F of _)if(void 0===this._tileClippingMaskIDs[F.key]){R=!0;break}if(!R)return}this.currentStencilSource=c.id;const v=this.context,x=v.gl;this.nextStencilID+_.length>256&&this.clearStencil(),v.setColorMode(ei.disabled),v.setDepthMode(cn.disabled);const E=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const R of _){const F=c.getTile(R),N=this._tileClippingMaskIDs[R.key]=this.nextStencilID++,{tileBoundsBuffer:z,tileBoundsIndexBuffer:U,tileBoundsSegments:j}=this.getTileBoundsBuffers(F);E.draw(this,x.TRIANGLES,cn.disabled,new Rn({func:x.ALWAYS,mask:0},N,255,x.KEEP,x.KEEP,x.REPLACE),ei.disabled,Mn.disabled,fl(R.projMatrix),"$clipping",z,U,j)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const s=this.nextStencilID++,c=this.context.gl;return new Rn({func:c.NOTEQUAL,mask:255},s,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(s){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(s);const c=this.context.gl;return new Rn({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(s){const c=this.context.gl,_=s.sort((E,R)=>R.overscaledZ-E.overscaledZ),v=_[_.length-1].overscaledZ,x=_[0].overscaledZ-v+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const E={};for(let R=0;R<x;R++)E[R+v]=new Rn({func:c.GEQUAL,mask:255},R+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=x,[E,_]}return[{[v]:Rn.disabled},_]}colorModeForRenderPass(){const s=this.context.gl;return this._showOverdrawInspector?new ei([s.CONSTANT_COLOR,s.ONE,s.CONSTANT_COLOR,s.ONE],new h.al(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?ei.unblended:ei.alphaBlended}colorModeForDrapableLayerRenderPass(s){const c=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&"translucent"===this.renderPass?new ei([c.ONE,c.ONE_MINUS_SRC_ALPHA,c.CONSTANT_ALPHA,c.ONE_MINUS_SRC_ALPHA],new h.al(0,0,0,void 0===s?0:s),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(s,c,_,v=!1){if(this.depthOcclusion)return new cn(this.context.gl.GREATER,cn.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!v)return cn.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new cn(_||this.context.gl.LEQUAL,c,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const s=this.context.gl,c=Math.ceil(this.width),_=Math.ceil(this.height),v=this.context.bindFramebuffer.get(),x=s.getParameter(s.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===c&&this.depthFBO.height===_||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),0!==c&&0!==_&&(this.depthFBO=new _a(this.context,c,_,!1,"texture"),this.depthTexture=new h.T(this.context,{width:c,height:_,data:null},s.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(v),s.bindTexture(s.TEXTURE_2D,x),this.depthFBO&&(s.bindFramebuffer(s.READ_FRAMEBUFFER,null),s.bindFramebuffer(s.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),s.blitFramebuffer(0,0,c,_,0,0,c,_,s.DEPTH_BUFFER_BIT,s.NEAREST),s.bindFramebuffer(s.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(0===this._dt?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((s,c)=>s+c/this._fpsHistory.length,0))}render(s,c){const _=h.q.now();this._dt=_-this._timeStamp,this._timeStamp=_,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=s.map.repaint,this.style=s,this.options=c;const v=this.style._mergedLayers,x=!(!this.terrain||!this.terrain.enabled),E=()=>this.style._getOrder(x).filter(He=>{const st=v[He];return!(st.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[st.type]});let R=E(),F=!1,N=!1;for(const He of R){const st=v[He];"circle"===st.type&&(F=!0),"symbol"===st.type&&(st.hasInitialOcclusionOpacityProperties?N=!0:F=!0)}let z=R.map(He=>v[He]);const U=this.style._mergedSourceCaches;this.imageManager=s.imageManager,this.modelManager=s.modelManager,this.symbolFadeChange=s.placement.symbolFadeChange(h.q.now()),this.imageManager.beginFrame();let j=0,W=!1;for(const He in U){const st=U[He];st.used&&(st.prepare(this.context),st.getSource().usedInConflation&&++j)}let ne=!1;for(const He of z)He.isHidden(this.transform.zoom)||("clip"===He.type&&(ne=!0),this.prepareLayer(He));const J={},oe={},se={},fe={},be={};for(const He in U){const st=U[He];J[He]=st.getVisibleCoordinates(),oe[He]=J[He].slice().reverse(),se[He]=st.getVisibleCoordinates(!0).reverse(),fe[He]=st.getShadowCasterCoordinates(),be[He]=st.sortCoordinatesByDistance(J[He])}const ve=He=>{const st=this.style.getLayerSourceCache(He);return st&&st.used?st.getSource():null};if(j||ne||this._clippingActiveLastFrame){const He=[],st=[];let Be=0;for(const at of z)this.isSourceForClippingOrConflation(at,ve(at))&&(He.push(at),st.push(Be)),Be++;if(He&&(ne||He.length>1)||this._clippingActiveLastFrame){ne=!1;const at=[];for(let rt=0;rt<He.length;rt++){const $e=He[rt],Je=st[rt],dt=this.style.getLayerSourceCache($e);if(!dt||!dt.used||!dt.getSource().usedInConflation&&"clip"!==$e.type)continue;let Ft=h.dA,zt=h.by.None;const Bt=[];let en=!0;if("clip"===$e.type){Ft=Je;for(const In of $e.layout.get("clip-layer-types"))zt|="model"===In?h.by.Model:"symbol"===In?h.by.Symbol:h.by.FillExtrusion;for(const In of $e.layout.get("clip-layer-scope"))Bt.push(In);$e.isHidden(this.transform.zoom)?en=!1:ne=!0}en&&at.push({layer:$e.fqid,cache:dt,order:Ft,clipMask:zt,clipScope:Bt})}this.replacementSource.setSources(at),W=!0}}this._clippingActiveLastFrame=ne,W||this.replacementSource.clear(),this.conflationActive=W,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let He=0;He<z.length;He++){const st=z[He],Be=st.cutoffRange();if(this.longestCutoffRange=Math.max(Be,this.longestCutoffRange),Be>0){const at=ve(st);at&&(this.minCutoffZoom=Math.max(at.minzoom,this.minCutoffZoom)),st.minzoom&&(this.minCutoffZoom=Math.max(st.minzoom,this.minCutoffZoom))}st.is3D(x)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=He),this._lastOcclusionLayer=He)}const we=this.style&&this.style.fog;we?(this._fogVisible=0!==we.getOpacity(this.transform.pitch),this._fogVisible&&"globe"!==this.transform.projection.name&&(this._fogVisible=we.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(se),this.opaquePassCutoff=0,R=E(),z=R.map(He=>v[He]));const Ee=this._shadowRenderer;if(Ee){Ee.updateShadowParameters(this.transform,this.style.directionalLight);for(const He in U)for(const st of J[He]){let Be={min:0,max:0};this.terrain&&(Be=this.terrain.getMinMaxForTile(st)||Be),Ee.addShadowReceiver(st.toUnwrapped(),Be.min,Be.max)}}"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new h.dz(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Nv(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const De=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),Me=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(De&&!this._snow&&(this._snow=new Jh(this)),!De&&this._snow&&(this._snow.destroy(),delete this._snow),Me&&!this._rain&&(this._rain=new ya(this)),!Me&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!Lh.has(this.context.gl))return;this.renderPass="offscreen";for(const He of z){const st=s.getLayerSourceCache(He);if(!He.hasOffscreenPass()||He.isHidden(this.transform.zoom))continue;const Be=st?oe[st.id]:void 0;("custom"===He.type||"raster"===He.type||"raster-particle"===He.type||He.isSky()||Be&&Be.length)&&this.renderLayer(this,st,He,Be)}this.depthRangeFor3D=[0,1-(z.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,fe)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const ke="globe"===this.transform.projection.name||this.transform.isHorizonVisible(),Oe=(()=>{if(c.showOverdrawInspector)return h.al.black;const He=this.style.fog;if(He&&this.transform.projection.supportsFog){const st=this.style.getLut(He.scope);if(!ke){const Be="none"===He.properties.get("color-use-theme"),at=He.properties.get("color").toRenderColor(Be?null:st).toArray01();return new h.al(...at)}if(ke){const Be="none"===He.properties.get("space-color-use-theme"),at=He.properties.get("space-color").toRenderColor(Be?null:st).toArray01();return new h.al(...at)}}return h.al.transparent})();if(this.context.clear({color:Oe,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ke&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=R.length-1;this.currentLayer>=0;this.currentLayer--){const He=z[this.currentLayer],st=s.getLayerSourceCache(He);if(He.isSky())continue;const Be=st?(He.is3D(x)?be:oe)[st.id]:void 0;this._renderTileClippingMasks(He,st,Be),this.renderLayer(this,st,He,Be)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ke&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||h.ag(this.transform.zoom)>0)&&("globe"===this.transform.projection.name||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<R.length;this.currentLayer++){const He=z[this.currentLayer],st=s.getLayerSourceCache(He);He.isSky()&&this.renderLayer(this,st,He,st?oe[st.id]:void 0)}function et(He,st){let Be;return st&&(Be=("symbol"===He.type?se:He.is3D(x)?be:oe)[st.id]),Be}if(this.renderPass="translucent","globe"===this.transform.projection.name){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<R.length;){const He=z[this.currentLayer];if("raster"===He.type||"raster-particle"===He.type){const st=s.getLayerSourceCache(He);this.renderLayer(this,st,He,et(He,st))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let qe=0;Ee&&(qe=Ee.getShadowCastingLayerCount());let ot=!1,lt=-1;for(let He=0;He<R.length;++He){const st=z[He];st.isHidden(this.transform.zoom)||st.is3D(x)&&(lt=He)}N&&-1===lt&&(F=!0);let Ct=!1;for(;this.currentLayer<R.length;){const He=z[this.currentLayer],st=s.getLayerSourceCache(He);if(He.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(He)){if(He.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!Ct&&He.is3D(x)&&!x){const Be=this.currentLayer,at=rt=>{for(this.currentLayer=0;this.currentLayer<z.length;this.currentLayer++){const $e=z[this.currentLayer];if(Um[$e.type]){const Je=this.style.getLayerSourceCache($e);Um[$e.type](this,Je,$e,et($e,Je),rt)}}};at("initialize"),at("reset"),this.currentLayer=Be,Ct=!0}if(F&&!ot&&this.terrain&&!this.transform.isOrthographic&&(ot=!0,this.blitDepth()),N&&-1!==lt&&this.currentLayer===lt+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(He,st,st?J[st.id]:void 0),this.renderLayer(this,st,He,et(He,st)),!this.terrain&&Ee&&qe>0&&He.hasShadowPass()&&0==--qe&&(Ee.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const Be=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Be;this.currentLayer++){const at=z[this.currentLayer];if(!at.hasLightBeamPass())continue;const rt=s.getLayerSourceCache(at);this.renderLayer(this,rt,at,rt?oe[rt.id]:void 0)}this.currentLayer=Be,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Be=this.currentLayer;this.depthOcclusion=!0;for(const at of this.layersWithOcclusionOpacity){this.currentLayer=at;const rt=z[this.currentLayer],$e=s.getLayerSourceCache(rt),Je=$e?oe[$e.id]:void 0;this.terrain||this._renderTileClippingMasks(rt,$e,$e?J[$e.id]:void 0),this.renderLayer(this,$e,rt,Je)}this.depthOcclusion=!1,this.currentLayer=Be,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let He=null;z.forEach(st=>{const Be=s.getLayerSourceCache(st);Be&&!st.isHidden(this.transform.zoom)&&Be.getVisibleCoordinates().length&&(!He||He.getSource().maxzoom<Be.getSource().maxzoom)&&(He=Be)}),He&&this.options.showTileBoundaries&&ep.debug(this,He,He.getVisibleCoordinates(),h.al.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&ep.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new h.al(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(He){const st=He.transform.padding;Kh(He,He.transform.height-(st.top||0),3,Qu),Kh(He,st.bottom||0,3,f_),gf(He,st.left||0,3,Lv),gf(He,He.transform.width-(st.right||0),3,Zh);const Be=He.transform.centerPoint;var at,rt,$e,Je;Js(at=He,(rt=Be.x)-1,($e=He.transform.height-Be.y)-10,2,20,Je=Xh),Js(at,rt-10,$e-1,20,2,Je)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),W||(this.conflationActive=!1)}prepareLayer(s){this.gpuTimingStart(s);const{unsupportedLayers:c}=this.transform.projection,_=!c||!c.includes(s.type);if(Vm[s.type]&&(_||this.terrain&&"custom"===s.type)){const v=this.style.getLayerSourceCache(s);Vm[s.type](s,v,this)}this.gpuTimingEnd()}renderLayer(s,c,_,v){_.isHidden(this.transform.zoom)||("background"===_.type||"sky"===_.type||"custom"===_.type||"model"===_.type||"raster"===_.type||"raster-particle"===_.type||v&&v.length)&&(this.id=_.id,this.gpuTimingStart(_),s.transform.projection.unsupportedLayers&&s.transform.projection.unsupportedLayers.includes(_.type)&&(!s.terrain||"custom"!==_.type)||"clip"===_.type||ep[_.type](s,c,_,v,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(s){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery,_=this.context.gl;let v=this.gpuTimers[s.id];v||(v=this.gpuTimers[s.id]={calls:0,cpuTime:0,query:_.createQuery()}),v.calls++,_.beginQuery(c.TIME_ELAPSED_EXT,v.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const s=this.context.extTimerQuery,c=this.context.gl,_=c.createQuery();this.deferredRenderGpuTimeQueries.push(_),c.beginQuery(s.TIME_ELAPSED_EXT,_)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const s=this.gpuTimers;return this.gpuTimers={},s}collectDeferredRenderGpuQueries(){const s=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],s}queryGpuTimers(s){const c={};for(const _ in s){const v=s[_],x=this.context.extTimerQuery,E=x.getQueryParameter(v.query,this.context.gl.QUERY_RESULT)/1e6;x.deleteQueryEXT(v.query),c[_]=E}return c}queryGpuTimeDeferredRender(s){if(!this.options.gpuTimingDeferredRender)return 0;const c=this.context.gl;let _=0;for(const v of s)_+=c.getQueryParameter(v,c.QUERY_RESULT)/1e6,c.deleteQuery(v);return _}translatePosMatrix(s,c,_,v,x){if(!_[0]&&!_[1])return s;const E=x?"map"===v?this.transform.angle:0:"viewport"===v?-this.transform.angle:0;if(E){const N=Math.sin(E),z=Math.cos(E);_=[_[0]*z-_[1]*N,_[0]*N+_[1]*z]}const R=[x?_[0]:h.at(c,_[0],this.transform.zoom),x?_[1]:h.at(c,_[1],this.transform.zoom),0],F=new Float32Array(16);return h.ad.mat4.translate(F,s,R),F}saveTileTexture(s){const c=s.size[0],_=this._tileTextures[c];_?_.push(s):this._tileTextures[c]=[s]}getTileTexture(s){const c=this._tileTextures[s];return c&&c.length>0?c.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return null!=this.context.extTextureFloatLinear}currentGlobalDefines(s,c,_){const v=void 0===_?this.terrain&&this.terrain.renderingToTexture:_,x=[];return this.style&&this.style.enable3dLights()&&("globeRaster"===s||"terrainRaster"===s?(x.push("LIGHTING_3D_MODE"),x.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):v||x.push("LIGHTING_3D_MODE")),"shadow"===this.renderPass&&(this._shadowMapDebug||x.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(x.push("TERRAIN"),this.linearFloatFilteringSupported()&&x.push("TERRAIN_DEM_FLOAT_FORMAT")),"globe"===this.transform.projection.name&&x.push("GLOBE"),!this._fogVisible||v||void 0!==c&&!c||x.push("FOG","FOG_DITHERING"),v&&x.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&x.push("OVERDRAW_INSPECTOR"),x}getOrCreateProgram(s,c){this.cache=this.cache||{};const _=c&&c.defines||[],v=c&&c.config,x=this.currentGlobalDefines(s,c&&c.overrideFog,c&&c.overrideRtt).concat(_),E=Wu.cacheKey(rf[s],s,x,v);return this.cache[E]||(this.cache[E]=new Wu(this.context,s,rf[s],v,Rv[s],x)),this.cache[E]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new h.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(s,c){if(this.style.enable3dLights()){const _=this.style.directionalLight,v=this.style.ambientLight;if(_&&v){const x=((E,R,F)=>{const N=E.properties.get("direction"),z="none"===E.properties.get("color-use-theme"),U=E.properties.get("color").toRenderColor(z?null:F.getLut(E.scope)).toArray01(),j=E.properties.get("intensity"),W="none"===R.properties.get("color-use-theme"),ne=R.properties.get("color").toRenderColor(W?null:F.getLut(R.scope)).toArray01(),J=R.properties.get("intensity"),oe=[N.x,N.y,N.z],se=h.cN(ne,J),fe=h.cN(U,j);return{u_lighting_ambient_color:se,u_lighting_directional_dir:oe,u_lighting_directional_color:fe,u_ground_radiance:af(oe,fe,se)}})(_,v,this.style);c.setLightsUniformValues(s,x)}}}uploadCommonUniforms(s,c,_,v,x){if(this.uploadCommonLightUniforms(s,c),this.terrain&&this.terrain.renderingToTexture)return;const E=this.style.fog;if(E){const R=E.getOpacity(this.transform.pitch),F=((N,z,U,j,W,ne,J,oe,se,fe,be,ve)=>{const we=N.transform,Ee="none"===z.properties.get("color-use-theme"),De=z.properties.get("color").toRenderColor(Ee?null:N.style.getLut(z.scope)).toArray01();De[3]=j;const Me=N.frameCounter/1e3%1,[ke,Oe]=z.properties.get("vertical-range");return{u_fog_matrix:U?we.calculateFogTileMatrix(U):ve||N.identityMat,u_fog_range:z.getFovAdjustedRange(we._fov),u_fog_color:De,u_fog_horizon_blend:z.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(ke,Oe),Oe],u_fog_temporal_offset:Me,u_frustum_tl:W,u_frustum_tr:ne,u_frustum_br:J,u_frustum_bl:oe,u_globe_pos:se,u_globe_radius:fe,u_viewport:be,u_globe_transition:h.ag(we.zoom),u_is_globe:+("globe"===we.projection.name)}})(this,E,_,R,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*h.q.devicePixelRatio,this.transform.height*h.q.devicePixelRatio],v);c.setFogUniformValues(s,F)}x&&c.setCutoffUniformValues(s,x.uniformValues)}setTileLoadedFlag(s){this.tileLoaded=s}saveCanvasCopy(){const s=this.canvasCopy();s&&(this.frameCopies.push(s),this.tileLoaded=!1)}canvasCopy(){const s=this.context.gl,c=s.createTexture();return s.bindTexture(s.TEXTURE_2D,c),s.copyTexImage2D(s.TEXTURE_2D,0,s.RGBA,0,0,s.drawingBufferWidth,s.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const s=this.style&&this.style.fog;return!!s&&0!==s.getOpacity(this.transform.pitch)}getBackgroundTiles(){const s=this._backgroundTiles,c=this._backgroundTiles={},_=this.transform.coveringTiles({tileSize:512});for(const v of _)c[v.key]=s[v.key]||new po(v,512,this.transform.tileZoom,this);return c}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(s,c){return!(!s.is3D(!(!this.terrain||!this.terrain.enabled))||"clip"!==s.type&&(s.minzoom&&s.minzoom>this.transform.zoom||(this.style._clipLayerPresent||"building"!==s.sourceLayer)&&(!c||"batched-model"!==c.type)))}isTileAffectedByFog(s){if(!this.style||!this.style.fog)return!1;if("globe"===this.transform.projection.name)return!0;let c=this._cachedTileFogOpacities[s.key];return c||(this._cachedTileFogOpacities[s.key]=c=this.style.fog.getOpacityForTile(s)),c[0]>=Yt||c[1]>=Yt}setupDepthForOcclusion(s,c,_){const v=this.context,x=v.gl,E=!!_;var R;_||(_={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),v.activeTexture.set(x.TEXTURE3),s&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),_.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],_.u_depth_range_unpack=[2/((R=this.depthRangeFor3D)[1]-R[0]),-1-2*R[0]/(R[1]-R[0])],_.u_occluder_half_size=.5*this.occlusionParams.occluderSize,_.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),v.activeTexture.set(x.TEXTURE0),E||c.setTerrainUniformValues(v,_)}}function np(m,s){let c=!1,_=null;const v=()=>{_=null,c&&(m(),_=setTimeout(v,s),c=!1)};return()=>(c=!0,_||v(),_)}class bf{constructor(s){this._hashName=s&&encodeURIComponent(s),h.aQ(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=np(this._updateHashUnthrottled.bind(this),300)}addTo(s){return this._map=s,window.addEventListener("hashchange",this._onHashChange,!1),s.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const s=this._map;if(!s)return"";const c=ip(s);if(this._hashName){const _=this._hashName;let v=!1;const x=location.hash.slice(1).split("&").map(E=>{const R=E.split("=")[0];return R===_?(v=!0,`${R}=${c}`):E}).filter(E=>E);return v||x.push(`${_}=${c}`),`#${x.join("&")}`}return`#${c}`}_getCurrentHash(){const s=location.hash.replace("#","");if(this._hashName){let c;return s.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(c=_)}),(c&&c[1]||"").split("/")}return s.split("/")}_onHashChange(){const s=this._map;if(!s)return!1;const c=this._getCurrentHash();if(c.length>=3&&!c.some(_=>isNaN(_))){const _=s.dragRotate.isEnabled()&&s.touchZoomRotate.isEnabled()?+(c[3]||0):s.getBearing();return s.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:_,pitch:+(c[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function ip(m,s){const c=m.getCenter(),_=Math.round(100*m.getZoom())/100,v=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,v),E=Math.round(c.lng*x)/x,R=Math.round(c.lat*x)/x,F=m.getBearing(),N=m.getPitch();let z=s?`/${E}/${R}/${_}`:`${_}/${R}/${E}`;return(F||N)&&(z+="/"+Math.round(10*F)/10),N&&(z+=`/${Math.round(N)}`),z}const xf={linearity:.3,easing:h.dB(0,0,.3,1)},__=h.l({deceleration:2500,maxSpeed:1400},xf),jm=h.l({deceleration:20,maxSpeed:1400},xf),y_=h.l({deceleration:1e3,maxSpeed:360},xf),v_=h.l({deceleration:1e3,maxSpeed:90},xf);class b_{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:h.q.now(),settings:s})}_drainInertiaBuffer(){const s=this._inertiaBuffer,c=h.q.now();for(;s.length>0&&c-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const c={zoom:0,bearing:0,pitch:0,pan:new h.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)c.zoom+=x.zoomDelta||0,c.bearing+=x.bearingDelta||0,c.pitch+=x.pitchDelta||0,x.panDelta&&c.pan._add(x.panDelta),x.around&&(c.around=x.around),x.pinchAround&&(c.pinchAround=x.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(c.pan.mag()){const x=ih(c.pan.mag(),_,h.l({},__,s||{}));v.offset=c.pan.mult(x.amount/c.pan.mag()),v.center=this._map.transform.center,rp(v,x)}if(c.zoom){const x=ih(c.zoom,_,jm);v.zoom=this._map.transform.zoom+x.amount,rp(v,x)}if(c.bearing){const x=ih(c.bearing,_,y_);v.bearing=this._map.transform.bearing+h.ay(x.amount,-179,179),rp(v,x)}if(c.pitch){const x=ih(c.pitch,_,v_);v.pitch=this._map.transform.pitch+x.amount,rp(v,x)}if(v.zoom||v.bearing){const x=void 0===c.pinchAround?c.around:c.pinchAround;v.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),v.noMoveStart=!0,v}}function rp(m,s){(!m.duration||m.duration<s.duration)&&(m.duration=s.duration,m.easing=s.easing)}function ih(m,s,c){const{maxSpeed:_,linearity:v,deceleration:x}=c,E=h.ay(m*v/(s/1e3),-_,_),R=Math.abs(E)/(x*v);return{easing:c.easing,duration:1e3*R,amount:E*(R/2)}}class va extends h.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,c,_,v={}){const x=Aa(c.getCanvasContainer(),_),E=c.unproject(x);super(s,h.l({point:x,lngLat:E,originalEvent:_},v)),this._defaultPrevented=!1,this.target=c}}class Ao extends h.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,c,_){const v="touchend"===s?_.changedTouches:_.touches,x=pc(c.getCanvasContainer(),v),E=x.map(F=>c.unproject(F)),R=x.reduce((F,N,z,U)=>F.add(N.div(U.length)),new h.P(0,0));super(s,{points:x,point:R,lngLats:E,lngLat:c.unproject(R),originalEvent:_}),this._defaultPrevented=!1}}class nu extends h.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,c){super("wheel",{originalEvent:c}),this._defaultPrevented=!1}}class Vr{constructor(s,c){this._map=s,this._clickTolerance=c.clickTolerance}reset(){this._mousedownPos=void 0}wheel(s){return this._firePreventable(new nu(this._map,s))}mousedown(s,c){return this._mousedownPos=c,this._firePreventable(new va(s.type,this._map,s))}mouseup(s){this._map.fire(new va(s.type,this._map,s))}preclick(s){const c=h.l({},s);c.type="preclick",this._map.fire(new va(c.type,this._map,c))}click(s,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(s),this._map.fire(new va(s.type,this._map,s)))}dblclick(s){return this._firePreventable(new va(s.type,this._map,s))}mouseover(s){this._map.fire(new va(s.type,this._map,s))}mouseout(s){this._map.fire(new va(s.type,this._map,s))}touchstart(s){return this._firePreventable(new Ao(s.type,this._map,s))}touchmove(s){this._map.fire(new Ao(s.type,this._map,s))}touchend(s){this._map.fire(new Ao(s.type,this._map,s))}touchcancel(s){this._map.fire(new Ao(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ba{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(s){this._map.fire(new va(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new va("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._map.fire(new va(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ex{constructor(s,c){this._map=s,this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,c){this.isEnabled()&&s.shiftKey&&0===s.button&&(Li(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(s,c){if(!this._active)return;const _=c,v=this._startPos,x=this._lastPos;if(!v||!x||x.equals(_)||!this._box&&_.dist(v)<this._clickTolerance)return;this._lastPos=_,this._box||(this._box=ri("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",s));const E=Math.min(v.x,_.x),R=Math.max(v.x,_.x),F=Math.min(v.y,_.y),N=Math.max(v.y,_.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${E}px,${F}px)`,this._box.style.width=R-E+"px",this._box.style.height=N-F+"px")})}mouseupWindow(s,c){if(!this._active)return;const _=this._startPos,v=c;if(_&&0===s.button){if(this.reset(),Sn(),_.x!==v.x||_.y!==v.y)return this._map.fire(new h.A("boxzoomend",{originalEvent:s})),{cameraAnimation:x=>x.fitScreenCoordinates(_,v,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",s)}}keydown(s){this._active&&27===s.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",s))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ld(),delete this._startPos,delete this._lastPos}_fireEvent(s,c){return this._map.fire(new h.A(s,{originalEvent:c}))}}function hr(m,s){const c={};for(let _=0;_<m.length;_++)c[m[_].identifier]=s[_];return c}class Bv{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(s,c,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=s.timeStamp),_.length===this.numTouches&&(this.centroid=function(v){const x=new h.P(0,0);for(const E of v)x._add(E);return x.div(v.length)}(c),this.touches=hr(_,c)))}touchmove(s,c,_){if(this.aborted||!this.centroid)return;const v=hr(_,c);for(const x in this.touches){const E=v[x];(!E||E.dist(this.touches[x])>30)&&(this.aborted=!0)}}touchend(s,c,_){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),0===_.length){const v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class Hm{constructor(s){this.singleTap=new Bv(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(s,c,_){this.singleTap.touchstart(s,c,_)}touchmove(s,c,_){this.singleTap.touchmove(s,c,_)}touchend(s,c,_){const v=this.singleTap.touchend(s,c,_);if(v){const x=s.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(v)<30;if(x&&E||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class Vv{constructor(){this._zoomIn=new Hm({numTouches:1,numTaps:2}),this._zoomOut=new Hm({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,c,_){this._zoomIn.touchstart(s,c,_),this._zoomOut.touchstart(s,c,_)}touchmove(s,c,_){this._zoomIn.touchmove(s,c,_),this._zoomOut.touchmove(s,c,_)}touchend(s,c,_){const v=this._zoomIn.touchend(s,c,_),x=this._zoomOut.touchend(s,c,_);return v?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(v)},{originalEvent:s})}):x?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(x)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const dd={0:1,2:2},yl={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class wf{constructor(s){this.reset(),this._clickTolerance=s.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(s,c){return!1}_move(s,c){return{}}mousedown(s,c){if(this._lastPoint)return;const _=On(s);this._correctButton(s,_)&&(this._lastPoint=c,this._eventButton=_)}mousemoveWindow(s,c){const _=this._lastPoint;if(_)if(s.preventDefault(),null!=this._eventButton&&function(v,x){const E=dd[x];return void 0===v.buttons||(v.buttons&E)!==E}(s,this._eventButton))this.reset();else if(this._moved||!(c.dist(_)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(_,c)}mouseupWindow(s){this._lastPoint&&On(s)===this._eventButton&&(this._moved&&Sn(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class op extends wf{mousedown(s,c){super.mousedown(s,c),this._lastPoint&&(this._active=!0)}_correctButton(s,c){return 0===c&&!s.ctrlKey}_move(s,c){return{around:c,panDelta:c.sub(s)}}}class Ha extends wf{constructor(s){super(s),this._pitchRotateKey=s.pitchRotateKey?yl[s.pitchRotateKey]:void 0}_correctButton(s,c){return this._pitchRotateKey?0===c&&s[this._pitchRotateKey]:0===c&&s.ctrlKey||2===c}_move(s,c){const _=.8*(c.x-s.x);if(_)return this._active=!0,{bearingDelta:_}}contextmenu(s){this._pitchRotateKey||s.preventDefault()}}class iu extends wf{constructor(s){super(s),this._pitchRotateKey=s.pitchRotateKey?yl[s.pitchRotateKey]:void 0}_correctButton(s,c){return this._pitchRotateKey?0===c&&s[this._pitchRotateKey]:0===c&&s.ctrlKey||2===c}_move(s,c){const _=-.5*(c.y-s.y);if(_)return this._active=!0,{pitchDelta:_}}contextmenu(s){this._pitchRotateKey||s.preventDefault()}}class $r{constructor(s,c){this._map=s,this._el=s.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),h.aQ(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new h.P(0,0)}touchstart(s,c,_){return this._calculateTransform(s,c,_)}touchmove(s,c,_){if(this._active&&!(_.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===_.length&&!h.dC())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return s.cancelable&&s.preventDefault(),this._calculateTransform(s,c,_)}}touchend(s,c,_){this._calculateTransform(s,c,_),this._active&&_.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,c,_){_.length>0&&(this._active=!0);const v=hr(_,c),x=new h.P(0,0),E=new h.P(0,0);let R=0;for(const N in v){const z=v[N],U=this._touches[N];U&&(x._add(z),E._add(z.sub(U)),R++,v[N]=z)}if(this._touches=v,R<this._minTouches||!E.mag())return;const F=E.div(R);return this._sum._add(F),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(R),panDelta:F}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ri("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class $a{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(s){}_move(s,c,_){return{}}touchstart(s,c,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([c[0],c[1]]))}touchmove(s,c,_){const v=this._firstTwoTouches;if(!v)return;s.preventDefault();const[x,E]=v,R=rh(_,c,x),F=rh(_,c,E);if(!R||!F)return;const N=this._aroundCenter?null:R.add(F).div(2);return this._move([R,F],N,s)}touchend(s,c,_){if(!this._firstTwoTouches)return;const[v,x]=this._firstTwoTouches,E=rh(_,c,v),R=rh(_,c,x);E&&R||(this._active&&Sn(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&"center"===s.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function rh(m,s,c){for(let _=0;_<m.length;_++)if(m[_].identifier===c)return s[_]}function Cf(m,s){return Math.log(m/s)/Math.LN2}class oh extends $a{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,c){const _=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(Cf(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Cf(this._distance,_),pinchAround:c}}}function sp(m,s){return 180*m.angleWith(s)/Math.PI}class sh extends $a{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,c){const _=this._vector;if(this._vector=s[0].sub(s[1]),_&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:sp(this._vector,_),pinchAround:c}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());const c=25/(Math.PI*this._minDiameter)*360,_=this._startVector;if(!_)return!1;const v=sp(s,_);return Math.abs(v)<c}}function Ef(m){return Math.abs(m.y)>Math.abs(m.x)}class Sx extends $a{constructor(s){super(),this._map=s}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(s){this._lastPoints=s,Ef(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,c,_){const v=this._lastPoints;if(!v)return;const x=s[0].sub(v[0]),E=s[1].sub(v[1]);return this._map._cooperativeGestures&&!h.dC()&&_.touches.length<3||(this._valid=this.gestureBeginsVertically(x,E,_.timeStamp),!this._valid)?void 0:(this._lastPoints=s,this._active=!0,{pitchDelta:(x.y+E.y)/2*-.5})}gestureBeginsVertically(s,c,_){if(void 0!==this._valid)return this._valid;const v=s.mag()>=2,x=c.mag()>=2;if(!v&&!x)return;if(!v||!x)return null==this._firstMove&&(this._firstMove=_),_-this._firstMove<100&&void 0;const E=s.y>0==c.y>0;return Ef(s)&&Ef(c)&&E}}const x_={panStep:100,bearingStep:15,pitchStep:10};class w_{constructor(){const s=x_;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let c=0,_=0,v=0,x=0,E=0;switch(s.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:s.shiftKey?_=-1:(s.preventDefault(),x=-1);break;case 39:s.shiftKey?_=1:(s.preventDefault(),x=1);break;case 38:s.shiftKey?v=1:(s.preventDefault(),E=-1);break;case 40:s.shiftKey?v=-1:(s.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(_=0,v=0),{cameraAnimation:R=>{const F=R.getZoom();R.easeTo({duration:300,easeId:"keyboardHandler",easing:$m,zoom:c?Math.round(F)+c*(s.shiftKey?2:1):F,bearing:R.getBearing()+_*this._bearingStep,pitch:R.getPitch()+v*this._pitchStep,offset:[-x*this._panStep,-E*this._panStep],center:R.getCenter()},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function $m(m){return m*(2-m)}const ap=4.000244140625,ud=1/450;class vl{constructor(s,c){this._map=s,this._el=s.getCanvasContainer(),this._handler=c,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=ud,h.aQ(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!s&&"center"===s.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(s){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(s.ctrlKey||s.metaKey||this.isZooming()||h.dC()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=s.deltaMode===WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;const _=h.q.now(),v=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,0!==c&&c%ap==0?this._type="wheel":0!==c&&Math.abs(c)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=c,this._timeout=window.setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(v*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),s.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=s,this._delta-=c,this._active||this._start(s)),s.preventDefault()}_onTimeout(s){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(s)}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=Aa(this._el,s);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const s=this._map.transform;"wheel"===this._type&&s.projection.wrap&&(s._center.lng>=180||s._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const c=()=>s._terrainEnabled()&&this._aroundCoord?s.computeZoomRelativeTo(this._aroundCoord):s.zoom;if(0!==this._delta){const N="wheel"===this._type&&Math.abs(this._delta)>ap?this._wheelZoomRate:this._defaultZoomRate;let z=2/(1+Math.exp(-Math.abs(this._delta*N)));this._delta<0&&0!==z&&(z=1/z);const U=c(),j=Math.pow(2,U),W="number"==typeof this._targetZoom?s.zoomScale(this._targetZoom):j;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(W*z))),"wheel"===this._type&&(this._startZoom=U,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const _="number"==typeof this._targetZoom?this._targetZoom:c(),v=this._startZoom,x=this._easing;let E,R=!1;if("wheel"===this._type&&v&&x){const N=Math.min((h.q.now()-this._lastWheelEventTime)/200,1),z=x(N);E=h.ah(v,_,z),N<1?this._frameId||(this._frameId=!0):R=!0}else E=_,R=!0;this._active=!0,R&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let F=E-c();return F*this._lastDelta<0&&(F=0),{noInertia:!0,needsRenderFrame:!R,zoomDelta:F,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let c=h.dD;if(this._prevEase){const _=this._prevEase,v=(h.q.now()-_.start)/_.duration,x=_.easing(v+.01)-_.easing(v),E=.27/Math.sqrt(x*x+1e-4)*.01,R=Math.sqrt(.0729-E*E);c=h.dB(E,R,.25,1)}return this._prevEase={start:h.q.now(),duration:s,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ri("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class hd{constructor(s,c){this._clickZoom=s,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class bl{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(s,c){return s.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:_.getZoom()+(s.shiftKey?-1:1),around:_.unproject(c)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class pd{constructor(){this._tap=new Hm({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(s,c,_){this._swipePoint||(this._tapTime&&s.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_.length>0&&(this._swipePoint=c[0],this._swipeTouch=_[0].identifier):this._tap.touchstart(s,c,_))}touchmove(s,c,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const v=c[0],x=v.y-this._swipePoint.y;return this._swipePoint=v,s.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(s,c,_)}touchend(s,c,_){this._tapTime?this._swipePoint&&0===_.length&&this.reset():this._tap.touchend(s,c,_)&&(this._tapTime=s.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class C_{constructor(s,c,_){this._el=s,this._mousePan=c,this._touchPan=_}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Sf{constructor(s,c,_){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=c,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Dx{constructor(s,c,_,v){this._el=s,this._touchZoom=c,this._touchRotate=_,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ru=m=>m.zoom||m.drag||m.pitch||m.rotate;class Gm extends h.A{}class ts{constructor(){this.constants=[1,1,.01],this.radius=0}setup(s,c){const _=h.ad.vec3.sub([],c,s);this.radius=h.ad.vec3.length(_[2]<0?h.ad.vec3.div([],_,this.constants):[_[0],_[1],0])}projectRay(s){h.ad.vec3.div(s,s,this.constants),h.ad.vec3.normalize(s,s),h.ad.vec3.mul(s,s,this.constants);const c=h.ad.vec3.scale([],s,this.radius);if(c[2]>0){const _=h.ad.vec3.scale([],[0,0,1],h.ad.vec3.dot(c,[0,0,1])),v=h.ad.vec3.scale([],h.ad.vec3.normalize([],[c[0],c[1],0]),this.radius),x=h.ad.vec3.add([],c,h.ad.vec3.scale([],h.ad.vec3.sub([],h.ad.vec3.add([],v,_),c),2));c[0]=x[0],c[1]=x[1]}return c}}function Df(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class E_{constructor(s,c){this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new b_(s),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new ts,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),h.aQ(["handleEvent","handleWindowEvent"],this);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[window,"blur",void 0]];for(const[v,x,E]of this._listeners){const R=v===document?this.handleWindowEvent:this.handleEvent;v.addEventListener(x,R,E)}}destroy(){for(const[s,c,_]of this._listeners){const v=s===document?this.handleWindowEvent:this.handleEvent;s.removeEventListener(c,v,_)}}_addDefaultHandlers(s){const c=this._map,_=c.getCanvasContainer();this._add("mapEvent",new Vr(c,s));const v=c.boxZoom=new Ex(c,s);this._add("boxZoom",v);const x=new Vv,E=new bl;c.doubleClickZoom=new hd(E,x),this._add("tapZoom",x),this._add("clickZoom",E);const R=new pd;this._add("tapDragZoom",R);const F=c.touchPitch=new Sx(c);this._add("touchPitch",F);const N=new Ha(s),z=new iu(s);c.dragRotate=new Sf(s,N,z),this._add("mouseRotate",N,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]);const U=new op(s),j=new $r(c,s);c.dragPan=new C_(_,U,j),this._add("mousePan",U),this._add("touchPan",j,["touchZoom","touchRotate"]);const W=new sh,ne=new oh;c.touchZoomRotate=new Dx(_,ne,W,R),this._add("touchRotate",W,["touchPan","touchZoom"]),this._add("touchZoom",ne,["touchPan","touchRotate"]),this._add("blockableMapEvent",new ba(c));const J=c.scrollZoom=new vl(c,this);this._add("scrollZoom",J,["mousePan"]);const oe=c.keyboard=new w_;this._add("keyboard",oe);for(const se of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])s.interactive&&s[se]&&c[se].enable(s[se])}_add(s,c,_){this._handlers.push({handlerName:s,handler:c,allowed:_}),this._handlersById[s]=c}stop(s){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ru(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(s,c,_){for(const v in s)if(v!==_&&(!c||c.indexOf(v)<0))return!0;return!1}handleWindowEvent(s){this.handleEvent(s,`${s.type}Window`)}_getMapTouches(s){const c=[];for(const _ of s)this._el.contains(_.target)&&c.push(_);return c}handleEvent(s,c){this._updatingCamera=!0;const _="renderFrame"===s.type,v=_?void 0:s,x={needsRenderFrame:!1},E={},R={},F=s.touches?this._getMapTouches(s.touches):void 0,N=F?pc(this._el,F):_?void 0:Aa(this._el,s);for(const{handlerName:j,handler:W,allowed:ne}of this._handlers){if(!W.isEnabled())continue;let J;this._blockedByActive(R,ne,j)?W.reset():W[c||s.type]&&(J=W[c||s.type](s,N,F),this.mergeHandlerResult(x,E,J,j,v),J&&J.needsRenderFrame&&this._triggerRenderFrame()),(J||W.isActive())&&(R[j]=W)}const z={};for(const j in this._previousActiveHandlers)R[j]||(z[j]=v);this._previousActiveHandlers=R,(Object.keys(z).length||Df(x))&&(this._changes.push([x,E,z]),this._triggerRenderFrame()),(Object.keys(R).length||Df(x))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=x;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))}mergeHandlerResult(s,c,_,v,x){if(!_)return;h.l(s,_);const E={handlerName:v,originalEvent:_.originalEvent||x};void 0!==_.zoomDelta&&(c.zoom=E),void 0!==_.panDelta&&(c.drag=E),void 0!==_.pitchDelta&&(c.pitch=E),void 0!==_.bearingDelta&&(c.rotate=E)}_applyChanges(){const s={},c={},_={};for(const[v,x,E]of this._changes)v.panDelta&&(s.panDelta=(s.panDelta||new h.P(0,0))._add(v.panDelta)),v.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+v.pitchDelta),void 0!==v.around&&(s.around=v.around),void 0!==v.aroundCoord&&(s.aroundCoord=v.aroundCoord),void 0!==v.pinchAround&&(s.pinchAround=v.pinchAround),v.noInertia&&(s.noInertia=v.noInertia),h.l(c,x),h.l(_,E);this._updateMapTransform(s,c,_),this._changes=[]}_updateMapTransform(s,c,_){const v=this._map,x=v.transform,E=fe=>[fe.x,fe.y,fe.z];if((()=>{const be=this._eventsInProgress.drag;return be&&!this._handlersById[be.handlerName].isActive()})()&&!Df(s)){const fe=x.zoom;x.cameraElevationReference="sea",null!=this._originalZoom&&x._orthographicProjectionAtLowPitch&&"globe"!==x.projection.name&&0===x.pitch?(x.cameraElevationReference="ground",x.zoom=this._originalZoom):(x.recenterOnTerrain(),x.cameraElevationReference="ground"),fe!==x.zoom&&this._map._update(!0)}if(x._isCameraConstrained&&v._stop(!0),!Df(s))return void this._fireEvents(c,_,!0);let{panDelta:R,zoomDelta:F,bearingDelta:N,pitchDelta:z,around:U,aroundCoord:j,pinchAround:W}=s;x._isCameraConstrained&&(F>0&&(F=0),x._isCameraConstrained=!1),void 0!==W&&(U=W),(F||(()=>c.drag&&!this._eventsInProgress.drag)())&&U&&(this._dragOrigin=E(x.pointCoordinate3D(U)),this._originalZoom=x.zoom,this._trackingEllipsoid.setup(x._camera.position,this._dragOrigin)),x.cameraElevationReference="sea",v._stop(!0),U=U||v.transform.centerPoint,N&&(x.bearing+=N),z&&(x.pitch+=z),x._updateCameraState();const ne=[0,0,0];if(R)if("mercator"===x.projection.name){const fe=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(U).dir),be=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(U.sub(R)).dir);ne[0]=be[0]-fe[0],ne[1]=be[1]-fe[1]}else{const fe=x.pointCoordinate(U);if("globe"===x.projection.name){R=R.rotate(-x.angle);const be=x._pixelsPerMercatorPixel/x.worldSize;ne[0]=-R.x*h.dE(h.aT(fe.y))*be,ne[1]=-R.y*h.dE(x.center.lat)*be}else{const be=x.pointCoordinate(U.sub(R));fe&&be&&(ne[0]=be.x-fe.x,ne[1]=be.y-fe.y)}}const J=x.zoom,oe=[0,0,0];if(F){const fe=E(j||x.pointCoordinate3D(U)),be={dir:h.ad.vec3.normalize([],h.ad.vec3.sub([],fe,x._camera.position))};if(be.dir[2]<0){const ve=x.zoomDeltaToMovement(fe,F);h.ad.vec3.scale(oe,be.dir,ve)}}const se=h.ad.vec3.add(ne,ne,oe);x._translateCameraConstrained(se),F&&Math.abs(x.zoom-J)>1e-4&&x.recenterOnTerrain(),x.cameraElevationReference="ground",this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(c,_,!0)}_fireEvents(s,c,_){const v=ru(this._eventsInProgress),x=ru(s),E={};for(const z in s){const{originalEvent:U}=s[z];this._eventsInProgress[z]||(E[`${z}start`]=U),this._eventsInProgress[z]=s[z]}!v&&x&&this._fireEvent("movestart",x.originalEvent);for(const z in E)this._fireEvent(z,E[z]);x&&this._fireEvent("move",x.originalEvent);for(const z in s){const{originalEvent:U}=s[z];this._fireEvent(z,U)}const R={};let F;for(const z in this._eventsInProgress){const{handlerName:U,originalEvent:j}=this._eventsInProgress[z];this._handlersById[U].isActive()||(delete this._eventsInProgress[z],F=c[U]||j,R[`${z}end`]=F)}for(const z in R)this._fireEvent(z,R[z]);const N=ru(this._eventsInProgress);if(_&&(v||x)&&!N){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),U=j=>0!==j&&-this._bearingSnap<j&&j<this._bearingSnap;z?(U(z.bearing||this._map.getBearing())&&(z.bearing=0),this._map.easeTo(z,{originalEvent:F})):(this._map.fire(new h.A("moveend",{originalEvent:F})),U(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(s,c){this._map.fire(new h.A(s,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{this._frameId=void 0,this.handleEvent(new Gm("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const S_="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class lp extends h.E{constructor(s,c){super(),this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=c.bearingSnap,this._respectPrefersReducedMotion=!1!==c.respectPrefersReducedMotion,h.aQ(["_renderFrameCallback"],this)}getCenter(){return new h.bO(this.transform.center.lng,this.transform.center.lat)}setCenter(s,c){return this.jumpTo({center:s},c)}panBy(s,c,_){return s=h.P.convert(s).mult(-1),this.panTo(this.transform.center,h.l({offset:s},c),_)}panTo(s,c,_){return this.easeTo(h.l({center:s},c),_)}getZoom(){return this.transform.zoom}setZoom(s,c){return this.jumpTo({zoom:s},c),this}zoomTo(s,c,_){return this.easeTo(h.l({zoom:s},c),_)}zoomIn(s,c){return this.zoomTo(this.getZoom()+1,s,c),this}zoomOut(s,c){return this.zoomTo(this.getZoom()-1,s,c),this}getBearing(){return this.transform.bearing}setBearing(s,c){return this.jumpTo({bearing:s},c),this}getPadding(){return this.transform.padding}setPadding(s,c){return this.jumpTo({padding:s},c),this}rotateTo(s,c,_){return this.easeTo(h.l({bearing:s},c),_)}resetNorth(s,c){return this.rotateTo(0,h.l({duration:1e3},s),c),this}resetNorthPitch(s,c){return this.easeTo(h.l({bearing:0,pitch:0,duration:1e3},s),c),this}snapToNorth(s,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,c):this}getPitch(){return this.transform.pitch}setPitch(s,c){return this.jumpTo({pitch:s},c),this}cameraForBounds(s,c){s=h.aB.convert(s);const _=c&&c.bearing||0,v=c&&c.pitch||0,x=s.getNorthWest(),E=s.getSouthEast();return this._cameraForBounds(this.transform,x,E,_,v,c)}_extendPadding(s){const c={top:0,right:0,bottom:0,left:0};return null==s?h.l({},c,this.transform.padding):"number"==typeof s?{top:s,bottom:s,right:s,left:s}:h.l({},c,s)}_extendCameraOptions(s){return(s=h.l({offset:[0,0],maxZoom:this.transform.maxZoom},s)).padding=this._extendPadding(s.padding),s}_minimumAABBFrustumDistance(s,c){const _=c.max[0]-c.min[0],v=c.max[1]-c.min[1];return _/v>s.aspect?_/(2*Math.tan(.5*s.fovX)*s.aspect):v/(2*Math.tan(.5*s.fovY)*s.aspect)}_cameraForBoundsOnGlobe(s,c,_,v,x,E){const R=s.clone(),F=this._extendCameraOptions(E);R.bearing=v,R.pitch=x;const N=h.bO.convert(c),z=h.bO.convert(_),U=.5*(N.lat+z.lat),j=.5*(N.lng+z.lng),W=h.dF(U,j),ne=h.ad.vec3.normalize([],W),J=h.ad.vec3.normalize([],h.ad.vec3.cross([],ne,[0,1,0])),oe=h.ad.vec3.cross([],J,ne),se=[J[0],J[1],J[2],0,oe[0],oe[1],oe[2],0,ne[0],ne[1],ne[2],0,0,0,0,1],fe=[W,h.dF(N.lat,N.lng),h.dF(z.lat,N.lng),h.dF(z.lat,z.lng),h.dF(N.lat,z.lng),h.dF(U,N.lng),h.dF(U,z.lng),h.dF(N.lat,j),h.dF(z.lat,j)];let be=h.ce.fromPoints(fe.map(rt=>[h.ad.vec3.dot(J,rt),h.ad.vec3.dot(oe,rt),h.ad.vec3.dot(ne,rt)]));const ve=h.ad.vec3.transformMat4([],be.center,se);0===h.ad.vec3.squaredLength(ve)&&h.ad.vec3.set(ve,0,0,1),h.ad.vec3.normalize(ve,ve),h.ad.vec3.scale(ve,ve,h.az),R.center=h.dG(ve);const we=R.getWorldToCameraMatrix(),Ee=h.ad.mat4.invert(new Float64Array(16),we);be=h.ce.applyTransform(be,h.ad.mat4.multiply([],we,se));const De=this._extendAABB(be,R,F,v);if(!De)return void h.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");be=De,h.ad.vec3.transformMat4(ve,ve,we);const Me=.5*(be.max[2]-be.min[2]),ke=this._minimumAABBFrustumDistance(R,be),Oe=h.ad.vec3.scale([],[0,0,1],Me),et=h.ad.vec3.add(Oe,ve,Oe),qe=ke+(0===R.pitch?0:h.ad.vec3.distance(ve,et)),ot=R.globeCenterInViewSpace,lt=h.ad.vec3.sub([],ve,[ot[0],ot[1],ot[2]]);h.ad.vec3.normalize(lt,lt),h.ad.vec3.scale(lt,lt,qe);const Ct=h.ad.vec3.add([],ve,lt);h.ad.vec3.transformMat4(Ct,Ct,Ee);const He=h.dv/h.az,st=h.ad.vec3.length(Ct),Be=h.bH(Math.max(st*He-h.dv,Number.EPSILON),0),at=Math.min(R.zoomFromMercatorZAdjusted(Be),F.maxZoom);return at>.5*(h.c6+h.bY)?(R.setProjection({name:"mercator"}),R.zoom=at,this._cameraForBounds(R,c,_,v,x,E)):{center:R.center,zoom:at,bearing:v,pitch:x}}_extendAABB(s,c,_,v){const x=.5*((_.padding.left||0)+(_.padding.right||0)),E=.5*((_.padding.top||0)+(_.padding.bottom||0)),R=E,F=x,N=x,z=E,U=c.width-(F+N),j=c.height-(R+z),W=h.ad.vec3.sub([],s.max,s.min),ne=Math.min(U/W[0],j/W[1]),J=Math.min(c.scaleZoom(c.scale*ne),_.maxZoom);if(isNaN(J))return null;const oe=c.scale/c.zoomScale(J),se=new h.ce([s.min[0]-F*oe,s.min[1]-z*oe,s.min[2]],[s.max[0]+N*oe,s.max[1]+R*oe,s.max[2]]),fe=("number"==typeof _.offset.x&&"number"==typeof _.offset.y?new h.P(_.offset.x,_.offset.y):h.P.convert(_.offset)).rotate(-h.ak(v));return se.center[0]-=fe.x*oe,se.center[1]+=fe.y*oe,se}queryTerrainElevation(s,c){const _=this.transform.elevation;return _?(c=h.l({},{exaggerated:!0},c),_.getAtPoint(h.ac.fromLngLat(s),null,c.exaggerated)):null}_cameraForBounds(s,c,_,v,x,E){if("globe"===s.projection.name)return this._cameraForBoundsOnGlobe(s,c,_,v,x,E);const R=s.clone(),F=this._extendCameraOptions(E);R.bearing=v,R.pitch=x;const N=h.bO.convert(c),z=h.bO.convert(_),U=new h.bO(N.lng,z.lat),j=new h.bO(z.lng,N.lat),W=R.project(N),ne=R.project(z),J=this.queryTerrainElevation(N),oe=this.queryTerrainElevation(z),se=this.queryTerrainElevation(U),fe=this.queryTerrainElevation(j),be=[[W.x,W.y,Math.min(J||0,oe||0,se||0,fe||0)],[ne.x,ne.y,Math.max(J||0,oe||0,se||0,fe||0)]];let ve=h.ce.fromPoints(be);const we=R.getWorldToCameraMatrix(),Ee=h.ad.mat4.invert(new Float64Array(16),we);ve=h.ce.applyTransform(ve,we);const De=this._extendAABB(ve,R,F,v);if(!De)return void h.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ve=De;const Me=.5*h.ad.vec3.sub([],ve.max,ve.min)[2],ke=this._minimumAABBFrustumDistance(R,ve),Oe=[0,0,1,0];h.ad.vec4.transformMat4(Oe,Oe,we),h.ad.vec4.normalize(Oe,Oe);const et=h.ad.vec3.scale([],Oe,ke+Me),qe=h.ad.vec3.add([],ve.center,et);h.ad.vec3.transformMat4(ve.center,ve.center,Ee),h.ad.vec3.transformMat4(qe,qe,Ee);const ot=R.unproject(new h.P(ve.center[0],ve.center[1])),lt=h.dH(R.projection,ot),Ct=Math.pow(2,lt),He=Math.min(R._zoomFromMercatorZ(qe[2]*R.pixelsPerMeter*Ct/R.worldSize),F.maxZoom);return R.mercatorFromTransition&&He<.5*(h.c6+h.bY)?(R.setProjection({name:"globe"}),R.zoom=He,this._cameraForBounds(R,c,_,v,x,E)):{center:ot,zoom:He,bearing:v,pitch:x}}fitBounds(s,c,_){const v=this.cameraForBounds(s,c);return this._fitInternal(v,c,_)}fitScreenCoordinates(s,c,_,v,x){const E=h.P.convert(s),R=h.P.convert(c),F=new h.P(Math.min(E.x,R.x),Math.min(E.y,R.y)),N=new h.P(Math.max(E.x,R.x),Math.max(E.y,R.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(E,R))return this;const z=this.transform.pointLocation3D(F),U=this.transform.pointLocation3D(N),j=this.transform.pointLocation3D(new h.P(F.x,N.y)),W=this.transform.pointLocation3D(new h.P(N.x,F.y)),ne=[Math.min(z.lng,U.lng,j.lng,W.lng),Math.min(z.lat,U.lat,j.lat,W.lat)],J=[Math.max(z.lng,U.lng,j.lng,W.lng),Math.max(z.lat,U.lat,j.lat,W.lat)],oe=v&&v.pitch?v.pitch:this.getPitch(),se=this._cameraForBounds(this.transform,ne,J,_,oe,v);return this._fitInternal(se,v,x)}_fitInternal(s,c,_){return s?(c=h.l(s,c)).linear?this.easeTo(c,_):this.flyTo(c,_):this}jumpTo(s,c){this.stop();const _=s.preloadOnly?this.transform.clone():this.transform;let v=!1,x=!1,E=!1;"zoom"in s&&_.zoom!==+s.zoom&&(v=!0,_.zoom=+s.zoom),void 0!==s.center&&(_.center=h.bO.convert(s.center)),"bearing"in s&&_.bearing!==+s.bearing&&(x=!0,_.bearing=+s.bearing),"pitch"in s&&_.pitch!==+s.pitch&&(E=!0,_.pitch=+s.pitch);const R="number"==typeof s.padding?this._extendPadding(s.padding):s.padding;if(null!=s.padding&&!_.isPaddingEqual(R))if(!1===s.retainPadding){const F=_.clone();F.padding=R,_.setLocationAtPoint(_.center,F.centerPoint)}else _.padding=R;return s.preloadOnly?(this._preloadTiles(_),this):(this.fire(new h.A("movestart",c)).fire(new h.A("move",c)),v&&this.fire(new h.A("zoomstart",c)).fire(new h.A("zoom",c)).fire(new h.A("zoomend",c)),x&&this.fire(new h.A("rotatestart",c)).fire(new h.A("rotate",c)).fire(new h.A("rotateend",c)),E&&this.fire(new h.A("pitchstart",c)).fire(new h.A("pitch",c)).fire(new h.A("pitchend",c)),this.fire(new h.A("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||h.w(S_),this.transform.getFreeCameraOptions()}setFreeCameraOptions(s,c){const _=this.transform;if(!_.projection.supportsFreeCamera)return h.w(S_),this;this.stop();const v=_.zoom,x=_.pitch,E=_.bearing;_.setFreeCameraOptions(s);const R=v!==_.zoom,F=x!==_.pitch,N=E!==_.bearing;return this.fire(new h.A("movestart",c)).fire(new h.A("move",c)),R&&this.fire(new h.A("zoomstart",c)).fire(new h.A("zoom",c)).fire(new h.A("zoomend",c)),N&&this.fire(new h.A("rotatestart",c)).fire(new h.A("rotate",c)).fire(new h.A("rotateend",c)),F&&this.fire(new h.A("pitchstart",c)).fire(new h.A("pitch",c)).fire(new h.A("pitchend",c)),this.fire(new h.A("moveend",c)),this}easeTo(s,c){this._stop(!1,s.easeId),(!1===(s=h.l({offset:[0,0],duration:500,easing:h.dD},s)).animate||this._prefersReducedMotion(s))&&(s.duration=0);const _=this.transform,v=this.getZoom(),x=this.getBearing(),E=this.getPitch(),R=this.getPadding(),F="zoom"in s?+s.zoom:v,N="bearing"in s?this._normalizeBearing(s.bearing,x):x,z="pitch"in s?+s.pitch:E,U=this._extendPadding(s.padding),j=h.P.convert(s.offset);let W,ne,J;if("globe"===_.projection.name){const Oe=h.ac.fromLngLat(_.center),et=j.rotate(-_.angle);Oe.x+=et.x/_.worldSize,Oe.y+=et.y/_.worldSize;const qe=Oe.toLngLat(),ot=h.bO.convert(s.center||qe);this._normalizeCenter(ot),W=_.centerPoint.add(et),ne=new h.P(Oe.x,Oe.y).mult(_.worldSize),J=new h.P(h.av(ot.lng),h.aC(ot.lat)).mult(_.worldSize).sub(ne)}else{W=_.centerPoint.add(j);const Oe=_.pointLocation(W),et=h.bO.convert(s.center||Oe);this._normalizeCenter(et),ne=_.project(Oe),J=_.project(et).sub(ne)}const oe=_.zoomScale(F-v);let se,fe;s.around&&(se=h.bO.convert(s.around),fe=_.locationPoint(se));const be=this._zooming||F!==v,ve=this._rotating||x!==N,we=this._pitching||z!==E,Ee=!_.isPaddingEqual(U),De=!1===s.retainPadding?_.clone():_,Me=Oe=>et=>{if(be&&(Oe.zoom=h.ah(v,F,et)),ve&&(Oe.bearing=h.ah(x,N,et)),we&&(Oe.pitch=h.ah(E,z,et)),Ee&&(De.interpolatePadding(R,U,et),W=De.centerPoint.add(j)),se)Oe.setLocationAtPoint(se,fe);else{const qe=Oe.zoomScale(Oe.zoom-v),ot=F>v?Math.min(2,oe):Math.max(.5,oe),lt=Math.pow(ot,1-et),Ct=Oe.unproject(ne.add(J.mult(et*lt)).mult(qe));Oe.setLocationAtPoint(Oe.renderWorldCopies?Ct.wrap():Ct,W)}return s.preloadOnly||this._fireMoveEvents(c),Oe};if(s.preloadOnly){const Oe=this._emulate(Me,s.duration,_);return this._preloadTiles(Oe),this}const ke={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=be,this._rotating=ve,this._pitching=we,this._padding=Ee,this._easeId=s.easeId,this._prepareEase(c,s.noMoveStart,ke),this._ease(Me(_),Oe=>{"sea"===_.cameraElevationReference&&_.recenterOnTerrain(),this._afterEase(c,Oe)},s),this}_prepareEase(s,c,_={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&0===this.transform.pitch&&"globe"!==this.transform.projection.name&&(this.transform.cameraElevationReference="ground"),c||_.moving||this.fire(new h.A("movestart",s)),this._zooming&&!_.zooming&&this.fire(new h.A("zoomstart",s)),this._rotating&&!_.rotating&&this.fire(new h.A("rotatestart",s)),this._pitching&&!_.pitching&&this.fire(new h.A("pitchstart",s))}_fireMoveEvents(s){this.fire(new h.A("move",s)),this._zooming&&this.fire(new h.A("zoom",s)),this._rotating&&this.fire(new h.A("rotate",s)),this._pitching&&this.fire(new h.A("pitch",s))}_afterEase(s,c){if(this._easeId&&c&&this._easeId===c)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const _=this._zooming,v=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new h.A("zoomend",s)),v&&this.fire(new h.A("rotateend",s)),x&&this.fire(new h.A("pitchend",s)),this.fire(new h.A("moveend",s))}flyTo(s,c){if(this._prefersReducedMotion(s)){const rt=h.aA(s,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(rt,c)}this.stop(),s=h.l({offset:[0,0],speed:1.2,curve:1.42,easing:h.dD},s);const _=this.transform,v=this.getZoom(),x=this.getBearing(),E=this.getPitch(),R=this.getPadding(),F="zoom"in s?h.ay(+s.zoom,_.minZoom,_.maxZoom):v,N="bearing"in s?this._normalizeBearing(s.bearing,x):x,z="pitch"in s?+s.pitch:E,U=this._extendPadding(s.padding),j=_.zoomScale(F-v),W=h.P.convert(s.offset);let ne=_.centerPoint.add(W);const J=_.pointLocation(ne),oe=h.bO.convert(s.center||J);this._normalizeCenter(oe);const se=_.project(J),fe=_.project(oe).sub(se);let be=s.curve;const ve=Math.max(_.width,_.height),we=ve/j,Ee=fe.mag();if("minZoom"in s){const rt=h.ay(Math.min(s.minZoom,v,F),_.minZoom,_.maxZoom),$e=ve/_.zoomScale(rt-v);be=Math.sqrt($e/Ee*2)}const De=be*be;function Me(rt){const $e=(we*we-ve*ve+(rt?-1:1)*De*De*Ee*Ee)/(2*(rt?we:ve)*De*Ee);return Math.log(Math.sqrt($e*$e+1)-$e)}function ke(rt){return(Math.exp(rt)-Math.exp(-rt))/2}function Oe(rt){return(Math.exp(rt)+Math.exp(-rt))/2}const et=Me(0);let qe=function(rt){return Oe(et)/Oe(et+be*rt)},ot=function(rt){return ve*((Oe(et)*(ke($e=et+be*rt)/Oe($e))-ke(et))/De)/Ee;var $e},lt=(Me(1)-et)/be;if(Math.abs(Ee)<1e-6||!isFinite(lt)){if(Math.abs(ve-we)<1e-6)return this.easeTo(s,c);const rt=we<ve?-1:1;lt=Math.abs(Math.log(we/ve))/be,ot=function(){return 0},qe=function($e){return Math.exp(rt*be*$e)}}s.duration="duration"in s?+s.duration:1e3*lt/("screenSpeed"in s?+s.screenSpeed/be:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0);const Ct=x!==N,He=z!==E,st=!_.isPaddingEqual(U),Be=!1===s.retainPadding?_.clone():_,at=rt=>$e=>{const Je=$e*lt,dt=1/qe(Je);rt.zoom=1===$e?F:v+rt.scaleZoom(dt),Ct&&(rt.bearing=h.ah(x,N,$e)),He&&(rt.pitch=h.ah(E,z,$e)),st&&(Be.interpolatePadding(R,U,$e),ne=Be.centerPoint.add(W));const Ft=1===$e?oe:rt.unproject(se.add(fe.mult(ot(Je))).mult(dt));return rt.setLocationAtPoint(rt.renderWorldCopies?Ft.wrap():Ft,ne),rt._updateCameraOnTerrain(),s.preloadOnly||this._fireMoveEvents(c),rt};if(s.preloadOnly){const rt=this._emulate(at,s.duration,_);return this._preloadTiles(rt),this}return this._zooming=!0,this._rotating=Ct,this._pitching=He,this._padding=st,this._prepareEase(c,!1),this._ease(at(_),()=>this._afterEase(c),s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(s){}_cancelRenderFrame(s){}_stop(s,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const _=this._onEaseEnd;this._onEaseEnd=void 0,_.call(this,c)}if(!s){const _=this.handlers;_&&_.stop(!1)}return this}_ease(s,c,_){!1===_.animate||0===_.duration?(s(1),c()):(this._easeStart=h.q.now(),this._easeOptions=_,this._onEaseFrame=s,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const s=Math.min((h.q.now()-this._easeStart)/this._easeOptions.duration,1),c=this._onEaseFrame;c&&c(this._easeOptions.easing(s)),s<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(s,c){s=h.bF(s,-180,180);const _=Math.abs(s-c);return Math.abs(s-360-c)<_&&(s-=360),Math.abs(s+360-c)<_&&(s+=360),s}_normalizeCenter(s){const c=this.transform;if(c.maxBounds||"globe"!==c.projection.name&&!c.renderWorldCopies)return;const _=s.lng-c.center.lng;s.lng+=_>180?-360:_<-180?360:0}_prefersReducedMotion(s){return this._respectPrefersReducedMotion&&h.q.prefersReducedMotion&&!(s&&s.essential)}_emulate(s,c,_){const v=Math.ceil(15*c/1e3),x=[],E=s(_.clone());for(let R=0;R<=v;R++){const F=E(R/v);x.push(F.clone())}return x}_preloadTiles(s,c){}}class Ga{constructor(s={}){this.options=s,h.aQ(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(s){const c=this.options&&this.options.compact,_=s._getUIString("AttributionControl.ToggleAttribution");this._map=s,this._container=ri("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ri("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",_);const v=ri("span","mapboxgl-ctrl-icon",this._compactButton);return v.setAttribute("aria-hidden","true"),v.setAttribute("title",_),this._innerContainer=ri("div","mapboxgl-ctrl-attrib-inner",this._container),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===c&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let s=this._editLink;s||(s=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||h.e.ACCESS_TOKEN}];if(s){const _=c.reduce((v,x,E)=>(x.value&&(v+=`${x.key}=${x.value}${E<c.length-1?"&":""}`),v),"?");s.href=`${h.e.FEEDBACK_URL}/${_}#${ip(this._map,!0)}`,s.rel="noopener nofollow"}}_updateData(s){!s||"metadata"!==s.sourceDataType&&"visibility"!==s.sourceDataType&&"style"!==s.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let s=[];if(this._map.style.stylesheet){const v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}const c=this._map.style._mergedSourceCaches;for(const v in c){const x=c[v];if(x.used){const E=x.getSource();E.attribution&&s.indexOf(E.attribution)<0&&s.push(E.attribution)}}s.sort((v,x)=>v.length-x.length),s=s.filter((v,x)=>{for(let E=x+1;E<s.length;E++)if(s[E].indexOf(v)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=[...this.options.customAttribution,...s]:s.unshift(this.options.customAttribution));const _=s.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,s.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class qa{constructor(){h.aQ(["_updateLogo","_updateCompact"],this)}onAdd(s){this._map=s,this._container=ri("div","mapboxgl-ctrl");const c=ri("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(s){s&&"metadata"!==s.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const s=this._map.style._sourceCaches;if(0===Object.entries(s).length)return!0;for(const c in s){const _=s[c].getSource();if(_.hasOwnProperty("mapbox_logo")&&!_.mapbox_logo)return!1}return!0}_updateCompact(){const s=this._container.children;if(s.length){const c=s[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class Us{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){const c=++this._id;return this._queue.push({callback:s,id:c,cancelled:!1}),c}remove(s){const c=this._currentlyRunning,_=c?this._queue.concat(c):this._queue;for(const v of _)if(v.id===s)return void(v.cancelled=!0)}run(s=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const _ of c)if(!_.cancelled&&(_.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class ou{constructor(s){this.jumpTo(s)}getValue(s){if(s<=this._startTime)return this._start;if(s>=this._endTime)return this._end;const c=h.cC((s-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(s){return s>=this._startTime&&s<=this._endTime}jumpTo(s){this._startTime=-1/0,this._endTime=-1/0,this._start=s,this._end=s}easeTo(s,c,_){this._start=this.getValue(c),this._end=s,this._startTime=c,this._endTime=c+_}}const su={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Sc extends h.A{constructor(s,c,_,v){const{point:x,lngLat:E,originalEvent:R,target:F}=s;super(s.type,{point:x,lngLat:E,originalEvent:R,target:F}),this.preventDefault=()=>{s.preventDefault()},this.id=c,this.interaction=_,this.feature=v}}class Mf{constructor(s){this.map=s,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(s,c){if(this.typeById.has(s))throw new Error(`Interaction id "${s}" already exists.`);const _=c.filter;let v=c.type;_&&this.filters.set(s,h.a_(_)),"mouseover"===v&&(v="mouseenter"),"mouseout"===v&&(v="mouseleave");const x=this.interactionsByType.get(v)||new Map;"mouseenter"===v||"mouseleave"===v?(0===this.delegatedInteractions.size&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(s,c)):0===x.size&&this.map.on(v,this.handleType),0===x.size&&this.interactionsByType.set(v,x),x.set(s,c),this.typeById.set(s,v)}get(s){const c=this.typeById.get(s);if(!c)return;const _=this.interactionsByType.get(c);return _?_.get(s):void 0}remove(s){const c=this.typeById.get(s);if(!c)return;this.typeById.delete(s),this.filters.delete(s);const _=this.interactionsByType.get(c);_&&(_.delete(s),"mouseenter"===c||"mouseleave"===c?(this.delegatedInteractions.delete(s),0===this.delegatedInteractions.size&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):0===_.size&&this.map.off(c,this.handleType))}queryTargets(s,c){const _=[];for(const[v,x]of c)x.target&&_.push({targetId:v,target:x.target,filter:this.filters.get(v)});return this.map.style.queryRenderedTargets(s,_,this.map.transform)}handleMove(s){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const c=this.queryTargets(s.point,Array.from(this.delegatedInteractions).reverse());c.length&&(s.type="mouseenter",this.handleType(s,c));const _=new Map;for(const[v,{feature:x}]of this.prevHoveredFeatures)this.hoveredFeatures.has(v)||_.set(x.id,x);_.size&&(s.type="mouseleave",this.handleType(s,Array.from(_.values())))}handleOut(s){const c=Array.from(this.hoveredFeatures.values()).map(({feature:_})=>_);c.length&&(s.type="mouseleave",this.handleType(s,c)),this.hoveredFeatures.clear()}handleType(s,c){const _=Array.from(this.interactionsByType.get(s.type)).reverse(),v=!!c;c=c||this.queryTargets(s.point,_);const x="mouseenter"===s.type;let E=!1;const R=new Set;for(const F of c){for(const[N,z]of _){if(!z.target)continue;const U=F.variants?F.variants[N]:null;if(U){for(const j of U){if(Vl(j,F,R,N))continue;const W=new h.cx(F,j),ne=Ru(j,F,N);v&&(W.state=this.map.getFeatureState(W));const J=x?this.prevHoveredFeatures.get(ne):null,oe=new Sc(s,N,z,W),se=J?J.stop:z.handler(oe);if(x&&this.hoveredFeatures.set(ne,{feature:F,stop:se}),!1!==se){E=!0;break}}if(E)break}}if(E)break}if(!E)for(const[F,N]of _){const{handler:z,target:U}=N;if(!U&&!1!==z(new Sc(s,F,N,null)))break}}}function Ri(m,s){if(Array.isArray(m)&&Array.isArray(s)){const c=new Set(m),_=new Set(s);return c.size===_.size&&m.every(v=>_.has(v))}return h.bn(m,s)}const fd={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Uv={showCompass:!0,showZoom:!0,visualizePitch:!1};class jv{constructor(s,c,_=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new Ha({clickTolerance:s.dragRotate._mouseRotate._clickTolerance}),this.map=s,_&&(this.mousePitch=new iu({clickTolerance:s.dragRotate._mousePitch._clickTolerance})),h.aQ(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(s,c){this.mouseRotate.mousedown(s,c),this.mousePitch&&this.mousePitch.mousedown(s,c),Li()}move(s,c){const _=this.map,v=this.mouseRotate.mousemoveWindow(s,c),x=v&&v.bearingDelta;if(x&&_.setBearing(_.getBearing()+x),this.mousePitch){const E=this.mousePitch.mousemoveWindow(s,c),R=E&&E.pitchDelta;R&&_.setPitch(_.getPitch()+R)}}off(){const s=this.element;s.removeEventListener("mousedown",this.mousedown),s.removeEventListener("touchstart",this.touchstart,{passive:!1}),s.removeEventListener("touchmove",this.touchmove),s.removeEventListener("touchend",this.touchend),s.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ld(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(s){this.down(h.l({},s,{ctrlKey:!0,preventDefault:()=>s.preventDefault()}),Aa(this.element,s)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(s){this.move(s,Aa(this.element,s))}mouseup(s){this.mouseRotate.mouseupWindow(s),this.mousePitch&&this.mousePitch.mouseupWindow(s),this.offTemp()}touchstart(s){1!==s.targetTouches.length?this.reset():(this._startPos=this._lastPos=pc(this.element,s.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>s.preventDefault()},this._startPos))}touchmove(s){1!==s.targetTouches.length?this.reset():(this._lastPos=pc(this.element,s.targetTouches)[0],this.move({preventDefault:()=>s.preventDefault()},this._lastPos))}touchend(s){0===s.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Tf(m,s,c){if(m=new h.bO(m.lng,m.lat),s){const _=new h.bO(m.lng-360,m.lat),v=new h.bO(m.lng+360,m.lat),x=360*Math.ceil(Math.abs(m.lng-c.center.lng)/360),E=c.locationPoint3D(m).distSqr(s),R=s.x<0||s.y<0||s.x>c.width||s.y>c.height;c.locationPoint3D(_).distSqr(s)<E&&(R||Math.abs(_.lng-c.center.lng)<x)?m=_:c.locationPoint3D(v).distSqr(s)<E&&(R||Math.abs(v.lng-c.center.lng)<x)&&(m=v)}for(;Math.abs(m.lng-c.center.lng)>180;){const _=c.locationPoint3D(m);if(_.x>=0&&_.y>=0&&_.x<=c.width&&_.y<=c.height)break;m.lng>c.center.lng?m.lng-=360:m.lng+=360}return m}const Dc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},As={anchor:"center",color:"#3FB1CE",scale:1,draggable:!1,clickTolerance:0,rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Co extends h.E{constructor(s,c){super(),(s instanceof HTMLElement||c)&&(s=h.l({element:s},c)),h.aQ(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),s=h.l({},As,s),this._anchor=s.anchor,this._color=s.color,this._scale=s.scale,this._draggable=s.draggable,this._clickTolerance=s.clickTolerance,this._rotation=s.rotation,this._rotationAlignment=s.rotationAlignment,this._pitchAlignment=s.pitchAlignment,this._occludedOpacity=s.occludedOpacity,this._altitude=s.altitude,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),s&&s.element?(this._element=s.element,this._offset=h.P.convert(s&&s.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=h.P.convert(s&&s.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",x=>{x.preventDefault()}),this._element.addEventListener("mousedown",x=>{x.preventDefault()});const _=this._element.classList;for(const x in Dc)_.remove(`mapboxgl-marker-anchor-${x}`);_.add(`mapboxgl-marker-anchor-${this._anchor}`);const v=s&&s.className?s.className.trim().split(/\s+/):[];_.add(...v),this._popup=null}_createDefaultMarker(){const s=ri("div"),c=Bi("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},s);if(0===this._altitude){const _=Bi("radialGradient",{id:"shadowGradient"},Bi("defs",{},c));Bi("stop",{offset:"10%","stop-opacity":.4},_),Bi("stop",{offset:"100%","stop-opacity":.05},_),Bi("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},c)}return Bi("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},c),Bi("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},c),Bi("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},c),s}addTo(s){return s===this._map||(this.remove(),this._map=s,s.getCanvasContainer().appendChild(this._element),s.on("move",this._updateMoving),s.on("moveend",this._update),s.on("remove",this._clearFadeTimer),s._addMarker(this),this.setDraggable(this._draggable),this._update(),s.on("click",this._onMapClick)),this}remove(){const s=this._map;return s&&(s.off("click",this._onMapClick),s.off("move",this._updateMoving),s.off("moveend",this._update),s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler),s.off("mouseup",this._onUp),s.off("touchend",this._onUp),s.off("mousemove",this._onMove),s.off("touchmove",this._onMove),s.off("remove",this._clearFadeTimer),s._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=h.bO.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(s){return s===this._altitude||(this._defaultMarker&&(0===this._altitude&&0!==s||0!==this._altitude&&0===s)&&(this._element=this._createDefaultMarker()),this._altitude=s||As.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){const v=Math.sqrt(Math.pow(13.5,2)/2);s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(24.6+v)],"bottom-right":[-v,-1*(24.6+v)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=s,s._marker=this,s._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(s){const c=s.code,_=s.charCode||s.keyCode;"Space"!==c&&"Enter"!==c&&32!==_&&13!==_||this.togglePopup()}_onMapClick(s){const c=s.originalEvent.target,_=this._element;this._popup&&(c===_||_.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const s=this._popup;return s?(s.isOpen()?(s.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(s.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const s=this._map,c=this._pos;if(!s||!c)return!1;const _=s.unproject(c,this._altitude),v=s.getFreeCameraOptions();if(!v.position)return!1;const x=v.position.toLngLat();return x.distanceTo(_)<.9*x.distanceTo(this._lngLat)}_evaluateOpacity(){const s=this._map;if(!s)return;const c=this._pos;if(!c||c.x<0||c.x>s.transform.width||c.y<0||c.y>s.transform.height)return void this._clearFadeTimer();const _=s.unproject(c,this._altitude);let v;s._showingGlobe()&&h.dK(s.transform,this._lngLat)?v=0:(v=1-s._queryFogOpacity(_),s.transform._terrainEnabled()&&s.getTerrain()&&this._behindTerrain()&&(v*=this._occludedOpacity)),this._element.style.opacity=`${v}`,this._element.style.pointerEvents=v>0?"auto":"none",this._popup&&this._popup._setOpacity(v),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const s=this._pos;if(!s||!this._map)return;const c=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${s.x}px,${s.y}px)\n            ${Dc[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${c.x}px,${c.y}px)\n        `}_calculateXYTransform(){const s=this._pos,c=this._map,_=this.getPitchAlignment();if(!c||!s||"map"!==_)return"";if(!c._showingGlobe()){const F=c.getPitch();return F?`rotateX(${F}deg)`:""}const v=h.c4(h.dL(c.transform,this._lngLat)),x=s.sub(h.dM(c.transform)),E=Math.abs(x.x)+Math.abs(x.y);if(0===E)return"";const R=v/E;return`rotateX(${-x.y*R}deg) rotateY(${x.x*R}deg)`}_calculateZTransform(){const s=this._pos,c=this._map;if(!c||!s)return"";let _=0;const v=this.getRotationAlignment();if("map"===v)if(c._showingGlobe()){const x=c.project(new h.bO(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),E=c.project(new h.bO(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(x);_=h.c4(Math.atan2(E.y,E.x))-90}else _=-c.getBearing();else if("horizon"===v){const x=h.ae(4,6,c.getZoom()),E=h.dM(c.transform);E.y+=x*c.transform.height;const R=s.sub(E),F=h.c4(Math.atan2(R.y,R.x));_=(F>90?F-270:F+90)*(1-x)}return _+=this._rotation,_?`rotateZ(${_}deg)`:""}_update(s){cancelAnimationFrame(this._updateFrameId);const c=this._map;c&&(c.transform.renderWorldCopies&&(this._lngLat=Tf(this._lngLat,this._pos,c.transform)),this._pos=c.project(this._lngLat,this._altitude),!0===s?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),c._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(c._showingGlobe()||c.getTerrain()||c.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(s){return this._offset=h.P.convert(s),this._update(),this}addClassName(s){return this._element.classList.add(s),this}removeClassName(s){return this._element.classList.remove(s),this}toggleClassName(s){return this._element.classList.toggle(s)}_onMove(s){const c=this._map;if(!c)return;const _=this._pointerdownPos,v=this._positionDelta;if(_&&v){if(!this._isDragging){const x=this._clickTolerance||c._clickTolerance;if(s.point.dist(_)<x)return;this._isDragging=!0}this._pos=s.point.sub(v),this._lngLat=c.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new h.A("dragstart"))),this.fire(new h.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const s=this._map;s&&(s.off("mousemove",this._onMove),s.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new h.A("dragend")),this._state="inactive"}_addDragHandler(s){const c=this._map,_=this._pos;c&&_&&this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(_),this._pointerdownPos=s.point,this._state="pending",c.on("mousemove",this._onMove),c.on("touchmove",this._onMove),c.once("mouseup",this._onUp),c.once("touchend",this._onUp))}setDraggable(s){this._draggable=!!s;const c=this._map;return c&&(s?(c.on("mousedown",this._addDragHandler),c.on("touchstart",this._addDragHandler)):(c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||As.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||As.rotationAlignment,this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s||As.pitchAlignment,this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(s){return this._occludedOpacity=s||As.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const xa={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Uo={maxWidth:100,unit:"metric"},qm={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},br={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},au=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ur(m=new h.P(0,0),s="bottom"){if("number"==typeof m){const c=Math.round(Math.sqrt(.5*Math.pow(m,2)));switch(s){case"top":return new h.P(0,m);case"top-left":return new h.P(c,c);case"top-right":return new h.P(-c,c);case"bottom":return new h.P(0,-m);case"bottom-left":return new h.P(c,-c);case"bottom-right":return new h.P(-c,-c);case"left":return new h.P(m,0);case"right":return new h.P(-m,0)}return new h.P(0,0)}return m instanceof h.P||Array.isArray(m)?h.P.convert(m):h.P.convert(m[s]||[0,0])}return{version:Jr,supported:jn.supported,setRTLTextPlugin:h.dN,getRTLTextPluginStatus:h.dO,Map:class extends lp{constructor(m){Kn.mark(Ro.create);const s=m;if(null!=(m=h.l({},fd,m)).minZoom&&null!=m.maxZoom&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=m.minPitch&&null!=m.maxPitch&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=m.minPitch&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=m.maxPitch&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(m.antialias&&h.dI(window)&&(m.antialias=!1,h.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new La(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies,null,null),m),this._repaint=!!m.repaint,this._interactive=m.interactive,this._minTileCacheSize=m.minTileCacheSize,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=m.crossSourceCollisions,this._collectResourceTiming=m.collectResourceTiming,this._language=this._parseLanguage(m.language),this._worldview=m.worldview,this._renderTaskQueue=new Us,this._domRenderTaskQueue=new Us,this._controls=[],this._markers=[],this._popups=[],this._mapId=h.aW(),this._locale=h.l({},su,m.locale),this._clickTolerance=m.clickTolerance,this._cooperativeGestures=m.cooperativeGestures,this._performanceMetricsCollection=m.performanceMetricsCollection,this._tessellationStep=m.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=m.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new ou(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=m.scaleFactor,this._requestManager=new Hc(m.transformRequest,m.accessToken,m.testMode),this._silenceAuthErrors=!!m.testMode,this._contextCreateOptions=m.contextCreateOptions?Object.assign({},m.contextCreateOptions):{},"string"==typeof m.container){const c=document.getElementById(m.container);if(!c)throw new Error(`Container '${m.container.toString()}' not found.`);this._container=c}else{if(!(m.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(this._container.childNodes.length>0&&h.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),m.maxBounds&&this.setMaxBounds(m.maxBounds),this._spriteFormat=m.spriteFormat,h.aQ(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Nm),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new E_(this,m),this._localFontFamily=m.localFontFamily,this._localIdeographFontFamily=m.localIdeographFontFamily,(m.style||!m.testMode)&&this.setStyle(m.style||h.e.DEFAULT_STYLE,{config:m.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),m.projection&&this.setProjection(m.projection),this.indoor=new xm(this),m.hash&&(this._hash=new bf("string"==typeof m.hash&&m.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){null==s.center&&null==s.zoom||(this.transform._unmodified=!1),this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch});const c=m.bounds;c&&(this.resize(),this.fitBounds(c,h.l({},m.fitBoundsOptions,{duration:0})))}this.resize(),m.attributionControl&&this.addControl(new Ga({customAttribution:m.customAttribution})),this._logoControl=new qa,this.addControl(this._logoControl,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",c=>{this._update("style"===c.dataType),this.fire(new h.A(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new h.A(`${c.dataType}dataloading`,c))}),this._interactions=new Mf(this)}_getMapId(){return this._mapId}addControl(m,s){if(void 0===s&&(s=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new h.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=m.onAdd(this);this._controls.push(m);const _=this._controlPositions[s];return-1!==s.indexOf("bottom")?_.insertBefore(c,_.firstChild):_.appendChild(c),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new h.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const s=this._controls.indexOf(m);return s>-1&&this._controls.splice(s,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(m){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const s=!this._moving;return s&&this.fire(new h.A("movestart",m)).fire(new h.A("move",m)),this.fire(new h.A("resize",m)),s&&this.fire(new h.A("moveend",m)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(m){return this.transform.setMaxBounds(h.aB.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m?this.setZoom(m):this.fire(new h.A("zoomstart")).fire(new h.A("zoom")).fire(new h.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m?this.setZoom(m):this.fire(new h.A("zoomstart")).fire(new h.A("zoom")).fire(new h.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m?this.setPitch(m):this.fire(new h.A("pitchstart")).fire(new h.A("pitch")).fire(new h.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m?this.setPitch(m):this.fire(new h.A("pitchstart")).fire(new h.A("pitch")).fire(new h.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(m){return this._scaleFactor=m,this.painter.scaleFactor=m,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(s=>"symbol"===s.type),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(m){return"auto"===m?navigator.language:Array.isArray(m)?0===m.length?void 0:m.map(s=>"auto"===s?navigator.language:s):m}setLanguage(m){const s=this._parseLanguage(m);if(!this.style||s===this._language)return this;this._language=s,this.style.reloadSources();for(const c of this._controls)c._setLanguage&&c._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(m){return this.style&&m!==this._worldview?(this._worldview=m,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(m){return this._lazyInitEmptyStyle(),m?"string"==typeof m&&(m={name:m}):m=null,this._useExplicitProjection=!!m,this._prioritizeAndUpdateProjection(m,this.style.projection)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const m=this.transform,s=m.projection.name;let c;"globe"===s&&m.zoom>=h.bY?(m.setMercatorFromTransition(),c=!0):"mercator"===s&&m.zoom<h.bY&&(m.setProjection({name:"globe"}),c=!0),c&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(m,s){return this._updateProjection(m||s||{name:"mercator"})}_updateProjection(m){let s;return s="globe"===m.name&&this.transform.zoom>=h.bY?this.transform.setMercatorFromTransition():this.transform.setProjection(m),this.style.applyProjectionUpdate(),s&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(m,s){return this.transform.locationPoint3D(h.bO.convert(m),s)}unproject(m,s){return this.transform.pointLocation3D(h.P.convert(m),s)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(m,s,c){const _=v=>{let x=[];if(Array.isArray(s)){const E=s.filter(R=>this.getLayer(R));x=E.length?this.queryRenderedFeatures(v,{layers:E}):[]}else x=this.queryRenderedFeatures(v,{target:s});return x};if("mouseenter"===m||"mouseover"===m){let v=!1;return{listener:c,targets:s,delegates:{mousemove:E=>{const R=_(E.point);R.length?v||(v=!0,c.call(this,new va(m,this,E.originalEvent,{features:R}))):v=!1},mouseout:()=>{v=!1}}}}if("mouseleave"===m||"mouseout"===m){let v=!1;return{listener:c,targets:s,delegates:{mousemove:R=>{_(R.point).length?v=!0:v&&(v=!1,c.call(this,new va(m,this,R.originalEvent)))},mouseout:R=>{v&&(v=!1,c.call(this,new va(m,this,R.originalEvent)))}}}}{const v=x=>{const E=_(x.point);E.length&&(x.features=E,c.call(this,x),delete x.features)};return{listener:c,targets:s,delegates:{[m]:v}}}}on(m,s,c){if("function"==typeof s||void 0===c)return super.on(m,s);if("string"==typeof s&&(s=[s]),!this._areTargetsValid(s))return this;const _=this._createDelegatedListener(m,s,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(_);for(const v in _.delegates)this.on(v,_.delegates[v]);return this}once(m,s,c){if("function"==typeof s||void 0===c)return super.once(m,s);if("string"==typeof s&&(s=[s]),!this._areTargetsValid(s))return this;const _=this._createDelegatedListener(m,s,c);for(const v in _.delegates)this.once(v,_.delegates[v]);return this}off(m,s,c){if("function"==typeof s||void 0===c)return super.off(m,s);if("string"==typeof s&&(s=[s]),!this._areTargetsValid(s))return this;const _=this._delegatedListeners?this._delegatedListeners[m]:void 0;return _&&(v=>{for(let x=0;x<v.length;x++){const E=v[x];if(E.listener===c&&Ri(E.targets,s)){for(const R in E.delegates)this.off(R,E.delegates[R]);return v.splice(x,1),this}}})(_),this}queryRenderedFeatures(m,s){if(!this.style)return[];if(void 0===m||m instanceof h.P||Array.isArray(m)||void 0!==s||(s=m,m=void 0),m=m||[[0,0],[this.transform.width,this.transform.height]],!s){const x=this.style.queryRenderedFeatures(m,void 0,this.transform),E=this.style.queryRenderedFeatureset(m,void 0,this.transform);return x.concat(E)}let c=!0;if(s.target&&(c=this._isTargetValid(s.target),c&&!s.layers))return this.style.queryRenderedFeatureset(m,s,this.transform);let _=!0;if(s.layers&&Array.isArray(s.layers)){for(const x of s.layers)if(!this._isValidId(x)){_=!1;break}if(_&&!s.target)return this.style.queryRenderedFeatures(m,s,this.transform)}let v=[];return _&&(v=v.concat(this.style.queryRenderedFeatures(m,s,this.transform))),c&&(v=v.concat(this.style.queryRenderedFeatureset(m,s,this.transform))),v}querySourceFeatures(m,s){return!m||"string"==typeof m&&!this._isValidId(m)?[]:this.style.querySourceFeatures(m,s)}isPointOnSurface(m){const{name:s}=this.transform.projection;return"globe"!==s&&"mercator"!==s&&h.w(`${s} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(h.P.convert(m))}addInteraction(m,s){return this._interactions.add(m,s),this}removeInteraction(m){return this._interactions.remove(m),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(m){return this._cooperativeGestures=m,this}setStyle(m,s){return s=h.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},s),this.style&&m&&!1!==s.diff&&s.localFontFamily===this._localFontFamily&&s.localIdeographFontFamily===this._localIdeographFontFamily&&!s.config?(this.style._diffStyle(m,(c,_)=>{c?(h.w(`Unable to perform style diff: ${String(c.message||c.error||c)}. Rebuilding the style from scratch.`),this._updateStyle(m,s)):_&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._localFontFamily=s.localFontFamily,this._updateStyle(m,s))}_getUIString(m){const s=this._locale[m];if(null==s)throw new Error(`Missing UI string '${m}'`);return s}_updateStyle(m,s){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),m){const c=h.l({},s);s&&s.config&&(c.initialConfig=s.config,delete c.config),this.style=new bi(this,c).load(m),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new bi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(h.w("There is no style added to the map."),!1)}_isValidId(m){return null==m?(this.fire(new h.z(new Error("IDs can't be empty."))),!1):!h.cs(m)||(this.fire(new h.z(new Error(`IDs can't contain special symbols: "${m}".`))),!1)}_isTargetValid(m){return"featuresetId"in m?this._isValidId("importId"in m?m.importId:m.featuresetId):"layerId"in m&&this._isValidId(m.layerId)}_areTargetsValid(m){if(Array.isArray(m)){for(const s of m)if(!this._isValidId(s))return!1;return!0}return this._isTargetValid(m)}addSource(m,s){return this._isValidId(m)?(this._lazyInitEmptyStyle(),this.style.addSource(m,s),this._update(!0)):this}isSourceLoaded(m){return!!this._isValidId(m)&&!!this.style&&this.style._isSourceCacheLoaded(m)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(m,s,c){this._lazyInitEmptyStyle(),this.style.addSourceType(m,s,c)}removeSource(m){return this._isValidId(m)?(this.style.removeSource(m),this._updateTerrain(),this._update(!0)):this}getSource(m){return this._isValidId(m)?this.style.getOwnSource(m):null}addImage(m,s,{pixelRatio:c=1,sdf:_=!1,stretchX:v,stretchY:x,content:E}={}){this._lazyInitEmptyStyle();const R=h.I.from(m);if(s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap){const{width:F,height:N,data:z}=h.q.getImageData(s);this.style.addImage(R,{data:new h.r({width:F,height:N},z),pixelRatio:c,stretchX:v,stretchY:x,content:E,sdf:_,version:0,usvg:!1})}else if(void 0===s.width||void 0===s.height)this.fire(new h.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:F,height:N}=s,z=s;this.style.addImage(R,{data:new h.r({width:F,height:N},new Uint8Array(z.data)),pixelRatio:c,stretchX:v,stretchY:x,content:E,sdf:_,usvg:!1,version:0,userImage:z}),z.onAdd&&z.onAdd(this,m)}}updateImage(m,s){this._lazyInitEmptyStyle();const c=h.I.from(m),_=this.style.getImage(c);if(!_)return void this.fire(new h.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const v=s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap?h.q.getImageData(s):s,{width:x,height:E,data:R}=v;if(void 0===x||void 0===E)return void this.fire(new h.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(x!==(_.usvg?_.icon.usvg_tree.width:_.data.width)||E!==(_.usvg?_.icon.usvg_tree.height:_.data.height))return void this.fire(new h.z(new Error(`The width and height of the updated image (${x}, ${E})\n                must be that same as the previous version of the image\n                (${_.data.width}, ${_.data.height})`)));const F=!(s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap);let N=!1;_.usvg?(_.data=new h.r({width:x,height:E},new Uint8Array(R)),_.usvg=!1,_.icon=void 0,N=!0):_.data.replace(R,F),this.style.updateImage(c,_,N)}hasImage(m){return m?!!this.style&&!!this.style.getImage(h.I.from(m)):(this.fire(new h.z(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(h.I.from(m))}loadImage(m,s){h.o(this._requestManager.transformRequest(m,h.R.Image),(c,_)=>{s(c,_ instanceof HTMLImageElement?h.q.getImageData(_):_)})}listImages(){return this.style.listImages().map(m=>m.name)}addModel(m,s){this._lazyInitEmptyStyle(),this.style.addModel(m,s)}hasModel(m){return m?this.style.hasModel(m):(this.fire(new h.z(new Error("Missing required model id"))),!1)}removeModel(m){this.style.removeModel(m)}listModels(){return this.style.listModels()}addLayer(m,s){return this._isValidId(m.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(m,s),this._update(!0)):this}getSlot(m){const s=this.getLayer(m);return s&&s.slot||null}setSlot(m,s){return this.style.setSlot(m,s),this.style.mergeLayers(),this._update(!0)}addImport(m,s){return this.style.addImport(m,s),this}updateImport(m,s){return"string"!=typeof s&&s.id!==m?(this.removeImport(m),this.addImport(s)):(this.style.updateImport(m,s),this._update(!0))}removeImport(m){return this.style.removeImport(m),this}moveImport(m,s){return this.style.moveImport(m,s),this._update(!0)}moveLayer(m,s){return this._isValidId(m)?(this.style.moveLayer(m,s),this._update(!0)):this}removeLayer(m){return this._isValidId(m)?(this.style.removeLayer(m),this._update(!0)):this}getLayer(m){if(!this._isValidId(m))return null;const s=this.style.getOwnLayer(m);return s?"custom"===s.type?s.implementation:s.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(m,s,c){return this._isValidId(m)?(this.style.setLayerZoomRange(m,s,c),this._update(!0)):this}setFilter(m,s,c={}){return this._isValidId(m)?(this.style.setFilter(m,s,c),this._update(!0)):this}getFilter(m){return this._isValidId(m)?this.style.getFilter(m):null}setPaintProperty(m,s,c,_={}){return this._isValidId(m)?(this.style.setPaintProperty(m,s,c,_),this._update(!0)):this}getPaintProperty(m,s){return this._isValidId(m)?this.style.getPaintProperty(m,s):null}setLayoutProperty(m,s,c,_={}){return this._isValidId(m)?(this.style.setLayoutProperty(m,s,c,_),this._update(!0)):this}getLayoutProperty(m,s){return this._isValidId(m)?this.style.getLayoutProperty(m,s):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(m){return this.style.setGlyphsUrl(m),this._update(!0)}getSchema(m){return this.style.getSchema(m)}setSchema(m,s){return this.style.setSchema(m,s),this._update(!0)}getConfig(m){return this.style.getConfig(m)}setConfig(m,s){return this.style.setConfig(m,s),this._update(!0)}getConfigProperty(m,s){return this.style.getConfigProperty(m,s)}setConfigProperty(m,s,c){return this.style.setConfigProperty(m,s,c),this._update(!0)}getFeaturesetDescriptors(m){return this.style.getFeaturesetDescriptors(m)}setLights(m){if(this._lazyInitEmptyStyle(),m&&1===m.length&&"flat"===m[0].type){const s=m[0];s.properties?this.style.setFlatLight(s.properties,s.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(m),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const m=this.style.getLights()||[];return 0===m.length&&m.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),m}setLight(m,s={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:m}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(m){return this._lazyInitEmptyStyle(),!m&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(m),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(m){return this._lazyInitEmptyStyle(),this.style.setFog(m),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(m){return this._lazyInitEmptyStyle(),this.style.setSnow(m),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(m){return this._lazyInitEmptyStyle(),this.style.setRain(m),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(m){return this._lazyInitEmptyStyle(),this.style.setColorTheme(m),this._update(!0)}setImportColorTheme(m,s){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(m,s),this._update(!0)}setCamera(m){return this.style.setCamera(m),this._triggerCameraUpdate(m)}_triggerCameraUpdate(m){return this._update(this.transform.setOrthographicProjectionAtLowPitch("orthographic"===m["camera-projection"]))}getCamera(){return this.style.camera}_queryFogOpacity(m){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(h.bO.convert(m),this.transform):0}setFeatureState(m,s){return m.source&&!this._isValidId(m.source)?this:(this.style.setFeatureState(m,s),this._update())}removeFeatureState(m,s){return m.source&&!this._isValidId(m.source)?this:(this.style.removeFeatureState(m,s),this._update())}getFeatureState(m){return m.source&&!this._isValidId(m.source)?null:this.style.getFeatureState(m)}_updateContainerDimensions(){if(!this._container)return;const m=this._container.getBoundingClientRect().width||400,s=this._container.getBoundingClientRect().height||300;let c,_,v,x=this._container;for(;x&&(!_||!v);){const E=window.getComputedStyle(x).transform;E&&"none"!==E&&(c=E.match(/matrix.*\((.+)\)/)[1].split(", "),c[0]&&"0"!==c[0]&&"1"!==c[0]&&(_=c[0]),c[3]&&"0"!==c[3]&&"1"!==c[3]&&(v=c[3])),x=x.parentElement}this._containerWidth=_?Math.abs(m/_):m,this._containerHeight=v?Math.abs(s/v):s}_detectMissingCSS(){"rgb(250, 128, 114)"!==window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&h.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=ri("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();const s=this._canvasContainer=ri("div","mapboxgl-canvas-container",m);this._canvas=ri("canvas","mapboxgl-canvas",s),this._interactive&&(s.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const c=this._controlContainer=ri("div","mapboxgl-control-container",m),_=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(v=>{_[v]=ri("div",`mapboxgl-ctrl-${v}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,s){const c=h.q.devicePixelRatio||1;this._canvas.width=c*Math.ceil(m),this._canvas.height=c*Math.ceil(s),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${s}px`}_addMarker(m){this._markers.push(m)}_removeMarker(m){const s=this._markers.indexOf(m);-1!==s&&this._markers.splice(s,1)}_addPopup(m){this._popups.push(m)}_removePopup(m){const s=this._popups.indexOf(m);-1!==s&&this._popups.splice(s,1)}_setupPainter(){const m=h.l({},jn.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),s=this._canvas.getContext("webgl2",m);s?(fc(s,!0),this.painter=new tp(s,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",c=>{"source"===c.dataType&&this.painter.setTileLoadedFlag(!0)}),h.m.testSupport(s)):this.fire(new h.z(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new h.A("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style.reloadModels(),this.style.clearSources(),this._update(),this.fire(new h.A("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_requestDomTask(m){!this.loaded()||this.loaded()&&!this.isMoving()?m():this._domRenderTaskQueue.add(m)}_render(m){let s;this.fire(new h.A("renderstart")),++this._frameId;const c=this.painter.context.extTimerQuery,_=h.q.now(),v=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(s=v.createQuery(),v.beginQuery(c.TIME_ELAPSED_EXT,s)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(m),this._domRenderTaskQueue.run(m),this._removed)return;this._updateProjectionTransition();const x=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const N=this.transform.zoom,z=this.transform.pitch,U=h.q.now(),j=new h.aa(N,{now:U,fadeDuration:x,pitch:z,transition:this.style.transition});this.style.update(j)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let E=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),E=this._updateAverageElevation(_),this.style.updateSources(this.transform),this.isMoving()||this._forceMarkerAndPopupUpdate()):E=this._updateAverageElevation(_);const R=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,x,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),R&&(this._placementDirty=R.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new h.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,Kn.mark(Ro.load),this.fire(new h.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),s){const N=h.q.now()-_;v.endQuery(c.TIME_ELAPSED_EXT),setTimeout(()=>{const z=v.getQueryParameter(s,v.QUERY_RESULT)/1e6;v.deleteQuery(s),this.fire(new h.A("gpu-timing-frame",{cpuTime:N,gpuTime:z}))},50)}if(this.listens("gpu-timing-layer")){const N=this.painter.collectGpuTimers();setTimeout(()=>{const z=this.painter.queryGpuTimers(N);this.fire(new h.A("gpu-timing-layer",{layerTimes:z}))},50)}if(this.listens("gpu-timing-deferred-render")){const N=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const z=this.painter.queryGpuTimeDeferredRender(N);this.fire(new h.A("gpu-timing-deferred-render",{gpuTime:z}))},50)}const F=this._sourcesDirty||this._styleDirty||this._placementDirty||E;if(F||this._repaint)this.triggerRepaint();else{const N=this.idle();if(N&&(E=this._updateAverageElevation(_,!0)),E)this.triggerRepaint();else if(this._triggerFrame(!1),N&&(this.fire(new h.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const z=this._calculateSpeedIndex();this.fire(new h.A("speedindexcompleted",{speedIndex:z})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||F||(this._fullyLoaded=!0,Kn.mark(Ro.fullLoad),this._performanceMetricsCollection&&Wp(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(m){for(const s of this._markers)m&&!this.getRenderWorldCopies()&&(s._lngLat=s._lngLat.wrap()),s._update();for(const s of this._popups)!m||this.getRenderWorldCopies()||s._trackPointer||(s._lngLat=s._lngLat.wrap()),s._update()}_updateAverageElevation(m,s=!1){const c=v=>(this.transform.averageElevation=v,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&c(0);const _=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(_||(s||m-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(m)){const v=this.transform.averageElevation;let x=this.transform.sampleAverageElevation();null!=this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(x)?x=0:this._averageElevationLastSampledAt=m;const E=Math.abs(v-x);if(E>1){if(this._isInitialLoad||_)return this._averageElevation.jumpTo(x),c(x);this._averageElevation.easeTo(x,m,300)}else if(E>1e-4)return this._averageElevation.jumpTo(x),c(x)}return!!this._averageElevation.isEasing(m)&&c(this._averageElevation.getValue(m))}_authenticate(){ge(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,m=>{if(m&&(m.message===zl||401===m.status)){const s=this.painter.context.gl;fc(s,!1),this._logoControl instanceof qa&&this._logoControl._updateLogo(),s&&s.clear(s.DEPTH_BUFFER_BIT|s.COLOR_BUFFER_BIT|s.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new h.z(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),qp(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Zs(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const m=this._isDragging();this.painter.updateTerrain(this.style,m)}_calculateSpeedIndex(){const m=this.painter.canvasCopy(),s=this.painter.getCanvasCopiesAndTimestamps();s.timeStamps.push(performance.now());const c=this.painter.context.gl,_=c.createFramebuffer();function v(x){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,x,0);const E=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,E),E}return c.bindFramebuffer(c.FRAMEBUFFER,_),this._canvasPixelComparison(v(m),s.canvasCopies.map(v),s.timeStamps)}_canvasPixelComparison(m,s,c){let _=c[1]-c[0];const v=m.length/4;for(let x=0;x<s.length;x++){const E=s[x];let R=0;for(let F=0;F<E.length;F+=4)E[F]===m[F]&&E[F+1]===m[F+1]&&E[F+2]===m[F+2]&&E[F+3]===m[F+3]&&(R+=1);_+=(c[x+2]-c[x+1])*(1-R/v)}return _}remove(){this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Lh.delete(this.painter.context.gl),$c.remove(),$n.remove(),this._removed=!0,this.fire(new h.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(m){this._renderNextFrame=this._renderNextFrame||m,this.style&&!this._frame&&(this._frame=h.q.frame(s=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(s)}))}_preloadTiles(m){const s=this.style?this.style.getSourceCaches():[];return h.bl(s,(c,_)=>c._preloadTiles(m,_),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}_onVisibilityChange(){"hidden"===document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(m){this._showParseStatus!==m&&(this._showParseStatus=m,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(m){this._showTerrainWireframe!==m&&(this._showTerrainWireframe=m,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(m){this._showLayers2DWireframe!==m&&(this._showLayers2DWireframe=m,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(m){this._showLayers3DWireframe!==m&&(this._showLayers3DWireframe=m,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(m){this._speedIndexTiming!==m&&(this._speedIndexTiming=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,this._tp.refreshUI(),m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(m){this._showTileAABBs!==m&&(this._showTileAABBs=m,this._tp.refreshUI(),m&&this._update())}_setCacheLimits(m,s){h.dJ(m,s)}get version(){return Jr}},NavigationControl:class{constructor(m={}){this.options=h.l({},Uv,m),this._container=ri("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(h.aQ(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",s=>{this._map&&this._map.zoomIn({},{originalEvent:s})}),ri("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",s=>{this._map&&this._map.zoomOut({},{originalEvent:s})}),ri("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(h.aQ(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",s=>{const c=this._map;c&&(this.options.visualizePitch?c.resetNorthPitch({},{originalEvent:s}):c.resetNorth({},{originalEvent:s}))}),this._compassIcon=ri("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const m=this._map;if(!m)return;const s=m.getZoom(),c=s===m.getMaxZoom(),_=s===m.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())}_rotateCompassArrow(){const m=this._map;if(!m)return;const s=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(m.transform.pitch*(Math.PI/180)),.5)}) rotateX(${m.transform.pitch}deg) rotateZ(${m.transform.angle*(180/Math.PI)}deg)`:`rotate(${m.transform.angle*(180/Math.PI)}deg)`;m._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=s)})}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),m.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&m.on("pitch",this._rotateCompassArrow),m.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new jv(m,this._compass,this.options.visualizePitch)),this._container}onRemove(){const m=this._map;m&&(this._container.remove(),this.options.showZoom&&m.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&m.off("pitch",this._rotateCompassArrow),m.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(m,s){const c=ri("button",m,this._container);return c.type="button",c.addEventListener("click",s),c}_setButtonTitle(m,s){if(!this._map)return;const c=this._map._getUIString(`NavigationControl.${s}`);m.setAttribute("aria-label",c),m.firstElementChild&&m.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends h.E{constructor(m={}){super();const s=navigator.geolocation;this.options=h.l({geolocation:s},xa,m),h.aQ(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=np(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(m){return this._map=m,this._container=ri("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(m){const s=(c=!!this.options.geolocation)=>{this._supportsGeolocation=c,m(c)};void 0!==this._supportsGeolocation?m(this._supportsGeolocation):void 0!==navigator.permissions?navigator.permissions.query({name:"geolocation"}).then(c=>s("denied"!==c.state)).catch(()=>s()):s()}_isOutOfMapMaxBounds(m){const s=this._map.getMaxBounds(),c=m.coords;return!!s&&(c.longitude<s.getWest()||c.longitude>s.getEast()||c.latitude<s.getSouth()||c.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new h.A("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(m),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(m),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new h.A("geolocate",m)),this._finish()}}_updateCamera(m){const s=new h.bO(m.coords.longitude,m.coords.latitude),c=m.coords.accuracy,_=this._map.getBearing(),v=h.l({bearing:_},this.options.fitBoundsOptions);this._map.fitBounds(s.toBounds(c),v,{geolocateSource:!0})}_updateMarker(m){if(m){const s=new h.bO(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map.transform,s=h.bH(1,m._center.lat)*m.worldSize,c=Math.ceil(2*this._accuracy*s);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(m){if(this._map){if(this.options.trackUserLocation)if(1===m.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===m.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new h.A("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",s=>s.preventDefault()),this._geolocateButton=ri("button","mapboxgl-ctrl-geolocate",this._container),ri("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===m){h.w("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ri("div","mapboxgl-user-location"),this._dotElement.appendChild(ri("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ri("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Co({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ri("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Co({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||"ACTIVE_LOCK"!==this._watchState||s.originalEvent&&"resize"===s.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new h.A("trackuserlocationend")))})}}_onDeviceOrientation(m){this._userLocationDotMarker&&(m.webkitCompassHeading?this._heading=m.webkitCompassHeading:!0===m.absolute&&(this._heading=-1*m.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return h.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new h.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new h.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new h.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let m;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(m={maximumAge:6e5,timeout:0},this._noTimeout=!0):(m=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,m),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const m=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(s=>{"granted"===s&&m()}).catch(console.error):m()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Ga,ScaleControl:class{constructor(m={}){this.options=h.l({},Uo,m),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),h.aQ(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const m=this.options.maxWidth||100,s=this._map,c=s._containerHeight/2,_=s._containerWidth/2-m/2,v=s.unproject([_,c]),x=s.unproject([_+m,c]),E=v.distanceTo(x);if("imperial"===this.options.unit){const R=3.2808*E;R>5280?this._setScale(m,R/5280,"mile"):this._setScale(m,R,"foot")}else"nautical"===this.options.unit?this._setScale(m,E/1852,"nautical-mile"):E>=1e3?this._setScale(m,E/1e3,"kilometer"):this._setScale(m,E,"meter")}_setScale(m,s,c){this._map._requestDomTask(()=>{const _=function(x){const E=Math.pow(10,`${Math.floor(x)}`.length-1);let R=x/E;return R=R>=10?10:R>=5?5:R>=3?3:R>=2?2:R>=1?1:function(F){const N=Math.pow(10,Math.ceil(-Math.log(F)/Math.LN10));return Math.round(F*N)/N}(R),E*R}(s),v=_/s;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==c?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:c}).format(_):`${_}&nbsp;${qm[c]}`,this._container.style.width=m*v+"px"})}onAdd(m){return this._map=m,this._language=m.getLanguage(),this._container=ri("div","mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(m){this._language=m,this._update()}setUnit(m){this.options.unit=m,this._update()}},FullscreenControl:class{constructor(m={}){this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:h.w("Full screen control 'container' must be a DOM element.")),h.aQ(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=ri("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",h.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=ri("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ri("span","mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",m)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends h.E{constructor(m){super(),this.options=h.l(Object.create(br),m),this._altitude=this.options.altitude,h.aQ(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(m&&m.className?m.className.trim().split(/\s+/):[])}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&m.on("preclick",this._onClose),this.options.closeOnMove&&m.on("move",this._onClose),m.on("remove",this.remove),this._update(),m._addPopup(this),this._focusFirstElement(),this._trackPointer?(m.on("mousemove",this._onMouseEvent),m.on("mouseup",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")):m.on("move",this._update),this.fire(new h.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const m=this._map;return m&&(m.off("move",this._update),m.off("move",this._onClose),m.off("preclick",this._onClose),m.off("click",this._onClose),m.off("remove",this.remove),m.off("mousemove",this._onMouseEvent),m.off("mouseup",this._onMouseEvent),m.off("drag",this._onMouseEvent),m._canvasContainer&&m._canvasContainer.classList.remove("mapboxgl-track-pointer"),m._removePopup(this),this._map=void 0),this.fire(new h.A("close")),this}getLngLat(){return this._lngLat}setLngLat(m){this._lngLat=h.bO.convert(m),this._pos=null,this._trackPointer=!1,this._update();const s=this._map;return s&&(s.on("move",this._update),s.off("mousemove",this._onMouseEvent),s._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(m){return this._altitude=m,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const m=this._map;return m&&(m.off("move",this._update),m.on("mousemove",this._onMouseEvent),m.on("drag",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const s=document.createDocumentFragment(),c=document.createElement("body");let _;for(c.innerHTML=m;_=c.firstChild,_;)s.appendChild(_);return this.setDOMContent(s)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){let s=this._content;if(s)for(;s.hasChildNodes();)s.firstChild&&s.removeChild(s.firstChild);else s=this._content=ri("div","mapboxgl-popup-content",this._container||void 0);if(s.appendChild(m),this.options.closeButton){const c=this._closeButton=ri("button","mapboxgl-popup-close-button",s);c.type="button",c.setAttribute("aria-label","Close popup"),c.innerHTML='<span aria-hidden="true">&#215;</span>',c.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(m){return this._classList.add(m),this._updateClassList(),this}removeClassName(m){return this._classList.delete(m),this._updateClassList(),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){let s;return this._classList.delete(m)?s=!1:(this._classList.add(m),s=!0),this._updateClassList(),s}_onMouseEvent(m){this._update(m.point)}_getAnchor(m){if(this.options.anchor)return this.options.anchor;const s=this._map,c=this._container,_=this._pos;if(!s||!c||!_)return"bottom";const v=c.offsetWidth,x=c.offsetHeight,E=_.x<v/2,R=_.x>s.transform.width-v/2;if(_.y+m<x)return E?"top-left":R?"top-right":"top";if(_.y>s.transform.height-x){if(E)return"bottom-left";if(R)return"bottom-right"}return E?"left":R?"right":"bottom"}_updateClassList(){const m=this._container;if(!m)return;const s=[...this._classList];s.push("mapboxgl-popup"),this._anchor&&s.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&s.push("mapboxgl-popup-track-pointer"),m.className=s.join(" ")}_update(m){const s=this._map,c=this._content;if(!s||!this._lngLat&&!this._trackPointer||!c)return;let _=this._container;if(_||(_=this._container=ri("div","mapboxgl-popup",s.getContainer()),this._tip=ri("div","mapboxgl-popup-tip",_),_.appendChild(c)),this.options.maxWidth&&_.style.maxWidth!==this.options.maxWidth&&(_.style.maxWidth=this.options.maxWidth),s.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Tf(this._lngLat,this._pos,s.transform)),!this._trackPointer||m){const v=this._pos=this._trackPointer&&m instanceof h.P?m:s.project(this._lngLat,this._altitude),x=Ur(this.options.offset),E=this._anchor=this._getAnchor(x.y),R=Ur(this.options.offset,E),F=v.add(R).round();s._requestDomTask(()=>{this._container&&E&&(this._container.style.transform=`${Dc[E]} translate(${F.x}px,${F.y}px)`)})}if(!this._marker&&s._showingGlobe()){const v=h.dK(s.transform,this._lngLat)?0:1;this._setOpacity(v)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(au);m&&m.focus()}_onClose(){this.remove()}_setOpacity(m){this._container&&(this._container.style.opacity=`${m}`),this._content&&(this._content.style.pointerEvents=m?"auto":"none")}},Marker:Co,Style:bi,LngLat:h.bO,LngLatBounds:h.aB,Point:h.P,MercatorCoordinate:h.ac,FreeCameraOptions:zu,Evented:h.E,config:h.e,prewarm:h.dP,clearPrewarmedResources:h.dQ,get accessToken(){return h.e.ACCESS_TOKEN},set accessToken(m){h.e.ACCESS_TOKEN=m},get baseApiUrl(){return h.e.API_URL},set baseApiUrl(m){h.e.API_URL=m},get workerCount(){return h.dR.workerCount},set workerCount(m){h.dR.workerCount=m},get maxParallelImageRequests(){return h.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){h.e.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){h.dS(m)},get workerUrl(){return h.dT.workerUrl},set workerUrl(m){h.dT.workerUrl=m},get workerClass(){return h.dT.workerClass},set workerClass(m){h.dT.workerClass=m},get workerParams(){return h.dT.workerParams},set workerParams(m){h.dT.workerParams=m},get dracoUrl(){return h.dU()},set dracoUrl(m){h.dV(m)},get meshoptUrl(){return h.dW()},set meshoptUrl(m){h.dX(m)},setNow:h.q.setNow,restoreNow:h.q.restoreNow}}),Iu}()},458:(hm,Ph,Ll)=>{"use strict";function pm(t,n){return Object.is(t,n)}let h=null,Jr=!1,Ro=1;const Kn=Symbol("SIGNAL");function Gn(t){const n=h;return h=t,n}const ri={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,kind:"unknown",producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function Bi(t){if(Jr)throw new Error("");if(null===h)return;h.consumerOnSignalRead(t);const n=h.nextProducerIndex++;Hc(h),n<h.producerNode.length&&h.producerNode[n]!==t&&zl(h)&&Nl(h.producerNode[n],h.producerIndexOfThis[n]),h.producerNode[n]!==t&&(h.producerNode[n]=t,h.producerIndexOfThis[n]=zl(h)?zn(t,h,n):0),h.producerLastReadVersion[n]=t.version}function Ta(t){if((!zl(t)||t.dirty)&&(t.dirty||t.lastCleanEpoch!==Ro)){if(!t.producerMustRecompute(t)&&!pc(t))return void Ia(t);t.producerRecomputeValue(t),Ia(t)}}function jc(t){if(void 0===t.liveConsumerNode)return;const n=Jr;Jr=!0;try{for(const e of t.liveConsumerNode)e.dirty||Ld(e)}finally{Jr=n}}function Li(){return!1!==h?.consumerAllowSignalWrites}function Ld(t){t.dirty=!0,jc(t),t.consumerMarkedDirty?.(t)}function Ia(t){t.dirty=!1,t.lastCleanEpoch=Ro}function Sn(t){return t&&(t.nextProducerIndex=0),Gn(t)}function Aa(t,n){if(Gn(n),t&&void 0!==t.producerNode&&void 0!==t.producerIndexOfThis&&void 0!==t.producerLastReadVersion){if(zl(t))for(let e=t.nextProducerIndex;e<t.producerNode.length;e++)Nl(t.producerNode[e],t.producerIndexOfThis[e]);for(;t.producerNode.length>t.nextProducerIndex;)t.producerNode.pop(),t.producerLastReadVersion.pop(),t.producerIndexOfThis.pop()}}function pc(t){Hc(t);for(let n=0;n<t.producerNode.length;n++){const e=t.producerNode[n],i=t.producerLastReadVersion[n];if(i!==e.version||(Ta(e),i!==e.version))return!0}return!1}function On(t){if(Hc(t),zl(t))for(let n=0;n<t.producerNode.length;n++)Nl(t.producerNode[n],t.producerIndexOfThis[n]);t.producerNode.length=t.producerLastReadVersion.length=t.producerIndexOfThis.length=0,t.liveConsumerNode&&(t.liveConsumerNode.length=t.liveConsumerIndexOfThis.length=0)}function zn(t,n,e){if(oi(t),0===t.liveConsumerNode.length&&Ys(t))for(let i=0;i<t.producerNode.length;i++)t.producerIndexOfThis[i]=zn(t.producerNode[i],t,i);return t.liveConsumerIndexOfThis.push(e),t.liveConsumerNode.push(n)-1}function Nl(t,n){if(oi(t),1===t.liveConsumerNode.length&&Ys(t))for(let i=0;i<t.producerNode.length;i++)Nl(t.producerNode[i],t.producerIndexOfThis[i]);const e=t.liveConsumerNode.length-1;if(t.liveConsumerNode[n]=t.liveConsumerNode[e],t.liveConsumerIndexOfThis[n]=t.liveConsumerIndexOfThis[e],t.liveConsumerNode.length--,t.liveConsumerIndexOfThis.length--,n<t.liveConsumerNode.length){const i=t.liveConsumerIndexOfThis[n],r=t.liveConsumerNode[n];Hc(r),r.producerIndexOfThis[i]=n}}function zl(t){return t.consumerIsAlwaysLive||(t?.liveConsumerNode?.length??0)>0}function Hc(t){t.producerNode??=[],t.producerIndexOfThis??=[],t.producerLastReadVersion??=[]}function oi(t){t.liveConsumerNode??=[],t.liveConsumerIndexOfThis??=[]}function Ys(t){return void 0!==t.producerNode}function il(t,n){const e=Object.create(Gp);e.computation=t,void 0!==n&&(e.equal=n);const i=()=>{if(Ta(e),Bi(e),e.value===Yo)throw e.error;return e.value};return i[Kn]=e,i}const rl=Symbol("UNSET"),qn=Symbol("COMPUTING"),Yo=Symbol("ERRORED"),Gp={...ri,value:rl,dirty:!0,error:null,equal:pm,kind:"computed",producerMustRecompute:t=>t.value===rl||t.value===qn,producerRecomputeValue(t){if(t.value===qn)throw new Error("Detected cycle in computations.");const n=t.value;t.value=qn;const e=Sn(t);let i,r=!1;try{i=t.computation(),Gn(null),r=n!==rl&&n!==Yo&&i!==Yo&&t.equal(n,i)}catch(l){i=Yo,t.error=l}finally{Aa(t,e)}r?t.value=n:(t.value=i,t.version++)}};let $n=function Oh(){throw new Error};function qp(t){$n(t)}function $c(t,n){Li()||qp(t),t.equal(t.value,n)||(t.value=n,function Nd(t){t.version++,function fi(){Ro++}(),jc(t)}(t))}const fc={...ri,equal:pm,value:void 0,kind:"signal"};let sl;function gc(){return sl}function Fs(t){const n=sl;return sl=t,n}const zd=Symbol("NotFound");function Dr(t){return"function"==typeof t}function Gc(t){const e=t(i=>{Error.call(i),i.stack=(new Error).stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}Error;const ls=Gc(t=>function(e){t(this),this.message=e?`${e.length} errors occurred during unsubscription:\n${e.map((i,r)=>`${r+1}) ${i.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=e});function al(t,n){if(t){const e=t.indexOf(n);0<=e&&t.splice(e,1)}}class Mi{constructor(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let n;if(!this.closed){this.closed=!0;const{_parentage:e}=this;if(e)if(this._parentage=null,Array.isArray(e))for(const l of e)l.remove(this);else e.remove(this);const{initialTeardown:i}=this;if(Dr(i))try{i()}catch(l){n=l instanceof ls?l.errors:[l]}const{_finalizers:r}=this;if(r){this._finalizers=null;for(const l of r)try{Bd(l)}catch(f){n=n??[],f instanceof ls?n=[...n,...f.errors]:n.push(f)}}if(n)throw new ls(n)}}add(n){var e;if(n&&n!==this)if(this.closed)Bd(n);else{if(n instanceof Mi){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._finalizers=null!==(e=this._finalizers)&&void 0!==e?e:[]).push(n)}}_hasParent(n){const{_parentage:e}=this;return e===n||Array.isArray(e)&&e.includes(n)}_addParent(n){const{_parentage:e}=this;this._parentage=Array.isArray(e)?(e.push(n),e):e?[e,n]:n}_removeParent(n){const{_parentage:e}=this;e===n?this._parentage=null:Array.isArray(e)&&al(e,n)}remove(n){const{_finalizers:e}=this;e&&al(e,n),n instanceof Mi&&n._removeParent(this)}}Mi.EMPTY=(()=>{const t=new Mi;return t.closed=!0,t})();const Nh=Mi.EMPTY;function zh(t){return t instanceof Mi||t&&"closed"in t&&Dr(t.remove)&&Dr(t.add)&&Dr(t.unsubscribe)}function Bd(t){Dr(t)?t():t.unsubscribe()}const ka={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Ls={setTimeout(t,n,...e){const{delegate:i}=Ls;return i?.setTimeout?i.setTimeout(t,n,...e):setTimeout(t,n,...e)},clearTimeout(t){const{delegate:n}=Ls;return(n?.clearTimeout||clearTimeout)(t)},delegate:void 0};function Au(t){Ls.setTimeout(()=>{const{onUnhandledError:n}=ka;if(!n)throw t;n(t)})}function Ir(){}const ir=ws("C",void 0,void 0);function ws(t,n,e){return{kind:t,value:n,error:e}}let Ra=null;function Vd(t){if(ka.useDeprecatedSynchronousErrorHandling){const n=!Ra;if(n&&(Ra={errorThrown:!1,error:null}),t(),n){const{errorThrown:e,error:i}=Ra;if(Ra=null,e)throw i}}else t()}class Uh extends Mi{constructor(n){super(),this.isStopped=!1,n?(this.destination=n,zh(n)&&n.add(this)):this.destination=Ae}static create(n,e,i){return new re(n,e,i)}next(n){this.isStopped?Pe(function Bh(t){return ws("N",t,void 0)}(n),this):this._next(n)}error(n){this.isStopped?Pe(function Yp(t){return ws("E",void 0,t)}(n),this):(this.isStopped=!0,this._error(n))}complete(){this.isStopped?Pe(ir,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(n){this.destination.next(n)}_error(n){try{this.destination.error(n)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const fm=Function.prototype.bind;function ku(t,n){return fm.call(t,n)}class it{constructor(n){this.partialObserver=n}next(n){const{partialObserver:e}=this;if(e.next)try{e.next(n)}catch(i){ce(i)}}error(n){const{partialObserver:e}=this;if(e.error)try{e.error(n)}catch(i){ce(i)}else ce(n)}complete(){const{partialObserver:n}=this;if(n.complete)try{n.complete()}catch(e){ce(e)}}}class re extends Uh{constructor(n,e,i){let r;if(super(),Dr(n)||!n)r={next:n??void 0,error:e??void 0,complete:i??void 0};else{let l;this&&ka.useDeprecatedNextContext?(l=Object.create(n),l.unsubscribe=()=>this.unsubscribe(),r={next:n.next&&ku(n.next,l),error:n.error&&ku(n.error,l),complete:n.complete&&ku(n.complete,l)}):r=n}this.destination=new it(r)}}function ce(t){ka.useDeprecatedSynchronousErrorHandling?function Vh(t){ka.useDeprecatedSynchronousErrorHandling&&Ra&&(Ra.errorThrown=!0,Ra.error=t)}(t):Au(t)}function Pe(t,n){const{onStoppedNotification:e}=ka;e&&Ls.setTimeout(()=>e(t,n))}const Ae={closed:!0,next:Ir,error:function Se(t){throw t},complete:Ir},Ne="function"==typeof Symbol&&Symbol.observable||"@@observable";function Ke(t){return t}function tt(t){return 0===t.length?Ke:1===t.length?t[0]:function(e){return t.reduce((i,r)=>r(i),e)}}let Qe=(()=>{class t{constructor(e){e&&(this._subscribe=e)}lift(e){const i=new t;return i.source=this,i.operator=e,i}subscribe(e,i,r){const l=function Yt(t){return t&&t instanceof Uh||function Dt(t){return t&&Dr(t.next)&&Dr(t.error)&&Dr(t.complete)}(t)&&zh(t)}(e)?e:new re(e,i,r);return Vd(()=>{const{operator:f,source:w}=this;l.add(f?f.call(l,w):w?this._subscribe(l):this._trySubscribe(l))}),l}_trySubscribe(e){try{return this._subscribe(e)}catch(i){e.error(i)}}forEach(e,i){return new(i=nt(i))((r,l)=>{const f=new re({next:w=>{try{e(w)}catch(M){l(M),f.unsubscribe()}},error:l,complete:r});this.subscribe(f)})}_subscribe(e){var i;return null===(i=this.source)||void 0===i?void 0:i.subscribe(e)}[Ne](){return this}pipe(...e){return tt(e)(this)}toPromise(e){return new(e=nt(e))((i,r)=>{let l;this.subscribe(f=>l=f,f=>r(f),()=>i(l))})}}return t.create=n=>new t(n),t})();function nt(t){var n;return null!==(n=t??ka.Promise)&&void 0!==n?n:Promise}const Qt=Gc(t=>function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let Et=(()=>{class t extends Qe{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(e){const i=new Ln(this,this);return i.operator=e,i}_throwIfClosed(){if(this.closed)throw new Qt}next(e){Vd(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const i of this.currentObservers)i.next(e)}})}error(e){Vd(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=e;const{observers:i}=this;for(;i.length;)i.shift().error(e)}})}complete(){Vd(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:e}=this;for(;e.length;)e.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0}_trySubscribe(e){return this._throwIfClosed(),super._trySubscribe(e)}_subscribe(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)}_innerSubscribe(e){const{hasError:i,isStopped:r,observers:l}=this;return i||r?Nh:(this.currentObservers=null,l.push(e),new Mi(()=>{this.currentObservers=null,al(l,e)}))}_checkFinalizedStatuses(e){const{hasError:i,thrownError:r,isStopped:l}=this;i?e.error(r):l&&e.complete()}asObservable(){const e=new Qe;return e.source=this,e}}return t.create=(n,e)=>new Ln(n,e),t})();class Ln extends Et{constructor(n,e){super(),this.destination=n,this.source=e}next(n){var e,i;null===(i=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===i||i.call(e,n)}error(n){var e,i;null===(i=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===i||i.call(e,n)}complete(){var n,e;null===(e=null===(n=this.destination)||void 0===n?void 0:n.complete)||void 0===e||e.call(n)}_subscribe(n){var e,i;return null!==(i=null===(e=this.source)||void 0===e?void 0:e.subscribe(n))&&void 0!==i?i:Nh}}class pn extends Et{constructor(n){super(),this._value=n}get value(){return this.getValue()}_subscribe(n){const e=super._subscribe(n);return!e.closed&&n.next(this._value),e}getValue(){const{hasError:n,thrownError:e,_value:i}=this;if(n)throw e;return this._throwIfClosed(),i}next(n){super.next(this._value=n)}}function Hn(t){return Dr(t?.lift)}function Jn(t){return n=>{if(Hn(n))return n.lift(function(e){try{return t(e,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function li(t,n,e,i,r){return new si(t,n,e,i,r)}class si extends Uh{constructor(n,e,i,r,l,f){super(n),this.onFinalize=l,this.shouldUnsubscribe=f,this._next=e?function(w){try{e(w)}catch(M){n.error(M)}}:super._next,this._error=r?function(w){try{r(w)}catch(M){n.error(M)}finally{this.unsubscribe()}}:super._error,this._complete=i?function(){try{i()}catch(w){n.error(w)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:e}=this;super.unsubscribe(),!e&&(null===(n=this.onFinalize)||void 0===n||n.call(this))}}}function an(t,n){return Jn((e,i)=>{let r=0;e.subscribe(li(i,l=>{i.next(t.call(n,l,r++))}))})}const ji="https://angular.dev/best-practices/security#preventing-cross-site-scripting-xss";class bt extends Error{code;constructor(n,e){super(function eo(t,n){return`${function Oo(t){return`NG0${Math.abs(t)}`}(t)}${n?": "+n:""}`}(n,e)),this.code=n}}const Ks=Symbol("InputSignalNode#UNSET"),Cs={...fc,transformFn:void 0,applyValueToInputSignal(t,n){$c(t,n)}};function Fo(t,n){const e=Object.create(Cs);function i(){if(Bi(e),e.value===Ks)throw new bt(-950,null);return e.value}return e.value=t,e.transformFn=n?.transform,i[Kn]=e,i}function la(t){return{toString:t}.toString()}const ca="__parameters__";function Vl(t,n,e){return la(()=>{const i=function Ru(t){return function(...e){if(t){const i=t(...e);for(const r in i)this[r]=i[r]}}}(n);function r(...l){if(this instanceof r)return i.apply(this,l),this;const f=new r(...l);return w.annotation=f,w;function w(M,P,L){const $=M.hasOwnProperty(ca)?M[ca]:Object.defineProperty(M,ca,{value:[]})[ca];for(;$.length<=L;)$.push(null);return($[L]=$[L]||[]).push(f),M}}return r.prototype.ngMetadataName=t,r.annotationCls=r,r})}const ho=globalThis;function gr(t){for(let n in t)if(t[n]===gr)return n;throw Error("Could not find renamed property on target object.")}function Pa(t,n){for(const e in n)n.hasOwnProperty(e)&&!t.hasOwnProperty(e)&&(t[e]=n[e])}function Lr(t){if("string"==typeof t)return t;if(Array.isArray(t))return`[${t.map(Lr).join(", ")}]`;if(null==t)return""+t;const n=t.overriddenName||t.name;if(n)return`${n}`;const e=t.toString();if(null==e)return""+e;const i=e.indexOf("\n");return i>=0?e.slice(0,i):e}function _c(t,n){return t?n?`${t} ${n}`:t:n||""}const da=gr({__forward_ref__:gr});function ur(t){return t.__forward_ref__=ur,t.toString=function(){return Lr(this())},t}function vi(t){return Pu(t)?t():t}function Pu(t){return"function"==typeof t&&t.hasOwnProperty(da)&&t.__forward_ref__===ur}function Nt(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}function Ai(t){return{providers:t.providers||[],imports:t.imports||[]}}function jd(t){return Xo(t,Wc)||Xo(t,Ou)}function Xo(t,n){return t.hasOwnProperty(n)?t[n]:null}function ha(t){return t&&(t.hasOwnProperty(Kp)||t.hasOwnProperty(gm))?t[Kp]:null}const Wc=gr({\u0275prov:gr}),Kp=gr({\u0275inj:gr}),Ou=gr({ngInjectableDef:gr}),gm=gr({ngInjectorDef:gr});class _t{_desc;ngMetadataName="InjectionToken";\u0275prov;constructor(n,e){this._desc=n,this.\u0275prov=void 0,"number"==typeof e?this.__NG_ELEMENT_ID__=e:void 0!==e&&(this.\u0275prov=Nt({token:this,providedIn:e.providedIn||"root",factory:e.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function $d(t){return t&&!!t.\u0275providers}const Fa=gr({\u0275cmp:gr}),jl=gr({\u0275dir:gr}),t_=gr({\u0275pipe:gr}),yc=gr({\u0275mod:gr}),Yc=gr({\u0275fac:gr}),Gd=gr({__NG_ELEMENT_ID__:gr}),Ss=gr({__NG_ENV_ID__:gr});function zi(t){return"string"==typeof t?t:null==t?"":String(t)}function vv(t,n){throw new bt(-200,t)}function Lu(t,n){throw new bt(-201,!1)}var rr=function(t){return t[t.Default=0]="Default",t[t.Host=1]="Host",t[t.Self=2]="Self",t[t.SkipSelf=4]="SkipSelf",t[t.Optional=8]="Optional",t}(rr||{});let Zc;function qd(){return Zc}function Ds(t){const n=Zc;return Zc=t,n}function Xc(t,n,e){const i=jd(t);return i&&"root"==i.providedIn?void 0===i.value?i.value=i.factory():i.value:e&rr.Optional?null:void 0!==n?n:void Lu()}const Nu={},_m="__NG_DI_FLAG__";class xv{injector;constructor(n){this.injector=n}retrieve(n,e){return this.injector.get(n,e.optional?zd:Nu,e)}}const Hl="ngTempTokenPath",cn=/\n/gm,Rn="__source";function Kc(t,n=rr.Default){if(void 0===gc())throw new bt(-203,!1);if(null===gc())return Xc(t,void 0,n);{const e=gc();let i;return i=e instanceof xv?e.injector:e,i.get(t,n&rr.Optional?null:void 0,n)}}function gn(t,n=rr.Default){return(qd()||Kc)(vi(t),n)}function te(t,n=rr.Default){return gn(t,vc(n))}function vc(t){return typeof t>"u"||"number"==typeof t?t:(t.optional&&8)|(t.host&&1)|(t.self&&2)|(t.skipSelf&&4)}function Wd(t){const n=[];for(let e=0;e<t.length;e++){const i=vi(t[e]);if(Array.isArray(i)){if(0===i.length)throw new bt(900,!1);let r,l=rr.Default;for(let f=0;f<i.length;f++){const w=i[f],M=jh(w);"number"==typeof M?-1===M?r=w.token:l|=M:r=w}n.push(gn(r,l))}else n.push(gn(i))}return n}function zu(t,n){return t[_m]=n,t.prototype[_m]=n,t}function jh(t){return t[_m]}const kt=zu(Vl("Inject",t=>({token:t})),-1),La=zu(Vl("Optional"),8),no=zu(Vl("SkipSelf"),4);function bc(t,n){return t.hasOwnProperty(Yc)?t[Yc]:null}function Na(t,n){t.forEach(e=>Array.isArray(e)?Na(e,n):n(e))}function Bu(t,n,e){n>=t.length?t.push(e):t.splice(n,0,e)}function ed(t,n){return n>=t.length-1?t.pop():t.splice(n,1)[0]}function pa(t,n,e){let i=Hh(t,n);return i>=0?t[1|i]=e:(i=~i,function bm(t,n,e,i){let r=t.length;if(r==n)t.push(e,i);else if(1===r)t.push(i,t[0]),t[0]=e;else{for(r--,t.push(t[r-1],t[r]);r>n;)t[r]=t[r-2],r--;t[n]=e,t[n+1]=i}}(t,i,n,e)),i}function xm(t,n){const e=Hh(t,n);if(e>=0)return t[1|e]}function Hh(t,n){return function wm(t,n,e){let i=0,r=t.length>>e;for(;r!==i;){const l=i+(r-i>>1),f=t[l<<e];if(n===f)return l<<e;f>n?r=l:i=l+1}return~(r<<e)}(t,n,1)}const $l={},or=[],dl=new _t(""),Ev=new _t("",-1),$h=new _t("");class tf{get(n,e=Nu){if(e===Nu){const i=new Error(`NullInjectorError: No provider for ${Lr(n)}!`);throw i.name="NullInjectorError",i}return e}}function Ms(t,n){const e=t[yc]||null;if(!e&&!0===n)throw new Error(`Type ${Lr(t)} does not have '\u0275mod' property.`);return e}function bi(t){return t[Fa]||null}function es(t){return t[jl]||null}function zs(t){return t[t_]||null}function ul(t){return{\u0275providers:t}}function Cm(...t){return{\u0275providers:nf(0,t),\u0275fromNgModule:!0}}function nf(t,...n){const e=[],i=new Set;let r;const l=f=>{e.push(f)};return Na(n,f=>{const w=f;td(w,l,[],i)&&(r||=[],r.push(w))}),void 0!==r&&Yd(r,l),e}function Yd(t,n){for(let e=0;e<t.length;e++){const{ngModule:i,providers:r}=t[e];Uu(r,l=>{n(l,i)})}}function td(t,n,e,i){if(!(t=vi(t)))return!1;let r=null,l=ha(t);const f=!l&&bi(t);if(l||f){if(f&&!f.standalone)return!1;r=t}else{const M=t.ngModule;if(l=ha(M),!l)return!1;r=M}const w=i.has(r);if(f){if(w)return!1;if(i.add(r),f.dependencies){const M="function"==typeof f.dependencies?f.dependencies():f.dependencies;for(const P of M)td(P,n,e,i)}}else{if(!l)return!1;{if(null!=l.imports&&!w){let P;i.add(r);try{Na(l.imports,L=>{td(L,n,e,i)&&(P||=[],P.push(L))})}finally{}void 0!==P&&Yd(P,n)}if(!w){const P=bc(r)||(()=>new r);n({provide:r,useFactory:P,deps:or},r),n({provide:$h,useValue:r,multi:!0},r),n({provide:dl,useValue:()=>gn(r),multi:!0},r)}const M=l.providers;if(null!=M&&!w){const P=t;Uu(M,L=>{n(L,P)})}}}return r!==t&&void 0!==t.providers}function Uu(t,n){for(let e of t)$d(e)&&(e=e.\u0275providers),Array.isArray(e)?Uu(e,n):n(e)}const nd=gr({provide:String,useValue:gr});function id(t){return null!==t&&"object"==typeof t&&nd in t}function xc(t){return"function"==typeof t}const hl=new _t(""),ai={},n_={};let Dm;function rd(){return void 0===Dm&&(Dm=new tf),Dm}class Lo{}class Hu extends Lo{parent;source;scopes;records=new Map;_ngOnDestroyHooks=new Set;_onDestroyHooks=[];get destroyed(){return this._destroyed}_destroyed=!1;injectorDefTypes;constructor(n,e,i,r){super(),this.parent=e,this.source=i,this.scopes=r,Gu(n,f=>this.processProvider(f)),this.records.set(Ev,Zd(void 0,this)),r.has("environment")&&this.records.set(Lo,Zd(void 0,this));const l=this.records.get(hl);null!=l&&"string"==typeof l.value&&this.scopes.add(l.value),this.injectorDefTypes=new Set(this.get($h,or,rr.Self))}retrieve(n,e){return this.get(n,e.optional?zd:Nu,e)}destroy(){$u(this),this._destroyed=!0;const n=Gn(null);try{for(const i of this._ngOnDestroyHooks)i.ngOnDestroy();const e=this._onDestroyHooks;this._onDestroyHooks=[];for(const i of e)i()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),Gn(n)}}onDestroy(n){return $u(this),this._onDestroyHooks.push(n),()=>this.removeOnDestroy(n)}runInContext(n){$u(this);const e=Fs(this),i=Ds(void 0);try{return n()}finally{Fs(e),Ds(i)}}get(n,e=Nu,i=rr.Default){if($u(this),n.hasOwnProperty(Ss))return n[Ss](this);i=vc(i);const l=Fs(this),f=Ds(void 0);try{if(!(i&rr.SkipSelf)){let M=this.records.get(n);if(void 0===M){const P=function xx(t){return"function"==typeof t||"object"==typeof t&&t instanceof _t}(n)&&jd(n);M=P&&this.injectableDefInScope(P)?Zd(_r(n),ai):null,this.records.set(n,M)}if(null!=M)return this.hydrate(n,M)}return(i&rr.Self?rd():this.parent).get(n,e=i&rr.Optional&&e===Nu?null:e)}catch(w){if("NullInjectorError"===w.name){if((w[Hl]=w[Hl]||[]).unshift(Lr(n)),l)throw w;return function Hr(t,n,e,i){const r=t[Hl];throw n[Rn]&&r.unshift(n[Rn]),t.message=function ef(t,n,e,i=null){t=t&&"\n"===t.charAt(0)&&"\u0275"==t.charAt(1)?t.slice(2):t;let r=Lr(n);if(Array.isArray(n))r=n.map(Lr).join(" -> ");else if("object"==typeof n){let l=[];for(let f in n)if(n.hasOwnProperty(f)){let w=n[f];l.push(f+":"+("string"==typeof w?JSON.stringify(w):Lr(w)))}r=`{${l.join(", ")}}`}return`${e}${i?"("+i+")":""}[${r}]: ${t.replace(cn,"\n  ")}`}("\n"+t.message,r,e,i),t.ngTokenPath=r,t[Hl]=null,t}(w,n,"R3InjectorError",this.source)}throw w}finally{Ds(f),Fs(l)}}resolveInjectorInitializers(){const n=Gn(null),e=Fs(this),i=Ds(void 0);try{const l=this.get(dl,or,rr.Self);for(const f of l)f()}finally{Fs(e),Ds(i),Gn(n)}}toString(){const n=[],e=this.records;for(const i of e.keys())n.push(Lr(i));return`R3Injector[${n.join(", ")}]`}processProvider(n){let e=xc(n=vi(n))?n:vi(n&&n.provide);const i=function i_(t){return id(t)?Zd(void 0,t.useValue):Zd(Mm(t),ai)}(n);if(!xc(n)&&!0===n.multi){let r=this.records.get(e);r||(r=Zd(void 0,ai,!0),r.factory=()=>Wd(r.multi),this.records.set(e,r)),e=n,r.multi.push(n)}this.records.set(e,i)}hydrate(n,e){const i=Gn(null);try{return e.value===n_?vv(Lr(n)):e.value===ai&&(e.value=n_,e.value=e.factory()),"object"==typeof e.value&&e.value&&function Dv(t){return null!==t&&"object"==typeof t&&"function"==typeof t.ngOnDestroy}(e.value)&&this._ngOnDestroyHooks.add(e.value),e.value}finally{Gn(i)}}injectableDefInScope(n){if(!n.providedIn)return!1;const e=vi(n.providedIn);return"string"==typeof e?"any"===e||this.scopes.has(e):this.injectorDefTypes.has(e)}removeOnDestroy(n){const e=this._onDestroyHooks.indexOf(n);-1!==e&&this._onDestroyHooks.splice(e,1)}}function _r(t){const n=jd(t),e=null!==n?n.factory:bc(t);if(null!==e)return e;if(t instanceof _t)throw new bt(204,!1);if(t instanceof Function)return function bx(t){if(t.length>0)throw new bt(204,!1);const e=function Wr(t){return t&&(t[Wc]||t[Ou])||null}(t);return null!==e?()=>e.factory(t):()=>new t}(t);throw new bt(204,!1)}function Mm(t,n,e){let i;if(xc(t)){const r=vi(t);return bc(r)||_r(r)}if(id(t))i=()=>vi(t.useValue);else if(function Sm(t){return!(!t||!t.useFactory)}(t))i=()=>t.useFactory(...Wd(t.deps||[]));else if(function ju(t){return!(!t||!t.useExisting)}(t))i=()=>gn(vi(t.useExisting));else{const r=vi(t&&(t.useClass||t.provide));if(!function Sv(t){return!!t.deps}(t))return bc(r)||_r(r);i=()=>new r(...Wd(t.deps))}return i}function $u(t){if(t.destroyed)throw new bt(205,!1)}function Zd(t,n,e=!1){return{factory:t,value:n,multi:e?[]:void 0}}function Gu(t,n){for(const e of t)Array.isArray(e)?Gu(e,n):e&&$d(e)?Gu(e.\u0275providers,n):n(e)}function Bs(t,n){let e;t instanceof Hu?($u(t),e=t):e=new xv(t);const r=Fs(e),l=Ds(void 0);try{return n()}finally{Fs(r),Ds(l)}}function r_(){return void 0!==qd()||null!=gc()}function us(t){if(!r_())throw new bt(-203,!1)}function ao(t){return Array.isArray(t)&&"object"==typeof t[1]}function xo(t){return Array.isArray(t)&&!0===t[1]}function Yh(t){return!!(4&t.flags)}function Qs(t){return t.componentOffset>-1}function lf(t){return!(1&~t.flags)}function ma(t){return!!t.template}function ga(t){return!!(512&t[2])}function Cc(t){return!(256&~t[2])}class uf{previousValue;currentValue;firstChange;constructor(n,e,i){this.previousValue=n,this.currentValue=e,this.firstChange=i}isFirstChange(){return this.firstChange}}function hf(t,n,e,i){null!==n?n.applyValueToInputSignal(n,i):t[e]=i}const Mr=(()=>{const t=()=>pf;return t.ngInherit=!0,t})();function pf(t){return t.type.prototype.ngOnChanges&&(t.setInput=ml),Ov}function Ov(){const t=Zu(this),n=t?.current;if(n){const e=t.previous;if(e===$l)t.previous=n;else for(let i in n)e[i]=n[i];t.current=null,this.ngOnChanges(n)}}function ml(t,n,e,i,r){const l=this.declaredInputs[i],f=Zu(t)||function h_(t,n){return t[sr]=n}(t,{previous:$l,current:null}),w=f.current||(f.current={}),M=f.previous,P=M[l];w[l]=new uf(P&&P.currentValue,e,M===$l),hf(t,n,r,e)}const sr="__ngSimpleChanges__";function Zu(t){return t[sr]||null}function tr(t){for(;Array.isArray(t);)t=t[0];return t}function Vt(t,n){return tr(n[t])}function Bo(t,n){return tr(n[t.index])}function Ye(t,n){return t.data[n]}function eu(t,n){return t[n]}function ps(t,n){const e=n[t];return ao(e)?e:e[0]}function mf(t){return!(128&~t[2])}function Ua(t,n){return null==n?null:t[n]}function Qu(t){t[17]=0}function f_(t){1024&t[2]||(t[2]|=1024,mf(t)&&ja(t))}function Zh(t){return!!(9216&t[2]||t[24]?.dirty)}function Xh(t){t[10].changeDetectionScheduler?.notify(8),64&t[2]&&(t[2]|=1024),Zh(t)&&ja(t)}function ja(t){t[10].changeDetectionScheduler?.notify(0);let n=Js(t);for(;null!==n&&!(8192&n[2])&&(n[2]|=8192,mf(n));)n=Js(n)}function Kh(t,n){if(Cc(t))throw new bt(911,!1);null===t[21]&&(t[21]=[]),t[21].push(n)}function Js(t){const n=t[3];return xo(n)?n[3]:n}function Qh(t){return t[7]??=[]}function tu(t){return t.cleanup??=[]}const xi={lFrame:v_(null),bindingsEnabled:!0,skipHydrationRootTNode:null};let Ju=!1;function Yl(){return xi.bindingsEnabled}function gl(){return null!==xi.skipHydrationRootTNode}function xt(){return xi.lFrame.lView}function Wn(){return xi.lFrame.tView}function on(t){return xi.lFrame.contextLView=t,t[8]}function ln(t){return xi.lFrame.contextLView=null,t}function Zi(){let t=Lm();for(;null!==t&&64===t.type;)t=t.parent;return t}function Lm(){return xi.lFrame.currentTNode}function Is(t,n){const e=xi.lFrame;e.currentTNode=t,e.isParent=n}function yf(){return xi.lFrame.isParent}function Ec(){xi.lFrame.isParent=!1}function Vo(){return Ju}function nh(t){const n=Ju;return Ju=t,n}function fs(){const t=xi.lFrame;let n=t.bindingRootIndex;return-1===n&&(n=t.bindingRootIndex=t.tView.bindingStartIndex),n}function ya(){return xi.lFrame.bindingIndex++}function Zl(t){const n=xi.lFrame,e=n.bindingIndex;return n.bindingIndex=n.bindingIndex+t,e}function Vm(t,n){const e=xi.lFrame;e.bindingIndex=e.bindingRootIndex=t,tp(n)}function tp(t){xi.lFrame.currentDirectiveIndex=t}function bf(){return xi.lFrame.currentQueryIndex}function ip(t){xi.lFrame.currentQueryIndex=t}function xf(t){const n=t[1];return 2===n.type?n.declTNode:1===n.type?t[5]:null}function __(t,n,e){if(e&rr.SkipSelf){let r=n,l=t;for(;!(r=r.parent,null!==r||e&rr.Host||(r=xf(l),null===r||(l=l[14],10&r.type))););if(null===r)return!1;n=r,t=l}const i=xi.lFrame=y_();return i.currentTNode=n,i.lView=t,!0}function jm(t){const n=y_(),e=t[1];xi.lFrame=n,n.currentTNode=e.firstChild,n.lView=t,n.tView=e,n.contextLView=t,n.bindingIndex=e.bindingStartIndex,n.inI18n=!1}function y_(){const t=xi.lFrame,n=null===t?null:t.child;return null===n?v_(t):n}function v_(t){const n={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:t,child:null,inI18n:!1};return null!==t&&(t.child=n),n}function b_(){const t=xi.lFrame;return xi.lFrame=t.parent,t.currentTNode=null,t.lView=null,t}const rp=b_;function ih(){const t=b_();t.isParent=!0,t.tView=null,t.selectedIndex=-1,t.contextLView=null,t.elementDepthCount=0,t.currentDirectiveIndex=-1,t.currentNamespace=null,t.bindingRootIndex=-1,t.bindingIndex=-1,t.currentQueryIndex=0}function Ao(){return xi.lFrame.selectedIndex}function nu(t){xi.lFrame.selectedIndex=t}function Vr(){const t=xi.lFrame;return Ye(t.tView,t.selectedIndex)}function ba(){xi.lFrame.currentNamespace="svg"}function hr(){!function Bv(){xi.lFrame.currentNamespace=null}()}let Vv=!0;function dd(){return Vv}function yl(t){Vv=t}function op(t,n){for(let e=n.directiveStart,i=n.directiveEnd;e<i;e++){const l=t.data[e].type.prototype,{ngAfterContentInit:f,ngAfterContentChecked:w,ngAfterViewInit:M,ngAfterViewChecked:P,ngOnDestroy:L}=l;f&&(t.contentHooks??=[]).push(-e,f),w&&((t.contentHooks??=[]).push(e,w),(t.contentCheckHooks??=[]).push(e,w)),M&&(t.viewHooks??=[]).push(-e,M),P&&((t.viewHooks??=[]).push(e,P),(t.viewCheckHooks??=[]).push(e,P)),null!=L&&(t.destroyHooks??=[]).push(e,L)}}function Ha(t,n,e){$a(t,n,3,e)}function iu(t,n,e,i){(3&t[2])===e&&$a(t,n,e,i)}function $r(t,n){let e=t[2];(3&e)===n&&(e&=16383,e+=1,t[2]=e)}function $a(t,n,e,i){const l=i??-1,f=n.length-1;let w=0;for(let M=void 0!==i?65535&t[17]:0;M<f;M++)if("number"==typeof n[M+1]){if(w=n[M],null!=i&&w>=i)break}else n[M]<0&&(t[17]+=65536),(w<l||-1==l)&&(Cf(t,e,n,M),t[17]=(4294901760&t[17])+M+2),M++}function rh(t,n){const e=Gn(null);try{n.call(t)}finally{Gn(e)}}function Cf(t,n,e,i){const r=e[i]<0,l=e[i+1],w=t[r?-e[i]:e[i]];r?t[2]>>14<t[17]>>16&&(3&t[2])===n&&(t[2]+=16384,rh(w,l)):rh(w,l)}class sp{factory;injectImpl;resolving=!1;canSeeViewProviders;multi;componentProviders;index;providerFactory;constructor(n,e,i){this.factory=n,this.canSeeViewProviders=e,this.injectImpl=i}}function vl(t){return 3===t||4===t||6===t}function hd(t){return 64===t.charCodeAt(0)}function bl(t,n){if(null!==n&&0!==n.length)if(null===t||0===t.length)t=n.slice();else{let e=-1;for(let i=0;i<n.length;i++){const r=n[i];"number"==typeof r?e=r:0===e||pd(t,e,r,0,-1===e||2===e?n[++i]:null)}}return t}function pd(t,n,e,i,r){let l=0,f=t.length;if(-1===n)f=-1;else for(;l<t.length;){const w=t[l++];if("number"==typeof w){if(w===n){f=-1;break}if(w>n){f=l-1;break}}}for(;l<t.length;){const w=t[l];if("number"==typeof w)break;if(w===e)return void(null!==r&&(t[l+1]=r));l++,null!==r&&l++}-1!==f&&(t.splice(f,0,n),l=f+1),t.splice(l++,0,e),null!==r&&t.splice(l++,0,r)}function C_(t){return-1!==t}function Sf(t){return 32767&t}function ru(t,n){let e=function Dx(t){return t>>16}(t),i=n;for(;e>0;)i=i[14],e--;return i}let Gm=!0;function ts(t){const n=Gm;return Gm=t,n}let lp=0;const Ga={};function Us(t,n){const e=su(t,n);if(-1!==e)return e;const i=n[1];i.firstCreatePass&&(t.injectorIndex=n.length,ou(i.data,t),ou(n,null),ou(i.blueprint,null));const r=Sc(t,n),l=t.injectorIndex;if(C_(r)){const f=Sf(r),w=ru(r,n),M=w[1].data;for(let P=0;P<8;P++)n[l+P]=w[f+P]|M[f+P]}return n[l+8]=r,l}function ou(t,n){t.push(0,0,0,0,0,0,0,0,n)}function su(t,n){return-1===t.injectorIndex||t.parent&&t.parent.injectorIndex===t.injectorIndex||null===n[t.injectorIndex+8]?-1:t.injectorIndex}function Sc(t,n){if(t.parent&&-1!==t.parent.injectorIndex)return t.parent.injectorIndex;let e=0,i=null,r=n;for(;null!==r;){if(i=_(r),null===i)return-1;if(e++,r=r[14],-1!==i.injectorIndex)return i.injectorIndex|e<<16}return-1}function Mf(t,n,e){!function qa(t,n,e){let i;"string"==typeof e?i=e.charCodeAt(0)||0:e.hasOwnProperty(Gd)&&(i=e[Gd]),null==i&&(i=e[Gd]=lp++);const r=255&i;n.data[t+(r>>5)]|=1<<r}(t,n,e)}function fd(t,n,e){if(e&rr.Optional||void 0!==t)return t;Lu()}function Uv(t,n,e,i){if(e&rr.Optional&&void 0===i&&(i=null),!(e&(rr.Self|rr.Host))){const r=t[9],l=Ds(void 0);try{return r?r.get(n,i,e&rr.Optional):Xc(n,i,e&rr.Optional)}finally{Ds(l)}}return fd(i,0,e)}function jv(t,n,e,i=rr.Default,r){if(null!==t){if(2048&n[2]&&!(i&rr.Self)){const f=function c(t,n,e,i,r){let l=t,f=n;for(;null!==l&&null!==f&&2048&f[2]&&!ga(f);){const w=Tf(l,f,e,i|rr.Self,Ga);if(w!==Ga)return w;let M=l.parent;if(!M){const P=f[20];if(P){const L=P.get(e,Ga,i);if(L!==Ga)return L}M=_(f),f=f[14]}l=M}return r}(t,n,e,i,Ga);if(f!==Ga)return f}const l=Tf(t,n,e,i,Ga);if(l!==Ga)return l}return Uv(n,e,i,r)}function Tf(t,n,e,i,r){const l=function xa(t){if("string"==typeof t)return t.charCodeAt(0)||0;const n=t.hasOwnProperty(Gd)?t[Gd]:void 0;return"number"==typeof n?n>=0?255&n:Mx:n}(e);if("function"==typeof l){if(!__(n,t,i))return i&rr.Host?fd(r,0,i):Uv(n,e,i,r);try{let f;if(f=l(i),null!=f||i&rr.Optional)return f;Lu()}finally{rp()}}else if("number"==typeof l){let f=null,w=su(t,n),M=-1,P=i&rr.Host?n[15][5]:null;for((-1===w||i&rr.SkipSelf)&&(M=-1===w?Sc(t,n):n[w+8],-1!==M&&qm(i,!1)?(f=n[1],w=Sf(M),n=ru(M,n)):w=-1);-1!==w;){const L=n[1];if(Uo(l,w,L.data)){const $=Dc(w,n,e,f,i,P);if($!==Ga)return $}M=n[w+8],-1!==M&&qm(i,n[1].data[w+8]===P)&&Uo(l,w,n)?(f=L,w=Sf(M),n=ru(M,n)):w=-1}}return r}function Dc(t,n,e,i,r,l){const f=n[1],w=f.data[t+8],L=As(w,f,e,null==i?Qs(w)&&Gm:i!=f&&!!(3&w.type),r&rr.Host&&l===w);return null!==L?Co(n,f,L,w):Ga}function As(t,n,e,i,r){const l=t.providerIndexes,f=n.data,w=1048575&l,M=t.directiveStart,L=l>>20,Q=r?w+L:t.directiveEnd;for(let X=i?w:w+L;X<Q;X++){const Y=f[X];if(X<M&&e===Y||X>=M&&Y.type===e)return X}if(r){const X=f[M];if(X&&ma(X)&&X.type===e)return M}return null}function Co(t,n,e,i){let r=t[e];const l=n.data;if(r instanceof sp){const f=r;f.resolving&&vv(function cr(t){return"function"==typeof t?t.name||t.toString():"object"==typeof t&&null!=t&&"function"==typeof t.type?t.type.name||t.type.toString():zi(t)}(l[e]));const w=ts(f.canSeeViewProviders);f.resolving=!0;const P=f.injectImpl?Ds(f.injectImpl):null;__(t,i,rr.Default);try{r=t[e]=f.factory(void 0,l,t,i),n.firstCreatePass&&e>=i.directiveStart&&function wf(t,n,e){const{ngOnChanges:i,ngOnInit:r,ngDoCheck:l}=n.type.prototype;if(i){const f=pf(n);(e.preOrderHooks??=[]).push(t,f),(e.preOrderCheckHooks??=[]).push(t,f)}r&&(e.preOrderHooks??=[]).push(0-t,r),l&&((e.preOrderHooks??=[]).push(t,l),(e.preOrderCheckHooks??=[]).push(t,l))}(e,l[e],n)}finally{null!==P&&Ds(P),ts(w),f.resolving=!1,rp()}}return r}function Uo(t,n,e){return!!(e[n+(t>>5)]&1<<t)}function qm(t,n){return!(t&rr.Self||t&rr.Host&&n)}class Ur{_tNode;_lView;constructor(n,e){this._tNode=n,this._lView=e}get(n,e,i){return jv(this._tNode,this._lView,n,vc(i),e)}}function Mx(){return new Ur(Zi(),xt())}function m(t){return la(()=>{const n=t.prototype.constructor,e=n[Yc]||s(n),i=Object.prototype;let r=Object.getPrototypeOf(t.prototype).constructor;for(;r&&r!==i;){const l=r[Yc]||s(r);if(l&&l!==e)return l;r=Object.getPrototypeOf(r)}return l=>new l})}function s(t){return Pu(t)?()=>{const n=s(vi(t));return n&&n()}:bc(t)}function _(t){const n=t[1],e=n.type;return 2===e?n.declTNode:1===e?t[5]:null}function v(t){return function Ri(t,n){if("class"===n)return t.classes;if("style"===n)return t.styles;const e=t.attrs;if(e){const i=e.length;let r=0;for(;r<i;){const l=e[r];if(vl(l))break;if(0===l)r+=2;else if("number"==typeof l)for(r++;r<i&&"string"==typeof e[r];)r++;else{if(l===n)return e[r+1];r+=2}}}return null}(Zi(),t)}function be(t,n=null,e=null,i){const r=ve(t,n,e,i);return r.resolveInjectorInitializers(),r}function ve(t,n=null,e=null,i,r=new Set){const l=[e||or,Cm(t)];return i=i||("object"==typeof t?void 0:Lr(t)),new Hu(l,n||rd(),i||null,r)}class we{static THROW_IF_NOT_FOUND=Nu;static NULL=new tf;static create(n,e){if(Array.isArray(n))return be({name:""},e,n,"");{const i=n.name??"";return be({name:i},n.parent,n.providers,i)}}static \u0275prov=Nt({token:we,providedIn:"any",factory:()=>gn(Ev)});static __NG_ELEMENT_ID__=-1}class Ee{attributeName;constructor(n){this.attributeName=n}__NG_ELEMENT_ID__=()=>v(this.attributeName);toString(){return`HostAttributeToken ${this.attributeName}`}}new _t("").__NG_ELEMENT_ID__=t=>{const n=Zi();if(null===n)throw new bt(204,!1);if(2&n.type)return n.value;if(t&rr.Optional)return null;throw new bt(204,!1)};const ke=!1;let Oe=(()=>class t{static __NG_ELEMENT_ID__=qe;static __NG_ENV_ID__=e=>e})();class et extends Oe{_lView;constructor(n){super(),this._lView=n}onDestroy(n){return Kh(this._lView,n),()=>function gf(t,n){if(null===t[21])return;const e=t[21].indexOf(n);-1!==e&&t[21].splice(e,1)}(this._lView,n)}}function qe(){return new et(xt())}class ot{}const lt=new _t("",{providedIn:"root",factory:()=>!1}),He=new _t(""),st=new _t("");let Be=(()=>{class t{taskId=0;pendingTasks=new Set;get _hasPendingTasks(){return this.hasPendingTasks.value}hasPendingTasks=new pn(!1);add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);const e=this.taskId++;return this.pendingTasks.add(e),e}has(e){return this.pendingTasks.has(e)}remove(e){this.pendingTasks.delete(e),0===this.pendingTasks.size&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}static \u0275prov=Nt({token:t,providedIn:"root",factory:()=>new t})}return t})();const $e=class rt extends Et{__isAsync;destroyRef=void 0;pendingTasks=void 0;constructor(n=!1){super(),this.__isAsync=n,r_()&&(this.destroyRef=te(Oe,{optional:!0})??void 0,this.pendingTasks=te(Be,{optional:!0})??void 0)}emit(n){const e=Gn(null);try{super.next(n)}finally{Gn(e)}}subscribe(n,e,i){let r=n,l=e||(()=>null),f=i;if(n&&"object"==typeof n){const M=n;r=M.next?.bind(M),l=M.error?.bind(M),f=M.complete?.bind(M)}this.__isAsync&&(l=this.wrapInTimeout(l),r&&(r=this.wrapInTimeout(r)),f&&(f=this.wrapInTimeout(f)));const w=super.subscribe({next:r,error:l,complete:f});return n instanceof Mi&&n.add(w),w}wrapInTimeout(n){return e=>{const i=this.pendingTasks?.add();setTimeout(()=>{n(e),void 0!==i&&this.pendingTasks?.remove(i)})}}};function Je(...t){}function dt(t){let n,e;function i(){t=Je;try{void 0!==e&&"function"==typeof cancelAnimationFrame&&cancelAnimationFrame(e),void 0!==n&&clearTimeout(n)}catch{}}return n=setTimeout(()=>{t(),i()}),"function"==typeof requestAnimationFrame&&(e=requestAnimationFrame(()=>{t(),i()})),()=>i()}function Ft(t){return queueMicrotask(()=>t()),()=>{t=Je}}const Bt="isAngularZone",en=Bt+"_ID";let In=0;class wt{hasPendingMacrotasks=!1;hasPendingMicrotasks=!1;isStable=!0;onUnstable=new $e(!1);onMicrotaskEmpty=new $e(!1);onStable=new $e(!1);onError=new $e(!1);constructor(n){const{enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:i=!1,shouldCoalesceRunChangeDetection:r=!1,scheduleInRootZone:l=ke}=n;if(typeof Zone>"u")throw new bt(908,!1);Zone.assertZonePatched();const f=this;f._nesting=0,f._outer=f._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(f._inner=f._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(f._inner=f._inner.fork(Zone.longStackTraceZoneSpec)),f.shouldCoalesceEventChangeDetection=!r&&i,f.shouldCoalesceRunChangeDetection=r,f.callbackScheduled=!1,f.scheduleInRootZone=l,function Pi(t){const n=()=>{!function di(t){function n(){dt(()=>{t.callbackScheduled=!1,ar(t),t.isCheckStableRunning=!0,vn(t),t.isCheckStableRunning=!1})}t.isCheckStableRunning||t.callbackScheduled||(t.callbackScheduled=!0,t.scheduleInRootZone?Zone.root.run(()=>{n()}):t._outer.run(()=>{n()}),ar(t))}(t)},e=In++;t._inner=t._inner.fork({name:"angular",properties:{[Bt]:!0,[en]:e,[en+e]:!0},onInvokeTask:(i,r,l,f,w,M)=>{if(function tn(t){return Vi(t,"__ignore_ng_zone__")}(M))return i.invokeTask(l,f,w,M);try{return Yn(t),i.invokeTask(l,f,w,M)}finally{(t.shouldCoalesceEventChangeDetection&&"eventTask"===f.type||t.shouldCoalesceRunChangeDetection)&&n(),xr(t)}},onInvoke:(i,r,l,f,w,M,P)=>{try{return Yn(t),i.invoke(l,f,w,M,P)}finally{t.shouldCoalesceRunChangeDetection&&!t.callbackScheduled&&!function gi(t){return Vi(t,"__scheduler_tick__")}(M)&&n(),xr(t)}},onHasTask:(i,r,l,f)=>{i.hasTask(l,f),r===l&&("microTask"==f.change?(t._hasPendingMicrotasks=f.microTask,ar(t),vn(t)):"macroTask"==f.change&&(t.hasPendingMacrotasks=f.macroTask))},onHandleError:(i,r,l,f)=>(i.handleError(l,f),t.runOutsideAngular(()=>t.onError.emit(f)),!1)})}(f)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get(Bt)}static assertInAngularZone(){if(!wt.isInAngularZone())throw new bt(909,!1)}static assertNotInAngularZone(){if(wt.isInAngularZone())throw new bt(909,!1)}run(n,e,i){return this._inner.run(n,e,i)}runTask(n,e,i,r){const l=this._inner,f=l.scheduleEventTask("NgZoneEvent: "+r,n,Tn,Je,Je);try{return l.runTask(f,e,i)}finally{l.cancelTask(f)}}runGuarded(n,e,i){return this._inner.runGuarded(n,e,i)}runOutsideAngular(n){return this._outer.run(n)}}const Tn={};function vn(t){if(0==t._nesting&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function ar(t){t.hasPendingMicrotasks=!!(t._hasPendingMicrotasks||(t.shouldCoalesceEventChangeDetection||t.shouldCoalesceRunChangeDetection)&&!0===t.callbackScheduled)}function Yn(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function xr(t){t._nesting--,vn(t)}class An{hasPendingMicrotasks=!1;hasPendingMacrotasks=!1;isStable=!0;onUnstable=new $e;onMicrotaskEmpty=new $e;onStable=new $e;onError=new $e;run(n,e,i){return n.apply(e,i)}runGuarded(n,e,i){return n.apply(e,i)}runOutsideAngular(n){return n()}runTask(n,e,i,r){return n.apply(e,i)}}function Vi(t,n){return!(!Array.isArray(t)||1!==t.length)&&!0===t[0]?.data?.[n]}class Xi{_console=console;handleError(n){this._console.error("ERROR",n)}}const lo=new _t("",{providedIn:"root",factory:()=>{const t=te(wt),n=te(Xi);return e=>t.runOutsideAngular(()=>n.handleError(e))}});function ms(t,n){return Fo(t,n)}const Tr=(ms.required=function wi(t){return Fo(Ks,t)},ms);function Oi(){return $i(Zi(),xt())}function $i(t,n){return new Dn(Bo(t,n))}let Dn=(()=>class t{nativeElement;constructor(e){this.nativeElement=e}static __NG_ELEMENT_ID__=Oi})();function vr(t){return t instanceof Dn?t.nativeElement:t}function Gr(t){return"function"==typeof t&&void 0!==t[Kn]}function wr(t,n){const e=function ol(t,n){const e=Object.create(fc);e.value=t,void 0!==n&&(e.equal=n);const i=()=>(Bi(e),e.value);return i[Kn]=e,i}(t,n?.equal),i=e[Kn];return e.set=r=>$c(i,r),e.update=r=>function ge(t,n){Li()||qp(t),$c(t,n(t.value))}(i,r),e.asReadonly=ea.bind(e),e}function ea(){const t=this[Kn];if(void 0===t.readonlyFn){const n=()=>this();n[Kn]=t,t.readonlyFn=n}return t.readonlyFn}function js(t){return Gr(t)&&"function"==typeof t.set}function wl(){return this._results[Symbol.iterator]()}class gs{_emitDistinctChangesOnly;dirty=!0;_onDirty=void 0;_results=[];_changesDetected=!1;_changes=void 0;length=0;first=void 0;last=void 0;get changes(){return this._changes??=new Et}constructor(n=!1){this._emitDistinctChangesOnly=n}get(n){return this._results[n]}map(n){return this._results.map(n)}filter(n){return this._results.filter(n)}find(n){return this._results.find(n)}reduce(n,e){return this._results.reduce(n,e)}forEach(n){this._results.forEach(n)}some(n){return this._results.some(n)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(n,e){this.dirty=!1;const i=function Jo(t){return t.flat(Number.POSITIVE_INFINITY)}(n);(this._changesDetected=!function Jc(t,n,e){if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++){let r=t[i],l=n[i];if(e&&(r=e(r),l=e(l)),l!==r)return!1}return!0}(this._results,i,e))&&(this._results=i,this.length=i.length,this.last=i[this.length-1],this.first=i[0])}notifyOnChanges(){void 0!==this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.next(this)}onDirty(n){this._onDirty=n}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){void 0!==this._changes&&(this._changes.complete(),this._changes.unsubscribe())}[Symbol.iterator]=wl}function Tc(t){return!(128&~t.flags)}var D_=function(t){return t[t.OnPush=0]="OnPush",t[t.Default=1]="Default",t}(D_||{});const Hv=new Map;let lI=0;function $v(t){Hv.delete(t[19])}const Ho="__ngContext__";function Za(t,n){ao(n)?(t[Ho]=n[19],function SE(t){Hv.set(t[19],t)}(n)):t[Ho]=n}function AE(t){return RE(t[12])}function kE(t){return RE(t[4])}function RE(t){for(;null!==t&&!xo(t);)t=t[4];return t}let Px;const gd=new _t("",{providedIn:"root",factory:()=>Ox}),Ox="ng",Yv=new _t(""),cu=new _t("",{providedIn:"platform",factory:()=>"unknown"}),wa=new _t(""),Zv=new _t("",{providedIn:"root",factory:()=>function Ic(){if(void 0!==Px)return Px;if(typeof document<"u")return document;throw new bt(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null}),tb=new _t("",{providedIn:"root",factory:()=>!1});var Ux=function(t){return t[t.CHANGE_DETECTION=0]="CHANGE_DETECTION",t[t.AFTER_NEXT_RENDER=1]="AFTER_NEXT_RENDER",t}(Ux||{});const Jm=new _t(""),jE=new Set;function Cl(t){jE.has(t)||(jE.add(t),performance?.mark?.("mark_feature_usage",{detail:{feature:t}}))}let O_=(()=>class t{view;node;constructor(e,i){this.view=e,this.node=i}static __NG_ELEMENT_ID__=ib})();function ib(){return new O_(xt(),Zi())}var Rf=function(t){return t[t.EarlyRead=0]="EarlyRead",t[t.Write=1]="Write",t[t.MixedReadWrite=2]="MixedReadWrite",t[t.Read=3]="Read",t}(Rf||{});let rb=(()=>{class t{impl=null;execute(){this.impl?.execute()}static \u0275prov=Nt({token:t,providedIn:"root",factory:()=>new t})}return t})();const F_=[Rf.EarlyRead,Rf.Write,Rf.MixedReadWrite,Rf.Read];let jx=(()=>{class t{ngZone=te(wt);scheduler=te(ot);errorHandler=te(Xi,{optional:!0});sequences=new Set;deferredRegistrations=new Set;executing=!1;constructor(){te(Jm,{optional:!0})}execute(){this.executing=!0;for(const i of F_)for(const r of this.sequences)if(!r.erroredOrDestroyed&&r.hooks[i])try{r.pipelinedValue=this.ngZone.runOutsideAngular(()=>this.maybeTrace(()=>(0,r.hooks[i])(r.pipelinedValue),r.snapshot))}catch(l){r.erroredOrDestroyed=!0,this.errorHandler?.handleError(l)}this.executing=!1;for(const i of this.sequences)i.afterRun(),i.once&&(this.sequences.delete(i),i.destroy());for(const i of this.deferredRegistrations)this.sequences.add(i);this.deferredRegistrations.size>0&&this.scheduler.notify(7),this.deferredRegistrations.clear()}register(e){const{view:i}=e;void 0!==i?((i[25]??=[]).push(e),ja(i),i[2]|=8192):this.executing?this.deferredRegistrations.add(e):this.addSequence(e)}addSequence(e){this.sequences.add(e),this.scheduler.notify(7)}unregister(e){this.executing&&this.sequences.has(e)?(e.erroredOrDestroyed=!0,e.pipelinedValue=void 0,e.once=!0):(this.sequences.delete(e),this.deferredRegistrations.delete(e))}maybeTrace(e,i){return i?i.run(Ux.AFTER_NEXT_RENDER,e):e()}static \u0275prov=Nt({token:t,providedIn:"root",factory:()=>new t})}return t})();class L_{impl;hooks;view;once;snapshot;erroredOrDestroyed=!1;pipelinedValue=void 0;unregisterOnDestroy;constructor(n,e,i,r,l,f=null){this.impl=n,this.hooks=e,this.view=i,this.once=r,this.snapshot=f,this.unregisterOnDestroy=l?.onDestroy(()=>this.destroy())}afterRun(){this.erroredOrDestroyed=!1,this.pipelinedValue=void 0,this.snapshot?.dispose(),this.snapshot=null}destroy(){this.impl.unregister(this),this.unregisterOnDestroy?.();const n=this.view?.[25];n&&(this.view[25]=n.filter(e=>e!==this))}}function tg(t,n){!n?.injector&&us();const e=n?.injector??te(we);return Cl("NgAfterRender"),$x(t,e,n,!1)}function El(t,n){!n?.injector&&us();const e=n?.injector??te(we);return Cl("NgAfterNextRender"),$x(t,e,n,!0)}function $x(t,n,e,i){const r=n.get(rb);r.impl??=n.get(jx);const l=n.get(Jm,null,{optional:!0}),f=e?.phase??Rf.MixedReadWrite,w=!0!==e?.manualCleanup?n.get(Oe):null,M=n.get(O_,null,{optional:!0}),P=new L_(r.impl,function Hx(t,n){if(t instanceof Function){const e=[void 0,void 0,void 0,void 0];return e[n]=t,e}return[t.earlyRead,t.write,t.mixedReadWrite,t.read]}(t,f),M?.view,i,w,l?.snapshot(null));return r.impl.register(P),P}function mb(t,n){const e=t.contentQueries;if(null!==e){const i=Gn(null);try{for(let r=0;r<e.length;r+=2){const f=e[r+1];if(-1!==f){const w=t.data[f];ip(e[r]),w.contentQueries(2,n[f],f)}}}finally{Gn(i)}}}function gb(t,n,e){ip(0);const i=Gn(null);try{n(t,e)}finally{Gn(i)}}function gw(t,n,e){if(Yh(n)){const i=Gn(null);try{const l=n.directiveEnd;for(let f=n.directiveStart;f<l;f++){const w=t.data[f];w.contentQueries&&w.contentQueries(1,e[f],f)}}finally{Gn(i)}}}var Jl=function(t){return t[t.Emulated=0]="Emulated",t[t.None=2]="None",t[t.ShadowDom=3]="ShadowDom",t}(Jl||{});let Ac,Q_;function Ff(t){return function _w(){if(void 0===Ac&&(Ac=null,ho.trustedTypes))try{Ac=ho.trustedTypes.createPolicy("angular",{createHTML:t=>t,createScript:t=>t,createScriptURL:t=>t})}catch{}return Ac}()?.createHTML(t)||t}function bw(t){return function yw(){if(void 0===Q_&&(Q_=null,ho.trustedTypes))try{Q_=ho.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:t=>t,createScript:t=>t,createScriptURL:t=>t})}catch{}return Q_}()?.createScriptURL(t)||t}class gp{changingThisBreaksApplicationSecurity;constructor(n){this.changingThisBreaksApplicationSecurity=n}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${ji})`}}class ag extends gp{getTypeName(){return"HTML"}}class J_ extends gp{getTypeName(){return"Style"}}class lS extends gp{getTypeName(){return"Script"}}class cS extends gp{getTypeName(){return"URL"}}class ey extends gp{getTypeName(){return"ResourceURL"}}function Sl(t){return t instanceof gp?t.changingThisBreaksApplicationSecurity:t}function vd(t,n){const e=function bd(t){return t instanceof gp&&t.getTypeName()||null}(t);if(null!=e&&e!==n){if("ResourceURL"===e&&"URL"===n)return!0;throw new Error(`Required a safe ${n}, got a ${e} (see ${ji})`)}return e===n}class hS{inertDocumentHelper;constructor(n){this.inertDocumentHelper=n}getInertBodyElement(n){n="<body><remove></remove>"+n;try{const e=(new window.DOMParser).parseFromString(Ff(n),"text/html").body;return null===e?this.inertDocumentHelper.getInertBodyElement(n):(e.firstChild?.remove(),e)}catch{return null}}}class _b{defaultDoc;inertDocument;constructor(n){this.defaultDoc=n,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert")}getInertBodyElement(n){const e=this.inertDocument.createElement("template");return e.innerHTML=Ff(n),e}}const RI=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;function vb(t){return(t=String(t)).match(RI)?t:"unsafe:"+t}function hh(t){const n={};for(const e of t.split(","))n[e]=!0;return n}function mu(...t){const n={};for(const e of t)for(const i in e)e.hasOwnProperty(i)&&(n[i]=!0);return n}const bb=hh("area,br,col,hr,img,wbr"),pS=hh("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),ww=hh("rp,rt"),Cw=mu(bb,mu(pS,hh("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),mu(ww,hh("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),mu(ww,pS)),xb=hh("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),mS=mu(xb,hh("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,srcset,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),hh("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),ny=hh("script,style,template");class yp{sanitizedSomething=!1;buf=[];sanitizeChildren(n){let e=n.firstChild,i=!0,r=[];for(;e;)if(e.nodeType===Node.ELEMENT_NODE?i=this.startElement(e):e.nodeType===Node.TEXT_NODE?this.chars(e.nodeValue):this.sanitizedSomething=!0,i&&e.firstChild)r.push(e),e=wb(e);else for(;e;){e.nodeType===Node.ELEMENT_NODE&&this.endElement(e);let l=Ew(e);if(l){e=l;break}e=r.pop()}return this.buf.join("")}startElement(n){const e=Cb(n).toLowerCase();if(!Cw.hasOwnProperty(e))return this.sanitizedSomething=!0,!ny.hasOwnProperty(e);this.buf.push("<"),this.buf.push(e);const i=n.attributes;for(let r=0;r<i.length;r++){const l=i.item(r),f=l.name,w=f.toLowerCase();if(!mS.hasOwnProperty(w)){this.sanitizedSomething=!0;continue}let M=l.value;xb[w]&&(M=vb(M)),this.buf.push(" ",f,'="',Sw(M),'"')}return this.buf.push(">"),!0}endElement(n){const e=Cb(n).toLowerCase();Cw.hasOwnProperty(e)&&!bb.hasOwnProperty(e)&&(this.buf.push("</"),this.buf.push(e),this.buf.push(">"))}chars(n){this.buf.push(Sw(n))}}function Ew(t){const n=t.nextSibling;if(n&&t!==n.previousSibling)throw _S(n);return n}function wb(t){const n=t.firstChild;if(n&&function gS(t,n){return(t.compareDocumentPosition(n)&Node.DOCUMENT_POSITION_CONTAINED_BY)!==Node.DOCUMENT_POSITION_CONTAINED_BY}(t,n))throw _S(n);return n}function Cb(t){const n=t.nodeName;return"string"==typeof n?n:"FORM"}function _S(t){return new Error(`Failed to sanitize html because the element is clobbered: ${t.outerHTML}`)}const yS=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,iy=/([^\#-~ |!])/g;function Sw(t){return t.replace(/&/g,"&amp;").replace(yS,function(n){return"&#"+(1024*(n.charCodeAt(0)-55296)+(n.charCodeAt(1)-56320)+65536)+";"}).replace(iy,function(n){return"&#"+n.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let Eb;function ph(t,n){let e=null;try{Eb=Eb||function ty(t){const n=new _b(t);return function yb(){try{return!!(new window.DOMParser).parseFromString(Ff(""),"text/html")}catch{return!1}}()?new hS(n):n}(t);let i=n?String(n):"";e=Eb.getInertBodyElement(i);let r=5,l=i;do{if(0===r)throw new Error("Failed to sanitize html because the input is unstable");r--,i=l,l=e.innerHTML,e=Eb.getInertBodyElement(i)}while(i!==l);return Ff((new yp).sanitizeChildren(Dw(e)||e))}finally{if(e){const i=Dw(e)||e;for(;i.firstChild;)i.firstChild.remove()}}}function Dw(t){return"content"in t&&function ry(t){return t.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===t.nodeName}(t)?t.content:null}var ns=function(t){return t[t.NONE=0]="NONE",t[t.HTML=1]="HTML",t[t.STYLE=2]="STYLE",t[t.SCRIPT=3]="SCRIPT",t[t.URL=4]="URL",t[t.RESOURCE_URL=5]="RESOURCE_URL",t}(ns||{});function vp(t){const n=dg();return n?n.sanitize(ns.URL,t)||"":vd(t,"URL")?Sl(t):vb(zi(t))}function vS(t){const n=dg();if(n)return bw(n.sanitize(ns.RESOURCE_URL,t)||"");if(vd(t,"ResourceURL"))return bw(Sl(t));throw new bt(904,!1)}function dg(){const t=xt();return t&&t[10].sanitizer}const BI=/^>|^->|<!--|-->|--!>|<!-$/g,bS=/(<|>)/g;function ec(t){return t instanceof Function?t():t}function DS(t,n,e){let i=t.length;for(;;){const r=t.indexOf(n,e);if(-1===r)return r;if(0===r||t.charCodeAt(r-1)<=32){const l=n.length;if(r+l===i||t.charCodeAt(r+l)<=32)return r}e=r+1}}const zw="ng-template";function MS(t,n,e,i){let r=0;if(i){for(;r<n.length&&"string"==typeof n[r];r+=2)if("class"===n[r]&&-1!==DS(n[r+1].toLowerCase(),e,0))return!0}else if(Bw(t))return!1;if(r=n.indexOf(1,r),r>-1){let l;for(;++r<n.length&&"string"==typeof(l=n[r]);)if(l.toLowerCase()===e)return!0}return!1}function Bw(t){return 4===t.type&&t.value!==zw}function Vw(t,n,e){return n===(4!==t.type||e?t.value:zw)}function TS(t,n,e){let i=4;const r=t.attrs,l=null!==r?function IS(t){for(let n=0;n<t.length;n++)if(vl(t[n]))return n;return t.length}(r):0;let f=!1;for(let w=0;w<n.length;w++){const M=n[w];if("number"!=typeof M){if(!f)if(4&i){if(i=2|1&i,""!==M&&!Vw(t,M,e)||""===M&&1===n.length){if(kc(i))return!1;f=!0}}else if(8&i){if(null===r||!MS(t,r,M,e)){if(kc(i))return!1;f=!0}}else{const P=n[++w],L=Pb(M,r,Bw(t),e);if(-1===L){if(kc(i))return!1;f=!0;continue}if(""!==P){let $;if($=L>l?"":r[L+1].toLowerCase(),2&i&&P!==$){if(kc(i))return!1;f=!0}}}}else{if(!f&&!kc(i)&&!kc(M))return!1;if(f&&kc(M))continue;f=!1,i=M|1&i}}return kc(i)||f}function kc(t){return!(1&t)}function Pb(t,n,e,i){if(null===n)return-1;let r=0;if(i||!e){let l=!1;for(;r<n.length;){const f=n[r];if(f===t)return r;if(3===f||6===f)l=!0;else{if(1===f||2===f){let w=n[++r];for(;"string"==typeof w;)w=n[++r];continue}if(4===f)break;if(0===f){r+=4;continue}}r+=l?1:2}return-1}return function AS(t,n){let e=t.indexOf(4);if(e>-1)for(e++;e<t.length;){const i=t[e];if("number"==typeof i)return-1;if(i===n)return e;e++}return-1}(n,t)}function mh(t,n,e=!1){for(let i=0;i<n.length;i++)if(TS(t,n[i],e))return!0;return!1}function Ob(t,n){e:for(let e=0;e<n.length;e++){const i=n[e];if(t.length===i.length){for(let r=0;r<t.length;r++)if(t[r]!==i[r])continue e;return!0}}return!1}function Fb(t,n){return t?":not("+n.trim()+")":n}function kS(t){let n=t[0],e=1,i=2,r="",l=!1;for(;e<t.length;){let f=t[e];if("string"==typeof f)if(2&i){const w=t[++e];r+="["+f+(w.length>0?'="'+w+'"':"")+"]"}else 8&i?r+="."+f:4&i&&(r+=" "+f);else""!==r&&!kc(f)&&(n+=Fb(l,r),r=""),i=f,l=l||!kc(i);e++}return""!==r&&(n+=Fb(l,r)),n}const Gi={};function Hw(t,n){return t.createComment(function Tw(t){return t.replace(BI,n=>n.replace(bS,"\u200b$1\u200b"))}(n))}function Lb(t,n,e){return t.createElement(n,e)}function bp(t,n,e,i,r){t.insertBefore(n,e,i,r)}function cy(t,n,e){t.appendChild(n,e)}function $w(t,n,e,i,r){null!==i?bp(t,n,e,i,r):cy(t,n,e)}function Ww(t,n,e){const{mergedAttrs:i,classes:r,styles:l}=e;null!==i&&function ud(t,n,e){let i=0;for(;i<e.length;){const r=e[i];if("number"==typeof r){if(0!==r)break;i++;const l=e[i++],f=e[i++],w=e[i++];t.setAttribute(n,f,w,l)}else{const l=r,f=e[++i];hd(l)?t.setProperty(n,l,f):t.setAttribute(n,l,f),i++}}}(t,n,i),null!==r&&function PS(t,n,e){""===e?t.removeAttribute(n,"class"):t.setAttribute(n,"class",e)}(t,n,r),null!==l&&function qw(t,n,e){t.setAttribute(n,"style",e)}(t,n,l)}function gh(t,n,e,i,r,l,f,w,M,P,L){const $=26+i,Q=$+r,X=function pg(t,n){const e=[];for(let i=0;i<n;i++)e.push(i<t?null:Gi);return e}($,Q),Y="function"==typeof P?P():P;return X[1]={type:t,blueprint:X,template:e,queries:null,viewQuery:w,declTNode:n,data:X.slice().fill(null,$),bindingStartIndex:$,expandoStartIndex:Q,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof l?l():l,pipeRegistry:"function"==typeof f?f():f,firstChild:null,schemas:M,consts:Y,incompleteFirstPass:!1,ssrId:L}}function xp(t,n,e,i,r,l,f,w,M,P,L){const $=n.blueprint.slice();return $[0]=r,$[2]=1228|i,(null!==P||t&&2048&t[2])&&($[2]|=2048),Qu($),$[3]=$[14]=t,$[8]=e,$[10]=f||t&&t[10],$[11]=w||t&&t[11],$[9]=M||t&&t[9]||null,$[5]=l,$[19]=function EE(){return lI++}(),$[6]=L,$[20]=P,$[15]=2==n.type?t[15]:$,$}function dy(t){let n=16;return t.signals?n=4096:t.onPush&&(n=64),n}function wp(t,n,e,i){if(0===e)return-1;const r=n.length;for(let l=0;l<e;l++)n.push(i),t.blueprint.push(i),t.data.push(null);return r}function uy(t,n){return t[12]?t[13][4]=n:t[12]=n,t[13]=n,n}function xe(t=1){Nb(Wn(),xt(),Ao()+t,!1)}function Nb(t,n,e,i){if(!i)if(3&~n[2]){const l=t.preOrderHooks;null!==l&&iu(n,l,0,e)}else{const l=t.preOrderCheckHooks;null!==l&&Ha(n,l,e)}nu(e)}var gu=function(t){return t[t.None=0]="None",t[t.SignalBased=1]="SignalBased",t[t.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",t}(gu||{});function zb(t,n,e,i){const r=Gn(null);try{const[l,f,w]=t.inputs[e];let M=null;!!(f&gu.SignalBased)&&(M=n[l][Kn]),null!==M&&void 0!==M.transformFn?i=M.transformFn(i):null!==w&&(i=w.call(n,i)),null!==t.setInput?t.setInput(n,M,i,e,l):hf(n,M,l,i)}finally{Gn(r)}}function Zw(t,n,e,i,r){const l=Ao(),f=2&i;try{nu(-1),f&&n.length>26&&Nb(t,n,26,!1),e(i,r)}finally{nu(l)}}function hy(t,n,e){(function Kw(t,n,e){const i=e.directiveStart,r=e.directiveEnd;Qs(e)&&function XI(t,n,e){const i=Bo(n,t),r=function Yw(t){const n=t.tView;return null===n||n.incompleteFirstPass?t.tView=gh(1,null,t.template,t.decls,t.vars,t.directiveDefs,t.pipeDefs,t.viewQuery,t.schemas,t.consts,t.id):n}(e),l=t[10].rendererFactory,f=uy(t,xp(t,r,null,dy(e),i,n,null,l.createRenderer(i,e),null,null,null));t[n.index]=f}(n,e,t.data[i+e.componentOffset]),t.firstCreatePass||Us(e,n);const l=e.initialInputs;for(let f=i;f<r;f++){const w=t.data[f],M=Co(n,t,f,e);Za(M,n),null!==l&&Qw(0,f-i,M,w,0,l),ma(w)&&(ps(e.index,n)[8]=Co(n,t,f,e))}})(t,n,e),!(64&~e.flags)&&function jb(t,n,e){const i=e.directiveStart,r=e.directiveEnd,l=e.index,f=function Um(){return xi.lFrame.currentDirectiveIndex}();try{nu(l);for(let w=i;w<r;w++){const M=t.data[w],P=n[w];tp(w),(null!==M.hostBindings||0!==M.hostVars||null!==M.hostAttrs)&&fg(M,P)}}finally{nu(-1),tp(f)}}(t,n,e)}function Bb(t,n,e=Bo){const i=n.localNames;if(null!==i){let r=n.index+1;for(let l=0;l<i.length;l+=2){const f=i[l+1],w=-1===f?e(n,t):t[f];t[r++]=w}}}let OS=()=>null;function Dl(t,n,e,i,r,l,f,w){if(w||!Hb(n,t,e,i,r)){if(3&n.type){const M=Bo(n,e);i=function QI(t){return"class"===t?"className":"for"===t?"htmlFor":"formaction"===t?"formAction":"innerHtml"===t?"innerHTML":"readonly"===t?"readOnly":"tabindex"===t?"tabIndex":t}(i),r=null!=f?f(r,n.value||"",i):r,l.setProperty(M,i,r)}}else Qs(n)&&function JI(t,n){const e=ps(n,t);16&e[2]||(e[2]|=64)}(e,n.index)}function fg(t,n){null!==t.hostBindings&&t.hostBindings(1,n)}function Lf(t,n){const e=t.directiveRegistry;let i=null;if(e)for(let r=0;r<e.length;r++){const l=e[r];mh(n,l.selectors,!1)&&(i??=[],ma(l)?i.unshift(l):i.push(l))}return i}function Rc(t,n,e,i,r,l){const f=Bo(t,n);!function mg(t,n,e,i,r,l,f){if(null==l)t.removeAttribute(n,r,e);else{const w=null==f?zi(l):f(l,i||"",r);t.setAttribute(n,r,w,e)}}(n[11],f,l,t.value,e,i,r)}function Qw(t,n,e,i,r,l){const f=l[n];if(null!==f)for(let w=0;w<f.length;w+=2)zb(i,e,f[w],f[w+1])}function Hb(t,n,e,i,r){const l=t.inputs?.[i],f=t.hostDirectiveInputs?.[i];let w=!1;if(f)for(let M=0;M<f.length;M+=2){const P=f[M];zb(n.data[P],e[P],f[M+1],r),w=!0}if(l)for(const M of l)zb(n.data[M],e[M],i,r),w=!0;return w}function gg(t,n){const e=ps(n,t),i=e[1];!function NS(t,n){for(let e=n.length;e<t.blueprint.length;e++)n.push(t.blueprint[e])}(i,e);const r=e[0];null!==r&&null===e[6]&&(e[6]=null),$b(i,e,e[8])}function $b(t,n,e){jm(n);try{const i=t.viewQuery;null!==i&&gb(1,i,e);const r=t.template;null!==r&&Zw(t,n,r,1,e),t.firstCreatePass&&(t.firstCreatePass=!1),n[18]?.finishViewCreation(t),t.staticContentQueries&&mb(t,n),t.staticViewQueries&&gb(2,t.viewQuery,e);const l=t.components;null!==l&&function zS(t,n){for(let e=0;e<n.length;e++)gg(t,n[e])}(n,l)}catch(i){throw t.firstCreatePass&&(t.incompleteFirstPass=!0,t.firstCreatePass=!1),i}finally{n[2]&=-5,ih()}}function _g(t,n,e,i){const r=Gn(null);try{const l=n.tView,M=xp(t,l,e,4096&t[2]?4096:16,null,n,null,null,i?.injector??null,i?.embeddedViewInjector??null,i?.dehydratedView??null);M[16]=t[n.index];const L=t[18];return null!==L&&(M[18]=L.createEmbeddedView(l)),$b(l,M,e),M}finally{Gn(r)}}function zf(t,n){return!n||null===n.firstChild||Tc(t)}function e1(t,n){return undefined(t,n)}var xd=function(t){return t[t.Important=1]="Important",t[t.DashCase=2]="DashCase",t}(xd||{});function Cp(t){return!(32&~t.flags)}function yg(t,n,e,i,r){if(null!=i){let l,f=!1;xo(i)?l=i:ao(i)&&(f=!0,i=i[0]);const w=tr(i);0===t&&null!==e?null==r?cy(n,e,w):bp(n,e,w,r||null,!0):1===t&&null!==e?bp(n,e,w,r||null,!0):2===t?function hg(t,n,e){t.removeChild(null,n,e)}(n,w,f):3===t&&n.destroyNode(w),null!=l&&function qS(t,n,e,i,r){const l=e[7];l!==tr(e)&&yg(n,t,i,l,r);for(let w=10;w<e.length;w++){const M=e[w];_y(M[1],M,t,n,i,l)}}(n,t,l,e,r)}}function BS(t,n){n[10].changeDetectionScheduler?.notify(9),_y(t,n,n[11],2,null,null)}function vg(t,n){const e=t[9],i=e.indexOf(n);e.splice(i,1)}function gy(t,n){if(Cc(n))return;const e=n[11];e.destroyNode&&_y(t,n,e,3,null,null),function nA(t){let n=t[12];if(!n)return t1(t[1],t);for(;n;){let e=null;if(ao(n))e=n[12];else{const i=n[10];i&&(e=i)}if(!e){for(;n&&!n[4]&&n!==t;)ao(n)&&t1(n[1],n),n=n[3];null===n&&(n=t),ao(n)&&t1(n[1],n),e=n&&n[4]}n=e}}(n)}function t1(t,n){if(Cc(n))return;const e=Gn(null);try{n[2]&=-129,n[2]|=256,n[24]&&On(n[24]),function iA(t,n){let e;if(null!=t&&null!=(e=t.destroyHooks))for(let i=0;i<e.length;i+=2){const r=n[e[i]];if(!(r instanceof sp)){const l=e[i+1];if(Array.isArray(l))for(let f=0;f<l.length;f+=2){const w=r[l[f]],M=l[f+1];try{M.call(w)}finally{}}else try{l.call(r)}finally{}}}}(t,n),function VS(t,n){const e=t.cleanup,i=n[7];if(null!==e)for(let f=0;f<e.length-1;f+=2)if("string"==typeof e[f]){const w=e[f+3];w>=0?i[w]():i[-w].unsubscribe(),f+=2}else e[f].call(i[e[f+1]]);null!==i&&(n[7]=null);const r=n[21];if(null!==r){n[21]=null;for(let f=0;f<r.length;f++)(0,r[f])()}const l=n[23];if(null!==l){n[23]=null;for(const f of l)f.destroy()}}(t,n),1===n[1].type&&n[11].destroy();const i=n[16];if(null!==i&&xo(n[3])){i!==n[3]&&vg(i,n);const r=n[18];null!==r&&r.detachView(t)}$v(n)}finally{Gn(e)}}function n1(t,n,e){return function US(t,n,e){let i=n;for(;null!==i&&168&i.type;)i=(n=i).parent;if(null===i)return e[0];if(Qs(i)){const{encapsulation:r}=t.data[i.directiveStart+i.componentOffset];if(r===Jl.None||r===Jl.Emulated)return null}return Bo(i,e)}(t,n.parent,e)}function jS(t,n,e){return Bf(t,n,e)}let Bf=function HS(t,n,e){return 40&t.type?Bo(t,e):null};function bg(t,n,e,i){const r=n1(t,i,n),l=n[11],w=jS(i.parent||n[5],i,n);if(null!=r)if(Array.isArray(e))for(let M=0;M<e.length;M++)$w(l,r,e[M],w,!1);else $w(l,r,e,w,!1)}function Ep(t,n){if(null!==n){const e=n.type;if(3&e)return Bo(n,t);if(4&e)return Gb(-1,t[n.index]);if(8&e){const i=n.child;if(null!==i)return Ep(t,i);{const r=t[n.index];return xo(r)?Gb(-1,r):tr(r)}}if(128&e)return Ep(t,n.next);if(32&e)return e1(n,t)()||tr(t[n.index]);{const i=i1(t,n);return null!==i?Array.isArray(i)?i[0]:Ep(Js(t[15]),i):Ep(t,n.next)}}return null}function i1(t,n){return null!==n?t[15][5].projection[n.projection]:null}function Gb(t,n){const e=10+t+1;if(e<n.length){const i=n[e],r=i[1].firstChild;if(null!==r)return Ep(i,r)}return n[7]}function qb(t,n,e,i,r,l,f){for(;null!=e;){if(128===e.type){e=e.next;continue}const w=i[e.index],M=e.type;if(f&&0===n&&(w&&Za(tr(w),i),e.flags|=2),!Cp(e))if(8&M)qb(t,n,e.child,i,r,l,!1),yg(n,t,r,w,l);else if(32&M){const P=e1(e,i);let L;for(;L=P();)yg(n,t,r,L,l);yg(n,t,r,w,l)}else 16&M?r1(t,n,i,e,r,l):yg(n,t,r,w,l);e=f?e.projectionNext:e.next}}function _y(t,n,e,i,r,l){qb(e,i,t.firstChild,n,r,l,!1)}function r1(t,n,e,i,r,l){const f=e[15],M=f[5].projection[i.projection];if(Array.isArray(M))for(let P=0;P<M.length;P++)yg(n,t,r,M[P],l);else{let P=M;const L=f[3];Tc(i)&&(P.flags|=128),qb(t,n,P,L,r,l,!0)}}function _h(t,n,e,i,r=!1){for(;null!==e;){if(128===e.type){e=r?e.projectionNext:e.next;continue}const l=n[e.index];null!==l&&i.push(tr(l)),xo(l)&&Wb(l,i);const f=e.type;if(8&f)_h(t,n,e.child,i);else if(32&f){const w=e1(e,n);let M;for(;M=w();)i.push(M)}else if(16&f){const w=i1(n,e);if(Array.isArray(w))i.push(...w);else{const M=Js(n[15]);_h(M[1],M,w,i,!0)}}e=r?e.projectionNext:e.next}return i}function Wb(t,n){for(let e=10;e<t.length;e++){const i=t[e],r=i[1].firstChild;null!==r&&_h(i[1],i,r,n)}t[7]!==t[0]&&n.push(t[7])}function yy(t){if(null!==t[25]){for(const n of t[25])n.impl.addSequence(n);t[25].length=0}}let Yb=[];const KS={...ri,consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:t=>{ja(t.lView)},consumerOnSignalRead(){this.lView[24]=this}},JS={...ri,consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:t=>{let n=Js(t.lView);for(;n&&!o1(n[1]);)n=Js(n);n&&f_(n)},consumerOnSignalRead(){this.lView[24]=this}};function o1(t){return 2!==t.type}function yh(t){if(null===t[23])return;let n=!0;for(;n;){let e=!1;for(const i of t[23])i.dirty&&(e=!0,null===i.zone||Zone.current===i.zone?i.run():i.zone.run(()=>i.run()));n=e&&!!(8192&t[2])}}function Zb(t,n=!0,e=0){const r=t[10].rendererFactory;r.begin?.();try{!function oA(t,n){const e=Vo();try{nh(!0),s1(t,n);let i=0;for(;Zh(t);){if(100===i)throw new bt(103,!1);i++,s1(t,1)}}finally{nh(e)}}(t,e)}catch(f){throw n&&function Nf(t,n){const e=t[9],i=e?e.get(Xi,null):null;i&&i.handleError(n)}(t,f),f}finally{r.end?.()}}function eD(t,n,e,i){if(Cc(n))return;const r=n[2];jm(n);let w=!0,M=null,P=null;o1(t)?(P=function YS(t){return t[24]??function ZS(t){const n=Yb.pop()??Object.create(KS);return n.lView=t,n}(t)}(n),M=Sn(P)):null===function To(){return h}()?(w=!1,P=function QS(t){const n=t[24]??Object.create(JS);return n.lView=t,n}(n),M=Sn(P)):n[24]&&(On(n[24]),n[24]=null);try{Qu(n),function vf(t){return xi.lFrame.bindingIndex=t}(t.bindingStartIndex),null!==e&&Zw(t,n,e,2,i);const L=!(3&~r);if(L){const X=t.preOrderCheckHooks;null!==X&&Ha(n,X,null)}else{const X=t.preOrderHooks;null!==X&&iu(n,X,0,null),$r(n,0)}if(function sA(t){for(let n=AE(t);null!==n;n=kE(n)){if(!(2&n[2]))continue;const e=n[9];for(let i=0;i<e.length;i++)f_(e[i])}}(n),yh(n),tD(n,0),null!==t.contentQueries&&mb(t,n),L){const X=t.contentCheckHooks;null!==X&&Ha(n,X)}else{const X=t.contentHooks;null!==X&&iu(n,X,1),$r(n,1)}!function lA(t,n){const e=t.hostBindingOpCodes;if(null!==e)try{for(let i=0;i<e.length;i++){const r=e[i];if(r<0)nu(~r);else{const l=r,f=e[++i],w=e[++i];Vm(f,l);const M=n[l];w(2,M)}}}finally{nu(-1)}}(t,n);const $=t.components;null!==$&&iD(n,$,0);const Q=t.viewQuery;if(null!==Q&&gb(2,Q,i),L){const X=t.viewCheckHooks;null!==X&&Ha(n,X)}else{const X=t.viewHooks;null!==X&&iu(n,X,2),$r(n,2)}if(!0===t.firstUpdatePass&&(t.firstUpdatePass=!1),n[22]){for(const X of n[22])X();n[22]=null}yy(n),n[2]&=-73}catch(L){throw ja(n),L}finally{null!==P&&(Aa(P,M),w&&function XS(t){t.lView[24]!==t&&(t.lView=null,Yb.push(t))}(P)),ih()}}function tD(t,n){for(let e=AE(t);null!==e;e=kE(e))for(let i=10;i<e.length;i++)nD(e[i],n)}function aA(t,n,e){const i=ps(n,t);nD(i,e)}function nD(t,n){mf(t)&&s1(t,n)}function s1(t,n){const i=t[1],r=t[2],l=t[24];let f=!!(0===n&&16&r);if(f||=!!(64&r&&0===n),f||=!!(1024&r),f||=!(!l?.dirty||!pc(l)),f||=!1,l&&(l.dirty=!1),t[2]&=-9217,f)eD(i,t,i.template,t[8]);else if(8192&r){yh(t),tD(t,1);const w=i.components;null!==w&&iD(t,w,1),yy(t)}}function iD(t,n,e){for(let i=0;i<n.length;i++)aA(t,n[i],e)}function by(t,n){const e=Vo()?64:1088;for(t[10].changeDetectionScheduler?.notify(n);t;){t[2]|=e;const i=Js(t);if(ga(t)&&!i)return t;t=i}return null}function rD(t,n,e,i){return[t,!0,0,n,null,i,null,e,null,null]}function oD(t,n){const e=10+n;if(e<t.length)return t[e]}function Hs(t,n,e,i=!0){const r=n[1];if(function sD(t,n,e,i){const r=10+i,l=e.length;i>0&&(e[r-1][4]=n),i<l-10?(n[4]=e[r],Bu(e,10+i,n)):(e.push(n),n[4]=null),n[3]=e;const f=n[16];null!==f&&e!==f&&a1(f,n);const w=n[18];null!==w&&w.insertView(t),Xh(n),n[2]|=128}(r,n,t,e),i){const f=Gb(e,t),w=n[11],M=w.parentNode(t[7]);null!==M&&function tA(t,n,e,i,r,l){i[0]=r,i[5]=n,_y(t,i,e,1,r,l)}(r,t[5],w,n,M,f)}const l=n[6];null!==l&&null!==l.firstChild&&(l.firstChild=null)}function Uf(t,n){const e=xy(t,n);return void 0!==e&&gy(e[1],e),e}function xy(t,n){if(t.length<=10)return;const e=10+n,i=t[e];if(i){const r=i[16];null!==r&&r!==t&&vg(r,i),n>0&&(t[e-1][4]=i[4]);const l=ed(t,10+n);!function my(t,n){BS(t,n),n[0]=null,n[5]=null}(i[1],i);const f=l[18];null!==f&&f.detachView(l[1]),i[3]=null,i[4]=null,i[2]&=-129}return i}function a1(t,n){const e=t[9],i=n[3];(ao(i)||n[15]!==i[3][15])&&(t[2]|=2),null===e?t[9]=[n]:e.push(n)}let wy=class{_lView;_cdRefInjectingView;notifyErrorHandler;_appRef=null;_attachedToViewContainer=!1;get rootNodes(){const n=this._lView,e=n[1];return _h(e,n,e.firstChild,[])}constructor(n,e,i=!0){this._lView=n,this._cdRefInjectingView=e,this.notifyErrorHandler=i}get context(){return this._lView[8]}set context(n){this._lView[8]=n}get destroyed(){return Cc(this._lView)}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const n=this._lView[3];if(xo(n)){const e=n[8],i=e?e.indexOf(this):-1;i>-1&&(xy(n,i),ed(e,i))}this._attachedToViewContainer=!1}gy(this._lView[1],this._lView)}onDestroy(n){Kh(this._lView,n)}markForCheck(){by(this._cdRefInjectingView||this._lView,4)}detach(){this._lView[2]&=-129}reattach(){Xh(this._lView),this._lView[2]|=128}detectChanges(){this._lView[2]|=1024,Zb(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new bt(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;const n=ga(this._lView),e=this._lView[16];null!==e&&!n&&vg(e,this._lView),BS(this._lView[1],this._lView)}attachToAppRef(n){if(this._attachedToViewContainer)throw new bt(902,!1);this._appRef=n;const e=ga(this._lView),i=this._lView[16];null!==i&&!e&&a1(i,this._lView),Xh(this._lView)}},is=(()=>class t{static __NG_ELEMENT_ID__=aD})();const uA=is,hA=class extends uA{_declarationLView;_declarationTContainer;elementRef;constructor(n,e,i){super(),this._declarationLView=n,this._declarationTContainer=e,this.elementRef=i}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(n,e){return this.createEmbeddedViewImpl(n,e)}createEmbeddedViewImpl(n,e,i){const r=_g(this._declarationLView,this._declarationTContainer,n,{embeddedViewInjector:e,dehydratedView:i});return new wy(r)}};function aD(){return Xr(Zi(),xt())}function Xr(t,n){return 4&t.type?new hA(n,t,$i(t,n)):null}function Dp(t,n,e,i,r){let l=t.data[n];if(null===l)l=function tc(t,n,e,i,r){const l=Lm(),f=yf(),M=t.data[n]=function u1(t,n,e,i,r,l){let f=n?n.injectorIndex:-1,w=0;return gl()&&(w|=128),{type:e,index:i,insertBeforeIndex:null,injectorIndex:f,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:w,providerIndexes:0,value:r,attrs:l,mergedAttrs:null,localNames:null,initialInputs:null,inputs:null,hostDirectiveInputs:null,outputs:null,hostDirectiveOutputs:null,directiveToIndex:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:n,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,f?l:l&&l.parent,e,n,i,r);return function Cg(t,n,e,i){null===t.firstChild&&(t.firstChild=n),null!==e&&(i?null==e.child&&null!==n.parent&&(e.child=n):null===e.next&&(e.next=n,n.prev=e))}(t,M,l,f),M}(t,n,e,i,r),function Jh(){return xi.lFrame.inI18n}()&&(l.flags|=32);else if(64&l.type){l.type=e,l.value=i,l.attrs=r;const f=function th(){const t=xi.lFrame,n=t.currentTNode;return t.isParent?n:n.parent}();l.injectorIndex=null===f?-1:f.injectorIndex}return Is(l,!0),l}let Ze=class{},ht=class{};class ut{resolveComponentFactory(n){throw Error(`No component factory found for ${Lr(n)}.`)}}let qt=class{static NULL=new ut};class gt{}let yt=(()=>class t{destroyNode=null;static __NG_ELEMENT_ID__=()=>function pt(){const t=xt(),e=ps(Zi().index,t);return(ao(e)?e:t)[11]}()})(),fn=(()=>{class t{static \u0275prov=Nt({token:t,providedIn:"root",factory:()=>null})}return t})();const hi={};class lr{injector;parentInjector;constructor(n,e){this.injector=n,this.parentInjector=e}get(n,e,i){i=vc(i);const r=this.injector.get(n,hi,i);return r!==hi||e===hi?r:this.parentInjector.get(n,e,i)}}function Cr(t,n,e){let i=e?t.styles:null,r=e?t.classes:null,l=0;if(null!==n)for(let f=0;f<n.length;f++){const w=n[f];"number"==typeof w?l=w:1==l?r=_c(r,w):2==l&&(i=_c(i,w+": "+n[++f]+";"))}e?t.styles=i:t.stylesWithoutHost=i,e?t.classes=r:t.classesWithoutHost=r}function ft(t,n=rr.Default){const e=xt();return null===e?gn(t,n):jv(Zi(),e,vi(t),n)}function Or(){throw new Error("invalid")}function Ki(t,n,e,i,r){const l=null===i?null:{"":-1},f=r(t,e);if(null!==f){let w,M=null,P=null;const L=function ta(t){let n=null,e=!1;for(let f=0;f<t.length;f++){const w=t[f];if(0===f&&ma(w)&&(n=w),null!==w.findHostDirectiveDefs){e=!0;break}}if(!e)return null;let i=null,r=null,l=null;for(const f of t)null!==f.findHostDirectiveDefs&&(i??=[],r??=new Map,l??=new Map,co(f,i,l,r)),f===n&&(i??=[],i.push(f));return null!==i?(i.push(...null===n?t:t.slice(1)),[i,r,l]):null}(f);null===L?w=f:[w,M,P]=L,function Rs(t,n,e,i,r,l,f){const w=i.length;let M=!1;for(let Q=0;Q<w;Q++){const X=i[Q];!M&&ma(X)&&(M=!0,yo(t,e,Q)),Mf(Us(e,n),t,X.type)}!function wD(t,n,e){t.flags|=1,t.directiveStart=n,t.directiveEnd=n+e,t.providerIndexes=n}(e,t.data.length,w);for(let Q=0;Q<w;Q++){const X=i[Q];X.providersResolver&&X.providersResolver(X)}let P=!1,L=!1,$=wp(t,n,w,null);w>0&&(e.directiveToIndex=new Map);for(let Q=0;Q<w;Q++){const X=i[Q];if(e.mergedAttrs=bl(e.mergedAttrs,X.hostAttrs),Mp(t,e,n,$,X),xD($,X,r),null!==f&&f.has(X)){const[K,de]=f.get(X);e.directiveToIndex.set(X.type,[$,K+e.directiveStart,de+e.directiveStart])}else(null===l||!l.has(X))&&e.directiveToIndex.set(X.type,$);null!==X.contentQueries&&(e.flags|=4),(null!==X.hostBindings||null!==X.hostAttrs||0!==X.hostVars)&&(e.flags|=64);const Y=X.type.prototype;!P&&(Y.ngOnChanges||Y.ngOnInit||Y.ngDoCheck)&&((t.preOrderHooks??=[]).push(e.index),P=!0),!L&&(Y.ngOnChanges||Y.ngDoCheck)&&((t.preOrderCheckHooks??=[]).push(e.index),L=!0),$++}!function rs(t,n,e){for(let i=n.directiveStart;i<n.directiveEnd;i++){const r=t.data[i];if(null!==e&&e.has(r)){const l=e.get(r);bh(0,n,l,i),bh(1,n,l,i),Pc(n,i,!0)}else Tl(0,n,r,i),Tl(1,n,r,i),Pc(n,i,!1)}}(t,e,l)}(t,n,e,w,l,M,P)}null!==l&&null!==i&&function ko(t,n,e){const i=t.localNames=[];for(let r=0;r<n.length;r+=2){const l=e[n[r+1]];if(null==l)throw new bt(-301,!1);i.push(n[r],l)}}(e,i,l)}function co(t,n,e,i){const r=n.length;t.findHostDirectiveDefs(t,n,i),e.set(t,[r,n.length-1])}function yo(t,n,e){n.componentOffset=e,(t.components??=[]).push(n.index)}function Tl(t,n,e,i){const r=0===t?e.inputs:e.outputs;for(const l in r)if(r.hasOwnProperty(l)){let f;f=0===t?n.inputs??={}:n.outputs??={},f[l]??=[],f[l].push(i),nc(n,l)}}function bh(t,n,e,i){const r=0===t?e.inputs:e.outputs;for(const l in r)if(r.hasOwnProperty(l)){const f=r[l];let w;w=0===t?n.hostDirectiveInputs??={}:n.hostDirectiveOutputs??={},w[f]??=[],w[f].push(i,l),nc(n,f)}}function nc(t,n){"class"===n?t.flags|=8:"style"===n&&(t.flags|=16)}function Pc(t,n,e){const{attrs:i,inputs:r,hostDirectiveInputs:l}=t;if(null===i||!e&&null===r||e&&null===l||Bw(t))return t.initialInputs??=[],void t.initialInputs.push(null);let f=null,w=0;for(;w<i.length;){const M=i[w];if(0!==M)if(5!==M){if("number"==typeof M)break;if(!e&&r.hasOwnProperty(M)){const P=r[M];for(const L of P)if(L===n){f??=[],f.push(M,i[w+1]);break}}else if(e&&l.hasOwnProperty(M)){const P=l[M];for(let L=0;L<P.length;L+=2)if(P[L]===n){f??=[],f.push(P[L+1],i[w+1]);break}}w+=2}else w+=2;else w+=4}t.initialInputs??=[],t.initialInputs.push(f)}function Mp(t,n,e,i,r){t.data[i]=r;const l=r.factory||(r.factory=bc(r.type)),f=new sp(l,ma(r),ft);t.blueprint[i]=f,e[i]=f,function Tp(t,n,e,i,r){const l=r.hostBindings;if(l){let f=t.hostBindingOpCodes;null===f&&(f=t.hostBindingOpCodes=[]);const w=~n.index;(function Gf(t){let n=t.length;for(;n>0;){const e=t[--n];if("number"==typeof e&&e<0)return e}return 0})(f)!=w&&f.push(w),f.push(e,i,l)}}(t,n,i,wp(t,e,r.hostVars,Gi),r)}function xD(t,n,e){if(e){if(n.exportAs)for(let i=0;i<n.exportAs.length;i++)e[n.exportAs[i]]=t;ma(n)&&(e[""]=t)}}function C1(t,n,e,i,r,l,f,w){const M=n.consts,L=Dp(n,t,2,i,Ua(M,f));return l&&Ki(n,e,L,Ua(M,w),r),L.mergedAttrs=bl(L.mergedAttrs,L.attrs),null!==L.attrs&&Cr(L,L.attrs,!1),null!==L.mergedAttrs&&Cr(L,L.mergedAttrs,!0),null!==n.queries&&n.queries.elementStart(n,L),L}function E1(t,n){op(t,n),Yh(n)&&t.queries.elementEnd(n)}class S1 extends qt{ngModule;constructor(n){super(),this.ngModule=n}resolveComponentFactory(n){const e=bi(n);return new Wf(e,this.ngModule)}}class Wf extends ht{componentDef;ngModule;selector;componentType;ngContentSelectors;isBoundToModule;cachedInputs=null;cachedOutputs=null;get inputs(){return this.cachedInputs??=function CD(t){return Object.keys(t).map(n=>{const[e,i,r]=t[n],l={propName:e,templateName:n,isSignal:!!(i&gu.SignalBased)};return r&&(l.transform=r),l})}(this.componentDef.inputs),this.cachedInputs}get outputs(){return this.cachedOutputs??=function D1(t){return Object.keys(t).map(n=>({propName:t[n],templateName:n}))}(this.componentDef.outputs),this.cachedOutputs}constructor(n,e){super(),this.componentDef=n,this.ngModule=e,this.componentType=n.type,this.selector=function YI(t){return t.map(kS).join(",")}(n.selectors),this.ngContentSelectors=n.ngContentSelectors??[],this.isBoundToModule=!!e}create(n,e,i,r){const l=Gn(null);try{const f=this.componentDef,w=i?["ng-version","19.2.8"]:function ZI(t){const n=[],e=[];let i=1,r=2;for(;i<t.length;){let l=t[i];if("string"==typeof l)2===r?""!==l&&n.push(l,t[++i]):8===r&&e.push(l);else{if(!kc(r))break;r=l}i++}return e.length&&n.push(1,...e),n}(this.componentDef.selectors[0]),M=gh(0,null,null,1,0,null,null,null,null,[w],null),P=function _u(t,n,e){let i=n instanceof Lo?n:n?.injector;return i&&null!==t.getStandaloneInjector&&(i=t.getStandaloneInjector(i)||i),i?new lr(e,i):e}(f,r||this.ngModule,n),L=function SD(t){const n=t.get(gt,null);if(null===n)throw new bt(407,!1);return{rendererFactory:n,sanitizer:t.get(fn,null),changeDetectionScheduler:t.get(ot,null)}}(P),$=L.rendererFactory.createRenderer(null,f),Q=i?function Vb(t,n,e,i){const l=i.get(tb,!1)||e===Jl.ShadowDom,f=t.selectRootElement(n,l);return function py(t){OS(t)}(f),f}($,i,f.encapsulation,P):function qf(t,n){const e=(t.selectors[0][0]||"div").toLowerCase();return Lb(n,e,"svg"===e?"svg":"math"===e?"math":null)}(f,$),X=xp(null,M,null,512|dy(f),null,null,L,$,P,null,null);X[26]=Q,jm(X);let Y=null;try{const K=C1(26,M,X,"#host",()=>[this.componentDef],!0,0);Q&&(Ww($,Q,K),Za(Q,X)),hy(M,X,K),gw(M,K,X),E1(M,K),void 0!==e&&function T1(t,n,e){const i=t.projection=[];for(let r=0;r<n.length;r++){const l=e[r];i.push(null!=l&&l.length?Array.from(l):null)}}(K,this.ngContentSelectors,e),Y=ps(K.index,X),X[8]=Y[8],$b(M,X,null)}catch(K){throw null!==Y&&$v(Y),$v(X),K}finally{ih()}return new M1(this.componentType,X)}finally{Gn(l)}}}class M1 extends Ze{_rootLView;instance;hostView;changeDetectorRef;componentType;location;previousInputValues=null;_tNode;constructor(n,e){super(),this._rootLView=e,this._tNode=Ye(e[1],26),this.location=$i(this._tNode,e),this.instance=ps(this._tNode.index,e)[8],this.hostView=this.changeDetectorRef=new wy(e,void 0,!1),this.componentType=n}setInput(n,e){const i=this._tNode;if(this.previousInputValues??=new Map,this.previousInputValues.has(n)&&Object.is(this.previousInputValues.get(n),e))return;const r=this._rootLView;Hb(i,r[1],r,n,e),this.previousInputValues.set(n,e),by(ps(i.index,r),1)}get injector(){return new Ur(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(n){this.hostView.onDestroy(n)}}let io=(()=>class t{static __NG_ELEMENT_ID__=I1})();function I1(){return a0(Zi(),xt())}const EA=io,Il=class extends EA{_lContainer;_hostTNode;_hostLView;constructor(n,e,i){super(),this._lContainer=n,this._hostTNode=e,this._hostLView=i}get element(){return $i(this._hostTNode,this._hostLView)}get injector(){return new Ur(this._hostTNode,this._hostLView)}get parentInjector(){const n=Sc(this._hostTNode,this._hostLView);if(C_(n)){const e=ru(n,this._hostLView),i=Sf(n);return new Ur(e[1].data[i+8],e)}return new Ur(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(n){const e=Ca(this._lContainer);return null!==e&&e[n]||null}get length(){return this._lContainer.length-10}createEmbeddedView(n,e,i){let r,l;"number"==typeof i?r=i:null!=i&&(r=i.index,l=i.injector);const w=n.createEmbeddedViewImpl(e||{},l,null);return this.insertImpl(w,r,zf(this._hostTNode,null)),w}createComponent(n,e,i,r,l){const f=n&&!function Kd(t){return"function"==typeof t}(n);let w;if(f)w=e;else{const Y=e||{};w=Y.index,i=Y.injector,r=Y.projectableNodes,l=Y.environmentInjector||Y.ngModuleRef}const M=f?n:new Wf(bi(n)),P=i||this.parentInjector;if(!l&&null==M.ngModule){const K=(f?P:this.parentInjector).get(Lo,null);K&&(l=K)}bi(M.componentType??{});const X=M.create(P,r,null,l);return this.insertImpl(X.hostView,w,zf(this._hostTNode,null)),X}insert(n,e){return this.insertImpl(n,e,!0)}insertImpl(n,e,i){const r=n._lView;if(function Fv(t){return xo(t[3])}(r)){const w=this.indexOf(n);if(-1!==w)this.detach(w);else{const M=r[3],P=new Il(M,M[5],M[3]);P.detach(P.indexOf(n))}}const l=this._adjustIndex(e),f=this._lContainer;return Hs(f,r,l,i),n.attachToViewContainerRef(),Bu(Yf(f),l,n),n}move(n,e){return this.insert(n,e)}indexOf(n){const e=Ca(this._lContainer);return null!==e?e.indexOf(n):-1}remove(n){const e=this._adjustIndex(n,-1),i=xy(this._lContainer,e);i&&(ed(Yf(this._lContainer),e),gy(i[1],i))}detach(n){const e=this._adjustIndex(n,-1),i=xy(this._lContainer,e);return i&&null!=ed(Yf(this._lContainer),e)?new wy(i):null}_adjustIndex(n,e=0){return n??this.length+e}};function Ca(t){return t[8]}function Yf(t){return t[8]||(t[8]=[])}function a0(t,n){let e;const i=n[t.index];return xo(i)?e=i:(e=rD(i,n,null,t),n[t.index]=e,uy(n,e)),mO(e,n,t,i),new Il(e,t,n)}let mO=function _O(t,n,e,i){if(t[7])return;let r;r=8&e.type?tr(i):function Zf(t,n){const e=t[11],i=e.createComment(""),r=Bo(n,t),l=e.parentNode(r);return bp(e,l,i,e.nextSibling(r),!1),i}(n,e),t[7]=r};class DA{queryList;matches=null;constructor(n){this.queryList=n}clone(){return new DA(this.queryList)}setDirty(){this.queryList.setDirty()}}class MA{queries;constructor(n=[]){this.queries=n}createEmbeddedView(n){const e=n.queries;if(null!==e){const i=null!==n.contentQueries?n.contentQueries[0]:e.length,r=[];for(let l=0;l<i;l++){const f=e.getByIndex(l);r.push(this.queries[f.indexInDeclarationView].clone())}return new MA(r)}return null}insertView(n){this.dirtyQueriesWithMatches(n)}detachView(n){this.dirtyQueriesWithMatches(n)}finishViewCreation(n){this.dirtyQueriesWithMatches(n)}dirtyQueriesWithMatches(n){for(let e=0;e<this.queries.length;e++)null!==RA(n,e).matches&&this.queries[e].setDirty()}}class yO{flags;read;predicate;constructor(n,e,i=null){this.flags=e,this.read=i,this.predicate="string"==typeof n?function lj(t){return t.split(",").map(n=>n.trim())}(n):n}}class TA{queries;constructor(n=[]){this.queries=n}elementStart(n,e){for(let i=0;i<this.queries.length;i++)this.queries[i].elementStart(n,e)}elementEnd(n){for(let e=0;e<this.queries.length;e++)this.queries[e].elementEnd(n)}embeddedTView(n){let e=null;for(let i=0;i<this.length;i++){const r=null!==e?e.length:0,l=this.getByIndex(i).embeddedTView(n,r);l&&(l.indexInDeclarationView=i,null!==e?e.push(l):e=[l])}return null!==e?new TA(e):null}template(n,e){for(let i=0;i<this.queries.length;i++)this.queries[i].template(n,e)}getByIndex(n){return this.queries[n]}get length(){return this.queries.length}track(n){this.queries.push(n)}}class IA{metadata;matches=null;indexInDeclarationView=-1;crossesNgTemplate=!1;_declarationNodeIndex;_appliesToNextNode=!0;constructor(n,e=-1){this.metadata=n,this._declarationNodeIndex=e}elementStart(n,e){this.isApplyingToNode(e)&&this.matchTNode(n,e)}elementEnd(n){this._declarationNodeIndex===n.index&&(this._appliesToNextNode=!1)}template(n,e){this.elementStart(n,e)}embeddedTView(n,e){return this.isApplyingToNode(n)?(this.crossesNgTemplate=!0,this.addMatch(-n.index,e),new IA(this.metadata)):null}isApplyingToNode(n){if(this._appliesToNextNode&&1&~this.metadata.flags){const e=this._declarationNodeIndex;let i=n.parent;for(;null!==i&&8&i.type&&i.index!==e;)i=i.parent;return e===(null!==i?i.index:-1)}return this._appliesToNextNode}matchTNode(n,e){const i=this.metadata.predicate;if(Array.isArray(i))for(let r=0;r<i.length;r++){const l=i[r];this.matchTNodeWithReadOption(n,e,rj(e,l)),this.matchTNodeWithReadOption(n,e,As(e,n,l,!1,!1))}else i===is?4&e.type&&this.matchTNodeWithReadOption(n,e,-1):this.matchTNodeWithReadOption(n,e,As(e,n,i,!1,!1))}matchTNodeWithReadOption(n,e,i){if(null!==i){const r=this.metadata.read;if(null!==r)if(r===Dn||r===io||r===is&&4&e.type)this.addMatch(e.index,-2);else{const l=As(e,n,r,!1,!1);null!==l&&this.addMatch(e.index,l)}else this.addMatch(e.index,i)}}addMatch(n,e){null===this.matches?this.matches=[n,e]:this.matches.push(n,e)}}function rj(t,n){const e=t.localNames;if(null!==e)for(let i=0;i<e.length;i+=2)if(e[i]===n)return e[i+1];return null}function sj(t,n,e,i){return-1===e?function oj(t,n){return 11&t.type?$i(t,n):4&t.type?Xr(t,n):null}(n,t):-2===e?function aj(t,n,e){return e===Dn?$i(n,t):e===is?Xr(n,t):e===io?a0(n,t):void 0}(t,n,i):Co(t,t[1],e,n)}function vO(t,n,e,i){const r=n[18].queries[i];if(null===r.matches){const l=t.data,f=e.matches,w=[];for(let M=0;null!==f&&M<f.length;M+=2){const P=f[M];w.push(P<0?null:sj(n,l[P],f[M+1],e.metadata.read))}r.matches=w}return r.matches}function AA(t,n,e,i){const r=t.queries.getByIndex(e),l=r.matches;if(null!==l){const f=vO(t,n,r,e);for(let w=0;w<l.length;w+=2){const M=l[w];if(M>0)i.push(f[w/2]);else{const P=l[w+1],L=n[-M];for(let $=10;$<L.length;$++){const Q=L[$];Q[16]===Q[3]&&AA(Q[1],Q,P,i)}if(null!==L[9]){const $=L[9];for(let Q=0;Q<$.length;Q++){const X=$[Q];AA(X[1],X,P,i)}}}}}return i}function kA(t,n){return t[18].queries[n].queryList}function bO(t,n,e){const i=new gs(!(4&~e));return function ld(t,n,e,i){const r=Qh(n);r.push(e),t.firstCreatePass&&tu(t).push(i,r.length-1)}(t,n,i,i.destroy),(n[18]??=new MA).queries.push(new DA(i))-1}function wO(t,n,e,i){const r=Wn();if(r.firstCreatePass){const l=Zi();CO(r,new yO(n,e,i),l.index),function cj(t,n){const e=t.contentQueries||(t.contentQueries=[]);n!==(e.length?e[e.length-1]:-1)&&e.push(t.queries.length-1,n)}(r,t),!(2&~e)&&(r.staticContentQueries=!0)}return bO(r,xt(),e)}function CO(t,n,e){null===t.queries&&(t.queries=new TA),t.queries.track(new IA(n,e))}function RA(t,n){return t.queries.getByIndex(n)}function EO(t,n){const e=t[1],i=RA(e,n);return i.crossesNgTemplate?AA(e,t,n,[]):vO(e,t,i,n)}function PA(t,n,e){let i;const r=il(()=>{i._dirtyCounter();const l=function dj(t,n){const e=t._lView,i=t._queryIndex;if(void 0===e||void 0===i||4&e[2])return n?void 0:or;const r=kA(e,i),l=EO(e,i);return r.reset(l,vr),n?r.first:r._changesDetected||void 0===t._flatValue?t._flatValue=r.toArray():t._flatValue}(i,t);if(n&&void 0===l)throw new bt(-951,!1);return l});return i=r[Kn],i._dirtyCounter=wr(0),i._flatValue=void 0,r}function IO(t,n){return function SO(t){return PA(!0,!1)}()}const hj=(IO.required=function uj(t,n){return function DO(t){return PA(!0,!0)}()},IO);let Xf=class{},LO=class{};class FA extends Xf{ngModuleType;_parent;_bootstrapComponents=[];_r3Injector;instance;destroyCbs=[];componentFactoryResolver=new S1(this);constructor(n,e,i,r=!0){super(),this.ngModuleType=n,this._parent=e;const l=Ms(n);this._bootstrapComponents=ec(l.bootstrap),this._r3Injector=ve(n,e,[{provide:Xf,useValue:this},{provide:qt,useValue:this.componentFactoryResolver},...i],Lr(n),new Set(["environment"])),r&&this.resolveInjectorInitializers()}resolveInjectorInitializers(){this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(this.ngModuleType)}get injector(){return this._r3Injector}destroy(){const n=this._r3Injector;!n.destroyed&&n.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(n){this.destroyCbs.push(n)}}class LA extends LO{moduleType;constructor(n){super(),this.moduleType=n}create(n){return new FA(this.moduleType,n,[])}}class NO extends Xf{injector;componentFactoryResolver=new S1(this);instance=null;constructor(n){super();const e=new Hu([...n.providers,{provide:Xf,useValue:this},{provide:qt,useValue:this.componentFactoryResolver}],n.parent||rd(),n.debugName,new Set(["environment"]));this.injector=e,n.runEnvironmentInitializers&&e.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(n){this.injector.onDestroy(n)}}function DD(t,n,e=null){return new NO({providers:t,parent:n,debugName:e,runEnvironmentInitializers:!0}).injector}let Cj=(()=>{class t{_injector;cachedInjectors=new Map;constructor(e){this._injector=e}getOrCreateStandaloneInjector(e){if(!e.standalone)return null;if(!this.cachedInjectors.has(e)){const i=nf(0,e.type),r=i.length>0?DD([i],this._injector,`Standalone[${e.type.name}]`):null;this.cachedInjectors.set(e,r)}return this.cachedInjectors.get(e)}ngOnDestroy(){try{for(const e of this.cachedInjectors.values())null!==e&&e.destroy()}finally{this.cachedInjectors.clear()}}static \u0275prov=Nt({token:t,providedIn:"environment",factory:()=>new t(gn(Lo))})}return t})();function kn(t){return la(()=>{const n=zO(t),e={...n,decls:t.decls,vars:t.vars,template:t.template,consts:t.consts||null,ngContentSelectors:t.ngContentSelectors,onPush:t.changeDetection===D_.OnPush,directiveDefs:null,pipeDefs:null,dependencies:n.standalone&&t.dependencies||null,getStandaloneInjector:n.standalone?r=>r.get(Cj).getOrCreateStandaloneInjector(e):null,getExternalStyles:null,signals:t.signals??!1,data:t.data||{},encapsulation:t.encapsulation||Jl.Emulated,styles:t.styles||or,_:null,schemas:t.schemas||null,tView:null,id:""};n.standalone&&Cl("NgStandalone"),BO(e);const i=t.dependencies;return e.directiveDefs=MD(i,!1),e.pipeDefs=MD(i,!0),e.id=function Ij(t){let n=0;const i=[t.selectors,t.ngContentSelectors,t.hostVars,t.hostAttrs,"function"==typeof t.consts?"":t.consts,t.vars,t.decls,t.encapsulation,t.standalone,t.signals,t.exportAs,JSON.stringify(t.inputs),JSON.stringify(t.outputs),Object.getOwnPropertyNames(t.type.prototype),!!t.contentQueries,!!t.viewQuery];for(const l of i.join("|"))n=Math.imul(31,n)+l.charCodeAt(0)|0;return n+=2147483648,"c"+n}(e),e})}function Ej(t){return bi(t)||es(t)}function Sj(t){return null!==t}function Er(t){return la(()=>({type:t.type,bootstrap:t.bootstrap||or,declarations:t.declarations||or,imports:t.imports||or,exports:t.exports||or,transitiveCompileScopes:null,schemas:t.schemas||null,id:t.id||null}))}function Dj(t,n){if(null==t)return $l;const e={};for(const i in t)if(t.hasOwnProperty(i)){const r=t[i];let l,f,w,M;Array.isArray(r)?(w=r[0],l=r[1],f=r[2]??l,M=r[3]||null):(l=r,f=r,w=gu.None,M=null),e[l]=[i,w,M],n[l]=f}return e}function Mj(t){if(null==t)return $l;const n={};for(const e in t)t.hasOwnProperty(e)&&(n[t[e]]=e);return n}function Ht(t){return la(()=>{const n=zO(t);return BO(n),n})}function Oc(t){return{type:t.type,name:t.name,factory:null,pure:!1!==t.pure,standalone:t.standalone??!0,onDestroy:t.type.prototype.ngOnDestroy||null}}function zO(t){const n={};return{type:t.type,providersResolver:null,factory:null,hostBindings:t.hostBindings||null,hostVars:t.hostVars||0,hostAttrs:t.hostAttrs||null,contentQueries:t.contentQueries||null,declaredInputs:n,inputConfig:t.inputs||$l,exportAs:t.exportAs||null,standalone:t.standalone??!0,signals:!0===t.signals,selectors:t.selectors||or,viewQuery:t.viewQuery||null,features:t.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:Dj(t.inputs,n),outputs:Mj(t.outputs),debugInfo:null}}function BO(t){t.features?.forEach(n=>n(t))}function MD(t,n){if(!t)return null;const e=n?zs:Ej;return()=>("function"==typeof t?t():t).map(i=>e(i)).filter(Sj)}function Nn(t){let n=function VO(t){return Object.getPrototypeOf(t.prototype).constructor}(t.type),e=!0;const i=[t];for(;n;){let r;if(ma(t))r=n.\u0275cmp||n.\u0275dir;else{if(n.\u0275cmp)throw new bt(903,!1);r=n.\u0275dir}if(r){if(e){i.push(r);const f=t;f.inputs=NA(t.inputs),f.declaredInputs=NA(t.declaredInputs),f.outputs=NA(t.outputs);const w=r.hostBindings;w&&Oj(t,w);const M=r.viewQuery,P=r.contentQueries;if(M&&Rj(t,M),P&&Pj(t,P),Aj(t,r),Pa(t.outputs,r.outputs),ma(r)&&r.data.animation){const L=t.data;L.animation=(L.animation||[]).concat(r.data.animation)}}const l=r.features;if(l)for(let f=0;f<l.length;f++){const w=l[f];w&&w.ngInherit&&w(t),w===Nn&&(e=!1)}}n=Object.getPrototypeOf(n)}!function kj(t){let n=0,e=null;for(let i=t.length-1;i>=0;i--){const r=t[i];r.hostVars=n+=r.hostVars,r.hostAttrs=bl(r.hostAttrs,e=bl(e,r.hostAttrs))}}(i)}function Aj(t,n){for(const e in n.inputs){if(!n.inputs.hasOwnProperty(e)||t.inputs.hasOwnProperty(e))continue;const i=n.inputs[e];void 0!==i&&(t.inputs[e]=i,t.declaredInputs[e]=n.declaredInputs[e])}}function NA(t){return t===$l?{}:t===or?[]:t}function Rj(t,n){const e=t.viewQuery;t.viewQuery=e?(i,r)=>{n(i,r),e(i,r)}:n}function Pj(t,n){const e=t.contentQueries;t.contentQueries=e?(i,r,l)=>{n(i,r,l),e(i,r,l)}:n}function Oj(t,n){const e=t.hostBindings;t.hostBindings=e?(i,r)=>{n(i,r),e(i,r)}:n}function UO(t){const n=e=>{const i=Array.isArray(t);null===e.hostDirectives?(e.findHostDirectiveDefs=jO,e.hostDirectives=i?t.map(zA):[t]):i?e.hostDirectives.unshift(...t.map(zA)):e.hostDirectives.unshift(t)};return n.ngInherit=!0,n}function jO(t,n,e){if(null!==t.hostDirectives)for(const i of t.hostDirectives)if("function"==typeof i){const r=i();for(const l of r)HO(zA(l),n,e)}else HO(i,n,e)}function HO(t,n,e){const i=es(t.directive);(function zj(t,n){for(const e in n)n.hasOwnProperty(e)&&(t[n[e]]=t[e])})(i.declaredInputs,t.inputs),jO(i,n,e),e.set(i,t),n.push(i)}function zA(t){return"function"==typeof t?{directive:vi(t),inputs:$l,outputs:$l}:{directive:vi(t.directive),inputs:$O(t.inputs),outputs:$O(t.outputs)}}function $O(t){if(void 0===t||0===t.length)return $l;const n={};for(let e=0;e<t.length;e+=2)n[t[e]]=t[e+1];return n}function TD(t){return!!function BA(t){return null!==t&&("function"==typeof t||"object"==typeof t)}(t)&&(Array.isArray(t)||!(t instanceof Map)&&Symbol.iterator in t)}function Ip(t,n,e){return t[n]=e}function k1(t,n){return t[n]}function ys(t,n,e){return!Object.is(t[n],e)&&(t[n]=e,!0)}function Iy(t,n,e,i){const r=ys(t,n,e);return ys(t,n+1,i)||r}function yu(t,n,e,i,r,l){const f=Iy(t,n,e,i);return Iy(t,n+2,r,l)||f}function R1(t,n,e,i,r,l,f,w,M,P){const L=e+26,$=n.firstCreatePass?function jj(t,n,e,i,r,l,f,w,M){const P=n.consts,L=Dp(n,t,4,f||null,w||null);Yl()&&Ki(n,e,L,Ua(P,M),Lf),L.mergedAttrs=bl(L.mergedAttrs,L.attrs),op(n,L);const $=L.tView=gh(2,L,i,r,l,n.directiveRegistry,n.pipeRegistry,null,n.schemas,P,null);return null!==n.queries&&(n.queries.template(n,L),$.queries=n.queries.embeddedTView(L)),L}(L,n,t,i,r,l,f,w,M):n.data[L];Is($,!1);const Q=qO(n,t,$,e);dd()&&bg(n,t,Q,$),Za(Q,t);const X=rD(Q,t,Q,$);return t[L]=X,uy(t,X),lf($)&&hy(n,t,$),null!=M&&Bb(t,$,P),$}function vt(t,n,e,i,r,l,f,w){const M=xt(),P=Wn();return R1(M,P,t,n,e,i,r,Ua(P.consts,l),f,w),vt}let qO=function WO(t,n,e,i){return yl(!0),n[11].createComment("")};let jA=(()=>{class t{log(e){console.log(e)}warn(e){console.warn(e)}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"platform"})}return t})();const sF=new _t("");let ZA=(()=>{class t{static \u0275prov=Nt({token:t,providedIn:"root",factory:()=>new U6})}return t})();class U6{queuedEffectCount=0;queues=new Map;schedule(n){this.enqueue(n)}remove(n){const i=this.queues.get(n.zone);i.has(n)&&(i.delete(n),this.queuedEffectCount--)}enqueue(n){const e=n.zone;this.queues.has(e)||this.queues.set(e,new Set);const i=this.queues.get(e);i.has(n)||(this.queuedEffectCount++,i.add(n))}flush(){for(;this.queuedEffectCount>0;)for(const[n,e]of this.queues)null===n?this.flushQueue(e):n.run(()=>this.flushQueue(e))}flushQueue(n){for(const e of n)n.delete(e),this.queuedEffectCount--,e.run()}}function O1(t){return!!t&&"function"==typeof t.then}function aF(t){return!!t&&"function"==typeof t.subscribe}const lF=new _t("");function cF(t){return ul([{provide:lF,multi:!0,useValue:t}])}let dF=(()=>{class t{resolve;reject;initialized=!1;done=!1;donePromise=new Promise((e,i)=>{this.resolve=e,this.reject=i});appInits=te(lF,{optional:!0})??[];injector=te(we);constructor(){}runInitializers(){if(this.initialized)return;const e=[];for(const r of this.appInits){const l=Bs(this.injector,r);if(O1(l))e.push(l);else if(aF(l)){const f=new Promise((w,M)=>{l.subscribe({complete:w,error:M})});e.push(f)}}const i=()=>{this.done=!0,this.resolve()};Promise.all(e).then(()=>{i()}).catch(r=>{this.reject(r)}),0===e.length&&i(),this.initialized=!0}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();const u0=new _t("");let ic=(()=>{class t{_runningTick=!1;_destroyed=!1;_destroyListeners=[];_views=[];internalErrorHandler=te(lo);afterRenderManager=te(rb);zonelessEnabled=te(lt);rootEffectScheduler=te(ZA);dirtyFlags=0;tracingSnapshot=null;externalTestViews=new Set;afterTick=new Et;get allViews(){return[...this.externalTestViews.keys(),...this._views]}get destroyed(){return this._destroyed}componentTypes=[];components=[];isStable=te(Be).hasPendingTasks.pipe(an(e=>!e));constructor(){te(Jm,{optional:!0})}whenStable(){let e;return new Promise(i=>{e=this.isStable.subscribe({next:r=>{r&&i()}})}).finally(()=>{e.unsubscribe()})}_injector=te(Lo);_rendererFactory=null;get injector(){return this._injector}bootstrap(e,i){return this.bootstrapImpl(e,i)}bootstrapImpl(e,i,r=we.NULL){const l=e instanceof ht;if(!this._injector.get(dF).done)throw new bt(405,"");let w;w=l?e:this._injector.get(qt).resolveComponentFactory(e),this.componentTypes.push(w.componentType);const M=function j6(t){return t.isBoundToModule}(w)?void 0:this._injector.get(Xf),L=w.create(r,[],i||w.selector,M),$=L.location.nativeElement,Q=L.injector.get(sF,null);return Q?.registerApplication($),L.onDestroy(()=>{this.detachView(L.hostView),OD(this.components,L),Q?.unregisterApplication($)}),this._loadComponent(L),L}tick(){this.zonelessEnabled||(this.dirtyFlags|=1),this._tick()}_tick(){null!==this.tracingSnapshot?this.tracingSnapshot.run(Ux.CHANGE_DETECTION,this.tickImpl):this.tickImpl()}tickImpl=()=>{if(this._runningTick)throw new bt(101,!1);const e=Gn(null);try{this._runningTick=!0,this.synchronize()}catch(i){this.internalErrorHandler(i)}finally{this._runningTick=!1,this.tracingSnapshot?.dispose(),this.tracingSnapshot=null,Gn(e),this.afterTick.next()}};synchronize(){null===this._rendererFactory&&!this._injector.destroyed&&(this._rendererFactory=this._injector.get(gt,null,{optional:!0}));let e=0;for(;0!==this.dirtyFlags&&e++<10;)this.synchronizeOnce()}synchronizeOnce(){if(16&this.dirtyFlags&&(this.dirtyFlags&=-17,this.rootEffectScheduler.flush()),7&this.dirtyFlags){const e=!!(1&this.dirtyFlags);this.dirtyFlags&=-8,this.dirtyFlags|=8;for(let{_lView:i,notifyErrorHandler:r}of this.allViews)$6(i,r,e,this.zonelessEnabled);if(this.dirtyFlags&=-5,this.syncDirtyFlagsWithViews(),23&this.dirtyFlags)return}else this._rendererFactory?.begin?.(),this._rendererFactory?.end?.();8&this.dirtyFlags&&(this.dirtyFlags&=-9,this.afterRenderManager.execute()),this.syncDirtyFlagsWithViews()}syncDirtyFlagsWithViews(){this.allViews.some(({_lView:e})=>Zh(e))?this.dirtyFlags|=2:this.dirtyFlags&=-8}attachView(e){const i=e;this._views.push(i),i.attachToAppRef(this)}detachView(e){const i=e;OD(this._views,i),i.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView),this.tick(),this.components.push(e),this._injector.get(u0,[]).forEach(r=>r(e))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(e=>e()),this._views.slice().forEach(e=>e.destroy())}finally{this._destroyed=!0,this._views=[],this._destroyListeners=[]}}onDestroy(e){return this._destroyListeners.push(e),()=>OD(this._destroyListeners,e)}destroy(){if(this._destroyed)throw new bt(406,!1);const e=this._injector;e.destroy&&!e.destroyed&&e.destroy()}get viewCount(){return this._views.length}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function OD(t,n){const e=t.indexOf(n);e>-1&&t.splice(e,1)}function $6(t,n,e,i){(e||Zh(t))&&Zb(t,n,e&&!i?0:1)}function ii(t,n,e,i){const r=xt();return ys(r,ya(),n)&&(Wn(),Rc(Vr(),r,t,n,e,i)),ii}function p0(t,n,e,i){return ys(t,ya(),e)?n+zi(e)+i:Gi}function f0(t,n,e,i,r,l){const w=Iy(t,function wo(){return xi.lFrame.bindingIndex}(),e,r);return Zl(2),w?n+zi(e)+i+zi(r)+l:Gi}function FD(t,n){return t<<17|n<<2}function ky(t){return t>>17&32767}function ek(t){return 2|t}function x0(t){return(131068&t)>>2}function tk(t,n){return-131069&t|n<<2}function nk(t){return 1|t}function AF(t,n,e,i){const r=t[e+1],l=null===n;let f=i?ky(r):x0(r),w=!1;for(;0!==f&&(!1===w||l);){const P=t[f+1];AH(t[f],n)&&(w=!0,t[f+1]=i?nk(P):ek(P)),f=i?ky(P):x0(P)}w&&(t[e+1]=i?ek(r):nk(r))}function AH(t,n){return null===t||null==n||(Array.isArray(t)?t[1]:t)===n||!(!Array.isArray(t)||"string"!=typeof n)&&Hh(t,n)>=0}const na={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function kF(t){return t.substring(na.key,na.keyEnd)}function RF(t,n){const e=na.textEnd;return e===n?-1:(n=na.keyEnd=function OH(t,n,e){for(;n<e&&t.charCodeAt(n)>32;)n++;return n}(t,na.key=n,e),w0(t,n,e))}function w0(t,n,e){for(;n<e&&t.charCodeAt(n)<=32;)n++;return n}function Xe(t,n,e){const i=xt();return ys(i,ya(),n)&&Dl(Wn(),Vr(),i,t,n,i[11],e,!1),Xe}function ik(t,n,e,i,r){Hb(n,t,e,r?"class":"style",i)}function vu(t,n,e){return xh(t,n,e,!1),vu}function Di(t,n){return xh(t,n,null,!0),Di}function Kf(t){wh(HH,kp,t,!0)}function kp(t,n){for(let e=function RH(t){return function OF(t){na.key=0,na.keyEnd=0,na.value=0,na.valueEnd=0,na.textEnd=t.length}(t),RF(t,w0(t,0,na.textEnd))}(n);e>=0;e=RF(n,e))pa(t,kF(n),!0)}function xh(t,n,e,i){const r=xt(),l=Wn(),f=Zl(2);l.firstUpdatePass&&zF(l,t,f,i),n!==Gi&&ys(r,f,n)&&VF(l,l.data[Ao()],r,r[11],t,r[f+1]=function GH(t,n){return null==t||""===t||("string"==typeof n?t+=n:"object"==typeof t&&(t=Lr(Sl(t)))),t}(n,e),i,f)}function wh(t,n,e,i){const r=Wn(),l=Zl(2);r.firstUpdatePass&&zF(r,null,l,i);const f=xt();if(e!==Gi&&ys(f,l,e)){const w=r.data[Ao()];if(jF(w,i)&&!NF(r,l)){let M=i?w.classesWithoutHost:w.stylesWithoutHost;null!==M&&(e=_c(M,e||"")),ik(r,w,f,e,i)}else!function $H(t,n,e,i,r,l,f,w){r===Gi&&(r=or);let M=0,P=0,L=0<r.length?r[0]:null,$=0<l.length?l[0]:null;for(;null!==L||null!==$;){const Q=M<r.length?r[M+1]:void 0,X=P<l.length?l[P+1]:void 0;let K,Y=null;L===$?(M+=2,P+=2,Q!==X&&(Y=$,K=X)):null===$||null!==L&&L<$?(M+=2,Y=L):(P+=2,Y=$,K=X),null!==Y&&VF(t,n,e,i,Y,K,f,w),L=M<r.length?r[M]:null,$=P<l.length?l[P]:null}}(r,w,f,f[11],f[l+1],f[l+1]=function jH(t,n,e){if(null==e||""===e)return or;const i=[],r=Sl(e);if(Array.isArray(r))for(let l=0;l<r.length;l++)t(i,r[l],!0);else if("object"==typeof r)for(const l in r)r.hasOwnProperty(l)&&t(i,l,r[l]);else"string"==typeof r&&n(i,r);return i}(t,n,e),i,l)}}function NF(t,n){return n>=t.expandoStartIndex}function zF(t,n,e,i){const r=t.data;if(null===r[e+1]){const l=r[Ao()],f=NF(t,e);jF(l,i)&&null===n&&!f&&(n=!1),n=function zH(t,n,e,i){const r=function np(t){const n=xi.lFrame.currentDirectiveIndex;return-1===n?null:t[n]}(t);let l=i?n.residualClasses:n.residualStyles;if(null===r)0===(i?n.classBindings:n.styleBindings)&&(e=L1(e=rk(null,t,n,e,i),n.attrs,i),l=null);else{const f=n.directiveStylingLast;if(-1===f||t[f]!==r)if(e=rk(r,t,n,e,i),null===l){let M=function BH(t,n,e){const i=e?n.classBindings:n.styleBindings;if(0!==x0(i))return t[ky(i)]}(t,n,i);void 0!==M&&Array.isArray(M)&&(M=rk(null,t,n,M[1],i),M=L1(M,n.attrs,i),function VH(t,n,e,i){t[ky(e?n.classBindings:n.styleBindings)]=i}(t,n,i,M))}else l=function UH(t,n,e){let i;const r=n.directiveEnd;for(let l=1+n.directiveStylingLast;l<r;l++)i=L1(i,t[l].hostAttrs,e);return L1(i,n.attrs,e)}(t,n,i)}return void 0!==l&&(i?n.residualClasses=l:n.residualStyles=l),e}(r,l,n,i),function TH(t,n,e,i,r,l){let f=l?n.classBindings:n.styleBindings,w=ky(f),M=x0(f);t[i]=e;let L,P=!1;if(Array.isArray(e)?(L=e[1],(null===L||Hh(e,L)>0)&&(P=!0)):L=e,r)if(0!==M){const Q=ky(t[w+1]);t[i+1]=FD(Q,w),0!==Q&&(t[Q+1]=tk(t[Q+1],i)),t[w+1]=function DH(t,n){return 131071&t|n<<17}(t[w+1],i)}else t[i+1]=FD(w,0),0!==w&&(t[w+1]=tk(t[w+1],i)),w=i;else t[i+1]=FD(M,0),0===w?w=i:t[M+1]=tk(t[M+1],i),M=i;P&&(t[i+1]=ek(t[i+1])),AF(t,L,i,!0),AF(t,L,i,!1),function IH(t,n,e,i,r){const l=r?t.residualClasses:t.residualStyles;null!=l&&"string"==typeof n&&Hh(l,n)>=0&&(e[i+1]=nk(e[i+1]))}(n,L,t,i,l),f=FD(w,M),l?n.classBindings=f:n.styleBindings=f}(r,l,n,e,f,i)}}function rk(t,n,e,i,r){let l=null;const f=e.directiveEnd;let w=e.directiveStylingLast;for(-1===w?w=e.directiveStart:w++;w<f&&(l=n[w],i=L1(i,l.hostAttrs,r),l!==t);)w++;return null!==t&&(e.directiveStylingLast=w),i}function L1(t,n,e){const i=e?1:2;let r=-1;if(null!==n)for(let l=0;l<n.length;l++){const f=n[l];"number"==typeof f?r=f:r===i&&(Array.isArray(t)||(t=void 0===t?[]:["",t]),pa(t,f,!!e||n[++l]))}return void 0===t?null:t}function HH(t,n,e){const i=String(n);""!==i&&!i.includes(" ")&&pa(t,i,e)}function VF(t,n,e,i,r,l,f,w){if(!(3&n.type))return;const M=t.data,P=M[w+1],L=function MH(t){return!(1&~t)}(P)?UF(M,n,e,r,x0(P),f):void 0;LD(L)||(LD(l)||function SH(t){return!(2&~t)}(P)&&(l=UF(M,null,e,r,w,f)),function WS(t,n,e,i,r){if(n)r?t.addClass(e,i):t.removeClass(e,i);else{let l=-1===i.indexOf("-")?void 0:xd.DashCase;null==r?t.removeStyle(e,i,l):("string"==typeof r&&r.endsWith("!important")&&(r=r.slice(0,-10),l|=xd.Important),t.setStyle(e,i,r,l))}}(i,f,Vt(Ao(),e),r,l))}function UF(t,n,e,i,r,l){const f=null===n;let w;for(;r>0;){const M=t[r],P=Array.isArray(M),L=P?M[1]:M,$=null===L;let Q=e[r+1];Q===Gi&&(Q=$?or:void 0);let X=$?xm(Q,i):L===i?Q:void 0;if(P&&!LD(X)&&(X=xm(M,i)),LD(X)&&(w=X,f))return w;const Y=t[r+1];r=f?ky(Y):x0(Y)}if(null!==n){let M=l?n.residualClasses:n.residualStyles;null!=M&&(w=xm(M,i))}return w}function LD(t){return void 0!==t}function jF(t,n){return!!(t.flags&(n?8:16))}class t8{destroy(n){}updateValue(n,e){}swap(n,e){const i=Math.min(n,e),r=Math.max(n,e),l=this.detach(r);if(r-i>1){const f=this.detach(i);this.attach(i,l),this.attach(r,f)}else this.attach(i,l)}move(n,e){this.attach(e,this.detach(n))}}function ok(t,n,e,i,r){return t===e&&Object.is(n,i)?1:Object.is(r(t,n),r(e,i))?-1:0}function sk(t,n,e,i){return!(void 0===n||!n.has(i)||(t.attach(e,n.get(i)),n.delete(i),0))}function $F(t,n,e,i,r){if(sk(t,n,i,e(i,r)))t.updateValue(i,r);else{const l=t.create(i,r);t.attach(i,l)}}function GF(t,n,e,i){const r=new Set;for(let l=n;l<=e;l++)r.add(i(l,t.at(l)));return r}class qF{kvMap=new Map;_vMap=void 0;has(n){return this.kvMap.has(n)}delete(n){if(!this.has(n))return!1;const e=this.kvMap.get(n);return void 0!==this._vMap&&this._vMap.has(e)?(this.kvMap.set(n,this._vMap.get(e)),this._vMap.delete(e)):this.kvMap.delete(n),!0}get(n){return this.kvMap.get(n)}set(n,e){if(this.kvMap.has(n)){let i=this.kvMap.get(n);void 0===this._vMap&&(this._vMap=new Map);const r=this._vMap;for(;r.has(i);)i=r.get(i);r.set(i,e)}else this.kvMap.set(n,e)}forEach(n){for(let[e,i]of this.kvMap)if(n(i,e),void 0!==this._vMap){const r=this._vMap;for(;r.has(i);)i=r.get(i),n(i,e)}}}function qi(t,n){Cl("NgControlFlow");const e=xt(),i=ya(),r=e[i]!==Gi?e[i]:-1,l=-1!==r?ND(e,26+r):void 0;if(ys(e,i,t)){const w=Gn(null);try{if(void 0!==l&&Uf(l,0),-1!==t){const M=26+t,P=ND(e,M),L=ak(e[1],M),$=null;Hs(P,_g(e,L,n,{dehydratedView:$}),0,zf(L,$))}}finally{Gn(w)}}else if(void 0!==l){const w=oD(l,0);void 0!==w&&(w[8]=n)}}class i8{lContainer;$implicit;$index;constructor(n,e,i){this.lContainer=n,this.$implicit=e,this.$index=i}get $count(){return this.lContainer.length-10}}function WF(t,n){return n}class o8{hasEmptyBlock;trackByFn;liveCollection;constructor(n,e,i){this.hasEmptyBlock=n,this.trackByFn=e,this.liveCollection=i}}function N1(t,n,e,i,r,l,f,w,M,P,L,$,Q){Cl("NgControlFlow");const X=xt(),Y=Wn(),K=void 0!==M,de=xt(),ye=w?f.bind(de[15][8]):f,he=new o8(K,ye);de[26+t]=he,R1(X,Y,t+1,n,e,i,r,Ua(Y.consts,l)),K&&R1(X,Y,t+2,M,P,L,$,Ua(Y.consts,Q))}class s8 extends t8{lContainer;hostLView;templateTNode;operationsCounter=void 0;needsIndexUpdate=!1;constructor(n,e,i){super(),this.lContainer=n,this.hostLView=e,this.templateTNode=i}get length(){return this.lContainer.length-10}at(n){return this.getLView(n)[8].$implicit}attach(n,e){const i=e[6];this.needsIndexUpdate||=n!==this.length,Hs(this.lContainer,e,n,zf(this.templateTNode,i))}detach(n){return this.needsIndexUpdate||=n!==this.length-1,function a8(t,n){return xy(t,n)}(this.lContainer,n)}create(n,e){const r=_g(this.hostLView,this.templateTNode,new i8(this.lContainer,e,n),{dehydratedView:null});return this.operationsCounter?.recordCreate(),r}destroy(n){gy(n[1],n),this.operationsCounter?.recordDestroy()}updateValue(n,e){this.getLView(n)[8].$implicit=e}reset(){this.needsIndexUpdate=!1,this.operationsCounter?.reset()}updateIndexes(){if(this.needsIndexUpdate)for(let n=0;n<this.length;n++)this.getLView(n)[8].$index=n}getLView(n){return function l8(t,n){return oD(t,n)}(this.lContainer,n)}}function z1(t){const n=Gn(null),e=Ao();try{const i=xt(),r=i[1],l=i[e],f=e+1,w=ND(i,f);if(void 0===l.liveCollection){const P=ak(r,f);l.liveCollection=new s8(w,i,P)}else l.liveCollection.reset();const M=l.liveCollection;if(function n8(t,n,e){let i,r,l=0,f=t.length-1;if(Array.isArray(n)){let M=n.length-1;for(;l<=f&&l<=M;){const P=t.at(l),L=n[l],$=ok(l,P,l,L,e);if(0!==$){$<0&&t.updateValue(l,L),l++;continue}const Q=t.at(f),X=n[M],Y=ok(f,Q,M,X,e);if(0!==Y){Y<0&&t.updateValue(f,X),f--,M--;continue}const K=e(l,P),de=e(f,Q),ye=e(l,L);if(Object.is(ye,de)){const he=e(M,X);Object.is(he,K)?(t.swap(l,f),t.updateValue(f,X),M--,f--):t.move(f,l),t.updateValue(l,L),l++}else if(i??=new qF,r??=GF(t,l,f,e),sk(t,i,l,ye))t.updateValue(l,L),l++,f++;else if(r.has(ye))i.set(K,t.detach(l)),f--;else{const he=t.create(l,n[l]);t.attach(l,he),l++,f++}}for(;l<=M;)$F(t,i,e,l,n[l]),l++}else if(null!=n){const M=n[Symbol.iterator]();let P=M.next();for(;!P.done&&l<=f;){const L=t.at(l),$=P.value,Q=ok(l,L,l,$,e);if(0!==Q)Q<0&&t.updateValue(l,$),l++,P=M.next();else{i??=new qF,r??=GF(t,l,f,e);const X=e(l,$);if(sk(t,i,l,X))t.updateValue(l,$),l++,f++,P=M.next();else if(r.has(X)){const Y=e(l,L);i.set(Y,t.detach(l)),f--}else t.attach(l,t.create(l,$)),l++,f++,P=M.next()}}for(;!P.done;)$F(t,i,e,t.length,P.value),P=M.next()}for(;l<=f;)t.destroy(t.detach(f--));i?.forEach(M=>{t.destroy(M)})}(M,t,l.trackByFn),M.updateIndexes(),l.hasEmptyBlock){const P=ya(),L=0===M.length;if(ys(i,P,L)){const $=e+2,Q=ND(i,$);if(L){const X=ak(r,$),Y=null;Hs(Q,_g(i,X,void 0,{dehydratedView:Y}),0,zf(X,Y))}else Uf(Q,0)}}}finally{Gn(n)}}function ND(t,n){return t[n]}function ak(t,n){return Ye(t,n)}function ae(t,n,e,i){const r=xt(),l=Wn(),f=26+t,w=r[11],M=l.firstCreatePass?C1(f,l,r,n,Lf,Yl(),e,i):l.data[f],P=YF(l,r,M,w,n,t);r[f]=P;const L=lf(M);return Is(M,!0),Ww(w,P,M),!Cp(M)&&dd()&&bg(l,r,P,M),(0===function fr(){return xi.lFrame.elementDepthCount}()||L)&&Za(P,r),function ki(){xi.lFrame.elementDepthCount++}(),L&&(hy(l,r,M),gw(l,M,r)),null!==i&&Bb(r,M),ae}function le(){let t=Zi();yf()?Ec():(t=t.parent,Is(t,!1));const n=t;(function cd(t){return xi.skipHydrationRootTNode===t})(n)&&function _l(){xi.skipHydrationRootTNode=null}(),function Nv(){xi.lFrame.elementDepthCount--}();const e=Wn();return e.firstCreatePass&&E1(e,n),null!=n.classesWithoutHost&&function x_(t){return!!(8&t.flags)}(n)&&ik(e,n,xt(),n.classesWithoutHost,!0),null!=n.stylesWithoutHost&&function w_(t){return!!(16&t.flags)}(n)&&ik(e,n,xt(),n.stylesWithoutHost,!1),le}function Wt(t,n,e,i){return ae(t,n,e,i),le(),Wt}let YF=(t,n,e,i,r,l)=>(yl(!0),Lb(i,r,function Hm(){return xi.lFrame.currentNamespace}()));function Qi(t,n,e){const i=xt(),r=Wn(),l=t+26,f=r.firstCreatePass?function u8(t,n,e,i,r){const l=n.consts,f=Ua(l,i),w=Dp(n,t,8,"ng-container",f);null!==f&&Cr(w,f,!0);const M=Ua(l,r);return Yl()&&Ki(n,e,w,M,Lf),w.mergedAttrs=bl(w.mergedAttrs,w.attrs),null!==n.queries&&n.queries.elementStart(n,w),w}(l,r,i,n,e):r.data[l];Is(f,!0);const w=ZF(r,i,f,t);return i[l]=w,dd()&&bg(r,i,w,f),Za(w,i),lf(f)&&(hy(r,i,f),gw(r,f,i)),null!=e&&Bb(i,f),Qi}function Ji(){let t=Zi();const n=Wn();return yf()?Ec():(t=t.parent,Is(t,!1)),n.firstCreatePass&&(op(n,t),Yh(t)&&n.queries.elementEnd(t)),Ji}function ia(t,n,e){return Qi(t,n,e),Ji(),ia}let ZF=(t,n,e,i)=>(yl(!0),Hw(n[11],""));function _i(){return xt()}function rc(t,n,e){const i=xt();return ys(i,ya(),n)&&Dl(Wn(),Vr(),i,t,n,i[11],e,!0),rc}const Ry=void 0;var m8=["en",[["a","p"],["AM","PM"],Ry],[["AM","PM"],Ry,Ry],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Ry,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Ry,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Ry,"{1} 'at' {0}",Ry],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function f8(t){const n=Math.floor(Math.abs(t)),e=t.toString().replace(/^[^.]*\.?/,"").length;return 1===n&&0===e?1:5}];let C0={};function oc(t){const n=function g8(t){return t.toLowerCase().replace(/_/g,"-")}(t);let e=QF(n);if(e)return e;const i=n.split("-")[0];if(e=QF(i),e)return e;if("en"===i)return m8;throw new bt(701,!1)}function QF(t){return t in C0||(C0[t]=ho.ng&&ho.ng.common&&ho.ng.common.locales&&ho.ng.common.locales[t]),C0[t]}var So=function(t){return t[t.LocaleId=0]="LocaleId",t[t.DayPeriodsFormat=1]="DayPeriodsFormat",t[t.DayPeriodsStandalone=2]="DayPeriodsStandalone",t[t.DaysFormat=3]="DaysFormat",t[t.DaysStandalone=4]="DaysStandalone",t[t.MonthsFormat=5]="MonthsFormat",t[t.MonthsStandalone=6]="MonthsStandalone",t[t.Eras=7]="Eras",t[t.FirstDayOfWeek=8]="FirstDayOfWeek",t[t.WeekendRange=9]="WeekendRange",t[t.DateFormat=10]="DateFormat",t[t.TimeFormat=11]="TimeFormat",t[t.DateTimeFormat=12]="DateTimeFormat",t[t.NumberSymbols=13]="NumberSymbols",t[t.NumberFormats=14]="NumberFormats",t[t.CurrencyCode=15]="CurrencyCode",t[t.CurrencySymbol=16]="CurrencySymbol",t[t.CurrencyName=17]="CurrencyName",t[t.Currencies=18]="Currencies",t[t.Directionality=19]="Directionality",t[t.PluralCase=20]="PluralCase",t[t.ExtraData=21]="ExtraData",t}(So||{});const zD="en-US";let JF=zD;function _L(t,n,e){return function i(r){if(r===Function)return e;by(Qs(t)?ps(t.index,n):n,5);const f=n[8];let w=yL(n,f,e,r),M=i.__ngNextListenerFn__;for(;M;)w=yL(n,f,M,r)&&w,M=M.__ngNextListenerFn__;return w}}function yL(t,n,e,i){const r=Gn(null);try{return!1!==e(i)}catch(l){return function r$(t,n){const e=t[9],i=e?e.get(Xi,null):null;i&&i.handleError(n)}(t,l),!1}finally{Gn(r)}}function vL(t,n,e,i,r,l){const w=n[1],L=n[e][w.data[e].outputs[i]],$=w.firstCreatePass?tu(w):null,Q=Qh(n),X=L.subscribe(l),Y=Q.length;Q.push(l,X),$&&$.push(r,t.index,Y,-(Y+1))}function Tt(t,n,e,i){const r=xt(),l=Wn(),f=Zi();return dk(l,r,r[11],f,t,n,i),Tt}function dk(t,n,e,i,r,l,f){const w=lf(i),P=t.firstCreatePass?tu(t):null,L=Qh(n);let $=!0;if(3&i.type||f){const Q=Bo(i,n),X=f?f(Q):Q,Y=L.length,K=f?ye=>f(tr(ye[i.index])):i.index;let de=null;if(!f&&w&&(de=function o$(t,n,e,i){const r=t.cleanup;if(null!=r)for(let l=0;l<r.length-1;l+=2){const f=r[l];if(f===e&&r[l+1]===i){const w=n[7],M=r[l+2];return w.length>M?w[M]:null}"string"==typeof f&&(l+=2)}return null}(t,n,r,i.index)),null!==de)(de.__ngLastListenerFn__||de).__ngNextListenerFn__=l,de.__ngLastListenerFn__=l,$=!1;else{l=_L(i,n,l);const ye=e.listen(X,r,l);L.push(l,ye),P&&P.push(r,K,Y,Y+1)}}else l=_L(i,n,l);if($){const Q=i.outputs?.[r],X=i.hostDirectiveOutputs?.[r];if(X&&X.length)for(let Y=0;Y<X.length;Y+=2)vL(i,n,X[Y],X[Y+1],r,l);if(Q&&Q.length)for(const Y of Q)vL(i,n,Y,r,r,l)}}function Lt(t=1){return function va(t){return(xi.lFrame.contextLView=function Lv(t,n){for(;t>0;)n=n[14],t--;return n}(t,xi.lFrame.contextLView))[8]}(t)}function s$(t,n){let e=null;const i=function Uw(t){const n=t.attrs;if(null!=n){const e=n.indexOf(5);if(!(1&e))return n[e+1]}return null}(t);for(let r=0;r<n.length;r++){const l=n[r];if("*"!==l){if(null===i?mh(t,l,!0):Ob(i,l))return r}else e=r}return e}function os(t){const n=xt()[15][5];if(!n.projection){const i=n.projection=function vm(t,n){const e=[];for(let i=0;i<t;i++)e.push(n);return e}(t?t.length:1,null),r=i.slice();let l=n.child;for(;null!==l;){if(128!==l.type){const f=t?s$(l,t):0;null!==f&&(r[f]?r[f].projectionNext=l:i[f]=l,r[f]=l)}l=l.next}}}function Fi(t,n=0,e,i,r,l){const f=xt(),w=Wn(),M=i?t+1:null;null!==M&&R1(f,w,M,i,r,l,null,e);const P=Dp(w,26+t,16,null,e||null);null===P.projection&&(P.projection=n),Ec();const $=!f[6]||gl();null===f[15][5].projection[P.projection]&&null!==M?function a$(t,n,e){const i=26+e,r=n.data[i],l=t[i];Hs(l,_g(t,r,void 0,{dehydratedView:null}),0,zf(r,null))}(f,w,M):$&&!Cp(P)&&function GS(t,n,e){r1(n[11],0,n,e,n1(t,e,n),jS(e.parent||n[5],e,n))}(w,f,P)}function uk(t,n,e){return hk(t,"",n,"",e),uk}function hk(t,n,e,i,r){const l=xt(),f=p0(l,n,e,i);return f!==Gi&&Dl(Wn(),Vr(),l,t,f,l[11],r,!1),hk}function ro(t,n,e,i){wO(t,n,e,i)}function kr(t,n,e){!function xO(t,n,e){const i=Wn();return i.firstCreatePass&&(CO(i,new yO(t,n,e),-1),!(2&~n)&&(i.staticViewQueries=!0)),bO(i,xt(),n)}(t,n,e)}function Zn(t){const n=xt(),e=Wn(),i=bf();ip(i+1);const r=RA(e,i);if(t.dirty&&function p_(t){return!(4&~t[2])}(n)===!(2&~r.metadata.flags)){if(null===r.matches)t.reset([]);else{const l=EO(n,i);t.reset(l,vr),t.notifyOnChanges()}return!0}return!1}function Xn(){return kA(xt(),bf())}function kL(t,n,e,i,r){!function TO(t,n){const e=t[Kn];e._lView=xt(),e._queryIndex=n,e._queryList=kA(e._lView,n),e._queryList.onDirty(()=>e._dirtyCounter.update(i=>i+1))}(n,wO(t,e,i,r))}function pk(t,n,e,i){e>=t.data.length&&(t.data[e]=null,t.blueprint[e]=null),n[e]=i}function Ed(t){return eu(function Nm(){return xi.lFrame.contextLView}(),26+t)}function Re(t,n=""){const e=xt(),i=Wn(),r=t+26,l=i.firstCreatePass?Dp(i,r,1,n,null):i.data[r],f=jL(i,e,l,n,t);e[r]=f,dd()&&bg(i,e,f,l),Is(l,!1)}let jL=(t,n,e,i,r)=>(yl(!0),function jw(t,n){return t.createText(n)}(n[11],i));function er(t){return Ci("",t,""),er}function Ci(t,n,e){const i=xt(),r=p0(i,t,n,e);return r!==Gi&&Qf(i,Ao(),r),Ci}function Py(t,n,e,i,r){const l=xt(),f=f0(l,t,n,e,i,r);return f!==Gi&&Qf(l,Ao(),f),Py}function Qf(t,n,e){const i=Vt(n,t);!function RS(t,n,e){t.setValue(n,e)}(t[11],i,e)}function Oy(t,n,e){js(n)&&(n=n());const i=xt();return ys(i,ya(),n)&&Dl(Wn(),Vr(),i,t,n,i[11],e,!1),Oy}function E0(t,n){const e=js(t);return e&&t.set(n),e}function Fy(t,n){const e=xt(),i=Wn(),r=Zi();return dk(i,e,e[11],r,t,n),Fy}const XL={};function fk(t){const n=Wn(),e=xt(),i=t+26;return Is(Dp(n,i,128,null,null),!1),pk(n,e,i,XL),fk}function mk(t,n,e,i,r){if(t=vi(t),Array.isArray(t))for(let l=0;l<t.length;l++)mk(t[l],n,e,i,r);else{const l=Wn(),f=xt(),w=Zi();let M=xc(t)?t:vi(t.provide);const P=Mm(t),L=1048575&w.providerIndexes,$=w.directiveStart,Q=w.providerIndexes>>20;if(xc(t)||!t.multi){const X=new sp(P,r,ft),Y=_k(M,n,r?L:L+Q,$);-1===Y?(Mf(Us(w,f),l,M),gk(l,t,n.length),n.push(M),w.directiveStart++,w.directiveEnd++,r&&(w.providerIndexes+=1048576),e.push(X),f.push(X)):(e[Y]=X,f[Y]=X)}else{const X=_k(M,n,L+Q,$),Y=_k(M,n,L,L+Q),de=Y>=0&&e[Y];if(r&&!de||!r&&!(X>=0&&e[X])){Mf(Us(w,f),l,M);const ye=function D$(t,n,e,i,r){const l=new sp(t,e,ft);return l.multi=[],l.index=n,l.componentProviders=0,KL(l,r,i&&!e),l}(r?S$:E$,e.length,r,i,P);!r&&de&&(e[Y].providerFactory=ye),gk(l,t,n.length,0),n.push(M),w.directiveStart++,w.directiveEnd++,r&&(w.providerIndexes+=1048576),e.push(ye),f.push(ye)}else gk(l,t,X>-1?X:Y,KL(e[r?Y:X],P,!r&&i));!r&&i&&de&&e[Y].componentProviders++}}}function gk(t,n,e,i){const r=xc(n),l=function rf(t){return!!t.useClass}(n);if(r||l){const M=(l?vi(n.useClass):n).prototype.ngOnDestroy;if(M){const P=t.destroyHooks||(t.destroyHooks=[]);if(!r&&n.multi){const L=P.indexOf(e);-1===L?P.push(e,[i,M]):P[L+1].push(i,M)}else P.push(e,M)}}}function KL(t,n,e){return e&&t.componentProviders++,t.multi.push(n)-1}function _k(t,n,e,i){for(let r=e;r<i;r++)if(n[r]===t)return r;return-1}function E$(t,n,e,i){return yk(this.multi,[])}function S$(t,n,e,i){const r=this.multi;let l;if(this.providerFactory){const f=this.providerFactory.componentProviders,w=Co(e,e[1],this.providerFactory.index,i);l=w.slice(0,f),yk(r,l);for(let M=f;M<w.length;M++)l.push(w[M])}else l=[],yk(r,l);return l}function yk(t,n){for(let e=0;e<t.length;e++)n.push((0,t[e])());return n}function pi(t,n=[]){return e=>{e.providersResolver=(i,r)=>function C$(t,n,e){const i=Wn();if(i.firstCreatePass){const r=ma(t);mk(e,i.data,i.blueprint,r,!0),mk(n,i.data,i.blueprint,r,!1)}}(i,r?r(t):t,n)}}function HD(t,n,e){const i=fs()+t,r=xt();return r[i]===Gi?Ip(r,i,e?n.call(e):n()):k1(r,i)}function vk(t,n,e,i,r,l,f){return function iN(t,n,e,i,r,l,f,w,M){const P=n+e;return yu(t,P,r,l,f,w)?Ip(t,P+4,M?i.call(M,r,l,f,w):i(r,l,f,w)):$1(t,P+4)}(xt(),fs(),t,n,e,i,r,l,f)}function bk(t,n,e,i,r,l,f,w){const M=fs()+t,P=xt(),L=yu(P,M,e,i,r,l);return ys(P,M+4,f)||L?Ip(P,M+5,w?n.call(w,e,i,r,l,f):n(e,i,r,l,f)):k1(P,M+5)}function $1(t,n){const e=t[n];return e===Gi?void 0:e}function tN(t,n,e,i,r,l,f){const w=n+e;return Iy(t,w,r,l)?Ip(t,w+2,f?i.call(f,r,l):i(r,l)):$1(t,w+2)}function Jf(t,n){const e=Wn();let i;const r=t+26;e.firstCreatePass?(i=function L$(t,n){if(n)for(let e=n.length-1;e>=0;e--){const i=n[e];if(t===i.name)return i}}(n,e.pipeRegistry),e.data[r]=i,i.onDestroy&&(e.destroyHooks??=[]).push(r,i.onDestroy)):i=e.data[r];const l=i.factory||(i.factory=bc(i.type)),w=Ds(ft);try{const M=ts(!1),P=l();return ts(M),pk(e,xt(),r,P),P}finally{Ds(w)}}function $D(t,n,e){const i=t+26,r=xt(),l=eu(r,i);return G1(r,i)?function eN(t,n,e,i,r,l){const f=n+e;return ys(t,f,r)?Ip(t,f+1,l?i.call(l,r):i(r)):$1(t,f+1)}(r,fs(),n,l.transform,e,l):l.transform(e)}function S0(t,n,e,i){const r=t+26,l=xt(),f=eu(l,r);return G1(l,r)?tN(l,fs(),n,f.transform,e,i,f):f.transform(e,i)}function G1(t,n){return t[1].data[n].pure}function q1(t,n){return Xr(t,n)}class Y1{full;major;minor;patch;constructor(n){this.full=n;const e=n.split(".");this.major=e[0],this.minor=e[1],this.patch=e.slice(2).join(".")}}const wN=new Y1("19.2.8");class hG{ngModuleFactory;componentFactories;constructor(n,e){this.ngModuleFactory=n,this.componentFactories=e}}let pG=(()=>{class t{compileModuleSync(e){return new LA(e)}compileModuleAsync(e){return Promise.resolve(this.compileModuleSync(e))}compileModuleAndAllComponentsSync(e){const i=this.compileModuleSync(e),l=ec(Ms(e).declarations).reduce((f,w)=>{const M=bi(w);return M&&f.push(new Wf(M)),f},[]);return new hG(i,l)}compileModuleAndAllComponentsAsync(e){return Promise.resolve(this.compileModuleAndAllComponentsSync(e))}clearCache(){}clearCacheFor(e){}getModuleId(e){}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),gG=(()=>{class t{zone=te(wt);changeDetectionScheduler=te(ot);applicationRef=te(ic);_onMicrotaskEmptySubscription;initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function Sk({ngZoneFactory:t,ignoreChangesOutsideZone:n,scheduleInRootZone:e}){return t??=()=>new wt({...Dk(),scheduleInRootZone:e}),[{provide:wt,useFactory:t},{provide:dl,multi:!0,useFactory:()=>{const i=te(gG,{optional:!0});return()=>i.initialize()}},{provide:dl,multi:!0,useFactory:()=>{const i=te(yG);return()=>{i.initialize()}}},!0===n?{provide:He,useValue:!0}:[],{provide:st,useValue:e??ke}]}function Dk(t){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:t?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:t?.runCoalescing??!1}}let yG=(()=>{class t{subscription=new Mi;initialized=!1;zone=te(wt);pendingTasks=te(Be);initialize(){if(this.initialized)return;this.initialized=!0;let e=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(e=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{wt.assertNotInAngularZone(),queueMicrotask(()=>{null!==e&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(e),e=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{wt.assertInAngularZone(),e??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),Z1=(()=>{class t{appRef=te(ic);taskService=te(Be);ngZone=te(wt);zonelessEnabled=te(lt);tracing=te(Jm,{optional:!0});disableScheduling=te(He,{optional:!0})??!1;zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run;schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}];subscriptions=new Mi;angularZoneId=this.zoneIsDefined?this.ngZone._inner?.get(en):null;scheduleInRootZone=!this.zonelessEnabled&&this.zoneIsDefined&&(te(st,{optional:!0})??!1);cancelScheduledCallback=null;useMicrotaskScheduler=!1;runningTick=!1;pendingRenderTaskId=null;constructor(){this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof An||!this.zoneIsDefined)}notify(e){if(!this.zonelessEnabled&&5===e)return;let i=!1;switch(e){case 0:this.appRef.dirtyFlags|=2;break;case 3:case 2:case 4:case 5:case 1:this.appRef.dirtyFlags|=4;break;case 6:case 13:this.appRef.dirtyFlags|=2,i=!0;break;case 12:this.appRef.dirtyFlags|=16,i=!0;break;case 11:i=!0;break;default:this.appRef.dirtyFlags|=8}if(this.appRef.tracingSnapshot=this.tracing?.snapshot(this.appRef.tracingSnapshot)??null,!this.shouldScheduleTick(i))return;const r=this.useMicrotaskScheduler?Ft:dt;this.pendingRenderTaskId=this.taskService.add(),this.cancelScheduledCallback=this.scheduleInRootZone?Zone.root.run(()=>r(()=>this.tick())):this.ngZone.runOutsideAngular(()=>r(()=>this.tick()))}shouldScheduleTick(e){return!(this.disableScheduling&&!e||this.appRef.destroyed||null!==this.pendingRenderTaskId||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Zone.current.get(en+this.angularZoneId))}tick(){if(this.runningTick||this.appRef.destroyed)return;if(0===this.appRef.dirtyFlags)return void this.cleanup();!this.zonelessEnabled&&7&this.appRef.dirtyFlags&&(this.appRef.dirtyFlags|=1);const e=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick()},void 0,this.schedulerTickApplyArgs)}catch(i){throw this.taskService.remove(e),i}finally{this.cleanup()}this.useMicrotaskScheduler=!0,Ft(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(e)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,null!==this.pendingRenderTaskId){const e=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(e)}}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();const em=new _t("",{providedIn:"root",factory:()=>te(em,rr.Optional|rr.SkipSelf)||function vG(){return typeof $localize<"u"&&$localize.locale||zD}()}),WD=new _t(""),SG=new _t("");function X1(t){return!t.moduleRef}let Tg=null;let Do=(()=>class t{static __NG_ELEMENT_ID__=kG})();function kG(t){return function RG(t,n,e){if(Qs(t)&&!e){const i=ps(t.index,n);return new wy(i,i)}return 175&t.type?new wy(n[15],n):null}(Zi(),xt(),!(16&~t))}class LN{constructor(){}supports(n){return TD(n)}create(n){return new NG(n)}}const LG=(t,n)=>n;class NG{length=0;collection;_linkedRecords=null;_unlinkedRecords=null;_previousItHead=null;_itHead=null;_itTail=null;_additionsHead=null;_additionsTail=null;_movesHead=null;_movesTail=null;_removalsHead=null;_removalsTail=null;_identityChangesHead=null;_identityChangesTail=null;_trackByFn;constructor(n){this._trackByFn=n||LG}forEachItem(n){let e;for(e=this._itHead;null!==e;e=e._next)n(e)}forEachOperation(n){let e=this._itHead,i=this._removalsHead,r=0,l=null;for(;e||i;){const f=!i||e&&e.currentIndex<zN(i,r,l)?e:i,w=zN(f,r,l),M=f.currentIndex;if(f===i)r--,i=i._nextRemoved;else if(e=e._next,null==f.previousIndex)r++;else{l||(l=[]);const P=w-r,L=M-r;if(P!=L){for(let Q=0;Q<P;Q++){const X=Q<l.length?l[Q]:l[Q]=0,Y=X+Q;L<=Y&&Y<P&&(l[Q]=X+1)}l[f.previousIndex]=L-P}}w!==M&&n(f,w,M)}}forEachPreviousItem(n){let e;for(e=this._previousItHead;null!==e;e=e._nextPrevious)n(e)}forEachAddedItem(n){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)n(e)}forEachMovedItem(n){let e;for(e=this._movesHead;null!==e;e=e._nextMoved)n(e)}forEachRemovedItem(n){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)n(e)}forEachIdentityChange(n){let e;for(e=this._identityChangesHead;null!==e;e=e._nextIdentityChange)n(e)}diff(n){if(null==n&&(n=[]),!TD(n))throw new bt(900,!1);return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let r,l,f,e=this._itHead,i=!1;if(Array.isArray(n)){this.length=n.length;for(let w=0;w<this.length;w++)l=n[w],f=this._trackByFn(w,l),null!==e&&Object.is(e.trackById,f)?(i&&(e=this._verifyReinsertion(e,l,f,w)),Object.is(e.item,l)||this._addIdentityChange(e,l)):(e=this._mismatch(e,l,f,w),i=!0),e=e._next}else r=0,function Vj(t,n){if(Array.isArray(t))for(let e=0;e<t.length;e++)n(t[e]);else{const e=t[Symbol.iterator]();let i;for(;!(i=e.next()).done;)n(i.value)}}(n,w=>{f=this._trackByFn(r,w),null!==e&&Object.is(e.trackById,f)?(i&&(e=this._verifyReinsertion(e,w,f,r)),Object.is(e.item,w)||this._addIdentityChange(e,w)):(e=this._mismatch(e,w,f,r),i=!0),e=e._next,r++}),this.length=r;return this._truncate(e),this.collection=n,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let n;for(n=this._previousItHead=this._itHead;null!==n;n=n._next)n._nextPrevious=n._next;for(n=this._additionsHead;null!==n;n=n._nextAdded)n.previousIndex=n.currentIndex;for(this._additionsHead=this._additionsTail=null,n=this._movesHead;null!==n;n=n._nextMoved)n.previousIndex=n.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(n,e,i,r){let l;return null===n?l=this._itTail:(l=n._prev,this._remove(n)),null!==(n=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null))?(Object.is(n.item,e)||this._addIdentityChange(n,e),this._reinsertAfter(n,l,r)):null!==(n=null===this._linkedRecords?null:this._linkedRecords.get(i,r))?(Object.is(n.item,e)||this._addIdentityChange(n,e),this._moveAfter(n,l,r)):n=this._addAfter(new zG(e,i),l,r),n}_verifyReinsertion(n,e,i,r){let l=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null);return null!==l?n=this._reinsertAfter(l,n._prev,r):n.currentIndex!=r&&(n.currentIndex=r,this._addToMoves(n,r)),n}_truncate(n){for(;null!==n;){const e=n._next;this._addToRemovals(this._unlink(n)),n=e}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(n,e,i){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(n);const r=n._prevRemoved,l=n._nextRemoved;return null===r?this._removalsHead=l:r._nextRemoved=l,null===l?this._removalsTail=r:l._prevRemoved=r,this._insertAfter(n,e,i),this._addToMoves(n,i),n}_moveAfter(n,e,i){return this._unlink(n),this._insertAfter(n,e,i),this._addToMoves(n,i),n}_addAfter(n,e,i){return this._insertAfter(n,e,i),this._additionsTail=null===this._additionsTail?this._additionsHead=n:this._additionsTail._nextAdded=n,n}_insertAfter(n,e,i){const r=null===e?this._itHead:e._next;return n._next=r,n._prev=e,null===r?this._itTail=n:r._prev=n,null===e?this._itHead=n:e._next=n,null===this._linkedRecords&&(this._linkedRecords=new NN),this._linkedRecords.put(n),n.currentIndex=i,n}_remove(n){return this._addToRemovals(this._unlink(n))}_unlink(n){null!==this._linkedRecords&&this._linkedRecords.remove(n);const e=n._prev,i=n._next;return null===e?this._itHead=i:e._next=i,null===i?this._itTail=e:i._prev=e,n}_addToMoves(n,e){return n.previousIndex===e||(this._movesTail=null===this._movesTail?this._movesHead=n:this._movesTail._nextMoved=n),n}_addToRemovals(n){return null===this._unlinkedRecords&&(this._unlinkedRecords=new NN),this._unlinkedRecords.put(n),n.currentIndex=null,n._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=n,n._prevRemoved=null):(n._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=n),n}_addIdentityChange(n,e){return n.item=e,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=n:this._identityChangesTail._nextIdentityChange=n,n}}class zG{item;trackById;currentIndex=null;previousIndex=null;_nextPrevious=null;_prev=null;_next=null;_prevDup=null;_nextDup=null;_prevRemoved=null;_nextRemoved=null;_nextAdded=null;_nextMoved=null;_nextIdentityChange=null;constructor(n,e){this.item=n,this.trackById=e}}class BG{_head=null;_tail=null;add(n){null===this._head?(this._head=this._tail=n,n._nextDup=null,n._prevDup=null):(this._tail._nextDup=n,n._prevDup=this._tail,n._nextDup=null,this._tail=n)}get(n,e){let i;for(i=this._head;null!==i;i=i._nextDup)if((null===e||e<=i.currentIndex)&&Object.is(i.trackById,n))return i;return null}remove(n){const e=n._prevDup,i=n._nextDup;return null===e?this._head=i:e._nextDup=i,null===i?this._tail=e:i._prevDup=e,null===this._head}}class NN{map=new Map;put(n){const e=n.trackById;let i=this.map.get(e);i||(i=new BG,this.map.set(e,i)),i.add(n)}get(n,e){const r=this.map.get(n);return r?r.get(n,e):null}remove(n){const e=n.trackById;return this.map.get(e).remove(n)&&this.map.delete(e),n}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function zN(t,n,e){const i=t.previousIndex;if(null===i)return i;let r=0;return e&&i<e.length&&(r=e[i]),i+n+r}function VN(){return new Ig([new LN])}let Ig=(()=>{class t{factories;static \u0275prov=Nt({token:t,providedIn:"root",factory:VN});constructor(e){this.factories=e}static create(e,i){if(null!=i){const r=i.factories.slice();e=e.concat(r)}return new t(e)}static extend(e){return{provide:t,useFactory:i=>t.create(e,i||VN()),deps:[[t,new no,new La]]}}find(e){const i=this.factories.find(r=>r.supports(e));if(null!=i)return i;throw new bt(901,!1)}}return t})();function $G(t){try{const{rootComponent:n,appProviders:e,platformProviders:i}=t,r=function AG(t=[]){if(Tg)return Tg;const n=function AN(t=[],n){return we.create({name:n,providers:[{provide:hl,useValue:"platform"},{provide:WD,useValue:new Set([()=>Tg=null])},...t]})}(t);return Tg=n,function uF(){!function Fh(t){$n=t}(()=>{throw new bt(600,!1)})}(),function kN(t){const n=t.get(Yv,null);Bs(t,()=>{n?.forEach(e=>e())})}(n),n}(i),l=[Sk({}),{provide:ot,useExisting:Z1},...e||[]];return function MN(t){const n=X1(t)?t.r3Injector:t.moduleRef.injector,e=n.get(wt);return e.run(()=>{X1(t)?t.r3Injector.resolveInjectorInitializers():t.moduleRef.resolveInjectorInitializers();const i=n.get(Xi,null);let r;if(e.runOutsideAngular(()=>{r=e.onError.subscribe({next:l=>{i.handleError(l)}})}),X1(t)){const l=()=>n.destroy(),f=t.platformInjector.get(WD);f.add(l),n.onDestroy(()=>{r.unsubscribe(),f.delete(l)})}else{const l=()=>t.moduleRef.destroy(),f=t.platformInjector.get(WD);f.add(l),t.moduleRef.onDestroy(()=>{OD(t.allPlatformModules,t.moduleRef),r.unsubscribe(),f.delete(l)})}return function MG(t,n,e){try{const i=e();return O1(i)?i.catch(r=>{throw n.runOutsideAngular(()=>t.handleError(r)),r}):i}catch(i){throw n.runOutsideAngular(()=>t.handleError(i)),i}}(i,e,()=>{const l=n.get(dF);return l.runInitializers(),l.donePromise.then(()=>{if(function b8(t){"string"==typeof t&&(JF=t.toLowerCase().replace(/_/g,"-"))}(n.get(em,zD)||zD),!n.get(SG,!0))return X1(t)?n.get(ic):(t.allPlatformModules.push(t.moduleRef),t.moduleRef);if(X1(t)){const M=n.get(ic);return void 0!==t.rootComponent&&M.bootstrap(t.rootComponent),M}return function DG(t,n){const e=t.injector.get(ic);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(i=>e.bootstrap(i));else{if(!t.instance.ngDoBootstrap)throw new bt(-403,!1);t.instance.ngDoBootstrap(e)}n.push(t)}(t.moduleRef,t.allPlatformModules),t.moduleRef})})})}({r3Injector:new NO({providers:l,parent:r,debugName:"",runEnvironmentInitializers:!1}).injector,platformInjector:r,rootComponent:n})}catch(n){return Promise.reject(n)}}function Un(t){return"boolean"==typeof t?t:null!=t&&"false"!==t}function bu(t,n=NaN){return isNaN(parseFloat(t))||isNaN(Number(t))?n:Number(t)}function Ps(t){return function Po(t){const n=Gn(null);try{return t()}finally{Gn(n)}}(t)}function Sd(t,n){return il(t,n?.equal)}class gq{[Kn];constructor(n){this[Kn]=n}destroy(){this[Kn].destroy()}}function tM(t,n){!n?.injector&&us();const e=n?.injector??te(we);let r,i=!0!==n?.manualCleanup?e.get(Oe):null;const l=e.get(O_,null,{optional:!0}),f=e.get(ot);return null===l||n?.forceRoot?r=function bq(t,n,e){const i=Object.create(_q);return i.fn=t,i.scheduler=n,i.notifier=e,i.zone=typeof Zone<"u"?Zone.current:null,i.scheduler.schedule(i),i.notifier.notify(12),i}(t,e.get(ZA),f):(r=function vq(t,n,e){const i=Object.create(yq);return i.view=t,i.zone=typeof Zone<"u"?Zone.current:null,i.notifier=n,i.fn=e,t[23]??=new Set,t[23].add(i),i.consumerMarkedDirty(i),i}(l.view,f,t),i instanceof et&&i._lView===l.view&&(i=null)),r.injector=e,null!==i&&(r.onDestroyFn=i.onDestroy(()=>r.destroy())),new gq(r)}const t3={...ri,consumerIsAlwaysLive:!0,consumerAllowSignalWrites:!0,dirty:!0,hasRun:!1,cleanupFns:void 0,zone:null,kind:"effect",onDestroyFn:Je,run(){if(this.dirty=!1,this.hasRun&&!pc(this))return;this.hasRun=!0;const t=i=>(this.cleanupFns??=[]).push(i),n=Sn(this),e=nh(!1);try{this.maybeCleanup(),this.fn(t)}finally{nh(e),Aa(this,n)}},maybeCleanup(){if(this.cleanupFns?.length)try{for(;this.cleanupFns.length;)this.cleanupFns.pop()()}finally{this.cleanupFns=[]}}},_q={...t3,consumerMarkedDirty(){this.scheduler.schedule(this),this.notifier.notify(12)},destroy(){On(this),this.onDestroyFn(),this.maybeCleanup(),this.scheduler.remove(this)}},yq={...t3,consumerMarkedDirty(){this.view[2]|=8192,ja(this.view),this.notifier.notify(13)},destroy(){On(this),this.onDestroyFn(),this.maybeCleanup(),this.view[23]?.delete(this)}};function s3(t,n){const e=bi(t),i=n.elementInjector||rd();return new Wf(e).create(i,n.projectableNodes,n.hostElement,n.environmentInjector)}const mr=new _t("");let a3=null;function Ag(){return a3}class Oq{}let Fk=(()=>{class t{historyGo(e){throw new Error("")}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:()=>te(Lq),providedIn:"platform"})}return t})();const Fq=new _t("");let Lq=(()=>{class t extends Fk{_location;_history;_doc=te(mr);constructor(){super(),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Ag().getBaseHref(this._doc)}onPopState(e){const i=Ag().getGlobalEventTarget(this._doc,"window");return i.addEventListener("popstate",e,!1),()=>i.removeEventListener("popstate",e)}onHashChange(e){const i=Ag().getGlobalEventTarget(this._doc,"window");return i.addEventListener("hashchange",e,!1),()=>i.removeEventListener("hashchange",e)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(e){this._location.pathname=e}pushState(e,i,r){this._history.pushState(e,i,r)}replaceState(e,i,r){this._history.replaceState(e,i,r)}forward(){this._history.forward()}back(){this._history.back()}historyGo(e=0){this._history.go(e)}getState(){return this._history.state}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:()=>new t,providedIn:"platform"})}return t})();function Lk(t,n){return t?n?t.endsWith("/")?n.startsWith("/")?t+n.slice(1):t+n:n.startsWith("/")?t+n:`${t}/${n}`:t:n}function l3(t){const n=t.search(/#|\?|$/);return"/"===t[n-1]?t.slice(0,n-1)+t.slice(n):t}function tm(t){return t&&"?"!==t[0]?`?${t}`:t}let Ny=(()=>{class t{historyGo(e){throw new Error("")}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:()=>te(d3),providedIn:"root"})}return t})();const c3=new _t("");let d3=(()=>{class t extends Ny{_platformLocation;_baseHref;_removeListenerFns=[];constructor(e,i){super(),this._platformLocation=e,this._baseHref=i??this._platformLocation.getBaseHrefFromDOM()??te(mr).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}prepareExternalUrl(e){return Lk(this._baseHref,e)}path(e=!1){const i=this._platformLocation.pathname+tm(this._platformLocation.search),r=this._platformLocation.hash;return r&&e?`${i}${r}`:i}pushState(e,i,r,l){const f=this.prepareExternalUrl(r+tm(l));this._platformLocation.pushState(e,i,f)}replaceState(e,i,r,l){const f=this.prepareExternalUrl(r+tm(l));this._platformLocation.replaceState(e,i,f)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){this._platformLocation.historyGo?.(e)}static \u0275fac=function(i){return new(i||t)(gn(Fk),gn(c3,8))};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),M0=(()=>{class t{_subject=new Et;_basePath;_locationStrategy;_urlChangeListeners=[];_urlChangeSubscription=null;constructor(e){this._locationStrategy=e;const i=this._locationStrategy.getBaseHref();this._basePath=function Bq(t){if(new RegExp("^(https?:)?//").test(t)){const[,e]=t.split(/\/\/[^\/]+/);return e}return t}(l3(u3(i))),this._locationStrategy.onPopState(r=>{this._subject.next({url:this.path(!0),pop:!0,state:r.state,type:r.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(e=!1){return this.normalize(this._locationStrategy.path(e))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(e,i=""){return this.path()==this.normalize(e+tm(i))}normalize(e){return t.stripTrailingSlash(function zq(t,n){if(!t||!n.startsWith(t))return n;const e=n.substring(t.length);return""===e||["/",";","?","#"].includes(e[0])?e:n}(this._basePath,u3(e)))}prepareExternalUrl(e){return e&&"/"!==e[0]&&(e="/"+e),this._locationStrategy.prepareExternalUrl(e)}go(e,i="",r=null){this._locationStrategy.pushState(r,"",e,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+tm(i)),r)}replaceState(e,i="",r=null){this._locationStrategy.replaceState(r,"",e,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+tm(i)),r)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(e=0){this._locationStrategy.historyGo?.(e)}onUrlChange(e){return this._urlChangeListeners.push(e),this._urlChangeSubscription??=this.subscribe(i=>{this._notifyUrlChangeListeners(i.url,i.state)}),()=>{const i=this._urlChangeListeners.indexOf(e);this._urlChangeListeners.splice(i,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(e="",i){this._urlChangeListeners.forEach(r=>r(e,i))}subscribe(e,i,r){return this._subject.subscribe({next:e,error:i??void 0,complete:r??void 0})}static normalizeQueryParams=tm;static joinWithSlash=Lk;static stripTrailingSlash=l3;static \u0275fac=function(i){return new(i||t)(gn(Ny))};static \u0275prov=Nt({token:t,factory:()=>function Nq(){return new M0(gn(Ny))}(),providedIn:"root"})}return t})();function u3(t){return t.replace(/\/index.html$/,"")}function h3(t,n){n=encodeURIComponent(n);for(const e of t.split(";")){const i=e.indexOf("="),[r,l]=-1==i?[e,""]:[e.slice(0,i),e.slice(i+1)];if(r.trim()===n)return decodeURIComponent(l)}return null}const p3="browser";function Rp(t){return t===p3}function f3(t){return"server"===t}class m3{}const Nk=new _t("");let g3=(()=>{class t{_zone;_plugins;_eventNameToPlugin=new Map;constructor(e,i){this._zone=i,e.forEach(r=>{r.manager=this}),this._plugins=e.slice().reverse()}addEventListener(e,i,r,l){return this._findPluginFor(i).addEventListener(e,i,r,l)}getZone(){return this._zone}_findPluginFor(e){let i=this._eventNameToPlugin.get(e);if(i)return i;if(i=this._plugins.find(l=>l.supports(e)),!i)throw new bt(5101,!1);return this._eventNameToPlugin.set(e,i),i}static \u0275fac=function(i){return new(i||t)(gn(Nk),gn(wt))};static \u0275prov=Nt({token:t,factory:t.\u0275fac})}return t})();class _3{_doc;constructor(n){this._doc=n}manager}const nM="ng-app-id";function y3(t){for(const n of t)n.remove()}function v3(t,n){const e=n.createElement("style");return e.textContent=t,e}function zk(t,n){const e=n.createElement("link");return e.setAttribute("rel","stylesheet"),e.setAttribute("href",t),e}let b3=(()=>{class t{doc;appId;nonce;inline=new Map;external=new Map;hosts=new Set;isServer;constructor(e,i,r,l={}){this.doc=e,this.appId=i,this.nonce=r,this.isServer=f3(l),function Uq(t,n,e,i){const r=t.head?.querySelectorAll(`style[${nM}="${n}"],link[${nM}="${n}"]`);if(r)for(const l of r)l.removeAttribute(nM),l instanceof HTMLLinkElement?i.set(l.href.slice(l.href.lastIndexOf("/")+1),{usage:0,elements:[l]}):l.textContent&&e.set(l.textContent,{usage:0,elements:[l]})}(e,i,this.inline,this.external),this.hosts.add(e.head)}addStyles(e,i){for(const r of e)this.addUsage(r,this.inline,v3);i?.forEach(r=>this.addUsage(r,this.external,zk))}removeStyles(e,i){for(const r of e)this.removeUsage(r,this.inline);i?.forEach(r=>this.removeUsage(r,this.external))}addUsage(e,i,r){const l=i.get(e);l?l.usage++:i.set(e,{usage:1,elements:[...this.hosts].map(f=>this.addElement(f,r(e,this.doc)))})}removeUsage(e,i){const r=i.get(e);r&&(r.usage--,r.usage<=0&&(y3(r.elements),i.delete(e)))}ngOnDestroy(){for(const[,{elements:e}]of[...this.inline,...this.external])y3(e);this.hosts.clear()}addHost(e){this.hosts.add(e);for(const[i,{elements:r}]of this.inline)r.push(this.addElement(e,v3(i,this.doc)));for(const[i,{elements:r}]of this.external)r.push(this.addElement(e,zk(i,this.doc)))}removeHost(e){this.hosts.delete(e)}addElement(e,i){return this.nonce&&i.setAttribute("nonce",this.nonce),this.isServer&&i.setAttribute(nM,this.appId),e.appendChild(i)}static \u0275fac=function(i){return new(i||t)(gn(mr),gn(gd),gn(Zv,8),gn(cu))};static \u0275prov=Nt({token:t,factory:t.\u0275fac})}return t})();const Bk={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},Vk=/%COMP%/g,Wq=new _t("",{providedIn:"root",factory:()=>!0});function w3(t,n){return n.map(e=>e.replace(Vk,t))}let C3=(()=>{class t{eventManager;sharedStylesHost;appId;removeStylesOnCompDestroy;doc;platformId;ngZone;nonce;tracingService;rendererByCompId=new Map;defaultRenderer;platformIsServer;constructor(e,i,r,l,f,w,M,P=null,L=null){this.eventManager=e,this.sharedStylesHost=i,this.appId=r,this.removeStylesOnCompDestroy=l,this.doc=f,this.platformId=w,this.ngZone=M,this.nonce=P,this.tracingService=L,this.platformIsServer=f3(w),this.defaultRenderer=new Uk(e,f,M,this.platformIsServer,this.tracingService)}createRenderer(e,i){if(!e||!i)return this.defaultRenderer;this.platformIsServer&&i.encapsulation===Jl.ShadowDom&&(i={...i,encapsulation:Jl.Emulated});const r=this.getOrCreateRenderer(e,i);return r instanceof S3?r.applyToHost(e):r instanceof jk&&r.applyStyles(),r}getOrCreateRenderer(e,i){const r=this.rendererByCompId;let l=r.get(i.id);if(!l){const f=this.doc,w=this.ngZone,M=this.eventManager,P=this.sharedStylesHost,L=this.removeStylesOnCompDestroy,$=this.platformIsServer,Q=this.tracingService;switch(i.encapsulation){case Jl.Emulated:l=new S3(M,P,i,this.appId,L,f,w,$,Q);break;case Jl.ShadowDom:return new Kq(M,P,e,i,f,w,this.nonce,$,Q);default:l=new jk(M,P,i,L,f,w,$,Q)}r.set(i.id,l)}return l}ngOnDestroy(){this.rendererByCompId.clear()}componentReplaced(e){this.rendererByCompId.delete(e)}static \u0275fac=function(i){return new(i||t)(gn(g3),gn(b3),gn(gd),gn(Wq),gn(mr),gn(cu),gn(wt),gn(Zv),gn(Jm,8))};static \u0275prov=Nt({token:t,factory:t.\u0275fac})}return t})();class Uk{eventManager;doc;ngZone;platformIsServer;tracingService;data=Object.create(null);throwOnSyntheticProps=!0;constructor(n,e,i,r,l){this.eventManager=n,this.doc=e,this.ngZone=i,this.platformIsServer=r,this.tracingService=l}destroy(){}destroyNode=null;createElement(n,e){return e?this.doc.createElementNS(Bk[e]||e,n):this.doc.createElement(n)}createComment(n){return this.doc.createComment(n)}createText(n){return this.doc.createTextNode(n)}appendChild(n,e){(E3(n)?n.content:n).appendChild(e)}insertBefore(n,e,i){n&&(E3(n)?n.content:n).insertBefore(e,i)}removeChild(n,e){e.remove()}selectRootElement(n,e){let i="string"==typeof n?this.doc.querySelector(n):n;if(!i)throw new bt(-5104,!1);return e||(i.textContent=""),i}parentNode(n){return n.parentNode}nextSibling(n){return n.nextSibling}setAttribute(n,e,i,r){if(r){e=r+":"+e;const l=Bk[r];l?n.setAttributeNS(l,e,i):n.setAttribute(e,i)}else n.setAttribute(e,i)}removeAttribute(n,e,i){if(i){const r=Bk[i];r?n.removeAttributeNS(r,e):n.removeAttribute(`${i}:${e}`)}else n.removeAttribute(e)}addClass(n,e){n.classList.add(e)}removeClass(n,e){n.classList.remove(e)}setStyle(n,e,i,r){r&(xd.DashCase|xd.Important)?n.style.setProperty(e,i,r&xd.Important?"important":""):n.style[e]=i}removeStyle(n,e,i){i&xd.DashCase?n.style.removeProperty(e):n.style[e]=""}setProperty(n,e,i){null!=n&&(n[e]=i)}setValue(n,e){n.nodeValue=e}listen(n,e,i,r){if("string"==typeof n&&!(n=Ag().getGlobalEventTarget(this.doc,n)))throw new bt(5102,!1);let l=this.decoratePreventDefault(i);return this.tracingService?.wrapEventListener&&(l=this.tracingService.wrapEventListener(n,e,l)),this.eventManager.addEventListener(n,e,l,r)}decoratePreventDefault(n){return e=>{if("__ngUnwrap__"===e)return n;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>n(e)):n(e))&&e.preventDefault()}}}function E3(t){return"TEMPLATE"===t.tagName&&void 0!==t.content}class Kq extends Uk{sharedStylesHost;hostEl;shadowRoot;constructor(n,e,i,r,l,f,w,M,P){super(n,l,f,M,P),this.sharedStylesHost=e,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let L=r.styles;L=w3(r.id,L);for(const Q of L){const X=document.createElement("style");w&&X.setAttribute("nonce",w),X.textContent=Q,this.shadowRoot.appendChild(X)}const $=r.getExternalStyles?.();if($)for(const Q of $){const X=zk(Q,l);w&&X.setAttribute("nonce",w),this.shadowRoot.appendChild(X)}}nodeOrShadowRoot(n){return n===this.hostEl?this.shadowRoot:n}appendChild(n,e){return super.appendChild(this.nodeOrShadowRoot(n),e)}insertBefore(n,e,i){return super.insertBefore(this.nodeOrShadowRoot(n),e,i)}removeChild(n,e){return super.removeChild(null,e)}parentNode(n){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(n)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class jk extends Uk{sharedStylesHost;removeStylesOnCompDestroy;styles;styleUrls;constructor(n,e,i,r,l,f,w,M,P){super(n,l,f,w,M),this.sharedStylesHost=e,this.removeStylesOnCompDestroy=r;let L=i.styles;this.styles=P?w3(P,L):L,this.styleUrls=i.getExternalStyles?.(P)}applyStyles(){this.sharedStylesHost.addStyles(this.styles,this.styleUrls)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles,this.styleUrls)}}class S3 extends jk{contentAttr;hostAttr;constructor(n,e,i,r,l,f,w,M,P){const L=r+"-"+i.id;super(n,e,i,l,f,w,M,P,L),this.contentAttr=function Yq(t){return"_ngcontent-%COMP%".replace(Vk,t)}(L),this.hostAttr=function Zq(t){return"_nghost-%COMP%".replace(Vk,t)}(L)}applyToHost(n){this.applyStyles(),this.setAttribute(n,this.hostAttr,"")}createElement(n,e){const i=super.createElement(n,e);return super.setAttribute(i,this.contentAttr,""),i}}class Hk extends Oq{supportsDOMEvents=!0;static makeCurrent(){!function Pq(t){a3??=t}(new Hk)}onAndCancel(n,e,i,r){return n.addEventListener(e,i,r),()=>{n.removeEventListener(e,i,r)}}dispatchEvent(n,e){n.dispatchEvent(e)}remove(n){n.remove()}createElement(n,e){return(e=e||this.getDefaultDocument()).createElement(n)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(n){return n.nodeType===Node.ELEMENT_NODE}isShadowRoot(n){return n instanceof DocumentFragment}getGlobalEventTarget(n,e){return"window"===e?window:"document"===e?n:"body"===e?n.body:null}getBaseHref(n){const e=function Qq(){return Q1=Q1||document.querySelector("base"),Q1?Q1.getAttribute("href"):null}();return null==e?null:function Jq(t){return new URL(t,document.baseURI).pathname}(e)}resetBaseElement(){Q1=null}getUserAgent(){return window.navigator.userAgent}getCookie(n){return h3(document.cookie,n)}}let Q1=null,tW=(()=>{class t{build(){return new XMLHttpRequest}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:t.\u0275fac})}return t})();const D3=["alt","control","meta","shift"],iW={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},rW={alt:t=>t.altKey,control:t=>t.ctrlKey,meta:t=>t.metaKey,shift:t=>t.shiftKey};function M3(t){return{appProviders:[...hW,...t?.providers??[]],platformProviders:dW}}const dW=[{provide:cu,useValue:p3},{provide:Yv,useValue:function aW(){Hk.makeCurrent()},multi:!0},{provide:mr,useFactory:function cW(){return function NE(t){Px=t}(document),document}}],hW=[{provide:hl,useValue:"root"},{provide:Xi,useFactory:function lW(){return new Xi}},{provide:Nk,useClass:(()=>{class t extends _3{constructor(e){super(e)}supports(e){return!0}addEventListener(e,i,r,l){return e.addEventListener(i,r,l),()=>this.removeEventListener(e,i,r,l)}removeEventListener(e,i,r,l){return e.removeEventListener(i,r,l)}static \u0275fac=function(i){return new(i||t)(gn(mr))};static \u0275prov=Nt({token:t,factory:t.\u0275fac})}return t})(),multi:!0,deps:[mr]},{provide:Nk,useClass:(()=>{class t extends _3{constructor(e){super(e)}supports(e){return null!=t.parseEventName(e)}addEventListener(e,i,r,l){const f=t.parseEventName(i),w=t.eventCallback(f.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Ag().onAndCancel(e,f.domEventName,w,l))}static parseEventName(e){const i=e.toLowerCase().split("."),r=i.shift();if(0===i.length||"keydown"!==r&&"keyup"!==r)return null;const l=t._normalizeKey(i.pop());let f="",w=i.indexOf("code");if(w>-1&&(i.splice(w,1),f="code."),D3.forEach(P=>{const L=i.indexOf(P);L>-1&&(i.splice(L,1),f+=P+".")}),f+=l,0!=i.length||0===l.length)return null;const M={};return M.domEventName=r,M.fullKey=f,M}static matchEventFullKeyCode(e,i){let r=iW[e.key]||e.key,l="";return i.indexOf("code.")>-1&&(r=e.code,l="code."),!(null==r||!r)&&(r=r.toLowerCase()," "===r?r="space":"."===r&&(r="dot"),D3.forEach(f=>{f!==r&&(0,rW[f])(e)&&(l+=f+".")}),l+=r,l===i)}static eventCallback(e,i,r){return l=>{t.matchEventFullKeyCode(l,e)&&r.runGuarded(()=>i(l))}}static _normalizeKey(e){return"esc"===e?"escape":e}static \u0275fac=function(i){return new(i||t)(gn(mr))};static \u0275prov=Nt({token:t,factory:t.\u0275fac})}return t})(),multi:!0,deps:[mr]},C3,b3,g3,{provide:gt,useExisting:C3},{provide:m3,useClass:tW},[]];let pW=(()=>{class t extends Ny{_platformLocation;_baseHref="";_removeListenerFns=[];constructor(e,i){super(),this._platformLocation=e,null!=i&&(this._baseHref=i)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}path(e=!1){const i=this._platformLocation.hash??"#";return i.length>0?i.substring(1):i}prepareExternalUrl(e){const i=Lk(this._baseHref,e);return i.length>0?"#"+i:i}pushState(e,i,r,l){const f=this.prepareExternalUrl(r+tm(l))||this._platformLocation.pathname;this._platformLocation.pushState(e,i,f)}replaceState(e,i,r,l){const f=this.prepareExternalUrl(r+tm(l))||this._platformLocation.pathname;this._platformLocation.replaceState(e,i,f)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){this._platformLocation.historyGo?.(e)}static \u0275fac=function(i){return new(i||t)(gn(Fk),gn(c3,8))};static \u0275prov=Nt({token:t,factory:t.\u0275fac})}return t})();var ac=function(t){return t[t.Format=0]="Format",t[t.Standalone=1]="Standalone",t}(ac||{}),vo=function(t){return t[t.Narrow=0]="Narrow",t[t.Abbreviated=1]="Abbreviated",t[t.Wide=2]="Wide",t[t.Short=3]="Short",t}(vo||{}),Dd=function(t){return t[t.Short=0]="Short",t[t.Medium=1]="Medium",t[t.Long=2]="Long",t[t.Full=3]="Full",t}(Dd||{});function rM(t,n){return wu(oc(t)[So.DateFormat],n)}function oM(t,n){return wu(oc(t)[So.TimeFormat],n)}function sM(t,n){return wu(oc(t)[So.DateTimeFormat],n)}function xu(t,n){const e=oc(t),i=e[So.NumberSymbols][n];if(typeof i>"u"){if(12===n)return e[So.NumberSymbols][0];if(13===n)return e[So.NumberSymbols][1]}return i}function I3(t){if(!t[So.ExtraData])throw new Error(`Missing extra locale data for the locale "${t[So.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function wu(t,n){for(let e=n;e>-1;e--)if(typeof t[e]<"u")return t[e];throw new Error("Locale data API: locale data undefined")}function Gk(t){const[n,e]=t.split(":");return{hours:+n,minutes:+e}}const MW=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,aM={},TW=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;function IW(t,n,e,i){let r=function zW(t){if(R3(t))return t;if("number"==typeof t&&!isNaN(t))return new Date(t);if("string"==typeof t){if(t=t.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(t)){const[r,l=1,f=1]=t.split("-").map(w=>+w);return lM(r,l-1,f)}const e=parseFloat(t);if(!isNaN(t-e))return new Date(e);let i;if(i=t.match(MW))return function BW(t){const n=new Date(0);let e=0,i=0;const r=t[8]?n.setUTCFullYear:n.setFullYear,l=t[8]?n.setUTCHours:n.setHours;t[9]&&(e=Number(t[9]+t[10]),i=Number(t[9]+t[11])),r.call(n,Number(t[1]),Number(t[2])-1,Number(t[3]));const f=Number(t[4]||0)-e,w=Number(t[5]||0)-i,M=Number(t[6]||0),P=Math.floor(1e3*parseFloat("0."+(t[7]||0)));return l.call(n,f,w,M,P),n}(i)}const n=new Date(t);if(!R3(n))throw new Error(`Unable to convert "${t}" into a date`);return n}(t);n=nm(e,n)||n;let w,f=[];for(;n;){if(w=TW.exec(n),!w){f.push(n);break}{f=f.concat(w.slice(1));const L=f.pop();if(!L)break;n=L}}let M=r.getTimezoneOffset();i&&(M=k3(i,M),r=function NW(t,n){const r=t.getTimezoneOffset();return function LW(t,n){return(t=new Date(t.getTime())).setMinutes(t.getMinutes()+n),t}(t,-1*(k3(n,r)-r))}(r,i));let P="";return f.forEach(L=>{const $=function FW(t){if(Wk[t])return Wk[t];let n;switch(t){case"G":case"GG":case"GGG":n=Mo(3,vo.Abbreviated);break;case"GGGG":n=Mo(3,vo.Wide);break;case"GGGGG":n=Mo(3,vo.Narrow);break;case"y":n=Gs(0,1,0,!1,!0);break;case"yy":n=Gs(0,2,0,!0,!0);break;case"yyy":n=Gs(0,3,0,!1,!0);break;case"yyyy":n=Gs(0,4,0,!1,!0);break;case"Y":n=hM(1);break;case"YY":n=hM(2,!0);break;case"YYY":n=hM(3);break;case"YYYY":n=hM(4);break;case"M":case"L":n=Gs(1,1,1);break;case"MM":case"LL":n=Gs(1,2,1);break;case"MMM":n=Mo(2,vo.Abbreviated);break;case"MMMM":n=Mo(2,vo.Wide);break;case"MMMMM":n=Mo(2,vo.Narrow);break;case"LLL":n=Mo(2,vo.Abbreviated,ac.Standalone);break;case"LLLL":n=Mo(2,vo.Wide,ac.Standalone);break;case"LLLLL":n=Mo(2,vo.Narrow,ac.Standalone);break;case"w":n=qk(1);break;case"ww":n=qk(2);break;case"W":n=qk(1,!0);break;case"d":n=Gs(2,1);break;case"dd":n=Gs(2,2);break;case"c":case"cc":n=Gs(7,1);break;case"ccc":n=Mo(1,vo.Abbreviated,ac.Standalone);break;case"cccc":n=Mo(1,vo.Wide,ac.Standalone);break;case"ccccc":n=Mo(1,vo.Narrow,ac.Standalone);break;case"cccccc":n=Mo(1,vo.Short,ac.Standalone);break;case"E":case"EE":case"EEE":n=Mo(1,vo.Abbreviated);break;case"EEEE":n=Mo(1,vo.Wide);break;case"EEEEE":n=Mo(1,vo.Narrow);break;case"EEEEEE":n=Mo(1,vo.Short);break;case"a":case"aa":case"aaa":n=Mo(0,vo.Abbreviated);break;case"aaaa":n=Mo(0,vo.Wide);break;case"aaaaa":n=Mo(0,vo.Narrow);break;case"b":case"bb":case"bbb":n=Mo(0,vo.Abbreviated,ac.Standalone,!0);break;case"bbbb":n=Mo(0,vo.Wide,ac.Standalone,!0);break;case"bbbbb":n=Mo(0,vo.Narrow,ac.Standalone,!0);break;case"B":case"BB":case"BBB":n=Mo(0,vo.Abbreviated,ac.Format,!0);break;case"BBBB":n=Mo(0,vo.Wide,ac.Format,!0);break;case"BBBBB":n=Mo(0,vo.Narrow,ac.Format,!0);break;case"h":n=Gs(3,1,-12);break;case"hh":n=Gs(3,2,-12);break;case"H":n=Gs(3,1);break;case"HH":n=Gs(3,2);break;case"m":n=Gs(4,1);break;case"mm":n=Gs(4,2);break;case"s":n=Gs(5,1);break;case"ss":n=Gs(5,2);break;case"S":n=Gs(6,1);break;case"SS":n=Gs(6,2);break;case"SSS":n=Gs(6,3);break;case"Z":case"ZZ":case"ZZZ":n=dM(0);break;case"ZZZZZ":n=dM(3);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":n=dM(1);break;case"OOOO":case"ZZZZ":case"zzzz":n=dM(2);break;default:return null}return Wk[t]=n,n}(L);P+=$?$(r,e,M):"''"===L?"'":L.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),P}function lM(t,n,e){const i=new Date(0);return i.setFullYear(t,n,e),i.setHours(0,0,0),i}function nm(t,n){const e=function mW(t){return oc(t)[So.LocaleId]}(t);if(aM[e]??={},aM[e][n])return aM[e][n];let i="";switch(n){case"shortDate":i=rM(t,Dd.Short);break;case"mediumDate":i=rM(t,Dd.Medium);break;case"longDate":i=rM(t,Dd.Long);break;case"fullDate":i=rM(t,Dd.Full);break;case"shortTime":i=oM(t,Dd.Short);break;case"mediumTime":i=oM(t,Dd.Medium);break;case"longTime":i=oM(t,Dd.Long);break;case"fullTime":i=oM(t,Dd.Full);break;case"short":const r=nm(t,"shortTime"),l=nm(t,"shortDate");i=cM(sM(t,Dd.Short),[r,l]);break;case"medium":const f=nm(t,"mediumTime"),w=nm(t,"mediumDate");i=cM(sM(t,Dd.Medium),[f,w]);break;case"long":const M=nm(t,"longTime"),P=nm(t,"longDate");i=cM(sM(t,Dd.Long),[M,P]);break;case"full":const L=nm(t,"fullTime"),$=nm(t,"fullDate");i=cM(sM(t,Dd.Full),[L,$])}return i&&(aM[e][n]=i),i}function cM(t,n){return n&&(t=t.replace(/\{([^}]+)}/g,function(e,i){return null!=n&&i in n?n[i]:e})),t}function Ch(t,n,e="-",i,r){let l="";(t<0||r&&t<=0)&&(r?t=1-t:(t=-t,l=e));let f=String(t);for(;f.length<n;)f="0"+f;return i&&(f=f.slice(f.length-n)),l+f}function Gs(t,n,e=0,i=!1,r=!1){return function(l,f){let w=function kW(t,n){switch(t){case 0:return n.getFullYear();case 1:return n.getMonth();case 2:return n.getDate();case 3:return n.getHours();case 4:return n.getMinutes();case 5:return n.getSeconds();case 6:return n.getMilliseconds();case 7:return n.getDay();default:throw new Error(`Unknown DateType value "${t}".`)}}(t,l);if((e>0||w>-e)&&(w+=e),3===t)0===w&&-12===e&&(w=12);else if(6===t)return function AW(t,n){return Ch(t,3).substring(0,n)}(w,n);const M=xu(f,5);return Ch(w,n,M,i,r)}}function Mo(t,n,e=ac.Format,i=!1){return function(r,l){return function RW(t,n,e,i,r,l){switch(e){case 2:return function yW(t,n,e){const i=oc(t),l=wu([i[So.MonthsFormat],i[So.MonthsStandalone]],n);return wu(l,e)}(n,r,i)[t.getMonth()];case 1:return function _W(t,n,e){const i=oc(t),l=wu([i[So.DaysFormat],i[So.DaysStandalone]],n);return wu(l,e)}(n,r,i)[t.getDay()];case 0:const f=t.getHours(),w=t.getMinutes();if(l){const P=function wW(t){const n=oc(t);return I3(n),(n[So.ExtraData][2]||[]).map(i=>"string"==typeof i?Gk(i):[Gk(i[0]),Gk(i[1])])}(n),L=function CW(t,n,e){const i=oc(t);I3(i);const l=wu([i[So.ExtraData][0],i[So.ExtraData][1]],n)||[];return wu(l,e)||[]}(n,r,i),$=P.findIndex(Q=>{if(Array.isArray(Q)){const[X,Y]=Q,K=f>=X.hours&&w>=X.minutes,de=f<Y.hours||f===Y.hours&&w<Y.minutes;if(X.hours<Y.hours){if(K&&de)return!0}else if(K||de)return!0}else if(Q.hours===f&&Q.minutes===w)return!0;return!1});if(-1!==$)return L[$]}return function gW(t,n,e){const i=oc(t),l=wu([i[So.DayPeriodsFormat],i[So.DayPeriodsStandalone]],n);return wu(l,e)}(n,r,i)[f<12?0:1];case 3:return function vW(t,n){return wu(oc(t)[So.Eras],n)}(n,i)[t.getFullYear()<=0?0:1];default:throw new Error(`unexpected translation type ${e}`)}}(r,l,t,n,e,i)}}function dM(t){return function(n,e,i){const r=-1*i,l=xu(e,5),f=r>0?Math.floor(r/60):Math.ceil(r/60);switch(t){case 0:return(r>=0?"+":"")+Ch(f,2,l)+Ch(Math.abs(r%60),2,l);case 1:return"GMT"+(r>=0?"+":"")+Ch(f,1,l);case 2:return"GMT"+(r>=0?"+":"")+Ch(f,2,l)+":"+Ch(Math.abs(r%60),2,l);case 3:return 0===i?"Z":(r>=0?"+":"")+Ch(f,2,l)+":"+Ch(Math.abs(r%60),2,l);default:throw new Error(`Unknown zone width "${t}"`)}}}const PW=0,uM=4;function A3(t){const n=t.getDay(),e=0===n?-3:uM-n;return lM(t.getFullYear(),t.getMonth(),t.getDate()+e)}function qk(t,n=!1){return function(e,i){let r;if(n){const l=new Date(e.getFullYear(),e.getMonth(),1).getDay()-1,f=e.getDate();r=1+Math.floor((f+l)/7)}else{const l=A3(e),f=function OW(t){const n=lM(t,PW,1).getDay();return lM(t,0,1+(n<=uM?uM:uM+7)-n)}(l.getFullYear()),w=l.getTime()-f.getTime();r=1+Math.round(w/6048e5)}return Ch(r,t,xu(i,5))}}function hM(t,n=!1){return function(e,i){return Ch(A3(e).getFullYear(),t,xu(i,5),n)}}const Wk={};function k3(t,n){t=t.replace(/:/g,"");const e=Date.parse("Jan 01, 1970 00:00:00 "+t)/6e4;return isNaN(e)?n:e}function R3(t){return t instanceof Date&&!isNaN(t.valueOf())}const Jk=/\s+/,L3=[];let im=(()=>{class t{_ngEl;_renderer;initialClasses=L3;rawClass;stateMap=new Map;constructor(e,i){this._ngEl=e,this._renderer=i}set klass(e){this.initialClasses=null!=e?e.trim().split(Jk):L3}set ngClass(e){this.rawClass="string"==typeof e?e.trim().split(Jk):e}ngDoCheck(){for(const i of this.initialClasses)this._updateState(i,!0);const e=this.rawClass;if(Array.isArray(e)||e instanceof Set)for(const i of e)this._updateState(i,!0);else if(null!=e)for(const i of Object.keys(e))this._updateState(i,!!e[i]);this._applyStateDiff()}_updateState(e,i){const r=this.stateMap.get(e);void 0!==r?(r.enabled!==i&&(r.changed=!0,r.enabled=i),r.touched=!0):this.stateMap.set(e,{enabled:i,changed:!0,touched:!0})}_applyStateDiff(){for(const e of this.stateMap){const i=e[0],r=e[1];r.changed?(this._toggleClass(i,r.enabled),r.changed=!1):r.touched||(r.enabled&&this._toggleClass(i,!1),this.stateMap.delete(i)),r.touched=!1}}_toggleClass(e,i){(e=e.trim()).length>0&&e.split(Jk).forEach(r=>{i?this._renderer.addClass(this._ngEl.nativeElement,r):this._renderer.removeClass(this._ngEl.nativeElement,r)})}static \u0275fac=function(i){return new(i||t)(ft(Dn),ft(yt))};static \u0275dir=Ht({type:t,selectors:[["","ngClass",""]],inputs:{klass:[0,"class","klass"],ngClass:"ngClass"}})}return t})();class QW{$implicit;ngForOf;index;count;constructor(n,e,i,r){this.$implicit=n,this.ngForOf=e,this.index=i,this.count=r}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let kg=(()=>{class t{_viewContainer;_template;_differs;set ngForOf(e){this._ngForOf=e,this._ngForOfDirty=!0}set ngForTrackBy(e){this._trackByFn=e}get ngForTrackBy(){return this._trackByFn}_ngForOf=null;_ngForOfDirty=!0;_differ=null;_trackByFn;constructor(e,i,r){this._viewContainer=e,this._template=i,this._differs=r}set ngForTemplate(e){e&&(this._template=e)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const e=this._ngForOf;!this._differ&&e&&(this._differ=this._differs.find(e).create(this.ngForTrackBy))}if(this._differ){const e=this._differ.diff(this._ngForOf);e&&this._applyChanges(e)}}_applyChanges(e){const i=this._viewContainer;e.forEachOperation((r,l,f)=>{if(null==r.previousIndex)i.createEmbeddedView(this._template,new QW(r.item,this._ngForOf,-1,-1),null===f?void 0:f);else if(null==f)i.remove(null===l?void 0:l);else if(null!==l){const w=i.get(l);i.move(w,f),z3(w,r)}});for(let r=0,l=i.length;r<l;r++){const w=i.get(r).context;w.index=r,w.count=l,w.ngForOf=this._ngForOf}e.forEachIdentityChange(r=>{z3(i.get(r.currentIndex),r)})}static ngTemplateContextGuard(e,i){return!0}static \u0275fac=function(i){return new(i||t)(ft(io),ft(is),ft(Ig))};static \u0275dir=Ht({type:t,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}})}return t})();function z3(t,n){t.context.$implicit=n.item}let Os=(()=>{class t{_viewContainer;_context=new JW;_thenTemplateRef=null;_elseTemplateRef=null;_thenViewRef=null;_elseViewRef=null;constructor(e,i){this._viewContainer=e,this._thenTemplateRef=i}set ngIf(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}set ngIfThen(e){B3(e),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}set ngIfElse(e){B3(e),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngIfUseIfTypeGuard;static ngTemplateGuard_ngIf;static ngTemplateContextGuard(e,i){return!0}static \u0275fac=function(i){return new(i||t)(ft(io),ft(is))};static \u0275dir=Ht({type:t,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}})}return t})();class JW{$implicit=null;ngIf=null}function B3(t,n){if(t&&!t.createEmbeddedView)throw new bt(2020,!1)}let n2=(()=>{class t{_viewContainerRef;_viewRef=null;ngTemplateOutletContext=null;ngTemplateOutlet=null;ngTemplateOutletInjector=null;constructor(e){this._viewContainerRef=e}ngOnChanges(e){if(this._shouldRecreateView(e)){const i=this._viewContainerRef;if(this._viewRef&&i.remove(i.indexOf(this._viewRef)),!this.ngTemplateOutlet)return void(this._viewRef=null);const r=this._createContextForwardProxy();this._viewRef=i.createEmbeddedView(this.ngTemplateOutlet,r,{injector:this.ngTemplateOutletInjector??void 0})}}_shouldRecreateView(e){return!!e.ngTemplateOutlet||!!e.ngTemplateOutletInjector}_createContextForwardProxy(){return new Proxy({},{set:(e,i,r)=>!!this.ngTemplateOutletContext&&Reflect.set(this.ngTemplateOutletContext,i,r),get:(e,i,r)=>{if(this.ngTemplateOutletContext)return Reflect.get(this.ngTemplateOutletContext,i,r)}})}static \u0275fac=function(i){return new(i||t)(ft(io))};static \u0275dir=Ht({type:t,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet",ngTemplateOutletInjector:"ngTemplateOutletInjector"},features:[Mr]})}return t})();function Eh(t,n){return new bt(2100,!1)}class r9{createSubscription(n,e){return Ps(()=>n.subscribe({next:e,error:i=>{throw i}}))}dispose(n){Ps(()=>n.unsubscribe())}}class o9{createSubscription(n,e){return n.then(e,i=>{throw i})}dispose(n){}}const s9=new o9,a9=new r9;let i2=(()=>{class t{_ref;_latestValue=null;markForCheckOnValueUpdate=!0;_subscription=null;_obj=null;_strategy=null;constructor(e){this._ref=e}ngOnDestroy(){this._subscription&&this._dispose(),this._ref=null}transform(e){if(!this._obj){if(e)try{this.markForCheckOnValueUpdate=!1,this._subscribe(e)}finally{this.markForCheckOnValueUpdate=!0}return this._latestValue}return e!==this._obj?(this._dispose(),this.transform(e)):this._latestValue}_subscribe(e){this._obj=e,this._strategy=this._selectStrategy(e),this._subscription=this._strategy.createSubscription(e,i=>this._updateLatestValue(e,i))}_selectStrategy(e){if(O1(e))return s9;if(aF(e))return a9;throw Eh()}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(e,i){e===this._obj&&(this._latestValue=i,this.markForCheckOnValueUpdate&&this._ref?.markForCheck())}static \u0275fac=function(i){return new(i||t)(ft(Do,16))};static \u0275pipe=Oc({name:"async",type:t,pure:!1})}return t})();const p9=new _t(""),f9=new _t("");let I0=(()=>{class t{locale;defaultTimezone;defaultOptions;constructor(e,i,r){this.locale=e,this.defaultTimezone=i,this.defaultOptions=r}transform(e,i,r,l){if(null==e||""===e||e!=e)return null;try{return IW(e,i??this.defaultOptions?.dateFormat??"mediumDate",l||this.locale,r??this.defaultOptions?.timezone??this.defaultTimezone??void 0)}catch(f){throw Eh()}}static \u0275fac=function(i){return new(i||t)(ft(em,16),ft(p9,24),ft(f9,24))};static \u0275pipe=Oc({name:"date",type:t,pure:!0})}return t})(),Ea=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275mod=Er({type:t});static \u0275inj=Ai({})}return t})(),E9=(()=>{class t{static \u0275prov=Nt({token:t,providedIn:"root",factory:()=>new S9(te(mr),window)})}return t})();class S9{document;window;offset=()=>[0,0];constructor(n,e){this.document=n,this.window=e}setOffset(n){this.offset=Array.isArray(n)?()=>n:n}getScrollPosition(){return[this.window.scrollX,this.window.scrollY]}scrollToPosition(n){this.window.scrollTo(n[0],n[1])}scrollToAnchor(n){const e=function D9(t,n){const e=t.getElementById(n)||t.getElementsByName(n)[0];if(e)return e;if("function"==typeof t.createTreeWalker&&t.body&&"function"==typeof t.body.attachShadow){const i=t.createTreeWalker(t.body,NodeFilter.SHOW_ELEMENT);let r=i.currentNode;for(;r;){const l=r.shadowRoot;if(l){const f=l.getElementById(n)||l.querySelector(`[name="${n}"]`);if(f)return f}r=i.nextNode()}}return null}(this.document,n);e&&(this.scrollToElement(e),e.focus())}setHistoryScrollRestoration(n){this.window.history.scrollRestoration=n}scrollToElement(n){const e=n.getBoundingClientRect(),i=e.left+this.window.pageXOffset,r=e.top+this.window.pageYOffset,l=this.offset();this.window.scrollTo(i-l[0],r-l[1])}}function iC(t){return!!t&&(t instanceof Qe||Dr(t.lift)&&Dr(t.subscribe))}function Rg(t){return this instanceof Rg?(this.v=t,this):new Rg(t)}function tz(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t=function h2(t){var n="function"==typeof Symbol&&Symbol.iterator,e=n&&t[n],i=0;if(e)return e.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}(t),e={},i("next"),i("throw"),i("return"),e[Symbol.asyncIterator]=function(){return this},e);function i(l){e[l]=t[l]&&function(f){return new Promise(function(w,M){!function r(l,f,w,M){Promise.resolve(M).then(function(P){l({value:P,done:w})},f)}(w,M,(f=t[l](f)).done,f.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const nz=t=>t&&"number"==typeof t.length&&"function"!=typeof t;function iz(t){return Dr(t?.then)}function rz(t){return Dr(t[Ne])}function oz(t){return Symbol.asyncIterator&&Dr(t?.[Symbol.asyncIterator])}function sz(t){return new TypeError(`You provided ${null!==t&&"object"==typeof t?"an invalid object":`'${t}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const az=function D7(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function lz(t){return Dr(t?.[az])}function cz(t){return function ez(t,n,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=e.apply(t,n||[]),l=[];return r=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),w("next"),w("throw"),w("return",function f(X){return function(Y){return Promise.resolve(Y).then(X,$)}}),r[Symbol.asyncIterator]=function(){return this},r;function w(X,Y){i[X]&&(r[X]=function(K){return new Promise(function(de,ye){l.push([X,K,de,ye])>1||M(X,K)})},Y&&(r[X]=Y(r[X])))}function M(X,Y){try{!function P(X){X.value instanceof Rg?Promise.resolve(X.value.v).then(L,$):Q(l[0][2],X)}(i[X](Y))}catch(K){Q(l[0][3],K)}}function L(X){M("next",X)}function $(X){M("throw",X)}function Q(X,Y){X(Y),l.shift(),l.length&&M(l[0][0],l[0][1])}}(this,arguments,function*(){const e=t.getReader();try{for(;;){const{value:i,done:r}=yield Rg(e.read());if(r)return yield Rg(void 0);yield yield Rg(i)}}finally{e.releaseLock()}})}function dz(t){return Dr(t?.getReader)}function Lc(t){if(t instanceof Qe)return t;if(null!=t){if(rz(t))return function M7(t){return new Qe(n=>{const e=t[Ne]();if(Dr(e.subscribe))return e.subscribe(n);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(t);if(nz(t))return function T7(t){return new Qe(n=>{for(let e=0;e<t.length&&!n.closed;e++)n.next(t[e]);n.complete()})}(t);if(iz(t))return function I7(t){return new Qe(n=>{t.then(e=>{n.closed||(n.next(e),n.complete())},e=>n.error(e)).then(null,Au)})}(t);if(oz(t))return uz(t);if(lz(t))return function A7(t){return new Qe(n=>{for(const e of t)if(n.next(e),n.closed)return;n.complete()})}(t);if(dz(t))return function k7(t){return uz(cz(t))}(t)}throw sz(t)}function uz(t){return new Qe(n=>{(function R7(t,n){var e,i,r,l;return function Q3(t,n,e,i){return new(e||(e=Promise))(function(l,f){function w(L){try{P(i.next(L))}catch($){f($)}}function M(L){try{P(i.throw(L))}catch($){f($)}}function P(L){L.done?l(L.value):function r(l){return l instanceof e?l:new e(function(f){f(l)})}(L.value).then(w,M)}P((i=i.apply(t,n||[])).next())})}(this,void 0,void 0,function*(){try{for(e=tz(t);!(i=yield e.next()).done;)if(n.next(i.value),n.closed)return}catch(f){r={error:f}}finally{try{i&&!i.done&&(l=e.return)&&(yield l.call(e))}finally{if(r)throw r.error}}n.complete()})})(t,n).catch(e=>n.error(e))})}function rm(t,n,e,i=0,r=!1){const l=n.schedule(function(){e(),r?t.add(this.schedule(null,i)):this.unsubscribe()},i);if(t.add(l),!r)return l}function hz(t,n=0){return Jn((e,i)=>{e.subscribe(li(i,r=>rm(i,t,()=>i.next(r),n),()=>rm(i,t,()=>i.complete(),n),r=>rm(i,t,()=>i.error(r),n)))})}function pz(t,n=0){return Jn((e,i)=>{i.add(t.schedule(()=>e.subscribe(i),n))})}function fz(t,n){if(!t)throw new Error("Iterable cannot be null");return new Qe(e=>{rm(e,n,()=>{const i=t[Symbol.asyncIterator]();rm(e,n,()=>{i.next().then(r=>{r.done?e.complete():e.next(r.value)})},0,!0)})})}function qs(t,n){return n?function z7(t,n){if(null!=t){if(rz(t))return function P7(t,n){return Lc(t).pipe(pz(n),hz(n))}(t,n);if(nz(t))return function F7(t,n){return new Qe(e=>{let i=0;return n.schedule(function(){i===t.length?e.complete():(e.next(t[i++]),e.closed||this.schedule())})})}(t,n);if(iz(t))return function O7(t,n){return Lc(t).pipe(pz(n),hz(n))}(t,n);if(oz(t))return fz(t,n);if(lz(t))return function L7(t,n){return new Qe(e=>{let i;return rm(e,n,()=>{i=t[az](),rm(e,n,()=>{let r,l;try{({value:r,done:l}=i.next())}catch(f){return void e.error(f)}l?e.complete():e.next(r)},0,!0)}),()=>Dr(i?.return)&&i.return()})}(t,n);if(dz(t))return function N7(t,n){return fz(cz(t),n)}(t,n)}throw sz(t)}(t,n):Lc(t)}function mz(t){return t&&Dr(t.schedule)}function f2(t){return t[t.length-1]}function gz(t){return Dr(f2(t))?t.pop():void 0}function rC(t){return mz(f2(t))?t.pop():void 0}function Fn(...t){return qs(t,rC(t))}const{isArray:V7}=Array,{getPrototypeOf:U7,prototype:j7,keys:H7}=Object;function _z(t){if(1===t.length){const n=t[0];if(V7(n))return{args:n,keys:null};if(function $7(t){return t&&"object"==typeof t&&U7(t)===j7}(n)){const e=H7(n);return{args:e.map(i=>n[i]),keys:e}}}return{args:t,keys:null}}const{isArray:G7}=Array;function yz(t){return an(n=>function q7(t,n){return G7(n)?t(...n):t(n)}(t,n))}function vz(t,n){return t.reduce((e,i,r)=>(e[i]=n[r],e),{})}function zy(...t){const n=rC(t),e=gz(t),{args:i,keys:r}=_z(t);if(0===i.length)return qs([],n);const l=new Qe(function W7(t,n,e=Ke){return i=>{bz(n,()=>{const{length:r}=t,l=new Array(r);let f=r,w=r;for(let M=0;M<r;M++)bz(n,()=>{const P=qs(t[M],n);let L=!1;P.subscribe(li(i,$=>{l[M]=$,L||(L=!0,w--),w||i.next(e(l.slice()))},()=>{--f||i.complete()}))},i)},i)}}(i,n,r?f=>vz(r,f):Ke));return e?l.pipe(yz(e)):l}function bz(t,n,e){t?rm(e,t,n):n()}const _M=Gc(t=>function(){t(this),this.name="EmptyError",this.message="no elements in sequence"});function Al(t,n,e=1/0){return Dr(n)?Al((i,r)=>an((l,f)=>n(i,l,r,f))(Lc(t(i,r))),e):("number"==typeof n&&(e=n),Jn((i,r)=>function Y7(t,n,e,i,r,l,f,w){const M=[];let P=0,L=0,$=!1;const Q=()=>{$&&!M.length&&!P&&n.complete()},X=K=>P<i?Y(K):M.push(K),Y=K=>{l&&n.next(K),P++;let de=!1;Lc(e(K,L++)).subscribe(li(n,ye=>{r?.(ye),l?X(ye):n.next(ye)},()=>{de=!0},void 0,()=>{if(de)try{for(P--;M.length&&P<i;){const ye=M.shift();f?rm(n,f,()=>Y(ye)):Y(ye)}Q()}catch(ye){n.error(ye)}}))};return t.subscribe(li(n,X,()=>{$=!0,Q()})),()=>{w?.()}}(i,r,t,e)))}function A0(t=1/0){return Al(Ke,t)}function yM(...t){return function Z7(){return A0(1)}()(qs(t,rC(t)))}function oC(t){return new Qe(n=>{Lc(t()).subscribe(n)})}function ra(t,n){const e=Dr(t)?t:()=>t,i=r=>r.error(e());return new Qe(n?r=>n.schedule(i,0,r):i)}const Md=new Qe(t=>t.complete());function m2(){return Jn((t,n)=>{let e=null;t._refCount++;const i=li(n,void 0,void 0,void 0,()=>{if(!t||t._refCount<=0||0<--t._refCount)return void(e=null);const r=t._connection,l=e;e=null,r&&(!l||r===l)&&r.unsubscribe(),n.unsubscribe()});t.subscribe(i),i.closed||(e=t.connect())})}class g2 extends Qe{constructor(n,e){super(),this.source=n,this.subjectFactory=e,this._subject=null,this._refCount=0,this._connection=null,Hn(n)&&(this.lift=n.lift)}_subscribe(n){return this.getSubject().subscribe(n)}getSubject(){const n=this._subject;return(!n||n.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:n}=this;this._subject=this._connection=null,n?.unsubscribe()}connect(){let n=this._connection;if(!n){n=this._connection=new Mi;const e=this.getSubject();n.add(this.source.subscribe(li(e,void 0,()=>{this._teardown(),e.complete()},i=>{this._teardown(),e.error(i)},()=>this._teardown()))),n.closed&&(this._connection=null,n=Mi.EMPTY)}return n}refCount(){return m2()(this)}}function lc(t,n){return Jn((e,i)=>{let r=null,l=0,f=!1;const w=()=>f&&!r&&i.complete();e.subscribe(li(i,M=>{r?.unsubscribe();let P=0;const L=l++;Lc(t(M,L)).subscribe(r=li(i,$=>i.next(n?n(M,$,L,P++):$),()=>{r=null,w()}))},()=>{f=!0,w()}))})}function Qa(t){return t<=0?()=>Md:Jn((n,e)=>{let i=0;n.subscribe(li(e,r=>{++i<=t&&(e.next(r),t<=i&&e.complete())}))})}function Nc(...t){const n=rC(t);return Jn((e,i)=>{(n?yM(t,e,n):yM(t,e)).subscribe(i)})}function bs(t,n){return Jn((e,i)=>{let r=0;e.subscribe(li(i,l=>t.call(n,l,r++)&&i.next(l)))})}function vM(t){return Jn((n,e)=>{let i=!1;n.subscribe(li(e,r=>{i=!0,e.next(r)},()=>{i||e.next(t),e.complete()}))})}function xz(t=K7){return Jn((n,e)=>{let i=!1;n.subscribe(li(e,r=>{i=!0,e.next(r)},()=>i?e.complete():e.error(t())))})}function K7(){return new _M}function By(t,n){const e=arguments.length>=2;return i=>i.pipe(t?bs((r,l)=>t(r,l,i)):Ke,Qa(1),e?vM(n):xz(()=>new _M))}function k0(t,n){return Dr(n)?Al(t,n,1):Al(t,1)}function Rr(t,n,e){const i=Dr(t)||n||e?{next:t,error:n,complete:e}:t;return i?Jn((r,l)=>{var f;null===(f=i.subscribe)||void 0===f||f.call(i);let w=!0;r.subscribe(li(l,M=>{var P;null===(P=i.next)||void 0===P||P.call(i,M),l.next(M)},()=>{var M;w=!1,null===(M=i.complete)||void 0===M||M.call(i),l.complete()},M=>{var P;w=!1,null===(P=i.error)||void 0===P||P.call(i,M),l.error(M)},()=>{var M,P;w&&(null===(M=i.unsubscribe)||void 0===M||M.call(i)),null===(P=i.finalize)||void 0===P||P.call(i)}))}):Ke}function Kr(t){return Jn((n,e)=>{let l,i=null,r=!1;i=n.subscribe(li(e,void 0,void 0,f=>{l=Lc(t(f,Kr(t)(n))),i?(i.unsubscribe(),i=null,l.subscribe(e)):r=!0})),r&&(i.unsubscribe(),i=null,l.subscribe(e))})}function _2(t){return t<=0?()=>Md:Jn((n,e)=>{let i=[];n.subscribe(li(e,r=>{i.push(r),t<i.length&&i.shift()},()=>{for(const r of i)e.next(r);e.complete()},void 0,()=>{i=null}))})}function Vy(t){return Jn((n,e)=>{try{n.subscribe(e)}finally{e.add(t)}})}function jr(t){return Jn((n,e)=>{Lc(t).subscribe(li(e,()=>e.complete(),Ir)),!e.closed&&n.subscribe(e)})}let tY=(()=>{class t{_doc;constructor(e){this._doc=e}getTitle(){return this._doc.title}setTitle(e){this._doc.title=e||""}static \u0275fac=function(i){return new(i||t)(gn(mr))};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),y2=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:function(i){let r=null;return r=i?new(i||t):gn(oY),r},providedIn:"root"})}return t})(),oY=(()=>{class t extends y2{_doc;constructor(e){super(),this._doc=e}sanitize(e,i){if(null==i)return null;switch(e){case ns.NONE:return i;case ns.HTML:return vd(i,"HTML")?Sl(i):ph(this._doc,String(i)).toString();case ns.STYLE:return vd(i,"Style")?Sl(i):i;case ns.SCRIPT:if(vd(i,"Script"))return Sl(i);throw new bt(5200,!1);case ns.URL:return vd(i,"URL")?Sl(i):vb(String(i));case ns.RESOURCE_URL:if(vd(i,"ResourceURL"))return Sl(i);throw new bt(5201,!1);default:throw new bt(5202,!1)}}bypassSecurityTrustHtml(e){return function xw(t){return new ag(t)}(e)}bypassSecurityTrustStyle(e){return function lg(t){return new J_(t)}(e)}bypassSecurityTrustScript(e){return function _p(t){return new lS(t)}(e)}bypassSecurityTrustUrl(e){return function dS(t){return new cS(t)}(e)}bypassSecurityTrustResourceUrl(e){return function uS(t){return new ey(t)}(e)}static \u0275fac=function(i){return new(i||t)(gn(mr))};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();const dr="primary",aC=Symbol("RouteTitle");class sY{params;constructor(n){this.params=n||{}}has(n){return Object.prototype.hasOwnProperty.call(this.params,n)}get(n){if(this.has(n)){const e=this.params[n];return Array.isArray(e)?e[0]:e}return null}getAll(n){if(this.has(n)){const e=this.params[n];return Array.isArray(e)?e:[e]}return[]}get keys(){return Object.keys(this.params)}}function R0(t){return new sY(t)}function aY(t,n,e){const i=e.path.split("/");if(i.length>t.length||"full"===e.pathMatch&&(n.hasChildren()||i.length<t.length))return null;const r={};for(let l=0;l<i.length;l++){const f=i[l],w=t[l];if(":"===f[0])r[f.substring(1)]=w;else if(f!==w.path)return null}return{consumed:t.slice(0,i.length),posParams:r}}function Pp(t,n){const e=t?v2(t):void 0,i=n?v2(n):void 0;if(!e||!i||e.length!=i.length)return!1;let r;for(let l=0;l<e.length;l++)if(r=e[l],!Ez(t[r],n[r]))return!1;return!0}function v2(t){return[...Object.keys(t),...Object.getOwnPropertySymbols(t)]}function Ez(t,n){if(Array.isArray(t)&&Array.isArray(n)){if(t.length!==n.length)return!1;const e=[...t].sort(),i=[...n].sort();return e.every((r,l)=>i[l]===r)}return t===n}function Sz(t){return t.length>0?t[t.length-1]:null}function Og(t){return iC(t)?t:O1(t)?qs(Promise.resolve(t)):Fn(t)}const cY={exact:function Tz(t,n,e){if(!jy(t.segments,n.segments)||!bM(t.segments,n.segments,e)||t.numberOfChildren!==n.numberOfChildren)return!1;for(const i in n.children)if(!t.children[i]||!Tz(t.children[i],n.children[i],e))return!1;return!0},subset:Iz},Dz={exact:function dY(t,n){return Pp(t,n)},subset:function uY(t,n){return Object.keys(n).length<=Object.keys(t).length&&Object.keys(n).every(e=>Ez(t[e],n[e]))},ignored:()=>!0};function Mz(t,n,e){return cY[e.paths](t.root,n.root,e.matrixParams)&&Dz[e.queryParams](t.queryParams,n.queryParams)&&!("exact"===e.fragment&&t.fragment!==n.fragment)}function Iz(t,n,e){return Az(t,n,n.segments,e)}function Az(t,n,e,i){if(t.segments.length>e.length){const r=t.segments.slice(0,e.length);return!(!jy(r,e)||n.hasChildren()||!bM(r,e,i))}if(t.segments.length===e.length){if(!jy(t.segments,e)||!bM(t.segments,e,i))return!1;for(const r in n.children)if(!t.children[r]||!Iz(t.children[r],n.children[r],i))return!1;return!0}{const r=e.slice(0,t.segments.length),l=e.slice(t.segments.length);return!!(jy(t.segments,r)&&bM(t.segments,r,i)&&t.children[dr])&&Az(t.children[dr],n,l,i)}}function bM(t,n,e){return n.every((i,r)=>Dz[e](t[r].parameters,i.parameters))}class Uy{root;queryParams;fragment;_queryParamMap;constructor(n=new uo([],{}),e={},i=null){this.root=n,this.queryParams=e,this.fragment=i}get queryParamMap(){return this._queryParamMap??=R0(this.queryParams),this._queryParamMap}toString(){return fY.serialize(this)}}class uo{segments;children;parent=null;constructor(n,e){this.segments=n,this.children=e,Object.values(e).forEach(i=>i.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return wM(this)}}class lC{path;parameters;_parameterMap;constructor(n,e){this.path=n,this.parameters=e}get parameterMap(){return this._parameterMap??=R0(this.parameters),this._parameterMap}toString(){return Pz(this)}}function jy(t,n){return t.length===n.length&&t.every((e,i)=>e.path===n[i].path)}let cC=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:()=>new xM,providedIn:"root"})}return t})();class xM{parse(n){const e=new SY(n);return new Uy(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())}serialize(n){const e=`/${dC(n.root,!0)}`,i=function _Y(t){const n=Object.entries(t).map(([e,i])=>Array.isArray(i)?i.map(r=>`${CM(e)}=${CM(r)}`).join("&"):`${CM(e)}=${CM(i)}`).filter(e=>e);return n.length?`?${n.join("&")}`:""}(n.queryParams);return`${e}${i}${"string"==typeof n.fragment?`#${function mY(t){return encodeURI(t)}(n.fragment)}`:""}`}}const fY=new xM;function wM(t){return t.segments.map(n=>Pz(n)).join("/")}function dC(t,n){if(!t.hasChildren())return wM(t);if(n){const e=t.children[dr]?dC(t.children[dr],!1):"",i=[];return Object.entries(t.children).forEach(([r,l])=>{r!==dr&&i.push(`${r}:${dC(l,!1)}`)}),i.length>0?`${e}(${i.join("//")})`:e}{const e=function pY(t,n){let e=[];return Object.entries(t.children).forEach(([i,r])=>{i===dr&&(e=e.concat(n(r,i)))}),Object.entries(t.children).forEach(([i,r])=>{i!==dr&&(e=e.concat(n(r,i)))}),e}(t,(i,r)=>r===dr?[dC(t.children[dr],!1)]:[`${r}:${dC(i,!1)}`]);return 1===Object.keys(t.children).length&&null!=t.children[dr]?`${wM(t)}/${e[0]}`:`${wM(t)}/(${e.join("//")})`}}function kz(t){return encodeURIComponent(t).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function CM(t){return kz(t).replace(/%3B/gi,";")}function b2(t){return kz(t).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function EM(t){return decodeURIComponent(t)}function Rz(t){return EM(t.replace(/\+/g,"%20"))}function Pz(t){return`${b2(t.path)}${function gY(t){return Object.entries(t).map(([n,e])=>`;${b2(n)}=${b2(e)}`).join("")}(t.parameters)}`}const yY=/^[^\/()?;#]+/;function x2(t){const n=t.match(yY);return n?n[0]:""}const vY=/^[^\/()?;=#]+/,xY=/^[^=?&#]+/,CY=/^[^&#]+/;class SY{url;remaining;constructor(n){this.url=n,this.remaining=n}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new uo([],{}):new uo([],this.parseChildren())}parseQueryParams(){const n={};if(this.consumeOptional("?"))do{this.parseQueryParam(n)}while(this.consumeOptional("&"));return n}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const n=[];for(this.peekStartsWith("(")||n.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),n.push(this.parseSegment());let e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));let i={};return this.peekStartsWith("(")&&(i=this.parseParens(!1)),(n.length>0||Object.keys(e).length>0)&&(i[dr]=new uo(n,e)),i}parseSegment(){const n=x2(this.remaining);if(""===n&&this.peekStartsWith(";"))throw new bt(4009,!1);return this.capture(n),new lC(EM(n),this.parseMatrixParams())}parseMatrixParams(){const n={};for(;this.consumeOptional(";");)this.parseParam(n);return n}parseParam(n){const e=function bY(t){const n=t.match(vY);return n?n[0]:""}(this.remaining);if(!e)return;this.capture(e);let i="";if(this.consumeOptional("=")){const r=x2(this.remaining);r&&(i=r,this.capture(i))}n[EM(e)]=EM(i)}parseQueryParam(n){const e=function wY(t){const n=t.match(xY);return n?n[0]:""}(this.remaining);if(!e)return;this.capture(e);let i="";if(this.consumeOptional("=")){const f=function EY(t){const n=t.match(CY);return n?n[0]:""}(this.remaining);f&&(i=f,this.capture(i))}const r=Rz(e),l=Rz(i);if(n.hasOwnProperty(r)){let f=n[r];Array.isArray(f)||(f=[f],n[r]=f),f.push(l)}else n[r]=l}parseParens(n){const e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const i=x2(this.remaining),r=this.remaining[i.length];if("/"!==r&&")"!==r&&";"!==r)throw new bt(4010,!1);let l;i.indexOf(":")>-1?(l=i.slice(0,i.indexOf(":")),this.capture(l),this.capture(":")):n&&(l=dr);const f=this.parseChildren();e[l]=1===Object.keys(f).length?f[dr]:new uo([],f),this.consumeOptional("//")}return e}peekStartsWith(n){return this.remaining.startsWith(n)}consumeOptional(n){return!!this.peekStartsWith(n)&&(this.remaining=this.remaining.substring(n.length),!0)}capture(n){if(!this.consumeOptional(n))throw new bt(4011,!1)}}function Oz(t){return t.segments.length>0?new uo([],{[dr]:t}):t}function Fz(t){const n={};for(const[i,r]of Object.entries(t.children)){const l=Fz(r);if(i===dr&&0===l.segments.length&&l.hasChildren())for(const[f,w]of Object.entries(l.children))n[f]=w;else(l.segments.length>0||l.hasChildren())&&(n[i]=l)}return function DY(t){if(1===t.numberOfChildren&&t.children[dr]){const n=t.children[dr];return new uo(t.segments.concat(n.segments),n.children)}return t}(new uo(t.segments,n))}function Hy(t){return t instanceof Uy}function Lz(t){let n;const r=Oz(function e(l){const f={};for(const M of l.children){const P=e(M);f[M.outlet]=P}const w=new uo(l.url,f);return l===t&&(n=w),w}(t.root));return n??r}function Nz(t,n,e,i){let r=t;for(;r.parent;)r=r.parent;if(0===n.length)return w2(r,r,r,e,i);const l=function TY(t){if("string"==typeof t[0]&&1===t.length&&"/"===t[0])return new Bz(!0,0,t);let n=0,e=!1;const i=t.reduce((r,l,f)=>{if("object"==typeof l&&null!=l){if(l.outlets){const w={};return Object.entries(l.outlets).forEach(([M,P])=>{w[M]="string"==typeof P?P.split("/"):P}),[...r,{outlets:w}]}if(l.segmentPath)return[...r,l.segmentPath]}return"string"!=typeof l?[...r,l]:0===f?(l.split("/").forEach((w,M)=>{0==M&&"."===w||(0==M&&""===w?e=!0:".."===w?n++:""!=w&&r.push(w))}),r):[...r,l]},[]);return new Bz(e,n,i)}(n);if(l.toRoot())return w2(r,r,new uo([],{}),e,i);const f=function IY(t,n,e){if(t.isAbsolute)return new DM(n,!0,0);if(!e)return new DM(n,!1,NaN);if(null===e.parent)return new DM(e,!0,0);const i=SM(t.commands[0])?0:1;return function AY(t,n,e){let i=t,r=n,l=e;for(;l>r;){if(l-=r,i=i.parent,!i)throw new bt(4005,!1);r=i.segments.length}return new DM(i,!1,r-l)}(e,e.segments.length-1+i,t.numberOfDoubleDots)}(l,r,t),w=f.processChildren?hC(f.segmentGroup,f.index,l.commands):Vz(f.segmentGroup,f.index,l.commands);return w2(r,f.segmentGroup,w,e,i)}function SM(t){return"object"==typeof t&&null!=t&&!t.outlets&&!t.segmentPath}function uC(t){return"object"==typeof t&&null!=t&&t.outlets}function w2(t,n,e,i,r){let f,l={};i&&Object.entries(i).forEach(([M,P])=>{l[M]=Array.isArray(P)?P.map(L=>`${L}`):`${P}`}),f=t===n?e:zz(t,n,e);const w=Oz(Fz(f));return new Uy(w,l,r)}function zz(t,n,e){const i={};return Object.entries(t.children).forEach(([r,l])=>{i[r]=l===n?e:zz(l,n,e)}),new uo(t.segments,i)}class Bz{isAbsolute;numberOfDoubleDots;commands;constructor(n,e,i){if(this.isAbsolute=n,this.numberOfDoubleDots=e,this.commands=i,n&&i.length>0&&SM(i[0]))throw new bt(4003,!1);const r=i.find(uC);if(r&&r!==Sz(i))throw new bt(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class DM{segmentGroup;processChildren;index;constructor(n,e,i){this.segmentGroup=n,this.processChildren=e,this.index=i}}function Vz(t,n,e){if(t??=new uo([],{}),0===t.segments.length&&t.hasChildren())return hC(t,n,e);const i=function RY(t,n,e){let i=0,r=n;const l={match:!1,pathIndex:0,commandIndex:0};for(;r<t.segments.length;){if(i>=e.length)return l;const f=t.segments[r],w=e[i];if(uC(w))break;const M=`${w}`,P=i<e.length-1?e[i+1]:null;if(r>0&&void 0===M)break;if(M&&P&&"object"==typeof P&&void 0===P.outlets){if(!jz(M,P,f))return l;i+=2}else{if(!jz(M,{},f))return l;i++}r++}return{match:!0,pathIndex:r,commandIndex:i}}(t,n,e),r=e.slice(i.commandIndex);if(i.match&&i.pathIndex<t.segments.length){const l=new uo(t.segments.slice(0,i.pathIndex),{});return l.children[dr]=new uo(t.segments.slice(i.pathIndex),t.children),hC(l,0,r)}return i.match&&0===r.length?new uo(t.segments,{}):i.match&&!t.hasChildren()?C2(t,n,e):i.match?hC(t,0,r):C2(t,n,e)}function hC(t,n,e){if(0===e.length)return new uo(t.segments,{});{const i=function kY(t){return uC(t[0])?t[0].outlets:{[dr]:t}}(e),r={};if(Object.keys(i).some(l=>l!==dr)&&t.children[dr]&&1===t.numberOfChildren&&0===t.children[dr].segments.length){const l=hC(t.children[dr],n,e);return new uo(t.segments,l.children)}return Object.entries(i).forEach(([l,f])=>{"string"==typeof f&&(f=[f]),null!==f&&(r[l]=Vz(t.children[l],n,f))}),Object.entries(t.children).forEach(([l,f])=>{void 0===i[l]&&(r[l]=f)}),new uo(t.segments,r)}}function C2(t,n,e){const i=t.segments.slice(0,n);let r=0;for(;r<e.length;){const l=e[r];if(uC(l)){const M=PY(l.outlets);return new uo(i,M)}if(0===r&&SM(e[0])){i.push(new lC(t.segments[n].path,Uz(e[0]))),r++;continue}const f=uC(l)?l.outlets[dr]:`${l}`,w=r<e.length-1?e[r+1]:null;f&&w&&SM(w)?(i.push(new lC(f,Uz(w))),r+=2):(i.push(new lC(f,{})),r++)}return new uo(i,{})}function PY(t){const n={};return Object.entries(t).forEach(([e,i])=>{"string"==typeof i&&(i=[i]),null!==i&&(n[e]=C2(new uo([],{}),0,i))}),n}function Uz(t){const n={};return Object.entries(t).forEach(([e,i])=>n[e]=`${i}`),n}function jz(t,n,e){return t==e.path&&Pp(n,e.parameters)}const MM="imperative";var Pr=function(t){return t[t.NavigationStart=0]="NavigationStart",t[t.NavigationEnd=1]="NavigationEnd",t[t.NavigationCancel=2]="NavigationCancel",t[t.NavigationError=3]="NavigationError",t[t.RoutesRecognized=4]="RoutesRecognized",t[t.ResolveStart=5]="ResolveStart",t[t.ResolveEnd=6]="ResolveEnd",t[t.GuardsCheckStart=7]="GuardsCheckStart",t[t.GuardsCheckEnd=8]="GuardsCheckEnd",t[t.RouteConfigLoadStart=9]="RouteConfigLoadStart",t[t.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",t[t.ChildActivationStart=11]="ChildActivationStart",t[t.ChildActivationEnd=12]="ChildActivationEnd",t[t.ActivationStart=13]="ActivationStart",t[t.ActivationEnd=14]="ActivationEnd",t[t.Scroll=15]="Scroll",t[t.NavigationSkipped=16]="NavigationSkipped",t}(Pr||{});class Op{id;url;constructor(n,e){this.id=n,this.url=e}}class TM extends Op{type=Pr.NavigationStart;navigationTrigger;restoredState;constructor(n,e,i="imperative",r=null){super(n,e),this.navigationTrigger=i,this.restoredState=r}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class om extends Op{urlAfterRedirects;type=Pr.NavigationEnd;constructor(n,e,i){super(n,e),this.urlAfterRedirects=i}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}var Td=function(t){return t[t.Redirect=0]="Redirect",t[t.SupersededByNewNavigation=1]="SupersededByNewNavigation",t[t.NoDataFromResolver=2]="NoDataFromResolver",t[t.GuardRejected=3]="GuardRejected",t}(Td||{}),IM=function(t){return t[t.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",t[t.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",t}(IM||{});class $y extends Op{reason;code;type=Pr.NavigationCancel;constructor(n,e,i,r){super(n,e),this.reason=i,this.code=r}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class P0 extends Op{reason;code;type=Pr.NavigationSkipped;constructor(n,e,i,r){super(n,e),this.reason=i,this.code=r}}class E2 extends Op{error;target;type=Pr.NavigationError;constructor(n,e,i,r){super(n,e),this.error=i,this.target=r}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class Hz extends Op{urlAfterRedirects;state;type=Pr.RoutesRecognized;constructor(n,e,i,r){super(n,e),this.urlAfterRedirects=i,this.state=r}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class OY extends Op{urlAfterRedirects;state;type=Pr.GuardsCheckStart;constructor(n,e,i,r){super(n,e),this.urlAfterRedirects=i,this.state=r}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class FY extends Op{urlAfterRedirects;state;shouldActivate;type=Pr.GuardsCheckEnd;constructor(n,e,i,r,l){super(n,e),this.urlAfterRedirects=i,this.state=r,this.shouldActivate=l}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class LY extends Op{urlAfterRedirects;state;type=Pr.ResolveStart;constructor(n,e,i,r){super(n,e),this.urlAfterRedirects=i,this.state=r}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class NY extends Op{urlAfterRedirects;state;type=Pr.ResolveEnd;constructor(n,e,i,r){super(n,e),this.urlAfterRedirects=i,this.state=r}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class zY{route;type=Pr.RouteConfigLoadStart;constructor(n){this.route=n}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class BY{route;type=Pr.RouteConfigLoadEnd;constructor(n){this.route=n}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class VY{snapshot;type=Pr.ChildActivationStart;constructor(n){this.snapshot=n}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class UY{snapshot;type=Pr.ChildActivationEnd;constructor(n){this.snapshot=n}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class jY{snapshot;type=Pr.ActivationStart;constructor(n){this.snapshot=n}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class HY{snapshot;type=Pr.ActivationEnd;constructor(n){this.snapshot=n}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class $z{routerEvent;position;anchor;type=Pr.Scroll;constructor(n,e,i){this.routerEvent=n,this.position=e,this.anchor=i}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class S2{}class AM{url;navigationBehaviorOptions;constructor(n,e){this.url=n,this.navigationBehaviorOptions=e}}function Sh(t){return t.outlet||dr}function pC(t){if(!t)return null;if(t.routeConfig?._injector)return t.routeConfig._injector;for(let n=t.parent;n;n=n.parent){const e=n.routeConfig;if(e?._loadedInjector)return e._loadedInjector;if(e?._injector)return e._injector}return null}class ZY{rootInjector;outlet=null;route=null;children;attachRef=null;get injector(){return pC(this.route?.snapshot)??this.rootInjector}constructor(n){this.rootInjector=n,this.children=new fC(this.rootInjector)}}let fC=(()=>{class t{rootInjector;contexts=new Map;constructor(e){this.rootInjector=e}onChildOutletCreated(e,i){const r=this.getOrCreateContext(e);r.outlet=i,this.contexts.set(e,r)}onChildOutletDestroyed(e){const i=this.getContext(e);i&&(i.outlet=null,i.attachRef=null)}onOutletDeactivated(){const e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let i=this.getContext(e);return i||(i=new ZY(this.rootInjector),this.contexts.set(e,i)),i}getContext(e){return this.contexts.get(e)||null}static \u0275fac=function(i){return new(i||t)(gn(Lo))};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();class Gz{_root;constructor(n){this._root=n}get root(){return this._root.value}parent(n){const e=this.pathFromRoot(n);return e.length>1?e[e.length-2]:null}children(n){const e=D2(n,this._root);return e?e.children.map(i=>i.value):[]}firstChild(n){const e=D2(n,this._root);return e&&e.children.length>0?e.children[0].value:null}siblings(n){const e=M2(n,this._root);return e.length<2?[]:e[e.length-2].children.map(r=>r.value).filter(r=>r!==n)}pathFromRoot(n){return M2(n,this._root).map(e=>e.value)}}function D2(t,n){if(t===n.value)return n;for(const e of n.children){const i=D2(t,e);if(i)return i}return null}function M2(t,n){if(t===n.value)return[n];for(const e of n.children){const i=M2(t,e);if(i.length)return i.unshift(n),i}return[]}class Dh{value;children;constructor(n,e){this.value=n,this.children=e}toString(){return`TreeNode(${this.value})`}}function O0(t){const n={};return t&&t.children.forEach(e=>n[e.value.outlet]=e),n}class qz extends Gz{snapshot;constructor(n,e){super(n),this.snapshot=e,T2(this,n)}toString(){return this.snapshot.toString()}}function Wz(t){const n=function XY(t){const l=new RM([],{},{},"",{},dr,t,null,{});return new Yz("",new Dh(l,[]))}(t),e=new pn([new lC("",{})]),i=new pn({}),r=new pn({}),l=new pn({}),f=new pn(""),w=new Fg(e,i,l,f,r,dr,t,n.root);return w.snapshot=n.root,new qz(new Dh(w,[]),n)}class Fg{urlSubject;paramsSubject;queryParamsSubject;fragmentSubject;dataSubject;outlet;component;snapshot;_futureSnapshot;_routerState;_paramMap;_queryParamMap;title;url;params;queryParams;fragment;data;constructor(n,e,i,r,l,f,w,M){this.urlSubject=n,this.paramsSubject=e,this.queryParamsSubject=i,this.fragmentSubject=r,this.dataSubject=l,this.outlet=f,this.component=w,this._futureSnapshot=M,this.title=this.dataSubject?.pipe(an(P=>P[aC]))??Fn(void 0),this.url=n,this.params=e,this.queryParams=i,this.fragment=r,this.data=l}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(an(n=>R0(n))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(an(n=>R0(n))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function kM(t,n,e="emptyOnly"){let i;const{routeConfig:r}=t;return i=null===n||"always"!==e&&""!==r?.path&&(n.component||n.routeConfig?.loadComponent)?{params:{...t.params},data:{...t.data},resolve:{...t.data,...t._resolvedData??{}}}:{params:{...n.params,...t.params},data:{...n.data,...t.data},resolve:{...t.data,...n.data,...r?.data,...t._resolvedData}},r&&Xz(r)&&(i.resolve[aC]=r.title),i}class RM{url;params;queryParams;fragment;data;outlet;component;routeConfig;_resolve;_resolvedData;_routerState;_paramMap;_queryParamMap;get title(){return this.data?.[aC]}constructor(n,e,i,r,l,f,w,M,P){this.url=n,this.params=e,this.queryParams=i,this.fragment=r,this.data=l,this.outlet=f,this.component=w,this.routeConfig=M,this._resolve=P}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=R0(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=R0(this.queryParams),this._queryParamMap}toString(){return`Route(url:'${this.url.map(i=>i.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class Yz extends Gz{url;constructor(n,e){super(e),this.url=n,T2(this,e)}toString(){return Zz(this._root)}}function T2(t,n){n.value._routerState=t,n.children.forEach(e=>T2(t,e))}function Zz(t){const n=t.children.length>0?` { ${t.children.map(Zz).join(", ")} } `:"";return`${t.value}${n}`}function I2(t){if(t.snapshot){const n=t.snapshot,e=t._futureSnapshot;t.snapshot=e,Pp(n.queryParams,e.queryParams)||t.queryParamsSubject.next(e.queryParams),n.fragment!==e.fragment&&t.fragmentSubject.next(e.fragment),Pp(n.params,e.params)||t.paramsSubject.next(e.params),function lY(t,n){if(t.length!==n.length)return!1;for(let e=0;e<t.length;++e)if(!Pp(t[e],n[e]))return!1;return!0}(n.url,e.url)||t.urlSubject.next(e.url),Pp(n.data,e.data)||t.dataSubject.next(e.data)}else t.snapshot=t._futureSnapshot,t.dataSubject.next(t._futureSnapshot.data)}function A2(t,n){const e=Pp(t.params,n.params)&&function hY(t,n){return jy(t,n)&&t.every((e,i)=>Pp(e.parameters,n[i].parameters))}(t.url,n.url);return e&&!(!t.parent!=!n.parent)&&(!t.parent||A2(t.parent,n.parent))}function Xz(t){return"string"==typeof t.title||null===t.title}const KY=new _t("");let k2=(()=>{class t{activated=null;get activatedComponentRef(){return this.activated}_activatedRoute=null;name=dr;activateEvents=new $e;deactivateEvents=new $e;attachEvents=new $e;detachEvents=new $e;routerOutletData=Tr(void 0);parentContexts=te(fC);location=te(io);changeDetector=te(Do);inputBinder=te(PM,{optional:!0});supportsBindingToComponentInputs=!0;ngOnChanges(e){if(e.name){const{firstChange:i,previousValue:r}=e.name;if(i)return;this.isTrackedInParentContexts(r)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(r)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(e){return this.parentContexts.getContext(e)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const e=this.parentContexts.getContext(this.name);e?.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new bt(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new bt(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new bt(4012,!1);this.location.detach();const e=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(e.instance),e}attach(e,i){this.activated=e,this._activatedRoute=i,this.location.insert(e.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(e.instance)}deactivate(){if(this.activated){const e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}activateWith(e,i){if(this.isActivated)throw new bt(4013,!1);this._activatedRoute=e;const r=this.location,f=e.snapshot.component,w=this.parentContexts.getOrCreateContext(this.name).children,M=new QY(e,w,r.injector,this.routerOutletData);this.activated=r.createComponent(f,{index:r.length,injector:M,environmentInjector:i}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static \u0275fac=function(i){return new(i||t)};static \u0275dir=Ht({type:t,selectors:[["router-outlet"]],inputs:{name:"name",routerOutletData:[1,"routerOutletData"]},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],features:[Mr]})}return t})();class QY{route;childContexts;parent;outletData;constructor(n,e,i,r){this.route=n,this.childContexts=e,this.parent=i,this.outletData=r}get(n,e){return n===Fg?this.route:n===fC?this.childContexts:n===KY?this.outletData:this.parent.get(n,e)}}const PM=new _t("");let Kz=(()=>{class t{outletDataSubscriptions=new Map;bindActivatedRouteToOutletComponent(e){this.unsubscribeFromRouteData(e),this.subscribeToRouteData(e)}unsubscribeFromRouteData(e){this.outletDataSubscriptions.get(e)?.unsubscribe(),this.outletDataSubscriptions.delete(e)}subscribeToRouteData(e){const{activatedRoute:i}=e,r=zy([i.queryParams,i.params,i.data]).pipe(lc(([l,f,w],M)=>(w={...l,...f,...w},0===M?Fn(w):Promise.resolve(w)))).subscribe(l=>{if(!e.isActivated||!e.activatedComponentRef||e.activatedRoute!==i||null===i.component)return void this.unsubscribeFromRouteData(e);const f=function Rq(t){const n=bi(t);if(!n)return null;const e=new Wf(n);return{get selector(){return e.selector},get type(){return e.componentType},get inputs(){return e.inputs},get outputs(){return e.outputs},get ngContentSelectors(){return e.ngContentSelectors},get isStandalone(){return n.standalone},get isSignal(){return n.signals}}}(i.component);if(f)for(const{templateName:w}of f.inputs)e.activatedComponentRef.setInput(w,l[w]);else this.unsubscribeFromRouteData(e)});this.outletDataSubscriptions.set(e,r)}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:t.\u0275fac})}return t})();function mC(t,n,e){if(e&&t.shouldReuseRoute(n.value,e.value.snapshot)){const i=e.value;i._futureSnapshot=n.value;const r=function eZ(t,n,e){return n.children.map(i=>{for(const r of e.children)if(t.shouldReuseRoute(i.value,r.value.snapshot))return mC(t,i,r);return mC(t,i)})}(t,n,e);return new Dh(i,r)}{if(t.shouldAttach(n.value)){const l=t.retrieve(n.value);if(null!==l){const f=l.route;return f.value._futureSnapshot=n.value,f.children=n.children.map(w=>mC(t,w)),f}}const i=function tZ(t){return new Fg(new pn(t.url),new pn(t.params),new pn(t.queryParams),new pn(t.fragment),new pn(t.data),t.outlet,t.component,t)}(n.value),r=n.children.map(l=>mC(t,l));return new Dh(i,r)}}class R2{redirectTo;navigationBehaviorOptions;constructor(n,e){this.redirectTo=n,this.navigationBehaviorOptions=e}}const Qz="ngNavigationCancelingError";function OM(t,n){const{redirectTo:e,navigationBehaviorOptions:i}=Hy(n)?{redirectTo:n,navigationBehaviorOptions:void 0}:n,r=Jz(!1,Td.Redirect);return r.url=e,r.navigationBehaviorOptions=i,r}function Jz(t,n){const e=new Error(`NavigationCancelingError: ${t||""}`);return e[Qz]=!0,e.cancellationCode=n,e}function eB(t){return!!t&&t[Qz]}class rZ{routeReuseStrategy;futureState;currState;forwardEvent;inputBindingEnabled;constructor(n,e,i,r,l){this.routeReuseStrategy=n,this.futureState=e,this.currState=i,this.forwardEvent=r,this.inputBindingEnabled=l}activate(n){const e=this.futureState._root,i=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,i,n),I2(this.futureState.root),this.activateChildRoutes(e,i,n)}deactivateChildRoutes(n,e,i){const r=O0(e);n.children.forEach(l=>{const f=l.value.outlet;this.deactivateRoutes(l,r[f],i),delete r[f]}),Object.values(r).forEach(l=>{this.deactivateRouteAndItsChildren(l,i)})}deactivateRoutes(n,e,i){const r=n.value,l=e?e.value:null;if(r===l)if(r.component){const f=i.getContext(r.outlet);f&&this.deactivateChildRoutes(n,e,f.children)}else this.deactivateChildRoutes(n,e,i);else l&&this.deactivateRouteAndItsChildren(e,i)}deactivateRouteAndItsChildren(n,e){n.value.component&&this.routeReuseStrategy.shouldDetach(n.value.snapshot)?this.detachAndStoreRouteSubtree(n,e):this.deactivateRouteAndOutlet(n,e)}detachAndStoreRouteSubtree(n,e){const i=e.getContext(n.value.outlet),r=i&&n.value.component?i.children:e,l=O0(n);for(const f of Object.values(l))this.deactivateRouteAndItsChildren(f,r);if(i&&i.outlet){const f=i.outlet.detach(),w=i.children.onOutletDeactivated();this.routeReuseStrategy.store(n.value.snapshot,{componentRef:f,route:n,contexts:w})}}deactivateRouteAndOutlet(n,e){const i=e.getContext(n.value.outlet),r=i&&n.value.component?i.children:e,l=O0(n);for(const f of Object.values(l))this.deactivateRouteAndItsChildren(f,r);i&&(i.outlet&&(i.outlet.deactivate(),i.children.onOutletDeactivated()),i.attachRef=null,i.route=null)}activateChildRoutes(n,e,i){const r=O0(e);n.children.forEach(l=>{this.activateRoutes(l,r[l.value.outlet],i),this.forwardEvent(new HY(l.value.snapshot))}),n.children.length&&this.forwardEvent(new UY(n.value.snapshot))}activateRoutes(n,e,i){const r=n.value,l=e?e.value:null;if(I2(r),r===l)if(r.component){const f=i.getOrCreateContext(r.outlet);this.activateChildRoutes(n,e,f.children)}else this.activateChildRoutes(n,e,i);else if(r.component){const f=i.getOrCreateContext(r.outlet);if(this.routeReuseStrategy.shouldAttach(r.snapshot)){const w=this.routeReuseStrategy.retrieve(r.snapshot);this.routeReuseStrategy.store(r.snapshot,null),f.children.onOutletReAttached(w.contexts),f.attachRef=w.componentRef,f.route=w.route.value,f.outlet&&f.outlet.attach(w.componentRef,w.route.value),I2(w.route.value),this.activateChildRoutes(n,null,f.children)}else f.attachRef=null,f.route=r,f.outlet&&f.outlet.activateWith(r,f.injector),this.activateChildRoutes(n,null,f.children)}else this.activateChildRoutes(n,null,i)}}class tB{path;route;constructor(n){this.path=n,this.route=this.path[this.path.length-1]}}class FM{component;route;constructor(n,e){this.component=n,this.route=e}}function oZ(t,n,e){const i=t._root;return gC(i,n?n._root:null,e,[i.value])}function F0(t,n){const e=Symbol(),i=n.get(t,e);return i===e?"function"!=typeof t||function qc(t){return null!==jd(t)}(t)?n.get(t):t:i}function gC(t,n,e,i,r={canDeactivateChecks:[],canActivateChecks:[]}){const l=O0(n);return t.children.forEach(f=>{(function aZ(t,n,e,i,r={canDeactivateChecks:[],canActivateChecks:[]}){const l=t.value,f=n?n.value:null,w=e?e.getContext(t.value.outlet):null;if(f&&l.routeConfig===f.routeConfig){const M=function lZ(t,n,e){if("function"==typeof e)return e(t,n);switch(e){case"pathParamsChange":return!jy(t.url,n.url);case"pathParamsOrQueryParamsChange":return!jy(t.url,n.url)||!Pp(t.queryParams,n.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!A2(t,n)||!Pp(t.queryParams,n.queryParams);default:return!A2(t,n)}}(f,l,l.routeConfig.runGuardsAndResolvers);M?r.canActivateChecks.push(new tB(i)):(l.data=f.data,l._resolvedData=f._resolvedData),gC(t,n,l.component?w?w.children:null:e,i,r),M&&w&&w.outlet&&w.outlet.isActivated&&r.canDeactivateChecks.push(new FM(w.outlet.component,f))}else f&&_C(n,w,r),r.canActivateChecks.push(new tB(i)),gC(t,null,l.component?w?w.children:null:e,i,r)})(f,l[f.value.outlet],e,i.concat([f.value]),r),delete l[f.value.outlet]}),Object.entries(l).forEach(([f,w])=>_C(w,e.getContext(f),r)),r}function _C(t,n,e){const i=O0(t),r=t.value;Object.entries(i).forEach(([l,f])=>{_C(f,r.component?n?n.children.getContext(l):null:n,e)}),e.canDeactivateChecks.push(new FM(r.component&&n&&n.outlet&&n.outlet.isActivated?n.outlet.component:null,r))}function yC(t){return"function"==typeof t}function nB(t){return t instanceof _M||"EmptyError"===t?.name}const LM=Symbol("INITIAL_VALUE");function L0(){return lc(t=>zy(t.map(n=>n.pipe(Qa(1),Nc(LM)))).pipe(an(n=>{for(const e of n)if(!0!==e){if(e===LM)return LM;if(!1===e||mZ(e))return e}return!0}),bs(n=>n!==LM),Qa(1)))}function mZ(t){return Hy(t)||t instanceof R2}function iB(t){return function je(...t){return tt(t)}(Rr(n=>{if("boolean"!=typeof n)throw OM(0,n)}),an(n=>!0===n))}class P2{segmentGroup;constructor(n){this.segmentGroup=n||null}}class O2 extends Error{urlTree;constructor(n){super(),this.urlTree=n}}function N0(t){return ra(new P2(t))}class TZ{urlSerializer;urlTree;constructor(n,e){this.urlSerializer=n,this.urlTree=e}lineralizeSegments(n,e){let i=[],r=e.root;for(;;){if(i=i.concat(r.segments),0===r.numberOfChildren)return Fn(i);if(r.numberOfChildren>1||!r.children[dr])return ra(new bt(4e3,!1));r=r.children[dr]}}applyRedirectCommands(n,e,i,r,l){if("string"!=typeof e){const w=e,{queryParams:M,fragment:P,routeConfig:L,url:$,outlet:Q,params:X,data:Y,title:K}=r,de=Bs(l,()=>w({params:X,data:Y,queryParams:M,fragment:P,routeConfig:L,url:$,outlet:Q,title:K}));if(de instanceof Uy)throw new O2(de);e=de}const f=this.applyRedirectCreateUrlTree(e,this.urlSerializer.parse(e),n,i);if("/"===e[0])throw new O2(f);return f}applyRedirectCreateUrlTree(n,e,i,r){const l=this.createSegmentGroup(n,e.root,i,r);return new Uy(l,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)}createQueryParams(n,e){const i={};return Object.entries(n).forEach(([r,l])=>{if("string"==typeof l&&":"===l[0]){const w=l.substring(1);i[r]=e[w]}else i[r]=l}),i}createSegmentGroup(n,e,i,r){const l=this.createSegments(n,e.segments,i,r);let f={};return Object.entries(e.children).forEach(([w,M])=>{f[w]=this.createSegmentGroup(n,M,i,r)}),new uo(l,f)}createSegments(n,e,i,r){return e.map(l=>":"===l.path[0]?this.findPosParam(n,l,r):this.findOrReturn(l,i))}findPosParam(n,e,i){const r=i[e.path.substring(1)];if(!r)throw new bt(4001,!1);return r}findOrReturn(n,e){let i=0;for(const r of e){if(r.path===n.path)return e.splice(i),r;i++}return n}}const F2={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function IZ(t,n,e,i,r){const l=rB(t,n,e);return l.matched?(i=function $Y(t,n){return t.providers&&!t._injector&&(t._injector=DD(t.providers,n,`Route: ${t.path}`)),t._injector??n}(n,i),function SZ(t,n,e,i){const r=n.canMatch;return r&&0!==r.length?Fn(r.map(f=>{const w=F0(f,t);return Og(function fZ(t){return t&&yC(t.canMatch)}(w)?w.canMatch(n,e):Bs(t,()=>w(n,e)))})).pipe(L0(),iB()):Fn(!0)}(i,n,e).pipe(an(f=>!0===f?l:{...F2}))):Fn(l)}function rB(t,n,e){if("**"===n.path)return function AZ(t){return{matched:!0,parameters:t.length>0?Sz(t).parameters:{},consumedSegments:t,remainingSegments:[],positionalParamSegments:{}}}(e);if(""===n.path)return"full"===n.pathMatch&&(t.hasChildren()||e.length>0)?{...F2}:{matched:!0,consumedSegments:[],remainingSegments:e,parameters:{},positionalParamSegments:{}};const r=(n.matcher||aY)(e,t,n);if(!r)return{...F2};const l={};Object.entries(r.posParams??{}).forEach(([w,M])=>{l[w]=M.path});const f=r.consumed.length>0?{...l,...r.consumed[r.consumed.length-1].parameters}:l;return{matched:!0,consumedSegments:r.consumed,remainingSegments:e.slice(r.consumed.length),parameters:f,positionalParamSegments:r.posParams??{}}}function oB(t,n,e,i){return e.length>0&&function PZ(t,n,e){return e.some(i=>NM(t,n,i)&&Sh(i)!==dr)}(t,e,i)?{segmentGroup:new uo(n,RZ(i,new uo(e,t.children))),slicedSegments:[]}:0===e.length&&function OZ(t,n,e){return e.some(i=>NM(t,n,i))}(t,e,i)?{segmentGroup:new uo(t.segments,kZ(t,e,i,t.children)),slicedSegments:e}:{segmentGroup:new uo(t.segments,t.children),slicedSegments:e}}function kZ(t,n,e,i){const r={};for(const l of e)if(NM(t,n,l)&&!i[Sh(l)]){const f=new uo([],{});r[Sh(l)]=f}return{...i,...r}}function RZ(t,n){const e={};e[dr]=n;for(const i of t)if(""===i.path&&Sh(i)!==dr){const r=new uo([],{});e[Sh(i)]=r}return e}function NM(t,n,e){return(!(t.hasChildren()||n.length>0)||"full"!==e.pathMatch)&&""===e.path}class LZ{}class BZ{injector;configLoader;rootComponentType;config;urlTree;paramsInheritanceStrategy;urlSerializer;applyRedirects;absoluteRedirectCount=0;allowRedirects=!0;constructor(n,e,i,r,l,f,w){this.injector=n,this.configLoader=e,this.rootComponentType=i,this.config=r,this.urlTree=l,this.paramsInheritanceStrategy=f,this.urlSerializer=w,this.applyRedirects=new TZ(this.urlSerializer,this.urlTree)}noMatchError(n){return new bt(4002,`'${n.segmentGroup}'`)}recognize(){const n=oB(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(n).pipe(an(({children:e,rootSnapshot:i})=>{const r=new Dh(i,e),l=new Yz("",r),f=function MY(t,n,e=null,i=null){return Nz(Lz(t),n,e,i)}(i,[],this.urlTree.queryParams,this.urlTree.fragment);return f.queryParams=this.urlTree.queryParams,l.url=this.urlSerializer.serialize(f),{state:l,tree:f}}))}match(n){const e=new RM([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,Object.freeze({}),dr,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,n,dr,e).pipe(an(i=>({children:i,rootSnapshot:e})),Kr(i=>{if(i instanceof O2)return this.urlTree=i.urlTree,this.match(i.urlTree.root);throw i instanceof P2?this.noMatchError(i):i}))}processSegmentGroup(n,e,i,r,l){return 0===i.segments.length&&i.hasChildren()?this.processChildren(n,e,i,l):this.processSegment(n,e,i,i.segments,r,!0,l).pipe(an(f=>f instanceof Dh?[f]:[]))}processChildren(n,e,i,r){const l=[];for(const f of Object.keys(i.children))"primary"===f?l.unshift(f):l.push(f);return qs(l).pipe(k0(f=>{const w=i.children[f],M=function YY(t,n){const e=t.filter(i=>Sh(i)===n);return e.push(...t.filter(i=>Sh(i)!==n)),e}(e,f);return this.processSegmentGroup(n,M,w,f,r)}),function J7(t,n){return Jn(function Q7(t,n,e,i,r){return(l,f)=>{let w=e,M=n,P=0;l.subscribe(li(f,L=>{const $=P++;M=w?t(M,L,$):(w=!0,L),i&&f.next(M)},r&&(()=>{w&&f.next(M),f.complete()})))}}(t,n,arguments.length>=2,!0))}((f,w)=>(f.push(...w),f)),vM(null),function eY(t,n){const e=arguments.length>=2;return i=>i.pipe(t?bs((r,l)=>t(r,l,i)):Ke,_2(1),e?vM(n):xz(()=>new _M))}(),Al(f=>{if(null===f)return N0(i);const w=sB(f);return function VZ(t){t.sort((n,e)=>n.value.outlet===dr?-1:e.value.outlet===dr?1:n.value.outlet.localeCompare(e.value.outlet))}(w),Fn(w)}))}processSegment(n,e,i,r,l,f,w){return qs(e).pipe(k0(M=>this.processSegmentAgainstRoute(M._injector??n,e,M,i,r,l,f,w).pipe(Kr(P=>{if(P instanceof P2)return Fn(null);throw P}))),By(M=>!!M),Kr(M=>{if(nB(M))return function FZ(t,n,e){return 0===n.length&&!t.children[e]}(i,r,l)?Fn(new LZ):N0(i);throw M}))}processSegmentAgainstRoute(n,e,i,r,l,f,w,M){return Sh(i)===f||f!==dr&&NM(r,l,i)?void 0===i.redirectTo?this.matchSegmentAgainstRoute(n,r,i,l,f,M):this.allowRedirects&&w?this.expandSegmentAgainstRouteUsingRedirect(n,r,e,i,l,f,M):N0(r):N0(r)}expandSegmentAgainstRouteUsingRedirect(n,e,i,r,l,f,w){const{matched:M,parameters:P,consumedSegments:L,positionalParamSegments:$,remainingSegments:Q}=rB(e,r,l);if(!M)return N0(e);"string"==typeof r.redirectTo&&"/"===r.redirectTo[0]&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>31&&(this.allowRedirects=!1));const X=new RM(l,P,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,aB(r),Sh(r),r.component??r._loadedComponent??null,r,lB(r)),Y=kM(X,w,this.paramsInheritanceStrategy);X.params=Object.freeze(Y.params),X.data=Object.freeze(Y.data);const K=this.applyRedirects.applyRedirectCommands(L,r.redirectTo,$,X,n);return this.applyRedirects.lineralizeSegments(r,K).pipe(Al(de=>this.processSegment(n,i,e,de.concat(Q),f,!1,w)))}matchSegmentAgainstRoute(n,e,i,r,l,f){const w=IZ(e,i,r,n);return"**"===i.path&&(e.children={}),w.pipe(lc(M=>M.matched?this.getChildConfig(n=i._injector??n,i,r).pipe(lc(({routes:P})=>{const L=i._loadedInjector??n,{parameters:$,consumedSegments:Q,remainingSegments:X}=M,Y=new RM(Q,$,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,aB(i),Sh(i),i.component??i._loadedComponent??null,i,lB(i)),K=kM(Y,f,this.paramsInheritanceStrategy);Y.params=Object.freeze(K.params),Y.data=Object.freeze(K.data);const{segmentGroup:de,slicedSegments:ye}=oB(e,Q,X,P);if(0===ye.length&&de.hasChildren())return this.processChildren(L,P,de,Y).pipe(an(Ce=>new Dh(Y,Ce)));if(0===P.length&&0===ye.length)return Fn(new Dh(Y,[]));const he=Sh(i)===l;return this.processSegment(L,P,de,ye,he?dr:l,!0,Y).pipe(an(Ce=>new Dh(Y,Ce instanceof Dh?[Ce]:[])))})):N0(e)))}getChildConfig(n,e,i){return e.children?Fn({routes:e.children,injector:n}):e.loadChildren?void 0!==e._loadedRoutes?Fn({routes:e._loadedRoutes,injector:e._loadedInjector}):function EZ(t,n,e,i){const r=n.canLoad;return void 0===r||0===r.length?Fn(!0):Fn(r.map(f=>{const w=F0(f,t);return Og(function dZ(t){return t&&yC(t.canLoad)}(w)?w.canLoad(n,e):Bs(t,()=>w(n,e)))})).pipe(L0(),iB())}(n,e,i).pipe(Al(r=>r?this.configLoader.loadChildren(n,e).pipe(Rr(l=>{e._loadedRoutes=l.routes,e._loadedInjector=l.injector})):function MZ(){return ra(Jz(!1,Td.GuardRejected))}())):Fn({routes:[],injector:n})}}function UZ(t){const n=t.value.routeConfig;return n&&""===n.path}function sB(t){const n=[],e=new Set;for(const i of t){if(!UZ(i)){n.push(i);continue}const r=n.find(l=>i.value.routeConfig===l.value.routeConfig);void 0!==r?(r.children.push(...i.children),e.add(r)):n.push(i)}for(const i of e){const r=sB(i.children);n.push(new Dh(i.value,r))}return n.filter(i=>!e.has(i))}function aB(t){return t.data||{}}function lB(t){return t.resolve||{}}function cB(t){const n=t.children.map(e=>cB(e)).flat();return[t,...n]}function L2(t){return lc(n=>{const e=t(n);return e?qs(e).pipe(an(()=>n)):Fn(n)})}let dB=(()=>{class t{buildTitle(e){let i,r=e.root;for(;void 0!==r;)i=this.getResolvedTitleForRoute(r)??i,r=r.children.find(l=>l.outlet===dr);return i}getResolvedTitleForRoute(e){return e.data[aC]}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:()=>te(WZ),providedIn:"root"})}return t})(),WZ=(()=>{class t extends dB{title;constructor(e){super(),this.title=e}updateTitle(e){const i=this.buildTitle(e);void 0!==i&&this.title.setTitle(i)}static \u0275fac=function(i){return new(i||t)(gn(tY))};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();const vC=new _t("",{providedIn:"root",factory:()=>({})});let uB=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275cmp=kn({type:t,selectors:[["ng-component"]],exportAs:["emptyRouterOutlet"],decls:1,vars:0,template:function(i,r){1&i&&Wt(0,"router-outlet")},dependencies:[k2],encapsulation:2})}return t})();function N2(t){const n=t.children&&t.children.map(N2),e=n?{...t,children:n}:{...t};return!e.component&&!e.loadComponent&&(n||e.loadChildren)&&e.outlet&&e.outlet!==dr&&(e.component=uB),e}const bC=new _t("");let z2=(()=>{class t{componentLoaders=new WeakMap;childrenLoaders=new WeakMap;onLoadStartListener;onLoadEndListener;compiler=te(pG);loadComponent(e){if(this.componentLoaders.get(e))return this.componentLoaders.get(e);if(e._loadedComponent)return Fn(e._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(e);const i=Og(e.loadComponent()).pipe(an(hB),Rr(l=>{this.onLoadEndListener&&this.onLoadEndListener(e),e._loadedComponent=l}),Vy(()=>{this.componentLoaders.delete(e)})),r=new g2(i,()=>new Et).pipe(m2());return this.componentLoaders.set(e,r),r}loadChildren(e,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return Fn({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);const l=function YZ(t,n,e,i){return Og(t.loadChildren()).pipe(an(hB),Al(r=>r instanceof LO||Array.isArray(r)?Fn(r):qs(n.compileModuleAsync(r))),an(r=>{i&&i(t);let l,f,w=!1;return Array.isArray(r)?(f=r,!0):(l=r.create(e).injector,f=l.get(bC,[],{optional:!0,self:!0}).flat()),{routes:f.map(N2),injector:l}}))}(i,this.compiler,e,this.onLoadEndListener).pipe(Vy(()=>{this.childrenLoaders.delete(i)})),f=new g2(l,()=>new Et).pipe(m2());return this.childrenLoaders.set(i,f),f}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function hB(t){return function ZZ(t){return t&&"object"==typeof t&&"default"in t}(t)?t.default:t}let B2=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:()=>te(XZ),providedIn:"root"})}return t})(),XZ=(()=>{class t{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,i){return e}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();const pB=new _t(""),fB=new _t("");function KZ(t,n,e){const i=t.get(fB),r=t.get(mr);return t.get(wt).runOutsideAngular(()=>{if(!r.startViewTransition||i.skipNextTransition)return i.skipNextTransition=!1,new Promise(P=>setTimeout(P));let l;const f=new Promise(P=>{l=P}),w=r.startViewTransition(()=>(l(),function QZ(t){return new Promise(n=>{El({read:()=>setTimeout(n)},{injector:t})})}(t))),{onViewTransitionCreated:M}=i;return M&&Bs(t,()=>M({transition:w,from:n,to:e})),f})}const mB=new _t("");let V2=(()=>{class t{currentNavigation=null;currentTransition=null;lastSuccessfulNavigation=null;events=new Et;transitionAbortSubject=new Et;configLoader=te(z2);environmentInjector=te(Lo);destroyRef=te(Oe);urlSerializer=te(cC);rootContexts=te(fC);location=te(M0);inputBindingEnabled=null!==te(PM,{optional:!0});titleStrategy=te(dB);options=te(vC,{optional:!0})||{};paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly";urlHandlingStrategy=te(B2);createViewTransition=te(pB,{optional:!0});navigationErrorHandler=te(mB,{optional:!0});navigationId=0;get hasRequestedNavigation(){return 0!==this.navigationId}transitions;afterPreactivation=()=>Fn(void 0);rootComponentType=null;destroyed=!1;constructor(){this.configLoader.onLoadEndListener=r=>this.events.next(new BY(r)),this.configLoader.onLoadStartListener=r=>this.events.next(new zY(r)),this.destroyRef.onDestroy(()=>{this.destroyed=!0})}complete(){this.transitions?.complete()}handleNavigationRequest(e){const i=++this.navigationId;this.transitions?.next({...e,extractedUrl:this.urlHandlingStrategy.extract(e.rawUrl),targetSnapshot:null,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null,id:i})}setupNavigations(e){return this.transitions=new pn(null),this.transitions.pipe(bs(i=>null!==i),lc(i=>{let r=!1,l=!1;return Fn(i).pipe(lc(f=>{if(this.navigationId>i.id)return this.cancelNavigationTransition(i,"",Td.SupersededByNewNavigation),Md;this.currentTransition=i,this.currentNavigation={id:f.id,initialUrl:f.rawUrl,extractedUrl:f.extractedUrl,targetBrowserUrl:"string"==typeof f.extras.browserUrl?this.urlSerializer.parse(f.extras.browserUrl):f.extras.browserUrl,trigger:f.source,extras:f.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null};const w=!e.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl();if(!w&&"reload"!==(f.extras.onSameUrlNavigation??e.onSameUrlNavigation)){const P="";return this.events.next(new P0(f.id,this.urlSerializer.serialize(f.rawUrl),P,IM.IgnoredSameUrlNavigation)),f.resolve(!1),Md}if(this.urlHandlingStrategy.shouldProcessUrl(f.rawUrl))return Fn(f).pipe(lc(P=>(this.events.next(new TM(P.id,this.urlSerializer.serialize(P.extractedUrl),P.source,P.restoredState)),P.id!==this.navigationId?Md:Promise.resolve(P))),function jZ(t,n,e,i,r,l){return Al(f=>function NZ(t,n,e,i,r,l,f="emptyOnly"){return new BZ(t,n,e,i,r,f,l).recognize()}(t,n,e,i,f.extractedUrl,r,l).pipe(an(({state:w,tree:M})=>({...f,targetSnapshot:w,urlAfterRedirects:M}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,e.config,this.urlSerializer,this.paramsInheritanceStrategy),Rr(P=>{i.targetSnapshot=P.targetSnapshot,i.urlAfterRedirects=P.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:P.urlAfterRedirects};const L=new Hz(P.id,this.urlSerializer.serialize(P.extractedUrl),this.urlSerializer.serialize(P.urlAfterRedirects),P.targetSnapshot);this.events.next(L)}));if(w&&this.urlHandlingStrategy.shouldProcessUrl(f.currentRawUrl)){const{id:P,extractedUrl:L,source:$,restoredState:Q,extras:X}=f,Y=new TM(P,this.urlSerializer.serialize(L),$,Q);this.events.next(Y);const K=Wz(this.rootComponentType).snapshot;return this.currentTransition=i={...f,targetSnapshot:K,urlAfterRedirects:L,extras:{...X,skipLocationChange:!1,replaceUrl:!1}},this.currentNavigation.finalUrl=L,Fn(i)}{const P="";return this.events.next(new P0(f.id,this.urlSerializer.serialize(f.extractedUrl),P,IM.IgnoredByUrlHandlingStrategy)),f.resolve(!1),Md}}),Rr(f=>{const w=new OY(f.id,this.urlSerializer.serialize(f.extractedUrl),this.urlSerializer.serialize(f.urlAfterRedirects),f.targetSnapshot);this.events.next(w)}),an(f=>(this.currentTransition=i={...f,guards:oZ(f.targetSnapshot,f.currentSnapshot,this.rootContexts)},i)),function gZ(t,n){return Al(e=>{const{targetSnapshot:i,currentSnapshot:r,guards:{canActivateChecks:l,canDeactivateChecks:f}}=e;return 0===f.length&&0===l.length?Fn({...e,guardsResult:!0}):function _Z(t,n,e,i){return qs(t).pipe(Al(r=>function CZ(t,n,e,i,r){const l=n&&n.routeConfig?n.routeConfig.canDeactivate:null;return l&&0!==l.length?Fn(l.map(w=>{const M=pC(n)??r,P=F0(w,M);return Og(function pZ(t){return t&&yC(t.canDeactivate)}(P)?P.canDeactivate(t,n,e,i):Bs(M,()=>P(t,n,e,i))).pipe(By())})).pipe(L0()):Fn(!0)}(r.component,r.route,e,n,i)),By(r=>!0!==r,!0))}(f,i,r,t).pipe(Al(w=>w&&function cZ(t){return"boolean"==typeof t}(w)?function yZ(t,n,e,i){return qs(n).pipe(k0(r=>yM(function bZ(t,n){return null!==t&&n&&n(new VY(t)),Fn(!0)}(r.route.parent,i),function vZ(t,n){return null!==t&&n&&n(new jY(t)),Fn(!0)}(r.route,i),function wZ(t,n,e){const i=n[n.length-1],l=n.slice(0,n.length-1).reverse().map(f=>function sZ(t){const n=t.routeConfig?t.routeConfig.canActivateChild:null;return n&&0!==n.length?{node:t,guards:n}:null}(f)).filter(f=>null!==f).map(f=>oC(()=>Fn(f.guards.map(M=>{const P=pC(f.node)??e,L=F0(M,P);return Og(function hZ(t){return t&&yC(t.canActivateChild)}(L)?L.canActivateChild(i,t):Bs(P,()=>L(i,t))).pipe(By())})).pipe(L0())));return Fn(l).pipe(L0())}(t,r.path,e),function xZ(t,n,e){const i=n.routeConfig?n.routeConfig.canActivate:null;if(!i||0===i.length)return Fn(!0);const r=i.map(l=>oC(()=>{const f=pC(n)??e,w=F0(l,f);return Og(function uZ(t){return t&&yC(t.canActivate)}(w)?w.canActivate(n,t):Bs(f,()=>w(n,t))).pipe(By())}));return Fn(r).pipe(L0())}(t,r.route,e))),By(r=>!0!==r,!0))}(i,l,t,n):Fn(w)),an(w=>({...e,guardsResult:w})))})}(this.environmentInjector,f=>this.events.next(f)),Rr(f=>{if(i.guardsResult=f.guardsResult,f.guardsResult&&"boolean"!=typeof f.guardsResult)throw OM(0,f.guardsResult);const w=new FY(f.id,this.urlSerializer.serialize(f.extractedUrl),this.urlSerializer.serialize(f.urlAfterRedirects),f.targetSnapshot,!!f.guardsResult);this.events.next(w)}),bs(f=>!!f.guardsResult||(this.cancelNavigationTransition(f,"",Td.GuardRejected),!1)),L2(f=>{if(0!==f.guards.canActivateChecks.length)return Fn(f).pipe(Rr(w=>{const M=new LY(w.id,this.urlSerializer.serialize(w.extractedUrl),this.urlSerializer.serialize(w.urlAfterRedirects),w.targetSnapshot);this.events.next(M)}),lc(w=>{let M=!1;return Fn(w).pipe(function HZ(t,n){return Al(e=>{const{targetSnapshot:i,guards:{canActivateChecks:r}}=e;if(!r.length)return Fn(e);const l=new Set(r.map(M=>M.route)),f=new Set;for(const M of l)if(!f.has(M))for(const P of cB(M))f.add(P);let w=0;return qs(f).pipe(k0(M=>l.has(M)?function $Z(t,n,e,i){const r=t.routeConfig,l=t._resolve;return void 0!==r?.title&&!Xz(r)&&(l[aC]=r.title),function GZ(t,n,e,i){const r=v2(t);if(0===r.length)return Fn({});const l={};return qs(r).pipe(Al(f=>function qZ(t,n,e,i){const r=pC(n)??i,l=F0(t,r);return Og(l.resolve?l.resolve(n,e):Bs(r,()=>l(n,e)))}(t[f],n,e,i).pipe(By(),Rr(w=>{if(w instanceof R2)throw OM(new xM,w);l[f]=w}))),_2(1),an(()=>l),Kr(f=>nB(f)?Md:ra(f)))}(l,t,n,i).pipe(an(f=>(t._resolvedData=f,t.data=kM(t,t.parent,e).resolve,null)))}(M,i,t,n):(M.data=kM(M,M.parent,t).resolve,Fn(void 0))),Rr(()=>w++),_2(1),Al(M=>w===f.size?Fn(e):Md))})}(this.paramsInheritanceStrategy,this.environmentInjector),Rr({next:()=>M=!0,complete:()=>{M||this.cancelNavigationTransition(w,"",Td.NoDataFromResolver)}}))}),Rr(w=>{const M=new NY(w.id,this.urlSerializer.serialize(w.extractedUrl),this.urlSerializer.serialize(w.urlAfterRedirects),w.targetSnapshot);this.events.next(M)}))}),L2(f=>{const w=M=>{const P=[];M.routeConfig?.loadComponent&&!M.routeConfig._loadedComponent&&P.push(this.configLoader.loadComponent(M.routeConfig).pipe(Rr(L=>{M.component=L}),an(()=>{})));for(const L of M.children)P.push(...w(L));return P};return zy(w(f.targetSnapshot.root)).pipe(vM(null),Qa(1))}),L2(()=>this.afterPreactivation()),lc(()=>{const{currentSnapshot:f,targetSnapshot:w}=i,M=this.createViewTransition?.(this.environmentInjector,f.root,w.root);return M?qs(M).pipe(an(()=>i)):Fn(i)}),an(f=>{const w=function JY(t,n,e){const i=mC(t,n._root,e?e._root:void 0);return new qz(i,n)}(e.routeReuseStrategy,f.targetSnapshot,f.currentRouterState);return this.currentTransition=i={...f,targetRouterState:w},this.currentNavigation.targetRouterState=w,i}),Rr(()=>{this.events.next(new S2)}),((t,n,e,i)=>an(r=>(new rZ(n,r.targetRouterState,r.currentRouterState,e,i).activate(t),r)))(this.rootContexts,e.routeReuseStrategy,f=>this.events.next(f),this.inputBindingEnabled),Qa(1),Rr({next:f=>{r=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new om(f.id,this.urlSerializer.serialize(f.extractedUrl),this.urlSerializer.serialize(f.urlAfterRedirects))),this.titleStrategy?.updateTitle(f.targetRouterState.snapshot),f.resolve(!0)},complete:()=>{r=!0}}),jr(this.transitionAbortSubject.pipe(Rr(f=>{throw f}))),Vy(()=>{!r&&!l&&this.cancelNavigationTransition(i,"",Td.SupersededByNewNavigation),this.currentTransition?.id===i.id&&(this.currentNavigation=null,this.currentTransition=null)}),Kr(f=>{if(this.destroyed)return i.resolve(!1),Md;if(l=!0,eB(f))this.events.next(new $y(i.id,this.urlSerializer.serialize(i.extractedUrl),f.message,f.cancellationCode)),function nZ(t){return eB(t)&&Hy(t.url)}(f)?this.events.next(new AM(f.url,f.navigationBehaviorOptions)):i.resolve(!1);else{const w=new E2(i.id,this.urlSerializer.serialize(i.extractedUrl),f,i.targetSnapshot??void 0);try{const M=Bs(this.environmentInjector,()=>this.navigationErrorHandler?.(w));if(!(M instanceof R2))throw this.events.next(w),f;{const{message:P,cancellationCode:L}=OM(0,M);this.events.next(new $y(i.id,this.urlSerializer.serialize(i.extractedUrl),P,L)),this.events.next(new AM(M.redirectTo,M.navigationBehaviorOptions))}}catch(M){this.options.resolveNavigationPromiseOnError?i.resolve(!1):i.reject(M)}}return Md}))}))}cancelNavigationTransition(e,i,r){const l=new $y(e.id,this.urlSerializer.serialize(e.extractedUrl),i,r);this.events.next(l),e.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){const e=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),i=this.currentNavigation?.targetBrowserUrl??this.currentNavigation?.extractedUrl;return e.toString()!==i?.toString()&&!this.currentNavigation?.extras.skipLocationChange}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function JZ(t){return t!==MM}let eX=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:()=>te(nX),providedIn:"root"})}return t})();class tX{shouldDetach(n){return!1}store(n,e){}shouldAttach(n){return!1}retrieve(n){return null}shouldReuseRoute(n,e){return n.routeConfig===e.routeConfig}}let nX=(()=>{class t extends tX{static \u0275fac=(()=>{let e;return function(r){return(e||(e=m(t)))(r||t)}})();static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),gB=(()=>{class t{urlSerializer=te(cC);options=te(vC,{optional:!0})||{};canceledNavigationResolution=this.options.canceledNavigationResolution||"replace";location=te(M0);urlHandlingStrategy=te(B2);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";currentUrlTree=new Uy;getCurrentUrlTree(){return this.currentUrlTree}rawUrlTree=this.currentUrlTree;getRawUrlTree(){return this.rawUrlTree}createBrowserPath({finalUrl:e,initialUrl:i,targetBrowserUrl:r}){const l=void 0!==e?this.urlHandlingStrategy.merge(e,i):i,f=r??l;return f instanceof Uy?this.urlSerializer.serialize(f):f}commitTransition({targetRouterState:e,finalUrl:i,initialUrl:r}){i&&e?(this.currentUrlTree=i,this.rawUrlTree=this.urlHandlingStrategy.merge(i,r),this.routerState=e):this.rawUrlTree=r}routerState=Wz(null);getRouterState(){return this.routerState}stateMemento=this.createStateMemento();updateStateMemento(){this.stateMemento=this.createStateMemento()}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}resetInternalState({finalUrl:e}){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e??this.rawUrlTree)}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:()=>te(iX),providedIn:"root"})}return t})(),iX=(()=>{class t extends gB{currentPageId=0;lastSuccessfulId=-1;restoredState(){return this.location.getState()}get browserPageId(){return"computed"!==this.canceledNavigationResolution?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}registerNonRouterCurrentEntryChangeListener(e){return this.location.subscribe(i=>{"popstate"===i.type&&setTimeout(()=>{e(i.url,i.state,"popstate")})})}handleRouterEvent(e,i){e instanceof TM?this.updateStateMemento():e instanceof P0?this.commitTransition(i):e instanceof Hz?"eager"===this.urlUpdateStrategy&&(i.extras.skipLocationChange||this.setBrowserUrl(this.createBrowserPath(i),i)):e instanceof S2?(this.commitTransition(i),"deferred"===this.urlUpdateStrategy&&!i.extras.skipLocationChange&&this.setBrowserUrl(this.createBrowserPath(i),i)):e instanceof $y&&(e.code===Td.GuardRejected||e.code===Td.NoDataFromResolver)?this.restoreHistory(i):e instanceof E2?this.restoreHistory(i,!0):e instanceof om&&(this.lastSuccessfulId=e.id,this.currentPageId=this.browserPageId)}setBrowserUrl(e,{extras:i,id:r}){const{replaceUrl:l,state:f}=i;if(this.location.isCurrentPathEqualTo(e)||l){const w=this.browserPageId,M={...f,...this.generateNgRouterState(r,w)};this.location.replaceState(e,"",M)}else{const w={...f,...this.generateNgRouterState(r,this.browserPageId+1)};this.location.go(e,"",w)}}restoreHistory(e,i=!1){if("computed"===this.canceledNavigationResolution){const l=this.currentPageId-this.browserPageId;0!==l?this.location.historyGo(l):this.getCurrentUrlTree()===e.finalUrl&&0===l&&(this.resetInternalState(e),this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(i&&this.resetInternalState(e),this.resetUrlToCurrentUrlTree())}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.getRawUrlTree()),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(e,i){return"computed"===this.canceledNavigationResolution?{navigationId:e,\u0275routerPageId:i}:{navigationId:e}}static \u0275fac=(()=>{let e;return function(r){return(e||(e=m(t)))(r||t)}})();static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function _B(t,n){t.events.pipe(bs(e=>e instanceof om||e instanceof $y||e instanceof E2||e instanceof P0),an(e=>e instanceof om||e instanceof P0?0:e instanceof $y&&(e.code===Td.Redirect||e.code===Td.SupersededByNewNavigation)?2:1),bs(e=>2!==e),Qa(1)).subscribe(()=>{n()})}const rX={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},oX={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let oo=(()=>{class t{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}disposed=!1;nonRouterCurrentEntryChangeSubscription;console=te(jA);stateManager=te(gB);options=te(vC,{optional:!0})||{};pendingTasks=te(Be);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";navigationTransitions=te(V2);urlSerializer=te(cC);location=te(M0);urlHandlingStrategy=te(B2);_events=new Et;get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}navigated=!1;routeReuseStrategy=te(eX);onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore";config=te(bC,{optional:!0})?.flat()??[];componentInputBindingEnabled=!!te(PM,{optional:!0});constructor(){this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this).subscribe({error:e=>{this.console.warn(e)}}),this.subscribeToNavigationEvents()}eventsSubscription=new Mi;subscribeToNavigationEvents(){const e=this.navigationTransitions.events.subscribe(i=>{try{const r=this.navigationTransitions.currentTransition,l=this.navigationTransitions.currentNavigation;if(null!==r&&null!==l)if(this.stateManager.handleRouterEvent(i,l),i instanceof $y&&i.code!==Td.Redirect&&i.code!==Td.SupersededByNewNavigation)this.navigated=!0;else if(i instanceof om)this.navigated=!0;else if(i instanceof AM){const f=i.navigationBehaviorOptions,w=this.urlHandlingStrategy.merge(i.url,r.currentRawUrl),M={browserUrl:r.extras.browserUrl,info:r.extras.info,skipLocationChange:r.extras.skipLocationChange,replaceUrl:r.extras.replaceUrl||"eager"===this.urlUpdateStrategy||JZ(r.source),...f};this.scheduleNavigation(w,MM,null,M,{resolve:r.resolve,reject:r.reject,promise:r.promise})}(function aX(t){return!(t instanceof S2||t instanceof AM)})(i)&&this._events.next(i)}catch(r){this.navigationTransitions.transitionAbortSubject.next(r)}});this.eventsSubscription.add(e)}resetRootComponentType(e){this.routerState.root.component=e,this.navigationTransitions.rootComponentType=e}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),MM,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((e,i,r)=>{this.navigateToSyncWithBrowser(e,r,i)})}navigateToSyncWithBrowser(e,i,r){const l={replaceUrl:!0},f=r?.navigationId?r:null;if(r){const M={...r};delete M.navigationId,delete M.\u0275routerPageId,0!==Object.keys(M).length&&(l.state=M)}const w=this.parseUrl(e);this.scheduleNavigation(w,i,f,l)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(e){this.config=e.map(N2),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this._events.unsubscribe(),this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(e,i={}){const{relativeTo:r,queryParams:l,fragment:f,queryParamsHandling:w,preserveFragment:M}=i,P=M?this.currentUrlTree.fragment:f;let $,L=null;switch(w??this.options.defaultQueryParamsHandling){case"merge":L={...this.currentUrlTree.queryParams,...l};break;case"preserve":L=this.currentUrlTree.queryParams;break;default:L=l||null}null!==L&&(L=this.removeEmptyProps(L));try{$=Lz(r?r.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof e[0]||"/"!==e[0][0])&&(e=[]),$=this.currentUrlTree.root}return Nz($,e,L,P??null)}navigateByUrl(e,i={skipLocationChange:!1}){const r=Hy(e)?e:this.parseUrl(e),l=this.urlHandlingStrategy.merge(r,this.rawUrlTree);return this.scheduleNavigation(l,MM,null,i)}navigate(e,i={skipLocationChange:!1}){return function sX(t){for(let n=0;n<t.length;n++)if(null==t[n])throw new bt(4008,!1)}(e),this.navigateByUrl(this.createUrlTree(e,i),i)}serializeUrl(e){return this.urlSerializer.serialize(e)}parseUrl(e){try{return this.urlSerializer.parse(e)}catch{return this.urlSerializer.parse("/")}}isActive(e,i){let r;if(r=!0===i?{...rX}:!1===i?{...oX}:i,Hy(e))return Mz(this.currentUrlTree,e,r);const l=this.parseUrl(e);return Mz(this.currentUrlTree,l,r)}removeEmptyProps(e){return Object.entries(e).reduce((i,[r,l])=>(null!=l&&(i[r]=l),i),{})}scheduleNavigation(e,i,r,l,f){if(this.disposed)return Promise.resolve(!1);let w,M,P;f?(w=f.resolve,M=f.reject,P=f.promise):P=new Promise(($,Q)=>{w=$,M=Q});const L=this.pendingTasks.add();return _B(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(L))}),this.navigationTransitions.handleNavigationRequest({source:i,restoredState:r,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:e,extras:l,resolve:w,reject:M,promise:P,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),P.catch($=>Promise.reject($))}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),xC=(()=>{class t{router;route;tabIndexAttribute;renderer;el;locationStrategy;href=null;target;queryParams;fragment;queryParamsHandling;state;info;relativeTo;isAnchorElement;subscription;onChanges=new Et;constructor(e,i,r,l,f,w){this.router=e,this.route=i,this.tabIndexAttribute=r,this.renderer=l,this.el=f,this.locationStrategy=w;const M=f.nativeElement.tagName?.toLowerCase();this.isAnchorElement="a"===M||"area"===M,this.isAnchorElement?this.subscription=e.events.subscribe(P=>{P instanceof om&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}preserveFragment=!1;skipLocationChange=!1;replaceUrl=!1;setTabIndexIfNotOnNativeEl(e){null!=this.tabIndexAttribute||this.isAnchorElement||this.applyAttributeValue("tabindex",e)}ngOnChanges(e){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}routerLinkInput=null;set routerLink(e){null==e?(this.routerLinkInput=null,this.setTabIndexIfNotOnNativeEl(null)):(this.routerLinkInput=Hy(e)||Array.isArray(e)?e:[e],this.setTabIndexIfNotOnNativeEl("0"))}onClick(e,i,r,l,f){const w=this.urlTree;return!!(null===w||this.isAnchorElement&&(0!==e||i||r||l||f||"string"==typeof this.target&&"_self"!=this.target))||(this.router.navigateByUrl(w,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info}),!this.isAnchorElement)}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){const e=this.urlTree;this.href=null!==e&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(e)):null;const i=null===this.href?null:function Mw(t,n,e){return function NI(t,n){return"src"===n&&("embed"===t||"frame"===t||"iframe"===t||"media"===t||"script"===t)||"href"===n&&("base"===t||"link"===t)?vS:vp}(n,e)(t)}(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",i)}applyAttributeValue(e,i){const r=this.renderer,l=this.el.nativeElement;null!==i?r.setAttribute(l,e,i):r.removeAttribute(l,e)}get urlTree(){return null===this.routerLinkInput?null:Hy(this.routerLinkInput)?this.routerLinkInput:this.router.createUrlTree(this.routerLinkInput,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}static \u0275fac=function(i){return new(i||t)(ft(oo),ft(Fg),v("tabindex"),ft(yt),ft(Dn),ft(Ny))};static \u0275dir=Ht({type:t,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(i,r){1&i&&Tt("click",function(f){return r.onClick(f.button,f.ctrlKey,f.shiftKey,f.altKey,f.metaKey)}),2&i&&ii("target",r.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[2,"preserveFragment","preserveFragment",Un],skipLocationChange:[2,"skipLocationChange","skipLocationChange",Un],replaceUrl:[2,"replaceUrl","replaceUrl",Un],routerLink:"routerLink"},features:[Mr]})}return t})();class yB{}let dX=(()=>{class t{router;injector;preloadingStrategy;loader;subscription;constructor(e,i,r,l){this.router=e,this.injector=i,this.preloadingStrategy=r,this.loader=l}setUpPreloading(){this.subscription=this.router.events.pipe(bs(e=>e instanceof om),k0(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(e,i){const r=[];for(const l of i){l.providers&&!l._injector&&(l._injector=DD(l.providers,e,`Route: ${l.path}`));const f=l._injector??e,w=l._loadedInjector??f;(l.loadChildren&&!l._loadedRoutes&&void 0===l.canLoad||l.loadComponent&&!l._loadedComponent)&&r.push(this.preloadConfig(f,l)),(l.children||l._loadedRoutes)&&r.push(this.processRoutes(w,l.children??l._loadedRoutes))}return qs(r).pipe(A0())}preloadConfig(e,i){return this.preloadingStrategy.preload(i,()=>{let r;r=i.loadChildren&&void 0===i.canLoad?this.loader.loadChildren(e,i):Fn(null);const l=r.pipe(Al(f=>null===f?Fn(void 0):(i._loadedRoutes=f.routes,i._loadedInjector=f.injector,this.processRoutes(f.injector??e,f.routes))));return i.loadComponent&&!i._loadedComponent?qs([l,this.loader.loadComponent(i)]).pipe(A0()):l})}static \u0275fac=function(i){return new(i||t)(gn(oo),gn(Lo),gn(yB),gn(z2))};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();const U2=new _t("");let vB=(()=>{class t{urlSerializer;transitions;viewportScroller;zone;options;routerEventsSubscription;scrollEventsSubscription;lastId=0;lastSource="imperative";restoredId=0;store={};constructor(e,i,r,l,f={}){this.urlSerializer=e,this.transitions=i,this.viewportScroller=r,this.zone=l,this.options=f,f.scrollPositionRestoration||="disabled",f.anchorScrolling||="disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(e=>{e instanceof TM?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=e.navigationTrigger,this.restoredId=e.restoredState?e.restoredState.navigationId:0):e instanceof om?(this.lastId=e.id,this.scheduleScrollEvent(e,this.urlSerializer.parse(e.urlAfterRedirects).fragment)):e instanceof P0&&e.code===IM.IgnoredSameUrlNavigation&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(e,this.urlSerializer.parse(e.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(e=>{e instanceof $z&&(e.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(e.position):e.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(e.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(e,i){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new $z(e,"popstate"===this.lastSource?this.store[this.restoredId]:null,i))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static \u0275fac=function(i){Or()};static \u0275prov=Nt({token:t,factory:t.\u0275fac})}return t})();function bB(t){return t.routerState.root}function Fp(t,n){return{\u0275kind:t,\u0275providers:n}}function xB(){const t=te(we);return n=>{const e=t.get(ic);if(n!==e.components[0])return;const i=t.get(oo),r=t.get(wB);1===t.get(j2)&&i.initialNavigation(),t.get(CB,null,rr.Optional)?.setUpPreloading(),t.get(U2,null,rr.Optional)?.init(),i.resetRootComponentType(e.componentTypes[0]),r.closed||(r.next(),r.complete(),r.unsubscribe())}}const wB=new _t("",{factory:()=>new Et}),j2=new _t("",{providedIn:"root",factory:()=>1}),CB=new _t("");function mX(t){return Fp(0,[{provide:CB,useExisting:dX},{provide:yB,useExisting:t}])}function _X(t){return Cl("NgRouterViewTransitions"),Fp(9,[{provide:pB,useValue:KZ},{provide:fB,useValue:{skipNextTransition:!!t?.skipInitialTransition,...t}}])}const yX=[M0,{provide:cC,useClass:xM},oo,fC,{provide:Fg,useFactory:bB,deps:[oo]},z2,[]];let z0=(()=>{class t{constructor(){}static forRoot(e,i){return{ngModule:t,providers:[yX,[],{provide:bC,multi:!0,useValue:e},[],i?.errorHandler?{provide:mB,useValue:i.errorHandler}:[],{provide:vC,useValue:i||{}},i?.useHash?{provide:Ny,useClass:pW}:{provide:Ny,useClass:d3},{provide:U2,useFactory:()=>{const t=te(E9),n=te(wt),e=te(vC),i=te(V2),r=te(cC);return e.scrollOffset&&t.setOffset(e.scrollOffset),new vB(r,i,t,n,e)}},i?.preloadingStrategy?mX(i.preloadingStrategy).\u0275providers:[],i?.initialNavigation?wX(i):[],i?.bindToComponentInputs?Fp(8,[Kz,{provide:PM,useExisting:Kz}]).\u0275providers:[],i?.enableViewTransitions?_X().\u0275providers:[],[{provide:EB,useFactory:xB},{provide:u0,multi:!0,useExisting:EB}]]}}static forChild(e){return{ngModule:t,providers:[{provide:bC,multi:!0,useValue:e}]}}static \u0275fac=function(i){return new(i||t)};static \u0275mod=Er({type:t});static \u0275inj=Ai({})}return t})();function wX(t){return["disabled"===t.initialNavigation?Fp(3,[cF(()=>{te(oo).setUpLocationChangeListener()}),{provide:j2,useValue:2}]).\u0275providers:[],"enabledBlocking"===t.initialNavigation?Fp(2,[{provide:j2,useValue:0},cF(()=>{const n=te(we);return n.get(Fq,Promise.resolve()).then(()=>new Promise(i=>{const r=n.get(oo),l=n.get(wB);_B(r,()=>{i(!0)}),n.get(V2).afterPreactivation=()=>(i(!0),l.closed?Fn(void 0):l),r.initialNavigation()}))})]).\u0275providers:[]]}const EB=new _t(""),Cu_urlBack="https://maphoppernube.onrender.com/api/v1";class zM{}class BM{}class Mh{headers;normalizedNames=new Map;lazyInit;lazyUpdate=null;constructor(n){n?"string"==typeof n?this.lazyInit=()=>{this.headers=new Map,n.split("\n").forEach(e=>{const i=e.indexOf(":");if(i>0){const r=e.slice(0,i),l=e.slice(i+1).trim();this.addHeaderEntry(r,l)}})}:typeof Headers<"u"&&n instanceof Headers?(this.headers=new Map,n.forEach((e,i)=>{this.addHeaderEntry(i,e)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(n).forEach(([e,i])=>{this.setHeaderEntries(e,i)})}:this.headers=new Map}has(n){return this.init(),this.headers.has(n.toLowerCase())}get(n){this.init();const e=this.headers.get(n.toLowerCase());return e&&e.length>0?e[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(n){return this.init(),this.headers.get(n.toLowerCase())||null}append(n,e){return this.clone({name:n,value:e,op:"a"})}set(n,e){return this.clone({name:n,value:e,op:"s"})}delete(n,e){return this.clone({name:n,value:e,op:"d"})}maybeSetNormalizedName(n,e){this.normalizedNames.has(e)||this.normalizedNames.set(e,n)}init(){this.lazyInit&&(this.lazyInit instanceof Mh?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(n=>this.applyUpdate(n)),this.lazyUpdate=null))}copyFrom(n){n.init(),Array.from(n.headers.keys()).forEach(e=>{this.headers.set(e,n.headers.get(e)),this.normalizedNames.set(e,n.normalizedNames.get(e))})}clone(n){const e=new Mh;return e.lazyInit=this.lazyInit&&this.lazyInit instanceof Mh?this.lazyInit:this,e.lazyUpdate=(this.lazyUpdate||[]).concat([n]),e}applyUpdate(n){const e=n.name.toLowerCase();switch(n.op){case"a":case"s":let i=n.value;if("string"==typeof i&&(i=[i]),0===i.length)return;this.maybeSetNormalizedName(n.name,e);const r=("a"===n.op?this.headers.get(e):void 0)||[];r.push(...i),this.headers.set(e,r);break;case"d":const l=n.value;if(l){let f=this.headers.get(e);if(!f)return;f=f.filter(w=>-1===l.indexOf(w)),0===f.length?(this.headers.delete(e),this.normalizedNames.delete(e)):this.headers.set(e,f)}else this.headers.delete(e),this.normalizedNames.delete(e)}}addHeaderEntry(n,e){const i=n.toLowerCase();this.maybeSetNormalizedName(n,i),this.headers.has(i)?this.headers.get(i).push(e):this.headers.set(i,[e])}setHeaderEntries(n,e){const i=(Array.isArray(e)?e:[e]).map(l=>l.toString()),r=n.toLowerCase();this.headers.set(r,i),this.maybeSetNormalizedName(n,r)}forEach(n){this.init(),Array.from(this.normalizedNames.keys()).forEach(e=>n(this.normalizedNames.get(e),this.headers.get(e)))}}class EX{encodeKey(n){return SB(n)}encodeValue(n){return SB(n)}decodeKey(n){return decodeURIComponent(n)}decodeValue(n){return decodeURIComponent(n)}}const DX=/%(\d[a-f0-9])/gi,MX={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function SB(t){return encodeURIComponent(t).replace(DX,(n,e)=>MX[e]??n)}function VM(t){return`${t}`}class kl{map;encoder;updates=null;cloneFrom=null;constructor(n={}){if(this.encoder=n.encoder||new EX,n.fromString){if(n.fromObject)throw new bt(2805,!1);this.map=function SX(t,n){const e=new Map;return t.length>0&&t.replace(/^\?/,"").split("&").forEach(r=>{const l=r.indexOf("="),[f,w]=-1==l?[n.decodeKey(r),""]:[n.decodeKey(r.slice(0,l)),n.decodeValue(r.slice(l+1))],M=e.get(f)||[];M.push(w),e.set(f,M)}),e}(n.fromString,this.encoder)}else n.fromObject?(this.map=new Map,Object.keys(n.fromObject).forEach(e=>{const i=n.fromObject[e],r=Array.isArray(i)?i.map(VM):[VM(i)];this.map.set(e,r)})):this.map=null}has(n){return this.init(),this.map.has(n)}get(n){this.init();const e=this.map.get(n);return e?e[0]:null}getAll(n){return this.init(),this.map.get(n)||null}keys(){return this.init(),Array.from(this.map.keys())}append(n,e){return this.clone({param:n,value:e,op:"a"})}appendAll(n){const e=[];return Object.keys(n).forEach(i=>{const r=n[i];Array.isArray(r)?r.forEach(l=>{e.push({param:i,value:l,op:"a"})}):e.push({param:i,value:r,op:"a"})}),this.clone(e)}set(n,e){return this.clone({param:n,value:e,op:"s"})}delete(n,e){return this.clone({param:n,value:e,op:"d"})}toString(){return this.init(),this.keys().map(n=>{const e=this.encoder.encodeKey(n);return this.map.get(n).map(i=>e+"="+this.encoder.encodeValue(i)).join("&")}).filter(n=>""!==n).join("&")}clone(n){const e=new kl({encoder:this.encoder});return e.cloneFrom=this.cloneFrom||this,e.updates=(this.updates||[]).concat(n),e}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(n=>this.map.set(n,this.cloneFrom.map.get(n))),this.updates.forEach(n=>{switch(n.op){case"a":case"s":const e=("a"===n.op?this.map.get(n.param):void 0)||[];e.push(VM(n.value)),this.map.set(n.param,e);break;case"d":if(void 0===n.value){this.map.delete(n.param);break}{let i=this.map.get(n.param)||[];const r=i.indexOf(VM(n.value));-1!==r&&i.splice(r,1),i.length>0?this.map.set(n.param,i):this.map.delete(n.param)}}}),this.cloneFrom=this.updates=null)}}class TX{map=new Map;set(n,e){return this.map.set(n,e),this}get(n){return this.map.has(n)||this.map.set(n,n.defaultValue()),this.map.get(n)}delete(n){return this.map.delete(n),this}has(n){return this.map.has(n)}keys(){return this.map.keys()}}function DB(t){return typeof ArrayBuffer<"u"&&t instanceof ArrayBuffer}function MB(t){return typeof Blob<"u"&&t instanceof Blob}function TB(t){return typeof FormData<"u"&&t instanceof FormData}const wC="Content-Type",H2="X-Request-URL",IB="text/plain",AB="application/json",kB=`${AB}, ${IB}, */*`;class CC{url;body=null;headers;context;reportProgress=!1;withCredentials=!1;responseType="json";method;params;urlWithParams;transferCache;constructor(n,e,i,r){let l;if(this.url=e,this.method=n.toUpperCase(),function IX(t){switch(t){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||r?(this.body=void 0!==i?i:null,l=r):l=i,l&&(this.reportProgress=!!l.reportProgress,this.withCredentials=!!l.withCredentials,l.responseType&&(this.responseType=l.responseType),l.headers&&(this.headers=l.headers),l.context&&(this.context=l.context),l.params&&(this.params=l.params),this.transferCache=l.transferCache),this.headers??=new Mh,this.context??=new TX,this.params){const f=this.params.toString();if(0===f.length)this.urlWithParams=e;else{const w=e.indexOf("?");this.urlWithParams=e+(-1===w?"?":w<e.length-1?"&":"")+f}}else this.params=new kl,this.urlWithParams=e}serializeBody(){return null===this.body?null:"string"==typeof this.body||DB(this.body)||MB(this.body)||TB(this.body)||function AX(t){return typeof URLSearchParams<"u"&&t instanceof URLSearchParams}(this.body)?this.body:this.body instanceof kl?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||TB(this.body)?null:MB(this.body)?this.body.type||null:DB(this.body)?null:"string"==typeof this.body?IB:this.body instanceof kl?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?AB:null}clone(n={}){const e=n.method||this.method,i=n.url||this.url,r=n.responseType||this.responseType,l=n.transferCache??this.transferCache,f=void 0!==n.body?n.body:this.body,w=n.withCredentials??this.withCredentials,M=n.reportProgress??this.reportProgress;let P=n.headers||this.headers,L=n.params||this.params;const $=n.context??this.context;return void 0!==n.setHeaders&&(P=Object.keys(n.setHeaders).reduce((Q,X)=>Q.set(X,n.setHeaders[X]),P)),n.setParams&&(L=Object.keys(n.setParams).reduce((Q,X)=>Q.set(X,n.setParams[X]),L)),new CC(e,i,f,{params:L,headers:P,context:$,reportProgress:M,responseType:r,withCredentials:w,transferCache:l})}}var Lg=function(t){return t[t.Sent=0]="Sent",t[t.UploadProgress=1]="UploadProgress",t[t.ResponseHeader=2]="ResponseHeader",t[t.DownloadProgress=3]="DownloadProgress",t[t.Response=4]="Response",t[t.User=5]="User",t}(Lg||{});class $2{headers;status;statusText;url;ok;type;constructor(n,e=200,i="OK"){this.headers=n.headers||new Mh,this.status=void 0!==n.status?n.status:e,this.statusText=n.statusText||i,this.url=n.url||null,this.ok=this.status>=200&&this.status<300}}class jM extends $2{constructor(n={}){super(n)}type=Lg.ResponseHeader;clone(n={}){return new jM({headers:n.headers||this.headers,status:void 0!==n.status?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}}class EC extends $2{body;constructor(n={}){super(n),this.body=void 0!==n.body?n.body:null}type=Lg.Response;clone(n={}){return new EC({body:void 0!==n.body?n.body:this.body,headers:n.headers||this.headers,status:void 0!==n.status?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}}class B0 extends $2{name="HttpErrorResponse";message;error;ok=!1;constructor(n){super(n,0,"Unknown Error"),this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${n.url||"(unknown url)"}`:`Http failure response for ${n.url||"(unknown url)"}: ${n.status} ${n.statusText}`,this.error=n.error||null}}function G2(t,n){return{body:n,headers:t.headers,context:t.context,observe:t.observe,params:t.params,reportProgress:t.reportProgress,responseType:t.responseType,withCredentials:t.withCredentials,transferCache:t.transferCache}}let Eu=(()=>{class t{handler;constructor(e){this.handler=e}request(e,i,r={}){let l;if(e instanceof CC)l=e;else{let M,P;M=r.headers instanceof Mh?r.headers:new Mh(r.headers),r.params&&(P=r.params instanceof kl?r.params:new kl({fromObject:r.params})),l=new CC(e,i,void 0!==r.body?r.body:null,{headers:M,context:r.context,params:P,reportProgress:r.reportProgress,responseType:r.responseType||"json",withCredentials:r.withCredentials,transferCache:r.transferCache})}const f=Fn(l).pipe(k0(M=>this.handler.handle(M)));if(e instanceof CC||"events"===r.observe)return f;const w=f.pipe(bs(M=>M instanceof EC));switch(r.observe||"body"){case"body":switch(l.responseType){case"arraybuffer":return w.pipe(an(M=>{if(null!==M.body&&!(M.body instanceof ArrayBuffer))throw new bt(2806,!1);return M.body}));case"blob":return w.pipe(an(M=>{if(null!==M.body&&!(M.body instanceof Blob))throw new bt(2807,!1);return M.body}));case"text":return w.pipe(an(M=>{if(null!==M.body&&"string"!=typeof M.body)throw new bt(2808,!1);return M.body}));default:return w.pipe(an(M=>M.body))}case"response":return w;default:throw new bt(2809,!1)}}delete(e,i={}){return this.request("DELETE",e,i)}get(e,i={}){return this.request("GET",e,i)}head(e,i={}){return this.request("HEAD",e,i)}jsonp(e,i){return this.request("JSONP",e,{params:(new kl).append(i,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(e,i={}){return this.request("OPTIONS",e,i)}patch(e,i,r={}){return this.request("PATCH",e,G2(r,i))}post(e,i,r={}){return this.request("POST",e,G2(r,i))}put(e,i,r={}){return this.request("PUT",e,G2(r,i))}static \u0275fac=function(i){return new(i||t)(gn(zM))};static \u0275prov=Nt({token:t,factory:t.\u0275fac})}return t})();const OB=new _t("");function FB(t,n){return n(t)}function LX(t,n){return(e,i)=>n.intercept(e,{handle:r=>t(r,i)})}const LB=new _t(""),SC=new _t(""),zX=new _t(""),NB=new _t("",{providedIn:"root",factory:()=>!0});function BX(){let t=null;return(n,e)=>{null===t&&(t=(te(LB,{optional:!0})??[]).reduceRight(LX,FB));const i=te(Be);if(te(NB)){const l=i.add();return t(n,e).pipe(Vy(()=>i.remove(l)))}return t(n,e)}}let zB=(()=>{class t extends zM{backend;injector;chain=null;pendingTasks=te(Be);contributeToStability=te(NB);constructor(e,i){super(),this.backend=e,this.injector=i}handle(e){if(null===this.chain){const i=Array.from(new Set([...this.injector.get(SC),...this.injector.get(zX,[])]));this.chain=i.reduceRight((r,l)=>function NX(t,n,e){return(i,r)=>Bs(e,()=>n(i,l=>t(l,r)))}(r,l,this.injector),FB)}if(this.contributeToStability){const i=this.pendingTasks.add();return this.chain(e,r=>this.backend.handle(r)).pipe(Vy(()=>this.pendingTasks.remove(i)))}return this.chain(e,i=>this.backend.handle(i))}static \u0275fac=function(i){return new(i||t)(gn(BM),gn(Lo))};static \u0275prov=Nt({token:t,factory:t.\u0275fac})}return t})();const HX=/^\)\]\}',?\n/,$X=RegExp(`^${H2}:`,"m");let VB=(()=>{class t{xhrFactory;constructor(e){this.xhrFactory=e}handle(e){if("JSONP"===e.method)throw new bt(-2800,!1);const i=this.xhrFactory;return(i.\u0275loadImpl?qs(i.\u0275loadImpl()):Fn(null)).pipe(lc(()=>new Qe(l=>{const f=i.build();if(f.open(e.method,e.urlWithParams),e.withCredentials&&(f.withCredentials=!0),e.headers.forEach((K,de)=>f.setRequestHeader(K,de.join(","))),e.headers.has("Accept")||f.setRequestHeader("Accept",kB),!e.headers.has(wC)){const K=e.detectContentTypeHeader();null!==K&&f.setRequestHeader(wC,K)}if(e.responseType){const K=e.responseType.toLowerCase();f.responseType="json"!==K?K:"text"}const w=e.serializeBody();let M=null;const P=()=>{if(null!==M)return M;const K=f.statusText||"OK",de=new Mh(f.getAllResponseHeaders()),ye=function GX(t){return"responseURL"in t&&t.responseURL?t.responseURL:$X.test(t.getAllResponseHeaders())?t.getResponseHeader(H2):null}(f)||e.url;return M=new jM({headers:de,status:f.status,statusText:K,url:ye}),M},L=()=>{let{headers:K,status:de,statusText:ye,url:he}=P(),Ce=null;204!==de&&(Ce=typeof f.response>"u"?f.responseText:f.response),0===de&&(de=Ce?200:0);let Ge=de>=200&&de<300;if("json"===e.responseType&&"string"==typeof Ce){const ct=Ce;Ce=Ce.replace(HX,"");try{Ce=""!==Ce?JSON.parse(Ce):null}catch(It){Ce=ct,Ge&&(Ge=!1,Ce={error:It,text:Ce})}}Ge?(l.next(new EC({body:Ce,headers:K,status:de,statusText:ye,url:he||void 0})),l.complete()):l.error(new B0({error:Ce,headers:K,status:de,statusText:ye,url:he||void 0}))},$=K=>{const{url:de}=P(),ye=new B0({error:K,status:f.status||0,statusText:f.statusText||"Unknown Error",url:de||void 0});l.error(ye)};let Q=!1;const X=K=>{Q||(l.next(P()),Q=!0);let de={type:Lg.DownloadProgress,loaded:K.loaded};K.lengthComputable&&(de.total=K.total),"text"===e.responseType&&f.responseText&&(de.partialText=f.responseText),l.next(de)},Y=K=>{let de={type:Lg.UploadProgress,loaded:K.loaded};K.lengthComputable&&(de.total=K.total),l.next(de)};return f.addEventListener("load",L),f.addEventListener("error",$),f.addEventListener("timeout",$),f.addEventListener("abort",$),e.reportProgress&&(f.addEventListener("progress",X),null!==w&&f.upload&&f.upload.addEventListener("progress",Y)),f.send(w),l.next({type:Lg.Sent}),()=>{f.removeEventListener("error",$),f.removeEventListener("abort",$),f.removeEventListener("load",L),f.removeEventListener("timeout",$),e.reportProgress&&(f.removeEventListener("progress",X),null!==w&&f.upload&&f.upload.removeEventListener("progress",Y)),f.readyState!==f.DONE&&f.abort()}})))}static \u0275fac=function(i){return new(i||t)(gn(m3))};static \u0275prov=Nt({token:t,factory:t.\u0275fac})}return t})();const Y2=new _t(""),UB=new _t("",{providedIn:"root",factory:()=>"XSRF-TOKEN"}),jB=new _t("",{providedIn:"root",factory:()=>"X-XSRF-TOKEN"});class HB{}let YX=(()=>{class t{doc;platform;cookieName;lastCookieString="";lastToken=null;parseCount=0;constructor(e,i,r){this.doc=e,this.platform=i,this.cookieName=r}getToken(){if("server"===this.platform)return null;const e=this.doc.cookie||"";return e!==this.lastCookieString&&(this.parseCount++,this.lastToken=h3(e,this.cookieName),this.lastCookieString=e),this.lastToken}static \u0275fac=function(i){return new(i||t)(gn(mr),gn(cu),gn(UB))};static \u0275prov=Nt({token:t,factory:t.\u0275fac})}return t})();function ZX(t,n){const e=t.url.toLowerCase();if(!te(Y2)||"GET"===t.method||"HEAD"===t.method||e.startsWith("http://")||e.startsWith("https://"))return n(t);const i=te(HB).getToken(),r=te(jB);return null!=i&&!t.headers.has(r)&&(t=t.clone({headers:t.headers.set(r,i)})),n(t)}var Ng=function(t){return t[t.Interceptors=0]="Interceptors",t[t.LegacyInterceptors=1]="LegacyInterceptors",t[t.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",t[t.NoXsrfProtection=3]="NoXsrfProtection",t[t.JsonpSupport=4]="JsonpSupport",t[t.RequestsMadeViaParent=5]="RequestsMadeViaParent",t[t.Fetch=6]="Fetch",t}(Ng||{});const $B=new _t("");let Su=(()=>{class t{http;apiUrl=Cu_urlBack;userNotificationService=kt(Z2);currentUser=new pn(null);currentUser$=this.currentUser.asObservable();authStatus=new pn(!1);adminStatus=new pn(!1);constructor(e){this.http=e}getAuthStatus(){return this.authStatus.asObservable()}getAdminStatus(){return this.adminStatus.asObservable()}updatePassword(e,i){return this.http.patch(`${this.apiUrl}/users/${e}/password`,i,{withCredentials:!0})}deleteUser(e){return this.http.delete(`${this.apiUrl}/users/${e}`,{withCredentials:!0})}login(e){return this.http.post(`${this.apiUrl}/auth/sessions`,{userName:e.email,password:e.password},{withCredentials:!0}).pipe(Rr(()=>{this.authStatus.next(!0),this.checkIsAdmin().subscribe()}),an(()=>!0),Kr(i=>(this.authStatus.next(!1),this.adminStatus.next(!1),ra(()=>i))))}getCurrentUser(){return this.http.get(`${this.apiUrl}/users/me`,{withCredentials:!0}).pipe(Rr(e=>{sessionStorage.setItem("lat",e.latitude.toString()),sessionStorage.setItem("lng",e.longitude.toString()),sessionStorage.setItem("radiusKm",e.notificationRadiusKm.toString()),this.authStatus.next(!0),this.currentUser.next(e)}),Kr(e=>(this.authStatus.next(!1),ra(()=>e))))}isLoggedIn(){return this.getCurrentUser().pipe(an(()=>!0),Kr(()=>Fn(!1)))}logout(){return this.http.get(`${this.apiUrl}/auth/logout`,{withCredentials:!0}).pipe(Rr(()=>{this.authStatus.next(!1),sessionStorage.removeItem("lat"),sessionStorage.removeItem("lng"),sessionStorage.removeItem("radiusKm")}),Kr(e=>ra(()=>e)))}register(e){return this.http.post(`${this.apiUrl}/users`,e).pipe(Rr(()=>console.log("Registro exitoso")),Kr(i=>ra(()=>i)))}getMe(){return this.http.get(`${this.apiUrl}/users/me`,{withCredentials:!0})}updateUser(e,i){return this.http.put(`${this.apiUrl}/users/${e}`,i,{withCredentials:!0})}validateAccount(e){return this.http.patch(`${this.apiUrl}/auth/activations?code=${e}`,{},{responseType:"text"}).pipe(Rr(()=>console.log("Validaci\xf3n de cuenta exitosa")),Kr(i=>(console.error("Error al validar la cuenta",i),ra(()=>i))))}sendCodeAgain(e){return this.http.post(`${this.apiUrl}/auth/activations/${e}`,{}).pipe(Rr(()=>console.log("C\xf3digo reenviado exitosamente")),Kr(i=>(console.error("Error al reenviar el c\xf3digo",i),ra(()=>i))))}resendResetPasswordCode(e){return this.http.post(`${this.apiUrl}/auth/users/password-codes/${e}`,{}).pipe(Rr(()=>console.log("C\xf3digo reenviado exitosamente")),Kr(i=>(console.error("Error al reenviar el c\xf3digo",i),ra(()=>i))))}requestPasswordResetCode(e){return this.http.post(`${this.apiUrl}/auth/passwordCodes?email=${encodeURIComponent(e)}`,{}).pipe(Rr(()=>console.log(`\u{1f501} C\xf3digo de recuperaci\xf3n enviado a ${e}`)),Kr(i=>(console.error("\u274c Error al solicitar c\xf3digo de recuperaci\xf3n",i),ra(()=>i))))}resetPasswordWithCode(e){return this.http.patch(`${this.apiUrl}/auth/users/password`,e).pipe(Rr(()=>console.log("\u{1f504} Contrase\xf1a restablecida con c\xf3digo")),Kr(i=>(console.error("\u274c Error en resetPasswordWithCode",i),ra(()=>i))))}checkIsAdmin(){return this.http.get(`${this.apiUrl}/users/admin`,{withCredentials:!0,observe:"response"}).pipe(an(e=>204===e.status),Rr(e=>this.adminStatus.next(e)),Kr(()=>(this.adminStatus.next(!1),Fn(!1))))}static \u0275fac=function(i){return new(i||t)(gn(Eu))};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),Z2=(()=>{class t{storageKey="app_notifications";zone=te(wt);authService=te(Su);eventSource=null;platformId=te(cu);notificationsSubject=new pn(this.loadFromStorage());notifications$=this.notificationsSubject.asObservable();constructor(){this.authService.getAuthStatus().subscribe(e=>{e?this.safeStart():(this.disconnect(),this.clearNotifications())})}safeStart(){if(Rp(this.platformId))try{this.disconnect(),this.requestNotificationPermission(),this.connectToSse()}catch(e){console.warn("No se pudo iniciar SSE de notificaciones:",e)}}connectToSse(){this.eventSource||!Rp(this.platformId)||(this.eventSource=new EventSource(`${Cu_urlBack}/notifications/subscribe`,{withCredentials:!0}),this.eventSource.addEventListener("new-notification",e=>{this.zone.run(()=>{const i=this.parseNotification(e.data);i&&(this.addNotification(i),this.showBrowserNotification(i))})}),this.eventSource.onerror=e=>{console.error("Error en conexi\xf3n SSE:",e),this.reconnect()})}reconnect(){this.disconnect(),Rp(this.platformId)&&setTimeout(()=>this.safeStart(),5e3)}disconnect(){this.eventSource&&(this.eventSource.close(),this.eventSource=null)}parseNotification(e){try{const i=JSON.parse(e);if(i?.title&&i?.message&&i?.reportId&&i?.type&&i?.createdAt)return{id:i.id||Date.now().toString(),title:i.title,message:i.message,reportId:i.reportId,type:i.type,createdAt:i.createdAt,read:!1}}catch(i){console.error("Error parsing notification:",i)}return null}addNotification(e){const i=[e,...this.notificationsSubject.value];this.notificationsSubject.next(i),this.saveToStorage(i)}loadFromStorage(){try{return Rp(this.platformId)?JSON.parse(localStorage.getItem(this.storageKey)||"[]"):(console.warn("localStorage no est\xe1 disponible"),[])}catch(e){return console.error("Error loading notifications from storage:",e),[]}}saveToStorage(e){try{Rp(this.platformId)&&localStorage.setItem(this.storageKey,JSON.stringify(e))}catch(i){console.error("Error saving notifications to storage:",i)}}requestNotificationPermission(){Rp(this.platformId)&&"Notification"in window&&"denied"!==Notification.permission&&Notification.requestPermission().then(e=>{"granted"===e&&console.log("Notification permission granted")})}showBrowserNotification(e){"granted"===Notification.permission&&new Notification(e.title,{body:e.message,icon:this.getNotificationIcon(e.type),data:{reportId:e.reportId}})}getNotificationIcon(e){return{NEW_REPORT:"map_marker.png",COMMENT:"comment.png",STATUS_CHANGE:"status-change.png"}[e]||"assets/icons/notification.png"}markAsRead(e){const i=this.notificationsSubject.value.map(r=>r.id===e?{...r,read:!0}:r);this.notificationsSubject.next(i),this.saveToStorage(i)}clearNotifications(){this.notificationsSubject.next([]),Rp(this.platformId)&&localStorage.removeItem(this.storageKey)}ngOnDestroy(){this.disconnect()}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function QX(t,n){1&t&&(ae(0,"div",3),Re(1," No tienes notificaciones "),le())}function JX(t,n){if(1&t){const e=_i();ae(0,"div",4),Tt("click",function(){const r=on(e).$implicit;return ln(Lt().markAsRead(r.id))}),ae(1,"div",5),Wt(2,"img",6),le(),ae(3,"div",7)(4,"strong"),Re(5),le(),ae(6,"small"),Re(7),Jf(8,"date"),le(),ae(9,"p"),Re(10),le()()()}if(2&t){const e=n.$implicit,i=Lt();Di("unread",!e.read),xe(2),Xe("src",i.getIcon(e.type),vp),xe(3),er(e.title),xe(2),er(S0(8,6,e.createdAt,"medium")),xe(3),er(e.message)}}let eK=(()=>{class t{notificationService=te(Z2);notifications$=this.notificationService.notifications$;markAsRead(e){this.notificationService.markAsRead(e)}getIcon(e){return this.notificationService.getNotificationIcon(e)}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=kn({type:t,selectors:[["app-notification-list"]],decls:5,vars:6,consts:[[1,"list"],["class","empty",4,"ngIf"],["class","item",3,"unread","click",4,"ngFor","ngForOf"],[1,"empty"],[1,"item",3,"click"],[1,"icon-container"],[1,"icon",3,"src"],[1,"content"]],template:function(i,r){if(1&i&&(ae(0,"div",0),vt(1,QX,2,0,"div",1),Jf(2,"async"),vt(3,JX,11,9,"div",2),Jf(4,"async"),le()),2&i){let l;xe(),Xe("ngIf",0===(null==(l=$D(2,2,r.notifications$))?null:l.length)),xe(2),Xe("ngForOf",$D(4,4,r.notifications$))}},dependencies:[Ea,kg,Os,i2,I0],styles:[".list[_ngcontent-%COMP%]{max-height:400px;overflow-y:auto;padding:8px}.item[_ngcontent-%COMP%]{display:flex;padding:12px;border-bottom:1px solid #eee;cursor:pointer;gap:12px}.item[_ngcontent-%COMP%]:last-child{border:none}.item.unread[_ngcontent-%COMP%]{background-color:#f8f9fe}.empty[_ngcontent-%COMP%]{padding:16px;color:#666;text-align:center}.icon-container[_ngcontent-%COMP%]{width:24px;height:24px}.icon[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:contain}.content[_ngcontent-%COMP%]{flex:1}small[_ngcontent-%COMP%]{display:block;color:#999;margin:4px 0;font-size:.8em}strong[_ngcontent-%COMP%]{font-size:.9em}p[_ngcontent-%COMP%]{margin:0;font-size:.85em;color:#555}"]})}return t})();class X2{_attachedHost;attach(n){return this._attachedHost=n,n.attach(this)}detach(){let n=this._attachedHost;null!=n&&(this._attachedHost=null,n.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(n){this._attachedHost=n}}class zg extends X2{component;viewContainerRef;injector;componentFactoryResolver;projectableNodes;constructor(n,e,i,r,l){super(),this.component=n,this.viewContainerRef=e,this.injector=i,this.projectableNodes=l}}class HM extends X2{templateRef;viewContainerRef;context;injector;constructor(n,e,i,r){super(),this.templateRef=n,this.viewContainerRef=e,this.context=i,this.injector=r}get origin(){return this.templateRef.elementRef}attach(n,e=this.context){return this.context=e,super.attach(n)}detach(){return this.context=void 0,super.detach()}}class tK extends X2{element;constructor(n){super(),this.element=n instanceof Dn?n.nativeElement:n}}class $M{_attachedPortal;_disposeFn;_isDisposed=!1;hasAttached(){return!!this._attachedPortal}attach(n){return n instanceof zg?(this._attachedPortal=n,this.attachComponentPortal(n)):n instanceof HM?(this._attachedPortal=n,this.attachTemplatePortal(n)):this.attachDomPortal&&n instanceof tK?(this._attachedPortal=n,this.attachDomPortal(n)):void 0}attachDomPortal=null;detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(n){this._disposeFn=n}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}class nK extends $M{outletElement;_appRef;_defaultInjector;_document;constructor(n,e,i,r,l){super(),this.outletElement=n,this._appRef=i,this._defaultInjector=r,this._document=l}attachComponentPortal(n){let e;if(n.viewContainerRef){const i=n.injector||n.viewContainerRef.injector,r=i.get(Xf,null,{optional:!0})||void 0;e=n.viewContainerRef.createComponent(n.component,{index:n.viewContainerRef.length,injector:i,ngModuleRef:r,projectableNodes:n.projectableNodes||void 0}),this.setDisposeFn(()=>e.destroy())}else{const i=this._appRef,r=n.injector||this._defaultInjector||we.NULL,l=r.get(Lo,i.injector);e=s3(n.component,{elementInjector:r,environmentInjector:l,projectableNodes:n.projectableNodes||void 0}),i.attachView(e.hostView),this.setDisposeFn(()=>{i.viewCount>0&&i.detachView(e.hostView),e.destroy()})}return this.outletElement.appendChild(this._getComponentRootNode(e)),this._attachedPortal=n,e}attachTemplatePortal(n){let e=n.viewContainerRef,i=e.createEmbeddedView(n.templateRef,n.context,{injector:n.injector});return i.rootNodes.forEach(r=>this.outletElement.appendChild(r)),i.detectChanges(),this.setDisposeFn(()=>{let r=e.indexOf(i);-1!==r&&e.remove(r)}),this._attachedPortal=n,i}attachDomPortal=n=>{const e=n.element,i=this._document.createComment("dom-portal");e.parentNode.insertBefore(i,e),this.outletElement.appendChild(e),this._attachedPortal=n,super.setDisposeFn(()=>{i.parentNode&&i.parentNode.replaceChild(e,i)})};dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(n){return n.hostView.rootNodes[0]}}let K2,qy=(()=>{class t extends $M{_moduleRef=te(Xf,{optional:!0});_document=te(mr);_viewContainerRef=te(io);_isInitialized=!1;_attachedRef;constructor(){super()}get portal(){return this._attachedPortal}set portal(e){this.hasAttached()&&!e&&!this._isInitialized||(this.hasAttached()&&super.detach(),e&&super.attach(e),this._attachedPortal=e||null)}attached=new $e;get attachedRef(){return this._attachedRef}ngOnInit(){this._isInitialized=!0}ngOnDestroy(){super.dispose(),this._attachedRef=this._attachedPortal=null}attachComponentPortal(e){e.setAttachedHost(this);const i=null!=e.viewContainerRef?e.viewContainerRef:this._viewContainerRef,r=i.createComponent(e.component,{index:i.length,injector:e.injector||i.injector,projectableNodes:e.projectableNodes||void 0,ngModuleRef:this._moduleRef||void 0});return i!==this._viewContainerRef&&this._getRootNode().appendChild(r.hostView.rootNodes[0]),super.setDisposeFn(()=>r.destroy()),this._attachedPortal=e,this._attachedRef=r,this.attached.emit(r),r}attachTemplatePortal(e){e.setAttachedHost(this);const i=this._viewContainerRef.createEmbeddedView(e.templateRef,e.context,{injector:e.injector});return super.setDisposeFn(()=>this._viewContainerRef.clear()),this._attachedPortal=e,this._attachedRef=i,this.attached.emit(i),i}attachDomPortal=e=>{const i=e.element,r=this._document.createComment("dom-portal");e.setAttachedHost(this),i.parentNode.insertBefore(r,i),this._getRootNode().appendChild(i),this._attachedPortal=e,super.setDisposeFn(()=>{r.parentNode&&r.parentNode.replaceChild(i,r)})};_getRootNode(){const e=this._viewContainerRef.element.nativeElement;return e.nodeType===e.ELEMENT_NODE?e:e.parentNode}static \u0275fac=function(i){return new(i||t)};static \u0275dir=Ht({type:t,selectors:[["","cdkPortalOutlet",""]],inputs:{portal:[0,"cdkPortalOutlet","portal"]},outputs:{attached:"attached"},exportAs:["cdkPortalOutlet"],features:[Nn]})}return t})(),DC=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275mod=Er({type:t});static \u0275inj=Ai({})}return t})();try{K2=typeof Intl<"u"&&Intl.v8BreakIterator}catch{K2=!1}let Q2,xs=(()=>{class t{_platformId=te(cu);isBrowser=this._platformId?Rp(this._platformId):"object"==typeof document&&!!document;EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent);TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent);BLINK=this.isBrowser&&!(!window.chrome&&!K2)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT;WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT;IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window);FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent);ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT;SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT;constructor(){}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function MC(){let t=typeof document<"u"&&document?document.activeElement:null;for(;t&&t.shadowRoot;){const n=t.shadowRoot.activeElement;if(n===t)break;t=n}return t}function Lp(t){return t.composedPath?t.composedPath()[0]:t.target}const GM=new WeakMap;let cc=(()=>{class t{_appRef;_injector=te(we);_environmentInjector=te(Lo);load(e){const i=this._appRef=this._appRef||this._injector.get(ic);let r=GM.get(i);r||(r={loaders:new Set,refs:[]},GM.set(i,r),i.onDestroy(()=>{GM.get(i)?.refs.forEach(l=>l.destroy()),GM.delete(i)})),r.loaders.has(e)||(r.loaders.add(e),r.refs.push(s3(e,{environmentInjector:this._environmentInjector})))}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),Wy=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275cmp=kn({type:t,selectors:[["ng-component"]],exportAs:["cdkVisuallyHidden"],decls:0,vars:0,template:function(i,r){},styles:[".cdk-visually-hidden{border:0;clip:rect(0 0 0 0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px;white-space:nowrap;outline:0;-webkit-appearance:none;-moz-appearance:none;left:0}[dir=rtl] .cdk-visually-hidden{left:auto;right:0}\n"],encapsulation:2,changeDetection:0})}return t})();function GB(t){return bs((n,e)=>t<=e)}class oK extends Mi{constructor(n,e){super()}schedule(n,e=0){return this}}const qM={setInterval(t,n,...e){const{delegate:i}=qM;return i?.setInterval?i.setInterval(t,n,...e):setInterval(t,n,...e)},clearInterval(t){const{delegate:n}=qM;return(n?.clearInterval||clearInterval)(t)},delegate:void 0};class J2 extends oK{constructor(n,e){super(n,e),this.scheduler=n,this.work=e,this.pending=!1}schedule(n,e=0){var i;if(this.closed)return this;this.state=n;const r=this.id,l=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(l,r,e)),this.pending=!0,this.delay=e,this.id=null!==(i=this.id)&&void 0!==i?i:this.requestAsyncId(l,this.id,e),this}requestAsyncId(n,e,i=0){return qM.setInterval(n.flush.bind(n,this),i)}recycleAsyncId(n,e,i=0){if(null!=i&&this.delay===i&&!1===this.pending)return e;null!=e&&qM.clearInterval(e)}execute(n,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const i=this._execute(n,e);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(n,e){let r,i=!1;try{this.work(n)}catch(l){i=!0,r=l||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),r}unsubscribe(){if(!this.closed){const{id:n,scheduler:e}=this,{actions:i}=e;this.work=this.state=this.scheduler=null,this.pending=!1,al(i,this),null!=n&&(this.id=this.recycleAsyncId(e,n,null)),this.delay=null,super.unsubscribe()}}}const eR={now:()=>(eR.delegate||Date).now(),delegate:void 0};class TC{constructor(n,e=TC.now){this.schedulerActionCtor=n,this.now=e}schedule(n,e=0,i){return new this.schedulerActionCtor(this,n).schedule(i,e)}}TC.now=eR.now;class tR extends TC{constructor(n,e=TC.now){super(n,e),this.actions=[],this._active=!1}flush(n){const{actions:e}=this;if(this._active)return void e.push(n);let i;this._active=!0;do{if(i=n.execute(n.state,n.delay))break}while(n=e.shift());if(this._active=!1,i){for(;n=e.shift();)n.unsubscribe();throw i}}}const WM=new tR(J2),sK=WM;function qB(t,n=WM){return Jn((e,i)=>{let r=null,l=null,f=null;const w=()=>{if(r){r.unsubscribe(),r=null;const P=l;l=null,i.next(P)}};function M(){const P=f+t,L=n.now();if(L<P)return r=this.schedule(void 0,P-L),void i.add(r);w()}e.subscribe(li(i,P=>{l=P,f=n.now(),r||(r=n.schedule(M,t),i.add(r))},()=>{w(),i.complete()},void 0,()=>{l=r=null}))})}function YM(t){return Array.isArray(t)?t:[t]}const WB=new Set;let Yy,aK=(()=>{class t{_platform=te(xs);_nonce=te(Zv,{optional:!0});_matchMedia;constructor(){this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):cK}matchMedia(e){return(this._platform.WEBKIT||this._platform.BLINK)&&function lK(t,n){if(!WB.has(t))try{Yy||(Yy=document.createElement("style"),n&&Yy.setAttribute("nonce",n),Yy.setAttribute("type","text/css"),document.head.appendChild(Yy)),Yy.sheet&&(Yy.sheet.insertRule(`@media ${t} {body{ }}`,0),WB.add(t))}catch(e){console.error(e)}}(e,this._nonce),this._matchMedia(e)}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function cK(t){return{matches:"all"===t||""===t,media:t,addListener:()=>{},removeListener:()=>{}}}let YB=(()=>{class t{_mediaMatcher=te(aK);_zone=te(wt);_queries=new Map;_destroySubject=new Et;constructor(){}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(e){return ZB(YM(e)).some(r=>this._registerQuery(r).mql.matches)}observe(e){let l=zy(ZB(YM(e)).map(f=>this._registerQuery(f).observable));return l=yM(l.pipe(Qa(1)),l.pipe(GB(1),qB(0))),l.pipe(an(f=>{const w={matches:!1,breakpoints:{}};return f.forEach(({matches:M,query:P})=>{w.matches=w.matches||M,w.breakpoints[P]=M}),w}))}_registerQuery(e){if(this._queries.has(e))return this._queries.get(e);const i=this._mediaMatcher.matchMedia(e),l={observable:new Qe(f=>{const w=M=>this._zone.run(()=>f.next(M));return i.addListener(w),()=>{i.removeListener(w)}}).pipe(Nc(i),an(({matches:f})=>({query:e,matches:f})),jr(this._destroySubject)),mql:i};return this._queries.set(e,l),l}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function ZB(t){return t.map(n=>n.split(",")).reduce((n,e)=>n.concat(e)).map(n=>n.trim())}let dK=(()=>{class t{create(e){return typeof MutationObserver>"u"?null:new MutationObserver(e)}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),XB=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275mod=Er({type:t});static \u0275inj=Ai({providers:[dK]})}return t})(),KB=(()=>{class t{_platform=te(xs);constructor(){}isDisabled(e){return e.hasAttribute("disabled")}isVisible(e){return function hK(t){return!!(t.offsetWidth||t.offsetHeight||"function"==typeof t.getClientRects&&t.getClientRects().length)}(e)&&"visible"===getComputedStyle(e).visibility}isTabbable(e){if(!this._platform.isBrowser)return!1;const i=function uK(t){try{return t.frameElement}catch{return null}}(function bK(t){return t.ownerDocument&&t.ownerDocument.defaultView||window}(e));if(i&&(-1===JB(i)||!this.isVisible(i)))return!1;let r=e.nodeName.toLowerCase(),l=JB(e);return e.hasAttribute("contenteditable")?-1!==l:!("iframe"===r||"object"===r||this._platform.WEBKIT&&this._platform.IOS&&!function yK(t){let n=t.nodeName.toLowerCase(),e="input"===n&&t.type;return"text"===e||"password"===e||"select"===n||"textarea"===n}(e))&&("audio"===r?!!e.hasAttribute("controls")&&-1!==l:"video"===r?-1!==l&&(null!==l||this._platform.FIREFOX||e.hasAttribute("controls")):e.tabIndex>=0)}isFocusable(e,i){return function vK(t){return!function fK(t){return function gK(t){return"input"==t.nodeName.toLowerCase()}(t)&&"hidden"==t.type}(t)&&(function pK(t){let n=t.nodeName.toLowerCase();return"input"===n||"select"===n||"button"===n||"textarea"===n}(t)||function mK(t){return function _K(t){return"a"==t.nodeName.toLowerCase()}(t)&&t.hasAttribute("href")}(t)||t.hasAttribute("contenteditable")||QB(t))}(e)&&!this.isDisabled(e)&&(i?.ignoreVisibility||this.isVisible(e))}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function QB(t){if(!t.hasAttribute("tabindex")||void 0===t.tabIndex)return!1;let n=t.getAttribute("tabindex");return!(!n||isNaN(parseInt(n,10)))}function JB(t){if(!QB(t))return null;const n=parseInt(t.getAttribute("tabindex")||"",10);return isNaN(n)?-1:n}class eV{_element;_checker;_ngZone;_document;_injector;_startAnchor;_endAnchor;_hasAttached=!1;startAnchorListener=()=>this.focusLastTabbableElement();endAnchorListener=()=>this.focusFirstTabbableElement();get enabled(){return this._enabled}set enabled(n){this._enabled=n,this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(n,this._startAnchor),this._toggleAnchorTabIndex(n,this._endAnchor))}_enabled=!0;constructor(n,e,i,r,l=!1,f){this._element=n,this._checker=e,this._ngZone=i,this._document=r,this._injector=f,l||this.attachAnchors()}destroy(){const n=this._startAnchor,e=this._endAnchor;n&&(n.removeEventListener("focus",this.startAnchorListener),n.remove()),e&&(e.removeEventListener("focus",this.endAnchorListener),e.remove()),this._startAnchor=this._endAnchor=null,this._hasAttached=!1}attachAnchors(){return!!this._hasAttached||(this._ngZone.runOutsideAngular(()=>{this._startAnchor||(this._startAnchor=this._createAnchor(),this._startAnchor.addEventListener("focus",this.startAnchorListener)),this._endAnchor||(this._endAnchor=this._createAnchor(),this._endAnchor.addEventListener("focus",this.endAnchorListener))}),this._element.parentNode&&(this._element.parentNode.insertBefore(this._startAnchor,this._element),this._element.parentNode.insertBefore(this._endAnchor,this._element.nextSibling),this._hasAttached=!0),this._hasAttached)}focusInitialElementWhenReady(n){return new Promise(e=>{this._executeOnStable(()=>e(this.focusInitialElement(n)))})}focusFirstTabbableElementWhenReady(n){return new Promise(e=>{this._executeOnStable(()=>e(this.focusFirstTabbableElement(n)))})}focusLastTabbableElementWhenReady(n){return new Promise(e=>{this._executeOnStable(()=>e(this.focusLastTabbableElement(n)))})}_getRegionBoundary(n){const e=this._element.querySelectorAll(`[cdk-focus-region-${n}], [cdkFocusRegion${n}], [cdk-focus-${n}]`);return"start"==n?e.length?e[0]:this._getFirstTabbableElement(this._element):e.length?e[e.length-1]:this._getLastTabbableElement(this._element)}focusInitialElement(n){const e=this._element.querySelector("[cdk-focus-initial], [cdkFocusInitial]");if(e){if(!this._checker.isFocusable(e)){const i=this._getFirstTabbableElement(e);return i?.focus(n),!!i}return e.focus(n),!0}return this.focusFirstTabbableElement(n)}focusFirstTabbableElement(n){const e=this._getRegionBoundary("start");return e&&e.focus(n),!!e}focusLastTabbableElement(n){const e=this._getRegionBoundary("end");return e&&e.focus(n),!!e}hasAttached(){return this._hasAttached}_getFirstTabbableElement(n){if(this._checker.isFocusable(n)&&this._checker.isTabbable(n))return n;const e=n.children;for(let i=0;i<e.length;i++){const r=e[i].nodeType===this._document.ELEMENT_NODE?this._getFirstTabbableElement(e[i]):null;if(r)return r}return null}_getLastTabbableElement(n){if(this._checker.isFocusable(n)&&this._checker.isTabbable(n))return n;const e=n.children;for(let i=e.length-1;i>=0;i--){const r=e[i].nodeType===this._document.ELEMENT_NODE?this._getLastTabbableElement(e[i]):null;if(r)return r}return null}_createAnchor(){const n=this._document.createElement("div");return this._toggleAnchorTabIndex(this._enabled,n),n.classList.add("cdk-visually-hidden"),n.classList.add("cdk-focus-trap-anchor"),n.setAttribute("aria-hidden","true"),n}_toggleAnchorTabIndex(n,e){n?e.setAttribute("tabindex","0"):e.removeAttribute("tabindex")}toggleAnchors(n){this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(n,this._startAnchor),this._toggleAnchorTabIndex(n,this._endAnchor))}_executeOnStable(n){this._injector?El(n,{injector:this._injector}):setTimeout(n)}}let tV=(()=>{class t{_checker=te(KB);_ngZone=te(wt);_document=te(mr);_injector=te(we);constructor(){te(cc).load(Wy)}create(e,i=!1){return new eV(e,this._checker,this._ngZone,this._document,i,this._injector)}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),xK=(()=>{class t{_elementRef=te(Dn);_focusTrapFactory=te(tV);focusTrap;_previouslyFocusedElement=null;get enabled(){return this.focusTrap?.enabled||!1}set enabled(e){this.focusTrap&&(this.focusTrap.enabled=e)}autoCapture;constructor(){te(xs).isBrowser&&(this.focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement,!0))}ngOnDestroy(){this.focusTrap?.destroy(),this._previouslyFocusedElement&&(this._previouslyFocusedElement.focus(),this._previouslyFocusedElement=null)}ngAfterContentInit(){this.focusTrap?.attachAnchors(),this.autoCapture&&this._captureFocus()}ngDoCheck(){this.focusTrap&&!this.focusTrap.hasAttached()&&this.focusTrap.attachAnchors()}ngOnChanges(e){const i=e.autoCapture;i&&!i.firstChange&&this.autoCapture&&this.focusTrap?.hasAttached()&&this._captureFocus()}_captureFocus(){this._previouslyFocusedElement=MC(),this.focusTrap?.focusInitialElementWhenReady()}static \u0275fac=function(i){return new(i||t)};static \u0275dir=Ht({type:t,selectors:[["","cdkTrapFocus",""]],inputs:{enabled:[2,"cdkTrapFocus","enabled",Un],autoCapture:[2,"cdkTrapFocusAutoCapture","autoCapture",Un]},exportAs:["cdkTrapFocus"],features:[Mr]})}return t})();const wK=new _t("liveAnnouncerElement",{providedIn:"root",factory:function CK(){return null}}),EK=new _t("LIVE_ANNOUNCER_DEFAULT_OPTIONS");let SK=0,nV=(()=>{class t{_ngZone=te(wt);_defaultOptions=te(EK,{optional:!0});_liveElement;_document=te(mr);_previousTimeout;_currentPromise;_currentResolve;constructor(){const e=te(wK,{optional:!0});this._liveElement=e||this._createLiveElement()}announce(e,...i){const r=this._defaultOptions;let l,f;return 1===i.length&&"number"==typeof i[0]?f=i[0]:[l,f]=i,this.clear(),clearTimeout(this._previousTimeout),l||(l=r&&r.politeness?r.politeness:"polite"),null==f&&r&&(f=r.duration),this._liveElement.setAttribute("aria-live",l),this._liveElement.id&&this._exposeAnnouncerToModals(this._liveElement.id),this._ngZone.runOutsideAngular(()=>(this._currentPromise||(this._currentPromise=new Promise(w=>this._currentResolve=w)),clearTimeout(this._previousTimeout),this._previousTimeout=setTimeout(()=>{this._liveElement.textContent=e,"number"==typeof f&&(this._previousTimeout=setTimeout(()=>this.clear(),f)),this._currentResolve?.(),this._currentPromise=this._currentResolve=void 0},100),this._currentPromise))}clear(){this._liveElement&&(this._liveElement.textContent="")}ngOnDestroy(){clearTimeout(this._previousTimeout),this._liveElement?.remove(),this._liveElement=null,this._currentResolve?.(),this._currentPromise=this._currentResolve=void 0}_createLiveElement(){const e="cdk-live-announcer-element",i=this._document.getElementsByClassName(e),r=this._document.createElement("div");for(let l=0;l<i.length;l++)i[l].remove();return r.classList.add(e),r.classList.add("cdk-visually-hidden"),r.setAttribute("aria-atomic","true"),r.setAttribute("aria-live","polite"),r.id="cdk-live-announcer-"+SK++,this._document.body.appendChild(r),r}_exposeAnnouncerToModals(e){const i=this._document.querySelectorAll('body > .cdk-overlay-container [aria-modal="true"]');for(let r=0;r<i.length;r++){const l=i[r],f=l.getAttribute("aria-owns");f?-1===f.indexOf(e)&&l.setAttribute("aria-owns",f+" "+e):l.setAttribute("aria-owns",e)}}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var Zy=function(t){return t[t.NONE=0]="NONE",t[t.BLACK_ON_WHITE=1]="BLACK_ON_WHITE",t[t.WHITE_ON_BLACK=2]="WHITE_ON_BLACK",t}(Zy||{});const iV="cdk-high-contrast-black-on-white",rV="cdk-high-contrast-white-on-black",nR="cdk-high-contrast-active";let oV=(()=>{class t{_platform=te(xs);_hasCheckedHighContrastMode;_document=te(mr);_breakpointSubscription;constructor(){this._breakpointSubscription=te(YB).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return Zy.NONE;const e=this._document.createElement("div");e.style.backgroundColor="rgb(1,2,3)",e.style.position="absolute",this._document.body.appendChild(e);const i=this._document.defaultView||window,r=i&&i.getComputedStyle?i.getComputedStyle(e):null,l=(r&&r.backgroundColor||"").replace(/ /g,"");switch(e.remove(),l){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return Zy.WHITE_ON_BLACK;case"rgb(255,255,255)":case"rgb(255,250,239)":return Zy.BLACK_ON_WHITE}return Zy.NONE}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const e=this._document.body.classList;e.remove(nR,iV,rV),this._hasCheckedHighContrastMode=!0;const i=this.getHighContrastMode();i===Zy.BLACK_ON_WHITE?e.add(nR,iV):i===Zy.WHITE_ON_BLACK&&e.add(nR,rV)}}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),iR=(()=>{class t{constructor(){te(oV)._applyBodyHighContrastModeCssClasses()}static \u0275fac=function(i){return new(i||t)};static \u0275mod=Er({type:t});static \u0275inj=Ai({imports:[XB]})}return t})();function Rl(t,n,e,i,r){const l=parseInt(wN.major),f=parseInt(wN.minor);return l>19||19===l&&f>0||0===l&&0===f?t.listen(n,e,i,r):(n.addEventListener(e,i,r),()=>{n.removeEventListener(e,i,r)})}function sV(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}function zc(...t){const n=rC(t),e=function B7(t,n){return"number"==typeof f2(t)?t.pop():n}(t,1/0),i=t;return i.length?1===i.length?Lc(i[0]):A0(e)(qs(i,n)):Md}function rR(t,n=!1){return Jn((e,i)=>{let r=0;e.subscribe(li(i,l=>{const f=t(l,r++);(f||n)&&i.next(l),!f&&i.complete()}))})}function Ws(t){return null==t?"":"string"==typeof t?t:`${t}px`}const IC={schedule(t){let n=requestAnimationFrame,e=cancelAnimationFrame;const{delegate:i}=IC;i&&(n=i.requestAnimationFrame,e=i.cancelAnimationFrame);const r=n(l=>{e=void 0,t(l)});return new Mi(()=>e?.(r))},requestAnimationFrame(...t){const{delegate:n}=IC;return(n?.requestAnimationFrame||requestAnimationFrame)(...t)},cancelAnimationFrame(...t){const{delegate:n}=IC;return(n?.cancelAnimationFrame||cancelAnimationFrame)(...t)},delegate:void 0};new class MK extends tR{flush(n){let e;this._active=!0,n?e=n.id:(e=this._scheduled,this._scheduled=void 0);const{actions:i}=this;let r;n=n||i.shift();do{if(r=n.execute(n.state,n.delay))break}while((n=i[0])&&n.id===e&&i.shift());if(this._active=!1,r){for(;(n=i[0])&&n.id===e&&i.shift();)n.unsubscribe();throw r}}}(class DK extends J2{constructor(n,e){super(n,e),this.scheduler=n,this.work=e}requestAsyncId(n,e,i=0){return null!==i&&i>0?super.requestAsyncId(n,e,i):(n.actions.push(this),n._scheduled||(n._scheduled=IC.requestAnimationFrame(()=>n.flush(void 0))))}recycleAsyncId(n,e,i=0){var r;if(null!=i?i>0:this.delay>0)return super.recycleAsyncId(n,e,i);const{actions:l}=n;null!=e&&e===n._scheduled&&(null===(r=l[l.length-1])||void 0===r?void 0:r.id)!==e&&(IC.cancelAnimationFrame(e),n._scheduled=void 0)}});let oR,IK=1;const ZM={};function aV(t){return t in ZM&&(delete ZM[t],!0)}const AK={setImmediate(t){const n=IK++;return ZM[n]=!0,oR||(oR=Promise.resolve()),oR.then(()=>aV(n)&&t()),n},clearImmediate(t){aV(t)}},{setImmediate:kK,clearImmediate:RK}=AK,XM={setImmediate(...t){const{delegate:n}=XM;return(n?.setImmediate||kK)(...t)},clearImmediate(t){const{delegate:n}=XM;return(n?.clearImmediate||RK)(t)},delegate:void 0};new class OK extends tR{flush(n){this._active=!0;const e=this._scheduled;this._scheduled=void 0;const{actions:i}=this;let r;n=n||i.shift();do{if(r=n.execute(n.state,n.delay))break}while((n=i[0])&&n.id===e&&i.shift());if(this._active=!1,r){for(;(n=i[0])&&n.id===e&&i.shift();)n.unsubscribe();throw r}}}(class PK extends J2{constructor(n,e){super(n,e),this.scheduler=n,this.work=e}requestAsyncId(n,e,i=0){return null!==i&&i>0?super.requestAsyncId(n,e,i):(n.actions.push(this),n._scheduled||(n._scheduled=XM.setImmediate(n.flush.bind(n,void 0))))}recycleAsyncId(n,e,i=0){var r;if(null!=i?i>0:this.delay>0)return super.recycleAsyncId(n,e,i);const{actions:l}=n;null!=e&&(null===(r=l[l.length-1])||void 0===r?void 0:r.id)!==e&&(XM.clearImmediate(e),n._scheduled===e&&(n._scheduled=void 0))}});function lV(t=0,n,e=sK){let i=-1;return null!=n&&(mz(n)?e=n:i=n),new Qe(r=>{let l=function NK(t){return t instanceof Date&&!isNaN(t)}(t)?+t-e.now():t;l<0&&(l=0);let f=0;return e.schedule(function(){r.closed||(r.next(f++),0<=i?this.schedule(void 0,i):r.complete())},l)})}function cV(t,n=WM){return function LK(t){return Jn((n,e)=>{let i=!1,r=null,l=null,f=!1;const w=()=>{if(l?.unsubscribe(),l=null,i){i=!1;const P=r;r=null,e.next(P)}f&&e.complete()},M=()=>{l=null,f&&e.complete()};n.subscribe(li(e,P=>{i=!0,r=P,l||Lc(t(P)).subscribe(l=li(e,w,M))},()=>{f=!0,(!i||!l||l.closed)&&e.complete()}))})}(()=>lV(t,n))}function KM(t,n=0){return function dV(t){return!isNaN(parseFloat(t))&&!isNaN(Number(t))}(t)?Number(t):2===arguments.length?n:0}function Bg(t){return t instanceof Dn?t.nativeElement:t}const zK=new _t("cdk-dir-doc",{providedIn:"root",factory:function BK(){return te(mr)}}),VK=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;let Bc=(()=>{class t{value="ltr";change=new $e;constructor(){const e=te(zK,{optional:!0});e&&(this.value=function UK(t){const n=t?.toLowerCase()||"";return"auto"===n&&typeof navigator<"u"&&navigator?.language?VK.test(navigator.language)?"rtl":"ltr":"rtl"===n?"rtl":"ltr"}((e.body?e.body.dir:null)||(e.documentElement?e.documentElement.dir:null)||"ltr"))}ngOnDestroy(){this.change.complete()}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var Np=function(t){return t[t.NORMAL=0]="NORMAL",t[t.NEGATED=1]="NEGATED",t[t.INVERTED=2]="INVERTED",t}(Np||{});let QM,Xy;function uV(){if(null==Xy){if("object"!=typeof document||!document||"function"!=typeof Element||!Element)return Xy=!1,Xy;if("scrollBehavior"in document.documentElement.style)Xy=!0;else{const t=Element.prototype.scrollTo;Xy=!!t&&!/\{\s*\[native code\]\s*\}/.test(t.toString())}}return Xy}function AC(){if("object"!=typeof document||!document)return Np.NORMAL;if(null==QM){const t=document.createElement("div"),n=t.style;t.dir="rtl",n.width="1px",n.overflow="auto",n.visibility="hidden",n.pointerEvents="none",n.position="absolute";const e=document.createElement("div"),i=e.style;i.width="2px",i.height="1px",t.appendChild(e),document.body.appendChild(t),QM=Np.NORMAL,0===t.scrollLeft&&(t.scrollLeft=1,QM=0===t.scrollLeft?Np.NEGATED:Np.INVERTED),t.remove()}return QM}let kC=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275mod=Er({type:t});static \u0275inj=Ai({})}return t})(),sR=(()=>{class t{_ngZone=te(wt);_platform=te(xs);_renderer=te(gt).createRenderer(null,null);_cleanupGlobalListener;constructor(){}_scrolled=new Et;_scrolledCount=0;scrollContainers=new Map;register(e){this.scrollContainers.has(e)||this.scrollContainers.set(e,e.elementScrolled().subscribe(()=>this._scrolled.next(e)))}deregister(e){const i=this.scrollContainers.get(e);i&&(i.unsubscribe(),this.scrollContainers.delete(e))}scrolled(e=20){return this._platform.isBrowser?new Qe(i=>{this._cleanupGlobalListener||(this._cleanupGlobalListener=this._ngZone.runOutsideAngular(()=>this._renderer.listen("document","scroll",()=>this._scrolled.next())));const r=e>0?this._scrolled.pipe(cV(e)).subscribe(i):this._scrolled.subscribe(i);return this._scrolledCount++,()=>{r.unsubscribe(),this._scrolledCount--,this._scrolledCount||(this._cleanupGlobalListener?.(),this._cleanupGlobalListener=void 0)}}):Fn()}ngOnDestroy(){this._cleanupGlobalListener?.(),this._cleanupGlobalListener=void 0,this.scrollContainers.forEach((e,i)=>this.deregister(i)),this._scrolled.complete()}ancestorScrolled(e,i){const r=this.getAncestorScrollContainers(e);return this.scrolled(i).pipe(bs(l=>!l||r.indexOf(l)>-1))}getAncestorScrollContainers(e){const i=[];return this.scrollContainers.forEach((r,l)=>{this._scrollableContainsElement(l,e)&&i.push(l)}),i}_scrollableContainsElement(e,i){let r=Bg(i),l=e.getElementRef().nativeElement;do{if(r==l)return!0}while(r=r.parentElement);return!1}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),HK=(()=>{class t{elementRef=te(Dn);scrollDispatcher=te(sR);ngZone=te(wt);dir=te(Bc,{optional:!0});_scrollElement=this.elementRef.nativeElement;_destroyed=new Et;_renderer=te(yt);_cleanupScroll;_elementScrolled=new Et;constructor(){}ngOnInit(){this._cleanupScroll=this.ngZone.runOutsideAngular(()=>this._renderer.listen(this._scrollElement,"scroll",e=>this._elementScrolled.next(e))),this.scrollDispatcher.register(this)}ngOnDestroy(){this._cleanupScroll?.(),this._elementScrolled.complete(),this.scrollDispatcher.deregister(this),this._destroyed.next(),this._destroyed.complete()}elementScrolled(){return this._elementScrolled}getElementRef(){return this.elementRef}scrollTo(e){const i=this.elementRef.nativeElement,r=this.dir&&"rtl"==this.dir.value;null==e.left&&(e.left=r?e.end:e.start),null==e.right&&(e.right=r?e.start:e.end),null!=e.bottom&&(e.top=i.scrollHeight-i.clientHeight-e.bottom),r&&AC()!=Np.NORMAL?(null!=e.left&&(e.right=i.scrollWidth-i.clientWidth-e.left),AC()==Np.INVERTED?e.left=e.right:AC()==Np.NEGATED&&(e.left=e.right?-e.right:e.right)):null!=e.right&&(e.left=i.scrollWidth-i.clientWidth-e.right),this._applyScrollToOptions(e)}_applyScrollToOptions(e){const i=this.elementRef.nativeElement;uV()?i.scrollTo(e):(null!=e.top&&(i.scrollTop=e.top),null!=e.left&&(i.scrollLeft=e.left))}measureScrollOffset(e){const i="left",r="right",l=this.elementRef.nativeElement;if("top"==e)return l.scrollTop;if("bottom"==e)return l.scrollHeight-l.clientHeight-l.scrollTop;const f=this.dir&&"rtl"==this.dir.value;return"start"==e?e=f?r:i:"end"==e&&(e=f?i:r),f&&AC()==Np.INVERTED?e==i?l.scrollWidth-l.clientWidth-l.scrollLeft:l.scrollLeft:f&&AC()==Np.NEGATED?e==i?l.scrollLeft+l.scrollWidth-l.clientWidth:-l.scrollLeft:e==i?l.scrollLeft:l.scrollWidth-l.clientWidth-l.scrollLeft}static \u0275fac=function(i){return new(i||t)};static \u0275dir=Ht({type:t,selectors:[["","cdk-scrollable",""],["","cdkScrollable",""]]})}return t})(),JM=(()=>{class t{_platform=te(xs);_listeners;_viewportSize;_change=new Et;_document=te(mr,{optional:!0});constructor(){const e=te(wt),i=te(gt).createRenderer(null,null);e.runOutsideAngular(()=>{if(this._platform.isBrowser){const r=l=>this._change.next(l);this._listeners=[i.listen("window","resize",r),i.listen("window","orientationchange",r)]}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){this._listeners?.forEach(e=>e()),this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();const e={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),e}getViewportRect(){const e=this.getViewportScrollPosition(),{width:i,height:r}=this.getViewportSize();return{top:e.top,left:e.left,bottom:e.top+r,right:e.left+i,height:r,width:i}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};const e=this._document,i=this._getWindow(),r=e.documentElement,l=r.getBoundingClientRect();return{top:-l.top||e.body.scrollTop||i.scrollY||r.scrollTop||0,left:-l.left||e.body.scrollLeft||i.scrollX||r.scrollLeft||0}}change(e=20){return e>0?this._change.pipe(cV(e)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){const e=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:e.innerWidth,height:e.innerHeight}:{width:0,height:0}}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),RC=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275mod=Er({type:t});static \u0275inj=Ai({})}return t})(),aR=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275mod=Er({type:t});static \u0275inj=Ai({imports:[kC,RC,kC,RC]})}return t})();const lR={};let Sa=(()=>{class t{_appId=te(gd);getId(e){return"ng"!==this._appId&&(e+=this._appId),lR.hasOwnProperty(e)||(lR[e]=0),`${e}${lR[e]++}`}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function Ja(t,...n){return n.length?n.some(e=>t[e]):t.altKey||t.shiftKey||t.ctrlKey||t.metaKey}const fV=uV();class eQ{_viewportRuler;_previousHTMLStyles={top:"",left:""};_previousScrollPosition;_isEnabled=!1;_document;constructor(n,e){this._viewportRuler=n,this._document=e}attach(){}enable(){if(this._canBeEnabled()){const n=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=n.style.left||"",this._previousHTMLStyles.top=n.style.top||"",n.style.left=Ws(-this._previousScrollPosition.left),n.style.top=Ws(-this._previousScrollPosition.top),n.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const n=this._document.documentElement,i=n.style,r=this._document.body.style,l=i.scrollBehavior||"",f=r.scrollBehavior||"";this._isEnabled=!1,i.left=this._previousHTMLStyles.left,i.top=this._previousHTMLStyles.top,n.classList.remove("cdk-global-scrollblock"),fV&&(i.scrollBehavior=r.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),fV&&(i.scrollBehavior=l,r.scrollBehavior=f)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const e=this._document.documentElement,i=this._viewportRuler.getViewportSize();return e.scrollHeight>i.height||e.scrollWidth>i.width}}class tQ{_scrollDispatcher;_ngZone;_viewportRuler;_config;_scrollSubscription=null;_overlayRef;_initialScrollPosition;constructor(n,e,i,r){this._scrollDispatcher=n,this._ngZone=e,this._viewportRuler=i,this._config=r}attach(n){this._overlayRef=n}enable(){if(this._scrollSubscription)return;const n=this._scrollDispatcher.scrolled(0).pipe(bs(e=>!e||!this._overlayRef.overlayElement.contains(e.getElementRef().nativeElement)));this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=n.subscribe(()=>{const e=this._viewportRuler.getViewportScrollPosition().top;Math.abs(e-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=n.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}_detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}class mV{enable(){}disable(){}attach(){}}function dR(t,n){return n.some(e=>t.bottom<e.top||t.top>e.bottom||t.right<e.left||t.left>e.right)}function gV(t,n){return n.some(e=>t.top<e.top||t.bottom>e.bottom||t.left<e.left||t.right>e.right)}class nQ{_scrollDispatcher;_viewportRuler;_ngZone;_config;_scrollSubscription=null;_overlayRef;constructor(n,e,i,r){this._scrollDispatcher=n,this._viewportRuler=e,this._ngZone=i,this._config=r}attach(n){this._overlayRef=n}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const e=this._overlayRef.overlayElement.getBoundingClientRect(),{width:i,height:r}=this._viewportRuler.getViewportSize();dR(e,[{width:i,height:r,bottom:r,right:i,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}let iQ=(()=>{class t{_scrollDispatcher=te(sR);_viewportRuler=te(JM);_ngZone=te(wt);_document=te(mr);constructor(){}noop=()=>new mV;close=e=>new tQ(this._scrollDispatcher,this._ngZone,this._viewportRuler,e);block=()=>new eQ(this._viewportRuler,this._document);reposition=e=>new nQ(this._scrollDispatcher,this._viewportRuler,this._ngZone,e);static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();class FC{positionStrategy;scrollStrategy=new mV;panelClass="";hasBackdrop=!1;backdropClass="cdk-overlay-dark-backdrop";width;height;minWidth;minHeight;maxWidth;maxHeight;direction;disposeOnNavigation=!1;constructor(n){if(n){const e=Object.keys(n);for(const i of e)void 0!==n[i]&&(this[i]=n[i])}}}class rQ{connectionPair;scrollableViewProperties;constructor(n,e){this.connectionPair=n,this.scrollableViewProperties=e}}let _V=(()=>{class t{_attachedOverlays=[];_document=te(mr);_isAttached;constructor(){}ngOnDestroy(){this.detach()}add(e){this.remove(e),this._attachedOverlays.push(e)}remove(e){const i=this._attachedOverlays.indexOf(e);i>-1&&this._attachedOverlays.splice(i,1),0===this._attachedOverlays.length&&this.detach()}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),oQ=(()=>{class t extends _V{_ngZone=te(wt);_renderer=te(gt).createRenderer(null,null);_cleanupKeydown;add(e){super.add(e),this._isAttached||(this._ngZone.runOutsideAngular(()=>{this._cleanupKeydown=this._renderer.listen("body","keydown",this._keydownListener)}),this._isAttached=!0)}detach(){this._isAttached&&(this._cleanupKeydown?.(),this._isAttached=!1)}_keydownListener=e=>{const i=this._attachedOverlays;for(let r=i.length-1;r>-1;r--)if(i[r]._keydownEvents.observers.length>0){this._ngZone.run(()=>i[r]._keydownEvents.next(e));break}};static \u0275fac=(()=>{let e;return function(r){return(e||(e=m(t)))(r||t)}})();static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),sQ=(()=>{class t extends _V{_platform=te(xs);_ngZone=te(wt);_renderer=te(gt).createRenderer(null,null);_cursorOriginalValue;_cursorStyleIsSet=!1;_pointerDownEventTarget;_cleanups;add(e){if(super.add(e),!this._isAttached){const i=this._document.body,r={capture:!0};this._cleanups=this._ngZone.runOutsideAngular(()=>[Rl(this._renderer,i,"pointerdown",this._pointerDownListener,r),Rl(this._renderer,i,"click",this._clickListener,r),Rl(this._renderer,i,"auxclick",this._clickListener,r),Rl(this._renderer,i,"contextmenu",this._clickListener,r)]),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=i.style.cursor,i.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){this._isAttached&&(this._cleanups?.forEach(e=>e()),this._cleanups=void 0,this._platform.IOS&&this._cursorStyleIsSet&&(this._document.body.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1)}_pointerDownListener=e=>{this._pointerDownEventTarget=Lp(e)};_clickListener=e=>{const i=Lp(e),r="click"===e.type&&this._pointerDownEventTarget?this._pointerDownEventTarget:i;this._pointerDownEventTarget=null;const l=this._attachedOverlays.slice();for(let f=l.length-1;f>-1;f--){const w=l[f];if(w._outsidePointerEvents.observers.length<1||!w.hasAttached())continue;if(yV(w.overlayElement,i)||yV(w.overlayElement,r))break;const M=w._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>M.next(e)):M.next(e)}};static \u0275fac=(()=>{let e;return function(r){return(e||(e=m(t)))(r||t)}})();static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function yV(t,n){const e=typeof ShadowRoot<"u"&&ShadowRoot;let i=n;for(;i;){if(i===t)return!0;i=e&&i instanceof ShadowRoot?i.host:i.parentNode}return!1}let vV=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275cmp=kn({type:t,selectors:[["ng-component"]],hostAttrs:["cdk-overlay-style-loader",""],decls:0,vars:0,template:function(i,r){},styles:[".cdk-overlay-container,.cdk-global-overlay-wrapper{pointer-events:none;top:0;left:0;height:100%;width:100%}.cdk-overlay-container{position:fixed}@layer cdk-overlay{.cdk-overlay-container{z-index:1000}}.cdk-overlay-container:empty{display:none}.cdk-global-overlay-wrapper{display:flex;position:absolute}@layer cdk-overlay{.cdk-global-overlay-wrapper{z-index:1000}}.cdk-overlay-pane{position:absolute;pointer-events:auto;box-sizing:border-box;display:flex;max-width:100%;max-height:100%}@layer cdk-overlay{.cdk-overlay-pane{z-index:1000}}.cdk-overlay-backdrop{position:absolute;top:0;bottom:0;left:0;right:0;pointer-events:auto;-webkit-tap-highlight-color:rgba(0,0,0,0);opacity:0}@layer cdk-overlay{.cdk-overlay-backdrop{z-index:1000;transition:opacity 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}}@media(prefers-reduced-motion){.cdk-overlay-backdrop{transition-duration:1ms}}.cdk-overlay-backdrop-showing{opacity:1}@media(forced-colors: active){.cdk-overlay-backdrop-showing{opacity:.6}}@layer cdk-overlay{.cdk-overlay-dark-backdrop{background:rgba(0,0,0,.32)}}.cdk-overlay-transparent-backdrop{transition:visibility 1ms linear,opacity 1ms linear;visibility:hidden;opacity:1}.cdk-overlay-transparent-backdrop.cdk-overlay-backdrop-showing,.cdk-high-contrast-active .cdk-overlay-transparent-backdrop{opacity:0;visibility:visible}.cdk-overlay-backdrop-noop-animation{transition:none}.cdk-overlay-connected-position-bounding-box{position:absolute;display:flex;flex-direction:column;min-width:1px;min-height:1px}@layer cdk-overlay{.cdk-overlay-connected-position-bounding-box{z-index:1000}}.cdk-global-scrollblock{position:fixed;width:100%;overflow-y:scroll}\n"],encapsulation:2,changeDetection:0})}return t})(),uR=(()=>{class t{_platform=te(xs);_containerElement;_document=te(mr);_styleLoader=te(cc);constructor(){}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._loadStyles(),this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const e="cdk-overlay-container";if(this._platform.isBrowser||sV()){const r=this._document.querySelectorAll(`.${e}[platform="server"], .${e}[platform="test"]`);for(let l=0;l<r.length;l++)r[l].remove()}const i=this._document.createElement("div");i.classList.add(e),sV()?i.setAttribute("platform","test"):this._platform.isBrowser||i.setAttribute("platform","server"),this._document.body.appendChild(i),this._containerElement=i}_loadStyles(){this._styleLoader.load(vV)}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();class aQ{_renderer;_ngZone;element;_cleanupClick;_cleanupTransitionEnd;_fallbackTimeout;constructor(n,e,i,r){this._renderer=e,this._ngZone=i,this.element=n.createElement("div"),this.element.classList.add("cdk-overlay-backdrop"),this._cleanupClick=e.listen(this.element,"click",r)}detach(){this._ngZone.runOutsideAngular(()=>{const n=this.element;clearTimeout(this._fallbackTimeout),this._cleanupTransitionEnd?.(),this._cleanupTransitionEnd=this._renderer.listen(n,"transitionend",this.dispose),this._fallbackTimeout=setTimeout(this.dispose,500),n.style.pointerEvents="none",n.classList.remove("cdk-overlay-backdrop-showing")})}dispose=()=>{clearTimeout(this._fallbackTimeout),this._cleanupClick?.(),this._cleanupTransitionEnd?.(),this._cleanupClick=this._cleanupTransitionEnd=this._fallbackTimeout=void 0,this.element.remove()}}class hR{_portalOutlet;_host;_pane;_config;_ngZone;_keyboardDispatcher;_document;_location;_outsideClickDispatcher;_animationsDisabled;_injector;_renderer;_backdropClick=new Et;_attachments=new Et;_detachments=new Et;_positionStrategy;_scrollStrategy;_locationChanges=Mi.EMPTY;_backdropRef=null;_previousHostParent;_keydownEvents=new Et;_outsidePointerEvents=new Et;_renders=new Et;_afterRenderRef;_afterNextRenderRef;constructor(n,e,i,r,l,f,w,M,P,L=!1,$,Q){this._portalOutlet=n,this._host=e,this._pane=i,this._config=r,this._ngZone=l,this._keyboardDispatcher=f,this._document=w,this._location=M,this._outsideClickDispatcher=P,this._animationsDisabled=L,this._injector=$,this._renderer=Q,r.scrollStrategy&&(this._scrollStrategy=r.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=r.positionStrategy,this._afterRenderRef=Ps(()=>tg(()=>{this._renders.next()},{injector:this._injector}))}get overlayElement(){return this._pane}get backdropElement(){return this._backdropRef?.element||null}get hostElement(){return this._host}attach(n){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);const e=this._portalOutlet.attach(n);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._afterNextRenderRef?.destroy(),this._afterNextRenderRef=El(()=>{this.hasAttached()&&this.updatePosition()},{injector:this._injector}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),"function"==typeof e?.onDestroy&&e.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),e}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();const n=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenEmpty(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),n}dispose(){const n=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._backdropRef?.dispose(),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._afterNextRenderRef?.destroy(),this._previousHostParent=this._pane=this._host=this._backdropRef=null,n&&this._detachments.next(),this._detachments.complete(),this._afterRenderRef.destroy(),this._renders.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(n){n!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=n,this.hasAttached()&&(n.attach(this),this.updatePosition()))}updateSize(n){this._config={...this._config,...n},this._updateElementSize()}setDirection(n){this._config={...this._config,direction:n},this._updateElementDirection()}addPanelClass(n){this._pane&&this._toggleClasses(this._pane,n,!0)}removePanelClass(n){this._pane&&this._toggleClasses(this._pane,n,!1)}getDirection(){const n=this._config.direction;return n?"string"==typeof n?n:n.value:"ltr"}updateScrollStrategy(n){n!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=n,this.hasAttached()&&(n.attach(this),n.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;const n=this._pane.style;n.width=Ws(this._config.width),n.height=Ws(this._config.height),n.minWidth=Ws(this._config.minWidth),n.minHeight=Ws(this._config.minHeight),n.maxWidth=Ws(this._config.maxWidth),n.maxHeight=Ws(this._config.maxHeight)}_togglePointerEvents(n){this._pane.style.pointerEvents=n?"":"none"}_attachBackdrop(){const n="cdk-overlay-backdrop-showing";this._backdropRef?.dispose(),this._backdropRef=new aQ(this._document,this._renderer,this._ngZone,e=>{this._backdropClick.next(e)}),this._animationsDisabled&&this._backdropRef.element.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropRef.element,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropRef.element,this._host),!this._animationsDisabled&&typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>this._backdropRef?.element.classList.add(n))}):this._backdropRef.element.classList.add(n)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){this._animationsDisabled?(this._backdropRef?.dispose(),this._backdropRef=null):this._backdropRef?.detach()}_toggleClasses(n,e,i){const r=YM(e||[]).filter(l=>!!l);r.length&&(i?n.classList.add(...r):n.classList.remove(...r))}_detachContentWhenEmpty(){this._ngZone.runOutsideAngular(()=>{const n=this._renders.pipe(jr(zc(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||0===this._pane.children.length)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),n.unsubscribe())})})}_disposeScrollStrategy(){const n=this._scrollStrategy;n?.disable(),n?.detach?.()}}const bV="cdk-overlay-connected-position-bounding-box",lQ=/([A-Za-z%]+)$/;class xV{_viewportRuler;_document;_platform;_overlayContainer;_overlayRef;_isInitialRender;_lastBoundingBoxSize={width:0,height:0};_isPushed=!1;_canPush=!0;_growAfterOpen=!1;_hasFlexibleDimensions=!0;_positionLocked=!1;_originRect;_overlayRect;_viewportRect;_containerRect;_viewportMargin=0;_scrollables=[];_preferredPositions=[];_origin;_pane;_isDisposed;_boundingBox;_lastPosition;_lastScrollVisibility;_positionChanges=new Et;_resizeSubscription=Mi.EMPTY;_offsetX=0;_offsetY=0;_transformOriginSelector;_appliedPanelClasses=[];_previousPushAmount;positionChanges=this._positionChanges;get positions(){return this._preferredPositions}constructor(n,e,i,r,l){this._viewportRuler=e,this._document=i,this._platform=r,this._overlayContainer=l,this.setOrigin(n)}attach(n){this._validatePositions(),n.hostElement.classList.add(bV),this._overlayRef=n,this._boundingBox=n.hostElement,this._pane=n.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const n=this._originRect,e=this._overlayRect,i=this._viewportRect,r=this._containerRect,l=[];let f;for(let w of this._preferredPositions){let M=this._getOriginPoint(n,r,w),P=this._getOverlayPoint(M,e,w),L=this._getOverlayFit(P,e,i,w);if(L.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(w,M);this._canFitWithFlexibleDimensions(L,P,i)?l.push({position:w,origin:M,overlayRect:e,boundingBoxRect:this._calculateBoundingBoxRect(M,w)}):(!f||f.overlayFit.visibleArea<L.visibleArea)&&(f={overlayFit:L,overlayPoint:P,originPoint:M,position:w,overlayRect:e})}if(l.length){let w=null,M=-1;for(const P of l){const L=P.boundingBoxRect.width*P.boundingBoxRect.height*(P.position.weight||1);L>M&&(M=L,w=P)}return this._isPushed=!1,void this._applyPosition(w.position,w.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(f.position,f.originPoint);this._applyPosition(f.position,f.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&Qy(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(bV),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;const n=this._lastPosition;if(n){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const e=this._getOriginPoint(this._originRect,this._containerRect,n);this._applyPosition(n,e)}else this.apply()}withScrollableContainers(n){return this._scrollables=n,this}withPositions(n){return this._preferredPositions=n,-1===n.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(n){return this._viewportMargin=n,this}withFlexibleDimensions(n=!0){return this._hasFlexibleDimensions=n,this}withGrowAfterOpen(n=!0){return this._growAfterOpen=n,this}withPush(n=!0){return this._canPush=n,this}withLockedPosition(n=!0){return this._positionLocked=n,this}setOrigin(n){return this._origin=n,this}withDefaultOffsetX(n){return this._offsetX=n,this}withDefaultOffsetY(n){return this._offsetY=n,this}withTransformOriginOn(n){return this._transformOriginSelector=n,this}_getOriginPoint(n,e,i){let r,l;if("center"==i.originX)r=n.left+n.width/2;else{const f=this._isRtl()?n.right:n.left,w=this._isRtl()?n.left:n.right;r="start"==i.originX?f:w}return e.left<0&&(r-=e.left),l="center"==i.originY?n.top+n.height/2:"top"==i.originY?n.top:n.bottom,e.top<0&&(l-=e.top),{x:r,y:l}}_getOverlayPoint(n,e,i){let r,l;return r="center"==i.overlayX?-e.width/2:"start"===i.overlayX?this._isRtl()?-e.width:0:this._isRtl()?0:-e.width,l="center"==i.overlayY?-e.height/2:"top"==i.overlayY?0:-e.height,{x:n.x+r,y:n.y+l}}_getOverlayFit(n,e,i,r){const l=CV(e);let{x:f,y:w}=n,M=this._getOffset(r,"x"),P=this._getOffset(r,"y");M&&(f+=M),P&&(w+=P);let Q=0-w,X=w+l.height-i.height,Y=this._subtractOverflows(l.width,0-f,f+l.width-i.width),K=this._subtractOverflows(l.height,Q,X),de=Y*K;return{visibleArea:de,isCompletelyWithinViewport:l.width*l.height===de,fitsInViewportVertically:K===l.height,fitsInViewportHorizontally:Y==l.width}}_canFitWithFlexibleDimensions(n,e,i){if(this._hasFlexibleDimensions){const r=i.bottom-e.y,l=i.right-e.x,f=wV(this._overlayRef.getConfig().minHeight),w=wV(this._overlayRef.getConfig().minWidth);return(n.fitsInViewportVertically||null!=f&&f<=r)&&(n.fitsInViewportHorizontally||null!=w&&w<=l)}return!1}_pushOverlayOnScreen(n,e,i){if(this._previousPushAmount&&this._positionLocked)return{x:n.x+this._previousPushAmount.x,y:n.y+this._previousPushAmount.y};const r=CV(e),l=this._viewportRect,f=Math.max(n.x+r.width-l.width,0),w=Math.max(n.y+r.height-l.height,0),M=Math.max(l.top-i.top-n.y,0),P=Math.max(l.left-i.left-n.x,0);let L=0,$=0;return L=r.width<=l.width?P||-f:n.x<this._viewportMargin?l.left-i.left-n.x:0,$=r.height<=l.height?M||-w:n.y<this._viewportMargin?l.top-i.top-n.y:0,this._previousPushAmount={x:L,y:$},{x:n.x+L,y:n.y+$}}_applyPosition(n,e){if(this._setTransformOrigin(n),this._setOverlayElementStyles(e,n),this._setBoundingBoxStyles(e,n),n.panelClass&&this._addPanelClasses(n.panelClass),this._positionChanges.observers.length){const i=this._getScrollVisibility();if(n!==this._lastPosition||!this._lastScrollVisibility||!function cQ(t,n){return t===n||t.isOriginClipped===n.isOriginClipped&&t.isOriginOutsideView===n.isOriginOutsideView&&t.isOverlayClipped===n.isOverlayClipped&&t.isOverlayOutsideView===n.isOverlayOutsideView}(this._lastScrollVisibility,i)){const r=new rQ(n,i);this._positionChanges.next(r)}this._lastScrollVisibility=i}this._lastPosition=n,this._isInitialRender=!1}_setTransformOrigin(n){if(!this._transformOriginSelector)return;const e=this._boundingBox.querySelectorAll(this._transformOriginSelector);let i,r=n.overlayY;i="center"===n.overlayX?"center":this._isRtl()?"start"===n.overlayX?"right":"left":"start"===n.overlayX?"left":"right";for(let l=0;l<e.length;l++)e[l].style.transformOrigin=`${i} ${r}`}_calculateBoundingBoxRect(n,e){const i=this._viewportRect,r=this._isRtl();let l,f,w,L,$,Q;if("top"===e.overlayY)f=n.y,l=i.height-f+this._viewportMargin;else if("bottom"===e.overlayY)w=i.height-n.y+2*this._viewportMargin,l=i.height-w+this._viewportMargin;else{const X=Math.min(i.bottom-n.y+i.top,n.y),Y=this._lastBoundingBoxSize.height;l=2*X,f=n.y-X,l>Y&&!this._isInitialRender&&!this._growAfterOpen&&(f=n.y-Y/2)}if("end"===e.overlayX&&!r||"start"===e.overlayX&&r)Q=i.width-n.x+2*this._viewportMargin,L=n.x-this._viewportMargin;else if("start"===e.overlayX&&!r||"end"===e.overlayX&&r)$=n.x,L=i.right-n.x;else{const X=Math.min(i.right-n.x+i.left,n.x),Y=this._lastBoundingBoxSize.width;L=2*X,$=n.x-X,L>Y&&!this._isInitialRender&&!this._growAfterOpen&&($=n.x-Y/2)}return{top:f,left:$,bottom:w,right:Q,width:L,height:l}}_setBoundingBoxStyles(n,e){const i=this._calculateBoundingBoxRect(n,e);!this._isInitialRender&&!this._growAfterOpen&&(i.height=Math.min(i.height,this._lastBoundingBoxSize.height),i.width=Math.min(i.width,this._lastBoundingBoxSize.width));const r={};if(this._hasExactPosition())r.top=r.left="0",r.bottom=r.right=r.maxHeight=r.maxWidth="",r.width=r.height="100%";else{const l=this._overlayRef.getConfig().maxHeight,f=this._overlayRef.getConfig().maxWidth;r.height=Ws(i.height),r.top=Ws(i.top),r.bottom=Ws(i.bottom),r.width=Ws(i.width),r.left=Ws(i.left),r.right=Ws(i.right),r.alignItems="center"===e.overlayX?"center":"end"===e.overlayX?"flex-end":"flex-start",r.justifyContent="center"===e.overlayY?"center":"bottom"===e.overlayY?"flex-end":"flex-start",l&&(r.maxHeight=Ws(l)),f&&(r.maxWidth=Ws(f))}this._lastBoundingBoxSize=i,Qy(this._boundingBox.style,r)}_resetBoundingBoxStyles(){Qy(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){Qy(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(n,e){const i={},r=this._hasExactPosition(),l=this._hasFlexibleDimensions,f=this._overlayRef.getConfig();if(r){const L=this._viewportRuler.getViewportScrollPosition();Qy(i,this._getExactOverlayY(e,n,L)),Qy(i,this._getExactOverlayX(e,n,L))}else i.position="static";let w="",M=this._getOffset(e,"x"),P=this._getOffset(e,"y");M&&(w+=`translateX(${M}px) `),P&&(w+=`translateY(${P}px)`),i.transform=w.trim(),f.maxHeight&&(r?i.maxHeight=Ws(f.maxHeight):l&&(i.maxHeight="")),f.maxWidth&&(r?i.maxWidth=Ws(f.maxWidth):l&&(i.maxWidth="")),Qy(this._pane.style,i)}_getExactOverlayY(n,e,i){let r={top:"",bottom:""},l=this._getOverlayPoint(e,this._overlayRect,n);return this._isPushed&&(l=this._pushOverlayOnScreen(l,this._overlayRect,i)),"bottom"===n.overlayY?r.bottom=this._document.documentElement.clientHeight-(l.y+this._overlayRect.height)+"px":r.top=Ws(l.y),r}_getExactOverlayX(n,e,i){let f,r={left:"",right:""},l=this._getOverlayPoint(e,this._overlayRect,n);return this._isPushed&&(l=this._pushOverlayOnScreen(l,this._overlayRect,i)),f=this._isRtl()?"end"===n.overlayX?"left":"right":"end"===n.overlayX?"right":"left","right"===f?r.right=this._document.documentElement.clientWidth-(l.x+this._overlayRect.width)+"px":r.left=Ws(l.x),r}_getScrollVisibility(){const n=this._getOriginRect(),e=this._pane.getBoundingClientRect(),i=this._scrollables.map(r=>r.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:gV(n,i),isOriginOutsideView:dR(n,i),isOverlayClipped:gV(e,i),isOverlayOutsideView:dR(e,i)}}_subtractOverflows(n,...e){return e.reduce((i,r)=>i-Math.max(r,0),n)}_getNarrowedViewportRect(){const n=this._document.documentElement.clientWidth,e=this._document.documentElement.clientHeight,i=this._viewportRuler.getViewportScrollPosition();return{top:i.top+this._viewportMargin,left:i.left+this._viewportMargin,right:i.left+n-this._viewportMargin,bottom:i.top+e-this._viewportMargin,width:n-2*this._viewportMargin,height:e-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(n,e){return"x"===e?null==n.offsetX?this._offsetX:n.offsetX:null==n.offsetY?this._offsetY:n.offsetY}_validatePositions(){}_addPanelClasses(n){this._pane&&YM(n).forEach(e=>{""!==e&&-1===this._appliedPanelClasses.indexOf(e)&&(this._appliedPanelClasses.push(e),this._pane.classList.add(e))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(n=>{this._pane.classList.remove(n)}),this._appliedPanelClasses=[])}_getOriginRect(){const n=this._origin;if(n instanceof Dn)return n.nativeElement.getBoundingClientRect();if(n instanceof Element)return n.getBoundingClientRect();const e=n.width||0,i=n.height||0;return{top:n.y,bottom:n.y+i,left:n.x,right:n.x+e,height:i,width:e}}}function Qy(t,n){for(let e in n)n.hasOwnProperty(e)&&(t[e]=n[e]);return t}function wV(t){if("number"!=typeof t&&null!=t){const[n,e]=t.split(lQ);return e&&"px"!==e?null:parseFloat(n)}return t||null}function CV(t){return{top:Math.floor(t.top),right:Math.floor(t.right),bottom:Math.floor(t.bottom),left:Math.floor(t.left),width:Math.floor(t.width),height:Math.floor(t.height)}}const EV="cdk-global-overlay-wrapper";class dQ{_overlayRef;_cssPosition="static";_topOffset="";_bottomOffset="";_alignItems="";_xPosition="";_xOffset="";_width="";_height="";_isDisposed=!1;attach(n){const e=n.getConfig();this._overlayRef=n,this._width&&!e.width&&n.updateSize({width:this._width}),this._height&&!e.height&&n.updateSize({height:this._height}),n.hostElement.classList.add(EV),this._isDisposed=!1}top(n=""){return this._bottomOffset="",this._topOffset=n,this._alignItems="flex-start",this}left(n=""){return this._xOffset=n,this._xPosition="left",this}bottom(n=""){return this._topOffset="",this._bottomOffset=n,this._alignItems="flex-end",this}right(n=""){return this._xOffset=n,this._xPosition="right",this}start(n=""){return this._xOffset=n,this._xPosition="start",this}end(n=""){return this._xOffset=n,this._xPosition="end",this}width(n=""){return this._overlayRef?this._overlayRef.updateSize({width:n}):this._width=n,this}height(n=""){return this._overlayRef?this._overlayRef.updateSize({height:n}):this._height=n,this}centerHorizontally(n=""){return this.left(n),this._xPosition="center",this}centerVertically(n=""){return this.top(n),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const n=this._overlayRef.overlayElement.style,e=this._overlayRef.hostElement.style,i=this._overlayRef.getConfig(),{width:r,height:l,maxWidth:f,maxHeight:w}=i,M=!("100%"!==r&&"100vw"!==r||f&&"100%"!==f&&"100vw"!==f),P=!("100%"!==l&&"100vh"!==l||w&&"100%"!==w&&"100vh"!==w),L=this._xPosition,$=this._xOffset,Q="rtl"===this._overlayRef.getConfig().direction;let X="",Y="",K="";M?K="flex-start":"center"===L?(K="center",Q?Y=$:X=$):Q?"left"===L||"end"===L?(K="flex-end",X=$):("right"===L||"start"===L)&&(K="flex-start",Y=$):"left"===L||"start"===L?(K="flex-start",X=$):("right"===L||"end"===L)&&(K="flex-end",Y=$),n.position=this._cssPosition,n.marginLeft=M?"0":X,n.marginTop=P?"0":this._topOffset,n.marginBottom=this._bottomOffset,n.marginRight=M?"0":Y,e.justifyContent=K,e.alignItems=P?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const n=this._overlayRef.overlayElement.style,e=this._overlayRef.hostElement,i=e.style;e.classList.remove(EV),i.justifyContent=i.alignItems=n.marginTop=n.marginBottom=n.marginLeft=n.marginRight=n.position="",this._overlayRef=null,this._isDisposed=!0}}let uQ=(()=>{class t{_viewportRuler=te(JM);_document=te(mr);_platform=te(xs);_overlayContainer=te(uR);constructor(){}global(){return new dQ}flexibleConnectedTo(e){return new xV(e,this._viewportRuler,this._document,this._platform,this._overlayContainer)}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),oa=(()=>{class t{scrollStrategies=te(iQ);_overlayContainer=te(uR);_positionBuilder=te(uQ);_keyboardDispatcher=te(oQ);_injector=te(we);_ngZone=te(wt);_document=te(mr);_directionality=te(Bc);_location=te(M0);_outsideClickDispatcher=te(sQ);_animationsModuleType=te(wa,{optional:!0});_idGenerator=te(Sa);_renderer=te(gt).createRenderer(null,null);_appRef;_styleLoader=te(cc);constructor(){}create(e){this._styleLoader.load(vV);const i=this._createHostElement(),r=this._createPaneElement(i),l=this._createPortalOutlet(r),f=new FC(e);return f.direction=f.direction||this._directionality.value,new hR(l,i,r,f,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,"NoopAnimations"===this._animationsModuleType,this._injector.get(Lo),this._renderer)}position(){return this._positionBuilder}_createPaneElement(e){const i=this._document.createElement("div");return i.id=this._idGenerator.getId("cdk-overlay-"),i.classList.add("cdk-overlay-pane"),e.appendChild(i),i}_createHostElement(){const e=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(e),e}_createPortalOutlet(e){return this._appRef||(this._appRef=this._injector.get(ic)),new nK(e,null,this._appRef,this._injector,this._document)}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();const hQ=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom"},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"}],SV=new _t("cdk-connected-overlay-scroll-strategy",{providedIn:"root",factory:()=>{const t=te(oa);return()=>t.scrollStrategies.reposition()}});let nT=(()=>{class t{elementRef=te(Dn);constructor(){}static \u0275fac=function(i){return new(i||t)};static \u0275dir=Ht({type:t,selectors:[["","cdk-overlay-origin",""],["","overlay-origin",""],["","cdkOverlayOrigin",""]],exportAs:["cdkOverlayOrigin"]})}return t})(),DV=(()=>{class t{_overlay=te(oa);_dir=te(Bc,{optional:!0});_overlayRef;_templatePortal;_backdropSubscription=Mi.EMPTY;_attachSubscription=Mi.EMPTY;_detachSubscription=Mi.EMPTY;_positionSubscription=Mi.EMPTY;_offsetX;_offsetY;_position;_scrollStrategyFactory=te(SV);_disposeOnNavigation=!1;_ngZone=te(wt);origin;positions;positionStrategy;get offsetX(){return this._offsetX}set offsetX(e){this._offsetX=e,this._position&&this._updatePositionStrategy(this._position)}get offsetY(){return this._offsetY}set offsetY(e){this._offsetY=e,this._position&&this._updatePositionStrategy(this._position)}width;height;minWidth;minHeight;backdropClass;panelClass;viewportMargin=0;scrollStrategy;open=!1;disableClose=!1;transformOriginSelector;hasBackdrop=!1;lockPosition=!1;flexibleDimensions=!1;growAfterOpen=!1;push=!1;get disposeOnNavigation(){return this._disposeOnNavigation}set disposeOnNavigation(e){this._disposeOnNavigation=e}backdropClick=new $e;positionChange=new $e;attach=new $e;detach=new $e;overlayKeydown=new $e;overlayOutsideClick=new $e;constructor(){const e=te(is),i=te(io);this._templatePortal=new HM(e,i),this.scrollStrategy=this._scrollStrategyFactory()}get overlayRef(){return this._overlayRef}get dir(){return this._dir?this._dir.value:"ltr"}ngOnDestroy(){this._attachSubscription.unsubscribe(),this._detachSubscription.unsubscribe(),this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this._overlayRef?.dispose()}ngOnChanges(e){this._position&&(this._updatePositionStrategy(this._position),this._overlayRef?.updateSize({width:this.width,minWidth:this.minWidth,height:this.height,minHeight:this.minHeight}),e.origin&&this.open&&this._position.apply()),e.open&&(this.open?this.attachOverlay():this.detachOverlay())}_createOverlay(){(!this.positions||!this.positions.length)&&(this.positions=hQ);const e=this._overlayRef=this._overlay.create(this._buildConfig());this._attachSubscription=e.attachments().subscribe(()=>this.attach.emit()),this._detachSubscription=e.detachments().subscribe(()=>this.detach.emit()),e.keydownEvents().subscribe(i=>{this.overlayKeydown.next(i),27===i.keyCode&&!this.disableClose&&!Ja(i)&&(i.preventDefault(),this.detachOverlay())}),this._overlayRef.outsidePointerEvents().subscribe(i=>{const r=this._getOriginElement(),l=Lp(i);(!r||r!==l&&!r.contains(l))&&this.overlayOutsideClick.next(i)})}_buildConfig(){const e=this._position=this.positionStrategy||this._createPositionStrategy(),i=new FC({direction:this._dir||"ltr",positionStrategy:e,scrollStrategy:this.scrollStrategy,hasBackdrop:this.hasBackdrop,disposeOnNavigation:this.disposeOnNavigation});return(this.width||0===this.width)&&(i.width=this.width),(this.height||0===this.height)&&(i.height=this.height),(this.minWidth||0===this.minWidth)&&(i.minWidth=this.minWidth),(this.minHeight||0===this.minHeight)&&(i.minHeight=this.minHeight),this.backdropClass&&(i.backdropClass=this.backdropClass),this.panelClass&&(i.panelClass=this.panelClass),i}_updatePositionStrategy(e){const i=this.positions.map(r=>({originX:r.originX,originY:r.originY,overlayX:r.overlayX,overlayY:r.overlayY,offsetX:r.offsetX||this.offsetX,offsetY:r.offsetY||this.offsetY,panelClass:r.panelClass||void 0}));return e.setOrigin(this._getOrigin()).withPositions(i).withFlexibleDimensions(this.flexibleDimensions).withPush(this.push).withGrowAfterOpen(this.growAfterOpen).withViewportMargin(this.viewportMargin).withLockedPosition(this.lockPosition).withTransformOriginOn(this.transformOriginSelector)}_createPositionStrategy(){const e=this._overlay.position().flexibleConnectedTo(this._getOrigin());return this._updatePositionStrategy(e),e}_getOrigin(){return this.origin instanceof nT?this.origin.elementRef:this.origin}_getOriginElement(){return this.origin instanceof nT?this.origin.elementRef.nativeElement:this.origin instanceof Dn?this.origin.nativeElement:typeof Element<"u"&&this.origin instanceof Element?this.origin:null}attachOverlay(){this._overlayRef?this._overlayRef.getConfig().hasBackdrop=this.hasBackdrop:this._createOverlay(),this._overlayRef.hasAttached()||this._overlayRef.attach(this._templatePortal),this.hasBackdrop?this._backdropSubscription=this._overlayRef.backdropClick().subscribe(e=>{this.backdropClick.emit(e)}):this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this.positionChange.observers.length>0&&(this._positionSubscription=this._position.positionChanges.pipe(rR(()=>this.positionChange.observers.length>0)).subscribe(e=>{this._ngZone.run(()=>this.positionChange.emit(e)),0===this.positionChange.observers.length&&this._positionSubscription.unsubscribe()})),this.open=!0}detachOverlay(){this._overlayRef?.detach(),this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this.open=!1}static \u0275fac=function(i){return new(i||t)};static \u0275dir=Ht({type:t,selectors:[["","cdk-connected-overlay",""],["","connected-overlay",""],["","cdkConnectedOverlay",""]],inputs:{origin:[0,"cdkConnectedOverlayOrigin","origin"],positions:[0,"cdkConnectedOverlayPositions","positions"],positionStrategy:[0,"cdkConnectedOverlayPositionStrategy","positionStrategy"],offsetX:[0,"cdkConnectedOverlayOffsetX","offsetX"],offsetY:[0,"cdkConnectedOverlayOffsetY","offsetY"],width:[0,"cdkConnectedOverlayWidth","width"],height:[0,"cdkConnectedOverlayHeight","height"],minWidth:[0,"cdkConnectedOverlayMinWidth","minWidth"],minHeight:[0,"cdkConnectedOverlayMinHeight","minHeight"],backdropClass:[0,"cdkConnectedOverlayBackdropClass","backdropClass"],panelClass:[0,"cdkConnectedOverlayPanelClass","panelClass"],viewportMargin:[0,"cdkConnectedOverlayViewportMargin","viewportMargin"],scrollStrategy:[0,"cdkConnectedOverlayScrollStrategy","scrollStrategy"],open:[0,"cdkConnectedOverlayOpen","open"],disableClose:[0,"cdkConnectedOverlayDisableClose","disableClose"],transformOriginSelector:[0,"cdkConnectedOverlayTransformOriginOn","transformOriginSelector"],hasBackdrop:[2,"cdkConnectedOverlayHasBackdrop","hasBackdrop",Un],lockPosition:[2,"cdkConnectedOverlayLockPosition","lockPosition",Un],flexibleDimensions:[2,"cdkConnectedOverlayFlexibleDimensions","flexibleDimensions",Un],growAfterOpen:[2,"cdkConnectedOverlayGrowAfterOpen","growAfterOpen",Un],push:[2,"cdkConnectedOverlayPush","push",Un],disposeOnNavigation:[2,"cdkConnectedOverlayDisposeOnNavigation","disposeOnNavigation",Un]},outputs:{backdropClick:"backdropClick",positionChange:"positionChange",attach:"attach",detach:"detach",overlayKeydown:"overlayKeydown",overlayOutsideClick:"overlayOutsideClick"},exportAs:["cdkConnectedOverlay"],features:[Mr]})}return t})();const fQ={provide:SV,deps:[oa],useFactory:function pQ(t){return()=>t.scrollStrategies.reposition()}};let NC,LC=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275mod=Er({type:t});static \u0275inj=Ai({providers:[oa,fQ],imports:[kC,DC,aR,aR]})}return t})();function gQ(t,n){return t===n}function MV(t){return 0===t.buttons||0===t.detail}function TV(t){const n=t.touches&&t.touches[0]||t.changedTouches&&t.changedTouches[0];return!(!n||-1!==n.identifier||null!=n.radiusX&&1!==n.radiusX||null!=n.radiusY&&1!==n.radiusY)}function iT(t){return function _Q(){if(null==NC&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>NC=!0}))}finally{NC=NC||!1}return NC}()?t:!!t.capture}const yQ=new _t("cdk-input-modality-detector-options"),vQ={ignoreKeys:[18,17,224,91,16]},pR={passive:!0,capture:!0};let bQ=(()=>{class t{_platform=te(xs);_listenerCleanups;modalityDetected;modalityChanged;get mostRecentModality(){return this._modality.value}_mostRecentTarget=null;_modality=new pn(null);_options;_lastTouchMs=0;_onKeydown=e=>{this._options?.ignoreKeys?.some(i=>i===e.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=Lp(e))};_onMousedown=e=>{Date.now()-this._lastTouchMs<650||(this._modality.next(MV(e)?"keyboard":"mouse"),this._mostRecentTarget=Lp(e))};_onTouchstart=e=>{TV(e)?this._modality.next("keyboard"):(this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=Lp(e))};constructor(){const e=te(wt),i=te(mr),r=te(yQ,{optional:!0});if(this._options={...vQ,...r},this.modalityDetected=this._modality.pipe(GB(1)),this.modalityChanged=this.modalityDetected.pipe(function mQ(t,n=Ke){return t=t??gQ,Jn((e,i)=>{let r,l=!0;e.subscribe(li(i,f=>{const w=n(f);(l||!t(r,w))&&(l=!1,r=w,i.next(f))}))})}()),this._platform.isBrowser){const l=te(gt).createRenderer(null,null);this._listenerCleanups=e.runOutsideAngular(()=>[Rl(l,i,"keydown",this._onKeydown,pR),Rl(l,i,"mousedown",this._onMousedown,pR),Rl(l,i,"touchstart",this._onTouchstart,pR)])}}ngOnDestroy(){this._modality.complete(),this._listenerCleanups?.forEach(e=>e())}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var rT=function(t){return t[t.IMMEDIATE=0]="IMMEDIATE",t[t.EVENTUAL=1]="EVENTUAL",t}(rT||{});const xQ=new _t("cdk-focus-monitor-default-options"),oT=iT({passive:!0,capture:!0});let j0=(()=>{class t{_ngZone=te(wt);_platform=te(xs);_inputModalityDetector=te(bQ);_origin=null;_lastFocusOrigin;_windowFocused=!1;_windowFocusTimeoutId;_originTimeoutId;_originFromTouchInteraction=!1;_elementInfo=new Map;_monitoredElementCount=0;_rootNodeFocusListenerCount=new Map;_detectionMode;_windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=setTimeout(()=>this._windowFocused=!1)};_document=te(mr,{optional:!0});_stopInputModalityDetector=new Et;constructor(){const e=te(xQ,{optional:!0});this._detectionMode=e?.detectionMode||rT.IMMEDIATE}_rootNodeFocusAndBlurListener=e=>{for(let r=Lp(e);r;r=r.parentElement)"focus"===e.type?this._onFocus(e,r):this._onBlur(e,r)};monitor(e,i=!1){const r=Bg(e);if(!this._platform.isBrowser||1!==r.nodeType)return Fn();const l=function rK(t){if(function iK(){if(null==Q2){const t=typeof document<"u"?document.head:null;Q2=!(!t||!t.createShadowRoot&&!t.attachShadow)}return Q2}()){const n=t.getRootNode?t.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&n instanceof ShadowRoot)return n}return null}(r)||this._getDocument(),f=this._elementInfo.get(r);if(f)return i&&(f.checkChildren=!0),f.subject;const w={checkChildren:i,subject:new Et,rootNode:l};return this._elementInfo.set(r,w),this._registerGlobalListeners(w),w.subject}stopMonitoring(e){const i=Bg(e),r=this._elementInfo.get(i);r&&(r.subject.complete(),this._setClasses(i),this._elementInfo.delete(i),this._removeGlobalListeners(r))}focusVia(e,i,r){const l=Bg(e);l===this._getDocument().activeElement?this._getClosestElementsInfo(l).forEach(([w,M])=>this._originChanged(w,i,M)):(this._setOrigin(i),"function"==typeof l.focus&&l.focus(r))}ngOnDestroy(){this._elementInfo.forEach((e,i)=>this.stopMonitoring(i))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(e){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(e)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:e&&this._isLastInteractionFromInputLabel(e)?"mouse":"program"}_shouldBeAttributedToTouch(e){return this._detectionMode===rT.EVENTUAL||!!e?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(e,i){e.classList.toggle("cdk-focused",!!i),e.classList.toggle("cdk-touch-focused","touch"===i),e.classList.toggle("cdk-keyboard-focused","keyboard"===i),e.classList.toggle("cdk-mouse-focused","mouse"===i),e.classList.toggle("cdk-program-focused","program"===i)}_setOrigin(e,i=!1){this._ngZone.runOutsideAngular(()=>{this._origin=e,this._originFromTouchInteraction="touch"===e&&i,this._detectionMode===rT.IMMEDIATE&&(clearTimeout(this._originTimeoutId),this._originTimeoutId=setTimeout(()=>this._origin=null,this._originFromTouchInteraction?650:1))})}_onFocus(e,i){const r=this._elementInfo.get(i),l=Lp(e);!r||!r.checkChildren&&i!==l||this._originChanged(i,this._getFocusOrigin(l),r)}_onBlur(e,i){const r=this._elementInfo.get(i);!r||r.checkChildren&&e.relatedTarget instanceof Node&&i.contains(e.relatedTarget)||(this._setClasses(i),this._emitOrigin(r,null))}_emitOrigin(e,i){e.subject.observers.length&&this._ngZone.run(()=>e.subject.next(i))}_registerGlobalListeners(e){if(!this._platform.isBrowser)return;const i=e.rootNode,r=this._rootNodeFocusListenerCount.get(i)||0;r||this._ngZone.runOutsideAngular(()=>{i.addEventListener("focus",this._rootNodeFocusAndBlurListener,oT),i.addEventListener("blur",this._rootNodeFocusAndBlurListener,oT)}),this._rootNodeFocusListenerCount.set(i,r+1),1==++this._monitoredElementCount&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(jr(this._stopInputModalityDetector)).subscribe(l=>{this._setOrigin(l,!0)}))}_removeGlobalListeners(e){const i=e.rootNode;if(this._rootNodeFocusListenerCount.has(i)){const r=this._rootNodeFocusListenerCount.get(i);r>1?this._rootNodeFocusListenerCount.set(i,r-1):(i.removeEventListener("focus",this._rootNodeFocusAndBlurListener,oT),i.removeEventListener("blur",this._rootNodeFocusAndBlurListener,oT),this._rootNodeFocusListenerCount.delete(i))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(e,i,r){this._setClasses(e,i),this._emitOrigin(r,i),this._lastFocusOrigin=i}_getClosestElementsInfo(e){const i=[];return this._elementInfo.forEach((r,l)=>{(l===e||r.checkChildren&&l.contains(e))&&i.push([l,r])}),i}_isLastInteractionFromInputLabel(e){const{_mostRecentTarget:i,mostRecentModality:r}=this._inputModalityDetector;if("mouse"!==r||!i||i===e||"INPUT"!==e.nodeName&&"TEXTAREA"!==e.nodeName||e.disabled)return!1;const l=e.labels;if(l)for(let f=0;f<l.length;f++)if(l[f].contains(i))return!0;return!1}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),wQ=(()=>{class t{_elementRef=te(Dn);_focusMonitor=te(j0);_monitorSubscription;_focusOrigin=null;cdkFocusChange=new $e;constructor(){}get focusOrigin(){return this._focusOrigin}ngAfterViewInit(){const e=this._elementRef.nativeElement;this._monitorSubscription=this._focusMonitor.monitor(e,1===e.nodeType&&e.hasAttribute("cdkMonitorSubtreeFocus")).subscribe(i=>{this._focusOrigin=i,this.cdkFocusChange.emit(i)})}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._monitorSubscription&&this._monitorSubscription.unsubscribe()}static \u0275fac=function(i){return new(i||t)};static \u0275dir=Ht({type:t,selectors:[["","cdkMonitorElementFocus",""],["","cdkMonitorSubtreeFocus",""]],outputs:{cdkFocusChange:"cdkFocusChange"},exportAs:["cdkMonitorFocus"]})}return t})();function CQ(t,n){}class zC{viewContainerRef;injector;id;role="dialog";panelClass="";hasBackdrop=!0;backdropClass="";disableClose=!1;width="";height="";minWidth;minHeight;maxWidth;maxHeight;positionStrategy;data=null;direction;ariaDescribedBy=null;ariaLabelledBy=null;ariaLabel=null;ariaModal=!1;autoFocus="first-tabbable";restoreFocus=!0;scrollStrategy;closeOnNavigation=!0;closeOnDestroy=!0;closeOnOverlayDetachments=!0;componentFactoryResolver;providers;container;templateContext}let AV=(()=>{class t extends $M{_elementRef=te(Dn);_focusTrapFactory=te(tV);_config;_interactivityChecker=te(KB);_ngZone=te(wt);_overlayRef=te(hR);_focusMonitor=te(j0);_renderer=te(yt);_platform=te(xs);_document=te(mr,{optional:!0});_portalOutlet;_focusTrap=null;_elementFocusedBeforeDialogWasOpened=null;_closeInteractionType=null;_ariaLabelledByQueue=[];_changeDetectorRef=te(Do);_injector=te(we);_isDestroyed=!1;constructor(){super(),this._config=te(zC,{optional:!0})||new zC,this._config.ariaLabelledBy&&this._ariaLabelledByQueue.push(this._config.ariaLabelledBy)}_addAriaLabelledBy(e){this._ariaLabelledByQueue.push(e),this._changeDetectorRef.markForCheck()}_removeAriaLabelledBy(e){const i=this._ariaLabelledByQueue.indexOf(e);i>-1&&(this._ariaLabelledByQueue.splice(i,1),this._changeDetectorRef.markForCheck())}_contentAttached(){this._initializeFocusTrap(),this._handleBackdropClicks(),this._captureInitialFocus()}_captureInitialFocus(){this._trapFocus()}ngOnDestroy(){this._isDestroyed=!0,this._restoreFocus()}attachComponentPortal(e){this._portalOutlet.hasAttached();const i=this._portalOutlet.attachComponentPortal(e);return this._contentAttached(),i}attachTemplatePortal(e){this._portalOutlet.hasAttached();const i=this._portalOutlet.attachTemplatePortal(e);return this._contentAttached(),i}attachDomPortal=e=>{this._portalOutlet.hasAttached();const i=this._portalOutlet.attachDomPortal(e);return this._contentAttached(),i};_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(e,i){this._interactivityChecker.isFocusable(e)||(e.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{const r=()=>{l(),f(),e.removeAttribute("tabindex")},l=this._renderer.listen(e,"blur",r),f=this._renderer.listen(e,"mousedown",r)})),e.focus(i)}_focusByCssSelector(e,i){let r=this._elementRef.nativeElement.querySelector(e);r&&this._forceFocus(r,i)}_trapFocus(e){this._isDestroyed||El(()=>{const i=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||i.focus(e);break;case!0:case"first-tabbable":this._focusTrap?.focusInitialElement(e)||this._focusDialogContainer(e);break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]',e);break;default:this._focusByCssSelector(this._config.autoFocus,e)}},{injector:this._injector})}_restoreFocus(){const e=this._config.restoreFocus;let i=null;if("string"==typeof e?i=this._document.querySelector(e):"boolean"==typeof e?i=e?this._elementFocusedBeforeDialogWasOpened:null:e&&(i=e),this._config.restoreFocus&&i&&"function"==typeof i.focus){const r=MC(),l=this._elementRef.nativeElement;(!r||r===this._document.body||r===l||l.contains(r))&&(this._focusMonitor?(this._focusMonitor.focusVia(i,this._closeInteractionType),this._closeInteractionType=null):i.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(e){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus(e)}_containsFocus(){const e=this._elementRef.nativeElement,i=MC();return e===i||e.contains(i)}_initializeFocusTrap(){this._platform.isBrowser&&(this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=MC()))}_handleBackdropClicks(){this._overlayRef.backdropClick().subscribe(()=>{this._config.disableClose&&this._recaptureFocus()})}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=kn({type:t,selectors:[["cdk-dialog-container"]],viewQuery:function(i,r){if(1&i&&kr(qy,7),2&i){let l;Zn(l=Xn())&&(r._portalOutlet=l.first)}},hostAttrs:["tabindex","-1",1,"cdk-dialog-container"],hostVars:6,hostBindings:function(i,r){2&i&&ii("id",r._config.id||null)("role",r._config.role)("aria-modal",r._config.ariaModal)("aria-labelledby",r._config.ariaLabel?null:r._ariaLabelledByQueue[0])("aria-label",r._config.ariaLabel)("aria-describedby",r._config.ariaDescribedBy||null)},features:[Nn],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(i,r){1&i&&vt(0,CQ,0,0,"ng-template",0)},dependencies:[qy],styles:[".cdk-dialog-container{display:block;width:100%;height:100%;min-height:inherit;max-height:inherit}\n"],encapsulation:2})}return t})();class fR{overlayRef;config;componentInstance;componentRef;containerInstance;disableClose;closed=new Et;backdropClick;keydownEvents;outsidePointerEvents;id;_detachSubscription;constructor(n,e){this.overlayRef=n,this.config=e,this.disableClose=e.disableClose,this.backdropClick=n.backdropClick(),this.keydownEvents=n.keydownEvents(),this.outsidePointerEvents=n.outsidePointerEvents(),this.id=e.id,this.keydownEvents.subscribe(i=>{27===i.keyCode&&!this.disableClose&&!Ja(i)&&(i.preventDefault(),this.close(void 0,{focusOrigin:"keyboard"}))}),this.backdropClick.subscribe(()=>{this.disableClose||this.close(void 0,{focusOrigin:"mouse"})}),this._detachSubscription=n.detachments().subscribe(()=>{!1!==e.closeOnOverlayDetachments&&this.close()})}close(n,e){if(this.containerInstance){const i=this.closed;this.containerInstance._closeInteractionType=e?.focusOrigin||"program",this._detachSubscription.unsubscribe(),this.overlayRef.dispose(),i.next(n),i.complete(),this.componentInstance=this.containerInstance=null}}updatePosition(){return this.overlayRef.updatePosition(),this}updateSize(n="",e=""){return this.overlayRef.updateSize({width:n,height:e}),this}addPanelClass(n){return this.overlayRef.addPanelClass(n),this}removePanelClass(n){return this.overlayRef.removePanelClass(n),this}}const kV=new _t("DialogScrollStrategy",{providedIn:"root",factory:()=>{const t=te(oa);return()=>t.scrollStrategies.block()}}),EQ=new _t("DialogData"),SQ=new _t("DefaultDialogConfig");let RV=(()=>{class t{_overlay=te(oa);_injector=te(we);_defaultOptions=te(SQ,{optional:!0});_parentDialog=te(t,{optional:!0,skipSelf:!0});_overlayContainer=te(uR);_idGenerator=te(Sa);_openDialogsAtThisLevel=[];_afterAllClosedAtThisLevel=new Et;_afterOpenedAtThisLevel=new Et;_ariaHiddenElements=new Map;_scrollStrategy=te(kV);get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}afterAllClosed=oC(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(Nc(void 0)));constructor(){}open(e,i){(i={...this._defaultOptions||new zC,...i}).id=i.id||this._idGenerator.getId("cdk-dialog-"),i.id&&this.getDialogById(i.id);const l=this._getOverlayConfig(i),f=this._overlay.create(l),w=new fR(f,i),M=this._attachContainer(f,w,i);return w.containerInstance=M,this._attachDialogContent(e,w,M,i),this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(w),w.closed.subscribe(()=>this._removeOpenDialog(w,!0)),this.afterOpened.next(w),w}closeAll(){mR(this.openDialogs,e=>e.close())}getDialogById(e){return this.openDialogs.find(i=>i.id===e)}ngOnDestroy(){mR(this._openDialogsAtThisLevel,e=>{!1===e.config.closeOnDestroy&&this._removeOpenDialog(e,!1)}),mR(this._openDialogsAtThisLevel,e=>e.close()),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete(),this._openDialogsAtThisLevel=[]}_getOverlayConfig(e){const i=new FC({positionStrategy:e.positionStrategy||this._overlay.position().global().centerHorizontally().centerVertically(),scrollStrategy:e.scrollStrategy||this._scrollStrategy(),panelClass:e.panelClass,hasBackdrop:e.hasBackdrop,direction:e.direction,minWidth:e.minWidth,minHeight:e.minHeight,maxWidth:e.maxWidth,maxHeight:e.maxHeight,width:e.width,height:e.height,disposeOnNavigation:e.closeOnNavigation});return e.backdropClass&&(i.backdropClass=e.backdropClass),i}_attachContainer(e,i,r){const l=r.injector||r.viewContainerRef?.injector,f=[{provide:zC,useValue:r},{provide:fR,useValue:i},{provide:hR,useValue:e}];let w;r.container?"function"==typeof r.container?w=r.container:(w=r.container.type,f.push(...r.container.providers(r))):w=AV;const M=new zg(w,r.viewContainerRef,we.create({parent:l||this._injector,providers:f}));return e.attach(M).instance}_attachDialogContent(e,i,r,l){if(e instanceof is){const f=this._createInjector(l,i,r,void 0);let w={$implicit:l.data,dialogRef:i};l.templateContext&&(w={...w,..."function"==typeof l.templateContext?l.templateContext():l.templateContext}),r.attachTemplatePortal(new HM(e,null,w,f))}else{const f=this._createInjector(l,i,r,this._injector),w=r.attachComponentPortal(new zg(e,l.viewContainerRef,f));i.componentRef=w,i.componentInstance=w.instance}}_createInjector(e,i,r,l){const f=e.injector||e.viewContainerRef?.injector,w=[{provide:EQ,useValue:e.data},{provide:fR,useValue:i}];return e.providers&&("function"==typeof e.providers?w.push(...e.providers(i,e,r)):w.push(...e.providers)),e.direction&&(!f||!f.get(Bc,null,{optional:!0}))&&w.push({provide:Bc,useValue:{value:e.direction,change:Fn()}}),we.create({parent:f||l,providers:w})}_removeOpenDialog(e,i){const r=this.openDialogs.indexOf(e);r>-1&&(this.openDialogs.splice(r,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((l,f)=>{l?f.setAttribute("aria-hidden",l):f.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),i&&this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){const e=this._overlayContainer.getContainerElement();if(e.parentElement){const i=e.parentElement.children;for(let r=i.length-1;r>-1;r--){const l=i[r];l!==e&&"SCRIPT"!==l.nodeName&&"STYLE"!==l.nodeName&&!l.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(l,l.getAttribute("aria-hidden")),l.setAttribute("aria-hidden","true"))}}}_getAfterAllClosed(){const e=this._parentDialog;return e?e._getAfterAllClosed():this._afterAllClosedAtThisLevel}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function mR(t,n){let e=t.length;for(;e--;)n(t[e])}let MQ=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275mod=Er({type:t});static \u0275inj=Ai({providers:[RV],imports:[LC,DC,iR,DC]})}return t})(),Qr=(()=>{class t{constructor(){te(oV)._applyBodyHighContrastModeCssClasses()}static \u0275fac=function(i){return new(i||t)};static \u0275mod=Er({type:t});static \u0275inj=Ai({imports:[kC,kC]})}return t})();function TQ(t,n){}class PV{viewContainerRef;injector;id;role="dialog";panelClass="";hasBackdrop=!0;backdropClass="";disableClose=!1;width="";height="";minWidth;minHeight;maxWidth;maxHeight;position;data=null;direction;ariaDescribedBy=null;ariaLabelledBy=null;ariaLabel=null;ariaModal=!1;autoFocus="first-tabbable";restoreFocus=!0;delayFocusTrap=!0;scrollStrategy;closeOnNavigation=!0;componentFactoryResolver;enterAnimationDuration;exitAnimationDuration}const gR="mdc-dialog--open",OV="mdc-dialog--opening",FV="mdc-dialog--closing";let LV=(()=>{class t extends AV{_animationMode=te(wa,{optional:!0});_animationStateChanged=new $e;_animationsEnabled="NoopAnimations"!==this._animationMode;_actionSectionCount=0;_hostElement=this._elementRef.nativeElement;_enterAnimationDuration=this._animationsEnabled?zV(this._config.enterAnimationDuration)??150:0;_exitAnimationDuration=this._animationsEnabled?zV(this._config.exitAnimationDuration)??75:0;_animationTimer=null;_contentAttached(){super._contentAttached(),this._startOpenAnimation()}_startOpenAnimation(){this._animationStateChanged.emit({state:"opening",totalTime:this._enterAnimationDuration}),this._animationsEnabled?(this._hostElement.style.setProperty(NV,`${this._enterAnimationDuration}ms`),this._requestAnimationFrame(()=>this._hostElement.classList.add(OV,gR)),this._waitForAnimationToComplete(this._enterAnimationDuration,this._finishDialogOpen)):(this._hostElement.classList.add(gR),Promise.resolve().then(()=>this._finishDialogOpen()))}_startExitAnimation(){this._animationStateChanged.emit({state:"closing",totalTime:this._exitAnimationDuration}),this._hostElement.classList.remove(gR),this._animationsEnabled?(this._hostElement.style.setProperty(NV,`${this._exitAnimationDuration}ms`),this._requestAnimationFrame(()=>this._hostElement.classList.add(FV)),this._waitForAnimationToComplete(this._exitAnimationDuration,this._finishDialogClose)):Promise.resolve().then(()=>this._finishDialogClose())}_updateActionSectionCount(e){this._actionSectionCount+=e,this._changeDetectorRef.markForCheck()}_finishDialogOpen=()=>{this._clearAnimationClasses(),this._openAnimationDone(this._enterAnimationDuration)};_finishDialogClose=()=>{this._clearAnimationClasses(),this._animationStateChanged.emit({state:"closed",totalTime:this._exitAnimationDuration})};_clearAnimationClasses(){this._hostElement.classList.remove(OV,FV)}_waitForAnimationToComplete(e,i){null!==this._animationTimer&&clearTimeout(this._animationTimer),this._animationTimer=setTimeout(i,e)}_requestAnimationFrame(e){this._ngZone.runOutsideAngular(()=>{"function"==typeof requestAnimationFrame?requestAnimationFrame(e):e()})}_captureInitialFocus(){this._config.delayFocusTrap||this._trapFocus()}_openAnimationDone(e){this._config.delayFocusTrap&&this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:e})}ngOnDestroy(){super.ngOnDestroy(),null!==this._animationTimer&&clearTimeout(this._animationTimer)}attachComponentPortal(e){const i=super.attachComponentPortal(e);return i.location.nativeElement.classList.add("mat-mdc-dialog-component-host"),i}static \u0275fac=(()=>{let e;return function(r){return(e||(e=m(t)))(r||t)}})();static \u0275cmp=kn({type:t,selectors:[["mat-dialog-container"]],hostAttrs:["tabindex","-1",1,"mat-mdc-dialog-container","mdc-dialog"],hostVars:10,hostBindings:function(i,r){2&i&&(rc("id",r._config.id),ii("aria-modal",r._config.ariaModal)("role",r._config.role)("aria-labelledby",r._config.ariaLabel?null:r._ariaLabelledByQueue[0])("aria-label",r._config.ariaLabel)("aria-describedby",r._config.ariaDescribedBy||null),Di("_mat-animation-noopable",!r._animationsEnabled)("mat-mdc-dialog-container-with-actions",r._actionSectionCount>0))},features:[Nn],decls:3,vars:0,consts:[[1,"mat-mdc-dialog-inner-container","mdc-dialog__container"],[1,"mat-mdc-dialog-surface","mdc-dialog__surface"],["cdkPortalOutlet",""]],template:function(i,r){1&i&&(ae(0,"div",0)(1,"div",1),vt(2,TQ,0,0,"ng-template",2),le()())},dependencies:[qy],styles:['.mat-mdc-dialog-container{width:100%;height:100%;display:block;box-sizing:border-box;max-height:inherit;min-height:inherit;min-width:inherit;max-width:inherit;outline:0}.cdk-overlay-pane.mat-mdc-dialog-panel{max-width:var(--mat-dialog-container-max-width, 560px);min-width:var(--mat-dialog-container-min-width, 280px)}@media(max-width: 599px){.cdk-overlay-pane.mat-mdc-dialog-panel{max-width:var(--mat-dialog-container-small-max-width, calc(100vw - 32px))}}.mat-mdc-dialog-inner-container{display:flex;flex-direction:row;align-items:center;justify-content:space-around;box-sizing:border-box;height:100%;opacity:0;transition:opacity linear var(--mat-dialog-transition-duration, 0ms);max-height:inherit;min-height:inherit;min-width:inherit;max-width:inherit}.mdc-dialog--closing .mat-mdc-dialog-inner-container{transition:opacity 75ms linear;transform:none}.mdc-dialog--open .mat-mdc-dialog-inner-container{opacity:1}._mat-animation-noopable .mat-mdc-dialog-inner-container{transition:none}.mat-mdc-dialog-surface{display:flex;flex-direction:column;flex-grow:0;flex-shrink:0;box-sizing:border-box;width:100%;height:100%;position:relative;overflow-y:auto;outline:0;transform:scale(0.8);transition:transform var(--mat-dialog-transition-duration, 0ms) cubic-bezier(0, 0, 0.2, 1);max-height:inherit;min-height:inherit;min-width:inherit;max-width:inherit;box-shadow:var(--mat-dialog-container-elevation-shadow, none);border-radius:var(--mdc-dialog-container-shape, var(--mat-sys-corner-extra-large, 4px));background-color:var(--mdc-dialog-container-color, var(--mat-sys-surface, white))}[dir=rtl] .mat-mdc-dialog-surface{text-align:right}.mdc-dialog--open .mat-mdc-dialog-surface,.mdc-dialog--closing .mat-mdc-dialog-surface{transform:none}._mat-animation-noopable .mat-mdc-dialog-surface{transition:none}.mat-mdc-dialog-surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:2px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}.mat-mdc-dialog-title{display:block;position:relative;flex-shrink:0;box-sizing:border-box;margin:0 0 1px;padding:var(--mat-dialog-headline-padding, 6px 24px 13px)}.mat-mdc-dialog-title::before{display:inline-block;width:0;height:40px;content:"";vertical-align:0}[dir=rtl] .mat-mdc-dialog-title{text-align:right}.mat-mdc-dialog-container .mat-mdc-dialog-title{color:var(--mdc-dialog-subhead-color, var(--mat-sys-on-surface, rgba(0, 0, 0, 0.87)));font-family:var(--mdc-dialog-subhead-font, var(--mat-sys-headline-small-font, inherit));line-height:var(--mdc-dialog-subhead-line-height, var(--mat-sys-headline-small-line-height, 1.5rem));font-size:var(--mdc-dialog-subhead-size, var(--mat-sys-headline-small-size, 1rem));font-weight:var(--mdc-dialog-subhead-weight, var(--mat-sys-headline-small-weight, 400));letter-spacing:var(--mdc-dialog-subhead-tracking, var(--mat-sys-headline-small-tracking, 0.03125em))}.mat-mdc-dialog-content{display:block;flex-grow:1;box-sizing:border-box;margin:0;overflow:auto;max-height:65vh}.mat-mdc-dialog-content>:first-child{margin-top:0}.mat-mdc-dialog-content>:last-child{margin-bottom:0}.mat-mdc-dialog-container .mat-mdc-dialog-content{color:var(--mdc-dialog-supporting-text-color, var(--mat-sys-on-surface-variant, rgba(0, 0, 0, 0.6)));font-family:var(--mdc-dialog-supporting-text-font, var(--mat-sys-body-medium-font, inherit));line-height:var(--mdc-dialog-supporting-text-line-height, var(--mat-sys-body-medium-line-height, 1.5rem));font-size:var(--mdc-dialog-supporting-text-size, var(--mat-sys-body-medium-size, 1rem));font-weight:var(--mdc-dialog-supporting-text-weight, var(--mat-sys-body-medium-weight, 400));letter-spacing:var(--mdc-dialog-supporting-text-tracking, var(--mat-sys-body-medium-tracking, 0.03125em))}.mat-mdc-dialog-container .mat-mdc-dialog-content{padding:var(--mat-dialog-content-padding, 20px 24px)}.mat-mdc-dialog-container-with-actions .mat-mdc-dialog-content{padding:var(--mat-dialog-with-actions-content-padding, 20px 24px 0)}.mat-mdc-dialog-container .mat-mdc-dialog-title+.mat-mdc-dialog-content{padding-top:0}.mat-mdc-dialog-actions{display:flex;position:relative;flex-shrink:0;flex-wrap:wrap;align-items:center;justify-content:flex-end;box-sizing:border-box;min-height:52px;margin:0;padding:8px;border-top:1px solid rgba(0,0,0,0);padding:var(--mat-dialog-actions-padding, 16px 24px);justify-content:var(--mat-dialog-actions-alignment, flex-end)}@media(forced-colors: active){.mat-mdc-dialog-actions{border-top-color:CanvasText}}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-start,.mat-mdc-dialog-actions[align=start]{justify-content:start}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-center,.mat-mdc-dialog-actions[align=center]{justify-content:center}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-end,.mat-mdc-dialog-actions[align=end]{justify-content:flex-end}.mat-mdc-dialog-actions .mat-button-base+.mat-button-base,.mat-mdc-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:8px}[dir=rtl] .mat-mdc-dialog-actions .mat-button-base+.mat-button-base,[dir=rtl] .mat-mdc-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:0;margin-right:8px}.mat-mdc-dialog-component-host{display:contents}\n'],encapsulation:2})}return t})();const NV="--mat-dialog-transition-duration";function zV(t){return null==t?null:"number"==typeof t?t:t.endsWith("ms")?KM(t.substring(0,t.length-2)):t.endsWith("s")?1e3*KM(t.substring(0,t.length-1)):"0"===t?0:null}var sT=function(t){return t[t.OPEN=0]="OPEN",t[t.CLOSING=1]="CLOSING",t[t.CLOSED=2]="CLOSED",t}(sT||{});class aT{_ref;_containerInstance;componentInstance;componentRef;disableClose;id;_afterOpened=new Et;_beforeClosed=new Et;_result;_closeFallbackTimeout;_state=sT.OPEN;_closeInteractionType;constructor(n,e,i){this._ref=n,this._containerInstance=i,this.disableClose=e.disableClose,this.id=n.id,n.addPanelClass("mat-mdc-dialog-panel"),i._animationStateChanged.pipe(bs(r=>"opened"===r.state),Qa(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),i._animationStateChanged.pipe(bs(r=>"closed"===r.state),Qa(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._finishDialogClose()}),n.overlayRef.detachments().subscribe(()=>{this._beforeClosed.next(this._result),this._beforeClosed.complete(),this._finishDialogClose()}),zc(this.backdropClick(),this.keydownEvents().pipe(bs(r=>27===r.keyCode&&!this.disableClose&&!Ja(r)))).subscribe(r=>{this.disableClose||(r.preventDefault(),function BV(t,n,e){return t._closeInteractionType=n,t.close(e)}(this,"keydown"===r.type?"keyboard":"mouse"))})}close(n){this._result=n,this._containerInstance._animationStateChanged.pipe(bs(e=>"closing"===e.state),Qa(1)).subscribe(e=>{this._beforeClosed.next(n),this._beforeClosed.complete(),this._ref.overlayRef.detachBackdrop(),this._closeFallbackTimeout=setTimeout(()=>this._finishDialogClose(),e.totalTime+100)}),this._state=sT.CLOSING,this._containerInstance._startExitAnimation()}afterOpened(){return this._afterOpened}afterClosed(){return this._ref.closed}beforeClosed(){return this._beforeClosed}backdropClick(){return this._ref.backdropClick}keydownEvents(){return this._ref.keydownEvents}updatePosition(n){let e=this._ref.config.positionStrategy;return n&&(n.left||n.right)?n.left?e.left(n.left):e.right(n.right):e.centerHorizontally(),n&&(n.top||n.bottom)?n.top?e.top(n.top):e.bottom(n.bottom):e.centerVertically(),this._ref.updatePosition(),this}updateSize(n="",e=""){return this._ref.updateSize(n,e),this}addPanelClass(n){return this._ref.addPanelClass(n),this}removePanelClass(n){return this._ref.removePanelClass(n),this}getState(){return this._state}_finishDialogClose(){this._state=sT.CLOSED,this._ref.close(this._result,{focusOrigin:this._closeInteractionType}),this.componentInstance=null}}const VV=new _t("MatMdcDialogData"),kQ=new _t("mat-mdc-dialog-default-options"),UV=new _t("mat-mdc-dialog-scroll-strategy",{providedIn:"root",factory:()=>{const t=te(oa);return()=>t.scrollStrategies.block()}});let Vg=(()=>{class t{_overlay=te(oa);_defaultOptions=te(kQ,{optional:!0});_scrollStrategy=te(UV);_parentDialog=te(t,{optional:!0,skipSelf:!0});_idGenerator=te(Sa);_dialog=te(RV);_openDialogsAtThisLevel=[];_afterAllClosedAtThisLevel=new Et;_afterOpenedAtThisLevel=new Et;dialogConfigClass=PV;_dialogRefConstructor;_dialogContainerType;_dialogDataToken;get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}_getAfterAllClosed(){const e=this._parentDialog;return e?e._getAfterAllClosed():this._afterAllClosedAtThisLevel}afterAllClosed=oC(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(Nc(void 0)));constructor(){this._dialogRefConstructor=aT,this._dialogContainerType=LV,this._dialogDataToken=VV}open(e,i){let r;(i={...this._defaultOptions||new PV,...i}).id=i.id||this._idGenerator.getId("mat-mdc-dialog-"),i.scrollStrategy=i.scrollStrategy||this._scrollStrategy();const l=this._dialog.open(e,{...i,positionStrategy:this._overlay.position().global().centerHorizontally().centerVertically(),disableClose:!0,closeOnDestroy:!1,closeOnOverlayDetachments:!1,container:{type:this._dialogContainerType,providers:()=>[{provide:this.dialogConfigClass,useValue:i},{provide:zC,useValue:i}]},templateContext:()=>({dialogRef:r}),providers:(f,w,M)=>(r=new this._dialogRefConstructor(f,i,M),r.updatePosition(i?.position),[{provide:this._dialogContainerType,useValue:M},{provide:this._dialogDataToken,useValue:w.data},{provide:this._dialogRefConstructor,useValue:r}])});return r.componentRef=l.componentRef,r.componentInstance=l.componentInstance,this.openDialogs.push(r),this.afterOpened.next(r),r.afterClosed().subscribe(()=>{const f=this.openDialogs.indexOf(r);f>-1&&(this.openDialogs.splice(f,1),this.openDialogs.length||this._getAfterAllClosed().next())}),r}closeAll(){this._closeDialogs(this.openDialogs)}getDialogById(e){return this.openDialogs.find(i=>i.id===e)}ngOnDestroy(){this._closeDialogs(this._openDialogsAtThisLevel),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete()}_closeDialogs(e){let i=e.length;for(;i--;)e[i].close()}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),jV=(()=>{class t{_dialogRef=te(aT,{optional:!0});_elementRef=te(Dn);_dialog=te(Vg);constructor(){}ngOnInit(){this._dialogRef||(this._dialogRef=function qV(t,n){let e=t.nativeElement.parentElement;for(;e&&!e.classList.contains("mat-mdc-dialog-container");)e=e.parentElement;return e?n.find(i=>i.id===e.id):null}(this._elementRef,this._dialog.openDialogs)),this._dialogRef&&Promise.resolve().then(()=>{this._onAdd()})}ngOnDestroy(){this._dialogRef?._containerInstance&&Promise.resolve().then(()=>{this._onRemove()})}static \u0275fac=function(i){return new(i||t)};static \u0275dir=Ht({type:t})}return t})(),HV=(()=>{class t extends jV{id=te(Sa).getId("mat-mdc-dialog-title-");_onAdd(){this._dialogRef._containerInstance?._addAriaLabelledBy?.(this.id)}_onRemove(){this._dialogRef?._containerInstance?._removeAriaLabelledBy?.(this.id)}static \u0275fac=(()=>{let e;return function(r){return(e||(e=m(t)))(r||t)}})();static \u0275dir=Ht({type:t,selectors:[["","mat-dialog-title",""],["","matDialogTitle",""]],hostAttrs:[1,"mat-mdc-dialog-title","mdc-dialog__title"],hostVars:1,hostBindings:function(i,r){2&i&&rc("id",r.id)},inputs:{id:"id"},exportAs:["matDialogTitle"],features:[Nn]})}return t})(),$V=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275dir=Ht({type:t,selectors:[["","mat-dialog-content",""],["mat-dialog-content"],["","matDialogContent",""]],hostAttrs:[1,"mat-mdc-dialog-content","mdc-dialog__content"],features:[UO([HK])]})}return t})(),GV=(()=>{class t extends jV{align;_onAdd(){this._dialogRef._containerInstance?._updateActionSectionCount?.(1)}_onRemove(){this._dialogRef._containerInstance?._updateActionSectionCount?.(-1)}static \u0275fac=(()=>{let e;return function(r){return(e||(e=m(t)))(r||t)}})();static \u0275dir=Ht({type:t,selectors:[["","mat-dialog-actions",""],["mat-dialog-actions"],["","matDialogActions",""]],hostAttrs:[1,"mat-mdc-dialog-actions","mdc-dialog__actions"],hostVars:6,hostBindings:function(i,r){2&i&&Di("mat-mdc-dialog-actions-align-start","start"===r.align)("mat-mdc-dialog-actions-align-center","center"===r.align)("mat-mdc-dialog-actions-align-end","end"===r.align)},inputs:{align:"align"},features:[Nn]})}return t})();let _R=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275mod=Er({type:t});static \u0275inj=Ai({providers:[Vg],imports:[MQ,LC,DC,Qr,Qr]})}return t})();var Du=function(t){return t[t.FADING_IN=0]="FADING_IN",t[t.VISIBLE=1]="VISIBLE",t[t.FADING_OUT=2]="FADING_OUT",t[t.HIDDEN=3]="HIDDEN",t}(Du||{});class OQ{_renderer;element;config;_animationForciblyDisabledThroughCss;state=Du.HIDDEN;constructor(n,e,i,r=!1){this._renderer=n,this.element=e,this.config=i,this._animationForciblyDisabledThroughCss=r}fadeOut(){this._renderer.fadeOutRipple(this)}}const WV=iT({passive:!0,capture:!0});class FQ{_events=new Map;addHandler(n,e,i,r){const l=this._events.get(e);if(l){const f=l.get(i);f?f.add(r):l.set(i,new Set([r]))}else this._events.set(e,new Map([[i,new Set([r])]])),n.runOutsideAngular(()=>{document.addEventListener(e,this._delegateEventHandler,WV)})}removeHandler(n,e,i){const r=this._events.get(n);if(!r)return;const l=r.get(e);l&&(l.delete(i),0===l.size&&r.delete(e),0===r.size&&(this._events.delete(n),document.removeEventListener(n,this._delegateEventHandler,WV)))}_delegateEventHandler=n=>{const e=Lp(n);e&&this._events.get(n.type)?.forEach((i,r)=>{(r===e||r.contains(e))&&i.forEach(l=>l.handleEvent(n))})}}const lT={enterDuration:225,exitDuration:150},YV=iT({passive:!0,capture:!0}),ZV=["mousedown","touchstart"],XV=["mouseup","mouseleave","touchend","touchcancel"];let NQ=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275cmp=kn({type:t,selectors:[["ng-component"]],hostAttrs:["mat-ripple-style-loader",""],decls:0,vars:0,template:function(i,r){},styles:[".mat-ripple{overflow:hidden;position:relative}.mat-ripple:not(:empty){transform:translateZ(0)}.mat-ripple.mat-ripple-unbounded{overflow:visible}.mat-ripple-element{position:absolute;border-radius:50%;pointer-events:none;transition:opacity,transform 0ms cubic-bezier(0, 0, 0.2, 1);transform:scale3d(0, 0, 0);background-color:var(--mat-ripple-color, color-mix(in srgb, var(--mat-sys-on-surface) 10%, transparent))}@media(forced-colors: active){.mat-ripple-element{display:none}}.cdk-drag-preview .mat-ripple-element,.cdk-drag-placeholder .mat-ripple-element{display:none}\n"],encapsulation:2,changeDetection:0})}return t})();class BC{_target;_ngZone;_platform;_containerElement;_triggerElement;_isPointerDown=!1;_activeRipples=new Map;_mostRecentTransientRipple;_lastTouchStartEvent;_pointerUpEventsRegistered=!1;_containerRect;static _eventManager=new FQ;constructor(n,e,i,r,l){this._target=n,this._ngZone=e,this._platform=r,r.isBrowser&&(this._containerElement=Bg(i)),l&&l.get(cc).load(NQ)}fadeInRipple(n,e,i={}){const r=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),l={...lT,...i.animation};i.centered&&(n=r.left+r.width/2,e=r.top+r.height/2);const f=i.radius||function zQ(t,n,e){const i=Math.max(Math.abs(t-e.left),Math.abs(t-e.right)),r=Math.max(Math.abs(n-e.top),Math.abs(n-e.bottom));return Math.sqrt(i*i+r*r)}(n,e,r),w=n-r.left,M=e-r.top,P=l.enterDuration,L=document.createElement("div");L.classList.add("mat-ripple-element"),L.style.left=w-f+"px",L.style.top=M-f+"px",L.style.height=2*f+"px",L.style.width=2*f+"px",null!=i.color&&(L.style.backgroundColor=i.color),L.style.transitionDuration=`${P}ms`,this._containerElement.appendChild(L);const $=window.getComputedStyle(L),X=$.transitionDuration,Y="none"===$.transitionProperty||"0s"===X||"0s, 0s"===X||0===r.width&&0===r.height,K=new OQ(this,L,i,Y);L.style.transform="scale3d(1, 1, 1)",K.state=Du.FADING_IN,i.persistent||(this._mostRecentTransientRipple=K);let de=null;return!Y&&(P||l.exitDuration)&&this._ngZone.runOutsideAngular(()=>{const ye=()=>{de&&(de.fallbackTimer=null),clearTimeout(Ce),this._finishRippleTransition(K)},he=()=>this._destroyRipple(K),Ce=setTimeout(he,P+100);L.addEventListener("transitionend",ye),L.addEventListener("transitioncancel",he),de={onTransitionEnd:ye,onTransitionCancel:he,fallbackTimer:Ce}}),this._activeRipples.set(K,de),(Y||!P)&&this._finishRippleTransition(K),K}fadeOutRipple(n){if(n.state===Du.FADING_OUT||n.state===Du.HIDDEN)return;const e=n.element,i={...lT,...n.config.animation};e.style.transitionDuration=`${i.exitDuration}ms`,e.style.opacity="0",n.state=Du.FADING_OUT,(n._animationForciblyDisabledThroughCss||!i.exitDuration)&&this._finishRippleTransition(n)}fadeOutAll(){this._getActiveRipples().forEach(n=>n.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(n=>{n.config.persistent||n.fadeOut()})}setupTriggerEvents(n){const e=Bg(n);!this._platform.isBrowser||!e||e===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=e,ZV.forEach(i=>{BC._eventManager.addHandler(this._ngZone,i,e,this)}))}handleEvent(n){"mousedown"===n.type?this._onMousedown(n):"touchstart"===n.type?this._onTouchStart(n):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{XV.forEach(e=>{this._triggerElement.addEventListener(e,this,YV)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(n){n.state===Du.FADING_IN?this._startFadeOutTransition(n):n.state===Du.FADING_OUT&&this._destroyRipple(n)}_startFadeOutTransition(n){const e=n===this._mostRecentTransientRipple,{persistent:i}=n.config;n.state=Du.VISIBLE,!i&&(!e||!this._isPointerDown)&&n.fadeOut()}_destroyRipple(n){const e=this._activeRipples.get(n)??null;this._activeRipples.delete(n),this._activeRipples.size||(this._containerRect=null),n===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),n.state=Du.HIDDEN,null!==e&&(n.element.removeEventListener("transitionend",e.onTransitionEnd),n.element.removeEventListener("transitioncancel",e.onTransitionCancel),null!==e.fallbackTimer&&clearTimeout(e.fallbackTimer)),n.element.remove()}_onMousedown(n){const e=MV(n),i=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+800;!this._target.rippleDisabled&&!e&&!i&&(this._isPointerDown=!0,this.fadeInRipple(n.clientX,n.clientY,this._target.rippleConfig))}_onTouchStart(n){if(!this._target.rippleDisabled&&!TV(n)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;const e=n.changedTouches;if(e)for(let i=0;i<e.length;i++)this.fadeInRipple(e[i].clientX,e[i].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(n=>{!n.config.persistent&&(n.state===Du.VISIBLE||n.config.terminateOnPointerUp&&n.state===Du.FADING_IN)&&n.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){const n=this._triggerElement;n&&(ZV.forEach(e=>BC._eventManager.removeHandler(e,n,this)),this._pointerUpEventsRegistered&&(XV.forEach(e=>n.removeEventListener(e,this,YV)),this._pointerUpEventsRegistered=!1))}}const yR=new _t("mat-ripple-global-options");let KV=(()=>{class t{_elementRef=te(Dn);_animationMode=te(wa,{optional:!0});color;unbounded;centered;radius=0;animation;get disabled(){return this._disabled}set disabled(e){e&&this.fadeOutAllNonPersistent(),this._disabled=e,this._setupTriggerEventsIfEnabled()}_disabled=!1;get trigger(){return this._trigger||this._elementRef.nativeElement}set trigger(e){this._trigger=e,this._setupTriggerEventsIfEnabled()}_trigger;_rippleRenderer;_globalOptions;_isInitialized=!1;constructor(){const e=te(wt),i=te(xs),r=te(yR,{optional:!0}),l=te(we);this._globalOptions=r||{},this._rippleRenderer=new BC(this,e,this._elementRef,i,l)}ngOnInit(){this._isInitialized=!0,this._setupTriggerEventsIfEnabled()}ngOnDestroy(){this._rippleRenderer._removeTriggerEvents()}fadeOutAll(){this._rippleRenderer.fadeOutAll()}fadeOutAllNonPersistent(){this._rippleRenderer.fadeOutAllNonPersistent()}get rippleConfig(){return{centered:this.centered,radius:this.radius,color:this.color,animation:{...this._globalOptions.animation,..."NoopAnimations"===this._animationMode?{enterDuration:0,exitDuration:0}:{},...this.animation},terminateOnPointerUp:this._globalOptions.terminateOnPointerUp}}get rippleDisabled(){return this.disabled||!!this._globalOptions.disabled}_setupTriggerEventsIfEnabled(){!this.disabled&&this._isInitialized&&this._rippleRenderer.setupTriggerEvents(this.trigger)}launch(e,i=0,r){return"number"==typeof e?this._rippleRenderer.fadeInRipple(e,i,{...this.rippleConfig,...r}):this._rippleRenderer.fadeInRipple(0,0,{...this.rippleConfig,...e})}static \u0275fac=function(i){return new(i||t)};static \u0275dir=Ht({type:t,selectors:[["","mat-ripple",""],["","matRipple",""]],hostAttrs:[1,"mat-ripple"],hostVars:2,hostBindings:function(i,r){2&i&&Di("mat-ripple-unbounded",r.unbounded)},inputs:{color:[0,"matRippleColor","color"],unbounded:[0,"matRippleUnbounded","unbounded"],centered:[0,"matRippleCentered","centered"],radius:[0,"matRippleRadius","radius"],animation:[0,"matRippleAnimation","animation"],disabled:[0,"matRippleDisabled","disabled"],trigger:[0,"matRippleTrigger","trigger"]},exportAs:["matRipple"]})}return t})();const BQ={capture:!0},VQ=["focus","mousedown","mouseenter","touchstart"],vR="mat-ripple-loader-uninitialized",bR="mat-ripple-loader-class-name",QV="mat-ripple-loader-centered",cT="mat-ripple-loader-disabled";let JV=(()=>{class t{_document=te(mr);_animationMode=te(wa,{optional:!0});_globalRippleOptions=te(yR,{optional:!0});_platform=te(xs);_ngZone=te(wt);_injector=te(we);_eventCleanups;_hosts=new Map;constructor(){const e=te(gt).createRenderer(null,null);this._eventCleanups=this._ngZone.runOutsideAngular(()=>VQ.map(i=>Rl(e,this._document,i,this._onInteraction,BQ)))}ngOnDestroy(){const e=this._hosts.keys();for(const i of e)this.destroyRipple(i);this._eventCleanups.forEach(i=>i())}configureRipple(e,i){e.setAttribute(vR,this._globalRippleOptions?.namespace??""),(i.className||!e.hasAttribute(bR))&&e.setAttribute(bR,i.className||""),i.centered&&e.setAttribute(QV,""),i.disabled&&e.setAttribute(cT,"")}setDisabled(e,i){const r=this._hosts.get(e);r?(r.target.rippleDisabled=i,!i&&!r.hasSetUpEvents&&(r.hasSetUpEvents=!0,r.renderer.setupTriggerEvents(e))):i?e.setAttribute(cT,""):e.removeAttribute(cT)}_onInteraction=e=>{const i=Lp(e);if(i instanceof HTMLElement){const r=i.closest(`[${vR}="${this._globalRippleOptions?.namespace??""}"]`);r&&this._createRipple(r)}};_createRipple(e){if(!this._document||this._hosts.has(e))return;e.querySelector(".mat-ripple")?.remove();const i=this._document.createElement("span");i.classList.add("mat-ripple",e.getAttribute(bR)),e.append(i);const r="NoopAnimations"===this._animationMode,l=this._globalRippleOptions,f=r?0:l?.animation?.enterDuration??lT.enterDuration,w=r?0:l?.animation?.exitDuration??lT.exitDuration,M={rippleDisabled:r||l?.disabled||e.hasAttribute(cT),rippleConfig:{centered:e.hasAttribute(QV),terminateOnPointerUp:l?.terminateOnPointerUp,animation:{enterDuration:f,exitDuration:w}}},P=new BC(M,this._ngZone,i,this._platform,this._injector),L=!M.rippleDisabled;L&&P.setupTriggerEvents(e),this._hosts.set(e,{target:M,renderer:P,hasSetUpEvents:L}),e.removeAttribute(vR)}destroyRipple(e){const i=this._hosts.get(e);i&&(i.renderer._removeTriggerEvents(),this._hosts.delete(e))}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),H0=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275cmp=kn({type:t,selectors:[["structural-styles"]],decls:0,vars:0,template:function(i,r){},styles:['.mat-focus-indicator{position:relative}.mat-focus-indicator::before{top:0;left:0;right:0;bottom:0;position:absolute;box-sizing:border-box;pointer-events:none;display:var(--mat-focus-indicator-display, none);border-width:var(--mat-focus-indicator-border-width, 3px);border-style:var(--mat-focus-indicator-border-style, solid);border-color:var(--mat-focus-indicator-border-color, transparent);border-radius:var(--mat-focus-indicator-border-radius, 4px)}.mat-focus-indicator:focus::before{content:""}@media(forced-colors: active){html{--mat-focus-indicator-display: block}}\n'],encapsulation:2,changeDetection:0})}return t})();const UQ=["mat-icon-button",""],jQ=["*"],HQ=new _t("MAT_BUTTON_CONFIG"),$Q=[{attribute:"mat-button",mdcClasses:["mdc-button","mat-mdc-button"]},{attribute:"mat-flat-button",mdcClasses:["mdc-button","mdc-button--unelevated","mat-mdc-unelevated-button"]},{attribute:"mat-raised-button",mdcClasses:["mdc-button","mdc-button--raised","mat-mdc-raised-button"]},{attribute:"mat-stroked-button",mdcClasses:["mdc-button","mdc-button--outlined","mat-mdc-outlined-button"]},{attribute:"mat-fab",mdcClasses:["mdc-fab","mat-mdc-fab-base","mat-mdc-fab"]},{attribute:"mat-mini-fab",mdcClasses:["mdc-fab","mat-mdc-fab-base","mdc-fab--mini","mat-mdc-mini-fab"]},{attribute:"mat-icon-button",mdcClasses:["mdc-icon-button","mat-mdc-icon-button"]}];let e4=(()=>{class t{_elementRef=te(Dn);_ngZone=te(wt);_animationMode=te(wa,{optional:!0});_focusMonitor=te(j0);_rippleLoader=te(JV);_isFab=!1;color;get disableRipple(){return this._disableRipple}set disableRipple(e){this._disableRipple=e,this._updateRippleDisabled()}_disableRipple=!1;get disabled(){return this._disabled}set disabled(e){this._disabled=e,this._updateRippleDisabled()}_disabled=!1;ariaDisabled;disabledInteractive;constructor(){te(cc).load(H0);const e=te(HQ,{optional:!0}),i=this._elementRef.nativeElement,r=i.classList;this.disabledInteractive=e?.disabledInteractive??!1,this.color=e?.color??null,this._rippleLoader?.configureRipple(i,{className:"mat-mdc-button-ripple"});for(const{attribute:l,mdcClasses:f}of $Q)i.hasAttribute(l)&&r.add(...f)}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._rippleLoader?.destroyRipple(this._elementRef.nativeElement)}focus(e="program",i){e?this._focusMonitor.focusVia(this._elementRef.nativeElement,e,i):this._elementRef.nativeElement.focus(i)}_getAriaDisabled(){return null!=this.ariaDisabled?this.ariaDisabled:!(!this.disabled||!this.disabledInteractive)||null}_getDisabledAttribute(){return!(this.disabledInteractive||!this.disabled)||null}_updateRippleDisabled(){this._rippleLoader?.setDisabled(this._elementRef.nativeElement,this.disableRipple||this.disabled)}static \u0275fac=function(i){return new(i||t)};static \u0275dir=Ht({type:t,inputs:{color:"color",disableRipple:[2,"disableRipple","disableRipple",Un],disabled:[2,"disabled","disabled",Un],ariaDisabled:[2,"aria-disabled","ariaDisabled",Un],disabledInteractive:[2,"disabledInteractive","disabledInteractive",Un]}})}return t})(),Ug=(()=>{class t extends e4{constructor(){super(),this._rippleLoader.configureRipple(this._elementRef.nativeElement,{centered:!0})}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=kn({type:t,selectors:[["button","mat-icon-button",""]],hostVars:14,hostBindings:function(i,r){2&i&&(ii("disabled",r._getDisabledAttribute())("aria-disabled",r._getAriaDisabled()),Kf(r.color?"mat-"+r.color:""),Di("mat-mdc-button-disabled",r.disabled)("mat-mdc-button-disabled-interactive",r.disabledInteractive)("_mat-animation-noopable","NoopAnimations"===r._animationMode)("mat-unthemed",!r.color)("mat-mdc-button-base",!0))},exportAs:["matButton"],features:[Nn],attrs:UQ,ngContentSelectors:jQ,decls:4,vars:0,consts:[[1,"mat-mdc-button-persistent-ripple","mdc-icon-button__ripple"],[1,"mat-focus-indicator"],[1,"mat-mdc-button-touch-target"]],template:function(i,r){1&i&&(os(),Wt(0,"span",0),Fi(1),Wt(2,"span",1)(3,"span",2))},styles:['.mat-mdc-icon-button{-webkit-user-select:none;user-select:none;display:inline-block;position:relative;box-sizing:border-box;border:none;outline:none;background-color:rgba(0,0,0,0);fill:currentColor;color:inherit;text-decoration:none;cursor:pointer;z-index:0;overflow:visible;border-radius:50%;flex-shrink:0;text-align:center;width:var(--mdc-icon-button-state-layer-size, 40px);height:var(--mdc-icon-button-state-layer-size, 40px);padding:calc(calc(var(--mdc-icon-button-state-layer-size, 40px) - var(--mdc-icon-button-icon-size, 24px)) / 2);font-size:var(--mdc-icon-button-icon-size, 24px);color:var(--mdc-icon-button-icon-color, var(--mat-sys-on-surface-variant));-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-icon-button .mat-mdc-button-ripple,.mat-mdc-icon-button .mat-mdc-button-persistent-ripple,.mat-mdc-icon-button .mat-mdc-button-persistent-ripple::before{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-icon-button .mat-mdc-button-ripple{overflow:hidden}.mat-mdc-icon-button .mat-mdc-button-persistent-ripple::before{content:"";opacity:0}.mat-mdc-icon-button .mdc-button__label,.mat-mdc-icon-button .mat-icon{z-index:1;position:relative}.mat-mdc-icon-button .mat-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute}.mat-mdc-icon-button:focus>.mat-focus-indicator::before{content:""}.mat-mdc-icon-button .mat-ripple-element{background-color:var(--mat-icon-button-ripple-color, color-mix(in srgb, var(--mat-sys-on-surface-variant) calc(var(--mat-sys-pressed-state-layer-opacity) * 100%), transparent))}.mat-mdc-icon-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-icon-button-state-layer-color, var(--mat-sys-on-surface-variant))}.mat-mdc-icon-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-icon-button-disabled-state-layer-color, var(--mat-sys-on-surface-variant))}.mat-mdc-icon-button:hover>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-icon-button-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mat-mdc-icon-button.cdk-program-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-icon-button.cdk-keyboard-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-icon-button.mat-mdc-button-disabled-interactive:focus>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-icon-button-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mat-mdc-icon-button:active>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-icon-button-pressed-state-layer-opacity, var(--mat-sys-pressed-state-layer-opacity))}.mat-mdc-icon-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:50%;width:48px;transform:translate(-50%, -50%);display:var(--mat-icon-button-touch-target-display, block)}.mat-mdc-icon-button._mat-animation-noopable{transition:none !important;animation:none !important}.mat-mdc-icon-button[disabled],.mat-mdc-icon-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-icon-button-disabled-icon-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent))}.mat-mdc-icon-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-icon-button img,.mat-mdc-icon-button svg{width:var(--mdc-icon-button-icon-size, 24px);height:var(--mdc-icon-button-icon-size, 24px);vertical-align:baseline}.mat-mdc-icon-button .mat-mdc-button-persistent-ripple{border-radius:50%}.mat-mdc-icon-button[hidden]{display:none}.mat-mdc-icon-button.mat-unthemed:not(.mdc-ripple-upgraded):focus::before,.mat-mdc-icon-button.mat-primary:not(.mdc-ripple-upgraded):focus::before,.mat-mdc-icon-button.mat-accent:not(.mdc-ripple-upgraded):focus::before,.mat-mdc-icon-button.mat-warn:not(.mdc-ripple-upgraded):focus::before{background:rgba(0,0,0,0);opacity:1}\n',"@media(forced-colors: active){.mat-mdc-button:not(.mdc-button--outlined),.mat-mdc-unelevated-button:not(.mdc-button--outlined),.mat-mdc-raised-button:not(.mdc-button--outlined),.mat-mdc-outlined-button:not(.mdc-button--outlined),.mat-mdc-icon-button.mat-mdc-icon-button,.mat-mdc-outlined-button .mdc-button__ripple{outline:solid 1px}}\n"],encapsulation:2,changeDetection:0})}return t})(),xR=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275mod=Er({type:t});static \u0275inj=Ai({imports:[Qr,Qr]})}return t})();const GQ=["mat-button",""],qQ=[[["",8,"material-icons",3,"iconPositionEnd",""],["mat-icon",3,"iconPositionEnd",""],["","matButtonIcon","",3,"iconPositionEnd",""]],"*",[["","iconPositionEnd","",8,"material-icons"],["mat-icon","iconPositionEnd",""],["","matButtonIcon","","iconPositionEnd",""]]],WQ=[".material-icons:not([iconPositionEnd]), mat-icon:not([iconPositionEnd]), [matButtonIcon]:not([iconPositionEnd])","*",".material-icons[iconPositionEnd], mat-icon[iconPositionEnd], [matButtonIcon][iconPositionEnd]"];let jg=(()=>{class t extends e4{static \u0275fac=(()=>{let e;return function(r){return(e||(e=m(t)))(r||t)}})();static \u0275cmp=kn({type:t,selectors:[["button","mat-button",""],["button","mat-raised-button",""],["button","mat-flat-button",""],["button","mat-stroked-button",""]],hostVars:14,hostBindings:function(i,r){2&i&&(ii("disabled",r._getDisabledAttribute())("aria-disabled",r._getAriaDisabled()),Kf(r.color?"mat-"+r.color:""),Di("mat-mdc-button-disabled",r.disabled)("mat-mdc-button-disabled-interactive",r.disabledInteractive)("_mat-animation-noopable","NoopAnimations"===r._animationMode)("mat-unthemed",!r.color)("mat-mdc-button-base",!0))},exportAs:["matButton"],features:[Nn],attrs:GQ,ngContentSelectors:WQ,decls:7,vars:4,consts:[[1,"mat-mdc-button-persistent-ripple"],[1,"mdc-button__label"],[1,"mat-focus-indicator"],[1,"mat-mdc-button-touch-target"]],template:function(i,r){1&i&&(os(qQ),Wt(0,"span",0),Fi(1),ae(2,"span",1),Fi(3,1),le(),Fi(4,2),Wt(5,"span",2)(6,"span",3)),2&i&&Di("mdc-button__ripple",!r._isFab)("mdc-fab__ripple",r._isFab)},styles:['.mat-mdc-button-base{text-decoration:none}.mdc-button{-webkit-user-select:none;user-select:none;position:relative;display:inline-flex;align-items:center;justify-content:center;box-sizing:border-box;min-width:64px;border:none;outline:none;line-height:inherit;-webkit-appearance:none;overflow:visible;vertical-align:middle;background:rgba(0,0,0,0);padding:0 8px}.mdc-button::-moz-focus-inner{padding:0;border:0}.mdc-button:active{outline:none}.mdc-button:hover{cursor:pointer}.mdc-button:disabled{cursor:default;pointer-events:none}.mdc-button[hidden]{display:none}.mdc-button .mdc-button__label{position:relative}.mat-mdc-button{padding:0 var(--mat-text-button-horizontal-padding, 12px);height:var(--mdc-text-button-container-height, 40px);font-family:var(--mdc-text-button-label-text-font, var(--mat-sys-label-large-font));font-size:var(--mdc-text-button-label-text-size, var(--mat-sys-label-large-size));letter-spacing:var(--mdc-text-button-label-text-tracking, var(--mat-sys-label-large-tracking));text-transform:var(--mdc-text-button-label-text-transform);font-weight:var(--mdc-text-button-label-text-weight, var(--mat-sys-label-large-weight))}.mat-mdc-button,.mat-mdc-button .mdc-button__ripple{border-radius:var(--mdc-text-button-container-shape, var(--mat-sys-corner-full))}.mat-mdc-button:not(:disabled){color:var(--mdc-text-button-label-text-color, var(--mat-sys-primary))}.mat-mdc-button[disabled],.mat-mdc-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-text-button-disabled-label-text-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent))}.mat-mdc-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-button:has(.material-icons,mat-icon,[matButtonIcon]){padding:0 var(--mat-text-button-with-icon-horizontal-padding, 16px)}.mat-mdc-button>.mat-icon{margin-right:var(--mat-text-button-icon-spacing, 8px);margin-left:var(--mat-text-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-button>.mat-icon{margin-right:var(--mat-text-button-icon-offset, -4px);margin-left:var(--mat-text-button-icon-spacing, 8px)}.mat-mdc-button .mdc-button__label+.mat-icon{margin-right:var(--mat-text-button-icon-offset, -4px);margin-left:var(--mat-text-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-button .mdc-button__label+.mat-icon{margin-right:var(--mat-text-button-icon-spacing, 8px);margin-left:var(--mat-text-button-icon-offset, -4px)}.mat-mdc-button .mat-ripple-element{background-color:var(--mat-text-button-ripple-color, color-mix(in srgb, var(--mat-sys-primary) calc(var(--mat-sys-pressed-state-layer-opacity) * 100%), transparent))}.mat-mdc-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-text-button-state-layer-color, var(--mat-sys-primary))}.mat-mdc-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-text-button-disabled-state-layer-color, var(--mat-sys-on-surface-variant))}.mat-mdc-button:hover>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mat-mdc-button.cdk-program-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-button.cdk-keyboard-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-button.mat-mdc-button-disabled-interactive:focus>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mat-mdc-button:active>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-pressed-state-layer-opacity, var(--mat-sys-pressed-state-layer-opacity))}.mat-mdc-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-text-button-touch-target-display, block)}.mat-mdc-unelevated-button{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);height:var(--mdc-filled-button-container-height, 40px);font-family:var(--mdc-filled-button-label-text-font, var(--mat-sys-label-large-font));font-size:var(--mdc-filled-button-label-text-size, var(--mat-sys-label-large-size));letter-spacing:var(--mdc-filled-button-label-text-tracking, var(--mat-sys-label-large-tracking));text-transform:var(--mdc-filled-button-label-text-transform);font-weight:var(--mdc-filled-button-label-text-weight, var(--mat-sys-label-large-weight));padding:0 var(--mat-filled-button-horizontal-padding, 24px)}.mat-mdc-unelevated-button>.mat-icon{margin-right:var(--mat-filled-button-icon-spacing, 8px);margin-left:var(--mat-filled-button-icon-offset, -8px)}[dir=rtl] .mat-mdc-unelevated-button>.mat-icon{margin-right:var(--mat-filled-button-icon-offset, -8px);margin-left:var(--mat-filled-button-icon-spacing, 8px)}.mat-mdc-unelevated-button .mdc-button__label+.mat-icon{margin-right:var(--mat-filled-button-icon-offset, -8px);margin-left:var(--mat-filled-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-unelevated-button .mdc-button__label+.mat-icon{margin-right:var(--mat-filled-button-icon-spacing, 8px);margin-left:var(--mat-filled-button-icon-offset, -8px)}.mat-mdc-unelevated-button .mat-ripple-element{background-color:var(--mat-filled-button-ripple-color, color-mix(in srgb, var(--mat-sys-on-primary) calc(var(--mat-sys-pressed-state-layer-opacity) * 100%), transparent))}.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-filled-button-state-layer-color, var(--mat-sys-on-primary))}.mat-mdc-unelevated-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-filled-button-disabled-state-layer-color, var(--mat-sys-on-surface-variant))}.mat-mdc-unelevated-button:hover>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mat-mdc-unelevated-button.cdk-program-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button.cdk-keyboard-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button.mat-mdc-button-disabled-interactive:focus>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mat-mdc-unelevated-button:active>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-pressed-state-layer-opacity, var(--mat-sys-pressed-state-layer-opacity))}.mat-mdc-unelevated-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-filled-button-touch-target-display, block)}.mat-mdc-unelevated-button:not(:disabled){color:var(--mdc-filled-button-label-text-color, var(--mat-sys-on-primary));background-color:var(--mdc-filled-button-container-color, var(--mat-sys-primary))}.mat-mdc-unelevated-button,.mat-mdc-unelevated-button .mdc-button__ripple{border-radius:var(--mdc-filled-button-container-shape, var(--mat-sys-corner-full))}.mat-mdc-unelevated-button[disabled],.mat-mdc-unelevated-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-filled-button-disabled-label-text-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent));background-color:var(--mdc-filled-button-disabled-container-color, color-mix(in srgb, var(--mat-sys-on-surface) 12%, transparent))}.mat-mdc-unelevated-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-raised-button{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);box-shadow:var(--mdc-protected-button-container-elevation-shadow, var(--mat-sys-level1));height:var(--mdc-protected-button-container-height, 40px);font-family:var(--mdc-protected-button-label-text-font, var(--mat-sys-label-large-font));font-size:var(--mdc-protected-button-label-text-size, var(--mat-sys-label-large-size));letter-spacing:var(--mdc-protected-button-label-text-tracking, var(--mat-sys-label-large-tracking));text-transform:var(--mdc-protected-button-label-text-transform);font-weight:var(--mdc-protected-button-label-text-weight, var(--mat-sys-label-large-weight));padding:0 var(--mat-protected-button-horizontal-padding, 24px)}.mat-mdc-raised-button>.mat-icon{margin-right:var(--mat-protected-button-icon-spacing, 8px);margin-left:var(--mat-protected-button-icon-offset, -8px)}[dir=rtl] .mat-mdc-raised-button>.mat-icon{margin-right:var(--mat-protected-button-icon-offset, -8px);margin-left:var(--mat-protected-button-icon-spacing, 8px)}.mat-mdc-raised-button .mdc-button__label+.mat-icon{margin-right:var(--mat-protected-button-icon-offset, -8px);margin-left:var(--mat-protected-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-raised-button .mdc-button__label+.mat-icon{margin-right:var(--mat-protected-button-icon-spacing, 8px);margin-left:var(--mat-protected-button-icon-offset, -8px)}.mat-mdc-raised-button .mat-ripple-element{background-color:var(--mat-protected-button-ripple-color, color-mix(in srgb, var(--mat-sys-primary) calc(var(--mat-sys-pressed-state-layer-opacity) * 100%), transparent))}.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-protected-button-state-layer-color, var(--mat-sys-primary))}.mat-mdc-raised-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-protected-button-disabled-state-layer-color, var(--mat-sys-on-surface-variant))}.mat-mdc-raised-button:hover>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mat-mdc-raised-button.cdk-program-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button.cdk-keyboard-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button.mat-mdc-button-disabled-interactive:focus>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mat-mdc-raised-button:active>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-pressed-state-layer-opacity, var(--mat-sys-pressed-state-layer-opacity))}.mat-mdc-raised-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-protected-button-touch-target-display, block)}.mat-mdc-raised-button:not(:disabled){color:var(--mdc-protected-button-label-text-color, var(--mat-sys-primary));background-color:var(--mdc-protected-button-container-color, var(--mat-sys-surface))}.mat-mdc-raised-button,.mat-mdc-raised-button .mdc-button__ripple{border-radius:var(--mdc-protected-button-container-shape, var(--mat-sys-corner-full))}.mat-mdc-raised-button:hover{box-shadow:var(--mdc-protected-button-hover-container-elevation-shadow, var(--mat-sys-level2))}.mat-mdc-raised-button:focus{box-shadow:var(--mdc-protected-button-focus-container-elevation-shadow, var(--mat-sys-level1))}.mat-mdc-raised-button:active,.mat-mdc-raised-button:focus:active{box-shadow:var(--mdc-protected-button-pressed-container-elevation-shadow, var(--mat-sys-level1))}.mat-mdc-raised-button[disabled],.mat-mdc-raised-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-protected-button-disabled-label-text-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent));background-color:var(--mdc-protected-button-disabled-container-color, color-mix(in srgb, var(--mat-sys-on-surface) 12%, transparent))}.mat-mdc-raised-button[disabled].mat-mdc-button-disabled,.mat-mdc-raised-button.mat-mdc-button-disabled.mat-mdc-button-disabled{box-shadow:var(--mdc-protected-button-disabled-container-elevation-shadow, var(--mat-sys-level0))}.mat-mdc-raised-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-outlined-button{border-style:solid;transition:border 280ms cubic-bezier(0.4, 0, 0.2, 1);height:var(--mdc-outlined-button-container-height, 40px);font-family:var(--mdc-outlined-button-label-text-font, var(--mat-sys-label-large-font));font-size:var(--mdc-outlined-button-label-text-size, var(--mat-sys-label-large-size));letter-spacing:var(--mdc-outlined-button-label-text-tracking, var(--mat-sys-label-large-tracking));text-transform:var(--mdc-outlined-button-label-text-transform);font-weight:var(--mdc-outlined-button-label-text-weight, var(--mat-sys-label-large-weight));border-radius:var(--mdc-outlined-button-container-shape, var(--mat-sys-corner-full));border-width:var(--mdc-outlined-button-outline-width, 1px);padding:0 var(--mat-outlined-button-horizontal-padding, 24px)}.mat-mdc-outlined-button>.mat-icon{margin-right:var(--mat-outlined-button-icon-spacing, 8px);margin-left:var(--mat-outlined-button-icon-offset, -8px)}[dir=rtl] .mat-mdc-outlined-button>.mat-icon{margin-right:var(--mat-outlined-button-icon-offset, -8px);margin-left:var(--mat-outlined-button-icon-spacing, 8px)}.mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-right:var(--mat-outlined-button-icon-offset, -8px);margin-left:var(--mat-outlined-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-right:var(--mat-outlined-button-icon-spacing, 8px);margin-left:var(--mat-outlined-button-icon-offset, -8px)}.mat-mdc-outlined-button .mat-ripple-element{background-color:var(--mat-outlined-button-ripple-color, color-mix(in srgb, var(--mat-sys-primary) calc(var(--mat-sys-pressed-state-layer-opacity) * 100%), transparent))}.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-outlined-button-state-layer-color, var(--mat-sys-primary))}.mat-mdc-outlined-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-outlined-button-disabled-state-layer-color, var(--mat-sys-on-surface-variant))}.mat-mdc-outlined-button:hover>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mat-mdc-outlined-button.cdk-program-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button.cdk-keyboard-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button.mat-mdc-button-disabled-interactive:focus>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mat-mdc-outlined-button:active>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-pressed-state-layer-opacity, var(--mat-sys-pressed-state-layer-opacity))}.mat-mdc-outlined-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-outlined-button-touch-target-display, block)}.mat-mdc-outlined-button:not(:disabled){color:var(--mdc-outlined-button-label-text-color, var(--mat-sys-primary));border-color:var(--mdc-outlined-button-outline-color, var(--mat-sys-outline))}.mat-mdc-outlined-button[disabled],.mat-mdc-outlined-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-outlined-button-disabled-label-text-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent));border-color:var(--mdc-outlined-button-disabled-outline-color, color-mix(in srgb, var(--mat-sys-on-surface) 12%, transparent))}.mat-mdc-outlined-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-button,.mat-mdc-unelevated-button,.mat-mdc-raised-button,.mat-mdc-outlined-button{-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-ripple{overflow:hidden}.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{content:"";opacity:0}.mat-mdc-button .mdc-button__label,.mat-mdc-button .mat-icon,.mat-mdc-unelevated-button .mdc-button__label,.mat-mdc-unelevated-button .mat-icon,.mat-mdc-raised-button .mdc-button__label,.mat-mdc-raised-button .mat-icon,.mat-mdc-outlined-button .mdc-button__label,.mat-mdc-outlined-button .mat-icon{z-index:1;position:relative}.mat-mdc-button .mat-focus-indicator,.mat-mdc-unelevated-button .mat-focus-indicator,.mat-mdc-raised-button .mat-focus-indicator,.mat-mdc-outlined-button .mat-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute}.mat-mdc-button:focus>.mat-focus-indicator::before,.mat-mdc-unelevated-button:focus>.mat-focus-indicator::before,.mat-mdc-raised-button:focus>.mat-focus-indicator::before,.mat-mdc-outlined-button:focus>.mat-focus-indicator::before{content:""}.mat-mdc-button._mat-animation-noopable,.mat-mdc-unelevated-button._mat-animation-noopable,.mat-mdc-raised-button._mat-animation-noopable,.mat-mdc-outlined-button._mat-animation-noopable{transition:none !important;animation:none !important}.mat-mdc-button>.mat-icon,.mat-mdc-unelevated-button>.mat-icon,.mat-mdc-raised-button>.mat-icon,.mat-mdc-outlined-button>.mat-icon{display:inline-block;position:relative;vertical-align:top;font-size:1.125rem;height:1.125rem;width:1.125rem}.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px}.mat-mdc-unelevated-button .mat-focus-indicator::before,.mat-mdc-raised-button .mat-focus-indicator::before{margin:calc(calc(var(--mat-focus-indicator-border-width, 3px) + 2px)*-1)}.mat-mdc-outlined-button .mat-focus-indicator::before{margin:calc(calc(var(--mat-focus-indicator-border-width, 3px) + 3px)*-1)}\n',"@media(forced-colors: active){.mat-mdc-button:not(.mdc-button--outlined),.mat-mdc-unelevated-button:not(.mdc-button--outlined),.mat-mdc-raised-button:not(.mdc-button--outlined),.mat-mdc-outlined-button:not(.mdc-button--outlined),.mat-mdc-icon-button.mat-mdc-icon-button,.mat-mdc-outlined-button .mdc-button__ripple{outline:solid 1px}}\n"],encapsulation:2,changeDetection:0})}return t})(),Hg=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275mod=Er({type:t});static \u0275inj=Ai({imports:[Qr,xR,Qr]})}return t})();function t4(...t){const n=gz(t),{args:e,keys:i}=_z(t),r=new Qe(l=>{const{length:f}=e;if(!f)return void l.complete();const w=new Array(f);let M=f,P=f;for(let L=0;L<f;L++){let $=!1;Lc(e[L]).subscribe(li(l,Q=>{$||($=!0,P--),w[L]=Q},()=>M--,void 0,()=>{(!M||!$)&&(P||l.next(i?vz(i,w):w),l.complete())}))}});return n?r.pipe(yz(n)):r}let n4=(()=>{class t{_renderer;_elementRef;onChange=e=>{};onTouched=()=>{};constructor(e,i){this._renderer=e,this._elementRef=i}setProperty(e,i){this._renderer.setProperty(this._elementRef.nativeElement,e,i)}registerOnTouched(e){this.onTouched=e}registerOnChange(e){this.onChange=e}setDisabledState(e){this.setProperty("disabled",e)}static \u0275fac=function(i){return new(i||t)(ft(yt),ft(Dn))};static \u0275dir=Ht({type:t})}return t})(),Jy=(()=>{class t extends n4{static \u0275fac=(()=>{let e;return function(r){return(e||(e=m(t)))(r||t)}})();static \u0275dir=Ht({type:t,features:[Nn]})}return t})();const Id=new _t(""),XQ={provide:Id,useExisting:ur(()=>dc),multi:!0},QQ=new _t("");let dc=(()=>{class t extends n4{_compositionMode;_composing=!1;constructor(e,i,r){super(e,i),this._compositionMode=r,null==this._compositionMode&&(this._compositionMode=!function KQ(){const t=Ag()?Ag().getUserAgent():"";return/android (\d+)/.test(t.toLowerCase())}())}writeValue(e){this.setProperty("value",e??"")}_handleInput(e){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(e)}_compositionStart(){this._composing=!0}_compositionEnd(e){this._composing=!1,this._compositionMode&&this.onChange(e)}static \u0275fac=function(i){return new(i||t)(ft(yt),ft(Dn),ft(QQ,8))};static \u0275dir=Ht({type:t,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(i,r){1&i&&Tt("input",function(f){return r._handleInput(f.target.value)})("blur",function(){return r.onTouched()})("compositionstart",function(){return r._compositionStart()})("compositionend",function(f){return r._compositionEnd(f.target.value)})},standalone:!1,features:[pi([XQ]),Nn]})}return t})();function wR(t){return null==t||0===CR(t)}function CR(t){return null==t?null:Array.isArray(t)||"string"==typeof t?t.length:t instanceof Set?t.size:null}const sa=new _t(""),$g=new _t(""),JQ=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class bn{static min(n){return r4(n)}static max(n){return function o4(t){return n=>{if(null==n.value||null==t)return null;const e=parseFloat(n.value);return!isNaN(e)&&e>t?{max:{max:t,actual:n.value}}:null}}(n)}static required(n){return s4(n)}static requiredTrue(n){return function a4(t){return!0===t.value?null:{required:!0}}(n)}static email(n){return function l4(t){return wR(t.value)||JQ.test(t.value)?null:{email:!0}}(n)}static minLength(n){return function c4(t){return n=>{const e=n.value?.length??CR(n.value);return null===e||0===e?null:e<t?{minlength:{requiredLength:t,actualLength:e}}:null}}(n)}static maxLength(n){return d4(n)}static pattern(n){return function u4(t){if(!t)return dT;let n,e;return"string"==typeof t?(e="","^"!==t.charAt(0)&&(e+="^"),e+=t,"$"!==t.charAt(t.length-1)&&(e+="$"),n=new RegExp(e)):(e=t.toString(),n=t),i=>{if(wR(i.value))return null;const r=i.value;return n.test(r)?null:{pattern:{requiredPattern:e,actualValue:r}}}}(n)}static nullValidator(n){return null}static compose(n){return _4(n)}static composeAsync(n){return y4(n)}}function r4(t){return n=>{if(null==n.value||null==t)return null;const e=parseFloat(n.value);return!isNaN(e)&&e<t?{min:{min:t,actual:n.value}}:null}}function s4(t){return wR(t.value)?{required:!0}:null}function d4(t){return n=>{const e=n.value?.length??CR(n.value);return null!==e&&e>t?{maxlength:{requiredLength:t,actualLength:e}}:null}}function dT(t){return null}function h4(t){return null!=t}function p4(t){return O1(t)?qs(t):t}function f4(t){let n={};return t.forEach(e=>{n=null!=e?{...n,...e}:n}),0===Object.keys(n).length?null:n}function m4(t,n){return n.map(e=>e(t))}function g4(t){return t.map(n=>function eJ(t){return!t.validate}(n)?n:e=>n.validate(e))}function _4(t){if(!t)return null;const n=t.filter(h4);return 0==n.length?null:function(e){return f4(m4(e,n))}}function ER(t){return null!=t?_4(g4(t)):null}function y4(t){if(!t)return null;const n=t.filter(h4);return 0==n.length?null:function(e){return t4(m4(e,n).map(p4)).pipe(an(f4))}}function SR(t){return null!=t?y4(g4(t)):null}function v4(t,n){return null===t?[n]:Array.isArray(t)?[...t,n]:[t,n]}function b4(t){return t._rawValidators}function x4(t){return t._rawAsyncValidators}function DR(t){return t?Array.isArray(t)?t:[t]:[]}function uT(t,n){return Array.isArray(t)?t.includes(n):t===n}function w4(t,n){const e=DR(n);return DR(t).forEach(r=>{uT(e,r)||e.push(r)}),e}function C4(t,n){return DR(n).filter(e=>!uT(t,e))}class E4{get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators=[];_rawAsyncValidators=[];_setValidators(n){this._rawValidators=n||[],this._composedValidatorFn=ER(this._rawValidators)}_setAsyncValidators(n){this._rawAsyncValidators=n||[],this._composedAsyncValidatorFn=SR(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_onDestroyCallbacks=[];_registerOnDestroy(n){this._onDestroyCallbacks.push(n)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(n=>n()),this._onDestroyCallbacks=[]}reset(n=void 0){this.control&&this.control.reset(n)}hasError(n,e){return!!this.control&&this.control.hasError(n,e)}getError(n,e){return this.control?this.control.getError(n,e):null}}class uc extends E4{name;get formDirective(){return null}get path(){return null}}class Ih extends E4{_parent=null;name=null;valueAccessor=null}class S4{_cd;constructor(n){this._cd=n}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}}let Ad=(()=>{class t extends S4{constructor(e){super(e)}static \u0275fac=function(i){return new(i||t)(ft(Ih,2))};static \u0275dir=Ht({type:t,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(i,r){2&i&&Di("ng-untouched",r.isUntouched)("ng-touched",r.isTouched)("ng-pristine",r.isPristine)("ng-dirty",r.isDirty)("ng-valid",r.isValid)("ng-invalid",r.isInvalid)("ng-pending",r.isPending)},standalone:!1,features:[Nn]})}return t})(),Ah=(()=>{class t extends S4{constructor(e){super(e)}static \u0275fac=function(i){return new(i||t)(ft(uc,10))};static \u0275dir=Ht({type:t,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(i,r){2&i&&Di("ng-untouched",r.isUntouched)("ng-touched",r.isTouched)("ng-pristine",r.isPristine)("ng-dirty",r.isDirty)("ng-valid",r.isValid)("ng-invalid",r.isInvalid)("ng-pending",r.isPending)("ng-submitted",r.isSubmitted)},standalone:!1,features:[Nn]})}return t})();const VC="VALID",pT="INVALID",$0="PENDING",UC="DISABLED";class G0{}class M4 extends G0{value;source;constructor(n,e){super(),this.value=n,this.source=e}}class IR extends G0{pristine;source;constructor(n,e){super(),this.pristine=n,this.source=e}}class AR extends G0{touched;source;constructor(n,e){super(),this.touched=n,this.source=e}}class fT extends G0{status;source;constructor(n,e){super(),this.status=n,this.source=e}}class T4 extends G0{source;constructor(n){super(),this.source=n}}class I4 extends G0{source;constructor(n){super(),this.source=n}}function kR(t){return(mT(t)?t.validators:t)||null}function RR(t,n){return(mT(n)?n.asyncValidators:t)||null}function mT(t){return null!=t&&!Array.isArray(t)&&"object"==typeof t}function A4(t,n,e){const i=t.controls;if(!(n?Object.keys(i):i).length)throw new bt(1e3,"");if(!i[e])throw new bt(1001,"")}function k4(t,n,e){t._forEachChild((i,r)=>{if(void 0===e[r])throw new bt(1002,"")})}class gT{_pendingDirty=!1;_hasOwnPendingAsyncValidator=null;_pendingTouched=!1;_onCollectionChange=()=>{};_updateOn;_parent=null;_asyncValidationSubscription;_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators;_rawAsyncValidators;value;constructor(n,e){this._assignValidators(n),this._assignAsyncValidators(e)}get validator(){return this._composedValidatorFn}set validator(n){this._rawValidators=this._composedValidatorFn=n}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(n){this._rawAsyncValidators=this._composedAsyncValidatorFn=n}get parent(){return this._parent}get status(){return Ps(this.statusReactive)}set status(n){Ps(()=>this.statusReactive.set(n))}_status=Sd(()=>this.statusReactive());statusReactive=wr(void 0);get valid(){return this.status===VC}get invalid(){return this.status===pT}get pending(){return this.status==$0}get disabled(){return this.status===UC}get enabled(){return this.status!==UC}errors;get pristine(){return Ps(this.pristineReactive)}set pristine(n){Ps(()=>this.pristineReactive.set(n))}_pristine=Sd(()=>this.pristineReactive());pristineReactive=wr(!0);get dirty(){return!this.pristine}get touched(){return Ps(this.touchedReactive)}set touched(n){Ps(()=>this.touchedReactive.set(n))}_touched=Sd(()=>this.touchedReactive());touchedReactive=wr(!1);get untouched(){return!this.touched}_events=new Et;events=this._events.asObservable();valueChanges;statusChanges;get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(n){this._assignValidators(n)}setAsyncValidators(n){this._assignAsyncValidators(n)}addValidators(n){this.setValidators(w4(n,this._rawValidators))}addAsyncValidators(n){this.setAsyncValidators(w4(n,this._rawAsyncValidators))}removeValidators(n){this.setValidators(C4(n,this._rawValidators))}removeAsyncValidators(n){this.setAsyncValidators(C4(n,this._rawAsyncValidators))}hasValidator(n){return uT(this._rawValidators,n)}hasAsyncValidator(n){return uT(this._rawAsyncValidators,n)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(n={}){const e=!1===this.touched;this.touched=!0;const i=n.sourceControl??this;this._parent&&!n.onlySelf&&this._parent.markAsTouched({...n,sourceControl:i}),e&&!1!==n.emitEvent&&this._events.next(new AR(!0,i))}markAllAsTouched(n={}){this.markAsTouched({onlySelf:!0,emitEvent:n.emitEvent,sourceControl:this}),this._forEachChild(e=>e.markAllAsTouched(n))}markAsUntouched(n={}){const e=!0===this.touched;this.touched=!1,this._pendingTouched=!1;const i=n.sourceControl??this;this._forEachChild(r=>{r.markAsUntouched({onlySelf:!0,emitEvent:n.emitEvent,sourceControl:i})}),this._parent&&!n.onlySelf&&this._parent._updateTouched(n,i),e&&!1!==n.emitEvent&&this._events.next(new AR(!1,i))}markAsDirty(n={}){const e=!0===this.pristine;this.pristine=!1;const i=n.sourceControl??this;this._parent&&!n.onlySelf&&this._parent.markAsDirty({...n,sourceControl:i}),e&&!1!==n.emitEvent&&this._events.next(new IR(!1,i))}markAsPristine(n={}){const e=!1===this.pristine;this.pristine=!0,this._pendingDirty=!1;const i=n.sourceControl??this;this._forEachChild(r=>{r.markAsPristine({onlySelf:!0,emitEvent:n.emitEvent})}),this._parent&&!n.onlySelf&&this._parent._updatePristine(n,i),e&&!1!==n.emitEvent&&this._events.next(new IR(!0,i))}markAsPending(n={}){this.status=$0;const e=n.sourceControl??this;!1!==n.emitEvent&&(this._events.next(new fT(this.status,e)),this.statusChanges.emit(this.status)),this._parent&&!n.onlySelf&&this._parent.markAsPending({...n,sourceControl:e})}disable(n={}){const e=this._parentMarkedDirty(n.onlySelf);this.status=UC,this.errors=null,this._forEachChild(r=>{r.disable({...n,onlySelf:!0})}),this._updateValue();const i=n.sourceControl??this;!1!==n.emitEvent&&(this._events.next(new M4(this.value,i)),this._events.next(new fT(this.status,i)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...n,skipPristineCheck:e},this),this._onDisabledChange.forEach(r=>r(!0))}enable(n={}){const e=this._parentMarkedDirty(n.onlySelf);this.status=VC,this._forEachChild(i=>{i.enable({...n,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent}),this._updateAncestors({...n,skipPristineCheck:e},this),this._onDisabledChange.forEach(i=>i(!1))}_updateAncestors(n,e){this._parent&&!n.onlySelf&&(this._parent.updateValueAndValidity(n),n.skipPristineCheck||this._parent._updatePristine({},e),this._parent._updateTouched({},e))}setParent(n){this._parent=n}getRawValue(){return this.value}updateValueAndValidity(n={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){const i=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===VC||this.status===$0)&&this._runAsyncValidator(i,n.emitEvent)}const e=n.sourceControl??this;!1!==n.emitEvent&&(this._events.next(new M4(this.value,e)),this._events.next(new fT(this.status,e)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!n.onlySelf&&this._parent.updateValueAndValidity({...n,sourceControl:e})}_updateTreeValidity(n={emitEvent:!0}){this._forEachChild(e=>e._updateTreeValidity(n)),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?UC:VC}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(n,e){if(this.asyncValidator){this.status=$0,this._hasOwnPendingAsyncValidator={emitEvent:!1!==e};const i=p4(this.asyncValidator(this));this._asyncValidationSubscription=i.subscribe(r=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(r,{emitEvent:e,shouldHaveEmitted:n})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();const n=this._hasOwnPendingAsyncValidator?.emitEvent??!1;return this._hasOwnPendingAsyncValidator=null,n}return!1}setErrors(n,e={}){this.errors=n,this._updateControlsErrors(!1!==e.emitEvent,this,e.shouldHaveEmitted)}get(n){let e=n;return null==e||(Array.isArray(e)||(e=e.split(".")),0===e.length)?null:e.reduce((i,r)=>i&&i._find(r),this)}getError(n,e){const i=e?this.get(e):this;return i&&i.errors?i.errors[n]:null}hasError(n,e){return!!this.getError(n,e)}get root(){let n=this;for(;n._parent;)n=n._parent;return n}_updateControlsErrors(n,e,i){this.status=this._calculateStatus(),n&&this.statusChanges.emit(this.status),(n||i)&&this._events.next(new fT(this.status,e)),this._parent&&this._parent._updateControlsErrors(n,e,i)}_initObservables(){this.valueChanges=new $e,this.statusChanges=new $e}_calculateStatus(){return this._allControlsDisabled()?UC:this.errors?pT:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus($0)?$0:this._anyControlsHaveStatus(pT)?pT:VC}_anyControlsHaveStatus(n){return this._anyControls(e=>e.status===n)}_anyControlsDirty(){return this._anyControls(n=>n.dirty)}_anyControlsTouched(){return this._anyControls(n=>n.touched)}_updatePristine(n,e){const i=!this._anyControlsDirty(),r=this.pristine!==i;this.pristine=i,this._parent&&!n.onlySelf&&this._parent._updatePristine(n,e),r&&this._events.next(new IR(this.pristine,e))}_updateTouched(n={},e){this.touched=this._anyControlsTouched(),this._events.next(new AR(this.touched,e)),this._parent&&!n.onlySelf&&this._parent._updateTouched(n,e)}_onDisabledChange=[];_registerOnCollectionChange(n){this._onCollectionChange=n}_setUpdateStrategy(n){mT(n)&&null!=n.updateOn&&(this._updateOn=n.updateOn)}_parentMarkedDirty(n){return!n&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(n){return null}_assignValidators(n){this._rawValidators=Array.isArray(n)?n.slice():n,this._composedValidatorFn=function aJ(t){return Array.isArray(t)?ER(t):t||null}(this._rawValidators)}_assignAsyncValidators(n){this._rawAsyncValidators=Array.isArray(n)?n.slice():n,this._composedAsyncValidatorFn=function lJ(t){return Array.isArray(t)?SR(t):t||null}(this._rawAsyncValidators)}}class jC extends gT{constructor(n,e,i){super(kR(e),RR(i,e)),this.controls=n,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}controls;registerControl(n,e){return this.controls[n]?this.controls[n]:(this.controls[n]=e,e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange),e)}addControl(n,e,i={}){this.registerControl(n,e),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}removeControl(n,e={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}setControl(n,e,i={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],e&&this.registerControl(n,e),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}contains(n){return this.controls.hasOwnProperty(n)&&this.controls[n].enabled}setValue(n,e={}){k4(this,0,n),Object.keys(n).forEach(i=>{A4(this,!0,i),this.controls[i].setValue(n[i],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(n,e={}){null!=n&&(Object.keys(n).forEach(i=>{const r=this.controls[i];r&&r.patchValue(n[i],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(n={},e={}){this._forEachChild((i,r)=>{i.reset(n?n[r]:null,{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e,this),this._updateTouched(e,this),this.updateValueAndValidity(e)}getRawValue(){return this._reduceChildren({},(n,e,i)=>(n[i]=e.getRawValue(),n))}_syncPendingControls(){let n=this._reduceChildren(!1,(e,i)=>!!i._syncPendingControls()||e);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){Object.keys(this.controls).forEach(e=>{const i=this.controls[e];i&&n(i,e)})}_setUpControls(){this._forEachChild(n=>{n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(n){for(const[e,i]of Object.entries(this.controls))if(this.contains(e)&&n(i))return!0;return!1}_reduceValue(){return this._reduceChildren({},(e,i,r)=>((i.enabled||this.disabled)&&(e[r]=i.value),e))}_reduceChildren(n,e){let i=n;return this._forEachChild((r,l)=>{i=e(i,r,l)}),i}_allControlsDisabled(){for(const n of Object.keys(this.controls))if(this.controls[n].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(n){return this.controls.hasOwnProperty(n)?this.controls[n]:null}}class R4 extends jC{}const ev=new _t("",{providedIn:"root",factory:()=>HC}),HC="always";function _T(t,n){return[...n.path,t]}function $C(t,n,e=HC){PR(t,n),n.valueAccessor.writeValue(t.value),(t.disabled||"always"===e)&&n.valueAccessor.setDisabledState?.(t.disabled),function dJ(t,n){n.valueAccessor.registerOnChange(e=>{t._pendingValue=e,t._pendingChange=!0,t._pendingDirty=!0,"change"===t.updateOn&&P4(t,n)})}(t,n),function hJ(t,n){const e=(i,r)=>{n.valueAccessor.writeValue(i),r&&n.viewToModelUpdate(i)};t.registerOnChange(e),n._registerOnDestroy(()=>{t._unregisterOnChange(e)})}(t,n),function uJ(t,n){n.valueAccessor.registerOnTouched(()=>{t._pendingTouched=!0,"blur"===t.updateOn&&t._pendingChange&&P4(t,n),"submit"!==t.updateOn&&t.markAsTouched()})}(t,n),function cJ(t,n){if(n.valueAccessor.setDisabledState){const e=i=>{n.valueAccessor.setDisabledState(i)};t.registerOnDisabledChange(e),n._registerOnDestroy(()=>{t._unregisterOnDisabledChange(e)})}}(t,n)}function yT(t,n,e=!0){const i=()=>{};n.valueAccessor&&(n.valueAccessor.registerOnChange(i),n.valueAccessor.registerOnTouched(i)),bT(t,n),t&&(n._invokeOnDestroyCallbacks(),t._registerOnCollectionChange(()=>{}))}function vT(t,n){t.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(n)})}function PR(t,n){const e=b4(t);null!==n.validator?t.setValidators(v4(e,n.validator)):"function"==typeof e&&t.setValidators([e]);const i=x4(t);null!==n.asyncValidator?t.setAsyncValidators(v4(i,n.asyncValidator)):"function"==typeof i&&t.setAsyncValidators([i]);const r=()=>t.updateValueAndValidity();vT(n._rawValidators,r),vT(n._rawAsyncValidators,r)}function bT(t,n){let e=!1;if(null!==t){if(null!==n.validator){const r=b4(t);if(Array.isArray(r)&&r.length>0){const l=r.filter(f=>f!==n.validator);l.length!==r.length&&(e=!0,t.setValidators(l))}}if(null!==n.asyncValidator){const r=x4(t);if(Array.isArray(r)&&r.length>0){const l=r.filter(f=>f!==n.asyncValidator);l.length!==r.length&&(e=!0,t.setAsyncValidators(l))}}}const i=()=>{};return vT(n._rawValidators,i),vT(n._rawAsyncValidators,i),e}function P4(t,n){t._pendingDirty&&t.markAsDirty(),t.setValue(t._pendingValue,{emitModelToViewChange:!1}),n.viewToModelUpdate(t._pendingValue),t._pendingChange=!1}function O4(t,n){PR(t,n)}function FR(t,n){if(!t.hasOwnProperty("model"))return!1;const e=t.model;return!!e.isFirstChange()||!Object.is(n,e.currentValue)}function F4(t,n){t._syncPendingControls(),n.forEach(e=>{const i=e.control;"submit"===i.updateOn&&i._pendingChange&&(e.viewToModelUpdate(i._pendingValue),i._pendingChange=!1)})}function LR(t,n){if(!n)return null;let e,i,r;return Array.isArray(n),n.forEach(l=>{l.constructor===dc?e=l:function mJ(t){return Object.getPrototypeOf(t.constructor)===Jy}(l)?i=l:r=l}),r||i||e||null}const _J={provide:uc,useExisting:ur(()=>tv)},GC=Promise.resolve();let tv=(()=>{class t extends uc{callSetDisabledState;get submitted(){return Ps(this.submittedReactive)}_submitted=Sd(()=>this.submittedReactive());submittedReactive=wr(!1);_directives=new Set;form;ngSubmit=new $e;options;constructor(e,i,r){super(),this.callSetDisabledState=r,this.form=new jC({},ER(e),SR(i))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(e){GC.then(()=>{const i=this._findContainer(e.path);e.control=i.registerControl(e.name,e.control),$C(e.control,e,this.callSetDisabledState),e.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(e)})}getControl(e){return this.form.get(e.path)}removeControl(e){GC.then(()=>{const i=this._findContainer(e.path);i&&i.removeControl(e.name),this._directives.delete(e)})}addFormGroup(e){GC.then(()=>{const i=this._findContainer(e.path),r=new jC({});O4(r,e),i.registerControl(e.name,r),r.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(e){GC.then(()=>{const i=this._findContainer(e.path);i&&i.removeControl(e.name)})}getFormGroup(e){return this.form.get(e.path)}updateModel(e,i){GC.then(()=>{this.form.get(e.path).setValue(i)})}setValue(e){this.control.setValue(e)}onSubmit(e){return this.submittedReactive.set(!0),F4(this.form,this._directives),this.ngSubmit.emit(e),this.form._events.next(new T4(this.control)),"dialog"===e?.target?.method}onReset(){this.resetForm()}resetForm(e=void 0){this.form.reset(e),this.submittedReactive.set(!1),this.form._events.next(new I4(this.form))}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(e){return e.pop(),e.length?this.form.get(e):this.form}static \u0275fac=function(i){return new(i||t)(ft(sa,10),ft($g,10),ft(ev,8))};static \u0275dir=Ht({type:t,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(i,r){1&i&&Tt("submit",function(f){return r.onSubmit(f)})("reset",function(){return r.onReset()})},inputs:{options:[0,"ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],standalone:!1,features:[pi([_J]),Nn]})}return t})();function L4(t,n){const e=t.indexOf(n);e>-1&&t.splice(e,1)}function N4(t){return"object"==typeof t&&null!==t&&2===Object.keys(t).length&&"value"in t&&"disabled"in t}const qo=class extends gT{defaultValue=null;_onChange=[];_pendingValue;_pendingChange=!1;constructor(n=null,e,i){super(kR(e),RR(i,e)),this._applyFormState(n),this._setUpdateStrategy(e),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),mT(e)&&(e.nonNullable||e.initialValueIsDefault)&&(this.defaultValue=N4(n)?n.value:n)}setValue(n,e={}){this.value=this._pendingValue=n,this._onChange.length&&!1!==e.emitModelToViewChange&&this._onChange.forEach(i=>i(this.value,!1!==e.emitViewToModelChange)),this.updateValueAndValidity(e)}patchValue(n,e={}){this.setValue(n,e)}reset(n=this.defaultValue,e={}){this._applyFormState(n),this.markAsPristine(e),this.markAsUntouched(e),this.setValue(this.value,e),this._pendingChange=!1}_updateValue(){}_anyControls(n){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(n){this._onChange.push(n)}_unregisterOnChange(n){L4(this._onChange,n)}registerOnDisabledChange(n){this._onDisabledChange.push(n)}_unregisterOnDisabledChange(n){L4(this._onDisabledChange,n)}_forEachChild(n){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(n){N4(n)?(this.value=this._pendingValue=n.value,n.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=n}},wJ={provide:Ih,useExisting:ur(()=>CT)},z4=Promise.resolve();let CT=(()=>{class t extends Ih{_changeDetectorRef;callSetDisabledState;control=new qo;static ngAcceptInputType_isDisabled;_registered=!1;viewModel;name="";isDisabled;model;options;update=new $e;constructor(e,i,r,l,f,w){super(),this._changeDetectorRef=f,this.callSetDisabledState=w,this._parent=e,this._setValidators(i),this._setAsyncValidators(r),this.valueAccessor=LR(0,l)}ngOnChanges(e){if(this._checkForErrors(),!this._registered||"name"in e){if(this._registered&&(this._checkName(),this.formDirective)){const i=e.name.previousValue;this.formDirective.removeControl({name:i,path:this._getPath(i)})}this._setUpControl()}"isDisabled"in e&&this._updateDisabled(e),FR(e,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){$C(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._checkName()}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(e){z4.then(()=>{this.control.setValue(e,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(e){const i=e.isDisabled.currentValue,r=0!==i&&Un(i);z4.then(()=>{r&&!this.control.disabled?this.control.disable():!r&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(e){return this._parent?_T(e,this._parent):[e]}static \u0275fac=function(i){return new(i||t)(ft(uc,9),ft(sa,10),ft($g,10),ft(Id,10),ft(Do,8),ft(ev,8))};static \u0275dir=Ht({type:t,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],standalone:!1,features:[pi([wJ]),Nn,Mr]})}return t})(),kh=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275dir=Ht({type:t,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""],standalone:!1})}return t})();const CJ={provide:Id,useExisting:ur(()=>qC),multi:!0};let qC=(()=>{class t extends Jy{writeValue(e){this.setProperty("value",e??"")}registerOnChange(e){this.onChange=i=>{e(""==i?null:parseFloat(i))}}static \u0275fac=(()=>{let e;return function(r){return(e||(e=m(t)))(r||t)}})();static \u0275dir=Ht({type:t,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(i,r){1&i&&Tt("input",function(f){return r.onChange(f.target.value)})("blur",function(){return r.onTouched()})},standalone:!1,features:[pi([CJ]),Nn]})}return t})();const NR=new _t(""),TJ={provide:uc,useExisting:ur(()=>el)};let el=(()=>{class t extends uc{callSetDisabledState;get submitted(){return Ps(this._submittedReactive)}set submitted(e){this._submittedReactive.set(e)}_submitted=Sd(()=>this._submittedReactive());_submittedReactive=wr(!1);_oldForm;_onCollectionChange=()=>this._updateDomValue();directives=[];form=null;ngSubmit=new $e;constructor(e,i,r){super(),this.callSetDisabledState=r,this._setValidators(e),this._setAsyncValidators(i)}ngOnChanges(e){e.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(bT(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(e){const i=this.form.get(e.path);return $C(i,e,this.callSetDisabledState),i.updateValueAndValidity({emitEvent:!1}),this.directives.push(e),i}getControl(e){return this.form.get(e.path)}removeControl(e){yT(e.control||null,e,!1),function gJ(t,n){const e=t.indexOf(n);e>-1&&t.splice(e,1)}(this.directives,e)}addFormGroup(e){this._setUpFormContainer(e)}removeFormGroup(e){this._cleanUpFormContainer(e)}getFormGroup(e){return this.form.get(e.path)}addFormArray(e){this._setUpFormContainer(e)}removeFormArray(e){this._cleanUpFormContainer(e)}getFormArray(e){return this.form.get(e.path)}updateModel(e,i){this.form.get(e.path).setValue(i)}onSubmit(e){return this._submittedReactive.set(!0),F4(this.form,this.directives),this.ngSubmit.emit(e),this.form._events.next(new T4(this.control)),"dialog"===e?.target?.method}onReset(){this.resetForm()}resetForm(e=void 0){this.form.reset(e),this._submittedReactive.set(!1),this.form._events.next(new I4(this.form))}_updateDomValue(){this.directives.forEach(e=>{const i=e.control,r=this.form.get(e.path);i!==r&&(yT(i||null,e),(t=>t instanceof qo)(r)&&($C(r,e,this.callSetDisabledState),e.control=r))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(e){const i=this.form.get(e.path);O4(i,e),i.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(e){if(this.form){const i=this.form.get(e.path);i&&function pJ(t,n){return bT(t,n)}(i,e)&&i.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){PR(this.form,this),this._oldForm&&bT(this._oldForm,this)}static \u0275fac=function(i){return new(i||t)(ft(sa,10),ft($g,10),ft(ev,8))};static \u0275dir=Ht({type:t,selectors:[["","formGroup",""]],hostBindings:function(i,r){1&i&&Tt("submit",function(f){return r.onSubmit(f)})("reset",function(){return r.onReset()})},inputs:{form:[0,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],standalone:!1,features:[pi([TJ]),Nn,Mr]})}return t})();const kJ={provide:Ih,useExisting:ur(()=>Mu)};let Mu=(()=>{class t extends Ih{_ngModelWarningConfig;_added=!1;viewModel;control;name=null;set isDisabled(e){}model;update=new $e;static _ngModelWarningSentOnce=!1;_ngModelWarningSent=!1;constructor(e,i,r,l,f){super(),this._ngModelWarningConfig=f,this._parent=e,this._setValidators(i),this._setAsyncValidators(r),this.valueAccessor=LR(0,l)}ngOnChanges(e){this._added||this._setUpControl(),FR(e,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}get path(){return _T(null==this.name?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_setUpControl(){this.control=this.formDirective.addControl(this),this._added=!0}static \u0275fac=function(i){return new(i||t)(ft(uc,13),ft(sa,10),ft($g,10),ft(Id,10),ft(NR,8))};static \u0275dir=Ht({type:t,selectors:[["","formControlName",""]],inputs:{name:[0,"formControlName","name"],isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"]},outputs:{update:"ngModelChange"},standalone:!1,features:[pi([kJ]),Nn,Mr]})}return t})();let nv=(()=>{class t{_validator=dT;_onChange;_enabled;ngOnChanges(e){if(this.inputName in e){const i=this.normalizeInput(e[this.inputName].currentValue);this._enabled=this.enabled(i),this._validator=this._enabled?this.createValidator(i):dT,this._onChange&&this._onChange()}}validate(e){return this._validator(e)}registerOnValidatorChange(e){this._onChange=e}enabled(e){return null!=e}static \u0275fac=function(i){return new(i||t)};static \u0275dir=Ht({type:t,features:[Mr]})}return t})();const BJ={provide:sa,useExisting:ur(()=>VR),multi:!0};let VR=(()=>{class t extends nv{min;inputName="min";normalizeInput=e=>function q4(t){return"number"==typeof t?t:parseFloat(t)}(e);createValidator=e=>r4(e);static \u0275fac=(()=>{let e;return function(r){return(e||(e=m(t)))(r||t)}})();static \u0275dir=Ht({type:t,selectors:[["input","type","number","min","","formControlName",""],["input","type","number","min","","formControl",""],["input","type","number","min","","ngModel",""]],hostVars:1,hostBindings:function(i,r){2&i&&ii("min",r._enabled?r.min:null)},inputs:{min:"min"},standalone:!1,features:[pi([BJ]),Nn]})}return t})();const VJ={provide:sa,useExisting:ur(()=>ST),multi:!0};let ST=(()=>{class t extends nv{required;inputName="required";normalizeInput=Un;createValidator=e=>s4;enabled(e){return e}static \u0275fac=(()=>{let e;return function(r){return(e||(e=m(t)))(r||t)}})();static \u0275dir=Ht({type:t,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(i,r){2&i&&ii("required",r._enabled?"":null)},inputs:{required:"required"},standalone:!1,features:[pi([VJ]),Nn]})}return t})();const $J={provide:sa,useExisting:ur(()=>DT),multi:!0};let DT=(()=>{class t extends nv{maxlength;inputName="maxlength";normalizeInput=e=>function G4(t){return"number"==typeof t?t:parseInt(t,10)}(e);createValidator=e=>d4(e);static \u0275fac=(()=>{let e;return function(r){return(e||(e=m(t)))(r||t)}})();static \u0275dir=Ht({type:t,selectors:[["","maxlength","","formControlName",""],["","maxlength","","formControl",""],["","maxlength","","ngModel",""]],hostVars:1,hostBindings:function(i,r){2&i&&ii("maxlength",r._enabled?r.maxlength:null)},inputs:{maxlength:"maxlength"},standalone:!1,features:[pi([$J]),Nn]})}return t})(),K4=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275mod=Er({type:t});static \u0275inj=Ai({})}return t})();class Q4 extends gT{constructor(n,e,i){super(kR(e),RR(i,e)),this.controls=n,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}controls;at(n){return this.controls[this._adjustIndex(n)]}push(n,e={}){this.controls.push(n),this._registerControl(n),this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}insert(n,e,i={}){this.controls.splice(n,0,e),this._registerControl(e),this.updateValueAndValidity({emitEvent:i.emitEvent})}removeAt(n,e={}){let i=this._adjustIndex(n);i<0&&(i=0),this.controls[i]&&this.controls[i]._registerOnCollectionChange(()=>{}),this.controls.splice(i,1),this.updateValueAndValidity({emitEvent:e.emitEvent})}setControl(n,e,i={}){let r=this._adjustIndex(n);r<0&&(r=0),this.controls[r]&&this.controls[r]._registerOnCollectionChange(()=>{}),this.controls.splice(r,1),e&&(this.controls.splice(r,0,e),this._registerControl(e)),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(n,e={}){k4(this,0,n),n.forEach((i,r)=>{A4(this,!1,r),this.at(r).setValue(i,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(n,e={}){null!=n&&(n.forEach((i,r)=>{this.at(r)&&this.at(r).patchValue(i,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(n=[],e={}){this._forEachChild((i,r)=>{i.reset(n[r],{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e,this),this._updateTouched(e,this),this.updateValueAndValidity(e)}getRawValue(){return this.controls.map(n=>n.getRawValue())}clear(n={}){this.controls.length<1||(this._forEachChild(e=>e._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:n.emitEvent}))}_adjustIndex(n){return n<0?n+this.length:n}_syncPendingControls(){let n=this.controls.reduce((e,i)=>!!i._syncPendingControls()||e,!1);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){this.controls.forEach((e,i)=>{n(e,i)})}_updateValue(){this.value=this.controls.filter(n=>n.enabled||this.disabled).map(n=>n.value)}_anyControls(n){return this.controls.some(e=>e.enabled&&n(e))}_setUpControls(){this._forEachChild(n=>this._registerControl(n))}_allControlsDisabled(){for(const n of this.controls)if(n.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(n){n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)}_find(n){return this.at(n)??null}}function J4(t){return!!t&&(void 0!==t.asyncValidators||void 0!==t.validators||void 0!==t.updateOn)}let Bp=(()=>{class t{useNonNullable=!1;get nonNullable(){const e=new t;return e.useNonNullable=!0,e}group(e,i=null){const r=this._reduceControls(e);let l={};return J4(i)?l=i:null!==i&&(l.validators=i.validator,l.asyncValidators=i.asyncValidator),new jC(r,l)}record(e,i=null){const r=this._reduceControls(e);return new R4(r,i)}control(e,i,r){let l={};return this.useNonNullable?(J4(i)?l=i:(l.validators=i,l.asyncValidators=r),new qo(e,{...l,nonNullable:!0})):new qo(e,i,r)}array(e,i,r){const l=e.map(f=>this._createControl(f));return new Q4(l,i,r)}_reduceControls(e){const i={};return Object.keys(e).forEach(r=>{i[r]=this._createControl(e[r])}),i}_createControl(e){return e instanceof qo||e instanceof gT?e:Array.isArray(e)?this.control(e[0],e.length>1?e[1]:null,e.length>2?e[2]:null):this.control(e)}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),MT=(()=>{class t{static withConfig(e){return{ngModule:t,providers:[{provide:ev,useValue:e.callSetDisabledState??HC}]}}static \u0275fac=function(i){return new(i||t)};static \u0275mod=Er({type:t});static \u0275inj=Ai({imports:[K4]})}return t})(),Vp=(()=>{class t{static withConfig(e){return{ngModule:t,providers:[{provide:NR,useValue:e.warnOnNgModelWithFormControl??"always"},{provide:ev,useValue:e.callSetDisabledState??HC}]}}static \u0275fac=function(i){return new(i||t)};static \u0275mod=Er({type:t});static \u0275inj=Ai({imports:[K4]})}return t})();function qJ(t,n){if(1&t){const e=_i();Qi(0),ae(1,"textarea",6),Fy("ngModelChange",function(r){on(e);const l=Lt();return E0(l.inputValue,r)||(l.inputValue=r),ln(r)}),le(),Ji()}if(2&t){const e=Lt();xe(),uk("placeholder",e.data.inputPlaceholder||""),Oy("ngModel",e.inputValue)}}let Gg=(()=>{class t{dialogRef;data;inputValue="";constructor(e,i){this.dialogRef=e,this.data=i,i.input&&i.inputPlaceholder&&(this.inputValue="")}onConfirm(){this.dialogRef.close(!this.data.input||this.inputValue.trim())}onCancel(){this.dialogRef.close(!1)}static \u0275fac=function(i){return new(i||t)(ft(aT),ft(VV))};static \u0275cmp=kn({type:t,selectors:[["app-confirm-dialog"]],decls:11,vars:7,consts:[["mat-dialog-title",""],[1,"dialog-content"],[4,"ngIf"],["align","end"],["mat-button","",3,"click"],["mat-flat-button","",3,"click","color","disabled"],["rows","4",1,"full-width","textarea",3,"ngModelChange","ngModel","placeholder"]],template:function(i,r){1&i&&(ae(0,"h2",0),Re(1),le(),ae(2,"mat-dialog-content",1)(3,"p"),Re(4),le(),vt(5,qJ,2,2,"ng-container",2),le(),ae(6,"mat-dialog-actions",3)(7,"button",4),Tt("click",function(){return r.onCancel()}),Re(8),le(),ae(9,"button",5),Tt("click",function(){return r.onConfirm()}),Re(10),le()()),2&i&&(xe(),er(r.data.title||"Confirmar"),xe(3),er(r.data.message),xe(),Xe("ngIf",r.data.input),xe(3),Ci(" ",r.data.cancelText||"Cancelar"," "),xe(),Xe("color",r.data.input?"warn":"primary")("disabled",r.data.input&&!r.inputValue.trim()),xe(),Ci(" ",r.data.confirmText||(r.data.input?"Enviar":"Aceptar")," "))},dependencies:[Ea,Os,MT,dc,Ad,CT,_R,HV,GV,$V,Hg,jg],styles:[".dialog-content[_ngcontent-%COMP%]{padding-right:16px}.textarea[_ngcontent-%COMP%]{width:90%;margin-top:1rem;font-size:14px;padding:.5rem}"]})}return t})();function YJ(t,n){if(1&t){const e=_i();ae(0,"div",1)(1,"button",2),Tt("click",function(){return on(e),ln(Lt().action())}),Re(2),le()()}if(2&t){const e=Lt();xe(2),Ci(" ",e.data.action," ")}}const ZJ=["label"];function XJ(t,n){}const KJ=Math.pow(2,31)-1;class jR{_overlayRef;instance;containerInstance;_afterDismissed=new Et;_afterOpened=new Et;_onAction=new Et;_durationTimeoutId;_dismissedByAction=!1;constructor(n,e){this._overlayRef=e,this.containerInstance=n,n._onExit.subscribe(()=>this._finishDismiss())}dismiss(){this._afterDismissed.closed||this.containerInstance.exit(),clearTimeout(this._durationTimeoutId)}dismissWithAction(){this._onAction.closed||(this._dismissedByAction=!0,this._onAction.next(),this._onAction.complete(),this.dismiss()),clearTimeout(this._durationTimeoutId)}closeWithAction(){this.dismissWithAction()}_dismissAfter(n){this._durationTimeoutId=setTimeout(()=>this.dismiss(),Math.min(n,KJ))}_open(){this._afterOpened.closed||(this._afterOpened.next(),this._afterOpened.complete())}_finishDismiss(){this._overlayRef.dispose(),this._onAction.closed||this._onAction.complete(),this._afterDismissed.next({dismissedByAction:this._dismissedByAction}),this._afterDismissed.complete(),this._dismissedByAction=!1}afterDismissed(){return this._afterDismissed}afterOpened(){return this.containerInstance._onEnter}onAction(){return this._onAction}}const e5=new _t("MatSnackBarData");class TT{politeness="assertive";announcementMessage="";viewContainerRef;duration=0;panelClass;direction;data=null;horizontalPosition="center";verticalPosition="bottom"}let t5=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275dir=Ht({type:t,selectors:[["","matSnackBarLabel",""]],hostAttrs:[1,"mat-mdc-snack-bar-label","mdc-snackbar__label"]})}return t})(),n5=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275dir=Ht({type:t,selectors:[["","matSnackBarActions",""]],hostAttrs:[1,"mat-mdc-snack-bar-actions","mdc-snackbar__actions"]})}return t})(),i5=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275dir=Ht({type:t,selectors:[["","matSnackBarAction",""]],hostAttrs:[1,"mat-mdc-snack-bar-action","mdc-snackbar__action"]})}return t})(),QJ=(()=>{class t{snackBarRef=te(jR);data=te(e5);constructor(){}action(){this.snackBarRef.dismissWithAction()}get hasAction(){return!!this.data.action}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=kn({type:t,selectors:[["simple-snack-bar"]],hostAttrs:[1,"mat-mdc-simple-snack-bar"],exportAs:["matSnackBar"],decls:3,vars:2,consts:[["matSnackBarLabel",""],["matSnackBarActions",""],["mat-button","","matSnackBarAction","",3,"click"]],template:function(i,r){1&i&&(ae(0,"div",0),Re(1),le(),vt(2,YJ,3,1,"div",1)),2&i&&(xe(),Ci(" ",r.data.message,"\n"),xe(),qi(r.hasAction?2:-1))},dependencies:[jg,t5,n5,i5],styles:[".mat-mdc-simple-snack-bar{display:flex}\n"],encapsulation:2,changeDetection:0})}return t})();const HR="_mat-snack-bar-enter",$R="_mat-snack-bar-exit";let r5=(()=>{class t extends $M{_ngZone=te(wt);_elementRef=te(Dn);_changeDetectorRef=te(Do);_platform=te(xs);_rendersRef;_animationsDisabled="NoopAnimations"===te(wa,{optional:!0});snackBarConfig=te(TT);_document=te(mr);_trackedModals=new Set;_enterFallback;_exitFallback;_renders=new Et;_announceDelay=150;_announceTimeoutId;_destroyed=!1;_portalOutlet;_onAnnounce=new Et;_onExit=new Et;_onEnter=new Et;_animationState="void";_live;_label;_role;_liveElementId=te(Sa).getId("mat-snack-bar-container-live-");constructor(){super();const e=this.snackBarConfig;this._live="assertive"!==e.politeness||e.announcementMessage?"off"===e.politeness?"off":"polite":"assertive",this._platform.FIREFOX&&("polite"===this._live&&(this._role="status"),"assertive"===this._live&&(this._role="alert")),this._rendersRef=tg(()=>this._renders.next(),{manualCleanup:!0})}attachComponentPortal(e){this._assertNotAttached();const i=this._portalOutlet.attachComponentPortal(e);return this._afterPortalAttached(),i}attachTemplatePortal(e){this._assertNotAttached();const i=this._portalOutlet.attachTemplatePortal(e);return this._afterPortalAttached(),i}attachDomPortal=e=>{this._assertNotAttached();const i=this._portalOutlet.attachDomPortal(e);return this._afterPortalAttached(),i};onAnimationEnd(e){e===$R?this._completeExit():e===HR&&(clearTimeout(this._enterFallback),this._ngZone.run(()=>{this._onEnter.next(),this._onEnter.complete()}))}enter(){this._destroyed||(this._animationState="visible",this._changeDetectorRef.markForCheck(),this._changeDetectorRef.detectChanges(),this._screenReaderAnnounce(),this._animationsDisabled?this._renders.pipe(Qa(1)).subscribe(()=>{this._ngZone.run(()=>queueMicrotask(()=>this.onAnimationEnd(HR)))}):(clearTimeout(this._enterFallback),this._enterFallback=setTimeout(()=>{this._elementRef.nativeElement.classList.add("mat-snack-bar-fallback-visible"),this.onAnimationEnd(HR)},200)))}exit(){return this._destroyed?Fn(void 0):(this._ngZone.run(()=>{this._animationState="hidden",this._changeDetectorRef.markForCheck(),this._elementRef.nativeElement.setAttribute("mat-exit",""),clearTimeout(this._announceTimeoutId),this._animationsDisabled?this._renders.pipe(Qa(1)).subscribe(()=>{this._ngZone.run(()=>queueMicrotask(()=>this.onAnimationEnd($R)))}):(clearTimeout(this._exitFallback),this._exitFallback=setTimeout(()=>this.onAnimationEnd($R),200))}),this._onExit)}ngOnDestroy(){this._destroyed=!0,this._clearFromModals(),this._completeExit(),this._renders.complete(),this._rendersRef.destroy()}_completeExit(){clearTimeout(this._exitFallback),queueMicrotask(()=>{this._onExit.next(),this._onExit.complete()})}_afterPortalAttached(){const e=this._elementRef.nativeElement,i=this.snackBarConfig.panelClass;i&&(Array.isArray(i)?i.forEach(f=>e.classList.add(f)):e.classList.add(i)),this._exposeToModals();const r=this._label.nativeElement,l="mdc-snackbar__label";r.classList.toggle(l,!r.querySelector(`.${l}`))}_exposeToModals(){const e=this._liveElementId,i=this._document.querySelectorAll('body > .cdk-overlay-container [aria-modal="true"]');for(let r=0;r<i.length;r++){const l=i[r],f=l.getAttribute("aria-owns");this._trackedModals.add(l),f?-1===f.indexOf(e)&&l.setAttribute("aria-owns",f+" "+e):l.setAttribute("aria-owns",e)}}_clearFromModals(){this._trackedModals.forEach(e=>{const i=e.getAttribute("aria-owns");if(i){const r=i.replace(this._liveElementId,"").trim();r.length>0?e.setAttribute("aria-owns",r):e.removeAttribute("aria-owns")}}),this._trackedModals.clear()}_assertNotAttached(){this._portalOutlet.hasAttached()}_screenReaderAnnounce(){this._announceTimeoutId||this._ngZone.runOutsideAngular(()=>{this._announceTimeoutId=setTimeout(()=>{if(this._destroyed)return;const e=this._elementRef.nativeElement,i=e.querySelector("[aria-hidden]"),r=e.querySelector("[aria-live]");if(i&&r){let l=null;this._platform.isBrowser&&document.activeElement instanceof HTMLElement&&i.contains(document.activeElement)&&(l=document.activeElement),i.removeAttribute("aria-hidden"),r.appendChild(i),l?.focus(),this._onAnnounce.next(),this._onAnnounce.complete()}},this._announceDelay)})}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=kn({type:t,selectors:[["mat-snack-bar-container"]],viewQuery:function(i,r){if(1&i&&(kr(qy,7),kr(ZJ,7)),2&i){let l;Zn(l=Xn())&&(r._portalOutlet=l.first),Zn(l=Xn())&&(r._label=l.first)}},hostAttrs:[1,"mdc-snackbar","mat-mdc-snack-bar-container"],hostVars:6,hostBindings:function(i,r){1&i&&Tt("animationend",function(f){return r.onAnimationEnd(f.animationName)})("animationcancel",function(f){return r.onAnimationEnd(f.animationName)}),2&i&&Di("mat-snack-bar-container-enter","visible"===r._animationState)("mat-snack-bar-container-exit","hidden"===r._animationState)("mat-snack-bar-container-animations-enabled",!r._animationsDisabled)},features:[Nn],decls:6,vars:3,consts:[["label",""],[1,"mdc-snackbar__surface","mat-mdc-snackbar-surface"],[1,"mat-mdc-snack-bar-label"],["aria-hidden","true"],["cdkPortalOutlet",""]],template:function(i,r){1&i&&(ae(0,"div",1)(1,"div",2,0)(3,"div",3),vt(4,XJ,0,0,"ng-template",4),le(),Wt(5,"div"),le()()),2&i&&(xe(5),ii("aria-live",r._live)("role",r._role)("id",r._liveElementId))},dependencies:[qy],styles:["@keyframes _mat-snack-bar-enter{from{transform:scale(0.8);opacity:0}to{transform:scale(1);opacity:1}}@keyframes _mat-snack-bar-exit{from{opacity:1}to{opacity:0}}.mat-mdc-snack-bar-container{display:flex;align-items:center;justify-content:center;box-sizing:border-box;-webkit-tap-highlight-color:rgba(0,0,0,0);margin:8px}.mat-mdc-snack-bar-handset .mat-mdc-snack-bar-container{width:100vw}.mat-snack-bar-container-animations-enabled{opacity:0}.mat-snack-bar-container-animations-enabled.mat-snack-bar-fallback-visible{opacity:1}.mat-snack-bar-container-animations-enabled.mat-snack-bar-container-enter{animation:_mat-snack-bar-enter 150ms cubic-bezier(0, 0, 0.2, 1) forwards}.mat-snack-bar-container-animations-enabled.mat-snack-bar-container-exit{animation:_mat-snack-bar-exit 75ms cubic-bezier(0.4, 0, 1, 1) forwards}.mat-mdc-snackbar-surface{box-shadow:0px 3px 5px -1px rgba(0, 0, 0, 0.2), 0px 6px 10px 0px rgba(0, 0, 0, 0.14), 0px 1px 18px 0px rgba(0, 0, 0, 0.12);display:flex;align-items:center;justify-content:flex-start;box-sizing:border-box;padding-left:0;padding-right:8px}[dir=rtl] .mat-mdc-snackbar-surface{padding-right:0;padding-left:8px}.mat-mdc-snack-bar-container .mat-mdc-snackbar-surface{min-width:344px;max-width:672px}.mat-mdc-snack-bar-handset .mat-mdc-snackbar-surface{width:100%;min-width:0}@media(forced-colors: active){.mat-mdc-snackbar-surface{outline:solid 1px}}.mat-mdc-snack-bar-container .mat-mdc-snackbar-surface{color:var(--mdc-snackbar-supporting-text-color, var(--mat-sys-inverse-on-surface));border-radius:var(--mdc-snackbar-container-shape, var(--mat-sys-corner-extra-small));background-color:var(--mdc-snackbar-container-color, var(--mat-sys-inverse-surface))}.mdc-snackbar__label{width:100%;flex-grow:1;box-sizing:border-box;margin:0;padding:14px 8px 14px 16px}[dir=rtl] .mdc-snackbar__label{padding-left:8px;padding-right:16px}.mat-mdc-snack-bar-container .mdc-snackbar__label{font-family:var(--mdc-snackbar-supporting-text-font, var(--mat-sys-body-medium-font));font-size:var(--mdc-snackbar-supporting-text-size, var(--mat-sys-body-medium-size));font-weight:var(--mdc-snackbar-supporting-text-weight, var(--mat-sys-body-medium-weight));line-height:var(--mdc-snackbar-supporting-text-line-height, var(--mat-sys-body-medium-line-height))}.mat-mdc-snack-bar-actions{display:flex;flex-shrink:0;align-items:center;box-sizing:border-box}.mat-mdc-snack-bar-handset,.mat-mdc-snack-bar-container,.mat-mdc-snack-bar-label{flex:1 1 auto}.mat-mdc-snack-bar-container .mat-mdc-button.mat-mdc-snack-bar-action:not(:disabled).mat-unthemed{color:var(--mat-snack-bar-button-color, var(--mat-sys-inverse-primary))}.mat-mdc-snack-bar-container .mat-mdc-button.mat-mdc-snack-bar-action:not(:disabled){--mat-text-button-state-layer-color:currentColor;--mat-text-button-ripple-color:currentColor}.mat-mdc-snack-bar-container .mat-mdc-button.mat-mdc-snack-bar-action:not(:disabled) .mat-ripple-element{opacity:.1}\n"],encapsulation:2})}return t})();const eee=new _t("mat-snack-bar-default-options",{providedIn:"root",factory:function JJ(){return new TT}});let GR=(()=>{class t{_overlay=te(oa);_live=te(nV);_injector=te(we);_breakpointObserver=te(YB);_parentSnackBar=te(t,{optional:!0,skipSelf:!0});_defaultConfig=te(eee);_snackBarRefAtThisLevel=null;simpleSnackBarComponent=QJ;snackBarContainerComponent=r5;handsetCssClass="mat-mdc-snack-bar-handset";get _openedSnackBarRef(){const e=this._parentSnackBar;return e?e._openedSnackBarRef:this._snackBarRefAtThisLevel}set _openedSnackBarRef(e){this._parentSnackBar?this._parentSnackBar._openedSnackBarRef=e:this._snackBarRefAtThisLevel=e}constructor(){}openFromComponent(e,i){return this._attach(e,i)}openFromTemplate(e,i){return this._attach(e,i)}open(e,i="",r){const l={...this._defaultConfig,...r};return l.data={message:e,action:i},l.announcementMessage===e&&(l.announcementMessage=void 0),this.openFromComponent(this.simpleSnackBarComponent,l)}dismiss(){this._openedSnackBarRef&&this._openedSnackBarRef.dismiss()}ngOnDestroy(){this._snackBarRefAtThisLevel&&this._snackBarRefAtThisLevel.dismiss()}_attachSnackBarContainer(e,i){const l=we.create({parent:i&&i.viewContainerRef&&i.viewContainerRef.injector||this._injector,providers:[{provide:TT,useValue:i}]}),f=new zg(this.snackBarContainerComponent,i.viewContainerRef,l),w=e.attach(f);return w.instance.snackBarConfig=i,w.instance}_attach(e,i){const r={...new TT,...this._defaultConfig,...i},l=this._createOverlay(r),f=this._attachSnackBarContainer(l,r),w=new jR(f,l);if(e instanceof is){const M=new HM(e,null,{$implicit:r.data,snackBarRef:w});w.instance=f.attachTemplatePortal(M)}else{const M=this._createInjector(r,w),P=new zg(e,void 0,M),L=f.attachComponentPortal(P);w.instance=L.instance}return this._breakpointObserver.observe("(max-width: 599.98px) and (orientation: portrait)").pipe(jr(l.detachments())).subscribe(M=>{l.overlayElement.classList.toggle(this.handsetCssClass,M.matches)}),r.announcementMessage&&f._onAnnounce.subscribe(()=>{this._live.announce(r.announcementMessage,r.politeness)}),this._animateSnackBar(w,r),this._openedSnackBarRef=w,this._openedSnackBarRef}_animateSnackBar(e,i){e.afterDismissed().subscribe(()=>{this._openedSnackBarRef==e&&(this._openedSnackBarRef=null),i.announcementMessage&&this._live.clear()}),i.duration&&i.duration>0&&e.afterOpened().subscribe(()=>e._dismissAfter(i.duration)),this._openedSnackBarRef?(this._openedSnackBarRef.afterDismissed().subscribe(()=>{e.containerInstance.enter()}),this._openedSnackBarRef.dismiss()):e.containerInstance.enter()}_createOverlay(e){const i=new FC;i.direction=e.direction;let r=this._overlay.position().global();const l="rtl"===e.direction,f="left"===e.horizontalPosition||"start"===e.horizontalPosition&&!l||"end"===e.horizontalPosition&&l,w=!f&&"center"!==e.horizontalPosition;return f?r.left("0"):w?r.right("0"):r.centerHorizontally(),"top"===e.verticalPosition?r.top("0"):r.bottom("0"),i.positionStrategy=r,this._overlay.create(i)}_createInjector(e,i){return we.create({parent:e&&e.viewContainerRef&&e.viewContainerRef.injector||this._injector,providers:[{provide:jR,useValue:i},{provide:e5,useValue:e.data}]})}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),Uc=(()=>{class t{snackBar;dialog;constructor(e,i){this.snackBar=e,this.dialog=i}success(e){this.snackBar.open(`\u2714\ufe0f ${e}`,"Cerrar",{duration:4e3,horizontalPosition:"center",verticalPosition:"top",panelClass:["snackbar-success"]})}error(e){this.snackBar.open(`\u274c ${e}`,"Cerrar",{duration:5e3,horizontalPosition:"center",verticalPosition:"top",panelClass:["snackbar-error"]})}confirm(e,i={}){return this.dialog.open(Gg,{width:"320px",data:{message:e,...i}}).afterClosed()}static \u0275fac=function(i){return new(i||t)(gn(GR),gn(Vg))};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function tee(t,n){if(1&t){const e=_i();ae(0,"li")(1,"a",4),Tt("click",function(){return on(e),ln(Lt().toggleMenu())}),Re(2,"Crear cuenta"),le()()}}function nee(t,n){if(1&t&&(ae(0,"span",7),Re(1),le()),2&t){const e=Lt().ngIf;xe(),Ci(" ",e.length," ")}}function iee(t,n){if(1&t&&(Qi(0),vt(1,nee,2,1,"span",6),Ji()),2&t){const e=n.ngIf;xe(),Xe("ngIf",e.length>0)}}function ree(t,n){if(1&t){const e=_i();ae(0,"li")(1,"a",5),Tt("click",function(){return on(e),ln(Lt().toggleNotifications())}),Re(2," \u{1f514} Notificaciones "),vt(3,iee,2,1,"ng-container",1),Jf(4,"async"),le()()}if(2&t){const e=Lt();xe(3),Xe("ngIf",$D(4,1,e.userNotificationService.notifications$))}}function oee(t,n){1&t&&(ae(0,"li",8),Wt(1,"app-notification-list"),le())}function see(t,n){if(1&t){const e=_i();ae(0,"li")(1,"a",9),Tt("click",function(){return on(e),ln(Lt().toggleMenu())}),Re(2,"Inicio"),le()()}}function aee(t,n){if(1&t){const e=_i();ae(0,"li")(1,"a",10),Tt("click",function(){return on(e),ln(Lt().toggleMenu())}),Re(2,"Mi Cuenta"),le()()}}function lee(t,n){if(1&t){const e=_i();ae(0,"li")(1,"a",11),Tt("click",function(){return on(e),ln(Lt().toggleMenu())}),Re(2,"Mis Reportes"),le()()}}function cee(t,n){if(1&t){const e=_i();ae(0,"li")(1,"a",12),Tt("click",function(){return on(e),ln(Lt().toggleMenu())}),Re(2,"Crear reporte"),le()()}}function dee(t,n){if(1&t){const e=_i();ae(0,"li")(1,"a",13),Tt("click",function(){return on(e),ln(Lt().toggleMenu())}),Re(2,"Administrar Reportes"),le()()}}function uee(t,n){if(1&t){const e=_i();ae(0,"li")(1,"a",14),Tt("click",function(){return on(e),ln(Lt().toggleMenu())}),Re(2,"Historias de Reportes"),le()()}}function hee(t,n){if(1&t){const e=_i();ae(0,"li")(1,"a",15),Tt("click",function(){return on(e),ln(Lt().toggleMenu())}),Re(2,"Generar informe"),le()()}}function pee(t,n){if(1&t){const e=_i();ae(0,"li")(1,"a",16),Tt("click",function(){return on(e),ln(Lt().toggleMenu())}),Re(2,"Administrar Categor\xedas"),le()()}}function fee(t,n){if(1&t){const e=_i();ae(0,"li")(1,"a",5),Tt("click",function(){on(e);const r=Lt();return r.logout(),ln(r.toggleMenu())}),Re(2,"Cerrar Sesi\xf3n"),le()()}}let mee=(()=>{class t{authService;router;notificationService;userNotificationService;isOpen=!1;isLoggedIn=!1;notificationsOpen=!1;isAdmin=!1;authSubscription=new Mi;constructor(e,i,r,l){this.authService=e,this.router=i,this.notificationService=r,this.userNotificationService=l}ngOnInit(){this.authSubscription.add(this.authService.getAuthStatus().subscribe(e=>{this.isLoggedIn=e})),this.authSubscription.add(this.authService.getAdminStatus().subscribe(e=>{this.isAdmin=e}))}ngOnDestroy(){this.authSubscription&&this.authSubscription.unsubscribe()}toggleMenu(){this.isOpen=!this.isOpen}toggleNotifications(){this.notificationsOpen=!this.notificationsOpen}logout(){this.notificationService.confirm("\xbfEst\xe1s seguro de que quieres cerrar sesi\xf3n?",{title:"Cerrar sesi\xf3n",confirmText:"S\xed, salir",cancelText:"No"}).subscribe(e=>{e&&(this.notificationService.success("Cerrando sesi\xf3n..."),this.authService.logout().subscribe({next:()=>this.router.navigate(["/login"]),error:i=>{console.error(i),this.notificationService.error("No se pudo cerrar sesi\xf3n")}}))})}register(){this.router.navigate(["/report/new"])}navigate(e){this.router.navigate([e]),this.isOpen=!1}static \u0275fac=function(i){return new(i||t)(ft(Su),ft(oo),ft(Uc),ft(Z2))};static \u0275cmp=kn({type:t,selectors:[["app-header"]],decls:16,vars:14,consts:[[1,"sidebar"],[4,"ngIf"],["class","notification-panel",4,"ngIf"],[1,"menu-button",3,"click"],["routerLink","/register",3,"click"],[3,"click"],["class","badge",4,"ngIf"],[1,"badge"],[1,"notification-panel"],["routerLink","/map",3,"click"],["routerLink","/profile",3,"click"],["routerLink","/my-reports",3,"click"],["routerLink","/report/new",3,"click"],["routerLink","/report-list-admin",3,"click"],["routerLink","/report-histories",3,"click"],["routerLink","/report-summary",3,"click"],["routerLink","/category-list",3,"click"]],template:function(i,r){1&i&&(ae(0,"div",0)(1,"ul"),vt(2,tee,3,0,"li",1)(3,ree,5,3,"li",1)(4,oee,2,0,"li",2)(5,see,3,0,"li",1)(6,aee,3,0,"li",1)(7,lee,3,0,"li",1)(8,cee,3,0,"li",1)(9,dee,3,0,"li",1)(10,uee,3,0,"li",1)(11,hee,3,0,"li",1)(12,pee,3,0,"li",1)(13,fee,3,0,"li",1),le()(),ae(14,"button",3),Tt("click",function(){return r.toggleMenu()}),Re(15,"\u2630"),le()),2&i&&(Di("active",r.isOpen),xe(2),Xe("ngIf",!r.isLoggedIn),xe(),Xe("ngIf",r.isLoggedIn),xe(),Xe("ngIf",r.notificationsOpen),xe(),Xe("ngIf",r.isLoggedIn),xe(),Xe("ngIf",r.isLoggedIn),xe(),Xe("ngIf",r.isLoggedIn),xe(),Xe("ngIf",r.isLoggedIn),xe(),Xe("ngIf",r.isAdmin),xe(),Xe("ngIf",r.isAdmin),xe(),Xe("ngIf",r.isAdmin),xe(),Xe("ngIf",r.isAdmin),xe(),Xe("ngIf",r.isLoggedIn))},dependencies:[Os,z0,xC,i2,eK],styles:["[_ngcontent-%COMP%]:root{--primary-bg: #e0f4fa;--primary-accent: #79b4d8;--primary-dark: #1e3a5f;--input-bg: #ffffff;--error-color: #e74c3c;--hover-bg: #c0c8d4}.sidebar[_ngcontent-%COMP%]{position:fixed;right:-270px;top:0;width:250px;height:100%;background:#fff;color:var(--primary-dark);transition:right .4s ease;padding-top:80px;box-shadow:-4px 0 8px #0003;border-top-left-radius:10px;border-bottom-left-radius:10px;z-index:999}.sidebar.active[_ngcontent-%COMP%]{right:0}.sidebar[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0}.sidebar[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:15px 20px;text-align:left;transition:background .3s ease;font-weight:500;font-size:16px;background:var(--input-bg)}.sidebar[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover{background:#aaa;cursor:pointer;border-radius:8px}.sidebar[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--primary-dark);text-decoration:none;display:block}.menu-button[_ngcontent-%COMP%]{position:fixed;top:20px;right:20px;background:var(--primary-bg);border:none;color:var(--primary-dark);padding:10px 15px;font-size:24px;cursor:pointer;border-radius:8px;box-shadow:2px 2px 6px #0003;transition:background .3s,transform .2s;z-index:1000}.menu-button[_ngcontent-%COMP%]:hover{background:var(--primary-accent);transform:scale(1.05)}.menu-button[_ngcontent-%COMP%]:active{background:#7a99c3;transform:scale(.95)}.link-button[_ngcontent-%COMP%]{background:none;border:none;color:var(--primary-dark);font-weight:500;font-size:16px;width:100%;text-align:left;padding:15px 20px;cursor:pointer;display:block}.link-button[_ngcontent-%COMP%]:hover{background:#aaa;border-radius:8px}"]})}return t})(),gee=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275cmp=kn({type:t,selectors:[["app-root"]],decls:2,vars:0,template:function(i,r){1&i&&Wt(0,"app-header")(1,"router-outlet")},dependencies:[mee,k2],styles:[".close-btn[_ngcontent-%COMP%]{position:absolute;top:10px;right:10px;background:none;border:none;color:#fff;font-size:20px;cursor:pointer}"]})}return t})();var o5=Ll(247),ss=Ll.n(o5);const iv_mapboxToken="pk.eyJ1IjoibWFya2F0IiwiYSI6ImNtN2o2eGcwZDAwcGsycG9pZzZ6cjhncTgifQ.f9qApUfu6cdG-w-gpjPOlQ";function s5(t={}){const{connector:n=()=>new Et,resetOnError:e=!0,resetOnComplete:i=!0,resetOnRefCountZero:r=!0}=t;return l=>{let f,w,M,P=0,L=!1,$=!1;const Q=()=>{w?.unsubscribe(),w=void 0},X=()=>{Q(),f=M=void 0,L=$=!1},Y=()=>{const K=f;X(),K?.unsubscribe()};return Jn((K,de)=>{P++,!$&&!L&&Q();const ye=M=M??n();de.add(()=>{P--,0===P&&!$&&!L&&(w=qR(Y,r))}),ye.subscribe(de),!f&&P>0&&(f=new re({next:he=>ye.next(he),error:he=>{$=!0,Q(),w=qR(X,e,he),ye.error(he)},complete:()=>{L=!0,Q(),w=qR(X,i),ye.complete()}}),Lc(K).subscribe(f))})(l)}}function qR(t,n,...e){if(!0===n)return void t();if(!1===n)return;const i=new re({next:()=>{i.unsubscribe(),t()}});return Lc(n(...e)).subscribe(i)}let IT;function YC(t){return function _ee(){if(void 0===IT&&(IT=null,typeof window<"u")){const t=window;void 0!==t.trustedTypes&&(IT=t.trustedTypes.createPolicy("angular#components",{createHTML:n=>n}))}return IT}()?.createHTML(t)||t}function a5(t){return Error(`Unable to find icon with the name "${t}"`)}function l5(t){return Error(`The URL provided to MatIconRegistry was not trusted as a resource URL via Angular's DomSanitizer. Attempted URL was "${t}".`)}function c5(t){return Error(`The literal provided to MatIconRegistry was not trusted as safe HTML by Angular's DomSanitizer. Attempted literal was "${t}".`)}class rv{url;svgText;options;svgElement;constructor(n,e,i){this.url=n,this.svgText=e,this.options=i}}let AT=(()=>{class t{_httpClient;_sanitizer;_errorHandler;_document;_svgIconConfigs=new Map;_iconSetConfigs=new Map;_cachedIconsByUrl=new Map;_inProgressUrlFetches=new Map;_fontCssClassesByAlias=new Map;_resolvers=[];_defaultFontSetClass=["material-icons","mat-ligature-font"];constructor(e,i,r,l){this._httpClient=e,this._sanitizer=i,this._errorHandler=l,this._document=r}addSvgIcon(e,i,r){return this.addSvgIconInNamespace("",e,i,r)}addSvgIconLiteral(e,i,r){return this.addSvgIconLiteralInNamespace("",e,i,r)}addSvgIconInNamespace(e,i,r,l){return this._addSvgIconConfig(e,i,new rv(r,null,l))}addSvgIconResolver(e){return this._resolvers.push(e),this}addSvgIconLiteralInNamespace(e,i,r,l){const f=this._sanitizer.sanitize(ns.HTML,r);if(!f)throw c5(r);const w=YC(f);return this._addSvgIconConfig(e,i,new rv("",w,l))}addSvgIconSet(e,i){return this.addSvgIconSetInNamespace("",e,i)}addSvgIconSetLiteral(e,i){return this.addSvgIconSetLiteralInNamespace("",e,i)}addSvgIconSetInNamespace(e,i,r){return this._addSvgIconSetConfig(e,new rv(i,null,r))}addSvgIconSetLiteralInNamespace(e,i,r){const l=this._sanitizer.sanitize(ns.HTML,i);if(!l)throw c5(i);const f=YC(l);return this._addSvgIconSetConfig(e,new rv("",f,r))}registerFontClassAlias(e,i=e){return this._fontCssClassesByAlias.set(e,i),this}classNameForFontAlias(e){return this._fontCssClassesByAlias.get(e)||e}setDefaultFontSetClass(...e){return this._defaultFontSetClass=e,this}getDefaultFontSetClass(){return this._defaultFontSetClass}getSvgIconFromUrl(e){const i=this._sanitizer.sanitize(ns.RESOURCE_URL,e);if(!i)throw l5(e);const r=this._cachedIconsByUrl.get(i);return r?Fn(kT(r)):this._loadSvgIconFromConfig(new rv(e,null)).pipe(Rr(l=>this._cachedIconsByUrl.set(i,l)),an(l=>kT(l)))}getNamedSvgIcon(e,i=""){const r=d5(i,e);let l=this._svgIconConfigs.get(r);if(l)return this._getSvgFromConfig(l);if(l=this._getIconConfigFromResolvers(i,e),l)return this._svgIconConfigs.set(r,l),this._getSvgFromConfig(l);const f=this._iconSetConfigs.get(i);return f?this._getSvgFromIconSetConfigs(e,f):ra(a5(r))}ngOnDestroy(){this._resolvers=[],this._svgIconConfigs.clear(),this._iconSetConfigs.clear(),this._cachedIconsByUrl.clear()}_getSvgFromConfig(e){return e.svgText?Fn(kT(this._svgElementFromConfig(e))):this._loadSvgIconFromConfig(e).pipe(an(i=>kT(i)))}_getSvgFromIconSetConfigs(e,i){const r=this._extractIconWithNameFromAnySet(e,i);return r?Fn(r):t4(i.filter(f=>!f.svgText).map(f=>this._loadSvgIconSetFromConfig(f).pipe(Kr(w=>{const P=`Loading icon set URL: ${this._sanitizer.sanitize(ns.RESOURCE_URL,f.url)} failed: ${w.message}`;return this._errorHandler.handleError(new Error(P)),Fn(null)})))).pipe(an(()=>{const f=this._extractIconWithNameFromAnySet(e,i);if(!f)throw a5(e);return f}))}_extractIconWithNameFromAnySet(e,i){for(let r=i.length-1;r>=0;r--){const l=i[r];if(l.svgText&&l.svgText.toString().indexOf(e)>-1){const f=this._svgElementFromConfig(l),w=this._extractSvgIconFromSet(f,e,l.options);if(w)return w}}return null}_loadSvgIconFromConfig(e){return this._fetchIcon(e).pipe(Rr(i=>e.svgText=i),an(()=>this._svgElementFromConfig(e)))}_loadSvgIconSetFromConfig(e){return e.svgText?Fn(null):this._fetchIcon(e).pipe(Rr(i=>e.svgText=i))}_extractSvgIconFromSet(e,i,r){const l=e.querySelector(`[id="${i}"]`);if(!l)return null;const f=l.cloneNode(!0);if(f.removeAttribute("id"),"svg"===f.nodeName.toLowerCase())return this._setSvgAttributes(f,r);if("symbol"===f.nodeName.toLowerCase())return this._setSvgAttributes(this._toSvgElement(f),r);const w=this._svgElementFromString(YC("<svg></svg>"));return w.appendChild(f),this._setSvgAttributes(w,r)}_svgElementFromString(e){const i=this._document.createElement("DIV");i.innerHTML=e;const r=i.querySelector("svg");if(!r)throw Error("<svg> tag not found");return r}_toSvgElement(e){const i=this._svgElementFromString(YC("<svg></svg>")),r=e.attributes;for(let l=0;l<r.length;l++){const{name:f,value:w}=r[l];"id"!==f&&i.setAttribute(f,w)}for(let l=0;l<e.childNodes.length;l++)e.childNodes[l].nodeType===this._document.ELEMENT_NODE&&i.appendChild(e.childNodes[l].cloneNode(!0));return i}_setSvgAttributes(e,i){return e.setAttribute("fit",""),e.setAttribute("height","100%"),e.setAttribute("width","100%"),e.setAttribute("preserveAspectRatio","xMidYMid meet"),e.setAttribute("focusable","false"),i&&i.viewBox&&e.setAttribute("viewBox",i.viewBox),e}_fetchIcon(e){const{url:i,options:r}=e,l=r?.withCredentials??!1;if(!this._httpClient)throw function yee(){return Error("Could not find HttpClient for use with Angular Material icons. Please add provideHttpClient() to your providers.")}();if(null==i)throw Error(`Cannot fetch icon from URL "${i}".`);const f=this._sanitizer.sanitize(ns.RESOURCE_URL,i);if(!f)throw l5(i);const w=this._inProgressUrlFetches.get(f);if(w)return w;const M=this._httpClient.get(f,{responseType:"text",withCredentials:l}).pipe(an(P=>YC(P)),Vy(()=>this._inProgressUrlFetches.delete(f)),s5());return this._inProgressUrlFetches.set(f,M),M}_addSvgIconConfig(e,i,r){return this._svgIconConfigs.set(d5(e,i),r),this}_addSvgIconSetConfig(e,i){const r=this._iconSetConfigs.get(e);return r?r.push(i):this._iconSetConfigs.set(e,[i]),this}_svgElementFromConfig(e){if(!e.svgElement){const i=this._svgElementFromString(e.svgText);this._setSvgAttributes(i,e.options),e.svgElement=i}return e.svgElement}_getIconConfigFromResolvers(e,i){for(let r=0;r<this._resolvers.length;r++){const l=this._resolvers[r](i,e);if(l)return bee(l)?new rv(l.url,null,l.options):new rv(l,null)}}static \u0275fac=function(i){return new(i||t)(gn(Eu,8),gn(y2),gn(mr,8),gn(Xi))};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function kT(t){return t.cloneNode(!0)}function d5(t,n){return t+":"+n}function bee(t){return!(!t.url||!t.options)}const xee=["*"],wee=new _t("MAT_ICON_DEFAULT_OPTIONS"),Cee=new _t("mat-icon-location",{providedIn:"root",factory:function Eee(){const t=te(mr),n=t?t.location:null;return{getPathname:()=>n?n.pathname+n.search:""}}}),u5=["clip-path","color-profile","src","cursor","fill","filter","marker","marker-start","marker-mid","marker-end","mask","stroke"],See=u5.map(t=>`[${t}]`).join(", "),Dee=/^url\(['"]?#(.*?)['"]?\)$/;let kd=(()=>{class t{_elementRef=te(Dn);_iconRegistry=te(AT);_location=te(Cee);_errorHandler=te(Xi);_defaultColor;get color(){return this._color||this._defaultColor}set color(e){this._color=e}_color;inline=!1;get svgIcon(){return this._svgIcon}set svgIcon(e){e!==this._svgIcon&&(e?this._updateSvgIcon(e):this._svgIcon&&this._clearSvgElement(),this._svgIcon=e)}_svgIcon;get fontSet(){return this._fontSet}set fontSet(e){const i=this._cleanupFontValue(e);i!==this._fontSet&&(this._fontSet=i,this._updateFontIconClasses())}_fontSet;get fontIcon(){return this._fontIcon}set fontIcon(e){const i=this._cleanupFontValue(e);i!==this._fontIcon&&(this._fontIcon=i,this._updateFontIconClasses())}_fontIcon;_previousFontSetClass=[];_previousFontIconClass;_svgName;_svgNamespace;_previousPath;_elementsWithExternalReferences;_currentIconFetch=Mi.EMPTY;constructor(){const e=te(new Ee("aria-hidden"),{optional:!0}),i=te(wee,{optional:!0});i&&(i.color&&(this.color=this._defaultColor=i.color),i.fontSet&&(this.fontSet=i.fontSet)),e||this._elementRef.nativeElement.setAttribute("aria-hidden","true")}_splitIconName(e){if(!e)return["",""];const i=e.split(":");switch(i.length){case 1:return["",i[0]];case 2:return i;default:throw Error(`Invalid icon name: "${e}"`)}}ngOnInit(){this._updateFontIconClasses()}ngAfterViewChecked(){const e=this._elementsWithExternalReferences;if(e&&e.size){const i=this._location.getPathname();i!==this._previousPath&&(this._previousPath=i,this._prependPathToReferences(i))}}ngOnDestroy(){this._currentIconFetch.unsubscribe(),this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear()}_usingFontIcon(){return!this.svgIcon}_setSvgElement(e){this._clearSvgElement();const i=this._location.getPathname();this._previousPath=i,this._cacheChildrenWithExternalReferences(e),this._prependPathToReferences(i),this._elementRef.nativeElement.appendChild(e)}_clearSvgElement(){const e=this._elementRef.nativeElement;let i=e.childNodes.length;for(this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear();i--;){const r=e.childNodes[i];(1!==r.nodeType||"svg"===r.nodeName.toLowerCase())&&r.remove()}}_updateFontIconClasses(){if(!this._usingFontIcon())return;const e=this._elementRef.nativeElement,i=(this.fontSet?this._iconRegistry.classNameForFontAlias(this.fontSet).split(/ +/):this._iconRegistry.getDefaultFontSetClass()).filter(r=>r.length>0);this._previousFontSetClass.forEach(r=>e.classList.remove(r)),i.forEach(r=>e.classList.add(r)),this._previousFontSetClass=i,this.fontIcon!==this._previousFontIconClass&&!i.includes("mat-ligature-font")&&(this._previousFontIconClass&&e.classList.remove(this._previousFontIconClass),this.fontIcon&&e.classList.add(this.fontIcon),this._previousFontIconClass=this.fontIcon)}_cleanupFontValue(e){return"string"==typeof e?e.trim().split(" ")[0]:e}_prependPathToReferences(e){const i=this._elementsWithExternalReferences;i&&i.forEach((r,l)=>{r.forEach(f=>{l.setAttribute(f.name,`url('${e}#${f.value}')`)})})}_cacheChildrenWithExternalReferences(e){const i=e.querySelectorAll(See),r=this._elementsWithExternalReferences=this._elementsWithExternalReferences||new Map;for(let l=0;l<i.length;l++)u5.forEach(f=>{const w=i[l],M=w.getAttribute(f),P=M?M.match(Dee):null;if(P){let L=r.get(w);L||(L=[],r.set(w,L)),L.push({name:f,value:P[1]})}})}_updateSvgIcon(e){if(this._svgNamespace=null,this._svgName=null,this._currentIconFetch.unsubscribe(),e){const[i,r]=this._splitIconName(e);i&&(this._svgNamespace=i),r&&(this._svgName=r),this._currentIconFetch=this._iconRegistry.getNamedSvgIcon(r,i).pipe(Qa(1)).subscribe(l=>this._setSvgElement(l),l=>{this._errorHandler.handleError(new Error(`Error retrieving icon ${i}:${r}! ${l.message}`))})}}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=kn({type:t,selectors:[["mat-icon"]],hostAttrs:["role","img",1,"mat-icon","notranslate"],hostVars:10,hostBindings:function(i,r){2&i&&(ii("data-mat-icon-type",r._usingFontIcon()?"font":"svg")("data-mat-icon-name",r._svgName||r.fontIcon)("data-mat-icon-namespace",r._svgNamespace||r.fontSet)("fontIcon",r._usingFontIcon()?r.fontIcon:null),Kf(r.color?"mat-"+r.color:""),Di("mat-icon-inline",r.inline)("mat-icon-no-color","primary"!==r.color&&"accent"!==r.color&&"warn"!==r.color))},inputs:{color:"color",inline:[2,"inline","inline",Un],svgIcon:"svgIcon",fontSet:"fontSet",fontIcon:"fontIcon"},exportAs:["matIcon"],ngContentSelectors:xee,decls:1,vars:0,template:function(i,r){1&i&&(os(),Fi(0))},styles:["mat-icon,mat-icon.mat-primary,mat-icon.mat-accent,mat-icon.mat-warn{color:var(--mat-icon-color, inherit)}.mat-icon{-webkit-user-select:none;user-select:none;background-repeat:no-repeat;display:inline-block;fill:currentColor;height:24px;width:24px;overflow:hidden}.mat-icon.mat-icon-inline{font-size:inherit;height:inherit;line-height:inherit;width:inherit}.mat-icon.mat-ligature-font[fontIcon]::before{content:attr(fontIcon)}[dir=rtl] .mat-icon-rtl-mirror{transform:scale(-1, 1)}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon{display:block}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon-button .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon-button .mat-icon{margin:auto}\n"],encapsulation:2,changeDetection:0})}return t})(),Up=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275mod=Er({type:t});static \u0275inj=Ai({imports:[Qr,Qr]})}return t})();function Mee(t,n){1&t&&(ae(0,"h2"),Re(1,"CREA UNA CUENTA"),le())}function Tee(t,n){1&t&&(ae(0,"div",20),Re(1," \u26a0 El nombre completo es obligatorio. "),le())}function Iee(t,n){1&t&&(ae(0,"div",20),Re(1," \u26a0 El nombre debe tener al menos 8 caracteres. "),le())}function Aee(t,n){1&t&&(ae(0,"div",20),Re(1," \u26a0 El nombre no puede exceder 50 caracteres. "),le())}function kee(t,n){1&t&&(ae(0,"div",20),Re(1," \u26a0 El correo electr\xf3nico es obligatorio. "),le())}function Ree(t,n){1&t&&(ae(0,"div",20),Re(1," \u26a0 El formato de correo no es v\xe1lido. "),le())}function Pee(t,n){1&t&&(ae(0,"div",20),Re(1," \u26a0 El correo debe tener al menos 8 caracteres. "),le())}function Oee(t,n){1&t&&(ae(0,"div",20),Re(1," \u26a0 El correo no puede exceder 50 caracteres. "),le())}function Fee(t,n){1&t&&(ae(0,"div",20),Re(1," \u26a0 La contrase\xf1a es obligatoria. "),le())}function Lee(t,n){1&t&&(ae(0,"div",20),Re(1," \u26a0 Debe incluir al menos un d\xedgito, una may\xfascula y una min\xfascula. "),le())}function Nee(t,n){1&t&&(ae(0,"div",20),Re(1," \u26a0 La contrase\xf1a debe tener al menos 8 caracteres. "),le())}function zee(t,n){1&t&&(ae(0,"div",20),Re(1," \u26a0 La contrase\xf1a no puede exceder 50 caracteres. "),le())}function Bee(t,n){1&t&&(ae(0,"div",20),Re(1," \u26a0 La fecha de nacimiento es obligatoria. "),le())}function Vee(t,n){1&t&&(ae(0,"div",20),Re(1," \u26a0 La fecha de nacimiento no puede ser posterior a hoy. "),le())}function Uee(t,n){1&t&&(ae(0,"div",20),Re(1," \u26a0 La ciudad de residencia es obligatoria. "),le())}function jee(t,n){1&t&&(ae(0,"div",20),Re(1," \u26a0 El radio de notificaciones es obligatorio. "),le())}function Hee(t,n){1&t&&(ae(0,"div",20),Re(1," \u26a0 El radio de notificaciones debe ser mayor que 0. "),le())}function $ee(t,n){if(1&t){const e=_i();ae(0,"div")(1,"div",5),Wt(2,"i",6)(3,"input",7),le(),vt(4,Tee,2,0,"div",8)(5,Iee,2,0,"div",8)(6,Aee,2,0,"div",8),ae(7,"div",5),Wt(8,"i",9)(9,"input",10),le(),vt(10,kee,2,0,"div",8)(11,Ree,2,0,"div",8)(12,Pee,2,0,"div",8)(13,Oee,2,0,"div",8),ae(14,"div",5),Wt(15,"i",11)(16,"input",12),le(),vt(17,Fee,2,0,"div",8)(18,Lee,2,0,"div",8)(19,Nee,2,0,"div",8)(20,zee,2,0,"div",8),ae(21,"div",5),Wt(22,"i",13)(23,"input",14),le(),vt(24,Bee,2,0,"div",8)(25,Vee,2,0,"div",8),ae(26,"div",5),Wt(27,"i",15)(28,"input",16),le(),vt(29,Uee,2,0,"div",8),ae(30,"div",5),Wt(31,"i",17)(32,"input",18),le(),vt(33,jee,2,0,"div",8)(34,Hee,2,0,"div",8),ae(35,"button",19),Tt("click",function(){return on(e),ln(Lt().continueToMap())}),Re(36," Continuar "),le()()}if(2&t){const e=Lt();xe(4),Xe("ngIf",e.hasError("fullName","required")),xe(),Xe("ngIf",e.hasError("fullName","minlength")),xe(),Xe("ngIf",e.hasError("fullName","maxlength")),xe(4),Xe("ngIf",e.hasError("email","required")),xe(),Xe("ngIf",e.hasError("email","email")),xe(),Xe("ngIf",e.hasError("email","minlength")),xe(),Xe("ngIf",e.hasError("email","maxlength")),xe(4),Xe("ngIf",e.hasError("password","required")),xe(),Xe("ngIf",e.hasError("password","pattern")),xe(),Xe("ngIf",e.hasError("password","minlength")),xe(),Xe("ngIf",e.hasError("password","maxlength")),xe(4),Xe("ngIf",e.hasError("dateBirth","required")),xe(),Xe("ngIf",e.hasError("dateBirth","futureDate")),xe(4),Xe("ngIf",e.hasError("cityOfResidence","required")),xe(4),Xe("ngIf",e.hasError("notificationRadiusKm","required")),xe(),Xe("ngIf",e.hasError("notificationRadiusKm","min")),xe(),Xe("disabled",e.registerForm.invalid)}}function Gee(t,n){1&t&&(ae(0,"div",21),Re(1," Cargando mapa... "),le())}function qee(t,n){1&t&&Wt(0,"i",25)}function Wee(t,n){if(1&t){const e=_i();ae(0,"div"),Wt(1,"div",22),ae(2,"p"),Re(3,"Haz clic en el mapa para seleccionar tu ubicaci\xf3n."),le(),ae(4,"button",23),vt(5,qee,1,0,"i",24),Re(6),le(),ae(7,"button",19),Tt("click",function(){return on(e),ln(Lt().backToForm())}),Re(8," \u2190 Volver "),le()()}if(2&t){const e=Lt();xe(4),Xe("disabled",e.registerForm.invalid||e.isSubmitting),xe(),Xe("ngIf",e.isSubmitting),xe(),Ci(" ",e.isSubmitting?"Registrando...":"Registrar"," "),xe(),Xe("disabled",e.isSubmitting)}}let Yee=(()=>{class t{fb;authService;notificationService;router;registerForm;showMap=!1;isLoadingMap=!1;map;marker;isSubmitting=!1;constructor(e,i,r,l){this.fb=e,this.authService=i,this.notificationService=r,this.router=l,this.registerForm=this.fb.group({fullName:["",[bn.required,bn.minLength(8),bn.maxLength(50)]],email:["",[bn.required,bn.email,bn.minLength(8),bn.maxLength(50)]],password:["",[bn.required,bn.pattern("^(?=.*\\d)(?=.*[a-z])(?=.*[A-Z]).*$"),bn.minLength(8),bn.maxLength(50)]],dateBirth:["",[bn.required,this.pastDateValidator()]],cityOfResidence:["",bn.required],notificationRadiusKm:[null,bn.required],latitude:[null],longitude:[null]})}hasError(e,i){const r=this.registerForm.get(e);return!!(r&&r.touched&&r.hasError(i))}ngOnInit(){}ngAfterViewInit(){}continueToMap(){if(this.registerForm.valid){this.isLoadingMap=!0,this.showMap=!0;const e=this.registerForm.get("cityOfResidence").value;this.getCityCoordinates(e).then(i=>{this.initializeMap(i)}).catch(i=>{this.notificationService.error("No pudimos encontrar tu ciudad. Por favor revisa el nombre."),this.showMap=!1}).finally(()=>{this.isLoadingMap=!1})}}initializeMap(e={lng:-75.681,lat:4.533}){this.map=new(ss().Map)({container:"map_user",style:"mapbox://styles/mapbox/streets-v11",center:[e.lng,e.lat],zoom:12,attributionControl:!1,accessToken:iv_mapboxToken}),this.map.on("load",()=>{this.map.resize(),this.isLoadingMap=!1}),this.map.addControl(new(ss().NavigationControl),"bottom-right"),this.map.on("click",({lngLat:i})=>{this.registerForm.patchValue({latitude:i.lat,longitude:i.lng}),this.marker?this.marker.setLngLat(i):this.marker=new(ss().Marker)({draggable:!0,anchor:"center"}).setLngLat(i).addTo(this.map)})}getCityCoordinates(e){const r=`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(e+", Colombia")}.json?access_token=${iv_mapboxToken}&limit=1`;return fetch(r).then(l=>l.json()).then(l=>{if(!l.features||0===l.features.length)throw new Error("No se encontr\xf3 la ciudad");const[f,w]=l.features[0].center;return{lng:f,lat:w}})}onRegister(){if(this.registerForm.invalid)return void this.registerForm.markAllAsTouched();if(this.isSubmitting)return;this.isSubmitting=!0;const e=this.registerForm.value;if(null==e.latitude||null==e.longitude)return this.notificationService.error("Por favor selecciona una ubicaci\xf3n."),void(this.isSubmitting=!1);this.authService.register(e).subscribe({next:i=>{sessionStorage.setItem("Email",i.email),sessionStorage.setItem("UserId",i.id),this.notificationService.success("\xa1Registro exitoso!"),this.router.navigate(["/validate-account"])},error:i=>{const r=i.status;let l="Ocurri\xf3 un error. Intenta de nuevo.";400===r?l=i.error?.message||"Datos inv\xe1lidos.":409===r?l="El correo ya est\xe1 registrado.":500===r&&(l="Error interno del servidor."),this.notificationService.error(l),this.showMap=!1,this.isSubmitting=!1}})}backToForm(){this.showMap=!1}get fullNameInvalid(){const e=this.registerForm.get("fullName");return!!(e&&e.touched&&e.invalid)}get emailInvalid(){const e=this.registerForm.get("email");return!!(e&&e.touched&&e.invalid)}get passwordInvalid(){const e=this.registerForm.get("password");return!!(e&&e.touched&&e.invalid)}get dateBirthInvalid(){const e=this.registerForm.get("dateBirth");return!!(e&&e.touched&&e.invalid)}get cityOfResidenceInvalid(){const e=this.registerForm.get("cityOfResidence");return!!(e&&e.touched&&e.invalid)}get notificationRadiusInvalid(){const e=this.registerForm.get("notificationRadiusKm");return!!(e&&e.touched&&(e.invalid||e.value<=0))}pastDateValidator(){return e=>{const i=e.value;if(!i)return null;const r=new Date(i),l=new Date;return l.setHours(0,0,0,0),r>l?{futureDate:!0}:null}}goBack(){history.back()}static \u0275fac=function(i){return new(i||t)(ft(Bp),ft(Su),ft(Uc),ft(oo))};static \u0275cmp=kn({type:t,selectors:[["app-register"]],decls:9,vars:5,consts:[["mat-icon-button","","aria-label","Volver",1,"back-button",3,"click"],[1,"register-container"],[4,"ngIf"],[3,"ngSubmit","formGroup"],["class","loading-spinner",4,"ngIf"],[1,"field-group"],[1,"icon","fa","fa-user"],["type","text","placeholder","Nombre completo","formControlName","fullName"],["class","error-message",4,"ngIf"],[1,"icon","fa","fa-envelope"],["type","email","placeholder","Correo electr\xf3nico","formControlName","email"],[1,"icon","fa","fa-lock"],["type","password","placeholder","Contrase\xf1a","formControlName","password"],[1,"icon","fa","fa-calendar"],["type","date","formControlName","dateBirth"],[1,"icon","fa","fa-city"],["type","text","placeholder","Ciudad de residencia","formControlName","cityOfResidence"],[1,"icon","fa","fa-bullhorn"],["type","number","placeholder","Radio de notificaciones (Km)","formControlName","notificationRadiusKm"],["type","button",1,"submit-button",3,"click","disabled"],[1,"error-message"],[1,"loading-spinner"],["id","map_user"],["type","submit",1,"submit-button",3,"disabled"],["class","fas fa-spinner fa-spin me-2",4,"ngIf"],[1,"fas","fa-spinner","fa-spin","me-2"]],template:function(i,r){1&i&&(ae(0,"button",0),Tt("click",function(){return r.goBack()}),ae(1,"mat-icon"),Re(2,"arrow_back"),le()(),ae(3,"div",1),vt(4,Mee,2,0,"h2",2),ae(5,"form",3),Tt("ngSubmit",function(){return r.onRegister()}),vt(6,$ee,37,17,"div",2)(7,Gee,2,0,"div",4)(8,Wee,9,4,"div",2),le()()),2&i&&(xe(4),Xe("ngIf",!r.showMap),xe(),Xe("formGroup",r.registerForm),xe(),Xe("ngIf",!r.showMap),xe(),Xe("ngIf",r.isLoadingMap),xe(),Xe("ngIf",r.showMap))},dependencies:[Ea,Os,Vp,kh,dc,qC,Ad,Ah,el,Mu,z0,Up,kd],styles:["[_ngcontent-%COMP%]:root{--primary-bg: #e0f4fa;--primary-accent: #79b4d8;--primary-dark: #1e3a5f;--input-bg: #ffffff;--error-color: #e74c3c}.register-container[_ngcontent-%COMP%]{width:360px;background:var(--input-bg);margin:60px auto;padding:30px;border-radius:12px;text-align:center;box-shadow:0 4px 15px #0000001a;position:relative}.register-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:24px;margin:0 0 25px;color:var(--primary-dark)}.field-group[_ngcontent-%COMP%]{position:relative;margin-bottom:15px}.field-group[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{position:absolute;top:50%;left:12px;transform:translateY(-50%);color:var(--primary-accent);font-size:18px}.field-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:12px 12px 12px 40px;border:2px solid #ccc;border-radius:6px;font-size:14px;background:var(--input-bg);transition:border-color .2s ease;box-sizing:border-box}.field-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary-accent)}.error-message[_ngcontent-%COMP%]{text-align:left;color:var(--error-color);font-size:13px;margin:-10px 0 10px;padding-left:40px}.submit-button[_ngcontent-%COMP%]{width:100%;padding:12px;margin-top:3px;background:var(--primary-accent);color:#000;border:none;border-radius:6px;cursor:pointer;font-size:16px;font-weight:600;transition:background .3s ease,transform .2s ease;box-shadow:0 2px 8px #00000026}.submit-button[_ngcontent-%COMP%]:disabled{background:#aaa;color:#ccc;cursor:not-allowed}.submit-button[_ngcontent-%COMP%]:not(:disabled):hover{background:var(--primary-dark);transform:translateY(-2px)}.loading-spinner[_ngcontent-%COMP%]{font-size:16px;color:var(--primary-dark);margin:20px 0}#map_user[_ngcontent-%COMP%]{width:100%;height:400px;border:1px solid #ccc;border-radius:4px}.back-button[_ngcontent-%COMP%]{position:fixed;top:16px;left:16px;z-index:1000;background-color:#fff;border-radius:50%;box-shadow:0 2px 6px #0003}"]})}return t})();function Zee(t,n){1&t&&(ae(0,"div",14),Re(1," \u26a0 Email inv\xe1lido o vac\xedo "),le())}function Xee(t,n){1&t&&(ae(0,"div",14),Re(1," \u26a0 La contrase\xf1a es obligatoria. "),le())}function Kee(t,n){1&t&&Wt(0,"i",15)}function Qee(t,n){if(1&t){const e=_i();ae(0,"div",16)(1,"button",17),Tt("click",function(){return on(e),ln(Lt().sendCodePassword())}),Re(2," \xbfOlvidaste tu contrase\xf1a? "),le()()}if(2&t){const e=Lt();xe(),Xe("disabled",e.isSubmitting||e.isSendPassword)}}let Jee=(()=>{class t{fb;authService;router;notificationService;registerForm;loginErrorMessage="";showReetPassword=!1;isSubmitting=!1;isSendPassword=!1;constructor(e,i,r,l){this.fb=e,this.authService=i,this.router=r,this.notificationService=l,this.registerForm=this.fb.group({email:["",[bn.required,bn.email]],password:["",[bn.required]]})}onLogin(){if(this.registerForm.invalid)return void this.registerForm.markAllAsTouched();if(this.isSubmitting)return;this.isSubmitting=!0;const{email:e,password:i}=this.registerForm.value;this.authService.login({email:e,password:i}).subscribe({next:()=>{this.notificationService.success("\xa1Bienvenido!"),this.router.navigate(["/map"])},error:r=>{const l=this.getErrorMessage(r.status,r.error?.message);this.notificationService.error(l),l.includes("La cuenta no est\xe1 activada")&&(this.notificationService.error("La cuenta no est\xe1 activada, reenviando c\xf3digo de activaci\xf3n..."),this.resendCode()),this.isSubmitting=!1}})}getErrorMessage(e,i){switch(e){case 400:return this.showReetPassword=!0,i||"Campos inv\xe1lidos.";case 403:return"La cuenta no est\xe1 activada";case 404:return"Usuario no encontrado.";case 500:return"Error interno del servidor.";default:return"Ocurri\xf3 un error. Intenta de nuevo."}}sendCodePassword(){if(this.isSendPassword)return;const e=this.registerForm.value.email;e&&!this.registerForm.get("email")?.invalid?(this.isSendPassword=!0,this.authService.requestPasswordResetCode(e).subscribe({next:()=>{sessionStorage.setItem("email",e),this.notificationService.success("\u{1f4e9} C\xf3digo enviado al correo."),this.router.navigate(["/reset-password"])},error:i=>{switch(i.status){case 404:this.notificationService.error("\u274c Usuario no encontrado.");break;case 500:this.notificationService.error("\u26a0\ufe0f Error del servidor. Int\xe9ntalo m\xe1s tarde.");break;default:this.notificationService.error("Ocurri\xf3 un error. Int\xe9ntalo de nuevo.")}this.isSendPassword=!1}})):this.notificationService.error("Por favor ingresa un correo v\xe1lido.")}resendCode(){const e=this.registerForm.value.email;e?this.authService.sendCodeAgain(e).subscribe({next:()=>{this.router.navigate(["/validate-account"]),this.notificationService.success("\xa1C\xf3digo reenviado exitosamente!")},error:i=>{const r=i.status;let l="Ocurri\xf3 un error al reenviar el c\xf3digo.";404===r?l="Usuario no encontrado.":500===r&&(l="Error interno del servidor."),this.notificationService.error(l)}}):this.notificationService.error("No se encontr\xf3 el email del usuario.")}get emailInvalid(){const e=this.registerForm.get("email");return!!(e&&e.touched&&e.invalid)}get passwordInvalid(){const e=this.registerForm.get("password");return!!(e&&e.touched&&e.invalid)}static \u0275fac=function(i){return new(i||t)(ft(Bp),ft(Su),ft(oo),ft(Uc))};static \u0275cmp=kn({type:t,selectors:[["app-login"]],decls:21,vars:7,consts:[[1,"login-container"],["alt","MapHopper","src","logo.png",1,"logo"],["novalidate","",3,"formGroup"],[1,"field-group"],[1,"fa","fa-envelope","icon"],["type","email","id","email","placeholder","Correo","formControlName","email","name","email"],["class","error-message",4,"ngIf"],[1,"fa","fa-lock","icon"],["type","password","id","password","placeholder","Contrase\xf1a","formControlName","password","name","password"],["type","button",1,"submit-button",3,"click","disabled"],["class","fas fa-spinner fa-spin me-2",4,"ngIf"],[1,"register-link"],["routerLink","/register"],["class","resend-container",4,"ngIf"],[1,"error-message"],[1,"fas","fa-spinner","fa-spin","me-2"],[1,"resend-container"],["type","button",1,"resend-button",3,"click","disabled"]],template:function(i,r){1&i&&(ae(0,"div",0),Wt(1,"img",1),ae(2,"h2"),Re(3,"INICIAR SESI\xd3N"),le(),ae(4,"form",2)(5,"div",3),Wt(6,"i",4)(7,"input",5),le(),vt(8,Zee,2,0,"div",6),ae(9,"div",3),Wt(10,"i",7)(11,"input",8),le(),vt(12,Xee,2,0,"div",6),ae(13,"button",9),Tt("click",function(){return r.onLogin()}),vt(14,Kee,1,0,"i",10),Re(15),le(),ae(16,"p",11),Re(17," \xbfNo tienes una cuenta? "),ae(18,"a",12),Re(19,"Reg\xedstrate aqu\xed"),le()()(),vt(20,Qee,3,1,"div",13),le()),2&i&&(xe(4),Xe("formGroup",r.registerForm),xe(4),Xe("ngIf",r.emailInvalid),xe(4),Xe("ngIf",r.passwordInvalid),xe(),Xe("disabled",r.registerForm.invalid||r.isSubmitting),xe(),Xe("ngIf",r.isSubmitting),xe(),Ci(" ",r.isSubmitting?"Ingresando...":"Ingresar"," "),xe(5),Xe("ngIf",r.showReetPassword))},dependencies:[Vp,kh,dc,Ad,Ah,el,Mu,Os,z0,xC],styles:["[_ngcontent-%COMP%]:root{--primary-bg: #e0f4fa;--primary-accent: #79b4d8;--primary-dark: #1e3a5f;--input-bg: #ffffff;--error-color: #e74c3c}body[_ngcontent-%COMP%]{background-color:var(--primary-bg);font-family:Segoe UI,sans-serif;color:var(--primary-dark)}.login-container[_ngcontent-%COMP%]{width:360px;background:var(--input-bg);margin:60px auto;padding:30px;border-radius:12px;text-align:center;box-shadow:0 4px 15px #0000001a;position:relative}.logo[_ngcontent-%COMP%]{width:80px;margin:0 auto 20px;display:block}h2[_ngcontent-%COMP%]{font-size:24px;margin:0 0 25px;color:var(--primary-dark)}.field-group[_ngcontent-%COMP%]{position:relative;margin-bottom:15px}.field-group[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{position:absolute;top:50%;left:12px;transform:translateY(-50%);color:var(--primary-accent);font-size:18px}.field-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:12px 12px 12px 40px;border:2px solid #ccc;border-radius:6px;font-size:14px;background:var(--input-bg);transition:border-color .2s ease;box-sizing:border-box}.field-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary-accent)}.error-message[_ngcontent-%COMP%]{text-align:left;color:var(--error-color);font-size:13px;margin:-10px 0 10px;padding-left:40px}.submit-button[_ngcontent-%COMP%]{width:100%;padding:12px;background:var(--primary-accent);color:#000;border:none;border-radius:6px;cursor:pointer;font-size:16px;font-weight:600;transition:background .3s ease,transform .2s ease;box-shadow:0 2px 8px #00000026}.submit-button[_ngcontent-%COMP%]:disabled{background:#aaa;cursor:not-allowed;color:#ccc}.submit-button[_ngcontent-%COMP%]:not(:disabled):hover{background:var(--primary-dark);transform:translateY(-2px);color:#000}.register-link[_ngcontent-%COMP%]{margin-top:18px;font-size:14px}.register-link[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--primary-accent);text-decoration:none;font-weight:600}.register-link[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}.resend-container[_ngcontent-%COMP%]{margin-top:20px}.resend-button[_ngcontent-%COMP%]{padding:10px 16px;background:var(--primary-bg);color:var(--primary-dark);border:2px solid var(--primary-accent);border-radius:6px;cursor:pointer;font-size:14px;font-weight:500;transition:background .3s ease,transform .2s ease;display:inline-flex;align-items:center;gap:8px}.resend-button[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.resend-button[_ngcontent-%COMP%]:not(:disabled):hover{background:var(--primary-accent);color:var(--input-bg);transform:translateY(-1px)}"]})}return t})();var Rd=6371008.8,h5={centimeters:100*Rd,centimetres:100*Rd,degrees:360/(2*Math.PI),feet:3.28084*Rd,inches:39.37*Rd,kilometers:Rd/1e3,kilometres:Rd/1e3,meters:Rd,metres:Rd,miles:Rd/1609.344,millimeters:1e3*Rd,millimetres:1e3*Rd,nauticalmiles:Rd/1852,radians:1,yards:1.0936*Rd};function ov(t,n,e={}){const i={type:"Feature"};return(0===e.id||e.id)&&(i.id=e.id),e.bbox&&(i.bbox=e.bbox),i.properties=n||{},i.geometry=t,i}function KR(t){return t%(2*Math.PI)*180/Math.PI}function sv(t){return t%360*Math.PI/180}function QR(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}function JR(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if("Feature"===t.type&&null!==t.geometry&&"Point"===t.geometry.type)return[...t.geometry.coordinates];if("Point"===t.type)return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function rte(t,n,e,i={}){const r=JR(t),l=sv(r[0]),f=sv(r[1]),w=sv(e),M=function XR(t,n="kilometers"){const e=h5[n];if(!e)throw new Error(n+" units is invalid");return t/e}(n,i.units),P=Math.asin(Math.sin(f)*Math.cos(M)+Math.cos(f)*Math.sin(M)*Math.cos(w));return function WR(t,n,e={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!QR(t[0])||!QR(t[1]))throw new Error("coordinates must contain numbers");return ov({type:"Point",coordinates:t},n,e)}([KR(l+Math.atan2(Math.sin(w)*Math.sin(M)*Math.cos(f),Math.cos(M)-Math.sin(f)*Math.sin(P))),KR(P)],i.properties)}function g5(t,n,e={}){const i=e.steps||64,r=e.properties?e.properties:!Array.isArray(t)&&"Feature"===t.type&&t.properties?t.properties:{},l=[];for(let f=0;f<i;f++)l.push(rte(t,n,-360*f/i,e).geometry.coordinates);return l.push(l[0]),function YR(t,n,e={}){for(const r of t){if(r.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(r[r.length-1].length!==r[0].length)throw new Error("First and last Position are not equivalent.");for(let l=0;l<r[r.length-1].length;l++)if(r[r.length-1][l]!==r[0][l])throw new Error("First and last Position are not equivalent.")}return ov({type:"Polygon",coordinates:t},n,e)}([l],r)}let ZC=(()=>{class t{http;apiUrl=`${Cu_urlBack}/categories`;cetegorySubject=new pn([]);categories$=this.cetegorySubject.asObservable();constructor(e){this.http=e}getAllActiveCategories(){return this.http.get(this.apiUrl,{withCredentials:!0}).pipe(Rr(e=>{this.cetegorySubject.next(e)}))}getAllCategories(){return this.http.get(`${this.apiUrl}/all`,{withCredentials:!0}).pipe(Rr(e=>{this.cetegorySubject.next(e)}))}addCategory(e){return this.http.post(this.apiUrl,e,{withCredentials:!0})}toggleCategoryActivation(e){return this.http.patch(`${this.apiUrl}/${e}/toggle-activated`,{},{withCredentials:!0})}getCategoryById(e){return this.http.get(`${this.apiUrl}/${e}`,{withCredentials:!0})}updateCategory(e,i){return this.http.put(`${this.apiUrl}/${e}`,i,{withCredentials:!0})}static \u0275fac=function(i){return new(i||t)(gn(Eu))};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),ote=(()=>{class t{http;uploadPreset="default";constructor(e){this.http=e}uploadImage(e){const r=new FormData;return r.append("file",e),r.append("upload_preset",this.uploadPreset),r.append("api_key","173283854338116"),this.http.post("https://api.cloudinary.com/v1_1/dxospqsu0/image/upload",r)}static \u0275fac=function(i){return new(i||t)(gn(Eu))};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),ste=(()=>{class t{http;cloudinaryService;apiUrl=`${Cu_urlBack}/images`;constructor(e,i){this.http=e,this.cloudinaryService=i}registerImage(e,i){this.cloudinaryService.uploadImage(e).subscribe({next:r=>{console.log("Imagen subida:",r),i.id&&this.http.post(`${this.apiUrl}`,{imageUrl:r.url,reportId:i.id},{withCredentials:!0}).subscribe({next:f=>{console.log("Imagen registrada en el reporte:",f)},error:f=>{console.error("Error registrando la imagen en el reporte:",f)}})},error:r=>{console.error("Error subiendo la imagen  cloudinary:",r)}})}deleteImage(e){this.http.delete(`${this.apiUrl}/${e}`).subscribe({next:i=>{console.log("Imagen eliminada:",i)},error:i=>{console.error("Error eliminando la imagen:",i)}})}static \u0275fac=function(i){return new(i||t)(gn(Eu),gn(ote))};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),q0=(()=>{class t{http;imageService;apiUrl=`${Cu_urlBack}/reports`;selectedReportSource=new pn(null);selectedReport$=this.selectedReportSource.asObservable();reportsSubject=new pn([]);reports$=this.reportsSubject.asObservable();toggleVote(e){return this.http.patch(`${this.apiUrl}/${e}/votes`,{},{withCredentials:!0})}constructor(e,i){this.http=e,this.imageService=i}selectReport(e){this.selectedReportSource.next(e)}createReport(e,i){return this.http.post(this.apiUrl,e,{withCredentials:!0}).pipe(Rr(r=>{console.log("Reporte creado:",r),this.imageService.registerImage(i,r)}))}getReports(){let e=new kl;return e=e.set("latitud",sessionStorage.getItem("lat")||""),e=e.set("longitud",sessionStorage.getItem("lng")||""),e=e.set("radio",sessionStorage.getItem("radiusKm")||""),this.http.get(`${this.apiUrl}`,{params:e,withCredentials:!0}).pipe(Rr(i=>{this.reportsSubject.next(i.content)}))}refreshReports(){this.getReports().subscribe()}getReportById(e){return this.http.get(`${this.apiUrl}/${e}`,{withCredentials:!0}).pipe(Kr(this.handleError))}getAllImagesReportById(e){return this.http.get(`${this.apiUrl}/${e}/images`,{withCredentials:!0}).pipe(Kr(this.handleError))}getAllCommentsReportById(e){return this.http.get(`${this.apiUrl}/${e}/comments`,{withCredentials:!0}).pipe(Kr(this.handleError))}updateReport(e,i,r){return console.log(i),r&&this.getAllImagesReportById(e).subscribe(l=>{l.forEach(f=>{this.imageService.deleteImage(f.id)}),this.imageService.registerImage(r,{id:e})}),this.http.put(`${this.apiUrl}/${e}`,i,{withCredentials:!0}).pipe(Kr(this.handleError))}deleteReport(e){return this.http.delete(`${this.apiUrl}/${e}`,{withCredentials:!0}).pipe(Kr(this.handleError))}resolveReport(e){return this.http.patch(`${this.apiUrl}/${e}/resolve`,{withCredentials:!0}).pipe(Kr(this.handleError))}updateReportStatus(e,i,r){return this.http.patch(`${this.apiUrl}/${e}/status`,{status:i,rejectionMessage:r??null},{withCredentials:!0})}getMyReportsPaginated(e=1,i=10,r){let l=(new kl).set("page",e).set("size",i);return this.http.get(`${this.apiUrl}/my`,{params:l,withCredentials:!0}).pipe(an(f=>{const w=f.content.map(M=>({...M,createdAt:new Date(M.createdAt),updatedAt:M.updatedAt?new Date(M.updatedAt):void 0,resolvedAt:M.resolvedAt?new Date(M.resolvedAt):void 0}));return{...f,content:w}}),Rr(f=>{console.log(`Reportes cargados: p\xe1gina ${f.page} de ${f.totalPages}, elementos totales: ${f.totalElements}`)}),Kr(f=>(console.error("Error al obtener reportes paginados",f),ra(()=>f))))}getAllReportsPaginated(e=1,i=10,r){let l=(new kl).set("page",e).set("size",i);return r&&(l=l.set("status",r)),this.http.get(`${this.apiUrl}/admin`,{params:l,withCredentials:!0}).pipe(an(f=>{const w=f.content.map(M=>({...M,createdAt:new Date(M.createdAt),updatedAt:M.updatedAt?new Date(M.updatedAt):void 0,resolvedAt:M.resolvedAt?new Date(M.resolvedAt):void 0}));return{...f,content:w}}),Rr(f=>{console.log(`Reportes cargados: p\xe1gina ${f.page} de ${f.totalPages}, elementos totales: ${f.totalElements}`)}),Kr(f=>(console.error("Error al obtener reportes paginados",f),ra(()=>f))))}handleError(e){return console.error("Ocurri\xf3 un error en ReportService:",e),ra(()=>new Error("Error en la operaci\xf3n del reporte. Intenta de nuevo."))}static \u0275fac=function(i){return new(i||t)(gn(Eu),gn(ste))};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();const ate=(t,n)=>({"star-gray":t,"star-yellow":n});function lte(t,n){if(1&t&&(ae(0,"option",10),Re(1),le()),2&t){const e=n.$implicit;Xe("value",e.name),xe(),er(e.name)}}function cte(t,n){if(1&t){const e=_i();ae(0,"li")(1,"div",11),Tt("click",function(){const r=on(e).$implicit;return ln(Lt().flyToReport(r))}),ae(2,"strong"),Re(3),le(),Re(4),ae(5,"p",12)(6,"mat-icon",13),Re(7,"star "),le(),Re(8),le(),ae(9,"p"),Re(10),le()()()}if(2&t){const e=n.$implicit,i=Lt();xe(3),er(e.title),xe(),Ci(" (",i.getCategoryNames(e),") "),xe(2),Xe("ngClass",function JL(t,n,e,i,r){return tN(xt(),fs(),t,n,e,i,r)}(6,ate,0===e.importantVotes,e.importantVotes>0)),xe(2),Py(" ",e.importantVotes||0," voto",1===e.importantVotes?"":"s"," importantes "),xe(2),Ci("descripci\xf3n: ",e.description,"")}}function dte(t,n){1&t&&(ae(0,"li"),Re(1," No hay reportes para mostrar con el filtro actual. "),le())}let ute=(()=>{class t{categoryService;reportService;router;actionFilterReport=new $e;categories=[];allReports=[];filteredReports=[];selectedCategory="";constructor(e,i,r){this.categoryService=e,this.reportService=i,this.router=r}ngOnInit(){this.reportService.reports$.subscribe(e=>{this.allReports=e,this.filteredReports=this.sortByVotesDesc(this.allReports)}),this.loadCategories(),this.categoryService.categories$.subscribe(e=>{this.categories=e})}loadCategories(){this.categoryService.getAllActiveCategories().subscribe()}sortByVotesDesc(e){return[...e].sort((i,r)=>(r.importantVotes||0)-(i.importantVotes||0))}filterReports(e){this.selectedCategory=e;const i=e?this.allReports.filter(r=>r.categoryList?.some(l=>l.name===e)):[...this.allReports];this.filteredReports=this.sortByVotesDesc(i),this.actionFilterReport.emit(this.filteredReports)}flyToReport(e){this.reportService.selectReport(e)}editReport(e){e&&this.router.navigate(["/report/edit",e])}searchAddress(e){console.log("Buscar direcci\xf3n:",e)}getCategoryNames(e){return e.categoryList&&0!==e.categoryList.length?e.categoryList.map(i=>i.name).join(", "):"Sin categor\xeda"}static \u0275fac=function(i){return new(i||t)(ft(ZC),ft(q0),ft(oo))};static \u0275cmp=kn({type:t,selectors:[["report-categories-filter"]],outputs:{actionFilterReport:"actionFilterReport"},decls:14,vars:3,consts:[["categorySelect",""],[1,"report-panel"],[1,"filter-section"],["for","category-filter"],["id","category-filter",3,"change"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"report-list"],[4,"ngFor","ngForOf"],[4,"ngIf"],[3,"value"],[2,"cursor","pointer",3,"click"],[1,"important-votes"],[1,"star-icon",3,"ngClass"]],template:function(i,r){if(1&i){const l=_i();ae(0,"div",1)(1,"h3"),Re(2,"Reportes"),le(),ae(3,"div",2)(4,"label",3),Re(5,"Filtrar por categor\xeda:"),le(),ae(6,"select",4,0),Tt("change",function(){on(l);const w=Ed(7);return ln(r.filterReports(w.value))}),ae(8,"option",5),Re(9,"Todos"),le(),vt(10,lte,2,2,"option",6),le()(),ae(11,"ul",7),vt(12,cte,11,9,"li",8)(13,dte,2,0,"li",9),le()()}2&i&&(xe(10),Xe("ngForOf",r.categories),xe(2),Xe("ngForOf",r.filteredReports),xe(),Xe("ngIf",0===r.filteredReports.length))},dependencies:[Ea,im,kg,Os,kd],styles:[".report-panel[_ngcontent-%COMP%]{width:300px;min-width:300px;max-width:300px;height:100vh;background-color:#f8f9fa;padding:15px;border-right:1px solid #dee2e6;display:flex;flex-direction:column;overflow:hidden;box-sizing:border-box}.filter-section[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%;padding:8px;border:1px solid #ced4da;border-radius:4px;box-sizing:border-box}.report-panel[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{max-width:100%;word-wrap:break-word;overflow-wrap:break-word}.report-list[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0;overflow-y:auto;flex:1;min-height:0}.report-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:10px;border-bottom:1px solid #eee;cursor:pointer;transition:background-color .2s ease}.report-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover{background-color:#e9ecef}.report-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:block;font-size:1em;margin-bottom:3px}.report-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.85em;color:#6c757d;margin:0;word-wrap:break-word;overflow-wrap:break-word}.report-list[_ngcontent-%COMP%]   .star-icon.star-gray[_ngcontent-%COMP%]{color:gray!important}.report-list[_ngcontent-%COMP%]   .star-icon.star-yellow[_ngcontent-%COMP%]{color:gold!important}"]})}return t})(),hte=(()=>{class t{http;apiUrl=`${Cu_urlBack}/comments`;constructor(e){this.http=e}registerComments(e){return this.http.post(`${this.apiUrl}`,e,{withCredentials:!0})}static \u0275fac=function(i){return new(i||t)(gn(Eu))};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function pte(t,n){if(1&t&&(ae(0,"swiper-slide"),Wt(1,"img",23),le()),2&t){const e=n.$implicit,i=Lt(3);xe(),Xe("src",e.imageUrl,vp)("alt",i.report.title)}}function fte(t,n){if(1&t&&(ae(0,"div",20)(1,"swiper-container",21),vt(2,pte,2,2,"swiper-slide",22),le()()),2&t){const e=Lt(2);xe(2),Xe("ngForOf",e.report.images)}}function mte(t,n){1&t&&(ae(0,"div",24),Re(1,"No hay im\xe1genes disponibles"),le())}function gte(t,n){if(1&t&&(ae(0,"div",25)(1,"div",26)(2,"mat-icon"),Re(3,"person"),le(),ae(4,"strong"),Re(5),le()(),ae(6,"p"),Re(7),le()()),2&t){const e=n.$implicit;xe(5),er(e.userName),xe(2),er(e.comment)}}function _te(t,n){if(1&t){const e=_i();ae(0,"div",2)(1,"div",3)(2,"button",4),Tt("click",function(){return on(e),ln(Lt().close.emit())}),ae(3,"mat-icon"),Re(4,"close"),le()(),ae(5,"div",5)(6,"h2",6),Re(7),le(),vt(8,fte,3,1,"div",7)(9,mte,2,0,"ng-template",null,0,q1),le(),ae(11,"div",8)(12,"p",9)(13,"strong"),Re(14,"Categor\xedas:"),le(),Re(15),le(),ae(16,"p",10),Re(17),le(),ae(18,"div",11)(19,"button",12),Tt("click",function(){on(e);const r=Lt();return ln(r.toggleVote(r.report))}),ae(20,"mat-icon",13),Re(21,"star"),le(),Re(22," Es importante "),le(),ae(23,"div",14),Re(24),le()(),ae(25,"div",15)(26,"h3"),Re(27,"Comentarios"),le(),vt(28,gte,8,2,"div",16),ae(29,"div",17)(30,"textarea",18),Fy("ngModelChange",function(r){on(e);const l=Lt();return E0(l.newComment,r)||(l.newComment=r),ln(r)}),le(),ae(31,"button",19),Tt("click",function(){return on(e),ln(Lt().addComment())}),Re(32,"Comentar"),le()()()()()()}if(2&t){const e=Ed(10),i=Lt();xe(7),er(i.report.title),xe(),Xe("ngIf",null==i.report.images?null:i.report.images.length)("ngIfElse",e),xe(7),Ci(" ",i.getCategoryNames(),""),xe(2),er(i.report.description),xe(3),Xe("ngClass",i.hasVoted?"star-yellow":"star-gray"),xe(4),Ci(" ",i.report.importantVotes," Votos "),xe(4),Xe("ngForOf",i.report.comments),xe(2),Oy("ngModel",i.newComment)}}let yte=(()=>{class t{reportService;commentService;report=null;close=new $e;newComment="";hasVoted=!1;constructor(e,i){this.reportService=e,this.commentService=i}ngOnInit(){this.report?.id&&this.loadComments(this.report.id)}loadComments(e){this.reportService.getAllCommentsReportById(e).subscribe({next:i=>{i.size>0&&this.report&&(this.report.comments=i.content)}})}addComment(){if(this.report?.id&&this.newComment.trim()){const e={reportId:this.report.id,comment:this.newComment.trim()};this.commentService.registerComments(e).subscribe({next:i=>{this.report?.comments?.push(i),this.newComment=""},error:i=>console.error(i)})}}toggleVote(e){e.id?this.reportService.toggleVote(e.id).subscribe({next:i=>{e.importantVotes=(e.importantVotes||0)+(i?1:-1),this.hasVoted=i},error:i=>{console.error("Error al alternar voto:",i)}}):console.error("El reporte no tiene ID definido, no se puede alternar el voto.")}getCategoryNames(){return this.report?.categoryList?.map(e=>e.name).join(", ")||"Sin categor\xeda"}static \u0275fac=function(i){return new(i||t)(ft(q0),ft(hte))};static \u0275cmp=kn({type:t,selectors:[["report-details-overlay"]],inputs:{report:"report"},outputs:{close:"close"},decls:1,vars:1,consts:[["noImages",""],["class","report-overlay",4,"ngIf"],[1,"report-overlay"],[1,"report-details"],[1,"close-btn",3,"click"],[1,"fixed-section"],[1,"title"],["class","image-carousel",4,"ngIf","ngIfElse"],[1,"scroll-section"],[1,"category"],[1,"description"],[1,"actions"],[1,"toggle-vote-btn",3,"click"],[3,"ngClass"],[1,"votes"],[1,"comments-section"],["class","comment",4,"ngFor","ngForOf"],[1,"add-comment"],["placeholder","Agregar un comentario",3,"ngModelChange","ngModel"],[1,"btn-primary",3,"click"],[1,"image-carousel"],["navigation","true","pagination","true","loop","true"],[4,"ngFor","ngForOf"],[3,"src","alt"],[1,"no-images"],[1,"comment"],[1,"comment-header"]],template:function(i,r){1&i&&vt(0,_te,33,9,"div",1),2&i&&Xe("ngIf",r.report)},dependencies:[Ea,im,kg,Os,MT,dc,Ad,CT,Up,kd],styles:[".report-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#0009;display:flex;justify-content:center;align-items:center;z-index:1000;padding:1rem;overflow-y:auto}.report-details[_ngcontent-%COMP%]{background:#fff;border-radius:12px;width:90%;max-width:800px;height:90vh;display:flex;flex-direction:column;box-shadow:0 8px 24px #0003;position:relative;overflow:hidden;box-sizing:border-box;padding:1rem}.close-btn[_ngcontent-%COMP%]{position:absolute;top:.75rem;right:.75rem;background:none;border:none;font-size:1.25rem;cursor:pointer;color:#555;transition:color .2s}.close-btn[_ngcontent-%COMP%]:hover{color:#000}.fixed-section[_ngcontent-%COMP%]{flex:0 0 auto}.title[_ngcontent-%COMP%]{margin:0 0 .75rem;font-size:1.75rem;text-align:center;color:#333}.image-carousel[_ngcontent-%COMP%]{width:100%;height:180px;border-radius:8px;overflow:hidden;margin-bottom:1rem}.image-carousel[_ngcontent-%COMP%]   swiper-container[_ngcontent-%COMP%]{width:100%;height:100%}.image-carousel[_ngcontent-%COMP%]   swiper-slide[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.image-carousel[_ngcontent-%COMP%]   swiper-slide[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.scroll-section[_ngcontent-%COMP%]{flex:1 1 auto;overflow-y:auto;padding-right:.5rem;display:flex;flex-direction:column;gap:1rem}.no-images[_ngcontent-%COMP%]{font-style:italic;color:#888;text-align:center}.category[_ngcontent-%COMP%], .description[_ngcontent-%COMP%]{font-size:1rem;color:#555}.category[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#333}.actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.toggle-vote-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.3rem;background:linear-gradient(135deg,#f9a825,#ffd54f);border:none;padding:.5rem 1rem;border-radius:24px;font-weight:700;color:#333;cursor:pointer;box-shadow:0 2px 6px #00000026;transition:transform .1s,box-shadow .1s}.toggle-vote-btn[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 12px #0003}.toggle-vote-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:1.2rem}.votes[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.3rem;color:#666}.votes[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#1976d2}.comments-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1.25rem;color:#333}.comment[_ngcontent-%COMP%]{padding:.75rem 0;border-bottom:1px solid #eee}.comment-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-size:.9rem;color:#444}.comment-header[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:1rem;color:#888}.comment[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.25rem 0 0;font-size:.95rem;color:#555}.add-comment[_ngcontent-%COMP%]{margin-top:auto}.add-comment[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{width:97%;min-height:80px;padding:.75rem;border:1px solid #ccc;border-radius:6px;resize:vertical;font-size:1rem;margin-bottom:.5rem}.add-comment[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%]{background-color:#1976d2;color:#fff;border:none;padding:.5rem 1rem;border-radius:6px;cursor:pointer;transition:background-color .2s}.add-comment[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%]:hover{background-color:#155fa0}.star-yellow[_ngcontent-%COMP%]{color:gold}.star-gray[_ngcontent-%COMP%]{color:gray}"]})}return t})();function vte(t,n){if(1&t){const e=_i();ae(0,"report-details-overlay",9),Tt("close",function(){return on(e),ln(Lt().selectedReport=null)}),le()}2&t&&Xe("report",Lt().selectedReport)}let bte=(()=>{class t{reportService;authService;mapa;markers=[];platformId=te(cu);allReports=[];selectedReport=null;reportClicked=new $e;constructor(e,i){this.reportService=e,this.authService=i}ngOnInit(){this.reportService.reports$.subscribe(e=>{this.allReports=e,this.loadImage()}),this.authService.getCurrentUser().subscribe({next:e=>{this.loadReports(),Rp(this.platformId)&&this.initializeMap([e.longitude,e.latitude])},error:()=>{this.loadReports(),Rp(this.platformId)&&this.initializeMap([-75.681,4.533])}}),this.reportService.selectedReport$.subscribe(e=>{this.selectedReport=e,e&&this.flyToReport(e)})}ngOnDestroy(){this.mapa?.remove()}loadReports(){this.reportService.getReports().subscribe({error:e=>console.error("Error reportes",e)})}initializeMap(e){this.mapa||(this.mapa=new(ss().Map)({accessToken:iv_mapboxToken,container:"map",style:"mapbox://styles/mapbox/streets-v11",center:e,zoom:12}),this.addUserMarker(e),this.mapa.addControl(new(ss().NavigationControl),"bottom-right"),this.mapa.addControl(new(ss().ScaleControl)({maxWidth:100,unit:"metric"})),this.mapa.on("load",()=>{this.mapa.resize(),this.updateMarkers(this.allReports),this.drawUserRadius(e)}),this.mapa.on("error",i=>console.error("Mapbox error",i)))}drawUserRadius(e){const r=g5(e,parseFloat(sessionStorage.getItem("radiusKm")||"1"),{steps:64,units:"kilometers"});this.mapa.getSource("user-radius")?this.mapa.getSource("user-radius").setData(r):(this.mapa.addSource("user-radius",{type:"geojson",data:r}),this.mapa.addLayer({id:"user-radius-fill",type:"fill",source:"user-radius",paint:{"fill-color":"#007BFF","fill-opacity":.15}}),this.mapa.addLayer({id:"user-radius-outline",type:"line",source:"user-radius",paint:{"line-color":"#007BFF","line-width":2}}))}addUserMarker(e){const i=document.createElement("div");i.className="user-marker",i.style.backgroundImage="url(user.ico)",i.style.width="40px",i.style.height="40px",i.style.backgroundSize="contain",new(ss().Marker)(i).setLngLat(e).setPopup((new(ss().Popup)).setText("Tu ubicaci\xf3n")).addTo(this.mapa)}clearMarkers(){this.markers.forEach(e=>e.remove()),this.markers=[]}updateMarkers(e){if(this.mapa){if(this.clearMarkers(),!this.mapa||!this.mapa.isStyleLoaded())return void console.warn("Map is not ready yet. Skipping marker update.");e.forEach(i=>{const r=new(ss().Popup)({closeButton:!1,closeOnMove:!0,anchor:"bottom",offset:[0,-20]}).setHTML(`\n                <div class="report-popup">\n                  <div class="popup-content">\n                    <div class="popup-image">\n                      <img src="${i.images&&i.images.length>0?i.images[0].imageUrl:"placeholder.png"}" alt="${i.title}" />\n                    </div>\n                    <div class="popup-info">\n                      <h6 class="popup-title">${i.title}</h6>\n                      <p class="popup-votes">${i.importantVotes} votos</p>\n                    </div>\n                  </div>\n                </div>\n              `),l=(new(ss().Marker)).setLngLat([i.longitude,i.latitude]).setDraggable(!1).setPopup(r).addTo(this.mapa);l.getElement().addEventListener("mouseenter",()=>{r.addTo(this.mapa)}),l.getElement().addEventListener("mouseleave",()=>{r.remove()}),l.getElement().addEventListener("click",()=>{this.selectedReport=i}),this.markers.push(l)})}}flyToReport(e){e&&this.mapa.flyTo({center:[e.longitude,e.latitude],zoom:15,essential:!0})}searchAddress(e){console.log("Buscar direcci\xf3n:",e)}loadImage(){for(const e of this.allReports)e.id&&this.reportService.getAllImagesReportById(e.id).subscribe({next:i=>{i.length>0&&e&&(e.images=i)}})}static \u0275fac=function(i){return new(i||t)(ft(q0),ft(Su))};static \u0275cmp=kn({type:t,selectors:[["app-map-view"]],outputs:{reportClicked:"reportClicked"},decls:10,vars:1,consts:[["searchInput",""],[1,"map-view-container"],[3,"actionFilterReport"],[3,"report","close",4,"ngIf"],[1,"map-panel"],[1,"search-bar"],["type","text","placeholder","Buscar direcci\xf3n..."],[3,"click"],["id","map",1,"map"],[3,"close","report"]],template:function(i,r){if(1&i){const l=_i();ae(0,"div",1)(1,"report-categories-filter",2),Tt("actionFilterReport",function(w){return on(l),ln(r.updateMarkers(w))}),le(),vt(2,vte,1,1,"report-details-overlay",3),ae(3,"div",4)(4,"div",5),Wt(5,"input",6,0),ae(7,"button",7),Tt("click",function(){on(l);const w=Ed(6);return ln(r.searchAddress(w.value))}),Re(8,"\u{1f50d}"),le()(),Wt(9,"div",8),le()()}2&i&&(xe(2),Xe("ngIf",r.selectedReport))},dependencies:[Ea,Os,ute,yte],styles:[".map-view-container[_ngcontent-%COMP%]{display:flex;width:100%;height:100vh;overflow:hidden}.map-panel[_ngcontent-%COMP%]{flex-grow:1;position:relative;display:flex;flex-direction:column}.map[_ngcontent-%COMP%]{width:100%;flex-grow:1;height:100%}.search-bar[_ngcontent-%COMP%]{position:absolute;top:10px;left:10px;transform:none;z-index:10;display:flex;background:#fff;padding:5px;border-radius:5px;box-shadow:0 2px 4px #0003}.search-bar[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border:none;padding:5px}.search-bar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border:none;background:none;cursor:pointer;padding:5px}.star-icon[_ngcontent-%COMP%]{vertical-align:middle;font-size:20px;margin-right:4px}.star-gray[_ngcontent-%COMP%]{color:gray}.star-yellow[_ngcontent-%COMP%]{color:gold}.important-votes[_ngcontent-%COMP%]{display:flex;align-items:center;margin:4px 0}"]})}return t})(),av=(()=>{class t{authService;router;constructor(e,i){this.authService=e,this.router=i}canActivate(){return console.log("call canActivate"),this.authService.isLoggedIn().pipe(an(e=>!!e||this.router.createUrlTree(["/login"])),Kr(()=>Fn(this.router.createUrlTree(["/login"]))))}static \u0275fac=function(i){return new(i||t)(gn(Su),gn(oo))};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function _5(t=0,n=WM){return t<0&&(t=0),lV(t,t,n)}const xte=["digitInput"];function wte(t,n){1&t&&Wt(0,"i",20)}function Cte(t,n){1&t&&Wt(0,"i",21)}function Ete(t,n){if(1&t&&(ae(0,"span"),Re(1),le()),2&t){const e=Lt();xe(),Ci("Reenviar en ",e.formattedTime,"")}}function Ste(t,n){1&t&&(ae(0,"span"),Re(1,"Reenviar C\xf3digo"),le())}let y5=(()=>{class t{fb=te(Bp);router=te(oo);notificationService=te(Uc);authService=te(Su);isSubmitting=!1;isResend=!1;digitInputs;verificationForm=this.fb.group({digit0:new qo(null,[bn.required,bn.pattern(/^\d$/)]),digit1:new qo(null,[bn.required,bn.pattern(/^\d$/)]),digit2:new qo(null,[bn.required,bn.pattern(/^\d$/)]),digit3:new qo(null,[bn.required,bn.pattern(/^\d$/)]),digit4:new qo(null,[bn.required,bn.pattern(/^\d$/)]),digit5:new qo(null,[bn.required,bn.pattern(/^\d$/)])});resendDisabled=!1;secondsLeft=0;countdownSub;ngOnInit(){}ngOnDestroy(){this.countdownSub?.unsubscribe()}submitCode(){if(this.verificationForm.invalid)return this.notificationService.error("Por favor completa todos los campos del c\xf3digo."),void this.verificationForm.markAllAsTouched();if(this.isSubmitting)return;this.isSubmitting=!0;const e=Object.values(this.verificationForm.value).join("");this.authService.validateAccount(e).subscribe({next:()=>{this.notificationService.success("\u2705 Cuenta validada exitosamente"),sessionStorage.removeItem("Email"),this.router.navigate(["/login"])},error:i=>{console.error("Error completo al validar cuenta:",i);const r=i.status;let l="Ocurri\xf3 un error al validar la cuenta.";if(400===r){let f;try{f="string"==typeof i.error?JSON.parse(i.error):i.error}catch{f={message:i.error}}const w=f.message?.toLowerCase()??"";l=w.includes("c\xf3digo inv\xe1lido")?"El c\xf3digo es inv\xe1lido.":w.includes("expirado")?"El c\xf3digo ha expirado.":w||"Solicitud incorrecta."}else 500===r&&(l="Error interno del servidor.");this.notificationService.error(l),this.isSubmitting=!1}})}resendCode(){if(this.resendDisabled||this.isSubmitting||this.isResend)return;this.isResend=!0;const e=sessionStorage.getItem("email");e?this.authService.sendCodeAgain(e).subscribe({next:()=>{this.startCountdown(),this.notificationService.success("\xa1C\xf3digo reenviado exitosamente!"),this.isResend=!1},error:i=>{const r=i.status;let l="Ocurri\xf3 un error al reenviar el c\xf3digo.";404===r?l="Usuario no encontrado.":500===r&&(l="Error interno del servidor."),this.notificationService.error(l),this.isResend=!1}}):this.notificationService.error("No se encontr\xf3 el email del usuario.")}startCountdown(){this.countdownSub?.unsubscribe(),this.resendDisabled=!0,this.secondsLeft=120,this.countdownSub=_5(1e3).pipe(rR(()=>this.secondsLeft>0)).subscribe(()=>{this.secondsLeft--,0===this.secondsLeft&&(this.resendDisabled=!1)})}get formattedTime(){return`${Math.floor(this.secondsLeft/60).toString().padStart(2,"0")}:${(this.secondsLeft%60).toString().padStart(2,"0")}`}onCodeInput(e,i){const l=e.target.value.replace(/\D/g,"").slice(0,1);this.verificationForm.controls[`digit${i}`].setValue(l,{emitEvent:!1}),l&&i<this.digitInputs.length-1&&this.digitInputs.toArray()[i+1].nativeElement.focus()}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=kn({type:t,selectors:[["app-verification"]],viewQuery:function(i,r){if(1&i&&kr(xte,5),2&i){let l;Zn(l=Xn())&&(r.digitInputs=l)}},decls:30,vars:8,consts:[["digitInput",""],[1,"verification-container"],[1,"logo"],[1,"fas","fa-shield-alt"],[1,"subtitle"],[3,"ngSubmit","formGroup"],[1,"code-inputs"],["type","text","maxlength","1","formControlName","digit0","placeholder","-",1,"digit-input",3,"input"],["type","text","maxlength","1","formControlName","digit1","placeholder","-",1,"digit-input",3,"input"],["type","text","maxlength","1","formControlName","digit2","placeholder","-",1,"digit-input",3,"input"],["type","text","maxlength","1","formControlName","digit3","placeholder","-",1,"digit-input",3,"input"],["type","text","maxlength","1","formControlName","digit4","placeholder","-",1,"digit-input",3,"input"],["type","text","maxlength","1","formControlName","digit5","placeholder","-",1,"digit-input",3,"input"],["type","submit",1,"submit-button",3,"disabled"],["class","fas fa-check-circle",4,"ngIf"],["class","fas fa-spinner fa-spin me-2",4,"ngIf"],[1,"resend-container"],["type","button",1,"resend-button",3,"click","disabled"],[1,"fas","fa-clock"],[4,"ngIf"],[1,"fas","fa-check-circle"],[1,"fas","fa-spinner","fa-spin","me-2"]],template:function(i,r){if(1&i){const l=_i();ae(0,"div",1)(1,"div",2),Wt(2,"i",3),le(),ae(3,"h2"),Re(4,"Verificaci\xf3n de Cuenta"),le(),ae(5,"p",4),Re(6,"Ingresa el c\xf3digo de 6 d\xedgitos enviado a tu correo"),le(),ae(7,"form",5),Tt("ngSubmit",function(){return on(l),ln(r.submitCode())}),ae(8,"div",6)(9,"input",7,0),Tt("input",function(w){return on(l),ln(r.onCodeInput(w,0))}),le(),ae(11,"input",8,0),Tt("input",function(w){return on(l),ln(r.onCodeInput(w,1))}),le(),ae(13,"input",9,0),Tt("input",function(w){return on(l),ln(r.onCodeInput(w,2))}),le(),ae(15,"input",10,0),Tt("input",function(w){return on(l),ln(r.onCodeInput(w,3))}),le(),ae(17,"input",11,0),Tt("input",function(w){return on(l),ln(r.onCodeInput(w,4))}),le(),ae(19,"input",12,0),Tt("input",function(w){return on(l),ln(r.onCodeInput(w,5))}),le()(),ae(21,"button",13),vt(22,wte,1,0,"i",14)(23,Cte,1,0,"i",15),Re(24),le()(),ae(25,"div",16)(26,"button",17),Tt("click",function(){return on(l),ln(r.resendCode())}),Wt(27,"i",18),vt(28,Ete,2,1,"span",19)(29,Ste,2,0,"span",19),le()()()}2&i&&(xe(7),Xe("formGroup",r.verificationForm),xe(14),Xe("disabled",r.verificationForm.invalid||r.isSubmitting),xe(),Xe("ngIf",!r.isSubmitting),xe(),Xe("ngIf",r.isSubmitting),xe(),Ci(" ",r.isSubmitting?"Validando...":"Validar C\xf3digo"," "),xe(2),Xe("disabled",r.resendDisabled||r.isSubmitting||r.isResend),xe(2),Xe("ngIf",r.resendDisabled),xe(),Xe("ngIf",!r.resendDisabled))},dependencies:[Ea,Os,Vp,kh,dc,Ad,Ah,DT,el,Mu],styles:["[_ngcontent-%COMP%]:root{--primary-bg: #e0f4fa;--primary-accent: #79b4d8;--primary-dark: #1e3a5f;--input-bg: #ffffff;--error-color: #e74c3c}.verification-container[_ngcontent-%COMP%]{width:380px;background:var(--input-bg);margin:80px auto;padding:30px 25px;border-radius:12px;text-align:center;box-shadow:0 4px 15px #0000001a}.logo[_ngcontent-%COMP%]{font-size:3rem;color:var(--primary-accent);margin-bottom:15px}h2[_ngcontent-%COMP%]{font-size:24px;margin-bottom:8px;color:var(--primary-dark)}.subtitle[_ngcontent-%COMP%]{font-size:14px;margin-bottom:25px;color:var(--primary-accent)}.code-inputs[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:20px}.digit-input[_ngcontent-%COMP%]{width:48px;height:60px;font-size:2rem;text-align:center;border:2px dashed var(--primary-dark);border-radius:6px;background:var(--input-bg);background-image:linear-gradient(to bottom right,var(--primary-accent) 2px,transparent 2px);background-size:100% 100%;transition:background .2s ease,border-color .2s ease;box-sizing:border-box}.digit-input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary-accent)}.digit-input.ng-valid[_ngcontent-%COMP%]{background-image:none}.submit-button[_ngcontent-%COMP%]{width:100%;padding:12px;background:var(--primary-accent);color:var(--primary-dark);border:none;border-radius:6px;cursor:pointer;font-size:16px;font-weight:600;transition:background .3s ease,transform .2s ease;box-shadow:0 2px 8px #00000026}.submit-button[_ngcontent-%COMP%]:disabled{background:#aaa;cursor:not-allowed;color:#ccc}.submit-button[_ngcontent-%COMP%]:not(:disabled):hover{background:var(--primary-dark);transform:translateY(-2px);color:var(--input-bg)}.resend-container[_ngcontent-%COMP%]{margin-top:20px}.resend-button[_ngcontent-%COMP%]{padding:10px 16px;background:var(--primary-bg);color:var(--primary-dark);border:2px solid var(--primary-accent);border-radius:6px;cursor:pointer;font-size:14px;font-weight:500;transition:background .3s ease,transform .2s ease;display:inline-flex;align-items:center;gap:8px}.resend-button[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.resend-button[_ngcontent-%COMP%]:not(:disabled):hover{background:var(--primary-accent);color:var(--input-bg);transform:translateY(-1px)}"]})}return t})();function Dte(t,n){1&t&&(ae(0,"span"),Re(1,"El t\xedtulo es obligatorio."),le())}function Mte(t,n){1&t&&(ae(0,"span"),Re(1,"M\xednimo 5 caracteres."),le())}function Tte(t,n){1&t&&(ae(0,"span"),Re(1,"M\xe1ximo 100 caracteres."),le())}function Ite(t,n){if(1&t&&(ae(0,"div",22),vt(1,Dte,2,0,"span",14)(2,Mte,2,0,"span",14)(3,Tte,2,0,"span",14),le()),2&t){const e=Lt();xe(),Xe("ngIf",null==e.title||null==e.title.errors?null:e.title.errors.required),xe(),Xe("ngIf",null==e.title||null==e.title.errors?null:e.title.errors.minlength),xe(),Xe("ngIf",null==e.title||null==e.title.errors?null:e.title.errors.maxlength)}}function Ate(t,n){1&t&&(ae(0,"span"),Re(1,"La descripci\xf3n es obligatoria."),le())}function kte(t,n){1&t&&(ae(0,"span"),Re(1,"M\xednimo 10 caracteres."),le())}function Rte(t,n){if(1&t&&(ae(0,"div",22),vt(1,Ate,2,0,"span",14)(2,kte,2,0,"span",14),le()),2&t){const e=Lt();xe(),Xe("ngIf",null==e.description||null==e.description.errors?null:e.description.errors.required),xe(),Xe("ngIf",null==e.description||null==e.description.errors?null:e.description.errors.minlength)}}function Pte(t,n){if(1&t){const e=_i();ae(0,"button",23),Tt("click",function(){const r=on(e).$implicit;return ln(Lt().toggleCategory(r.id))}),Re(1),le()}if(2&t){const e=n.$implicit;Di("selected",Lt().isSelected(e.id)),xe(),Ci(" ",e.name," ")}}function Ote(t,n){1&t&&(ae(0,"span"),Re(1," Debes seleccionar al menos una categor\xeda. "),le())}function Fte(t,n){if(1&t&&(ae(0,"div",22),vt(1,Ote,2,0,"span",14),le()),2&t){const e=Lt();xe(),Xe("ngIf",(null==e.categoryIds||null==e.categoryIds.errors?null:e.categoryIds.errors.required)||(null==e.categoryIds||null==e.categoryIds.errors?null:e.categoryIds.errors.minlength))}}function Lte(t,n){if(1&t&&(ae(0,"li"),Re(1),le()),2&t){const e=n.$implicit,i=Lt(2);xe(),Ci(" ",i.getCategoryName(e)," ")}}function Nte(t,n){if(1&t&&(ae(0,"div")(1,"p"),Re(2,"Categor\xedas seleccionadas:"),le(),ae(3,"ul"),vt(4,Lte,2,1,"li",24),le()()),2&t){const e=Lt();xe(4),Xe("ngForOf",null==e.categoryIds?null:e.categoryIds.value)}}function zte(t,n){1&t&&(ae(0,"div",22),Re(1," Debes seleccionar una ubicaci\xf3n en el mapa. "),le())}function Bte(t,n){if(1&t){const e=_i();ae(0,"div",25)(1,"div",26),Wt(2,"img",27),ae(3,"button",28),Tt("click",function(){return on(e),ln(Lt().removePreview(0))}),Re(4," \u2716 "),le()()()}if(2&t){const e=Lt();xe(2),Xe("src",e.imagePreview,vp)}}function Vte(t,n){1&t&&(ae(0,"div",22),Re(1," Debes subir al menos una imagen. "),le())}function Ute(t,n){if(1&t&&(ae(0,"span"),Re(1),le()),2&t){const e=Lt();xe(),Ci(" ",e.isEditMode?"Actualizar Reporte":"Crear Reporte"," ")}}function jte(t,n){if(1&t&&(ae(0,"span"),Re(1),le()),2&t){const e=Lt();xe(),Ci(" ",e.isEditMode?"Actualizando...":"Creando..."," ")}}let v5=(()=>{class t{fb;reportService;categoryService;snackBar;router;route;cdRef;reportForm;categories=[];file=null;imagePreview=null;map;marker;isLoading=!1;isEditMode=!1;reportId=null;routeSub=null;initialReportData=null;platformId=te(cu);notificationService=te(Uc);constructor(e,i,r,l,f,w,M){this.fb=e,this.reportService=i,this.categoryService=r,this.snackBar=l,this.router=f,this.route=w,this.cdRef=M,this.reportForm=this.fb.group({title:["",[bn.required,bn.minLength(5),bn.maxLength(100)]],description:["",[bn.required,bn.minLength(10)]],categoryIds:[[],[bn.required,bn.minLength(1)]],latitude:[null,bn.required],longitude:[null,bn.required],selectedFile:[null,bn.required]})}ngOnInit(){this.loadCategories(),this.routeSub=this.route.paramMap.subscribe(e=>{this.reportId=e.get("id"),this.reportId?(this.isEditMode=!0,this.loadReportForEdit(this.reportId)):(this.isEditMode=!1,console.log("No hay ID de reporte, modo creaci\xf3n."),setTimeout(()=>this.initializeMap(),100))})}ngAfterViewInit(){}ngOnDestroy(){this.routeSub?.unsubscribe(),this.map?.remove()}loadCategories(){this.categoryService.getAllActiveCategories().subscribe({next:e=>this.categories=e,error:e=>this.notificationService.error("Error al cargar las categor\xedas")})}loadReportForEdit(e){this.isLoading=!0,this.reportService.getReportById(e).subscribe({next:i=>{this.initialReportData=i,this.reportForm.patchValue({title:i.title,description:i.description,categoryIds:i.categoryList.map(r=>r.id),latitude:i.latitude,longitude:i.longitude}),this.reportForm.get("selectedFile")?.clearValidators(),this.reportForm.get("selectedFile")?.updateValueAndValidity(),this.loadImages(i.id),this.isLoading=!1,this.initializeMapWithReportCoords(i.longitude,i.latitude)},error:i=>{this.isLoading=!1,this.notificationService.error("Error al cargar el reporte para editar."),this.router.navigate(["/map"])}})}initializeMapWithReportCoords(e,i){this.map&&this.map.remove(),this.map=new(ss().Map)({accessToken:iv_mapboxToken,container:"map_user",style:"mapbox://styles/mapbox/streets-v11",center:[e,i],zoom:15,attributionControl:!1}),this.addMapControls(),this.addMarkerWithDragging(e,i)}addMapControls(){this.map.addControl(new(ss().NavigationControl),"bottom-right"),this.map.addControl(new(ss().FullscreenControl),"top-right")}addMarkerWithDragging(e,i){this.marker&&this.marker.remove(),this.marker=new(ss().Marker)({draggable:!0}).setLngLat([e,i]).addTo(this.map),this.marker.on("dragend",()=>{const r=this.marker.getLngLat();this.reportForm.patchValue({latitude:r.lat,longitude:r.lng})}),this.map.flyTo({center:[e,i],essential:!0})}initializeMap(e){const i=sessionStorage.getItem("lat"),r=sessionStorage.getItem("lng");let l,f;i&&r?(l={lng:parseFloat(r),lat:parseFloat(i)},f=13):e?(l={lng:e[0],lat:e[1]},f=13):(l={lng:-75.681,lat:4.533},f=13);try{this.map=new(ss().Map)({accessToken:iv_mapboxToken,container:"map_user",style:"mapbox://styles/mapbox/streets-v11",center:l,zoom:f,attributionControl:!1}),this.map.addControl(new(ss().NavigationControl),"bottom-right"),this.map.on("load",()=>{if(this.map.resize(),console.log("Mapa cargado (report form)."),this.reportForm.get("latitude")?.value&&this.reportForm.get("longitude")?.value){const w=new o5.LngLat(this.reportForm.get("longitude")?.value,this.reportForm.get("latitude")?.value);this.updateMarkerAndForm(w)}}),this.map.on("click",({lngLat:w})=>{this.isEditMode||this.updateMarkerAndForm(w)}),this.map.on("error",w=>{console.error("Error en Mapbox (report form):",w),this.notificationService.error("Error al cargar el mapa.")})}catch(w){console.error("Error inicializando Mapbox (report form):",w)}}updateMarkerAndForm(e){this.reportForm.patchValue({latitude:e.lat,longitude:e.lng}),this.marker?this.marker.setLngLat(e):(this.marker=new(ss().Marker)({draggable:!this.isEditMode}).setLngLat(e).addTo(this.map),this.isEditMode||this.marker.on("dragend",()=>{const i=this.marker.getLngLat();this.reportForm.patchValue({latitude:i.lat,longitude:i.lng})}))}onFileSelected(e){const i=e.currentTarget,r=i.files;if(this.imagePreview=null,r&&r.length>0){const l=r[0];this.file=r[0],l.type.startsWith("image/")||this.notificationService.error(`El archivo '${l.name}' no es una imagen v\xe1lida.`);const f=new FileReader;f.onload=w=>{this.imagePreview=w.target.result,this.cdRef.detectChanges()},f.readAsDataURL(l)}i.value=""}removePreview(e){this.imagePreview=null}onSubmit(){if(this.reportForm.invalid)return this.reportForm.markAllAsTouched(),void this.snackBar.open("Por favor, completa todos los campos requeridos.","Cerrar",{duration:3e3});if(!this.isEditMode&&!this.file)return void this.snackBar.open("Debes subir al menos una imagen para el reporte.","Cerrar",{duration:3e3});this.isLoading=!0;const e=this.reportForm.value,i={title:e.title,description:e.description,latitude:e.latitude,longitude:e.longitude,categoryList:this.categories.filter(r=>e.categoryIds.includes(r.id))};this.isEditMode&&this.reportId?(console.log(this.file),this.reportService.updateReport(this.reportId,i,this.file).subscribe({next:()=>{this.isLoading=!1,this.notificationService.success("Reporte actualizado con \xe9xito."),this.router.navigate(["/map"])},error:r=>{this.isLoading=!1,this.notificationService.error("Error al actualizar el reporte.")}})):this.file&&this.reportService.createReport(i,this.file).subscribe({next:r=>{this.isLoading=!1,this.notificationService.success("Reporte creado con \xe9xito. Pendiente de verificaci\xf3n."),this.router.navigate(["/map"])},error:r=>{this.isLoading=!1,this.notificationService.error(r.message||"Error al crear el reporte.")}})}getCategoryName(e){return this.categories.find(i=>i.id===e)?.name||"Desconocido"}toggleCategory(e){const i=this.reportForm.get("categoryIds"),r=i?.value||[],l=r.indexOf(e);l>-1?r.splice(l,1):r.push(e),i?.setValue([...r])}isSelected(e){return this.reportForm.get("categoryIds")?.value?.includes(e)}get title(){return this.reportForm.get("title")}get description(){return this.reportForm.get("description")}get categoryIds(){return this.reportForm.get("categoryIds")}get latitude(){return this.reportForm.get("latitude")}get longitude(){return this.reportForm.get("longitude")}get selectedFile(){return this.reportForm.get("selectedFile")}loadImages(e){e&&this.reportService.getAllImagesReportById(e).subscribe({next:i=>{this.imagePreview=i[0].imageUrl,console.log("Imagenes cargadas",this.imagePreview)},error:i=>{this.snackBar.open("Error al cargar las im\xe1genes del reporte.","Cerrar",{duration:3e3})}})}goBack(){this.router.navigate(["/map"])}static \u0275fac=function(i){return new(i||t)(ft(Bp),ft(q0),ft(ZC),ft(GR),ft(oo),ft(Fg),ft(Do))};static \u0275cmp=kn({type:t,selectors:[["app-report"]],decls:43,vars:13,consts:[["mat-icon-button","","aria-label","Volver",1,"back-button",3,"click"],[1,"report-container"],["novalidate","",3,"ngSubmit","formGroup"],[1,"field-group"],["for","title"],[1,"fa","fa-heading","icon"],["type","text","id","title","formControlName","title","placeholder","Ej: Perro perdido cerca del parque"],["class","error-message",4,"ngIf"],["for","description"],[1,"fa","fa-align-left","icon"],["id","description","formControlName","description","rows","4","placeholder","Describe detalladamente lo que sucede..."],[1,"fa","fa-tags","icon"],[1,"category-chip-container"],["type","button",3,"selected","click",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"fa","fa-map-marker-alt","icon"],["id","map_user",2,"width","100%","height","300px","border","1px solid #ccc","border-radius","6px"],["for","selectedFile"],[1,"fa","fa-image","icon"],["type","file","id","selectedFile","formControlName","selectedFile","accept","image/*",3,"change"],["class","image-previews",4,"ngIf"],["type","submit",1,"submit-button",3,"disabled"],[1,"error-message"],["type","button",3,"click"],[4,"ngFor","ngForOf"],[1,"image-previews"],[1,"preview-item"],["alt","Previsualizaci\xf3n",3,"src"],["type","button","title","Quitar imagen",1,"remove-preview-btn",3,"click"]],template:function(i,r){1&i&&(ae(0,"button",0),Tt("click",function(){return r.goBack()}),ae(1,"mat-icon"),Re(2,"arrow_back"),le()(),ae(3,"div",1)(4,"h2"),Re(5),le(),ae(6,"form",2),Tt("ngSubmit",function(){return r.onSubmit()}),ae(7,"div",3)(8,"label",4),Wt(9,"i",5),Re(10," T\xedtulo "),le(),Wt(11,"input",6),vt(12,Ite,4,3,"div",7),le(),ae(13,"div",3)(14,"label",8),Wt(15,"i",9),Re(16," Descripci\xf3n "),le(),Wt(17,"textarea",10),vt(18,Rte,3,2,"div",7),le(),ae(19,"div",3)(20,"label"),Wt(21,"i",11),Re(22," Categor\xedas "),le(),ae(23,"div",12),vt(24,Pte,2,3,"button",13),le(),vt(25,Fte,2,1,"div",7)(26,Nte,5,1,"div",14),le(),ae(27,"div",3)(28,"label"),Wt(29,"i",15),Re(30," Ubicaci\xf3n "),le(),Wt(31,"div",16),vt(32,zte,2,0,"div",7),le(),ae(33,"div",3)(34,"label",17),Wt(35,"i",18),Re(36," Im\xe1genes (al menos 1) "),le(),ae(37,"input",19),Tt("change",function(f){return r.onFileSelected(f)}),le(),vt(38,Bte,5,1,"div",20)(39,Vte,2,0,"div",7),le(),ae(40,"button",21),vt(41,Ute,2,1,"span",14)(42,jte,2,1,"span",14),le()()()),2&i&&(xe(5),er(r.isEditMode?"Editar Reporte":"Crear Nuevo Reporte"),xe(),Xe("formGroup",r.reportForm),xe(6),Xe("ngIf",(null==r.title?null:r.title.invalid)&&((null==r.title?null:r.title.dirty)||(null==r.title?null:r.title.touched))),xe(6),Xe("ngIf",(null==r.description?null:r.description.invalid)&&((null==r.description?null:r.description.dirty)||(null==r.description?null:r.description.touched))),xe(6),Xe("ngForOf",r.categories),xe(),Xe("ngIf",(null==r.categoryIds?null:r.categoryIds.invalid)&&((null==r.categoryIds?null:r.categoryIds.touched)||(null==r.categoryIds?null:r.categoryIds.dirty))),xe(),Xe("ngIf",null==r.categoryIds||null==r.categoryIds.value?null:r.categoryIds.value.length),xe(6),Xe("ngIf",((null==r.latitude?null:r.latitude.invalid)||(null==r.longitude?null:r.longitude.invalid))&&((null==r.latitude?null:r.latitude.touched)||(null==r.longitude?null:r.longitude.touched))),xe(6),Xe("ngIf",r.imagePreview),xe(),Xe("ngIf",!r.isEditMode&&!r.selectedFile&&r.reportForm.touched),xe(),Xe("disabled",r.reportForm.invalid||r.isLoading||!r.isEditMode&&!r.selectedFile),xe(),Xe("ngIf",!r.isLoading),xe(),Xe("ngIf",r.isLoading))},dependencies:[Ea,kg,Os,Vp,kh,dc,Ad,Ah,el,Mu,z0,Up,kd],styles:["body[_ngcontent-%COMP%]{font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;background-color:#f4f6f8;margin:0;padding:0}.report-container[_ngcontent-%COMP%]{max-width:700px;margin:50px auto;padding:30px 40px;border:1px solid #ccc;border-radius:8px;background-color:#fff;box-shadow:0 4px 12px #0000000d}.report-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{text-align:center;font-size:28px;color:#333;margin-bottom:40px}.field-group[_ngcontent-%COMP%]{margin-bottom:40px}.field-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:12px;font-weight:700;color:#555}.field-group[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%], .field-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%], .field-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{display:block;width:100%;padding:14px 16px;border:1px solid #ccc;border-radius:4px;box-sizing:border-box;font-size:15px;background-color:#fff;transition:border-color .2s ease}.field-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .field-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus, .field-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus{border-color:#79b4d8;outline:none}.field-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{resize:vertical;min-height:120px}.field-group[_ngcontent-%COMP%]   select[multiple][_ngcontent-%COMP%]{min-height:120px}.error-message[_ngcontent-%COMP%]{color:#e74c3c;font-size:.9em;margin-top:8px}.category-chip-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:10px;margin-bottom:10px}.category-chip-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:#ecf0f1;border:1px solid #bdc3c7;color:#2c3e50;padding:8px 14px;border-radius:20px;cursor:pointer;transition:background .2s ease,border-color .2s ease}.category-chip-container[_ngcontent-%COMP%]   button.selected[_ngcontent-%COMP%]{background-color:#79b4d8;color:#fff;border-color:#1e3a5f}.image-previews[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:12px;margin-top:12px}.preview-item[_ngcontent-%COMP%]{position:relative;border-radius:4px;overflow:visible;box-shadow:0 2px 6px #0000001a}.remove-preview-btn[_ngcontent-%COMP%]{position:absolute;top:-8px;right:-8px;background:#e74c3c;color:#fff;border:none;border-radius:50%;width:24px;height:24px;font-size:14px;line-height:24px;text-align:center;cursor:pointer;z-index:1}.remove-preview-btn[_ngcontent-%COMP%]:hover{background:#c0392b}.preview-item[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100px;max-height:100px;object-fit:cover}#map_user[_ngcontent-%COMP%], #map_report[_ngcontent-%COMP%]{border:1px solid #ccc;border-radius:4px;height:300px;margin-top:12px}.submit-button[_ngcontent-%COMP%]{display:block;width:100%;padding:14px;background-color:#f9f9f9;color:#333;border:1px solid #ccc;border-radius:4px;font-size:16px;cursor:pointer;transition:background-color .2s ease;margin-top:30px}.submit-button[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#e0e0e0}.submit-button[_ngcontent-%COMP%]:disabled{background-color:#ddd;cursor:not-allowed}.back-button[_ngcontent-%COMP%]{position:fixed;top:16px;left:16px;z-index:1000;width:40px;height:40px;padding:0;background-color:#fff;border:1px solid #ccc;border-radius:8px;box-shadow:0 4px 12px #0000000d;display:flex;align-items:center;justify-content:center;transition:background-color .2s ease,transform .1s ease}.back-button[_ngcontent-%COMP%]:hover{background-color:#f9f9f9;transform:translate(-2px)}.back-button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;color:#0009}"]})}return t})();const Hte=["digitInput"];function $te(t,n){1&t&&(ae(0,"div",23),Re(1," La contrase\xf1a debe tener al menos una may\xfascula, una min\xfascula y un d\xedgito. "),le())}function Gte(t,n){1&t&&Wt(0,"i",24)}function qte(t,n){1&t&&Wt(0,"i",25)}function Wte(t,n){if(1&t&&(ae(0,"span"),Re(1),le()),2&t){const e=Lt();xe(),Ci("Reenviar en ",e.formattedTime,"")}}function Yte(t,n){1&t&&(ae(0,"span"),Re(1,"Reenviar C\xf3digo"),le())}let Zte=(()=>{class t{fb=te(Bp);router=te(oo);notificationService=te(Uc);authService=te(Su);digitInputs;verificationForm=this.fb.group({digit0:new qo(null,[bn.required,bn.pattern(/^\d$/)]),digit1:new qo(null,[bn.required,bn.pattern(/^\d$/)]),digit2:new qo(null,[bn.required,bn.pattern(/^\d$/)]),digit3:new qo(null,[bn.required,bn.pattern(/^\d$/)]),digit4:new qo(null,[bn.required,bn.pattern(/^\d$/)]),digit5:new qo(null,[bn.required,bn.pattern(/^\d$/)]),password:new qo(null,[bn.required,bn.pattern(/^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).*$/)])});isSubmitting=!1;isResend=!1;resendDisabled=!1;secondsLeft=0;countdownSub;ngOnInit(){}ngOnDestroy(){this.countdownSub?.unsubscribe()}submitCode(){if(this.verificationForm.invalid)return this.notificationService.error("Por favor completa todos los campos del c\xf3digo y la contrase\xf1a."),void this.verificationForm.markAllAsTouched();if(this.isSubmitting)return;this.isSubmitting=!0;const e=[this.verificationForm.value.digit0,this.verificationForm.value.digit1,this.verificationForm.value.digit2,this.verificationForm.value.digit3,this.verificationForm.value.digit4,this.verificationForm.value.digit5].join("");this.authService.resetPasswordWithCode({code:e,newPassword:this.verificationForm.value.password}).subscribe({next:()=>{this.notificationService.success("\u2705 Contrase\xf1a restablecida exitosamente"),this.router.navigate(["/login"])},error:r=>{console.error("Error completo al restablecer contrase\xf1a:",r);const l=r.status;let f="Ocurri\xf3 un error al restablecer la contrase\xf1a.";if(400===l){let w;try{w="string"==typeof r.error?JSON.parse(r.error):r.error}catch{w={message:r.error}}const M=w.message?.toLowerCase()??"";f=M.includes("no es v\xe1lido para recuperar contrase\xf1a")?"El c\xf3digo no es v\xe1lido para recuperar contrase\xf1a.":M.includes("c\xf3digo inv\xe1lido")?"El c\xf3digo es inv\xe1lido.":M.includes("ha expirado")?"El c\xf3digo ha expirado.":w.message||"Solicitud incorrecta."}else 404===l?f="Usuario no encontrado.":500===l&&(f="Error interno del servidor.");this.notificationService.error(f),this.isSubmitting=!1}})}resendCode(){if(this.resendDisabled||this.isSubmitting||this.isResend)return;this.isResend=!0;const e=sessionStorage.getItem("email");e?this.authService.resendResetPasswordCode(e).subscribe({next:()=>{this.startCountdown(),this.notificationService.success("\xa1C\xf3digo reenviado exitosamente!"),this.isResend=!1},error:i=>{const r=i.status;let l="Ocurri\xf3 un error al reenviar el c\xf3digo.";404===r?l="Usuario no encontrado.":500===r&&(l="Error interno del servidor."),this.notificationService.error(l),this.isResend=!1}}):this.notificationService.error("No se encontr\xf3 el email del usuario.")}startCountdown(){this.countdownSub?.unsubscribe(),this.resendDisabled=!0,this.secondsLeft=120,this.countdownSub=_5(1e3).pipe(rR(()=>this.secondsLeft>0)).subscribe(()=>{this.secondsLeft--,0===this.secondsLeft&&(this.resendDisabled=!1)})}get formattedTime(){return`${Math.floor(this.secondsLeft/60).toString().padStart(2,"0")}:${(this.secondsLeft%60).toString().padStart(2,"0")}`}onCodeInput(e,i){const l=e.target.value.replace(/\D/g,"").slice(0,1);this.verificationForm.controls[`digit${i}`].setValue(l,{emitEvent:!1}),l&&i<this.digitInputs.length-1&&this.digitInputs.toArray()[i+1].nativeElement.focus()}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=kn({type:t,selectors:[["app-verification"]],viewQuery:function(i,r){if(1&i&&kr(Hte,5),2&i){let l;Zn(l=Xn())&&(r.digitInputs=l)}},decls:33,vars:9,consts:[["digitInput",""],[1,"verification-container"],[1,"logo"],[1,"fas","fa-shield-alt"],[1,"subtitle"],[3,"ngSubmit","formGroup"],[1,"code-inputs"],["type","text","maxlength","1","formControlName","digit0","placeholder","-",1,"digit-input",3,"input"],["type","text","maxlength","1","formControlName","digit1","placeholder","-",1,"digit-input",3,"input"],["type","text","maxlength","1","formControlName","digit2","placeholder","-",1,"digit-input",3,"input"],["type","text","maxlength","1","formControlName","digit3","placeholder","-",1,"digit-input",3,"input"],["type","text","maxlength","1","formControlName","digit4","placeholder","-",1,"digit-input",3,"input"],["type","text","maxlength","1","formControlName","digit5","placeholder","-",1,"digit-input",3,"input"],[1,"password-group"],["type","password","formControlName","password","placeholder","Nueva contrase\xf1a",1,"password-input"],["class","error-message",4,"ngIf"],["type","submit",1,"submit-button",3,"disabled"],["class","fas fa-check-circle",4,"ngIf"],["class","fas fa-spinner fa-spin me-2",4,"ngIf"],[1,"resend-container"],["type","button",1,"resend-button",3,"click","disabled"],[1,"fas","fa-clock"],[4,"ngIf"],[1,"error-message"],[1,"fas","fa-check-circle"],[1,"fas","fa-spinner","fa-spin","me-2"]],template:function(i,r){if(1&i){const l=_i();ae(0,"div",1)(1,"div",2),Wt(2,"i",3),le(),ae(3,"h2"),Re(4,"Confirmaci\xf3n de restablecer contrase\xf1a"),le(),ae(5,"p",4),Re(6,"Ingresa el c\xf3digo de 6 d\xedgitos y tu nueva contrase\xf1a"),le(),ae(7,"form",5),Tt("ngSubmit",function(){return on(l),ln(r.submitCode())}),ae(8,"div",6)(9,"input",7,0),Tt("input",function(w){return on(l),ln(r.onCodeInput(w,0))}),le(),ae(11,"input",8,0),Tt("input",function(w){return on(l),ln(r.onCodeInput(w,1))}),le(),ae(13,"input",9,0),Tt("input",function(w){return on(l),ln(r.onCodeInput(w,2))}),le(),ae(15,"input",10,0),Tt("input",function(w){return on(l),ln(r.onCodeInput(w,3))}),le(),ae(17,"input",11,0),Tt("input",function(w){return on(l),ln(r.onCodeInput(w,4))}),le(),ae(19,"input",12,0),Tt("input",function(w){return on(l),ln(r.onCodeInput(w,5))}),le()(),ae(21,"div",13),Wt(22,"input",14),vt(23,$te,2,0,"div",15),le(),ae(24,"button",16),vt(25,Gte,1,0,"i",17)(26,qte,1,0,"i",18),Re(27),le()(),ae(28,"div",19)(29,"button",20),Tt("click",function(){return on(l),ln(r.resendCode())}),Wt(30,"i",21),vt(31,Wte,2,1,"span",22)(32,Yte,2,0,"span",22),le()()()}if(2&i){let l;xe(7),Xe("formGroup",r.verificationForm),xe(16),Xe("ngIf",(null==(l=r.verificationForm.get("password"))?null:l.invalid)&&(null==(l=r.verificationForm.get("password"))?null:l.touched)),xe(),Xe("disabled",r.verificationForm.invalid||r.isSubmitting),xe(),Xe("ngIf",!r.isSubmitting),xe(),Xe("ngIf",r.isSubmitting),xe(),Ci(" ",r.isSubmitting?"Restableciendo...":"Confirmar y Cambiar"," "),xe(2),Xe("disabled",r.resendDisabled||r.isSubmitting||r.isResend),xe(2),Xe("ngIf",r.resendDisabled),xe(),Xe("ngIf",!r.resendDisabled)}},dependencies:[Ea,Os,Vp,kh,dc,Ad,Ah,DT,el,Mu],styles:["[_ngcontent-%COMP%]:root{--primary-bg: #e0f4fa;--primary-accent: #79b4d8;--primary-dark: #1e3a5f;--input-bg: #ffffff;--error-color: #e74c3c}.verification-container[_ngcontent-%COMP%]{width:380px;background:var(--input-bg);margin:80px auto;padding:30px 25px;border-radius:12px;text-align:center;box-shadow:0 4px 15px #0000001a}.logo[_ngcontent-%COMP%]{font-size:3rem;color:var(--primary-accent);margin-bottom:15px}h2[_ngcontent-%COMP%]{font-size:24px;margin-bottom:8px;color:var(--primary-dark)}.subtitle[_ngcontent-%COMP%]{font-size:14px;margin-bottom:25px;color:var(--primary-accent)}.code-inputs[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:10px}.digit-input[_ngcontent-%COMP%]{width:40px;height:50px;font-size:1.5rem;text-align:center;border:2px dashed var(--primary-dark);border-radius:6px;background:var(--input-bg);background-image:linear-gradient(to bottom right,var(--primary-accent) 2px,transparent 2px);background-size:100% 100%;transition:background .2s ease,border-color .2s ease;box-sizing:border-box}.digit-input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary-accent)}.digit-input.ng-valid[_ngcontent-%COMP%]{background-image:none}.submit-button[_ngcontent-%COMP%]{width:100%;padding:12px;margin-top:8px;background:var(--primary-accent);color:var(--primary-dark);border:none;border-radius:6px;cursor:pointer;font-size:16px;font-weight:600;transition:background .3s ease,transform .2s ease;box-shadow:0 2px 8px #00000026}.submit-button[_ngcontent-%COMP%]:disabled{background:#aaa;cursor:not-allowed;color:#ccc}.submit-button[_ngcontent-%COMP%]:not(:disabled):hover{background:var(--primary-dark);transform:translateY(-2px);color:var(--input-bg)}.resend-container[_ngcontent-%COMP%]{margin-top:20px}.resend-button[_ngcontent-%COMP%]{padding:10px 16px;background:var(--primary-bg);color:var(--primary-dark);border:2px solid var(--primary-accent);border-radius:6px;cursor:pointer;font-size:14px;font-weight:500;transition:background .3s ease,transform .2s ease;display:inline-flex;align-items:center;gap:8px}.resend-button[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.resend-button[_ngcontent-%COMP%]:not(:disabled):hover{background:var(--primary-accent);color:var(--input-bg);transform:translateY(-1px)}.password-group[_ngcontent-%COMP%]{display:flex;flex-direction:column}.password-input[_ngcontent-%COMP%]{padding:10px;font-size:16px;margin-bottom:10px;border:2px solid #ccc;border-radius:6px;background:var(--input-bg);transition:border-color .2s ease}.password-input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary-accent)}.error-message[_ngcontent-%COMP%]{color:var(--error-color);font-size:13px;text-align:left;margin-top:-10px}"]})}return t})(),Xte=(()=>{class t{router;constructor(e){this.router=e}goHome(){this.router.navigate(["/map"])}static \u0275fac=function(i){return new(i||t)(ft(oo))};static \u0275cmp=kn({type:t,selectors:[["app-not-found"]],decls:10,vars:0,consts:[[1,"not-found-container"],[1,"icon-wrapper"],[1,"fas","fa-exclamation-triangle"],[1,"submit-button",3,"click"],[1,"fas","fa-home"]],template:function(i,r){1&i&&(ae(0,"div",0)(1,"div",1),Wt(2,"i",2),le(),ae(3,"h1"),Re(4,"P\xe1gina no encontrada"),le(),ae(5,"p"),Re(6,"Lo sentimos, la ruta que est\xe1s buscando no existe."),le(),ae(7,"button",3),Tt("click",function(){return r.goHome()}),Wt(8,"i",4),Re(9," Ir al inicio "),le()())},dependencies:[z0],styles:["[_nghost-%COMP%]{display:block}.not-found-container[_ngcontent-%COMP%]{max-width:400px;margin:100px auto;padding:40px;text-align:center;background-color:var(--input-bg);border-radius:12px;box-shadow:0 4px 20px #0000001a}.icon-wrapper[_ngcontent-%COMP%]{font-size:60px;color:var(--primary-accent);margin-bottom:20px}.not-found-container[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:26px;color:var(--primary-dark);margin-bottom:10px}.not-found-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#555;margin-bottom:30px;font-size:16px}.submit-button[_ngcontent-%COMP%]{width:100%;padding:12px;background:var(--primary-accent);color:#000;border:none;border-radius:6px;cursor:pointer;font-size:16px;font-weight:600;transition:background .3s ease,transform .2s ease;box-shadow:0 2px 8px #00000026}.submit-button[_ngcontent-%COMP%]:hover{background:var(--primary-dark);transform:translateY(-2px)}.submit-button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:8px}"]})}return t})();function eP(t){return t&&"function"==typeof t.connect&&!(t instanceof g2)}var am=function(t){return t[t.REPLACED=0]="REPLACED",t[t.INSERTED=1]="INSERTED",t[t.MOVED=2]="MOVED",t[t.REMOVED=3]="REMOVED",t}(am||{});const XC=new _t("_ViewRepeater");class w5{applyChanges(n,e,i,r,l){n.forEachOperation((f,w,M)=>{let P,L;if(null==f.previousIndex){const $=i(f,w,M);P=e.createEmbeddedView($.templateRef,$.context,$.index),L=am.INSERTED}else null==M?(e.remove(w),L=am.REMOVED):(P=e.get(w),e.move(P,M),L=am.MOVED);l&&l({context:P?.context,operation:L,record:f})})}detach(){}}const Kte=[[["caption"]],[["colgroup"],["col"]],"*"],Qte=["caption","colgroup, col","*"];function Jte(t,n){1&t&&Fi(0,2)}function ene(t,n){1&t&&(ae(0,"thead",0),ia(1,1),le(),ae(2,"tbody",0),ia(3,2)(4,3),le(),ae(5,"tfoot",0),ia(6,4),le())}function tne(t,n){1&t&&ia(0,1)(1,2)(2,3)(3,4)}const jp=new _t("CDK_TABLE");let W0=(()=>{class t{template=te(is);constructor(){}static \u0275fac=function(i){return new(i||t)};static \u0275dir=Ht({type:t,selectors:[["","cdkCellDef",""]]})}return t})(),Y0=(()=>{class t{template=te(is);constructor(){}static \u0275fac=function(i){return new(i||t)};static \u0275dir=Ht({type:t,selectors:[["","cdkHeaderCellDef",""]]})}return t})(),RT=(()=>{class t{template=te(is);constructor(){}static \u0275fac=function(i){return new(i||t)};static \u0275dir=Ht({type:t,selectors:[["","cdkFooterCellDef",""]]})}return t})(),lm=(()=>{class t{_table=te(jp,{optional:!0});_hasStickyChanged=!1;get name(){return this._name}set name(e){this._setNameInput(e)}_name;get sticky(){return this._sticky}set sticky(e){e!==this._sticky&&(this._sticky=e,this._hasStickyChanged=!0)}_sticky=!1;get stickyEnd(){return this._stickyEnd}set stickyEnd(e){e!==this._stickyEnd&&(this._stickyEnd=e,this._hasStickyChanged=!0)}_stickyEnd=!1;cell;headerCell;footerCell;cssClassFriendlyName;_columnCssClassName;constructor(){}hasStickyChanged(){const e=this._hasStickyChanged;return this.resetStickyChanged(),e}resetStickyChanged(){this._hasStickyChanged=!1}_updateColumnCssClassName(){this._columnCssClassName=[`cdk-column-${this.cssClassFriendlyName}`]}_setNameInput(e){e&&(this._name=e,this.cssClassFriendlyName=e.replace(/[^a-z0-9_-]/gi,"-"),this._updateColumnCssClassName())}static \u0275fac=function(i){return new(i||t)};static \u0275dir=Ht({type:t,selectors:[["","cdkColumnDef",""]],contentQueries:function(i,r,l){if(1&i&&(ro(l,W0,5),ro(l,Y0,5),ro(l,RT,5)),2&i){let f;Zn(f=Xn())&&(r.cell=f.first),Zn(f=Xn())&&(r.headerCell=f.first),Zn(f=Xn())&&(r.footerCell=f.first)}},inputs:{name:[0,"cdkColumnDef","name"],sticky:[2,"sticky","sticky",Un],stickyEnd:[2,"stickyEnd","stickyEnd",Un]},features:[pi([{provide:"MAT_SORT_HEADER_COLUMN_DEF",useExisting:t}])]})}return t})();class tP{constructor(n,e){e.nativeElement.classList.add(...n._columnCssClassName)}}let nP=(()=>{class t extends tP{constructor(){super(te(lm),te(Dn))}static \u0275fac=function(i){return new(i||t)};static \u0275dir=Ht({type:t,selectors:[["cdk-header-cell"],["th","cdk-header-cell",""]],hostAttrs:["role","columnheader",1,"cdk-header-cell"],features:[Nn]})}return t})(),iP=(()=>{class t extends tP{constructor(){const e=te(lm),i=te(Dn);super(e,i);const r=e._table?._getCellRole();r&&i.nativeElement.setAttribute("role",r)}static \u0275fac=function(i){return new(i||t)};static \u0275dir=Ht({type:t,selectors:[["cdk-cell"],["td","cdk-cell",""]],hostAttrs:[1,"cdk-cell"],features:[Nn]})}return t})();class E5{tasks=[];endTasks=[]}const rP=new _t("_COALESCED_STYLE_SCHEDULER");let S5=(()=>{class t{_currentSchedule=null;_ngZone=te(wt);constructor(){}schedule(e){this._createScheduleIfNeeded(),this._currentSchedule.tasks.push(e)}scheduleEnd(e){this._createScheduleIfNeeded(),this._currentSchedule.endTasks.push(e)}_createScheduleIfNeeded(){this._currentSchedule||(this._currentSchedule=new E5,this._ngZone.runOutsideAngular(()=>queueMicrotask(()=>{for(;this._currentSchedule.tasks.length||this._currentSchedule.endTasks.length;){const e=this._currentSchedule;this._currentSchedule=new E5;for(const i of e.tasks)i();for(const i of e.endTasks)i()}this._currentSchedule=null})))}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:t.\u0275fac})}return t})(),oP=(()=>{class t{template=te(is);_differs=te(Ig);columns;_columnsDiffer;constructor(){}ngOnChanges(e){if(!this._columnsDiffer){const i=e.columns&&e.columns.currentValue||[];this._columnsDiffer=this._differs.find(i).create(),this._columnsDiffer.diff(i)}}getColumnsDiff(){return this._columnsDiffer.diff(this.columns)}extractCellTemplate(e){return this instanceof KC?e.headerCell.template:this instanceof QC?e.footerCell.template:e.cell.template}static \u0275fac=function(i){return new(i||t)};static \u0275dir=Ht({type:t,features:[Mr]})}return t})(),KC=(()=>{class t extends oP{_table=te(jp,{optional:!0});_hasStickyChanged=!1;get sticky(){return this._sticky}set sticky(e){e!==this._sticky&&(this._sticky=e,this._hasStickyChanged=!0)}_sticky=!1;constructor(){super(te(is),te(Ig))}ngOnChanges(e){super.ngOnChanges(e)}hasStickyChanged(){const e=this._hasStickyChanged;return this.resetStickyChanged(),e}resetStickyChanged(){this._hasStickyChanged=!1}static \u0275fac=function(i){return new(i||t)};static \u0275dir=Ht({type:t,selectors:[["","cdkHeaderRowDef",""]],inputs:{columns:[0,"cdkHeaderRowDef","columns"],sticky:[2,"cdkHeaderRowDefSticky","sticky",Un]},features:[Nn,Mr]})}return t})(),QC=(()=>{class t extends oP{_table=te(jp,{optional:!0});_hasStickyChanged=!1;get sticky(){return this._sticky}set sticky(e){e!==this._sticky&&(this._sticky=e,this._hasStickyChanged=!0)}_sticky=!1;constructor(){super(te(is),te(Ig))}ngOnChanges(e){super.ngOnChanges(e)}hasStickyChanged(){const e=this._hasStickyChanged;return this.resetStickyChanged(),e}resetStickyChanged(){this._hasStickyChanged=!1}static \u0275fac=function(i){return new(i||t)};static \u0275dir=Ht({type:t,selectors:[["","cdkFooterRowDef",""]],inputs:{columns:[0,"cdkFooterRowDef","columns"],sticky:[2,"cdkFooterRowDefSticky","sticky",Un]},features:[Nn,Mr]})}return t})(),PT=(()=>{class t extends oP{_table=te(jp,{optional:!0});when;constructor(){super(te(is),te(Ig))}static \u0275fac=function(i){return new(i||t)};static \u0275dir=Ht({type:t,selectors:[["","cdkRowDef",""]],inputs:{columns:[0,"cdkRowDefColumns","columns"],when:[0,"cdkRowDefWhen","when"]},features:[Nn]})}return t})(),cm=(()=>{class t{_viewContainer=te(io);cells;context;static mostRecentCellOutlet=null;constructor(){t.mostRecentCellOutlet=this}ngOnDestroy(){t.mostRecentCellOutlet===this&&(t.mostRecentCellOutlet=null)}static \u0275fac=function(i){return new(i||t)};static \u0275dir=Ht({type:t,selectors:[["","cdkCellOutlet",""]]})}return t})(),sP=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275cmp=kn({type:t,selectors:[["cdk-header-row"],["tr","cdk-header-row",""]],hostAttrs:["role","row",1,"cdk-header-row"],decls:1,vars:0,consts:[["cdkCellOutlet",""]],template:function(i,r){1&i&&ia(0,0)},dependencies:[cm],encapsulation:2})}return t})(),lP=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275cmp=kn({type:t,selectors:[["cdk-row"],["tr","cdk-row",""]],hostAttrs:["role","row",1,"cdk-row"],decls:1,vars:0,consts:[["cdkCellOutlet",""]],template:function(i,r){1&i&&ia(0,0)},dependencies:[cm],encapsulation:2})}return t})(),OT=(()=>{class t{templateRef=te(is);_contentClassName="cdk-no-data-row";constructor(){}static \u0275fac=function(i){return new(i||t)};static \u0275dir=Ht({type:t,selectors:[["ng-template","cdkNoDataRow",""]]})}return t})();const D5=["top","bottom","left","right"];class one{_isNativeHtmlTable;_stickCellCss;direction;_coalescedStyleScheduler;_isBrowser;_needsPositionStickyOnElement;_positionListener;_tableInjector;_elemSizeCache=new WeakMap;_resizeObserver=globalThis?.ResizeObserver?new globalThis.ResizeObserver(n=>this._updateCachedSizes(n)):null;_updatedStickyColumnsParamsToReplay=[];_stickyColumnsReplayTimeout=null;_cachedCellWidths=[];_borderCellCss;_destroyed=!1;constructor(n,e,i,r,l=!0,f=!0,w,M){this._isNativeHtmlTable=n,this._stickCellCss=e,this.direction=i,this._coalescedStyleScheduler=r,this._isBrowser=l,this._needsPositionStickyOnElement=f,this._positionListener=w,this._tableInjector=M,this._borderCellCss={top:`${e}-border-elem-top`,bottom:`${e}-border-elem-bottom`,left:`${e}-border-elem-left`,right:`${e}-border-elem-right`}}clearStickyPositioning(n,e){(e.includes("left")||e.includes("right"))&&this._removeFromStickyColumnReplayQueue(n);const i=[];for(const r of n)r.nodeType===r.ELEMENT_NODE&&i.push(r,...Array.from(r.children));this._afterNextRender({write:()=>{for(const r of i)this._removeStickyStyle(r,e)}})}updateStickyColumns(n,e,i,r=!0,l=!0){if(!n.length||!this._isBrowser||!e.some(de=>de)&&!i.some(de=>de))return this._positionListener?.stickyColumnsUpdated({sizes:[]}),void this._positionListener?.stickyEndColumnsUpdated({sizes:[]});const f=n[0],w=f.children.length,M="rtl"===this.direction,P=M?"right":"left",L=M?"left":"right",$=e.lastIndexOf(!0),Q=i.indexOf(!0);let X,Y,K;l&&this._updateStickyColumnReplayQueue({rows:[...n],stickyStartStates:[...e],stickyEndStates:[...i]}),this._afterNextRender({earlyRead:()=>{X=this._getCellWidths(f,r),Y=this._getStickyStartColumnPositions(X,e),K=this._getStickyEndColumnPositions(X,i)},write:()=>{for(const de of n)for(let ye=0;ye<w;ye++){const he=de.children[ye];e[ye]&&this._addStickyStyle(he,P,Y[ye],ye===$),i[ye]&&this._addStickyStyle(he,L,K[ye],ye===Q)}this._positionListener&&X.some(de=>!!de)&&(this._positionListener.stickyColumnsUpdated({sizes:-1===$?[]:X.slice(0,$+1).map((de,ye)=>e[ye]?de:null)}),this._positionListener.stickyEndColumnsUpdated({sizes:-1===Q?[]:X.slice(Q).map((de,ye)=>i[ye+Q]?de:null).reverse()}))}})}stickRows(n,e,i){if(!this._isBrowser)return;const r="bottom"===i?n.slice().reverse():n,l="bottom"===i?e.slice().reverse():e,f=[],w=[],M=[];this._afterNextRender({earlyRead:()=>{for(let P=0,L=0;P<r.length;P++){if(!l[P])continue;f[P]=L;const $=r[P];M[P]=this._isNativeHtmlTable?Array.from($.children):[$];const Q=this._retrieveElementSize($).height;L+=Q,w[P]=Q}},write:()=>{const P=l.lastIndexOf(!0);for(let L=0;L<r.length;L++){if(!l[L])continue;const $=f[L],Q=L===P;for(const X of M[L])this._addStickyStyle(X,i,$,Q)}"top"===i?this._positionListener?.stickyHeaderRowsUpdated({sizes:w,offsets:f,elements:M}):this._positionListener?.stickyFooterRowsUpdated({sizes:w,offsets:f,elements:M})}})}updateStickyFooterContainer(n,e){this._isNativeHtmlTable&&this._afterNextRender({write:()=>{const i=n.querySelector("tfoot");i&&(e.some(r=>!r)?this._removeStickyStyle(i,["bottom"]):this._addStickyStyle(i,"bottom",0,!1))}})}destroy(){this._stickyColumnsReplayTimeout&&clearTimeout(this._stickyColumnsReplayTimeout),this._resizeObserver?.disconnect(),this._destroyed=!0}_removeStickyStyle(n,e){if(n.classList.contains(this._stickCellCss)){for(const r of e)n.style[r]="",n.classList.remove(this._borderCellCss[r]);D5.some(r=>-1===e.indexOf(r)&&n.style[r])?n.style.zIndex=this._getCalculatedZIndex(n):(n.style.zIndex="",this._needsPositionStickyOnElement&&(n.style.position=""),n.classList.remove(this._stickCellCss))}}_addStickyStyle(n,e,i,r){n.classList.add(this._stickCellCss),r&&n.classList.add(this._borderCellCss[e]),n.style[e]=`${i}px`,n.style.zIndex=this._getCalculatedZIndex(n),this._needsPositionStickyOnElement&&(n.style.cssText+="position: -webkit-sticky; position: sticky; ")}_getCalculatedZIndex(n){const e={top:100,bottom:10,left:1,right:1};let i=0;for(const r of D5)n.style[r]&&(i+=e[r]);return i?`${i}`:""}_getCellWidths(n,e=!0){if(!e&&this._cachedCellWidths.length)return this._cachedCellWidths;const i=[],r=n.children;for(let l=0;l<r.length;l++)i.push(this._retrieveElementSize(r[l]).width);return this._cachedCellWidths=i,i}_getStickyStartColumnPositions(n,e){const i=[];let r=0;for(let l=0;l<n.length;l++)e[l]&&(i[l]=r,r+=n[l]);return i}_getStickyEndColumnPositions(n,e){const i=[];let r=0;for(let l=n.length;l>0;l--)e[l]&&(i[l]=r,r+=n[l]);return i}_retrieveElementSize(n){const e=this._elemSizeCache.get(n);if(e)return e;const i=n.getBoundingClientRect(),r={width:i.width,height:i.height};return this._resizeObserver&&(this._elemSizeCache.set(n,r),this._resizeObserver.observe(n,{box:"border-box"})),r}_updateStickyColumnReplayQueue(n){this._removeFromStickyColumnReplayQueue(n.rows),this._stickyColumnsReplayTimeout||this._updatedStickyColumnsParamsToReplay.push(n)}_removeFromStickyColumnReplayQueue(n){const e=new Set(n);for(const i of this._updatedStickyColumnsParamsToReplay)i.rows=i.rows.filter(r=>!e.has(r));this._updatedStickyColumnsParamsToReplay=this._updatedStickyColumnsParamsToReplay.filter(i=>!!i.rows.length)}_updateCachedSizes(n){let e=!1;for(const i of n){const r=i.borderBoxSize?.length?{width:i.borderBoxSize[0].inlineSize,height:i.borderBoxSize[0].blockSize}:{width:i.contentRect.width,height:i.contentRect.height};r.width!==this._elemSizeCache.get(i.target)?.width&&sne(i.target)&&(e=!0),this._elemSizeCache.set(i.target,r)}e&&this._updatedStickyColumnsParamsToReplay.length&&(this._stickyColumnsReplayTimeout&&clearTimeout(this._stickyColumnsReplayTimeout),this._stickyColumnsReplayTimeout=setTimeout(()=>{if(!this._destroyed){for(const i of this._updatedStickyColumnsParamsToReplay)this.updateStickyColumns(i.rows,i.stickyStartStates,i.stickyEndStates,!0,!1);this._updatedStickyColumnsParamsToReplay=[],this._stickyColumnsReplayTimeout=null}},0))}_afterNextRender(n){this._tableInjector?El(n,{injector:this._tableInjector}):this._coalescedStyleScheduler.schedule(()=>{n.earlyRead?.(),n.write()})}}function sne(t){return["cdk-cell","cdk-header-cell","cdk-footer-cell"].some(n=>t.classList.contains(n))}const cP=new _t("CDK_SPL");let dP=(()=>{class t{viewContainer=te(io);elementRef=te(Dn);constructor(){const e=te(jp);e._rowOutlet=this,e._outletAssigned()}static \u0275fac=function(i){return new(i||t)};static \u0275dir=Ht({type:t,selectors:[["","rowOutlet",""]]})}return t})(),uP=(()=>{class t{viewContainer=te(io);elementRef=te(Dn);constructor(){const e=te(jp);e._headerRowOutlet=this,e._outletAssigned()}static \u0275fac=function(i){return new(i||t)};static \u0275dir=Ht({type:t,selectors:[["","headerRowOutlet",""]]})}return t})(),hP=(()=>{class t{viewContainer=te(io);elementRef=te(Dn);constructor(){const e=te(jp);e._footerRowOutlet=this,e._outletAssigned()}static \u0275fac=function(i){return new(i||t)};static \u0275dir=Ht({type:t,selectors:[["","footerRowOutlet",""]]})}return t})(),pP=(()=>{class t{viewContainer=te(io);elementRef=te(Dn);constructor(){const e=te(jp);e._noDataRowOutlet=this,e._outletAssigned()}static \u0275fac=function(i){return new(i||t)};static \u0275dir=Ht({type:t,selectors:[["","noDataRowOutlet",""]]})}return t})(),FT=(()=>{class t{_differs=te(Ig);_changeDetectorRef=te(Do);_elementRef=te(Dn);_dir=te(Bc,{optional:!0});_platform=te(xs);_viewRepeater=te(XC);_coalescedStyleScheduler=te(rP);_viewportRuler=te(JM);_stickyPositioningListener=te(cP,{optional:!0,skipSelf:!0});_document=te(mr);_data;_onDestroy=new Et;_renderRows;_renderChangeSubscription;_columnDefsByName=new Map;_rowDefs;_headerRowDefs;_footerRowDefs;_dataDiffer;_defaultRowDef;_customColumnDefs=new Set;_customRowDefs=new Set;_customHeaderRowDefs=new Set;_customFooterRowDefs=new Set;_customNoDataRow;_headerRowDefChanged=!0;_footerRowDefChanged=!0;_stickyColumnStylesNeedReset=!0;_forceRecalculateCellWidths=!0;_cachedRenderRowsMap=new Map;_isNativeHtmlTable;_stickyStyler;stickyCssClass="cdk-table-sticky";needsPositionStickyOnElement=!0;_isServer;_isShowingNoDataRow=!1;_hasAllOutlets=!1;_hasInitialized=!1;_getCellRole(){if(void 0===this._cellRoleInternal){const e=this._elementRef.nativeElement.getAttribute("role");return"grid"===e||"treegrid"===e?"gridcell":"cell"}return this._cellRoleInternal}_cellRoleInternal=void 0;get trackBy(){return this._trackByFn}set trackBy(e){this._trackByFn=e}_trackByFn;get dataSource(){return this._dataSource}set dataSource(e){this._dataSource!==e&&this._switchDataSource(e)}_dataSource;get multiTemplateDataRows(){return this._multiTemplateDataRows}set multiTemplateDataRows(e){this._multiTemplateDataRows=e,this._rowOutlet&&this._rowOutlet.viewContainer.length&&(this._forceRenderDataRows(),this.updateStickyColumnStyles())}_multiTemplateDataRows=!1;get fixedLayout(){return this._fixedLayout}set fixedLayout(e){this._fixedLayout=e,this._forceRecalculateCellWidths=!0,this._stickyColumnStylesNeedReset=!0}_fixedLayout=!1;contentChanged=new $e;viewChange=new pn({start:0,end:Number.MAX_VALUE});_rowOutlet;_headerRowOutlet;_footerRowOutlet;_noDataRowOutlet;_contentColumnDefs;_contentRowDefs;_contentHeaderRowDefs;_contentFooterRowDefs;_noDataRow;_injector=te(we);constructor(){te(new Ee("role"),{optional:!0})||this._elementRef.nativeElement.setAttribute("role","table"),this._isServer=!this._platform.isBrowser,this._isNativeHtmlTable="TABLE"===this._elementRef.nativeElement.nodeName,this._dataDiffer=this._differs.find([]).create((i,r)=>this.trackBy?this.trackBy(r.dataIndex,r.data):r)}ngOnInit(){this._setupStickyStyler(),this._viewportRuler.change().pipe(jr(this._onDestroy)).subscribe(()=>{this._forceRecalculateCellWidths=!0})}ngAfterContentInit(){this._hasInitialized=!0}ngAfterContentChecked(){this._canRender()&&this._render()}ngOnDestroy(){this._stickyStyler?.destroy(),[this._rowOutlet?.viewContainer,this._headerRowOutlet?.viewContainer,this._footerRowOutlet?.viewContainer,this._cachedRenderRowsMap,this._customColumnDefs,this._customRowDefs,this._customHeaderRowDefs,this._customFooterRowDefs,this._columnDefsByName].forEach(e=>{e?.clear()}),this._headerRowDefs=[],this._footerRowDefs=[],this._defaultRowDef=null,this._onDestroy.next(),this._onDestroy.complete(),eP(this.dataSource)&&this.dataSource.disconnect(this)}renderRows(){this._renderRows=this._getAllRenderRows();const e=this._dataDiffer.diff(this._renderRows);if(!e)return this._updateNoDataRow(),void this.contentChanged.next();const i=this._rowOutlet.viewContainer;this._viewRepeater.applyChanges(e,i,(r,l,f)=>this._getEmbeddedViewArgs(r.item,f),r=>r.item.data,r=>{r.operation===am.INSERTED&&r.context&&this._renderCellTemplateForItem(r.record.item.rowDef,r.context)}),this._updateRowIndexContext(),e.forEachIdentityChange(r=>{i.get(r.currentIndex).context.$implicit=r.item.data}),this._updateNoDataRow(),this.contentChanged.next(),this.updateStickyColumnStyles()}addColumnDef(e){this._customColumnDefs.add(e)}removeColumnDef(e){this._customColumnDefs.delete(e)}addRowDef(e){this._customRowDefs.add(e)}removeRowDef(e){this._customRowDefs.delete(e)}addHeaderRowDef(e){this._customHeaderRowDefs.add(e),this._headerRowDefChanged=!0}removeHeaderRowDef(e){this._customHeaderRowDefs.delete(e),this._headerRowDefChanged=!0}addFooterRowDef(e){this._customFooterRowDefs.add(e),this._footerRowDefChanged=!0}removeFooterRowDef(e){this._customFooterRowDefs.delete(e),this._footerRowDefChanged=!0}setNoDataRow(e){this._customNoDataRow=e}updateStickyHeaderRowStyles(){const e=this._getRenderedRows(this._headerRowOutlet);if(this._isNativeHtmlTable){const r=M5(this._headerRowOutlet,"thead");r&&(r.style.display=e.length?"":"none")}const i=this._headerRowDefs.map(r=>r.sticky);this._stickyStyler.clearStickyPositioning(e,["top"]),this._stickyStyler.stickRows(e,i,"top"),this._headerRowDefs.forEach(r=>r.resetStickyChanged())}updateStickyFooterRowStyles(){const e=this._getRenderedRows(this._footerRowOutlet);if(this._isNativeHtmlTable){const r=M5(this._footerRowOutlet,"tfoot");r&&(r.style.display=e.length?"":"none")}const i=this._footerRowDefs.map(r=>r.sticky);this._stickyStyler.clearStickyPositioning(e,["bottom"]),this._stickyStyler.stickRows(e,i,"bottom"),this._stickyStyler.updateStickyFooterContainer(this._elementRef.nativeElement,i),this._footerRowDefs.forEach(r=>r.resetStickyChanged())}updateStickyColumnStyles(){const e=this._getRenderedRows(this._headerRowOutlet),i=this._getRenderedRows(this._rowOutlet),r=this._getRenderedRows(this._footerRowOutlet);(this._isNativeHtmlTable&&!this._fixedLayout||this._stickyColumnStylesNeedReset)&&(this._stickyStyler.clearStickyPositioning([...e,...i,...r],["left","right"]),this._stickyColumnStylesNeedReset=!1),e.forEach((l,f)=>{this._addStickyColumnStyles([l],this._headerRowDefs[f])}),this._rowDefs.forEach(l=>{const f=[];for(let w=0;w<i.length;w++)this._renderRows[w].rowDef===l&&f.push(i[w]);this._addStickyColumnStyles(f,l)}),r.forEach((l,f)=>{this._addStickyColumnStyles([l],this._footerRowDefs[f])}),Array.from(this._columnDefsByName.values()).forEach(l=>l.resetStickyChanged())}_outletAssigned(){!this._hasAllOutlets&&this._rowOutlet&&this._headerRowOutlet&&this._footerRowOutlet&&this._noDataRowOutlet&&(this._hasAllOutlets=!0,this._canRender()&&this._render())}_canRender(){return this._hasAllOutlets&&this._hasInitialized}_render(){this._cacheRowDefs(),this._cacheColumnDefs();const i=this._renderUpdatedColumns()||this._headerRowDefChanged||this._footerRowDefChanged;this._stickyColumnStylesNeedReset=this._stickyColumnStylesNeedReset||i,this._forceRecalculateCellWidths=i,this._headerRowDefChanged&&(this._forceRenderHeaderRows(),this._headerRowDefChanged=!1),this._footerRowDefChanged&&(this._forceRenderFooterRows(),this._footerRowDefChanged=!1),this.dataSource&&this._rowDefs.length>0&&!this._renderChangeSubscription?this._observeRenderChanges():this._stickyColumnStylesNeedReset&&this.updateStickyColumnStyles(),this._checkStickyStates()}_getAllRenderRows(){const e=[],i=this._cachedRenderRowsMap;if(this._cachedRenderRowsMap=new Map,!this._data)return e;for(let r=0;r<this._data.length;r++){let l=this._data[r];const f=this._getRenderRowsForData(l,r,i.get(l));this._cachedRenderRowsMap.has(l)||this._cachedRenderRowsMap.set(l,new WeakMap);for(let w=0;w<f.length;w++){let M=f[w];const P=this._cachedRenderRowsMap.get(M.data);P.has(M.rowDef)?P.get(M.rowDef).push(M):P.set(M.rowDef,[M]),e.push(M)}}return e}_getRenderRowsForData(e,i,r){return this._getRowDefs(e,i).map(f=>{const w=r&&r.has(f)?r.get(f):[];if(w.length){const M=w.shift();return M.dataIndex=i,M}return{data:e,rowDef:f,dataIndex:i}})}_cacheColumnDefs(){this._columnDefsByName.clear(),LT(this._getOwnDefs(this._contentColumnDefs),this._customColumnDefs).forEach(i=>{this._columnDefsByName.has(i.name),this._columnDefsByName.set(i.name,i)})}_cacheRowDefs(){this._headerRowDefs=LT(this._getOwnDefs(this._contentHeaderRowDefs),this._customHeaderRowDefs),this._footerRowDefs=LT(this._getOwnDefs(this._contentFooterRowDefs),this._customFooterRowDefs),this._rowDefs=LT(this._getOwnDefs(this._contentRowDefs),this._customRowDefs);const e=this._rowDefs.filter(i=>!i.when);this._defaultRowDef=e[0]}_renderUpdatedColumns(){const e=(f,w)=>{const M=!!w.getColumnsDiff();return f||M},i=this._rowDefs.reduce(e,!1);i&&this._forceRenderDataRows();const r=this._headerRowDefs.reduce(e,!1);r&&this._forceRenderHeaderRows();const l=this._footerRowDefs.reduce(e,!1);return l&&this._forceRenderFooterRows(),i||r||l}_switchDataSource(e){this._data=[],eP(this.dataSource)&&this.dataSource.disconnect(this),this._renderChangeSubscription&&(this._renderChangeSubscription.unsubscribe(),this._renderChangeSubscription=null),e||(this._dataDiffer&&this._dataDiffer.diff([]),this._rowOutlet&&this._rowOutlet.viewContainer.clear()),this._dataSource=e}_observeRenderChanges(){if(!this.dataSource)return;let e;eP(this.dataSource)?e=this.dataSource.connect(this):iC(this.dataSource)?e=this.dataSource:Array.isArray(this.dataSource)&&(e=Fn(this.dataSource)),this._renderChangeSubscription=e.pipe(jr(this._onDestroy)).subscribe(i=>{this._data=i||[],this.renderRows()})}_forceRenderHeaderRows(){this._headerRowOutlet.viewContainer.length>0&&this._headerRowOutlet.viewContainer.clear(),this._headerRowDefs.forEach((e,i)=>this._renderRow(this._headerRowOutlet,e,i)),this.updateStickyHeaderRowStyles()}_forceRenderFooterRows(){this._footerRowOutlet.viewContainer.length>0&&this._footerRowOutlet.viewContainer.clear(),this._footerRowDefs.forEach((e,i)=>this._renderRow(this._footerRowOutlet,e,i)),this.updateStickyFooterRowStyles()}_addStickyColumnStyles(e,i){const r=Array.from(i?.columns||[]).map(w=>this._columnDefsByName.get(w)),l=r.map(w=>w.sticky),f=r.map(w=>w.stickyEnd);this._stickyStyler.updateStickyColumns(e,l,f,!this._fixedLayout||this._forceRecalculateCellWidths)}_getRenderedRows(e){const i=[];for(let r=0;r<e.viewContainer.length;r++){const l=e.viewContainer.get(r);i.push(l.rootNodes[0])}return i}_getRowDefs(e,i){if(1==this._rowDefs.length)return[this._rowDefs[0]];let r=[];if(this.multiTemplateDataRows)r=this._rowDefs.filter(l=>!l.when||l.when(i,e));else{let l=this._rowDefs.find(f=>f.when&&f.when(i,e))||this._defaultRowDef;l&&r.push(l)}return r}_getEmbeddedViewArgs(e,i){return{templateRef:e.rowDef.template,context:{$implicit:e.data},index:i}}_renderRow(e,i,r,l={}){const f=e.viewContainer.createEmbeddedView(i.template,l,r);return this._renderCellTemplateForItem(i,l),f}_renderCellTemplateForItem(e,i){for(let r of this._getCellTemplates(e))cm.mostRecentCellOutlet&&cm.mostRecentCellOutlet._viewContainer.createEmbeddedView(r,i);this._changeDetectorRef.markForCheck()}_updateRowIndexContext(){const e=this._rowOutlet.viewContainer;for(let i=0,r=e.length;i<r;i++){const f=e.get(i).context;f.count=r,f.first=0===i,f.last=i===r-1,f.even=i%2==0,f.odd=!f.even,this.multiTemplateDataRows?(f.dataIndex=this._renderRows[i].dataIndex,f.renderIndex=i):f.index=this._renderRows[i].dataIndex}}_getCellTemplates(e){return e&&e.columns?Array.from(e.columns,i=>{const r=this._columnDefsByName.get(i);return e.extractCellTemplate(r)}):[]}_forceRenderDataRows(){this._dataDiffer.diff([]),this._rowOutlet.viewContainer.clear(),this.renderRows()}_checkStickyStates(){const e=(i,r)=>i||r.hasStickyChanged();this._headerRowDefs.reduce(e,!1)&&this.updateStickyHeaderRowStyles(),this._footerRowDefs.reduce(e,!1)&&this.updateStickyFooterRowStyles(),Array.from(this._columnDefsByName.values()).reduce(e,!1)&&(this._stickyColumnStylesNeedReset=!0,this.updateStickyColumnStyles())}_setupStickyStyler(){this._stickyStyler=new one(this._isNativeHtmlTable,this.stickyCssClass,this._dir?this._dir.value:"ltr",this._coalescedStyleScheduler,this._platform.isBrowser,this.needsPositionStickyOnElement,this._stickyPositioningListener,this._injector),(this._dir?this._dir.change:Fn()).pipe(jr(this._onDestroy)).subscribe(i=>{this._stickyStyler.direction=i,this.updateStickyColumnStyles()})}_getOwnDefs(e){return e.filter(i=>!i._table||i._table===this)}_updateNoDataRow(){const e=this._customNoDataRow||this._noDataRow;if(!e)return;const i=0===this._rowOutlet.viewContainer.length;if(i===this._isShowingNoDataRow)return;const r=this._noDataRowOutlet.viewContainer;if(i){const l=r.createEmbeddedView(e.templateRef),f=l.rootNodes[0];1===l.rootNodes.length&&f?.nodeType===this._document.ELEMENT_NODE&&(f.setAttribute("role","row"),f.classList.add(e._contentClassName))}else r.clear();this._isShowingNoDataRow=i,this._changeDetectorRef.markForCheck()}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=kn({type:t,selectors:[["cdk-table"],["table","cdk-table",""]],contentQueries:function(i,r,l){if(1&i&&(ro(l,OT,5),ro(l,lm,5),ro(l,PT,5),ro(l,KC,5),ro(l,QC,5)),2&i){let f;Zn(f=Xn())&&(r._noDataRow=f.first),Zn(f=Xn())&&(r._contentColumnDefs=f),Zn(f=Xn())&&(r._contentRowDefs=f),Zn(f=Xn())&&(r._contentHeaderRowDefs=f),Zn(f=Xn())&&(r._contentFooterRowDefs=f)}},hostAttrs:[1,"cdk-table"],hostVars:2,hostBindings:function(i,r){2&i&&Di("cdk-table-fixed-layout",r.fixedLayout)},inputs:{trackBy:"trackBy",dataSource:"dataSource",multiTemplateDataRows:[2,"multiTemplateDataRows","multiTemplateDataRows",Un],fixedLayout:[2,"fixedLayout","fixedLayout",Un]},outputs:{contentChanged:"contentChanged"},exportAs:["cdkTable"],features:[pi([{provide:jp,useExisting:t},{provide:XC,useClass:w5},{provide:rP,useClass:S5},{provide:cP,useValue:null}])],ngContentSelectors:Qte,decls:5,vars:2,consts:[["role","rowgroup"],["headerRowOutlet",""],["rowOutlet",""],["noDataRowOutlet",""],["footerRowOutlet",""]],template:function(i,r){1&i&&(os(Kte),Fi(0),Fi(1,1),vt(2,Jte,1,0)(3,ene,7,0)(4,tne,4,0)),2&i&&(xe(2),qi(r._isServer?2:-1),xe(),qi(r._isNativeHtmlTable?3:4))},dependencies:[uP,dP,pP,hP],styles:[".cdk-table-fixed-layout{table-layout:fixed}\n"],encapsulation:2})}return t})();function LT(t,n){return t.concat(Array.from(n))}function M5(t,n){const e=n.toUpperCase();let i=t.viewContainer.element.nativeElement;for(;i;){const r=1===i.nodeType?i.nodeName:null;if(r===e)return i;if("TABLE"===r)break;i=i.parentNode}return null}let lne=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275mod=Er({type:t});static \u0275inj=Ai({imports:[aR]})}return t})();const cne=[[["caption"]],[["colgroup"],["col"]],"*"],dne=["caption","colgroup, col","*"];function une(t,n){1&t&&Fi(0,2)}function hne(t,n){1&t&&(ae(0,"thead",0),ia(1,1),le(),ae(2,"tbody",2),ia(3,3)(4,4),le(),ae(5,"tfoot",0),ia(6,5),le())}function pne(t,n){1&t&&ia(0,1)(1,3)(2,4)(3,5)}let JC=(()=>{class t extends FT{stickyCssClass="mat-mdc-table-sticky";needsPositionStickyOnElement=!1;static \u0275fac=(()=>{let e;return function(r){return(e||(e=m(t)))(r||t)}})();static \u0275cmp=kn({type:t,selectors:[["mat-table"],["table","mat-table",""]],hostAttrs:[1,"mat-mdc-table","mdc-data-table__table"],hostVars:2,hostBindings:function(i,r){2&i&&Di("mdc-table-fixed-layout",r.fixedLayout)},exportAs:["matTable"],features:[pi([{provide:FT,useExisting:t},{provide:jp,useExisting:t},{provide:rP,useClass:S5},{provide:XC,useClass:w5},{provide:cP,useValue:null}]),Nn],ngContentSelectors:dne,decls:5,vars:2,consts:[["role","rowgroup"],["headerRowOutlet",""],["role","rowgroup",1,"mdc-data-table__content"],["rowOutlet",""],["noDataRowOutlet",""],["footerRowOutlet",""]],template:function(i,r){1&i&&(os(cne),Fi(0),Fi(1,1),vt(2,une,1,0)(3,hne,7,0)(4,pne,4,0)),2&i&&(xe(2),qi(r._isServer?2:-1),xe(),qi(r._isNativeHtmlTable?3:4))},dependencies:[uP,dP,pP,hP],styles:[".mat-mdc-table-sticky{position:sticky !important}mat-table{display:block}mat-header-row{min-height:56px}mat-row,mat-footer-row{min-height:48px}mat-row,mat-header-row,mat-footer-row{display:flex;border-width:0;border-bottom-width:1px;border-style:solid;align-items:center;box-sizing:border-box}mat-cell:first-of-type,mat-header-cell:first-of-type,mat-footer-cell:first-of-type{padding-left:24px}[dir=rtl] mat-cell:first-of-type:not(:only-of-type),[dir=rtl] mat-header-cell:first-of-type:not(:only-of-type),[dir=rtl] mat-footer-cell:first-of-type:not(:only-of-type){padding-left:0;padding-right:24px}mat-cell:last-of-type,mat-header-cell:last-of-type,mat-footer-cell:last-of-type{padding-right:24px}[dir=rtl] mat-cell:last-of-type:not(:only-of-type),[dir=rtl] mat-header-cell:last-of-type:not(:only-of-type),[dir=rtl] mat-footer-cell:last-of-type:not(:only-of-type){padding-right:0;padding-left:24px}mat-cell,mat-header-cell,mat-footer-cell{flex:1;display:flex;align-items:center;overflow:hidden;word-wrap:break-word;min-height:inherit}.mat-mdc-table{min-width:100%;border:0;border-spacing:0;table-layout:auto;white-space:normal;background-color:var(--mat-table-background-color, var(--mat-sys-surface))}.mdc-data-table__cell{box-sizing:border-box;overflow:hidden;text-align:left;text-overflow:ellipsis}[dir=rtl] .mdc-data-table__cell{text-align:right}.mdc-data-table__cell,.mdc-data-table__header-cell{padding:0 16px}.mat-mdc-header-row{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;height:var(--mat-table-header-container-height, 56px);color:var(--mat-table-header-headline-color, var(--mat-sys-on-surface, rgba(0, 0, 0, 0.87)));font-family:var(--mat-table-header-headline-font, var(--mat-sys-title-small-font, Roboto, sans-serif));line-height:var(--mat-table-header-headline-line-height, var(--mat-sys-title-small-line-height));font-size:var(--mat-table-header-headline-size, var(--mat-sys-title-small-size, 14px));font-weight:var(--mat-table-header-headline-weight, var(--mat-sys-title-small-weight, 500))}.mat-mdc-row{height:var(--mat-table-row-item-container-height, 52px);color:var(--mat-table-row-item-label-text-color, var(--mat-sys-on-surface, rgba(0, 0, 0, 0.87)))}.mat-mdc-row,.mdc-data-table__content{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:var(--mat-table-row-item-label-text-font, var(--mat-sys-body-medium-font, Roboto, sans-serif));line-height:var(--mat-table-row-item-label-text-line-height, var(--mat-sys-body-medium-line-height));font-size:var(--mat-table-row-item-label-text-size, var(--mat-sys-body-medium-size, 14px));font-weight:var(--mat-table-row-item-label-text-weight, var(--mat-sys-body-medium-weight))}.mat-mdc-footer-row{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;height:var(--mat-table-footer-container-height, 52px);color:var(--mat-table-row-item-label-text-color, var(--mat-sys-on-surface, rgba(0, 0, 0, 0.87)));font-family:var(--mat-table-footer-supporting-text-font, var(--mat-sys-body-medium-font, Roboto, sans-serif));line-height:var(--mat-table-footer-supporting-text-line-height, var(--mat-sys-body-medium-line-height));font-size:var(--mat-table-footer-supporting-text-size, var(--mat-sys-body-medium-size, 14px));font-weight:var(--mat-table-footer-supporting-text-weight, var(--mat-sys-body-medium-weight));letter-spacing:var(--mat-table-footer-supporting-text-tracking, var(--mat-sys-body-medium-tracking))}.mat-mdc-header-cell{border-bottom-color:var(--mat-table-row-item-outline-color, var(--mat-sys-outline, rgba(0, 0, 0, 0.12)));border-bottom-width:var(--mat-table-row-item-outline-width, 1px);border-bottom-style:solid;letter-spacing:var(--mat-table-header-headline-tracking, var(--mat-sys-title-small-tracking));font-weight:inherit;line-height:inherit;box-sizing:border-box;text-overflow:ellipsis;overflow:hidden;outline:none;text-align:left}[dir=rtl] .mat-mdc-header-cell{text-align:right}.mdc-data-table__row:last-child>.mat-mdc-header-cell{border-bottom:none}.mat-mdc-cell{border-bottom-color:var(--mat-table-row-item-outline-color, var(--mat-sys-outline, rgba(0, 0, 0, 0.12)));border-bottom-width:var(--mat-table-row-item-outline-width, 1px);border-bottom-style:solid;letter-spacing:var(--mat-table-row-item-label-text-tracking, var(--mat-sys-body-medium-tracking));line-height:inherit}.mdc-data-table__row:last-child>.mat-mdc-cell{border-bottom:none}.mat-mdc-footer-cell{letter-spacing:var(--mat-table-row-item-label-text-tracking, var(--mat-sys-body-medium-tracking))}mat-row.mat-mdc-row,mat-header-row.mat-mdc-header-row,mat-footer-row.mat-mdc-footer-row{border-bottom:none}.mat-mdc-table tbody,.mat-mdc-table tfoot,.mat-mdc-table thead,.mat-mdc-cell,.mat-mdc-footer-cell,.mat-mdc-header-row,.mat-mdc-row,.mat-mdc-footer-row,.mat-mdc-table .mat-mdc-header-cell{background:inherit}.mat-mdc-table mat-header-row.mat-mdc-header-row,.mat-mdc-table mat-row.mat-mdc-row,.mat-mdc-table mat-footer-row.mat-mdc-footer-cell{height:unset}mat-header-cell.mat-mdc-header-cell,mat-cell.mat-mdc-cell,mat-footer-cell.mat-mdc-footer-cell{align-self:stretch}\n"],encapsulation:2})}return t})(),Z0=(()=>{class t extends W0{static \u0275fac=(()=>{let e;return function(r){return(e||(e=m(t)))(r||t)}})();static \u0275dir=Ht({type:t,selectors:[["","matCellDef",""]],features:[pi([{provide:W0,useExisting:t}]),Nn]})}return t})(),X0=(()=>{class t extends Y0{static \u0275fac=(()=>{let e;return function(r){return(e||(e=m(t)))(r||t)}})();static \u0275dir=Ht({type:t,selectors:[["","matHeaderCellDef",""]],features:[pi([{provide:Y0,useExisting:t}]),Nn]})}return t})(),K0=(()=>{class t extends lm{get name(){return this._name}set name(e){this._setNameInput(e)}_updateColumnCssClassName(){super._updateColumnCssClassName(),this._columnCssClassName.push(`mat-column-${this.cssClassFriendlyName}`)}static \u0275fac=(()=>{let e;return function(r){return(e||(e=m(t)))(r||t)}})();static \u0275dir=Ht({type:t,selectors:[["","matColumnDef",""]],inputs:{name:[0,"matColumnDef","name"]},features:[pi([{provide:lm,useExisting:t},{provide:"MAT_SORT_HEADER_COLUMN_DEF",useExisting:t}]),Nn]})}return t})(),Q0=(()=>{class t extends nP{static \u0275fac=(()=>{let e;return function(r){return(e||(e=m(t)))(r||t)}})();static \u0275dir=Ht({type:t,selectors:[["mat-header-cell"],["th","mat-header-cell",""]],hostAttrs:["role","columnheader",1,"mat-mdc-header-cell","mdc-data-table__header-cell"],features:[Nn]})}return t})(),J0=(()=>{class t extends iP{static \u0275fac=(()=>{let e;return function(r){return(e||(e=m(t)))(r||t)}})();static \u0275dir=Ht({type:t,selectors:[["mat-cell"],["td","mat-cell",""]],hostAttrs:[1,"mat-mdc-cell","mdc-data-table__cell"],features:[Nn]})}return t})(),eE=(()=>{class t extends KC{static \u0275fac=(()=>{let e;return function(r){return(e||(e=m(t)))(r||t)}})();static \u0275dir=Ht({type:t,selectors:[["","matHeaderRowDef",""]],inputs:{columns:[0,"matHeaderRowDef","columns"],sticky:[2,"matHeaderRowDefSticky","sticky",Un]},features:[pi([{provide:KC,useExisting:t}]),Nn]})}return t})(),tE=(()=>{class t extends PT{static \u0275fac=(()=>{let e;return function(r){return(e||(e=m(t)))(r||t)}})();static \u0275dir=Ht({type:t,selectors:[["","matRowDef",""]],inputs:{columns:[0,"matRowDefColumns","columns"],when:[0,"matRowDefWhen","when"]},features:[pi([{provide:PT,useExisting:t}]),Nn]})}return t})(),nE=(()=>{class t extends sP{static \u0275fac=(()=>{let e;return function(r){return(e||(e=m(t)))(r||t)}})();static \u0275cmp=kn({type:t,selectors:[["mat-header-row"],["tr","mat-header-row",""]],hostAttrs:["role","row",1,"mat-mdc-header-row","mdc-data-table__header-row"],exportAs:["matHeaderRow"],features:[pi([{provide:sP,useExisting:t}]),Nn],decls:1,vars:0,consts:[["cdkCellOutlet",""]],template:function(i,r){1&i&&ia(0,0)},dependencies:[cm],encapsulation:2})}return t})(),iE=(()=>{class t extends lP{static \u0275fac=(()=>{let e;return function(r){return(e||(e=m(t)))(r||t)}})();static \u0275cmp=kn({type:t,selectors:[["mat-row"],["tr","mat-row",""]],hostAttrs:["role","row",1,"mat-mdc-row","mdc-data-table__row"],exportAs:["matRow"],features:[pi([{provide:lP,useExisting:t}]),Nn],decls:1,vars:0,consts:[["cdkCellOutlet",""]],template:function(i,r){1&i&&ia(0,0)},dependencies:[cm],encapsulation:2})}return t})(),NT=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275mod=Er({type:t});static \u0275inj=Ai({imports:[Qr,lne,Qr]})}return t})();class I5 extends Et{constructor(n=1/0,e=1/0,i=eR){super(),this._bufferSize=n,this._windowTime=e,this._timestampProvider=i,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=e===1/0,this._bufferSize=Math.max(1,n),this._windowTime=Math.max(1,e)}next(n){const{isStopped:e,_buffer:i,_infiniteTimeWindow:r,_timestampProvider:l,_windowTime:f}=this;e||(i.push(n),!r&&i.push(l.now()+f)),this._trimBuffer(),super.next(n)}_subscribe(n){this._throwIfClosed(),this._trimBuffer();const e=this._innerSubscribe(n),{_infiniteTimeWindow:i,_buffer:r}=this,l=r.slice();for(let f=0;f<l.length&&!n.closed;f+=i?1:2)n.next(l[f]);return this._checkFinalizedStatuses(n),e}_trimBuffer(){const{_bufferSize:n,_timestampProvider:e,_buffer:i,_infiniteTimeWindow:r}=this,l=(r?1:2)*n;if(n<1/0&&l<i.length&&i.splice(0,i.length-l),!r){const f=e.now();let w=0;for(let M=1;M<i.length&&i[M]<=f;M+=2)w=M;w&&i.splice(0,w+1)}}}function qg(t){return null!=t&&"false"!=`${t}`}class Ene{_box;_destroyed=new Et;_resizeSubject=new Et;_resizeObserver;_elementObservables=new Map;constructor(n){this._box=n,typeof ResizeObserver<"u"&&(this._resizeObserver=new ResizeObserver(e=>this._resizeSubject.next(e)))}observe(n){return this._elementObservables.has(n)||this._elementObservables.set(n,new Qe(e=>{const i=this._resizeSubject.subscribe(e);return this._resizeObserver?.observe(n,{box:this._box}),()=>{this._resizeObserver?.unobserve(n),i.unsubscribe(),this._elementObservables.delete(n)}}).pipe(bs(e=>e.some(i=>i.target===n)),function Cne(t,n,e){let i,r=!1;return t&&"object"==typeof t?({bufferSize:i=1/0,windowTime:n=1/0,refCount:r=!1,scheduler:e}=t):i=t??1/0,s5({connector:()=>new I5(i,n,e),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:r})}({bufferSize:1,refCount:!0}),jr(this._destroyed))),this._elementObservables.get(n)}destroy(){this._destroyed.next(),this._destroyed.complete(),this._resizeSubject.complete(),this._elementObservables.clear()}}let Sne=(()=>{class t{_cleanupErrorListener;_observers=new Map;_ngZone=te(wt);constructor(){}ngOnDestroy(){for(const[,e]of this._observers)e.destroy();this._observers.clear(),this._cleanupErrorListener?.()}observe(e,i){const r=i?.box||"content-box";return this._observers.has(r)||this._observers.set(r,new Ene(r)),this._observers.get(r).observe(e)}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();const Dne=["notch"],Mne=["matFormFieldNotchedOutline",""],Tne=["*"],Ine=["textField"],Ane=["iconPrefixContainer"],kne=["textPrefixContainer"],Rne=["iconSuffixContainer"],Pne=["textSuffixContainer"],One=["*",[["mat-label"]],[["","matPrefix",""],["","matIconPrefix",""]],[["","matTextPrefix",""]],[["","matTextSuffix",""]],[["","matSuffix",""],["","matIconSuffix",""]],[["mat-error"],["","matError",""]],[["mat-hint",3,"align","end"]],[["mat-hint","align","end"]]],Fne=["*","mat-label","[matPrefix], [matIconPrefix]","[matTextPrefix]","[matTextSuffix]","[matSuffix], [matIconSuffix]","mat-error, [matError]","mat-hint:not([align='end'])","mat-hint[align='end']"];function Lne(t,n){1&t&&Wt(0,"span",20)}function Nne(t,n){if(1&t&&(ae(0,"label",19),Fi(1,1),vt(2,Lne,1,0,"span",20),le()),2&t){const e=Lt(2);Xe("floating",e._shouldLabelFloat())("monitorResize",e._hasOutline())("id",e._labelId),ii("for",e._control.disableAutomaticLabeling?null:e._control.id),xe(2),qi(!e.hideRequiredMarker&&e._control.required?2:-1)}}function zne(t,n){1&t&&vt(0,Nne,3,5,"label",19),2&t&&qi(Lt()._hasFloatingLabel()?0:-1)}function Bne(t,n){1&t&&Wt(0,"div",7)}function Vne(t,n){}function Une(t,n){1&t&&vt(0,Vne,0,0,"ng-template",13),2&t&&(Lt(2),Xe("ngTemplateOutlet",Ed(1)))}function jne(t,n){if(1&t&&(ae(0,"div",9),vt(1,Une,1,1,null,13),le()),2&t){const e=Lt();Xe("matFormFieldNotchedOutlineOpen",e._shouldLabelFloat()),xe(),qi(e._forceDisplayInfixLabel()?-1:1)}}function Hne(t,n){1&t&&(ae(0,"div",10,2),Fi(2,2),le())}function $ne(t,n){1&t&&(ae(0,"div",11,3),Fi(2,3),le())}function Gne(t,n){}function qne(t,n){1&t&&vt(0,Gne,0,0,"ng-template",13),2&t&&(Lt(),Xe("ngTemplateOutlet",Ed(1)))}function Wne(t,n){1&t&&(ae(0,"div",14,4),Fi(2,4),le())}function Yne(t,n){1&t&&(ae(0,"div",15,5),Fi(2,5),le())}function Zne(t,n){1&t&&Wt(0,"div",16)}function Xne(t,n){1&t&&Fi(0,6)}function Kne(t,n){if(1&t&&(ae(0,"mat-hint",21),Re(1),le()),2&t){const e=Lt(2);Xe("id",e._hintLabelId),xe(),er(e.hintLabel)}}function Qne(t,n){1&t&&(vt(0,Kne,2,2,"mat-hint",21),Fi(1,7),Wt(2,"div",22),Fi(3,8)),2&t&&qi(Lt().hintLabel?0:-1)}let ex=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275dir=Ht({type:t,selectors:[["mat-label"]]})}return t})();const A5=new _t("MatError");let Jne=(()=>{class t{id=te(Sa).getId("mat-mdc-error-");constructor(){}static \u0275fac=function(i){return new(i||t)};static \u0275dir=Ht({type:t,selectors:[["mat-error"],["","matError",""]],hostAttrs:[1,"mat-mdc-form-field-error","mat-mdc-form-field-bottom-align"],hostVars:1,hostBindings:function(i,r){2&i&&rc("id",r.id)},inputs:{id:"id"},features:[pi([{provide:A5,useExisting:t}])]})}return t})(),k5=(()=>{class t{align="start";id=te(Sa).getId("mat-mdc-hint-");static \u0275fac=function(i){return new(i||t)};static \u0275dir=Ht({type:t,selectors:[["mat-hint"]],hostAttrs:[1,"mat-mdc-form-field-hint","mat-mdc-form-field-bottom-align"],hostVars:4,hostBindings:function(i,r){2&i&&(rc("id",r.id),ii("align",null),Di("mat-mdc-form-field-hint-end","end"===r.align))},inputs:{align:"align",id:"id"}})}return t})();const eie=new _t("MatPrefix"),R5=new _t("MatSuffix");let tie=(()=>{class t{set _isTextSelector(e){this._isText=!0}_isText=!1;static \u0275fac=function(i){return new(i||t)};static \u0275dir=Ht({type:t,selectors:[["","matSuffix",""],["","matIconSuffix",""],["","matTextSuffix",""]],inputs:{_isTextSelector:[0,"matTextSuffix","_isTextSelector"]},features:[pi([{provide:R5,useExisting:t}])]})}return t})();const P5=new _t("FloatingLabelParent");let O5=(()=>{class t{_elementRef=te(Dn);get floating(){return this._floating}set floating(e){this._floating=e,this.monitorResize&&this._handleResize()}_floating=!1;get monitorResize(){return this._monitorResize}set monitorResize(e){this._monitorResize=e,this._monitorResize?this._subscribeToResize():this._resizeSubscription.unsubscribe()}_monitorResize=!1;_resizeObserver=te(Sne);_ngZone=te(wt);_parent=te(P5);_resizeSubscription=new Mi;constructor(){}ngOnDestroy(){this._resizeSubscription.unsubscribe()}getWidth(){return function nie(t){if(null!==t.offsetParent)return t.scrollWidth;const e=t.cloneNode(!0);e.style.setProperty("position","absolute"),e.style.setProperty("transform","translate(-9999px, -9999px)"),document.documentElement.appendChild(e);const i=e.scrollWidth;return e.remove(),i}(this._elementRef.nativeElement)}get element(){return this._elementRef.nativeElement}_handleResize(){setTimeout(()=>this._parent._handleLabelResized())}_subscribeToResize(){this._resizeSubscription.unsubscribe(),this._ngZone.runOutsideAngular(()=>{this._resizeSubscription=this._resizeObserver.observe(this._elementRef.nativeElement,{box:"border-box"}).subscribe(()=>this._handleResize())})}static \u0275fac=function(i){return new(i||t)};static \u0275dir=Ht({type:t,selectors:[["label","matFormFieldFloatingLabel",""]],hostAttrs:[1,"mdc-floating-label","mat-mdc-floating-label"],hostVars:2,hostBindings:function(i,r){2&i&&Di("mdc-floating-label--float-above",r.floating)},inputs:{floating:"floating",monitorResize:"monitorResize"}})}return t})();const F5="mdc-line-ripple--active",zT="mdc-line-ripple--deactivating";let L5=(()=>{class t{_elementRef=te(Dn);_cleanupTransitionEnd;constructor(){const e=te(wt),i=te(yt);e.runOutsideAngular(()=>{this._cleanupTransitionEnd=i.listen(this._elementRef.nativeElement,"transitionend",this._handleTransitionEnd)})}activate(){const e=this._elementRef.nativeElement.classList;e.remove(zT),e.add(F5)}deactivate(){this._elementRef.nativeElement.classList.add(zT)}_handleTransitionEnd=e=>{const i=this._elementRef.nativeElement.classList,r=i.contains(zT);"opacity"===e.propertyName&&r&&i.remove(F5,zT)};ngOnDestroy(){this._cleanupTransitionEnd()}static \u0275fac=function(i){return new(i||t)};static \u0275dir=Ht({type:t,selectors:[["div","matFormFieldLineRipple",""]],hostAttrs:[1,"mdc-line-ripple"]})}return t})(),N5=(()=>{class t{_elementRef=te(Dn);_ngZone=te(wt);open=!1;_notch;constructor(){}ngAfterViewInit(){const e=this._elementRef.nativeElement.querySelector(".mdc-floating-label");e?(this._elementRef.nativeElement.classList.add("mdc-notched-outline--upgraded"),"function"==typeof requestAnimationFrame&&(e.style.transitionDuration="0s",this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>e.style.transitionDuration="")}))):this._elementRef.nativeElement.classList.add("mdc-notched-outline--no-label")}_setNotchWidth(e){this._notch.nativeElement.style.width=this.open&&e?`calc(${e}px * var(--mat-mdc-form-field-floating-label-scale, 0.75) + 9px)`:""}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=kn({type:t,selectors:[["div","matFormFieldNotchedOutline",""]],viewQuery:function(i,r){if(1&i&&kr(Dne,5),2&i){let l;Zn(l=Xn())&&(r._notch=l.first)}},hostAttrs:[1,"mdc-notched-outline"],hostVars:2,hostBindings:function(i,r){2&i&&Di("mdc-notched-outline--notched",r.open)},inputs:{open:[0,"matFormFieldNotchedOutlineOpen","open"]},attrs:Mne,ngContentSelectors:Tne,decls:5,vars:0,consts:[["notch",""],[1,"mat-mdc-notch-piece","mdc-notched-outline__leading"],[1,"mat-mdc-notch-piece","mdc-notched-outline__notch"],[1,"mat-mdc-notch-piece","mdc-notched-outline__trailing"]],template:function(i,r){1&i&&(os(),Wt(0,"div",1),ae(1,"div",2,0),Fi(3),le(),Wt(4,"div",3))},encapsulation:2,changeDetection:0})}return t})(),BT=(()=>{class t{value;stateChanges;id;placeholder;ngControl;focused;empty;shouldLabelFloat;required;disabled;errorState;controlType;autofilled;userAriaDescribedBy;disableAutomaticLabeling;static \u0275fac=function(i){return new(i||t)};static \u0275dir=Ht({type:t})}return t})();const rE=new _t("MatFormField"),iie=new _t("MAT_FORM_FIELD_DEFAULT_OPTIONS");let tx=(()=>{class t{_elementRef=te(Dn);_changeDetectorRef=te(Do);_dir=te(Bc);_platform=te(xs);_idGenerator=te(Sa);_ngZone=te(wt);_injector=te(we);_defaults=te(iie,{optional:!0});_textField;_iconPrefixContainer;_textPrefixContainer;_iconSuffixContainer;_textSuffixContainer;_floatingLabel;_notchedOutline;_lineRipple;_formFieldControl;_prefixChildren;_suffixChildren;_errorChildren;_hintChildren;_labelChild=hj(ex);get hideRequiredMarker(){return this._hideRequiredMarker}set hideRequiredMarker(e){this._hideRequiredMarker=qg(e)}_hideRequiredMarker=!1;color="primary";get floatLabel(){return this._floatLabel||this._defaults?.floatLabel||"auto"}set floatLabel(e){e!==this._floatLabel&&(this._floatLabel=e,this._changeDetectorRef.markForCheck())}_floatLabel;get appearance(){return this._appearance}set appearance(e){const i=this._appearance;this._appearance=e||this._defaults?.appearance||"fill","outline"===this._appearance&&this._appearance!==i&&(this._needsOutlineLabelOffsetUpdate=!0)}_appearance="fill";get subscriptSizing(){return this._subscriptSizing||this._defaults?.subscriptSizing||"fixed"}set subscriptSizing(e){this._subscriptSizing=e||this._defaults?.subscriptSizing||"fixed"}_subscriptSizing=null;get hintLabel(){return this._hintLabel}set hintLabel(e){this._hintLabel=e,this._processHints()}_hintLabel="";_hasIconPrefix=!1;_hasTextPrefix=!1;_hasIconSuffix=!1;_hasTextSuffix=!1;_labelId=this._idGenerator.getId("mat-mdc-form-field-label-");_hintLabelId=this._idGenerator.getId("mat-mdc-hint-");get _control(){return this._explicitFormFieldControl||this._formFieldControl}set _control(e){this._explicitFormFieldControl=e}_destroyed=new Et;_isFocused=null;_explicitFormFieldControl;_needsOutlineLabelOffsetUpdate=!1;_previousControl=null;_previousControlValidatorFn=null;_stateChanges;_valueChanges;_describedByChanges;_animationsDisabled;constructor(){const e=this._defaults;e&&(e.appearance&&(this.appearance=e.appearance),this._hideRequiredMarker=!!e?.hideRequiredMarker,e.color&&(this.color=e.color)),this._animationsDisabled="NoopAnimations"===te(wa,{optional:!0})}ngAfterViewInit(){this._updateFocusState(),this._animationsDisabled||this._ngZone.runOutsideAngular(()=>{setTimeout(()=>{this._elementRef.nativeElement.classList.add("mat-form-field-animations-enabled")},300)}),this._changeDetectorRef.detectChanges()}ngAfterContentInit(){this._assertFormFieldControl(),this._initializeSubscript(),this._initializePrefixAndSuffix(),this._initializeOutlineLabelOffsetSubscriptions()}ngAfterContentChecked(){this._assertFormFieldControl(),this._control!==this._previousControl&&(this._initializeControl(this._previousControl),this._control.ngControl&&this._control.ngControl.control&&(this._previousControlValidatorFn=this._control.ngControl.control.validator),this._previousControl=this._control),this._control.ngControl&&this._control.ngControl.control&&this._control.ngControl.control.validator!==this._previousControlValidatorFn&&this._changeDetectorRef.markForCheck()}ngOnDestroy(){this._stateChanges?.unsubscribe(),this._valueChanges?.unsubscribe(),this._describedByChanges?.unsubscribe(),this._destroyed.next(),this._destroyed.complete()}getLabelId=Sd(()=>this._hasFloatingLabel()?this._labelId:null);getConnectedOverlayOrigin(){return this._textField||this._elementRef}_animateAndLockLabel(){this._hasFloatingLabel()&&(this.floatLabel="always")}_initializeControl(e){const i=this._control,r="mat-mdc-form-field-type-";e&&this._elementRef.nativeElement.classList.remove(r+e.controlType),i.controlType&&this._elementRef.nativeElement.classList.add(r+i.controlType),this._stateChanges?.unsubscribe(),this._stateChanges=i.stateChanges.subscribe(()=>{this._updateFocusState(),this._changeDetectorRef.markForCheck()}),this._describedByChanges?.unsubscribe(),this._describedByChanges=i.stateChanges.pipe(Nc([void 0,void 0]),an(()=>[i.errorState,i.userAriaDescribedBy]),function wne(){return Jn((t,n)=>{let e,i=!1;t.subscribe(li(n,r=>{const l=e;e=r,i&&n.next([l,r]),i=!0}))})}(),bs(([[l,f],[w,M]])=>l!==w||f!==M)).subscribe(()=>this._syncDescribedByIds()),this._valueChanges?.unsubscribe(),i.ngControl&&i.ngControl.valueChanges&&(this._valueChanges=i.ngControl.valueChanges.pipe(jr(this._destroyed)).subscribe(()=>this._changeDetectorRef.markForCheck()))}_checkPrefixAndSuffixTypes(){this._hasIconPrefix=!!this._prefixChildren.find(e=>!e._isText),this._hasTextPrefix=!!this._prefixChildren.find(e=>e._isText),this._hasIconSuffix=!!this._suffixChildren.find(e=>!e._isText),this._hasTextSuffix=!!this._suffixChildren.find(e=>e._isText)}_initializePrefixAndSuffix(){this._checkPrefixAndSuffixTypes(),zc(this._prefixChildren.changes,this._suffixChildren.changes).subscribe(()=>{this._checkPrefixAndSuffixTypes(),this._changeDetectorRef.markForCheck()})}_initializeSubscript(){this._hintChildren.changes.subscribe(()=>{this._processHints(),this._changeDetectorRef.markForCheck()}),this._errorChildren.changes.subscribe(()=>{this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),this._validateHints(),this._syncDescribedByIds()}_assertFormFieldControl(){}_updateFocusState(){this._control.focused&&!this._isFocused?(this._isFocused=!0,this._lineRipple?.activate()):!this._control.focused&&(this._isFocused||null===this._isFocused)&&(this._isFocused=!1,this._lineRipple?.deactivate()),this._textField?.nativeElement.classList.toggle("mdc-text-field--focused",this._control.focused)}_initializeOutlineLabelOffsetSubscriptions(){this._prefixChildren.changes.subscribe(()=>this._needsOutlineLabelOffsetUpdate=!0),tg(()=>{this._needsOutlineLabelOffsetUpdate&&(this._needsOutlineLabelOffsetUpdate=!1,this._updateOutlineLabelOffset())},{injector:this._injector}),this._dir.change.pipe(jr(this._destroyed)).subscribe(()=>this._needsOutlineLabelOffsetUpdate=!0)}_shouldAlwaysFloat(){return"always"===this.floatLabel}_hasOutline(){return"outline"===this.appearance}_forceDisplayInfixLabel(){return!this._platform.isBrowser&&this._prefixChildren.length&&!this._shouldLabelFloat()}_hasFloatingLabel=Sd(()=>!!this._labelChild());_shouldLabelFloat(){return!!this._hasFloatingLabel()&&(this._control.shouldLabelFloat||this._shouldAlwaysFloat())}_shouldForward(e){const i=this._control?this._control.ngControl:null;return i&&i[e]}_getSubscriptMessageType(){return this._errorChildren&&this._errorChildren.length>0&&this._control.errorState?"error":"hint"}_handleLabelResized(){this._refreshOutlineNotchWidth()}_refreshOutlineNotchWidth(){this._hasOutline()&&this._floatingLabel&&this._shouldLabelFloat()?this._notchedOutline?._setNotchWidth(this._floatingLabel.getWidth()):this._notchedOutline?._setNotchWidth(0)}_processHints(){this._validateHints(),this._syncDescribedByIds()}_validateHints(){}_syncDescribedByIds(){if(this._control){let e=[];if(this._control.userAriaDescribedBy&&"string"==typeof this._control.userAriaDescribedBy&&e.push(...this._control.userAriaDescribedBy.split(" ")),"hint"===this._getSubscriptMessageType()){const i=this._hintChildren?this._hintChildren.find(l=>"start"===l.align):null,r=this._hintChildren?this._hintChildren.find(l=>"end"===l.align):null;i?e.push(i.id):this._hintLabel&&e.push(this._hintLabelId),r&&e.push(r.id)}else this._errorChildren&&e.push(...this._errorChildren.map(i=>i.id));this._control.setDescribedByIds(e)}}_updateOutlineLabelOffset(){if(!this._hasOutline()||!this._floatingLabel)return;const e=this._floatingLabel.element;if(!this._iconPrefixContainer&&!this._textPrefixContainer)return void(e.style.transform="");if(!this._isAttachedToDom())return void(this._needsOutlineLabelOffsetUpdate=!0);const i=this._iconPrefixContainer?.nativeElement,r=this._textPrefixContainer?.nativeElement,l=this._iconSuffixContainer?.nativeElement,f=this._textSuffixContainer?.nativeElement,w=i?.getBoundingClientRect().width??0,M=r?.getBoundingClientRect().width??0,P=l?.getBoundingClientRect().width??0,L=f?.getBoundingClientRect().width??0;e.style.transform=`var(\n        --mat-mdc-form-field-label-transform,\n        translateY(-50%) translateX(calc(${"rtl"===this._dir.value?"-1":"1"} * (${w+M}px + var(--mat-mdc-form-field-label-offset-x, 0px))))\n    )`,this._elementRef.nativeElement.style.setProperty("--mat-form-field-notch-max-width",`calc(100% - ${w+M+P+L}px)`)}_isAttachedToDom(){const e=this._elementRef.nativeElement;if(e.getRootNode){const i=e.getRootNode();return i&&i!==e}return document.documentElement.contains(e)}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=kn({type:t,selectors:[["mat-form-field"]],contentQueries:function(i,r,l){if(1&i&&(kL(l,r._labelChild,ex,5),ro(l,BT,5),ro(l,eie,5),ro(l,R5,5),ro(l,A5,5),ro(l,k5,5)),2&i){let f;(function RL(t=1){ip(bf()+t)})(),Zn(f=Xn())&&(r._formFieldControl=f.first),Zn(f=Xn())&&(r._prefixChildren=f),Zn(f=Xn())&&(r._suffixChildren=f),Zn(f=Xn())&&(r._errorChildren=f),Zn(f=Xn())&&(r._hintChildren=f)}},viewQuery:function(i,r){if(1&i&&(kr(Ine,5),kr(Ane,5),kr(kne,5),kr(Rne,5),kr(Pne,5),kr(O5,5),kr(N5,5),kr(L5,5)),2&i){let l;Zn(l=Xn())&&(r._textField=l.first),Zn(l=Xn())&&(r._iconPrefixContainer=l.first),Zn(l=Xn())&&(r._textPrefixContainer=l.first),Zn(l=Xn())&&(r._iconSuffixContainer=l.first),Zn(l=Xn())&&(r._textSuffixContainer=l.first),Zn(l=Xn())&&(r._floatingLabel=l.first),Zn(l=Xn())&&(r._notchedOutline=l.first),Zn(l=Xn())&&(r._lineRipple=l.first)}},hostAttrs:[1,"mat-mdc-form-field"],hostVars:40,hostBindings:function(i,r){2&i&&Di("mat-mdc-form-field-label-always-float",r._shouldAlwaysFloat())("mat-mdc-form-field-has-icon-prefix",r._hasIconPrefix)("mat-mdc-form-field-has-icon-suffix",r._hasIconSuffix)("mat-form-field-invalid",r._control.errorState)("mat-form-field-disabled",r._control.disabled)("mat-form-field-autofilled",r._control.autofilled)("mat-form-field-appearance-fill","fill"==r.appearance)("mat-form-field-appearance-outline","outline"==r.appearance)("mat-form-field-hide-placeholder",r._hasFloatingLabel()&&!r._shouldLabelFloat())("mat-focused",r._control.focused)("mat-primary","accent"!==r.color&&"warn"!==r.color)("mat-accent","accent"===r.color)("mat-warn","warn"===r.color)("ng-untouched",r._shouldForward("untouched"))("ng-touched",r._shouldForward("touched"))("ng-pristine",r._shouldForward("pristine"))("ng-dirty",r._shouldForward("dirty"))("ng-valid",r._shouldForward("valid"))("ng-invalid",r._shouldForward("invalid"))("ng-pending",r._shouldForward("pending"))},inputs:{hideRequiredMarker:"hideRequiredMarker",color:"color",floatLabel:"floatLabel",appearance:"appearance",subscriptSizing:"subscriptSizing",hintLabel:"hintLabel"},exportAs:["matFormField"],features:[pi([{provide:rE,useExisting:t},{provide:P5,useExisting:t}])],ngContentSelectors:Fne,decls:20,vars:25,consts:[["labelTemplate",""],["textField",""],["iconPrefixContainer",""],["textPrefixContainer",""],["textSuffixContainer",""],["iconSuffixContainer",""],[1,"mat-mdc-text-field-wrapper","mdc-text-field",3,"click"],[1,"mat-mdc-form-field-focus-overlay"],[1,"mat-mdc-form-field-flex"],["matFormFieldNotchedOutline","",3,"matFormFieldNotchedOutlineOpen"],[1,"mat-mdc-form-field-icon-prefix"],[1,"mat-mdc-form-field-text-prefix"],[1,"mat-mdc-form-field-infix"],[3,"ngTemplateOutlet"],[1,"mat-mdc-form-field-text-suffix"],[1,"mat-mdc-form-field-icon-suffix"],["matFormFieldLineRipple",""],[1,"mat-mdc-form-field-subscript-wrapper","mat-mdc-form-field-bottom-align"],["aria-atomic","true","aria-live","polite"],["matFormFieldFloatingLabel","",3,"floating","monitorResize","id"],["aria-hidden","true",1,"mat-mdc-form-field-required-marker","mdc-floating-label--required"],[3,"id"],[1,"mat-mdc-form-field-hint-spacer"]],template:function(i,r){if(1&i){const l=_i();os(One),vt(0,zne,1,1,"ng-template",null,0,q1),ae(2,"div",6,1),Tt("click",function(w){return on(l),ln(r._control.onContainerClick(w))}),vt(4,Bne,1,0,"div",7),ae(5,"div",8),vt(6,jne,2,2,"div",9)(7,Hne,3,0,"div",10)(8,$ne,3,0,"div",11),ae(9,"div",12),vt(10,qne,1,1,null,13),Fi(11),le(),vt(12,Wne,3,0,"div",14)(13,Yne,3,0,"div",15),le(),vt(14,Zne,1,0,"div",16),le(),ae(15,"div",17),fk(16),ae(17,"div",18),vt(18,Xne,1,0)(19,Qne,4,1),le()()}if(2&i){let l;xe(2),Di("mdc-text-field--filled",!r._hasOutline())("mdc-text-field--outlined",r._hasOutline())("mdc-text-field--no-label",!r._hasFloatingLabel())("mdc-text-field--disabled",r._control.disabled)("mdc-text-field--invalid",r._control.errorState),xe(2),qi(r._hasOutline()||r._control.disabled?-1:4),xe(2),qi(r._hasOutline()?6:-1),xe(),qi(r._hasIconPrefix?7:-1),xe(),qi(r._hasTextPrefix?8:-1),xe(2),qi(!r._hasOutline()||r._forceDisplayInfixLabel()?10:-1),xe(2),qi(r._hasTextSuffix?12:-1),xe(),qi(r._hasIconSuffix?13:-1),xe(),qi(r._hasOutline()?-1:14),xe(),Di("mat-mdc-form-field-subscript-dynamic-size","dynamic"===r.subscriptSizing);const f=r._getSubscriptMessageType();xe(2),Di("mat-mdc-form-field-error-wrapper","error"===f)("mat-mdc-form-field-hint-wrapper","hint"===f),xe(),qi("error"===(l=f)?18:"hint"===l?19:-1)}},dependencies:[O5,N5,n2,L5,k5],styles:['.mdc-text-field{display:inline-flex;align-items:baseline;padding:0 16px;position:relative;box-sizing:border-box;overflow:hidden;will-change:opacity,transform,color;border-top-left-radius:4px;border-top-right-radius:4px;border-bottom-right-radius:0;border-bottom-left-radius:0}.mdc-text-field__input{width:100%;min-width:0;border:none;border-radius:0;background:none;padding:0;-moz-appearance:none;-webkit-appearance:none;height:28px}.mdc-text-field__input::-webkit-calendar-picker-indicator{display:none}.mdc-text-field__input::-ms-clear{display:none}.mdc-text-field__input:focus{outline:none}.mdc-text-field__input:invalid{box-shadow:none}.mdc-text-field__input::placeholder{opacity:0}.mdc-text-field__input::-moz-placeholder{opacity:0}.mdc-text-field__input::-webkit-input-placeholder{opacity:0}.mdc-text-field__input:-ms-input-placeholder{opacity:0}.mdc-text-field--no-label .mdc-text-field__input::placeholder,.mdc-text-field--focused .mdc-text-field__input::placeholder{opacity:1}.mdc-text-field--no-label .mdc-text-field__input::-moz-placeholder,.mdc-text-field--focused .mdc-text-field__input::-moz-placeholder{opacity:1}.mdc-text-field--no-label .mdc-text-field__input::-webkit-input-placeholder,.mdc-text-field--focused .mdc-text-field__input::-webkit-input-placeholder{opacity:1}.mdc-text-field--no-label .mdc-text-field__input:-ms-input-placeholder,.mdc-text-field--focused .mdc-text-field__input:-ms-input-placeholder{opacity:1}.mdc-text-field--disabled:not(.mdc-text-field--no-label) .mdc-text-field__input.mat-mdc-input-disabled-interactive::placeholder{opacity:0}.mdc-text-field--disabled:not(.mdc-text-field--no-label) .mdc-text-field__input.mat-mdc-input-disabled-interactive::-moz-placeholder{opacity:0}.mdc-text-field--disabled:not(.mdc-text-field--no-label) .mdc-text-field__input.mat-mdc-input-disabled-interactive::-webkit-input-placeholder{opacity:0}.mdc-text-field--disabled:not(.mdc-text-field--no-label) .mdc-text-field__input.mat-mdc-input-disabled-interactive:-ms-input-placeholder{opacity:0}.mdc-text-field--outlined .mdc-text-field__input,.mdc-text-field--filled.mdc-text-field--no-label .mdc-text-field__input{height:100%}.mdc-text-field--outlined .mdc-text-field__input{display:flex;border:none !important;background-color:rgba(0,0,0,0)}.mdc-text-field--disabled .mdc-text-field__input{pointer-events:auto}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input{color:var(--mdc-filled-text-field-input-text-color, var(--mat-sys-on-surface));caret-color:var(--mdc-filled-text-field-caret-color, var(--mat-sys-primary))}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input::placeholder{color:var(--mdc-filled-text-field-input-text-placeholder-color, var(--mat-sys-on-surface-variant))}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input::-moz-placeholder{color:var(--mdc-filled-text-field-input-text-placeholder-color, var(--mat-sys-on-surface-variant))}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input::-webkit-input-placeholder{color:var(--mdc-filled-text-field-input-text-placeholder-color, var(--mat-sys-on-surface-variant))}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input:-ms-input-placeholder{color:var(--mdc-filled-text-field-input-text-placeholder-color, var(--mat-sys-on-surface-variant))}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-filled-text-field-error-caret-color)}.mdc-text-field--filled.mdc-text-field--disabled .mdc-text-field__input{color:var(--mdc-filled-text-field-disabled-input-text-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent))}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input{color:var(--mdc-outlined-text-field-input-text-color, var(--mat-sys-on-surface));caret-color:var(--mdc-outlined-text-field-caret-color, var(--mat-sys-primary))}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input::placeholder{color:var(--mdc-outlined-text-field-input-text-placeholder-color, var(--mat-sys-on-surface-variant))}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input::-moz-placeholder{color:var(--mdc-outlined-text-field-input-text-placeholder-color, var(--mat-sys-on-surface-variant))}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input::-webkit-input-placeholder{color:var(--mdc-outlined-text-field-input-text-placeholder-color, var(--mat-sys-on-surface-variant))}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input:-ms-input-placeholder{color:var(--mdc-outlined-text-field-input-text-placeholder-color, var(--mat-sys-on-surface-variant))}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-outlined-text-field-error-caret-color)}.mdc-text-field--outlined.mdc-text-field--disabled .mdc-text-field__input{color:var(--mdc-outlined-text-field-disabled-input-text-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent))}@media(forced-colors: active){.mdc-text-field--disabled .mdc-text-field__input{background-color:Window}}.mdc-text-field--filled{height:56px;border-bottom-right-radius:0;border-bottom-left-radius:0;border-top-left-radius:var(--mdc-filled-text-field-container-shape, var(--mat-sys-corner-extra-small));border-top-right-radius:var(--mdc-filled-text-field-container-shape, var(--mat-sys-corner-extra-small))}.mdc-text-field--filled:not(.mdc-text-field--disabled){background-color:var(--mdc-filled-text-field-container-color, var(--mat-sys-surface-variant))}.mdc-text-field--filled.mdc-text-field--disabled{background-color:var(--mdc-filled-text-field-disabled-container-color, color-mix(in srgb, var(--mat-sys-on-surface) 4%, transparent))}.mdc-text-field--outlined{height:56px;overflow:visible;padding-right:max(16px,var(--mdc-outlined-text-field-container-shape, var(--mat-sys-corner-extra-small)));padding-left:max(16px,var(--mdc-outlined-text-field-container-shape, var(--mat-sys-corner-extra-small)) + 4px)}[dir=rtl] .mdc-text-field--outlined{padding-right:max(16px,var(--mdc-outlined-text-field-container-shape, var(--mat-sys-corner-extra-small)) + 4px);padding-left:max(16px,var(--mdc-outlined-text-field-container-shape, var(--mat-sys-corner-extra-small)))}.mdc-floating-label{position:absolute;left:0;transform-origin:left top;line-height:1.15rem;text-align:left;text-overflow:ellipsis;white-space:nowrap;cursor:text;overflow:hidden;will-change:transform}[dir=rtl] .mdc-floating-label{right:0;left:auto;transform-origin:right top;text-align:right}.mdc-text-field .mdc-floating-label{top:50%;transform:translateY(-50%);pointer-events:none}.mdc-notched-outline .mdc-floating-label{display:inline-block;position:relative;max-width:100%}.mdc-text-field--outlined .mdc-floating-label{left:4px;right:auto}[dir=rtl] .mdc-text-field--outlined .mdc-floating-label{left:auto;right:4px}.mdc-text-field--filled .mdc-floating-label{left:16px;right:auto}[dir=rtl] .mdc-text-field--filled .mdc-floating-label{left:auto;right:16px}.mdc-text-field--disabled .mdc-floating-label{cursor:default}@media(forced-colors: active){.mdc-text-field--disabled .mdc-floating-label{z-index:1}}.mdc-text-field--filled.mdc-text-field--no-label .mdc-floating-label{display:none}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-floating-label{color:var(--mdc-filled-text-field-label-text-color, var(--mat-sys-on-surface-variant))}.mdc-text-field--filled:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label{color:var(--mdc-filled-text-field-focus-label-text-color, var(--mat-sys-primary))}.mdc-text-field--filled:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label{color:var(--mdc-filled-text-field-hover-label-text-color, var(--mat-sys-on-surface-variant))}.mdc-text-field--filled.mdc-text-field--disabled .mdc-floating-label{color:var(--mdc-filled-text-field-disabled-label-text-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent))}.mdc-text-field--filled:not(.mdc-text-field--disabled).mdc-text-field--invalid .mdc-floating-label{color:var(--mdc-filled-text-field-error-label-text-color, var(--mat-sys-error))}.mdc-text-field--filled:not(.mdc-text-field--disabled).mdc-text-field--invalid.mdc-text-field--focused .mdc-floating-label{color:var(--mdc-filled-text-field-error-focus-label-text-color, var(--mat-sys-error))}.mdc-text-field--filled:not(.mdc-text-field--disabled).mdc-text-field--invalid:not(.mdc-text-field--disabled):hover .mdc-floating-label{color:var(--mdc-filled-text-field-error-hover-label-text-color, var(--mat-sys-on-error-container))}.mdc-text-field--filled .mdc-floating-label{font-family:var(--mdc-filled-text-field-label-text-font, var(--mat-sys-body-large-font));font-size:var(--mdc-filled-text-field-label-text-size, var(--mat-sys-body-large-size));font-weight:var(--mdc-filled-text-field-label-text-weight, var(--mat-sys-body-large-weight));letter-spacing:var(--mdc-filled-text-field-label-text-tracking, var(--mat-sys-body-large-tracking))}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-floating-label{color:var(--mdc-outlined-text-field-label-text-color, var(--mat-sys-on-surface-variant))}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label{color:var(--mdc-outlined-text-field-focus-label-text-color, var(--mat-sys-primary))}.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label{color:var(--mdc-outlined-text-field-hover-label-text-color, var(--mat-sys-on-surface))}.mdc-text-field--outlined.mdc-text-field--disabled .mdc-floating-label{color:var(--mdc-outlined-text-field-disabled-label-text-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent))}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--invalid .mdc-floating-label{color:var(--mdc-outlined-text-field-error-label-text-color, var(--mat-sys-error))}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--invalid.mdc-text-field--focused .mdc-floating-label{color:var(--mdc-outlined-text-field-error-focus-label-text-color, var(--mat-sys-error))}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--invalid:not(.mdc-text-field--disabled):hover .mdc-floating-label{color:var(--mdc-outlined-text-field-error-hover-label-text-color, var(--mat-sys-on-error-container))}.mdc-text-field--outlined .mdc-floating-label{font-family:var(--mdc-outlined-text-field-label-text-font, var(--mat-sys-body-large-font));font-size:var(--mdc-outlined-text-field-label-text-size, var(--mat-sys-body-large-size));font-weight:var(--mdc-outlined-text-field-label-text-weight, var(--mat-sys-body-large-weight));letter-spacing:var(--mdc-outlined-text-field-label-text-tracking, var(--mat-sys-body-large-tracking))}.mdc-floating-label--float-above{cursor:auto;transform:translateY(-106%) scale(0.75)}.mdc-text-field--filled .mdc-floating-label--float-above{transform:translateY(-106%) scale(0.75)}.mdc-text-field--outlined .mdc-floating-label--float-above{transform:translateY(-37.25px) scale(1);font-size:.75rem}.mdc-notched-outline .mdc-floating-label--float-above{text-overflow:clip}.mdc-notched-outline--upgraded .mdc-floating-label--float-above{max-width:133.3333333333%}.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{transform:translateY(-34.75px) scale(0.75)}.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:1rem}.mdc-floating-label--required:not(.mdc-floating-label--hide-required-marker)::after{margin-left:1px;margin-right:0;content:"*"}[dir=rtl] .mdc-floating-label--required:not(.mdc-floating-label--hide-required-marker)::after{margin-left:0;margin-right:1px}.mdc-notched-outline{display:flex;position:absolute;top:0;right:0;left:0;box-sizing:border-box;width:100%;max-width:100%;height:100%;text-align:left;pointer-events:none}[dir=rtl] .mdc-notched-outline{text-align:right}.mdc-text-field--outlined .mdc-notched-outline{z-index:1}.mat-mdc-notch-piece{box-sizing:border-box;height:100%;pointer-events:none;border-top:1px solid;border-bottom:1px solid}.mdc-text-field--focused .mat-mdc-notch-piece{border-width:2px}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mat-mdc-notch-piece{border-color:var(--mdc-outlined-text-field-outline-color, var(--mat-sys-outline));border-width:var(--mdc-outlined-text-field-outline-width, 1px)}.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mat-mdc-notch-piece{border-color:var(--mdc-outlined-text-field-hover-outline-color, var(--mat-sys-on-surface))}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mat-mdc-notch-piece{border-color:var(--mdc-outlined-text-field-focus-outline-color, var(--mat-sys-primary))}.mdc-text-field--outlined.mdc-text-field--disabled .mat-mdc-notch-piece{border-color:var(--mdc-outlined-text-field-disabled-outline-color, color-mix(in srgb, var(--mat-sys-on-surface) 12%, transparent))}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--invalid .mat-mdc-notch-piece{border-color:var(--mdc-outlined-text-field-error-outline-color, var(--mat-sys-error))}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--invalid:not(.mdc-text-field--focused):hover .mdc-notched-outline .mat-mdc-notch-piece{border-color:var(--mdc-outlined-text-field-error-hover-outline-color, var(--mat-sys-on-error-container))}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--invalid.mdc-text-field--focused .mat-mdc-notch-piece{border-color:var(--mdc-outlined-text-field-error-focus-outline-color, var(--mat-sys-error))}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline .mat-mdc-notch-piece{border-width:var(--mdc-outlined-text-field-focus-outline-width, 2px)}.mdc-notched-outline__leading{border-left:1px solid;border-right:none;border-top-right-radius:0;border-bottom-right-radius:0;border-top-left-radius:var(--mdc-outlined-text-field-container-shape, var(--mat-sys-corner-extra-small));border-bottom-left-radius:var(--mdc-outlined-text-field-container-shape, var(--mat-sys-corner-extra-small))}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading{width:max(12px,var(--mdc-outlined-text-field-container-shape, var(--mat-sys-corner-extra-small)))}[dir=rtl] .mdc-notched-outline__leading{border-left:none;border-right:1px solid;border-bottom-left-radius:0;border-top-left-radius:0;border-top-right-radius:var(--mdc-outlined-text-field-container-shape, var(--mat-sys-corner-extra-small));border-bottom-right-radius:var(--mdc-outlined-text-field-container-shape, var(--mat-sys-corner-extra-small))}.mdc-notched-outline__trailing{flex-grow:1;border-left:none;border-right:1px solid;border-top-left-radius:0;border-bottom-left-radius:0;border-top-right-radius:var(--mdc-outlined-text-field-container-shape, var(--mat-sys-corner-extra-small));border-bottom-right-radius:var(--mdc-outlined-text-field-container-shape, var(--mat-sys-corner-extra-small))}[dir=rtl] .mdc-notched-outline__trailing{border-left:1px solid;border-right:none;border-top-right-radius:0;border-bottom-right-radius:0;border-top-left-radius:var(--mdc-outlined-text-field-container-shape, var(--mat-sys-corner-extra-small));border-bottom-left-radius:var(--mdc-outlined-text-field-container-shape, var(--mat-sys-corner-extra-small))}.mdc-notched-outline__notch{flex:0 0 auto;width:auto}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__notch{max-width:min(var(--mat-form-field-notch-max-width, 100%),100% - max(12px,var(--mdc-outlined-text-field-container-shape, var(--mat-sys-corner-extra-small)))*2)}.mdc-text-field--outlined .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:1px}.mdc-text-field--focused.mdc-text-field--outlined .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:2px}.mdc-notched-outline--notched .mdc-notched-outline__notch{padding-left:0;padding-right:8px;border-top:none;--mat-form-field-notch-max-width: 100%}[dir=rtl] .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-left:8px;padding-right:0}.mdc-notched-outline--no-label .mdc-notched-outline__notch{display:none}.mdc-line-ripple::before,.mdc-line-ripple::after{position:absolute;bottom:0;left:0;width:100%;border-bottom-style:solid;content:""}.mdc-line-ripple::before{z-index:1;border-bottom-width:var(--mdc-filled-text-field-active-indicator-height, 1px)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-active-indicator-color, var(--mat-sys-on-surface-variant))}.mdc-text-field--filled:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-hover-active-indicator-color, var(--mat-sys-on-surface))}.mdc-text-field--filled.mdc-text-field--disabled .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-disabled-active-indicator-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent))}.mdc-text-field--filled:not(.mdc-text-field--disabled).mdc-text-field--invalid .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-error-active-indicator-color, var(--mat-sys-error))}.mdc-text-field--filled:not(.mdc-text-field--disabled).mdc-text-field--invalid:not(.mdc-text-field--focused):hover .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-error-hover-active-indicator-color, var(--mat-sys-on-error-container))}.mdc-line-ripple::after{transform:scaleX(0);opacity:0;z-index:2}.mdc-text-field--filled .mdc-line-ripple::after{border-bottom-width:var(--mdc-filled-text-field-focus-active-indicator-height, 2px)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-line-ripple::after{border-bottom-color:var(--mdc-filled-text-field-focus-active-indicator-color, var(--mat-sys-primary))}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-line-ripple::after{border-bottom-color:var(--mdc-filled-text-field-error-focus-active-indicator-color, var(--mat-sys-error))}.mdc-line-ripple--active::after{transform:scaleX(1);opacity:1}.mdc-line-ripple--deactivating::after{opacity:0}.mdc-text-field--disabled{pointer-events:none}.mat-mdc-form-field-textarea-control{vertical-align:middle;resize:vertical;box-sizing:border-box;height:auto;margin:0;padding:0;border:none;overflow:auto}.mat-mdc-form-field-input-control.mat-mdc-form-field-input-control{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font:inherit;letter-spacing:inherit;text-decoration:inherit;text-transform:inherit;border:none}.mat-mdc-form-field .mat-mdc-floating-label.mdc-floating-label{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;line-height:normal;pointer-events:all;will-change:auto}.mat-mdc-form-field:not(.mat-form-field-disabled) .mat-mdc-floating-label.mdc-floating-label{cursor:inherit}.mdc-text-field--no-label:not(.mdc-text-field--textarea) .mat-mdc-form-field-input-control.mdc-text-field__input,.mat-mdc-text-field-wrapper .mat-mdc-form-field-input-control{height:auto}.mat-mdc-text-field-wrapper .mat-mdc-form-field-input-control.mdc-text-field__input[type=color]{height:23px}.mat-mdc-text-field-wrapper{height:auto;flex:auto;will-change:auto}.mat-mdc-form-field-has-icon-prefix .mat-mdc-text-field-wrapper{padding-left:0;--mat-mdc-form-field-label-offset-x: -16px}.mat-mdc-form-field-has-icon-suffix .mat-mdc-text-field-wrapper{padding-right:0}[dir=rtl] .mat-mdc-text-field-wrapper{padding-left:16px;padding-right:16px}[dir=rtl] .mat-mdc-form-field-has-icon-suffix .mat-mdc-text-field-wrapper{padding-left:0}[dir=rtl] .mat-mdc-form-field-has-icon-prefix .mat-mdc-text-field-wrapper{padding-right:0}.mat-form-field-disabled .mdc-text-field__input::placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent))}.mat-form-field-disabled .mdc-text-field__input::-moz-placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent))}.mat-form-field-disabled .mdc-text-field__input::-webkit-input-placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent))}.mat-form-field-disabled .mdc-text-field__input:-ms-input-placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent))}.mat-mdc-form-field-label-always-float .mdc-text-field__input::placeholder{transition-delay:40ms;transition-duration:110ms;opacity:1}.mat-mdc-text-field-wrapper .mat-mdc-form-field-infix .mat-mdc-floating-label{left:auto;right:auto}.mat-mdc-text-field-wrapper.mdc-text-field--outlined .mdc-text-field__input{display:inline-block}.mat-mdc-form-field .mat-mdc-text-field-wrapper.mdc-text-field .mdc-notched-outline__notch{padding-top:0}.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field .mdc-notched-outline__notch{border-left:1px solid rgba(0,0,0,0)}[dir=rtl] .mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field .mdc-notched-outline__notch{border-left:none;border-right:1px solid rgba(0,0,0,0)}.mat-mdc-form-field-infix{min-height:var(--mat-form-field-container-height, 56px);padding-top:var(--mat-form-field-filled-with-label-container-padding-top, 24px);padding-bottom:var(--mat-form-field-filled-with-label-container-padding-bottom, 8px)}.mdc-text-field--outlined .mat-mdc-form-field-infix,.mdc-text-field--no-label .mat-mdc-form-field-infix{padding-top:var(--mat-form-field-container-vertical-padding, 16px);padding-bottom:var(--mat-form-field-container-vertical-padding, 16px)}.mat-mdc-text-field-wrapper .mat-mdc-form-field-flex .mat-mdc-floating-label{top:calc(var(--mat-form-field-container-height, 56px)/2)}.mdc-text-field--filled .mat-mdc-floating-label{display:var(--mat-form-field-filled-label-display, block)}.mat-mdc-text-field-wrapper.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{--mat-mdc-form-field-label-transform: translateY(calc(calc(6.75px + var(--mat-form-field-container-height, 56px) / 2) * -1)) scale(var(--mat-mdc-form-field-floating-label-scale, 0.75));transform:var(--mat-mdc-form-field-label-transform)}@keyframes _mat-form-field-subscript-animation{from{opacity:0;transform:translateY(-5px)}to{opacity:1;transform:translateY(0)}}.mat-mdc-form-field-subscript-wrapper{box-sizing:border-box;width:100%;position:relative}.mat-mdc-form-field-hint-wrapper,.mat-mdc-form-field-error-wrapper{position:absolute;top:0;left:0;right:0;padding:0 16px;opacity:1;transform:translateY(0);animation:_mat-form-field-subscript-animation 0ms cubic-bezier(0.55, 0, 0.55, 0.2)}.mat-mdc-form-field-subscript-dynamic-size .mat-mdc-form-field-hint-wrapper,.mat-mdc-form-field-subscript-dynamic-size .mat-mdc-form-field-error-wrapper{position:static}.mat-mdc-form-field-bottom-align::before{content:"";display:inline-block;height:16px}.mat-mdc-form-field-bottom-align.mat-mdc-form-field-subscript-dynamic-size::before{content:unset}.mat-mdc-form-field-hint-end{order:1}.mat-mdc-form-field-hint-wrapper{display:flex}.mat-mdc-form-field-hint-spacer{flex:1 0 1em}.mat-mdc-form-field-error{display:block;color:var(--mat-form-field-error-text-color, var(--mat-sys-error))}.mat-mdc-form-field-subscript-wrapper,.mat-mdc-form-field-bottom-align::before{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:var(--mat-form-field-subscript-text-font, var(--mat-sys-body-small-font));line-height:var(--mat-form-field-subscript-text-line-height, var(--mat-sys-body-small-line-height));font-size:var(--mat-form-field-subscript-text-size, var(--mat-sys-body-small-size));letter-spacing:var(--mat-form-field-subscript-text-tracking, var(--mat-sys-body-small-tracking));font-weight:var(--mat-form-field-subscript-text-weight, var(--mat-sys-body-small-weight))}.mat-mdc-form-field-focus-overlay{top:0;left:0;right:0;bottom:0;position:absolute;opacity:0;pointer-events:none;background-color:var(--mat-form-field-state-layer-color, var(--mat-sys-on-surface))}.mat-mdc-text-field-wrapper:hover .mat-mdc-form-field-focus-overlay{opacity:var(--mat-form-field-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mat-mdc-form-field.mat-focused .mat-mdc-form-field-focus-overlay{opacity:var(--mat-form-field-focus-state-layer-opacity, 0)}select.mat-mdc-form-field-input-control{-moz-appearance:none;-webkit-appearance:none;background-color:rgba(0,0,0,0);display:inline-flex;box-sizing:border-box}select.mat-mdc-form-field-input-control:not(:disabled){cursor:pointer}select.mat-mdc-form-field-input-control:not(.mat-mdc-native-select-inline) option{color:var(--mat-form-field-select-option-text-color, var(--mat-sys-neutral10))}select.mat-mdc-form-field-input-control:not(.mat-mdc-native-select-inline) option:disabled{color:var(--mat-form-field-select-disabled-option-text-color, color-mix(in srgb, var(--mat-sys-neutral10) 38%, transparent))}.mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-infix::after{content:"";width:0;height:0;border-left:5px solid rgba(0,0,0,0);border-right:5px solid rgba(0,0,0,0);border-top:5px solid;position:absolute;right:0;top:50%;margin-top:-2.5px;pointer-events:none;color:var(--mat-form-field-enabled-select-arrow-color, var(--mat-sys-on-surface-variant))}[dir=rtl] .mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-infix::after{right:auto;left:0}.mat-mdc-form-field-type-mat-native-select.mat-focused .mat-mdc-form-field-infix::after{color:var(--mat-form-field-focus-select-arrow-color, var(--mat-sys-primary))}.mat-mdc-form-field-type-mat-native-select.mat-form-field-disabled .mat-mdc-form-field-infix::after{color:var(--mat-form-field-disabled-select-arrow-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent))}.mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-input-control{padding-right:15px}[dir=rtl] .mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-input-control{padding-right:0;padding-left:15px}@media(forced-colors: active){.mat-form-field-appearance-fill .mat-mdc-text-field-wrapper{outline:solid 1px}}@media(forced-colors: active){.mat-form-field-appearance-fill.mat-form-field-disabled .mat-mdc-text-field-wrapper{outline-color:GrayText}}@media(forced-colors: active){.mat-form-field-appearance-fill.mat-focused .mat-mdc-text-field-wrapper{outline:dashed 3px}}@media(forced-colors: active){.mat-mdc-form-field.mat-focused .mdc-notched-outline{border:dashed 3px}}.mat-mdc-form-field-input-control[type=date],.mat-mdc-form-field-input-control[type=datetime],.mat-mdc-form-field-input-control[type=datetime-local],.mat-mdc-form-field-input-control[type=month],.mat-mdc-form-field-input-control[type=week],.mat-mdc-form-field-input-control[type=time]{line-height:1}.mat-mdc-form-field-input-control::-webkit-datetime-edit{line-height:1;padding:0;margin-bottom:-2px}.mat-mdc-form-field{--mat-mdc-form-field-floating-label-scale: 0.75;display:inline-flex;flex-direction:column;min-width:0;text-align:left;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:var(--mat-form-field-container-text-font, var(--mat-sys-body-large-font));line-height:var(--mat-form-field-container-text-line-height, var(--mat-sys-body-large-line-height));font-size:var(--mat-form-field-container-text-size, var(--mat-sys-body-large-size));letter-spacing:var(--mat-form-field-container-text-tracking, var(--mat-sys-body-large-tracking));font-weight:var(--mat-form-field-container-text-weight, var(--mat-sys-body-large-weight))}.mat-mdc-form-field .mdc-text-field--outlined .mdc-floating-label--float-above{font-size:calc(var(--mat-form-field-outlined-label-text-populated-size)*var(--mat-mdc-form-field-floating-label-scale))}.mat-mdc-form-field .mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:var(--mat-form-field-outlined-label-text-populated-size)}[dir=rtl] .mat-mdc-form-field{text-align:right}.mat-mdc-form-field-flex{display:inline-flex;align-items:baseline;box-sizing:border-box;width:100%}.mat-mdc-text-field-wrapper{width:100%;z-index:0}.mat-mdc-form-field-icon-prefix,.mat-mdc-form-field-icon-suffix{align-self:center;line-height:0;pointer-events:auto;position:relative;z-index:1}.mat-mdc-form-field-icon-prefix>.mat-icon,.mat-mdc-form-field-icon-suffix>.mat-icon{padding:0 12px;box-sizing:content-box}.mat-mdc-form-field-icon-prefix{color:var(--mat-form-field-leading-icon-color, var(--mat-sys-on-surface-variant))}.mat-form-field-disabled .mat-mdc-form-field-icon-prefix{color:var(--mat-form-field-disabled-leading-icon-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent))}.mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-trailing-icon-color, var(--mat-sys-on-surface-variant))}.mat-form-field-disabled .mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-disabled-trailing-icon-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent))}.mat-form-field-invalid .mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-error-trailing-icon-color, var(--mat-sys-error))}.mat-form-field-invalid:not(.mat-focused):not(.mat-form-field-disabled) .mat-mdc-text-field-wrapper:hover .mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-error-hover-trailing-icon-color, var(--mat-sys-on-error-container))}.mat-form-field-invalid.mat-focused .mat-mdc-text-field-wrapper .mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-error-focus-trailing-icon-color, var(--mat-sys-error))}.mat-mdc-form-field-icon-prefix,[dir=rtl] .mat-mdc-form-field-icon-suffix{padding:0 4px 0 0}.mat-mdc-form-field-icon-suffix,[dir=rtl] .mat-mdc-form-field-icon-prefix{padding:0 0 0 4px}.mat-mdc-form-field-subscript-wrapper .mat-icon,.mat-mdc-form-field label .mat-icon{width:1em;height:1em;font-size:inherit}.mat-mdc-form-field-infix{flex:auto;min-width:0;width:180px;position:relative;box-sizing:border-box}.mat-mdc-form-field-infix:has(textarea[cols]){width:auto}.mat-mdc-form-field .mdc-notched-outline__notch{margin-left:-1px;-webkit-clip-path:inset(-9em -999em -9em 1px);clip-path:inset(-9em -999em -9em 1px)}[dir=rtl] .mat-mdc-form-field .mdc-notched-outline__notch{margin-left:0;margin-right:-1px;-webkit-clip-path:inset(-9em 1px -9em -999em);clip-path:inset(-9em 1px -9em -999em)}.mat-mdc-form-field.mat-form-field-animations-enabled .mdc-floating-label{transition:transform 150ms cubic-bezier(0.4, 0, 0.2, 1),color 150ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-mdc-form-field.mat-form-field-animations-enabled .mdc-text-field__input{transition:opacity 150ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-mdc-form-field.mat-form-field-animations-enabled .mdc-text-field__input::placeholder{transition:opacity 67ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-mdc-form-field.mat-form-field-animations-enabled .mdc-text-field__input::-moz-placeholder{transition:opacity 67ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-mdc-form-field.mat-form-field-animations-enabled .mdc-text-field__input::-webkit-input-placeholder{transition:opacity 67ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-mdc-form-field.mat-form-field-animations-enabled .mdc-text-field__input:-ms-input-placeholder{transition:opacity 67ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-mdc-form-field.mat-form-field-animations-enabled.mdc-text-field--no-label .mdc-text-field__input::placeholder,.mat-mdc-form-field.mat-form-field-animations-enabled.mdc-text-field--focused .mdc-text-field__input::placeholder{transition-delay:40ms;transition-duration:110ms}.mat-mdc-form-field.mat-form-field-animations-enabled.mdc-text-field--no-label .mdc-text-field__input::-moz-placeholder,.mat-mdc-form-field.mat-form-field-animations-enabled.mdc-text-field--focused .mdc-text-field__input::-moz-placeholder{transition-delay:40ms;transition-duration:110ms}.mat-mdc-form-field.mat-form-field-animations-enabled.mdc-text-field--no-label .mdc-text-field__input::-webkit-input-placeholder,.mat-mdc-form-field.mat-form-field-animations-enabled.mdc-text-field--focused .mdc-text-field__input::-webkit-input-placeholder{transition-delay:40ms;transition-duration:110ms}.mat-mdc-form-field.mat-form-field-animations-enabled.mdc-text-field--no-label .mdc-text-field__input:-ms-input-placeholder,.mat-mdc-form-field.mat-form-field-animations-enabled.mdc-text-field--focused .mdc-text-field__input:-ms-input-placeholder{transition-delay:40ms;transition-duration:110ms}.mat-mdc-form-field.mat-form-field-animations-enabled .mdc-text-field--filled:not(.mdc-ripple-upgraded):focus .mdc-text-field__ripple::before{transition-duration:75ms}.mat-mdc-form-field.mat-form-field-animations-enabled .mdc-line-ripple::after{transition:transform 180ms cubic-bezier(0.4, 0, 0.2, 1),opacity 180ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-mdc-form-field.mat-form-field-animations-enabled .mat-mdc-form-field-hint-wrapper,.mat-mdc-form-field.mat-form-field-animations-enabled .mat-mdc-form-field-error-wrapper{animation-duration:300ms}.mdc-notched-outline .mdc-floating-label{max-width:calc(100% + 1px)}.mdc-notched-outline--upgraded .mdc-floating-label--float-above{max-width:calc(133.3333333333% + 1px)}\n'],encapsulation:2,changeDetection:0})}return t})();class V5{_letterKeyStream=new Et;_items=[];_selectedItemIndex=-1;_pressedLetters=[];_skipPredicateFn;_selectedItem=new Et;selectedItem=this._selectedItem;constructor(n,e){const i="number"==typeof e?.debounceInterval?e.debounceInterval:200;e?.skipPredicate&&(this._skipPredicateFn=e.skipPredicate),this.setItems(n),this._setupKeyHandler(i)}destroy(){this._pressedLetters=[],this._letterKeyStream.complete(),this._selectedItem.complete()}setCurrentSelectedItemIndex(n){this._selectedItemIndex=n}setItems(n){this._items=n}handleKey(n){const e=n.keyCode;n.key&&1===n.key.length?this._letterKeyStream.next(n.key.toLocaleUpperCase()):(e>=65&&e<=90||e>=48&&e<=57)&&this._letterKeyStream.next(String.fromCharCode(e))}isTyping(){return this._pressedLetters.length>0}reset(){this._pressedLetters=[]}_setupKeyHandler(n){this._letterKeyStream.pipe(Rr(e=>this._pressedLetters.push(e)),qB(n),bs(()=>this._pressedLetters.length>0),an(()=>this._pressedLetters.join("").toLocaleUpperCase())).subscribe(e=>{for(let i=1;i<this._items.length+1;i++){const l=this._items[(this._selectedItemIndex+i)%this._items.length];if(!this._skipPredicateFn?.(l)&&0===l.getLabel?.().toLocaleUpperCase().trim().indexOf(e)){this._selectedItem.next(l);break}}this._pressedLetters=[]})}}function G5(t,n,e){const i=VT(t,n);e=e.trim(),!i.some(r=>r.trim()===e)&&(i.push(e),t.setAttribute(n,i.join(" ")))}function fP(t,n,e){const i=VT(t,n);e=e.trim();const r=i.filter(l=>l!==e);r.length?t.setAttribute(n,r.join(" ")):t.removeAttribute(n)}function VT(t,n){return t.getAttribute(n)?.match(/\S+/g)??[]}const q5="cdk-describedby-message",UT="cdk-describedby-host";let mP=0,lie=(()=>{class t{_platform=te(xs);_document=te(mr);_messageRegistry=new Map;_messagesContainer=null;_id=""+mP++;constructor(){te(cc).load(Wy),this._id=te(gd)+"-"+mP++}describe(e,i,r){if(!this._canBeDescribed(e,i))return;const l=gP(i,r);"string"!=typeof i?(W5(i,this._id),this._messageRegistry.set(l,{messageElement:i,referenceCount:0})):this._messageRegistry.has(l)||this._createMessageElement(i,r),this._isElementDescribedByMessage(e,l)||this._addMessageReference(e,l)}removeDescription(e,i,r){if(!i||!this._isElementNode(e))return;const l=gP(i,r);if(this._isElementDescribedByMessage(e,l)&&this._removeMessageReference(e,l),"string"==typeof i){const f=this._messageRegistry.get(l);f&&0===f.referenceCount&&this._deleteMessageElement(l)}0===this._messagesContainer?.childNodes.length&&(this._messagesContainer.remove(),this._messagesContainer=null)}ngOnDestroy(){const e=this._document.querySelectorAll(`[${UT}="${this._id}"]`);for(let i=0;i<e.length;i++)this._removeCdkDescribedByReferenceIds(e[i]),e[i].removeAttribute(UT);this._messagesContainer?.remove(),this._messagesContainer=null,this._messageRegistry.clear()}_createMessageElement(e,i){const r=this._document.createElement("div");W5(r,this._id),r.textContent=e,i&&r.setAttribute("role",i),this._createMessagesContainer(),this._messagesContainer.appendChild(r),this._messageRegistry.set(gP(e,i),{messageElement:r,referenceCount:0})}_deleteMessageElement(e){this._messageRegistry.get(e)?.messageElement?.remove(),this._messageRegistry.delete(e)}_createMessagesContainer(){if(this._messagesContainer)return;const e="cdk-describedby-message-container",i=this._document.querySelectorAll(`.${e}[platform="server"]`);for(let l=0;l<i.length;l++)i[l].remove();const r=this._document.createElement("div");r.style.visibility="hidden",r.classList.add(e),r.classList.add("cdk-visually-hidden"),this._platform.isBrowser||r.setAttribute("platform","server"),this._document.body.appendChild(r),this._messagesContainer=r}_removeCdkDescribedByReferenceIds(e){const i=VT(e,"aria-describedby").filter(r=>0!=r.indexOf(q5));e.setAttribute("aria-describedby",i.join(" "))}_addMessageReference(e,i){const r=this._messageRegistry.get(i);G5(e,"aria-describedby",r.messageElement.id),e.setAttribute(UT,this._id),r.referenceCount++}_removeMessageReference(e,i){const r=this._messageRegistry.get(i);r.referenceCount--,fP(e,"aria-describedby",r.messageElement.id),e.removeAttribute(UT)}_isElementDescribedByMessage(e,i){const r=VT(e,"aria-describedby"),l=this._messageRegistry.get(i),f=l&&l.messageElement.id;return!!f&&-1!=r.indexOf(f)}_canBeDescribed(e,i){if(!this._isElementNode(e))return!1;if(i&&"object"==typeof i)return!0;const r=null==i?"":`${i}`.trim(),l=e.getAttribute("aria-label");return!(!r||l&&l.trim()===r)}_isElementNode(e){return e.nodeType===this._document.ELEMENT_NODE}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function gP(t,n){return"string"==typeof t?`${n||""}/${t}`:t}function W5(t,n){t.id||(t.id=`${q5}-${n}-${mP++}`)}class Y5{_items;_activeItemIndex=-1;_activeItem=wr(null);_wrap=!1;_typeaheadSubscription=Mi.EMPTY;_itemChangesSubscription;_vertical=!0;_horizontal;_allowedModifierKeys=[];_homeAndEnd=!1;_pageUpAndDown={enabled:!1,delta:10};_effectRef;_typeahead;_skipPredicateFn=n=>n.disabled;constructor(n,e){this._items=n,n instanceof gs?this._itemChangesSubscription=n.changes.subscribe(i=>this._itemsChanged(i.toArray())):Gr(n)&&(this._effectRef=tM(()=>this._itemsChanged(n()),{injector:e}))}tabOut=new Et;change=new Et;skipPredicate(n){return this._skipPredicateFn=n,this}withWrap(n=!0){return this._wrap=n,this}withVerticalOrientation(n=!0){return this._vertical=n,this}withHorizontalOrientation(n){return this._horizontal=n,this}withAllowedModifierKeys(n){return this._allowedModifierKeys=n,this}withTypeAhead(n=200){this._typeaheadSubscription.unsubscribe();const e=this._getItemsArray();return this._typeahead=new V5(e,{debounceInterval:"number"==typeof n?n:void 0,skipPredicate:i=>this._skipPredicateFn(i)}),this._typeaheadSubscription=this._typeahead.selectedItem.subscribe(i=>{this.setActiveItem(i)}),this}cancelTypeahead(){return this._typeahead?.reset(),this}withHomeAndEnd(n=!0){return this._homeAndEnd=n,this}withPageUpDown(n=!0,e=10){return this._pageUpAndDown={enabled:n,delta:e},this}setActiveItem(n){const e=this._activeItem();this.updateActiveItem(n),this._activeItem()!==e&&this.change.next(this._activeItemIndex)}onKeydown(n){const e=n.keyCode,r=["altKey","ctrlKey","metaKey","shiftKey"].every(l=>!n[l]||this._allowedModifierKeys.indexOf(l)>-1);switch(e){case 9:return void this.tabOut.next();case 40:if(this._vertical&&r){this.setNextItemActive();break}return;case 38:if(this._vertical&&r){this.setPreviousItemActive();break}return;case 39:if(this._horizontal&&r){"rtl"===this._horizontal?this.setPreviousItemActive():this.setNextItemActive();break}return;case 37:if(this._horizontal&&r){"rtl"===this._horizontal?this.setNextItemActive():this.setPreviousItemActive();break}return;case 36:if(this._homeAndEnd&&r){this.setFirstItemActive();break}return;case 35:if(this._homeAndEnd&&r){this.setLastItemActive();break}return;case 33:if(this._pageUpAndDown.enabled&&r){const l=this._activeItemIndex-this._pageUpAndDown.delta;this._setActiveItemByIndex(l>0?l:0,1);break}return;case 34:if(this._pageUpAndDown.enabled&&r){const l=this._activeItemIndex+this._pageUpAndDown.delta,f=this._getItemsArray().length;this._setActiveItemByIndex(l<f?l:f-1,-1);break}return;default:return void((r||Ja(n,"shiftKey"))&&this._typeahead?.handleKey(n))}this._typeahead?.reset(),n.preventDefault()}get activeItemIndex(){return this._activeItemIndex}get activeItem(){return this._activeItem()}isTyping(){return!!this._typeahead&&this._typeahead.isTyping()}setFirstItemActive(){this._setActiveItemByIndex(0,1)}setLastItemActive(){this._setActiveItemByIndex(this._getItemsArray().length-1,-1)}setNextItemActive(){this._activeItemIndex<0?this.setFirstItemActive():this._setActiveItemByDelta(1)}setPreviousItemActive(){this._activeItemIndex<0&&this._wrap?this.setLastItemActive():this._setActiveItemByDelta(-1)}updateActiveItem(n){const e=this._getItemsArray(),i="number"==typeof n?n:e.indexOf(n);this._activeItem.set(e[i]??null),this._activeItemIndex=i,this._typeahead?.setCurrentSelectedItemIndex(i)}destroy(){this._typeaheadSubscription.unsubscribe(),this._itemChangesSubscription?.unsubscribe(),this._effectRef?.destroy(),this._typeahead?.destroy(),this.tabOut.complete(),this.change.complete()}_setActiveItemByDelta(n){this._wrap?this._setActiveInWrapMode(n):this._setActiveInDefaultMode(n)}_setActiveInWrapMode(n){const e=this._getItemsArray();for(let i=1;i<=e.length;i++){const r=(this._activeItemIndex+n*i+e.length)%e.length;if(!this._skipPredicateFn(e[r]))return void this.setActiveItem(r)}}_setActiveInDefaultMode(n){this._setActiveItemByIndex(this._activeItemIndex+n,n)}_setActiveItemByIndex(n,e){const i=this._getItemsArray();if(i[n]){for(;this._skipPredicateFn(i[n]);)if(!i[n+=e])return;this.setActiveItem(n)}}_getItemsArray(){return Gr(this._items)?this._items():this._items instanceof gs?this._items.toArray():this._items}_itemsChanged(n){this._typeahead?.setItems(n);const e=this._activeItem();if(e){const i=n.indexOf(e);i>-1&&i!==this._activeItemIndex&&(this._activeItemIndex=i,this._typeahead?.setCurrentSelectedItemIndex(i))}}}class uie extends Y5{setActiveItem(n){this.activeItem&&this.activeItem.setInactiveStyles(),super.setActiveItem(n),this.activeItem&&this.activeItem.setActiveStyles()}}class hie{_multiple;_emitChanges;compareWith;_selection=new Set;_deselectedToEmit=[];_selectedToEmit=[];_selected;get selected(){return this._selected||(this._selected=Array.from(this._selection.values())),this._selected}changed=new Et;constructor(n=!1,e,i=!0,r){this._multiple=n,this._emitChanges=i,this.compareWith=r,e&&e.length&&(n?e.forEach(l=>this._markSelected(l)):this._markSelected(e[0]),this._selectedToEmit.length=0)}select(...n){this._verifyValueAssignment(n),n.forEach(i=>this._markSelected(i));const e=this._hasQueuedChanges();return this._emitChangeEvent(),e}deselect(...n){this._verifyValueAssignment(n),n.forEach(i=>this._unmarkSelected(i));const e=this._hasQueuedChanges();return this._emitChangeEvent(),e}setSelection(...n){this._verifyValueAssignment(n);const e=this.selected,i=new Set(n.map(l=>this._getConcreteValue(l)));n.forEach(l=>this._markSelected(l)),e.filter(l=>!i.has(this._getConcreteValue(l,i))).forEach(l=>this._unmarkSelected(l));const r=this._hasQueuedChanges();return this._emitChangeEvent(),r}toggle(n){return this.isSelected(n)?this.deselect(n):this.select(n)}clear(n=!0){this._unmarkAll();const e=this._hasQueuedChanges();return n&&this._emitChangeEvent(),e}isSelected(n){return this._selection.has(this._getConcreteValue(n))}isEmpty(){return 0===this._selection.size}hasValue(){return!this.isEmpty()}sort(n){this._multiple&&this.selected&&this._selected.sort(n)}isMultipleSelection(){return this._multiple}_emitChangeEvent(){this._selected=null,(this._selectedToEmit.length||this._deselectedToEmit.length)&&(this.changed.next({source:this,added:this._selectedToEmit,removed:this._deselectedToEmit}),this._deselectedToEmit=[],this._selectedToEmit=[])}_markSelected(n){n=this._getConcreteValue(n),this.isSelected(n)||(this._multiple||this._unmarkAll(),this.isSelected(n)||this._selection.add(n),this._emitChanges&&this._selectedToEmit.push(n))}_unmarkSelected(n){n=this._getConcreteValue(n),this.isSelected(n)&&(this._selection.delete(n),this._emitChanges&&this._deselectedToEmit.push(n))}_unmarkAll(){this.isEmpty()||this._selection.forEach(n=>this._unmarkSelected(n))}_verifyValueAssignment(n){}_hasQueuedChanges(){return!(!this._deselectedToEmit.length&&!this._selectedToEmit.length)}_getConcreteValue(n,e){if(this.compareWith){e=e??this._selection;for(let i of e)if(this.compareWith(n,i))return i;return n}return n}}let pie=(()=>{class t{_animationMode=te(wa,{optional:!0});state="unchecked";disabled=!1;appearance="full";constructor(){}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=kn({type:t,selectors:[["mat-pseudo-checkbox"]],hostAttrs:[1,"mat-pseudo-checkbox"],hostVars:12,hostBindings:function(i,r){2&i&&Di("mat-pseudo-checkbox-indeterminate","indeterminate"===r.state)("mat-pseudo-checkbox-checked","checked"===r.state)("mat-pseudo-checkbox-disabled",r.disabled)("mat-pseudo-checkbox-minimal","minimal"===r.appearance)("mat-pseudo-checkbox-full","full"===r.appearance)("_mat-animation-noopable","NoopAnimations"===r._animationMode)},inputs:{state:"state",disabled:"disabled",appearance:"appearance"},decls:0,vars:0,template:function(i,r){},styles:['.mat-pseudo-checkbox{border-radius:2px;cursor:pointer;display:inline-block;vertical-align:middle;box-sizing:border-box;position:relative;flex-shrink:0;transition:border-color 90ms cubic-bezier(0, 0, 0.2, 0.1),background-color 90ms cubic-bezier(0, 0, 0.2, 0.1)}.mat-pseudo-checkbox::after{position:absolute;opacity:0;content:"";border-bottom:2px solid currentColor;transition:opacity 90ms cubic-bezier(0, 0, 0.2, 0.1)}.mat-pseudo-checkbox._mat-animation-noopable{transition:none !important;animation:none !important}.mat-pseudo-checkbox._mat-animation-noopable::after{transition:none}.mat-pseudo-checkbox-disabled{cursor:default}.mat-pseudo-checkbox-indeterminate::after{left:1px;opacity:1;border-radius:2px}.mat-pseudo-checkbox-checked::after{left:1px;border-left:2px solid currentColor;transform:rotate(-45deg);opacity:1;box-sizing:content-box}.mat-pseudo-checkbox-minimal.mat-pseudo-checkbox-checked::after,.mat-pseudo-checkbox-minimal.mat-pseudo-checkbox-indeterminate::after{color:var(--mat-minimal-pseudo-checkbox-selected-checkmark-color, var(--mat-sys-primary))}.mat-pseudo-checkbox-minimal.mat-pseudo-checkbox-checked.mat-pseudo-checkbox-disabled::after,.mat-pseudo-checkbox-minimal.mat-pseudo-checkbox-indeterminate.mat-pseudo-checkbox-disabled::after{color:var(--mat-minimal-pseudo-checkbox-disabled-selected-checkmark-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent))}.mat-pseudo-checkbox-full{border-color:var(--mat-full-pseudo-checkbox-unselected-icon-color, var(--mat-sys-on-surface-variant));border-width:2px;border-style:solid}.mat-pseudo-checkbox-full.mat-pseudo-checkbox-disabled{border-color:var(--mat-full-pseudo-checkbox-disabled-unselected-icon-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent))}.mat-pseudo-checkbox-full.mat-pseudo-checkbox-checked,.mat-pseudo-checkbox-full.mat-pseudo-checkbox-indeterminate{background-color:var(--mat-full-pseudo-checkbox-selected-icon-color, var(--mat-sys-primary));border-color:rgba(0,0,0,0)}.mat-pseudo-checkbox-full.mat-pseudo-checkbox-checked::after,.mat-pseudo-checkbox-full.mat-pseudo-checkbox-indeterminate::after{color:var(--mat-full-pseudo-checkbox-selected-checkmark-color, var(--mat-sys-on-primary))}.mat-pseudo-checkbox-full.mat-pseudo-checkbox-checked.mat-pseudo-checkbox-disabled,.mat-pseudo-checkbox-full.mat-pseudo-checkbox-indeterminate.mat-pseudo-checkbox-disabled{background-color:var(--mat-full-pseudo-checkbox-disabled-selected-icon-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent))}.mat-pseudo-checkbox-full.mat-pseudo-checkbox-checked.mat-pseudo-checkbox-disabled::after,.mat-pseudo-checkbox-full.mat-pseudo-checkbox-indeterminate.mat-pseudo-checkbox-disabled::after{color:var(--mat-full-pseudo-checkbox-disabled-selected-checkmark-color, var(--mat-sys-surface))}.mat-pseudo-checkbox{width:18px;height:18px}.mat-pseudo-checkbox-minimal.mat-pseudo-checkbox-checked::after{width:14px;height:6px;transform-origin:center;top:-4.2426406871px;left:0;bottom:0;right:0;margin:auto}.mat-pseudo-checkbox-minimal.mat-pseudo-checkbox-indeterminate::after{top:8px;width:16px}.mat-pseudo-checkbox-full.mat-pseudo-checkbox-checked::after{width:10px;height:4px;transform-origin:center;top:-2.8284271247px;left:0;bottom:0;right:0;margin:auto}.mat-pseudo-checkbox-full.mat-pseudo-checkbox-indeterminate::after{top:6px;width:12px}\n'],encapsulation:2,changeDetection:0})}return t})();const fie=["text"],mie=[[["mat-icon"]],"*"],gie=["mat-icon","*"];function _ie(t,n){if(1&t&&Wt(0,"mat-pseudo-checkbox",1),2&t){const e=Lt();Xe("disabled",e.disabled)("state",e.selected?"checked":"unchecked")}}function yie(t,n){1&t&&Wt(0,"mat-pseudo-checkbox",3),2&t&&Xe("disabled",Lt().disabled)}function vie(t,n){if(1&t&&(ae(0,"span",4),Re(1),le()),2&t){const e=Lt();xe(),Ci("(",e.group.label,")")}}const Z5=new _t("MAT_OPTION_PARENT_COMPONENT"),X5=new _t("MatOptgroup");class bie{source;isUserInput;constructor(n,e=!1){this.source=n,this.isUserInput=e}}let oE=(()=>{class t{_element=te(Dn);_changeDetectorRef=te(Do);_parent=te(Z5,{optional:!0});group=te(X5,{optional:!0});_signalDisableRipple=!1;_selected=!1;_active=!1;_disabled=!1;_mostRecentViewValue="";get multiple(){return this._parent&&this._parent.multiple}get selected(){return this._selected}value;id=te(Sa).getId("mat-option-");get disabled(){return this.group&&this.group.disabled||this._disabled}set disabled(e){this._disabled=e}get disableRipple(){return this._signalDisableRipple?this._parent.disableRipple():!!this._parent?.disableRipple}get hideSingleSelectionIndicator(){return!(!this._parent||!this._parent.hideSingleSelectionIndicator)}onSelectionChange=new $e;_text;_stateChanges=new Et;constructor(){const e=te(cc);e.load(H0),e.load(Wy),this._signalDisableRipple=!!this._parent&&Gr(this._parent.disableRipple)}get active(){return this._active}get viewValue(){return(this._text?.nativeElement.textContent||"").trim()}select(e=!0){this._selected||(this._selected=!0,this._changeDetectorRef.markForCheck(),e&&this._emitSelectionChangeEvent())}deselect(e=!0){this._selected&&(this._selected=!1,this._changeDetectorRef.markForCheck(),e&&this._emitSelectionChangeEvent())}focus(e,i){const r=this._getHostElement();"function"==typeof r.focus&&r.focus(i)}setActiveStyles(){this._active||(this._active=!0,this._changeDetectorRef.markForCheck())}setInactiveStyles(){this._active&&(this._active=!1,this._changeDetectorRef.markForCheck())}getLabel(){return this.viewValue}_handleKeydown(e){(13===e.keyCode||32===e.keyCode)&&!Ja(e)&&(this._selectViaInteraction(),e.preventDefault())}_selectViaInteraction(){this.disabled||(this._selected=!this.multiple||!this._selected,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent(!0))}_getTabIndex(){return this.disabled?"-1":"0"}_getHostElement(){return this._element.nativeElement}ngAfterViewChecked(){if(this._selected){const e=this.viewValue;e!==this._mostRecentViewValue&&(this._mostRecentViewValue&&this._stateChanges.next(),this._mostRecentViewValue=e)}}ngOnDestroy(){this._stateChanges.complete()}_emitSelectionChangeEvent(e=!1){this.onSelectionChange.emit(new bie(this,e))}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=kn({type:t,selectors:[["mat-option"]],viewQuery:function(i,r){if(1&i&&kr(fie,7),2&i){let l;Zn(l=Xn())&&(r._text=l.first)}},hostAttrs:["role","option",1,"mat-mdc-option","mdc-list-item"],hostVars:11,hostBindings:function(i,r){1&i&&Tt("click",function(){return r._selectViaInteraction()})("keydown",function(f){return r._handleKeydown(f)}),2&i&&(rc("id",r.id),ii("aria-selected",r.selected)("aria-disabled",r.disabled.toString()),Di("mdc-list-item--selected",r.selected)("mat-mdc-option-multiple",r.multiple)("mat-mdc-option-active",r.active)("mdc-list-item--disabled",r.disabled))},inputs:{value:"value",id:"id",disabled:[2,"disabled","disabled",Un]},outputs:{onSelectionChange:"onSelectionChange"},exportAs:["matOption"],ngContentSelectors:gie,decls:8,vars:5,consts:[["text",""],["aria-hidden","true",1,"mat-mdc-option-pseudo-checkbox",3,"disabled","state"],[1,"mdc-list-item__primary-text"],["state","checked","aria-hidden","true","appearance","minimal",1,"mat-mdc-option-pseudo-checkbox",3,"disabled"],[1,"cdk-visually-hidden"],["aria-hidden","true","mat-ripple","",1,"mat-mdc-option-ripple","mat-focus-indicator",3,"matRippleTrigger","matRippleDisabled"]],template:function(i,r){1&i&&(os(mie),vt(0,_ie,1,2,"mat-pseudo-checkbox",1),Fi(1),ae(2,"span",2,0),Fi(4,1),le(),vt(5,yie,1,1,"mat-pseudo-checkbox",3)(6,vie,2,1,"span",4),Wt(7,"div",5)),2&i&&(qi(r.multiple?0:-1),xe(5),qi(r.multiple||!r.selected||r.hideSingleSelectionIndicator?-1:5),xe(),qi(r.group&&r.group._inert?6:-1),xe(),Xe("matRippleTrigger",r._getHostElement())("matRippleDisabled",r.disabled||r.disableRipple))},dependencies:[pie,KV],styles:['.mat-mdc-option{-webkit-user-select:none;user-select:none;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;display:flex;position:relative;align-items:center;justify-content:flex-start;overflow:hidden;min-height:48px;padding:0 16px;cursor:pointer;-webkit-tap-highlight-color:rgba(0,0,0,0);color:var(--mat-option-label-text-color, var(--mat-sys-on-surface));font-family:var(--mat-option-label-text-font, var(--mat-sys-label-large-font));line-height:var(--mat-option-label-text-line-height, var(--mat-sys-label-large-line-height));font-size:var(--mat-option-label-text-size, var(--mat-sys-body-large-size));letter-spacing:var(--mat-option-label-text-tracking, var(--mat-sys-label-large-tracking));font-weight:var(--mat-option-label-text-weight, var(--mat-sys-body-large-weight))}.mat-mdc-option:hover:not(.mdc-list-item--disabled){background-color:var(--mat-option-hover-state-layer-color, color-mix(in srgb, var(--mat-sys-on-surface) calc(var(--mat-sys-hover-state-layer-opacity) * 100%), transparent))}.mat-mdc-option:focus.mdc-list-item,.mat-mdc-option.mat-mdc-option-active.mdc-list-item{background-color:var(--mat-option-focus-state-layer-color, color-mix(in srgb, var(--mat-sys-on-surface) calc(var(--mat-sys-focus-state-layer-opacity) * 100%), transparent));outline:0}.mat-mdc-option.mdc-list-item--selected:not(.mdc-list-item--disabled):not(.mat-mdc-option-multiple){background-color:var(--mat-option-selected-state-layer-color, var(--mat-sys-secondary-container))}.mat-mdc-option.mdc-list-item--selected:not(.mdc-list-item--disabled):not(.mat-mdc-option-multiple) .mdc-list-item__primary-text{color:var(--mat-option-selected-state-label-text-color, var(--mat-sys-on-secondary-container))}.mat-mdc-option .mat-pseudo-checkbox{--mat-minimal-pseudo-checkbox-selected-checkmark-color: var(--mat-option-selected-state-label-text-color, var(--mat-sys-on-secondary-container))}.mat-mdc-option.mdc-list-item{align-items:center;background:rgba(0,0,0,0)}.mat-mdc-option.mdc-list-item--disabled{cursor:default;pointer-events:none}.mat-mdc-option.mdc-list-item--disabled .mat-mdc-option-pseudo-checkbox,.mat-mdc-option.mdc-list-item--disabled .mdc-list-item__primary-text,.mat-mdc-option.mdc-list-item--disabled>mat-icon{opacity:.38}.mat-mdc-optgroup .mat-mdc-option:not(.mat-mdc-option-multiple){padding-left:32px}[dir=rtl] .mat-mdc-optgroup .mat-mdc-option:not(.mat-mdc-option-multiple){padding-left:16px;padding-right:32px}.mat-mdc-option .mat-icon,.mat-mdc-option .mat-pseudo-checkbox-full{margin-right:16px;flex-shrink:0}[dir=rtl] .mat-mdc-option .mat-icon,[dir=rtl] .mat-mdc-option .mat-pseudo-checkbox-full{margin-right:0;margin-left:16px}.mat-mdc-option .mat-pseudo-checkbox-minimal{margin-left:16px;flex-shrink:0}[dir=rtl] .mat-mdc-option .mat-pseudo-checkbox-minimal{margin-right:16px;margin-left:0}.mat-mdc-option .mat-mdc-option-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none}.mat-mdc-option .mdc-list-item__primary-text{white-space:normal;font-size:inherit;font-weight:inherit;letter-spacing:inherit;line-height:inherit;font-family:inherit;text-decoration:inherit;text-transform:inherit;margin-right:auto}[dir=rtl] .mat-mdc-option .mdc-list-item__primary-text{margin-right:0;margin-left:auto}@media(forced-colors: active){.mat-mdc-option.mdc-list-item--selected:not(:has(.mat-mdc-option-pseudo-checkbox))::after{content:"";position:absolute;top:50%;right:16px;transform:translateY(-50%);width:10px;height:0;border-bottom:solid 10px;border-radius:10px}[dir=rtl] .mat-mdc-option.mdc-list-item--selected:not(:has(.mat-mdc-option-pseudo-checkbox))::after{right:auto;left:16px}}.mat-mdc-option-multiple{--mdc-list-list-item-selected-container-color:var(--mdc-list-list-item-container-color, transparent)}.mat-mdc-option-active .mat-focus-indicator::before{content:""}\n'],encapsulation:2,changeDetection:0})}return t})(),jT=(()=>{class t{isErrorState(e,i){return!!(e&&e.invalid&&(e.touched||i&&i.submitted))}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();class _P{_defaultMatcher;ngControl;_parentFormGroup;_parentForm;_stateChanges;errorState=!1;matcher;constructor(n,e,i,r,l){this._defaultMatcher=n,this.ngControl=e,this._parentFormGroup=i,this._parentForm=r,this._stateChanges=l}updateErrorState(){const n=this.errorState,e=this._parentFormGroup||this._parentForm,i=this.matcher||this._defaultMatcher,r=this.ngControl?this.ngControl.control:null,l=i?.isErrorState(r,e)??!1;l!==n&&(this.errorState=l,this._stateChanges.next())}}let Wg=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275mod=Er({type:t});static \u0275inj=Ai({imports:[Qr,XB,Qr]})}return t})(),Cie=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275mod=Er({type:t});static \u0275inj=Ai({imports:[Qr]})}return t})(),K5=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275mod=Er({type:t});static \u0275inj=Ai({imports:[xR,Qr,Cie]})}return t})();const Eie=["trigger"],Sie=["panel"],Die=[[["mat-select-trigger"]],"*"],Mie=["mat-select-trigger","*"];function Tie(t,n){if(1&t&&(ae(0,"span",4),Re(1),le()),2&t){const e=Lt();xe(),er(e.placeholder)}}function Iie(t,n){1&t&&Fi(0)}function Aie(t,n){if(1&t&&(ae(0,"span",11),Re(1),le()),2&t){const e=Lt(2);xe(),er(e.triggerValue)}}function kie(t,n){if(1&t&&(ae(0,"span",5),vt(1,Iie,1,0)(2,Aie,2,1,"span",11),le()),2&t){const e=Lt();xe(),qi(e.customTrigger?1:2)}}function Rie(t,n){if(1&t){const e=_i();ae(0,"div",12,1),Tt("keydown",function(r){return on(e),ln(Lt()._handleKeydown(r))}),Fi(2,1),le()}if(2&t){const e=Lt();(function HF(t,n,e){wh(pa,kp,p0(xt(),t,n,e),!0)})("mat-mdc-select-panel mdc-menu-surface mdc-menu-surface--open ",e._getPanelTheme(),""),Di("mat-select-panel-animations-enabled",!e._animationsDisabled),Xe("ngClass",e.panelClass),ii("id",e.id+"-panel")("aria-multiselectable",e.multiple)("aria-label",e.ariaLabel||null)("aria-labelledby",e._getPanelAriaLabelledby())}}const Q5=new _t("mat-select-scroll-strategy",{providedIn:"root",factory:()=>{const t=te(oa);return()=>t.scrollStrategies.reposition()}}),Oie=new _t("MAT_SELECT_CONFIG"),Fie={provide:Q5,deps:[oa],useFactory:function Pie(t){return()=>t.scrollStrategies.reposition()}},Lie=new _t("MatSelectTrigger");class Nie{source;value;constructor(n,e){this.source=n,this.value=e}}let HT=(()=>{class t{_viewportRuler=te(JM);_changeDetectorRef=te(Do);_elementRef=te(Dn);_dir=te(Bc,{optional:!0});_idGenerator=te(Sa);_renderer=te(yt);_parentFormField=te(rE,{optional:!0});ngControl=te(Ih,{self:!0,optional:!0});_liveAnnouncer=te(nV);_defaultOptions=te(Oie,{optional:!0});_animationsDisabled="NoopAnimations"===te(wa,{optional:!0});_initialized=new Et;_cleanupDetach;options;optionGroups;customTrigger;_positions=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom",panelClass:"mat-mdc-select-panel-above"},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom",panelClass:"mat-mdc-select-panel-above"}];_scrollOptionIntoView(e){const i=this.options.toArray()[e];if(i){const r=this.panel.nativeElement,l=function xie(t,n,e){if(e.length){let i=n.toArray(),r=e.toArray(),l=0;for(let f=0;f<t+1;f++)i[f].group&&i[f].group===r[l]&&l++;return l}return 0}(e,this.options,this.optionGroups),f=i._getHostElement();r.scrollTop=0===e&&1===l?0:function wie(t,n,e,i){return t<e?t:t+n>e+i?Math.max(0,t-i+n):e}(f.offsetTop,f.offsetHeight,r.scrollTop,r.offsetHeight)}}_positioningSettled(){this._scrollOptionIntoView(this._keyManager.activeItemIndex||0)}_getChangeEvent(e){return new Nie(this,e)}_scrollStrategyFactory=te(Q5);_panelOpen=!1;_compareWith=(e,i)=>e===i;_uid=this._idGenerator.getId("mat-select-");_triggerAriaLabelledBy=null;_previousControl;_destroy=new Et;_errorStateTracker;stateChanges=new Et;disableAutomaticLabeling=!0;userAriaDescribedBy;_selectionModel;_keyManager;_preferredOverlayOrigin;_overlayWidth;_onChange=()=>{};_onTouched=()=>{};_valueId=this._idGenerator.getId("mat-select-value-");_scrollStrategy;_overlayPanelClass=this._defaultOptions?.overlayPanelClass||"";get focused(){return this._focused||this._panelOpen}_focused=!1;controlType="mat-select";trigger;panel;_overlayDir;panelClass;disabled=!1;disableRipple=!1;tabIndex=0;get hideSingleSelectionIndicator(){return this._hideSingleSelectionIndicator}set hideSingleSelectionIndicator(e){this._hideSingleSelectionIndicator=e,this._syncParentProperties()}_hideSingleSelectionIndicator=this._defaultOptions?.hideSingleSelectionIndicator??!1;get placeholder(){return this._placeholder}set placeholder(e){this._placeholder=e,this.stateChanges.next()}_placeholder;get required(){return this._required??this.ngControl?.control?.hasValidator(bn.required)??!1}set required(e){this._required=e,this.stateChanges.next()}_required;get multiple(){return this._multiple}set multiple(e){this._multiple=e}_multiple=!1;disableOptionCentering=this._defaultOptions?.disableOptionCentering??!1;get compareWith(){return this._compareWith}set compareWith(e){this._compareWith=e,this._selectionModel&&this._initializeSelection()}get value(){return this._value}set value(e){this._assignValue(e)&&this._onChange(e)}_value;ariaLabel="";ariaLabelledby;get errorStateMatcher(){return this._errorStateTracker.matcher}set errorStateMatcher(e){this._errorStateTracker.matcher=e}typeaheadDebounceInterval;sortComparator;get id(){return this._id}set id(e){this._id=e||this._uid,this.stateChanges.next()}_id;get errorState(){return this._errorStateTracker.errorState}set errorState(e){this._errorStateTracker.errorState=e}panelWidth=this._defaultOptions&&typeof this._defaultOptions.panelWidth<"u"?this._defaultOptions.panelWidth:"auto";canSelectNullableOptions=this._defaultOptions?.canSelectNullableOptions??!1;optionSelectionChanges=oC(()=>{const e=this.options;return e?e.changes.pipe(Nc(e),lc(()=>zc(...e.map(i=>i.onSelectionChange)))):this._initialized.pipe(lc(()=>this.optionSelectionChanges))});openedChange=new $e;_openedStream=this.openedChange.pipe(bs(e=>e),an(()=>{}));_closedStream=this.openedChange.pipe(bs(e=>!e),an(()=>{}));selectionChange=new $e;valueChange=new $e;constructor(){const e=te(jT),i=te(tv,{optional:!0}),r=te(el,{optional:!0}),l=te(new Ee("tabindex"),{optional:!0});this.ngControl&&(this.ngControl.valueAccessor=this),null!=this._defaultOptions?.typeaheadDebounceInterval&&(this.typeaheadDebounceInterval=this._defaultOptions.typeaheadDebounceInterval),this._errorStateTracker=new _P(e,this.ngControl,r,i,this.stateChanges),this._scrollStrategy=this._scrollStrategyFactory(),this.tabIndex=null==l?0:parseInt(l)||0,this.id=this.id}ngOnInit(){this._selectionModel=new hie(this.multiple),this.stateChanges.next(),this._viewportRuler.change().pipe(jr(this._destroy)).subscribe(()=>{this.panelOpen&&(this._overlayWidth=this._getOverlayWidth(this._preferredOverlayOrigin),this._changeDetectorRef.detectChanges())})}ngAfterContentInit(){this._initialized.next(),this._initialized.complete(),this._initKeyManager(),this._selectionModel.changed.pipe(jr(this._destroy)).subscribe(e=>{e.added.forEach(i=>i.select()),e.removed.forEach(i=>i.deselect())}),this.options.changes.pipe(Nc(null),jr(this._destroy)).subscribe(()=>{this._resetOptions(),this._initializeSelection()})}ngDoCheck(){const e=this._getTriggerAriaLabelledby(),i=this.ngControl;if(e!==this._triggerAriaLabelledBy){const r=this._elementRef.nativeElement;this._triggerAriaLabelledBy=e,e?r.setAttribute("aria-labelledby",e):r.removeAttribute("aria-labelledby")}i&&(this._previousControl!==i.control&&(void 0!==this._previousControl&&null!==i.disabled&&i.disabled!==this.disabled&&(this.disabled=i.disabled),this._previousControl=i.control),this.updateErrorState())}ngOnChanges(e){(e.disabled||e.userAriaDescribedBy)&&this.stateChanges.next(),e.typeaheadDebounceInterval&&this._keyManager&&this._keyManager.withTypeAhead(this.typeaheadDebounceInterval)}ngOnDestroy(){this._cleanupDetach?.(),this._keyManager?.destroy(),this._destroy.next(),this._destroy.complete(),this.stateChanges.complete(),this._clearFromModal()}toggle(){this.panelOpen?this.close():this.open()}open(){this._canOpen()&&(this._parentFormField&&(this._preferredOverlayOrigin=this._parentFormField.getConnectedOverlayOrigin()),this._cleanupDetach?.(),this._overlayWidth=this._getOverlayWidth(this._preferredOverlayOrigin),this._applyModalPanelOwnership(),this._panelOpen=!0,this._overlayDir.positionChange.pipe(Qa(1)).subscribe(()=>{this._changeDetectorRef.detectChanges(),this._positioningSettled()}),this._overlayDir.attachOverlay(),this._keyManager.withHorizontalOrientation(null),this._highlightCorrectOption(),this._changeDetectorRef.markForCheck(),this.stateChanges.next(),Promise.resolve().then(()=>this.openedChange.emit(!0)))}_trackedModal=null;_applyModalPanelOwnership(){const e=this._elementRef.nativeElement.closest('body > .cdk-overlay-container [aria-modal="true"]');if(!e)return;const i=`${this.id}-panel`;this._trackedModal&&fP(this._trackedModal,"aria-owns",i),G5(e,"aria-owns",i),this._trackedModal=e}_clearFromModal(){this._trackedModal&&(fP(this._trackedModal,"aria-owns",`${this.id}-panel`),this._trackedModal=null)}close(){this._panelOpen&&(this._panelOpen=!1,this._exitAndDetach(),this._keyManager.withHorizontalOrientation(this._isRtl()?"rtl":"ltr"),this._changeDetectorRef.markForCheck(),this._onTouched(),this.stateChanges.next(),Promise.resolve().then(()=>this.openedChange.emit(!1)))}_exitAndDetach(){if(this._animationsDisabled||!this.panel)return void this._detachOverlay();this._cleanupDetach?.(),this._cleanupDetach=()=>{i(),clearTimeout(r),this._cleanupDetach=void 0};const e=this.panel.nativeElement,i=this._renderer.listen(e,"animationend",l=>{"_mat-select-exit"===l.animationName&&(this._cleanupDetach?.(),this._detachOverlay())}),r=setTimeout(()=>{this._cleanupDetach?.(),this._detachOverlay()},200);e.classList.add("mat-select-panel-exit")}_detachOverlay(){this._overlayDir.detachOverlay(),this._changeDetectorRef.markForCheck()}writeValue(e){this._assignValue(e)}registerOnChange(e){this._onChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e,this._changeDetectorRef.markForCheck(),this.stateChanges.next()}get panelOpen(){return this._panelOpen}get selected(){return this.multiple?this._selectionModel?.selected||[]:this._selectionModel?.selected[0]}get triggerValue(){if(this.empty)return"";if(this._multiple){const e=this._selectionModel.selected.map(i=>i.viewValue);return this._isRtl()&&e.reverse(),e.join(", ")}return this._selectionModel.selected[0].viewValue}updateErrorState(){this._errorStateTracker.updateErrorState()}_isRtl(){return!!this._dir&&"rtl"===this._dir.value}_handleKeydown(e){this.disabled||(this.panelOpen?this._handleOpenKeydown(e):this._handleClosedKeydown(e))}_handleClosedKeydown(e){const i=e.keyCode,r=40===i||38===i||37===i||39===i,l=13===i||32===i,f=this._keyManager;if(!f.isTyping()&&l&&!Ja(e)||(this.multiple||e.altKey)&&r)e.preventDefault(),this.open();else if(!this.multiple){const w=this.selected;f.onKeydown(e);const M=this.selected;M&&w!==M&&this._liveAnnouncer.announce(M.viewValue,1e4)}}_handleOpenKeydown(e){const i=this._keyManager,r=e.keyCode,l=40===r||38===r,f=i.isTyping();if(l&&e.altKey)e.preventDefault(),this.close();else if(f||13!==r&&32!==r||!i.activeItem||Ja(e))if(!f&&this._multiple&&65===r&&e.ctrlKey){e.preventDefault();const w=this.options.some(M=>!M.disabled&&!M.selected);this.options.forEach(M=>{M.disabled||(w?M.select():M.deselect())})}else{const w=i.activeItemIndex;i.onKeydown(e),this._multiple&&l&&e.shiftKey&&i.activeItem&&i.activeItemIndex!==w&&i.activeItem._selectViaInteraction()}else e.preventDefault(),i.activeItem._selectViaInteraction()}_handleOverlayKeydown(e){27===e.keyCode&&!Ja(e)&&(e.preventDefault(),this.close())}_onFocus(){this.disabled||(this._focused=!0,this.stateChanges.next())}_onBlur(){this._focused=!1,this._keyManager?.cancelTypeahead(),!this.disabled&&!this.panelOpen&&(this._onTouched(),this._changeDetectorRef.markForCheck(),this.stateChanges.next())}_getPanelTheme(){return this._parentFormField?`mat-${this._parentFormField.color}`:""}get empty(){return!this._selectionModel||this._selectionModel.isEmpty()}_initializeSelection(){Promise.resolve().then(()=>{this.ngControl&&(this._value=this.ngControl.value),this._setSelectionByValue(this._value),this.stateChanges.next()})}_setSelectionByValue(e){if(this.options.forEach(i=>i.setInactiveStyles()),this._selectionModel.clear(),this.multiple&&e)Array.isArray(e),e.forEach(i=>this._selectOptionByValue(i)),this._sortValues();else{const i=this._selectOptionByValue(e);i?this._keyManager.updateActiveItem(i):this.panelOpen||this._keyManager.updateActiveItem(-1)}this._changeDetectorRef.markForCheck()}_selectOptionByValue(e){const i=this.options.find(r=>{if(this._selectionModel.isSelected(r))return!1;try{return(null!=r.value||this.canSelectNullableOptions)&&this._compareWith(r.value,e)}catch{return!1}});return i&&this._selectionModel.select(i),i}_assignValue(e){return!!(e!==this._value||this._multiple&&Array.isArray(e))&&(this.options&&this._setSelectionByValue(e),this._value=e,!0)}_skipPredicate=e=>!this.panelOpen&&e.disabled;_getOverlayWidth(e){return"auto"===this.panelWidth?(e instanceof nT?e.elementRef:e||this._elementRef).nativeElement.getBoundingClientRect().width:null===this.panelWidth?"":this.panelWidth}_syncParentProperties(){if(this.options)for(const e of this.options)e._changeDetectorRef.markForCheck()}_initKeyManager(){this._keyManager=new uie(this.options).withTypeAhead(this.typeaheadDebounceInterval).withVerticalOrientation().withHorizontalOrientation(this._isRtl()?"rtl":"ltr").withHomeAndEnd().withPageUpDown().withAllowedModifierKeys(["shiftKey"]).skipPredicate(this._skipPredicate),this._keyManager.tabOut.subscribe(()=>{this.panelOpen&&(!this.multiple&&this._keyManager.activeItem&&this._keyManager.activeItem._selectViaInteraction(),this.focus(),this.close())}),this._keyManager.change.subscribe(()=>{this._panelOpen&&this.panel?this._scrollOptionIntoView(this._keyManager.activeItemIndex||0):!this._panelOpen&&!this.multiple&&this._keyManager.activeItem&&this._keyManager.activeItem._selectViaInteraction()})}_resetOptions(){const e=zc(this.options.changes,this._destroy);this.optionSelectionChanges.pipe(jr(e)).subscribe(i=>{this._onSelect(i.source,i.isUserInput),i.isUserInput&&!this.multiple&&this._panelOpen&&(this.close(),this.focus())}),zc(...this.options.map(i=>i._stateChanges)).pipe(jr(e)).subscribe(()=>{this._changeDetectorRef.detectChanges(),this.stateChanges.next()})}_onSelect(e,i){const r=this._selectionModel.isSelected(e);this.canSelectNullableOptions||null!=e.value||this._multiple?(r!==e.selected&&(e.selected?this._selectionModel.select(e):this._selectionModel.deselect(e)),i&&this._keyManager.setActiveItem(e),this.multiple&&(this._sortValues(),i&&this.focus())):(e.deselect(),this._selectionModel.clear(),null!=this.value&&this._propagateChanges(e.value)),r!==this._selectionModel.isSelected(e)&&this._propagateChanges(),this.stateChanges.next()}_sortValues(){if(this.multiple){const e=this.options.toArray();this._selectionModel.sort((i,r)=>this.sortComparator?this.sortComparator(i,r,e):e.indexOf(i)-e.indexOf(r)),this.stateChanges.next()}}_propagateChanges(e){let i;i=this.multiple?this.selected.map(r=>r.value):this.selected?this.selected.value:e,this._value=i,this.valueChange.emit(i),this._onChange(i),this.selectionChange.emit(this._getChangeEvent(i)),this._changeDetectorRef.markForCheck()}_highlightCorrectOption(){if(this._keyManager)if(this.empty){let e=-1;for(let i=0;i<this.options.length;i++)if(!this.options.get(i).disabled){e=i;break}this._keyManager.setActiveItem(e)}else this._keyManager.setActiveItem(this._selectionModel.selected[0])}_canOpen(){return!this._panelOpen&&!this.disabled&&this.options?.length>0&&!!this._overlayDir}focus(e){this._elementRef.nativeElement.focus(e)}_getPanelAriaLabelledby(){if(this.ariaLabel)return null;const e=this._parentFormField?.getLabelId()||null;return this.ariaLabelledby?(e?e+" ":"")+this.ariaLabelledby:e}_getAriaActiveDescendant(){return this.panelOpen&&this._keyManager&&this._keyManager.activeItem?this._keyManager.activeItem.id:null}_getTriggerAriaLabelledby(){if(this.ariaLabel)return null;let e=this._parentFormField?.getLabelId()||"";return this.ariaLabelledby&&(e+=" "+this.ariaLabelledby),e||(e=this._valueId),e}setDescribedByIds(e){e.length?this._elementRef.nativeElement.setAttribute("aria-describedby",e.join(" ")):this._elementRef.nativeElement.removeAttribute("aria-describedby")}onContainerClick(){this.focus(),this.open()}get shouldLabelFloat(){return this.panelOpen||!this.empty||this.focused&&!!this.placeholder}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=kn({type:t,selectors:[["mat-select"]],contentQueries:function(i,r,l){if(1&i&&(ro(l,Lie,5),ro(l,oE,5),ro(l,X5,5)),2&i){let f;Zn(f=Xn())&&(r.customTrigger=f.first),Zn(f=Xn())&&(r.options=f),Zn(f=Xn())&&(r.optionGroups=f)}},viewQuery:function(i,r){if(1&i&&(kr(Eie,5),kr(Sie,5),kr(DV,5)),2&i){let l;Zn(l=Xn())&&(r.trigger=l.first),Zn(l=Xn())&&(r.panel=l.first),Zn(l=Xn())&&(r._overlayDir=l.first)}},hostAttrs:["role","combobox","aria-haspopup","listbox",1,"mat-mdc-select"],hostVars:19,hostBindings:function(i,r){1&i&&Tt("keydown",function(f){return r._handleKeydown(f)})("focus",function(){return r._onFocus()})("blur",function(){return r._onBlur()}),2&i&&(ii("id",r.id)("tabindex",r.disabled?-1:r.tabIndex)("aria-controls",r.panelOpen?r.id+"-panel":null)("aria-expanded",r.panelOpen)("aria-label",r.ariaLabel||null)("aria-required",r.required.toString())("aria-disabled",r.disabled.toString())("aria-invalid",r.errorState)("aria-activedescendant",r._getAriaActiveDescendant()),Di("mat-mdc-select-disabled",r.disabled)("mat-mdc-select-invalid",r.errorState)("mat-mdc-select-required",r.required)("mat-mdc-select-empty",r.empty)("mat-mdc-select-multiple",r.multiple))},inputs:{userAriaDescribedBy:[0,"aria-describedby","userAriaDescribedBy"],panelClass:"panelClass",disabled:[2,"disabled","disabled",Un],disableRipple:[2,"disableRipple","disableRipple",Un],tabIndex:[2,"tabIndex","tabIndex",e=>null==e?0:bu(e)],hideSingleSelectionIndicator:[2,"hideSingleSelectionIndicator","hideSingleSelectionIndicator",Un],placeholder:"placeholder",required:[2,"required","required",Un],multiple:[2,"multiple","multiple",Un],disableOptionCentering:[2,"disableOptionCentering","disableOptionCentering",Un],compareWith:"compareWith",value:"value",ariaLabel:[0,"aria-label","ariaLabel"],ariaLabelledby:[0,"aria-labelledby","ariaLabelledby"],errorStateMatcher:"errorStateMatcher",typeaheadDebounceInterval:[2,"typeaheadDebounceInterval","typeaheadDebounceInterval",bu],sortComparator:"sortComparator",id:"id",panelWidth:"panelWidth",canSelectNullableOptions:[2,"canSelectNullableOptions","canSelectNullableOptions",Un]},outputs:{openedChange:"openedChange",_openedStream:"opened",_closedStream:"closed",selectionChange:"selectionChange",valueChange:"valueChange"},exportAs:["matSelect"],features:[pi([{provide:BT,useExisting:t},{provide:Z5,useExisting:t}]),Mr],ngContentSelectors:Mie,decls:11,vars:9,consts:[["fallbackOverlayOrigin","cdkOverlayOrigin","trigger",""],["panel",""],["cdk-overlay-origin","",1,"mat-mdc-select-trigger",3,"click"],[1,"mat-mdc-select-value"],[1,"mat-mdc-select-placeholder","mat-mdc-select-min-line"],[1,"mat-mdc-select-value-text"],[1,"mat-mdc-select-arrow-wrapper"],[1,"mat-mdc-select-arrow"],["viewBox","0 0 24 24","width","24px","height","24px","focusable","false","aria-hidden","true"],["d","M7 10l5 5 5-5z"],["cdk-connected-overlay","","cdkConnectedOverlayLockPosition","","cdkConnectedOverlayHasBackdrop","","cdkConnectedOverlayBackdropClass","cdk-overlay-transparent-backdrop",3,"detach","backdropClick","overlayKeydown","cdkConnectedOverlayDisableClose","cdkConnectedOverlayPanelClass","cdkConnectedOverlayScrollStrategy","cdkConnectedOverlayOrigin","cdkConnectedOverlayPositions","cdkConnectedOverlayWidth","cdkConnectedOverlayFlexibleDimensions"],[1,"mat-mdc-select-min-line"],["role","listbox","tabindex","-1",3,"keydown","ngClass"]],template:function(i,r){if(1&i){const l=_i();os(Die),ae(0,"div",2,0),Tt("click",function(){return on(l),ln(r.open())}),ae(3,"div",3),vt(4,Tie,2,1,"span",4)(5,kie,3,1,"span",5),le(),ae(6,"div",6)(7,"div",7),ba(),ae(8,"svg",8),Wt(9,"path",9),le()()()(),vt(10,Rie,3,10,"ng-template",10),Tt("detach",function(){return on(l),ln(r.close())})("backdropClick",function(){return on(l),ln(r.close())})("overlayKeydown",function(w){return on(l),ln(r._handleOverlayKeydown(w))})}if(2&i){const l=Ed(1);xe(3),ii("id",r._valueId),xe(),qi(r.empty?4:5),xe(6),Xe("cdkConnectedOverlayDisableClose",!0)("cdkConnectedOverlayPanelClass",r._overlayPanelClass)("cdkConnectedOverlayScrollStrategy",r._scrollStrategy)("cdkConnectedOverlayOrigin",r._preferredOverlayOrigin||l)("cdkConnectedOverlayPositions",r._positions)("cdkConnectedOverlayWidth",r._overlayWidth)("cdkConnectedOverlayFlexibleDimensions",!0)}},dependencies:[nT,DV,im],styles:['@keyframes _mat-select-enter{from{opacity:0;transform:scaleY(0.8)}to{opacity:1;transform:none}}@keyframes _mat-select-exit{from{opacity:1}to{opacity:0}}.mat-mdc-select{display:inline-block;width:100%;outline:none;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;color:var(--mat-select-enabled-trigger-text-color, var(--mat-sys-on-surface));font-family:var(--mat-select-trigger-text-font, var(--mat-sys-body-large-font));line-height:var(--mat-select-trigger-text-line-height, var(--mat-sys-body-large-line-height));font-size:var(--mat-select-trigger-text-size, var(--mat-sys-body-large-size));font-weight:var(--mat-select-trigger-text-weight, var(--mat-sys-body-large-weight));letter-spacing:var(--mat-select-trigger-text-tracking, var(--mat-sys-body-large-tracking))}div.mat-mdc-select-panel{box-shadow:var(--mat-select-container-elevation-shadow, 0px 3px 1px -2px rgba(0, 0, 0, 0.2), 0px 2px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12))}.mat-mdc-select-disabled{color:var(--mat-select-disabled-trigger-text-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent))}.mat-mdc-select-disabled .mat-mdc-select-placeholder{color:var(--mat-select-disabled-trigger-text-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent))}.mat-mdc-select-trigger{display:inline-flex;align-items:center;cursor:pointer;position:relative;box-sizing:border-box;width:100%}.mat-mdc-select-disabled .mat-mdc-select-trigger{-webkit-user-select:none;user-select:none;cursor:default}.mat-mdc-select-value{width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.mat-mdc-select-value-text{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.mat-mdc-select-arrow-wrapper{height:24px;flex-shrink:0;display:inline-flex;align-items:center}.mat-form-field-appearance-fill .mdc-text-field--no-label .mat-mdc-select-arrow-wrapper{transform:none}.mat-mdc-form-field .mat-mdc-select.mat-mdc-select-invalid .mat-mdc-select-arrow,.mat-form-field-invalid:not(.mat-form-field-disabled) .mat-mdc-form-field-infix::after{color:var(--mat-select-invalid-arrow-color, var(--mat-sys-error))}.mat-mdc-select-arrow{width:10px;height:5px;position:relative;color:var(--mat-select-enabled-arrow-color, var(--mat-sys-on-surface-variant))}.mat-mdc-form-field.mat-focused .mat-mdc-select-arrow{color:var(--mat-select-focused-arrow-color, var(--mat-sys-primary))}.mat-mdc-form-field .mat-mdc-select.mat-mdc-select-disabled .mat-mdc-select-arrow{color:var(--mat-select-disabled-arrow-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent))}.mat-mdc-select-arrow svg{fill:currentColor;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%)}@media(forced-colors: active){.mat-mdc-select-arrow svg{fill:CanvasText}.mat-mdc-select-disabled .mat-mdc-select-arrow svg{fill:GrayText}}div.mat-mdc-select-panel{width:100%;max-height:275px;outline:0;overflow:auto;padding:8px 0;border-radius:4px;box-sizing:border-box;position:static;background-color:var(--mat-select-panel-background-color, var(--mat-sys-surface-container))}@media(forced-colors: active){div.mat-mdc-select-panel{outline:solid 1px}}.cdk-overlay-pane:not(.mat-mdc-select-panel-above) div.mat-mdc-select-panel{border-top-left-radius:0;border-top-right-radius:0;transform-origin:top center}.mat-mdc-select-panel-above div.mat-mdc-select-panel{border-bottom-left-radius:0;border-bottom-right-radius:0;transform-origin:bottom center}div.mat-mdc-select-panel .mat-mdc-option{--mdc-list-list-item-container-color: var(--mat-select-panel-background-color)}.mat-select-panel-animations-enabled{animation:_mat-select-enter 120ms cubic-bezier(0, 0, 0.2, 1)}.mat-select-panel-animations-enabled.mat-select-panel-exit{animation:_mat-select-exit 100ms linear}.mat-mdc-select-placeholder{transition:color 400ms 133.3333333333ms cubic-bezier(0.25, 0.8, 0.25, 1);color:var(--mat-select-placeholder-text-color, var(--mat-sys-on-surface-variant))}.mat-mdc-form-field:not(.mat-form-field-animations-enabled) .mat-mdc-select-placeholder,._mat-animation-noopable .mat-mdc-select-placeholder{transition:none}.mat-form-field-hide-placeholder .mat-mdc-select-placeholder{color:rgba(0,0,0,0);-webkit-text-fill-color:rgba(0,0,0,0);transition:none;display:block}.mat-mdc-form-field-type-mat-select:not(.mat-form-field-disabled) .mat-mdc-text-field-wrapper{cursor:pointer}.mat-mdc-form-field-type-mat-select.mat-form-field-appearance-fill .mat-mdc-floating-label{max-width:calc(100% - 18px)}.mat-mdc-form-field-type-mat-select.mat-form-field-appearance-fill .mdc-floating-label--float-above{max-width:calc(100%/0.75 - 24px)}.mat-mdc-form-field-type-mat-select.mat-form-field-appearance-outline .mdc-notched-outline__notch{max-width:calc(100% - 60px)}.mat-mdc-form-field-type-mat-select.mat-form-field-appearance-outline .mdc-text-field--label-floating .mdc-notched-outline__notch{max-width:calc(100% - 24px)}.mat-mdc-select-min-line:empty::before{content:" ";white-space:pre;width:1px;display:inline-block;visibility:hidden}.mat-form-field-appearance-fill .mat-mdc-select-arrow-wrapper{transform:var(--mat-select-arrow-transform, translateY(-8px))}\n'],encapsulation:2,changeDetection:0})}return t})(),sE=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275mod=Er({type:t});static \u0275inj=Ai({providers:[Fie],imports:[LC,K5,Qr,RC,Wg,K5,Qr]})}return t})();const zie=["tooltip"],eU=new _t("mat-tooltip-scroll-strategy",{providedIn:"root",factory:()=>{const t=te(oa);return()=>t.scrollStrategies.reposition({scrollThrottle:20})}}),Vie={provide:eU,deps:[oa],useFactory:function Bie(t){return()=>t.scrollStrategies.reposition({scrollThrottle:20})}},jie=new _t("mat-tooltip-default-options",{providedIn:"root",factory:function Uie(){return{showDelay:0,hideDelay:0,touchendHideDelay:1500}}}),tU="tooltip-panel",nU=iT({passive:!0});let Wie=(()=>{class t{_elementRef=te(Dn);_ngZone=te(wt);_platform=te(xs);_ariaDescriber=te(lie);_focusMonitor=te(j0);_dir=te(Bc);_injector=te(we);_viewContainerRef=te(io);_defaultOptions=te(jie,{optional:!0});_overlayRef;_tooltipInstance;_portal;_position="below";_positionAtOrigin=!1;_disabled=!1;_tooltipClass;_viewInitialized=!1;_pointerExitEventsInitialized=!1;_tooltipComponent=Yie;_viewportMargin=8;_currentPosition;_cssClassPrefix="mat-mdc";_ariaDescriptionPending;_dirSubscribed=!1;get position(){return this._position}set position(e){e!==this._position&&(this._position=e,this._overlayRef&&(this._updatePosition(this._overlayRef),this._tooltipInstance?.show(0),this._overlayRef.updatePosition()))}get positionAtOrigin(){return this._positionAtOrigin}set positionAtOrigin(e){this._positionAtOrigin=qg(e),this._detach(),this._overlayRef=null}get disabled(){return this._disabled}set disabled(e){const i=qg(e);this._disabled!==i&&(this._disabled=i,i?this.hide(0):this._setupPointerEnterEventsIfNeeded(),this._syncAriaDescription(this.message))}get showDelay(){return this._showDelay}set showDelay(e){this._showDelay=KM(e)}_showDelay;get hideDelay(){return this._hideDelay}set hideDelay(e){this._hideDelay=KM(e),this._tooltipInstance&&(this._tooltipInstance._mouseLeaveHideDelay=this._hideDelay)}_hideDelay;touchGestures="auto";get message(){return this._message}set message(e){const i=this._message;this._message=null!=e?String(e).trim():"",!this._message&&this._isTooltipVisible()?this.hide(0):(this._setupPointerEnterEventsIfNeeded(),this._updateTooltipMessage()),this._syncAriaDescription(i)}_message="";get tooltipClass(){return this._tooltipClass}set tooltipClass(e){this._tooltipClass=e,this._tooltipInstance&&this._setTooltipClass(this._tooltipClass)}_passiveListeners=[];_touchstartTimeout=null;_destroyed=new Et;_isDestroyed=!1;constructor(){const e=this._defaultOptions;e&&(this._showDelay=e.showDelay,this._hideDelay=e.hideDelay,e.position&&(this.position=e.position),e.positionAtOrigin&&(this.positionAtOrigin=e.positionAtOrigin),e.touchGestures&&(this.touchGestures=e.touchGestures),e.tooltipClass&&(this.tooltipClass=e.tooltipClass)),this._viewportMargin=8}ngAfterViewInit(){this._viewInitialized=!0,this._setupPointerEnterEventsIfNeeded(),this._focusMonitor.monitor(this._elementRef).pipe(jr(this._destroyed)).subscribe(e=>{e?"keyboard"===e&&this._ngZone.run(()=>this.show()):this._ngZone.run(()=>this.hide(0))})}ngOnDestroy(){const e=this._elementRef.nativeElement;this._touchstartTimeout&&clearTimeout(this._touchstartTimeout),this._overlayRef&&(this._overlayRef.dispose(),this._tooltipInstance=null),this._passiveListeners.forEach(([i,r])=>{e.removeEventListener(i,r,nU)}),this._passiveListeners.length=0,this._destroyed.next(),this._destroyed.complete(),this._isDestroyed=!0,this._ariaDescriber.removeDescription(e,this.message,"tooltip"),this._focusMonitor.stopMonitoring(e)}show(e=this.showDelay,i){if(this.disabled||!this.message||this._isTooltipVisible())return void this._tooltipInstance?._cancelPendingAnimations();const r=this._createOverlay(i);this._detach(),this._portal=this._portal||new zg(this._tooltipComponent,this._viewContainerRef);const l=this._tooltipInstance=r.attach(this._portal).instance;l._triggerElement=this._elementRef.nativeElement,l._mouseLeaveHideDelay=this._hideDelay,l.afterHidden().pipe(jr(this._destroyed)).subscribe(()=>this._detach()),this._setTooltipClass(this._tooltipClass),this._updateTooltipMessage(),l.show(e)}hide(e=this.hideDelay){const i=this._tooltipInstance;i&&(i.isVisible()?i.hide(e):(i._cancelPendingAnimations(),this._detach()))}toggle(e){this._isTooltipVisible()?this.hide():this.show(void 0,e)}_isTooltipVisible(){return!!this._tooltipInstance&&this._tooltipInstance.isVisible()}_createOverlay(e){if(this._overlayRef){const f=this._overlayRef.getConfig().positionStrategy;if((!this.positionAtOrigin||!e)&&f._origin instanceof Dn)return this._overlayRef;this._detach()}const i=this._injector.get(sR).getAncestorScrollContainers(this._elementRef),r=this._injector.get(oa),l=r.position().flexibleConnectedTo(this.positionAtOrigin&&e||this._elementRef).withTransformOriginOn(`.${this._cssClassPrefix}-tooltip`).withFlexibleDimensions(!1).withViewportMargin(this._viewportMargin).withScrollableContainers(i);return l.positionChanges.pipe(jr(this._destroyed)).subscribe(f=>{this._updateCurrentPositionClass(f.connectionPair),this._tooltipInstance&&f.scrollableViewProperties.isOverlayClipped&&this._tooltipInstance.isVisible()&&this._ngZone.run(()=>this.hide(0))}),this._overlayRef=r.create({direction:this._dir,positionStrategy:l,panelClass:`${this._cssClassPrefix}-${tU}`,scrollStrategy:this._injector.get(eU)()}),this._updatePosition(this._overlayRef),this._overlayRef.detachments().pipe(jr(this._destroyed)).subscribe(()=>this._detach()),this._overlayRef.outsidePointerEvents().pipe(jr(this._destroyed)).subscribe(()=>this._tooltipInstance?._handleBodyInteraction()),this._overlayRef.keydownEvents().pipe(jr(this._destroyed)).subscribe(f=>{this._isTooltipVisible()&&27===f.keyCode&&!Ja(f)&&(f.preventDefault(),f.stopPropagation(),this._ngZone.run(()=>this.hide(0)))}),this._defaultOptions?.disableTooltipInteractivity&&this._overlayRef.addPanelClass(`${this._cssClassPrefix}-tooltip-panel-non-interactive`),this._dirSubscribed||(this._dirSubscribed=!0,this._dir.change.pipe(jr(this._destroyed)).subscribe(()=>{this._overlayRef&&this._updatePosition(this._overlayRef)})),this._overlayRef}_detach(){this._overlayRef&&this._overlayRef.hasAttached()&&this._overlayRef.detach(),this._tooltipInstance=null}_updatePosition(e){const i=e.getConfig().positionStrategy,r=this._getOrigin(),l=this._getOverlayPosition();i.withPositions([this._addOffset({...r.main,...l.main}),this._addOffset({...r.fallback,...l.fallback})])}_addOffset(e){const r=!this._dir||"ltr"==this._dir.value;return"top"===e.originY?e.offsetY=-8:"bottom"===e.originY?e.offsetY=8:"start"===e.originX?e.offsetX=r?-8:8:"end"===e.originX&&(e.offsetX=r?8:-8),e}_getOrigin(){const e=!this._dir||"ltr"==this._dir.value,i=this.position;let r;"above"==i||"below"==i?r={originX:"center",originY:"above"==i?"top":"bottom"}:"before"==i||"left"==i&&e||"right"==i&&!e?r={originX:"start",originY:"center"}:("after"==i||"right"==i&&e||"left"==i&&!e)&&(r={originX:"end",originY:"center"});const{x:l,y:f}=this._invertPosition(r.originX,r.originY);return{main:r,fallback:{originX:l,originY:f}}}_getOverlayPosition(){const e=!this._dir||"ltr"==this._dir.value,i=this.position;let r;"above"==i?r={overlayX:"center",overlayY:"bottom"}:"below"==i?r={overlayX:"center",overlayY:"top"}:"before"==i||"left"==i&&e||"right"==i&&!e?r={overlayX:"end",overlayY:"center"}:("after"==i||"right"==i&&e||"left"==i&&!e)&&(r={overlayX:"start",overlayY:"center"});const{x:l,y:f}=this._invertPosition(r.overlayX,r.overlayY);return{main:r,fallback:{overlayX:l,overlayY:f}}}_updateTooltipMessage(){this._tooltipInstance&&(this._tooltipInstance.message=this.message,this._tooltipInstance._markForCheck(),El(()=>{this._tooltipInstance&&this._overlayRef.updatePosition()},{injector:this._injector}))}_setTooltipClass(e){this._tooltipInstance&&(this._tooltipInstance.tooltipClass=e,this._tooltipInstance._markForCheck())}_invertPosition(e,i){return"above"===this.position||"below"===this.position?"top"===i?i="bottom":"bottom"===i&&(i="top"):"end"===e?e="start":"start"===e&&(e="end"),{x:e,y:i}}_updateCurrentPositionClass(e){const{overlayY:i,originX:r,originY:l}=e;let f;if(f="center"===i?this._dir&&"rtl"===this._dir.value?"end"===r?"left":"right":"start"===r?"left":"right":"bottom"===i&&"top"===l?"above":"below",f!==this._currentPosition){const w=this._overlayRef;if(w){const M=`${this._cssClassPrefix}-${tU}-`;w.removePanelClass(M+this._currentPosition),w.addPanelClass(M+f)}this._currentPosition=f}}_setupPointerEnterEventsIfNeeded(){this._disabled||!this.message||!this._viewInitialized||this._passiveListeners.length||(this._platformSupportsMouseEvents()?this._passiveListeners.push(["mouseenter",e=>{let i;this._setupPointerExitEventsIfNeeded(),void 0!==e.x&&void 0!==e.y&&(i=e),this.show(void 0,i)}]):"off"!==this.touchGestures&&(this._disableNativeGesturesIfNecessary(),this._passiveListeners.push(["touchstart",e=>{const i=e.targetTouches?.[0],r=i?{x:i.clientX,y:i.clientY}:void 0;this._setupPointerExitEventsIfNeeded(),this._touchstartTimeout&&clearTimeout(this._touchstartTimeout),this._touchstartTimeout=setTimeout(()=>{this._touchstartTimeout=null,this.show(void 0,r)},this._defaultOptions?.touchLongPressShowDelay??500)}])),this._addListeners(this._passiveListeners))}_setupPointerExitEventsIfNeeded(){if(this._pointerExitEventsInitialized)return;this._pointerExitEventsInitialized=!0;const e=[];if(this._platformSupportsMouseEvents())e.push(["mouseleave",i=>{const r=i.relatedTarget;(!r||!this._overlayRef?.overlayElement.contains(r))&&this.hide()}],["wheel",i=>this._wheelListener(i)]);else if("off"!==this.touchGestures){this._disableNativeGesturesIfNecessary();const i=()=>{this._touchstartTimeout&&clearTimeout(this._touchstartTimeout),this.hide(this._defaultOptions?.touchendHideDelay)};e.push(["touchend",i],["touchcancel",i])}this._addListeners(e),this._passiveListeners.push(...e)}_addListeners(e){e.forEach(([i,r])=>{this._elementRef.nativeElement.addEventListener(i,r,nU)})}_platformSupportsMouseEvents(){return!this._platform.IOS&&!this._platform.ANDROID}_wheelListener(e){if(this._isTooltipVisible()){const i=this._injector.get(mr).elementFromPoint(e.clientX,e.clientY),r=this._elementRef.nativeElement;i!==r&&!r.contains(i)&&this.hide()}}_disableNativeGesturesIfNecessary(){const e=this.touchGestures;if("off"!==e){const i=this._elementRef.nativeElement,r=i.style;("on"===e||"INPUT"!==i.nodeName&&"TEXTAREA"!==i.nodeName)&&(r.userSelect=r.msUserSelect=r.webkitUserSelect=r.MozUserSelect="none"),("on"===e||!i.draggable)&&(r.webkitUserDrag="none"),r.touchAction="none",r.webkitTapHighlightColor="transparent"}}_syncAriaDescription(e){this._ariaDescriptionPending||(this._ariaDescriptionPending=!0,this._ariaDescriber.removeDescription(this._elementRef.nativeElement,e,"tooltip"),this._isDestroyed||El({write:()=>{this._ariaDescriptionPending=!1,this.message&&!this.disabled&&this._ariaDescriber.describe(this._elementRef.nativeElement,this.message,"tooltip")}},{injector:this._injector}))}static \u0275fac=function(i){return new(i||t)};static \u0275dir=Ht({type:t,selectors:[["","matTooltip",""]],hostAttrs:[1,"mat-mdc-tooltip-trigger"],hostVars:2,hostBindings:function(i,r){2&i&&Di("mat-mdc-tooltip-disabled",r.disabled)},inputs:{position:[0,"matTooltipPosition","position"],positionAtOrigin:[0,"matTooltipPositionAtOrigin","positionAtOrigin"],disabled:[0,"matTooltipDisabled","disabled"],showDelay:[0,"matTooltipShowDelay","showDelay"],hideDelay:[0,"matTooltipHideDelay","hideDelay"],touchGestures:[0,"matTooltipTouchGestures","touchGestures"],message:[0,"matTooltip","message"],tooltipClass:[0,"matTooltipClass","tooltipClass"]},exportAs:["matTooltip"]})}return t})(),Yie=(()=>{class t{_changeDetectorRef=te(Do);_elementRef=te(Dn);_isMultiline=!1;message;tooltipClass;_showTimeoutId;_hideTimeoutId;_triggerElement;_mouseLeaveHideDelay;_animationsDisabled;_tooltip;_closeOnInteraction=!1;_isVisible=!1;_onHide=new Et;_showAnimation="mat-mdc-tooltip-show";_hideAnimation="mat-mdc-tooltip-hide";constructor(){const e=te(wa,{optional:!0});this._animationsDisabled="NoopAnimations"===e}show(e){null!=this._hideTimeoutId&&clearTimeout(this._hideTimeoutId),this._showTimeoutId=setTimeout(()=>{this._toggleVisibility(!0),this._showTimeoutId=void 0},e)}hide(e){null!=this._showTimeoutId&&clearTimeout(this._showTimeoutId),this._hideTimeoutId=setTimeout(()=>{this._toggleVisibility(!1),this._hideTimeoutId=void 0},e)}afterHidden(){return this._onHide}isVisible(){return this._isVisible}ngOnDestroy(){this._cancelPendingAnimations(),this._onHide.complete(),this._triggerElement=null}_handleBodyInteraction(){this._closeOnInteraction&&this.hide(0)}_markForCheck(){this._changeDetectorRef.markForCheck()}_handleMouseLeave({relatedTarget:e}){(!e||!this._triggerElement.contains(e))&&(this.isVisible()?this.hide(this._mouseLeaveHideDelay):this._finalizeAnimation(!1))}_onShow(){this._isMultiline=this._isTooltipMultiline(),this._markForCheck()}_isTooltipMultiline(){const e=this._elementRef.nativeElement.getBoundingClientRect();return e.height>24&&e.width>=200}_handleAnimationEnd({animationName:e}){(e===this._showAnimation||e===this._hideAnimation)&&this._finalizeAnimation(e===this._showAnimation)}_cancelPendingAnimations(){null!=this._showTimeoutId&&clearTimeout(this._showTimeoutId),null!=this._hideTimeoutId&&clearTimeout(this._hideTimeoutId),this._showTimeoutId=this._hideTimeoutId=void 0}_finalizeAnimation(e){e?this._closeOnInteraction=!0:this.isVisible()||this._onHide.next()}_toggleVisibility(e){const i=this._tooltip.nativeElement,r=this._showAnimation,l=this._hideAnimation;if(i.classList.remove(e?l:r),i.classList.add(e?r:l),this._isVisible!==e&&(this._isVisible=e,this._changeDetectorRef.markForCheck()),e&&!this._animationsDisabled&&"function"==typeof getComputedStyle){const f=getComputedStyle(i);("0s"===f.getPropertyValue("animation-duration")||"none"===f.getPropertyValue("animation-name"))&&(this._animationsDisabled=!0)}e&&this._onShow(),this._animationsDisabled&&(i.classList.add("_mat-animation-noopable"),this._finalizeAnimation(e))}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=kn({type:t,selectors:[["mat-tooltip-component"]],viewQuery:function(i,r){if(1&i&&kr(zie,7),2&i){let l;Zn(l=Xn())&&(r._tooltip=l.first)}},hostAttrs:["aria-hidden","true"],hostBindings:function(i,r){1&i&&Tt("mouseleave",function(f){return r._handleMouseLeave(f)})},decls:4,vars:4,consts:[["tooltip",""],[1,"mdc-tooltip","mat-mdc-tooltip",3,"animationend","ngClass"],[1,"mat-mdc-tooltip-surface","mdc-tooltip__surface"]],template:function(i,r){if(1&i){const l=_i();ae(0,"div",1,0),Tt("animationend",function(w){return on(l),ln(r._handleAnimationEnd(w))}),ae(2,"div",2),Re(3),le()()}2&i&&(Di("mdc-tooltip--multiline",r._isMultiline),Xe("ngClass",r.tooltipClass),xe(3),er(r.message))},dependencies:[im],styles:['.mat-mdc-tooltip{position:relative;transform:scale(0);display:inline-flex}.mat-mdc-tooltip::before{content:"";top:0;right:0;bottom:0;left:0;z-index:-1;position:absolute}.mat-mdc-tooltip-panel-below .mat-mdc-tooltip::before{top:-8px}.mat-mdc-tooltip-panel-above .mat-mdc-tooltip::before{bottom:-8px}.mat-mdc-tooltip-panel-right .mat-mdc-tooltip::before{left:-8px}.mat-mdc-tooltip-panel-left .mat-mdc-tooltip::before{right:-8px}.mat-mdc-tooltip._mat-animation-noopable{animation:none;transform:scale(1)}.mat-mdc-tooltip-surface{word-break:normal;overflow-wrap:anywhere;padding:4px 8px;min-width:40px;max-width:200px;min-height:24px;max-height:40vh;box-sizing:border-box;overflow:hidden;text-align:center;will-change:transform,opacity;background-color:var(--mdc-plain-tooltip-container-color, var(--mat-sys-inverse-surface));color:var(--mdc-plain-tooltip-supporting-text-color, var(--mat-sys-inverse-on-surface));border-radius:var(--mdc-plain-tooltip-container-shape, var(--mat-sys-corner-extra-small));font-family:var(--mdc-plain-tooltip-supporting-text-font, var(--mat-sys-body-small-font));font-size:var(--mdc-plain-tooltip-supporting-text-size, var(--mat-sys-body-small-size));font-weight:var(--mdc-plain-tooltip-supporting-text-weight, var(--mat-sys-body-small-weight));line-height:var(--mdc-plain-tooltip-supporting-text-line-height, var(--mat-sys-body-small-line-height));letter-spacing:var(--mdc-plain-tooltip-supporting-text-tracking, var(--mat-sys-body-small-tracking))}.mat-mdc-tooltip-surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:1px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}.mdc-tooltip--multiline .mat-mdc-tooltip-surface{text-align:left}[dir=rtl] .mdc-tooltip--multiline .mat-mdc-tooltip-surface{text-align:right}.mat-mdc-tooltip-panel{line-height:normal}.mat-mdc-tooltip-panel.mat-mdc-tooltip-panel-non-interactive{pointer-events:none}@keyframes mat-mdc-tooltip-show{0%{opacity:0;transform:scale(0.8)}100%{opacity:1;transform:scale(1)}}@keyframes mat-mdc-tooltip-hide{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(0.8)}}.mat-mdc-tooltip-show{animation:mat-mdc-tooltip-show 150ms cubic-bezier(0, 0, 0.2, 1) forwards}.mat-mdc-tooltip-hide{animation:mat-mdc-tooltip-hide 75ms cubic-bezier(0.4, 0, 1, 1) forwards}\n'],encapsulation:2,changeDetection:0})}return t})(),Zie=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275mod=Er({type:t});static \u0275inj=Ai({providers:[Vie],imports:[iR,LC,Qr,Qr,RC]})}return t})();function Xie(t,n){if(1&t&&(ae(0,"mat-option",17),Re(1),le()),2&t){const e=n.$implicit;Xe("value",e),xe(),Ci(" ",e," ")}}function Kie(t,n){if(1&t){const e=_i();ae(0,"mat-form-field",14)(1,"mat-select",16,0),Tt("selectionChange",function(r){return on(e),ln(Lt(2)._changePageSize(r.value))}),N1(3,Xie,2,2,"mat-option",17,WF),le(),ae(5,"div",18),Tt("click",function(){return on(e),ln(Ed(2).open())}),le()()}if(2&t){const e=Lt(2);Xe("appearance",e._formFieldAppearance)("color",e.color),xe(),Xe("value",e.pageSize)("disabled",e.disabled)("aria-labelledby",e._pageSizeLabelId)("panelClass",e.selectConfig.panelClass||"")("disableOptionCentering",e.selectConfig.disableOptionCentering),xe(2),z1(e._displayedPageSizeOptions)}}function Qie(t,n){if(1&t&&(ae(0,"div",15),Re(1),le()),2&t){const e=Lt(2);xe(),er(e.pageSize)}}function Jie(t,n){if(1&t&&(ae(0,"div",3)(1,"div",13),Re(2),le(),vt(3,Kie,6,7,"mat-form-field",14)(4,Qie,2,1,"div",15),le()),2&t){const e=Lt();xe(),ii("id",e._pageSizeLabelId),xe(),Ci(" ",e._intl.itemsPerPageLabel," "),xe(),qi(e._displayedPageSizeOptions.length>1?3:-1),xe(),qi(e._displayedPageSizeOptions.length<=1?4:-1)}}function ere(t,n){if(1&t){const e=_i();ae(0,"button",19),Tt("click",function(){on(e);const r=Lt();return ln(r._buttonClicked(0,r._previousButtonsDisabled()))}),ba(),ae(1,"svg",8),Wt(2,"path",20),le()()}if(2&t){const e=Lt();Xe("matTooltip",e._intl.firstPageLabel)("matTooltipDisabled",e._previousButtonsDisabled())("disabled",e._previousButtonsDisabled())("tabindex",e._previousButtonsDisabled()?-1:null),ii("aria-label",e._intl.firstPageLabel)}}function tre(t,n){if(1&t){const e=_i();ae(0,"button",21),Tt("click",function(){on(e);const r=Lt();return ln(r._buttonClicked(r.getNumberOfPages()-1,r._nextButtonsDisabled()))}),ba(),ae(1,"svg",8),Wt(2,"path",22),le()()}if(2&t){const e=Lt();Xe("matTooltip",e._intl.lastPageLabel)("matTooltipDisabled",e._nextButtonsDisabled())("disabled",e._nextButtonsDisabled())("tabindex",e._nextButtonsDisabled()?-1:null),ii("aria-label",e._intl.lastPageLabel)}}let $T=(()=>{class t{changes=new Et;itemsPerPageLabel="Items per page:";nextPageLabel="Next page";previousPageLabel="Previous page";firstPageLabel="First page";lastPageLabel="Last page";getRangeLabel=(e,i,r)=>{if(0==r||0==i)return`0 of ${r}`;const l=e*i;return`${l+1} \u2013 ${l<(r=Math.max(r,0))?Math.min(l+i,r):l+i} of ${r}`};static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();const ire={provide:$T,deps:[[new La,new no,$T]],useFactory:function nre(t){return t||new $T}},ore=new _t("MAT_PAGINATOR_DEFAULT_OPTIONS");let GT=(()=>{class t{_intl=te($T);_changeDetectorRef=te(Do);_formFieldAppearance;_pageSizeLabelId=te(Sa).getId("mat-paginator-page-size-label-");_intlChanges;_isInitialized=!1;_initializedStream=new I5(1);color;get pageIndex(){return this._pageIndex}set pageIndex(e){this._pageIndex=Math.max(e||0,0),this._changeDetectorRef.markForCheck()}_pageIndex=0;get length(){return this._length}set length(e){this._length=e||0,this._changeDetectorRef.markForCheck()}_length=0;get pageSize(){return this._pageSize}set pageSize(e){this._pageSize=Math.max(e||0,0),this._updateDisplayedPageSizeOptions()}_pageSize;get pageSizeOptions(){return this._pageSizeOptions}set pageSizeOptions(e){this._pageSizeOptions=(e||[]).map(i=>bu(i,0)),this._updateDisplayedPageSizeOptions()}_pageSizeOptions=[];hidePageSize=!1;showFirstLastButtons=!1;selectConfig={};disabled=!1;page=new $e;_displayedPageSizeOptions;initialized=this._initializedStream;constructor(){const e=this._intl,i=te(ore,{optional:!0});if(this._intlChanges=e.changes.subscribe(()=>this._changeDetectorRef.markForCheck()),i){const{pageSize:r,pageSizeOptions:l,hidePageSize:f,showFirstLastButtons:w}=i;null!=r&&(this._pageSize=r),null!=l&&(this._pageSizeOptions=l),null!=f&&(this.hidePageSize=f),null!=w&&(this.showFirstLastButtons=w)}this._formFieldAppearance=i?.formFieldAppearance||"outline"}ngOnInit(){this._isInitialized=!0,this._updateDisplayedPageSizeOptions(),this._initializedStream.next()}ngOnDestroy(){this._initializedStream.complete(),this._intlChanges.unsubscribe()}nextPage(){this.hasNextPage()&&this._navigate(this.pageIndex+1)}previousPage(){this.hasPreviousPage()&&this._navigate(this.pageIndex-1)}firstPage(){this.hasPreviousPage()&&this._navigate(0)}lastPage(){this.hasNextPage()&&this._navigate(this.getNumberOfPages()-1)}hasPreviousPage(){return this.pageIndex>=1&&0!=this.pageSize}hasNextPage(){const e=this.getNumberOfPages()-1;return this.pageIndex<e&&0!=this.pageSize}getNumberOfPages(){return this.pageSize?Math.ceil(this.length/this.pageSize):0}_changePageSize(e){const r=this.pageIndex;this.pageIndex=Math.floor(this.pageIndex*this.pageSize/e)||0,this.pageSize=e,this._emitPageEvent(r)}_nextButtonsDisabled(){return this.disabled||!this.hasNextPage()}_previousButtonsDisabled(){return this.disabled||!this.hasPreviousPage()}_updateDisplayedPageSizeOptions(){this._isInitialized&&(this.pageSize||(this._pageSize=0!=this.pageSizeOptions.length?this.pageSizeOptions[0]:50),this._displayedPageSizeOptions=this.pageSizeOptions.slice(),-1===this._displayedPageSizeOptions.indexOf(this.pageSize)&&this._displayedPageSizeOptions.push(this.pageSize),this._displayedPageSizeOptions.sort((e,i)=>e-i),this._changeDetectorRef.markForCheck())}_emitPageEvent(e){this.page.emit({previousPageIndex:e,pageIndex:this.pageIndex,pageSize:this.pageSize,length:this.length})}_navigate(e){const i=this.pageIndex;e!==i&&(this.pageIndex=e,this._emitPageEvent(i))}_buttonClicked(e,i){i||this._navigate(e)}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=kn({type:t,selectors:[["mat-paginator"]],hostAttrs:["role","group",1,"mat-mdc-paginator"],inputs:{color:"color",pageIndex:[2,"pageIndex","pageIndex",bu],length:[2,"length","length",bu],pageSize:[2,"pageSize","pageSize",bu],pageSizeOptions:"pageSizeOptions",hidePageSize:[2,"hidePageSize","hidePageSize",Un],showFirstLastButtons:[2,"showFirstLastButtons","showFirstLastButtons",Un],selectConfig:"selectConfig",disabled:[2,"disabled","disabled",Un]},outputs:{page:"page"},exportAs:["matPaginator"],decls:14,vars:14,consts:[["selectRef",""],[1,"mat-mdc-paginator-outer-container"],[1,"mat-mdc-paginator-container"],[1,"mat-mdc-paginator-page-size"],[1,"mat-mdc-paginator-range-actions"],["aria-live","polite",1,"mat-mdc-paginator-range-label"],["mat-icon-button","","type","button","matTooltipPosition","above","disabledInteractive","",1,"mat-mdc-paginator-navigation-first",3,"matTooltip","matTooltipDisabled","disabled","tabindex"],["mat-icon-button","","type","button","matTooltipPosition","above","disabledInteractive","",1,"mat-mdc-paginator-navigation-previous",3,"click","matTooltip","matTooltipDisabled","disabled","tabindex"],["viewBox","0 0 24 24","focusable","false","aria-hidden","true",1,"mat-mdc-paginator-icon"],["d","M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"],["mat-icon-button","","type","button","matTooltipPosition","above","disabledInteractive","",1,"mat-mdc-paginator-navigation-next",3,"click","matTooltip","matTooltipDisabled","disabled","tabindex"],["d","M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"],["mat-icon-button","","type","button","matTooltipPosition","above","disabledInteractive","",1,"mat-mdc-paginator-navigation-last",3,"matTooltip","matTooltipDisabled","disabled","tabindex"],[1,"mat-mdc-paginator-page-size-label"],[1,"mat-mdc-paginator-page-size-select",3,"appearance","color"],[1,"mat-mdc-paginator-page-size-value"],["hideSingleSelectionIndicator","",3,"selectionChange","value","disabled","aria-labelledby","panelClass","disableOptionCentering"],[3,"value"],[1,"mat-mdc-paginator-touch-target",3,"click"],["mat-icon-button","","type","button","matTooltipPosition","above","disabledInteractive","",1,"mat-mdc-paginator-navigation-first",3,"click","matTooltip","matTooltipDisabled","disabled","tabindex"],["d","M18.41 16.59L13.82 12l4.59-4.59L17 6l-6 6 6 6zM6 6h2v12H6z"],["mat-icon-button","","type","button","matTooltipPosition","above","disabledInteractive","",1,"mat-mdc-paginator-navigation-last",3,"click","matTooltip","matTooltipDisabled","disabled","tabindex"],["d","M5.59 7.41L10.18 12l-4.59 4.59L7 18l6-6-6-6zM16 6h2v12h-2z"]],template:function(i,r){1&i&&(ae(0,"div",1)(1,"div",2),vt(2,Jie,5,4,"div",3),ae(3,"div",4)(4,"div",5),Re(5),le(),vt(6,ere,3,5,"button",6),ae(7,"button",7),Tt("click",function(){return r._buttonClicked(r.pageIndex-1,r._previousButtonsDisabled())}),ba(),ae(8,"svg",8),Wt(9,"path",9),le()(),hr(),ae(10,"button",10),Tt("click",function(){return r._buttonClicked(r.pageIndex+1,r._nextButtonsDisabled())}),ba(),ae(11,"svg",8),Wt(12,"path",11),le()(),vt(13,tre,3,5,"button",12),le()()()),2&i&&(xe(2),qi(r.hidePageSize?-1:2),xe(3),Ci(" ",r._intl.getRangeLabel(r.pageIndex,r.pageSize,r.length)," "),xe(),qi(r.showFirstLastButtons?6:-1),xe(),Xe("matTooltip",r._intl.previousPageLabel)("matTooltipDisabled",r._previousButtonsDisabled())("disabled",r._previousButtonsDisabled())("tabindex",r._previousButtonsDisabled()?-1:null),ii("aria-label",r._intl.previousPageLabel),xe(3),Xe("matTooltip",r._intl.nextPageLabel)("matTooltipDisabled",r._nextButtonsDisabled())("disabled",r._nextButtonsDisabled())("tabindex",r._nextButtonsDisabled()?-1:null),ii("aria-label",r._intl.nextPageLabel),xe(3),qi(r.showFirstLastButtons?13:-1))},dependencies:[tx,HT,oE,Ug,Wie],styles:[".mat-mdc-paginator{display:block;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;color:var(--mat-paginator-container-text-color, var(--mat-sys-on-surface));background-color:var(--mat-paginator-container-background-color, var(--mat-sys-surface));font-family:var(--mat-paginator-container-text-font, var(--mat-sys-body-small-font));line-height:var(--mat-paginator-container-text-line-height, var(--mat-sys-body-small-line-height));font-size:var(--mat-paginator-container-text-size, var(--mat-sys-body-small-size));font-weight:var(--mat-paginator-container-text-weight, var(--mat-sys-body-small-weight));letter-spacing:var(--mat-paginator-container-text-tracking, var(--mat-sys-body-small-tracking));--mat-form-field-container-height:var(--mat-paginator-form-field-container-height, 40px);--mat-form-field-container-vertical-padding:var(--mat-paginator-form-field-container-vertical-padding, 8px)}.mat-mdc-paginator .mat-mdc-select-value{font-size:var(--mat-paginator-select-trigger-text-size, var(--mat-sys-body-small-size))}.mat-mdc-paginator .mat-mdc-form-field-subscript-wrapper{display:none}.mat-mdc-paginator .mat-mdc-select{line-height:1.5}.mat-mdc-paginator-outer-container{display:flex}.mat-mdc-paginator-container{display:flex;align-items:center;justify-content:flex-end;padding:0 8px;flex-wrap:wrap;width:100%;min-height:var(--mat-paginator-container-size, 56px)}.mat-mdc-paginator-page-size{display:flex;align-items:baseline;margin-right:8px}[dir=rtl] .mat-mdc-paginator-page-size{margin-right:0;margin-left:8px}.mat-mdc-paginator-page-size-label{margin:0 4px}.mat-mdc-paginator-page-size-select{margin:0 4px;width:84px}.mat-mdc-paginator-range-label{margin:0 32px 0 24px}.mat-mdc-paginator-range-actions{display:flex;align-items:center}.mat-mdc-paginator-icon{display:inline-block;width:28px;fill:var(--mat-paginator-enabled-icon-color, var(--mat-sys-on-surface-variant))}.mat-mdc-icon-button[aria-disabled] .mat-mdc-paginator-icon{fill:var(--mat-paginator-disabled-icon-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent))}[dir=rtl] .mat-mdc-paginator-icon{transform:rotate(180deg)}@media(forced-colors: active){.mat-mdc-icon-button[aria-disabled] .mat-mdc-paginator-icon,.mat-mdc-paginator-icon{fill:currentColor}.mat-mdc-paginator-range-actions .mat-mdc-icon-button{outline:solid 1px}.mat-mdc-paginator-range-actions .mat-mdc-icon-button[aria-disabled]{color:GrayText}}.mat-mdc-paginator-touch-target{display:var(--mat-paginator-touch-target-display, block);position:absolute;top:50%;left:50%;width:84px;height:48px;background-color:rgba(0,0,0,0);transform:translate(-50%, -50%);cursor:pointer}\n"],encapsulation:2,changeDetection:0})}return t})(),yP=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275mod=Er({type:t});static \u0275inj=Ai({providers:[ire],imports:[Hg,sE,Zie,GT]})}return t})();const sre=["*"],cre=[[["","mat-card-avatar",""],["","matCardAvatar",""]],[["mat-card-title"],["mat-card-subtitle"],["","mat-card-title",""],["","mat-card-subtitle",""],["","matCardTitle",""],["","matCardSubtitle",""]],"*"],dre=["[mat-card-avatar], [matCardAvatar]","mat-card-title, mat-card-subtitle,\n      [mat-card-title], [mat-card-subtitle],\n      [matCardTitle], [matCardSubtitle]","*"],ure=new _t("MAT_CARD_CONFIG");let lv=(()=>{class t{appearance;constructor(){const e=te(ure,{optional:!0});this.appearance=e?.appearance||"raised"}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=kn({type:t,selectors:[["mat-card"]],hostAttrs:[1,"mat-mdc-card","mdc-card"],hostVars:4,hostBindings:function(i,r){2&i&&Di("mat-mdc-card-outlined","outlined"===r.appearance)("mdc-card--outlined","outlined"===r.appearance)},inputs:{appearance:"appearance"},exportAs:["matCard"],ngContentSelectors:sre,decls:1,vars:0,template:function(i,r){1&i&&(os(),Fi(0))},styles:['.mat-mdc-card{display:flex;flex-direction:column;box-sizing:border-box;position:relative;border-style:solid;border-width:0;background-color:var(--mdc-elevated-card-container-color, var(--mat-sys-surface-container-low));border-color:var(--mdc-elevated-card-container-color, var(--mat-sys-surface-container-low));border-radius:var(--mdc-elevated-card-container-shape, var(--mat-sys-corner-medium));box-shadow:var(--mdc-elevated-card-container-elevation, var(--mat-sys-level1))}.mat-mdc-card::after{position:absolute;top:0;left:0;width:100%;height:100%;border:solid 1px rgba(0,0,0,0);content:"";display:block;pointer-events:none;box-sizing:border-box;border-radius:var(--mdc-elevated-card-container-shape, var(--mat-sys-corner-medium))}.mat-mdc-card-outlined{background-color:var(--mdc-outlined-card-container-color, var(--mat-sys-surface));border-radius:var(--mdc-outlined-card-container-shape, var(--mat-sys-corner-medium));border-width:var(--mdc-outlined-card-outline-width, 1px);border-color:var(--mdc-outlined-card-outline-color, var(--mat-sys-outline-variant));box-shadow:var(--mdc-outlined-card-container-elevation, var(--mat-sys-level0))}.mat-mdc-card-outlined::after{border:none}.mdc-card__media{position:relative;box-sizing:border-box;background-repeat:no-repeat;background-position:center;background-size:cover}.mdc-card__media::before{display:block;content:""}.mdc-card__media:first-child{border-top-left-radius:inherit;border-top-right-radius:inherit}.mdc-card__media:last-child{border-bottom-left-radius:inherit;border-bottom-right-radius:inherit}.mat-mdc-card-actions{display:flex;flex-direction:row;align-items:center;box-sizing:border-box;min-height:52px;padding:8px}.mat-mdc-card-title{font-family:var(--mat-card-title-text-font, var(--mat-sys-title-large-font));line-height:var(--mat-card-title-text-line-height, var(--mat-sys-title-large-line-height));font-size:var(--mat-card-title-text-size, var(--mat-sys-title-large-size));letter-spacing:var(--mat-card-title-text-tracking, var(--mat-sys-title-large-tracking));font-weight:var(--mat-card-title-text-weight, var(--mat-sys-title-large-weight))}.mat-mdc-card-subtitle{color:var(--mat-card-subtitle-text-color, var(--mat-sys-on-surface));font-family:var(--mat-card-subtitle-text-font, var(--mat-sys-title-medium-font));line-height:var(--mat-card-subtitle-text-line-height, var(--mat-sys-title-medium-line-height));font-size:var(--mat-card-subtitle-text-size, var(--mat-sys-title-medium-size));letter-spacing:var(--mat-card-subtitle-text-tracking, var(--mat-sys-title-medium-tracking));font-weight:var(--mat-card-subtitle-text-weight, var(--mat-sys-title-medium-weight))}.mat-mdc-card-title,.mat-mdc-card-subtitle{display:block;margin:0}.mat-mdc-card-avatar~.mat-mdc-card-header-text .mat-mdc-card-title,.mat-mdc-card-avatar~.mat-mdc-card-header-text .mat-mdc-card-subtitle{padding:16px 16px 0}.mat-mdc-card-header{display:flex;padding:16px 16px 0}.mat-mdc-card-content{display:block;padding:0 16px}.mat-mdc-card-content:first-child{padding-top:16px}.mat-mdc-card-content:last-child{padding-bottom:16px}.mat-mdc-card-title-group{display:flex;justify-content:space-between;width:100%}.mat-mdc-card-avatar{height:40px;width:40px;border-radius:50%;flex-shrink:0;margin-bottom:16px;object-fit:cover}.mat-mdc-card-avatar~.mat-mdc-card-header-text .mat-mdc-card-subtitle,.mat-mdc-card-avatar~.mat-mdc-card-header-text .mat-mdc-card-title{line-height:normal}.mat-mdc-card-sm-image{width:80px;height:80px}.mat-mdc-card-md-image{width:112px;height:112px}.mat-mdc-card-lg-image{width:152px;height:152px}.mat-mdc-card-xl-image{width:240px;height:240px}.mat-mdc-card-subtitle~.mat-mdc-card-title,.mat-mdc-card-title~.mat-mdc-card-subtitle,.mat-mdc-card-header .mat-mdc-card-header-text .mat-mdc-card-title,.mat-mdc-card-header .mat-mdc-card-header-text .mat-mdc-card-subtitle,.mat-mdc-card-title-group .mat-mdc-card-title,.mat-mdc-card-title-group .mat-mdc-card-subtitle{padding-top:0}.mat-mdc-card-content>:last-child:not(.mat-mdc-card-footer){margin-bottom:0}.mat-mdc-card-actions-align-end{justify-content:flex-end}\n'],encapsulation:2,changeDetection:0})}return t})(),aE=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275dir=Ht({type:t,selectors:[["mat-card-title"],["","mat-card-title",""],["","matCardTitle",""]],hostAttrs:[1,"mat-mdc-card-title"]})}return t})(),lE=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275dir=Ht({type:t,selectors:[["mat-card-content"]],hostAttrs:[1,"mat-mdc-card-content"]})}return t})(),vP=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275dir=Ht({type:t,selectors:[["mat-card-subtitle"],["","mat-card-subtitle",""],["","matCardSubtitle",""]],hostAttrs:[1,"mat-mdc-card-subtitle"]})}return t})(),bP=(()=>{class t{align="start";static \u0275fac=function(i){return new(i||t)};static \u0275dir=Ht({type:t,selectors:[["mat-card-actions"]],hostAttrs:[1,"mat-mdc-card-actions","mdc-card__actions"],hostVars:2,hostBindings:function(i,r){2&i&&Di("mat-mdc-card-actions-align-end","end"===r.align)},inputs:{align:"align"},exportAs:["matCardActions"]})}return t})(),cE=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275cmp=kn({type:t,selectors:[["mat-card-header"]],hostAttrs:[1,"mat-mdc-card-header"],ngContentSelectors:dre,decls:4,vars:0,consts:[[1,"mat-mdc-card-header-text"]],template:function(i,r){1&i&&(os(cre),Fi(0),ae(1,"div",0),Fi(2,1),le(),Fi(3,2))},encapsulation:2,changeDetection:0})}return t})(),nx=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275mod=Er({type:t});static \u0275inj=Ai({imports:[Qr,Qr]})}return t})(),iU=(()=>{class t{get vertical(){return this._vertical}set vertical(e){this._vertical=qg(e)}_vertical=!1;get inset(){return this._inset}set inset(e){this._inset=qg(e)}_inset=!1;static \u0275fac=function(i){return new(i||t)};static \u0275cmp=kn({type:t,selectors:[["mat-divider"]],hostAttrs:["role","separator",1,"mat-divider"],hostVars:7,hostBindings:function(i,r){2&i&&(ii("aria-orientation",r.vertical?"vertical":"horizontal"),Di("mat-divider-vertical",r.vertical)("mat-divider-horizontal",!r.vertical)("mat-divider-inset",r.inset))},inputs:{vertical:"vertical",inset:"inset"},decls:0,vars:0,template:function(i,r){},styles:[".mat-divider{display:block;margin:0;border-top-style:solid;border-top-color:var(--mat-divider-color, var(--mat-sys-outline));border-top-width:var(--mat-divider-width, 1px)}.mat-divider.mat-divider-vertical{border-top:0;border-right-style:solid;border-right-color:var(--mat-divider-color, var(--mat-sys-outline));border-right-width:var(--mat-divider-width, 1px)}.mat-divider.mat-divider-inset{margin-left:80px}[dir=rtl] .mat-divider.mat-divider-inset{margin-left:auto;margin-right:80px}\n"],encapsulation:2,changeDetection:0})}return t})(),xP=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275mod=Er({type:t});static \u0275inj=Ai({imports:[Qr,Qr]})}return t})();class pre extends Y5{_origin="program";setFocusOrigin(n){return this._origin=n,this}setActiveItem(n){super.setActiveItem(n),this.activeItem&&this.activeItem.focus(this._origin)}}const rU=["*",[["mat-chip-avatar"],["","matChipAvatar",""]],[["mat-chip-trailing-icon"],["","matChipRemove",""],["","matChipTrailingIcon",""]]],oU=["*","mat-chip-avatar, [matChipAvatar]","mat-chip-trailing-icon,[matChipRemove],[matChipTrailingIcon]"];function fre(t,n){1&t&&(ae(0,"span",3),Fi(1,1),le())}function mre(t,n){1&t&&(ae(0,"span",6),Fi(1,2),le())}function gre(t,n){1&t&&(ae(0,"span",3),Fi(1,1),ae(2,"span",8),ba(),ae(3,"svg",9),Wt(4,"path",10),le()()())}function _re(t,n){1&t&&(ae(0,"span",6),Fi(1,2),le())}const wP=["*"],qT=new _t("mat-chips-default-options",{providedIn:"root",factory:()=>({separatorKeyCodes:[13]})}),CP=new _t("MatChipAvatar"),EP=new _t("MatChipTrailingIcon"),SP=new _t("MatChipRemove"),WT=new _t("MatChip");let ix=(()=>{class t{_elementRef=te(Dn);_parentChip=te(WT);isInteractive=!0;_isPrimary=!0;get disabled(){return this._disabled||this._parentChip?.disabled||!1}set disabled(e){this._disabled=e}_disabled=!1;tabIndex=-1;_allowFocusWhenDisabled=!1;_getDisabledAttribute(){return this.disabled&&!this._allowFocusWhenDisabled?"":null}_getTabindex(){return this.disabled&&!this._allowFocusWhenDisabled||!this.isInteractive?null:this.tabIndex.toString()}constructor(){te(cc).load(H0),"BUTTON"===this._elementRef.nativeElement.nodeName&&this._elementRef.nativeElement.setAttribute("type","button")}focus(){this._elementRef.nativeElement.focus()}_handleClick(e){!this.disabled&&this.isInteractive&&this._isPrimary&&(e.preventDefault(),this._parentChip._handlePrimaryActionInteraction())}_handleKeydown(e){(13===e.keyCode||32===e.keyCode)&&!this.disabled&&this.isInteractive&&this._isPrimary&&!this._parentChip._isEditing&&(e.preventDefault(),this._parentChip._handlePrimaryActionInteraction())}static \u0275fac=function(i){return new(i||t)};static \u0275dir=Ht({type:t,selectors:[["","matChipAction",""]],hostAttrs:[1,"mdc-evolution-chip__action","mat-mdc-chip-action"],hostVars:9,hostBindings:function(i,r){1&i&&Tt("click",function(f){return r._handleClick(f)})("keydown",function(f){return r._handleKeydown(f)}),2&i&&(ii("tabindex",r._getTabindex())("disabled",r._getDisabledAttribute())("aria-disabled",r.disabled),Di("mdc-evolution-chip__action--primary",r._isPrimary)("mdc-evolution-chip__action--presentational",!r.isInteractive)("mdc-evolution-chip__action--trailing",!r._isPrimary))},inputs:{isInteractive:"isInteractive",disabled:[2,"disabled","disabled",Un],tabIndex:[2,"tabIndex","tabIndex",e=>null==e?-1:bu(e)],_allowFocusWhenDisabled:"_allowFocusWhenDisabled"}})}return t})(),Yg=(()=>{class t{_changeDetectorRef=te(Do);_elementRef=te(Dn);_ngZone=te(wt);_focusMonitor=te(j0);_globalRippleOptions=te(yR,{optional:!0});_document=te(mr);_onFocus=new Et;_onBlur=new Et;_isBasicChip;role=null;_hasFocusInternal=!1;_pendingFocus;_actionChanges;_animationsDisabled;_allLeadingIcons;_allTrailingIcons;_allRemoveIcons;_hasFocus(){return this._hasFocusInternal}id=te(Sa).getId("mat-mdc-chip-");ariaLabel=null;ariaDescription=null;_ariaDescriptionId=`${this.id}-aria-description`;_chipListDisabled=!1;_textElement;get value(){return void 0!==this._value?this._value:this._textElement.textContent.trim()}set value(e){this._value=e}_value;color;removable=!0;highlighted=!1;disableRipple=!1;get disabled(){return this._disabled||this._chipListDisabled}set disabled(e){this._disabled=e}_disabled=!1;removed=new $e;destroyed=new $e;basicChipAttrName="mat-basic-chip";leadingIcon;trailingIcon;removeIcon;primaryAction;_rippleLoader=te(JV);_injector=te(we);constructor(){const e=te(cc);e.load(H0),e.load(Wy);const i=te(wa,{optional:!0});this._animationsDisabled="NoopAnimations"===i,this._monitorFocus(),this._rippleLoader?.configureRipple(this._elementRef.nativeElement,{className:"mat-mdc-chip-ripple",disabled:this._isRippleDisabled()})}ngOnInit(){const e=this._elementRef.nativeElement;this._isBasicChip=e.hasAttribute(this.basicChipAttrName)||e.tagName.toLowerCase()===this.basicChipAttrName}ngAfterViewInit(){this._textElement=this._elementRef.nativeElement.querySelector(".mat-mdc-chip-action-label"),this._pendingFocus&&(this._pendingFocus=!1,this.focus())}ngAfterContentInit(){this._actionChanges=zc(this._allLeadingIcons.changes,this._allTrailingIcons.changes,this._allRemoveIcons.changes).subscribe(()=>this._changeDetectorRef.markForCheck())}ngDoCheck(){this._rippleLoader.setDisabled(this._elementRef.nativeElement,this._isRippleDisabled())}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._rippleLoader?.destroyRipple(this._elementRef.nativeElement),this._actionChanges?.unsubscribe(),this.destroyed.emit({chip:this}),this.destroyed.complete()}remove(){this.removable&&this.removed.emit({chip:this})}_isRippleDisabled(){return this.disabled||this.disableRipple||this._animationsDisabled||this._isBasicChip||!!this._globalRippleOptions?.disabled}_hasTrailingIcon(){return!(!this.trailingIcon&&!this.removeIcon)}_handleKeydown(e){(8===e.keyCode&&!e.repeat||46===e.keyCode)&&(e.preventDefault(),this.remove())}focus(){this.disabled||(this.primaryAction?this.primaryAction.focus():this._pendingFocus=!0)}_getSourceAction(e){return this._getActions().find(i=>{const r=i._elementRef.nativeElement;return r===e||r.contains(e)})}_getActions(){const e=[];return this.primaryAction&&e.push(this.primaryAction),this.removeIcon&&e.push(this.removeIcon),this.trailingIcon&&e.push(this.trailingIcon),e}_handlePrimaryActionInteraction(){}_monitorFocus(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(e=>{const i=null!==e;i!==this._hasFocusInternal&&(this._hasFocusInternal=i,i?this._onFocus.next({chip:this}):(this._changeDetectorRef.markForCheck(),setTimeout(()=>this._ngZone.run(()=>this._onBlur.next({chip:this})))))})}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=kn({type:t,selectors:[["mat-basic-chip"],["","mat-basic-chip",""],["mat-chip"],["","mat-chip",""]],contentQueries:function(i,r,l){if(1&i&&(ro(l,CP,5),ro(l,EP,5),ro(l,SP,5),ro(l,CP,5),ro(l,EP,5),ro(l,SP,5)),2&i){let f;Zn(f=Xn())&&(r.leadingIcon=f.first),Zn(f=Xn())&&(r.trailingIcon=f.first),Zn(f=Xn())&&(r.removeIcon=f.first),Zn(f=Xn())&&(r._allLeadingIcons=f),Zn(f=Xn())&&(r._allTrailingIcons=f),Zn(f=Xn())&&(r._allRemoveIcons=f)}},viewQuery:function(i,r){if(1&i&&kr(ix,5),2&i){let l;Zn(l=Xn())&&(r.primaryAction=l.first)}},hostAttrs:[1,"mat-mdc-chip"],hostVars:31,hostBindings:function(i,r){1&i&&Tt("keydown",function(f){return r._handleKeydown(f)}),2&i&&(rc("id",r.id),ii("role",r.role)("aria-label",r.ariaLabel),Kf("mat-"+(r.color||"primary")),Di("mdc-evolution-chip",!r._isBasicChip)("mdc-evolution-chip--disabled",r.disabled)("mdc-evolution-chip--with-trailing-action",r._hasTrailingIcon())("mdc-evolution-chip--with-primary-graphic",r.leadingIcon)("mdc-evolution-chip--with-primary-icon",r.leadingIcon)("mdc-evolution-chip--with-avatar",r.leadingIcon)("mat-mdc-chip-with-avatar",r.leadingIcon)("mat-mdc-chip-highlighted",r.highlighted)("mat-mdc-chip-disabled",r.disabled)("mat-mdc-basic-chip",r._isBasicChip)("mat-mdc-standard-chip",!r._isBasicChip)("mat-mdc-chip-with-trailing-icon",r._hasTrailingIcon())("_mat-animation-noopable",r._animationsDisabled))},inputs:{role:"role",id:"id",ariaLabel:[0,"aria-label","ariaLabel"],ariaDescription:[0,"aria-description","ariaDescription"],value:"value",color:"color",removable:[2,"removable","removable",Un],highlighted:[2,"highlighted","highlighted",Un],disableRipple:[2,"disableRipple","disableRipple",Un],disabled:[2,"disabled","disabled",Un]},outputs:{removed:"removed",destroyed:"destroyed"},exportAs:["matChip"],features:[pi([{provide:WT,useExisting:t}])],ngContentSelectors:oU,decls:8,vars:3,consts:[[1,"mat-mdc-chip-focus-overlay"],[1,"mdc-evolution-chip__cell","mdc-evolution-chip__cell--primary"],["matChipAction","",3,"isInteractive"],[1,"mdc-evolution-chip__graphic","mat-mdc-chip-graphic"],[1,"mdc-evolution-chip__text-label","mat-mdc-chip-action-label"],[1,"mat-mdc-chip-primary-focus-indicator","mat-focus-indicator"],[1,"mdc-evolution-chip__cell","mdc-evolution-chip__cell--trailing"]],template:function(i,r){1&i&&(os(rU),Wt(0,"span",0),ae(1,"span",1)(2,"span",2),vt(3,fre,2,0,"span",3),ae(4,"span",4),Fi(5),Wt(6,"span",5),le()()(),vt(7,mre,2,0,"span",6)),2&i&&(xe(2),Xe("isInteractive",!1),xe(),qi(r.leadingIcon?3:-1),xe(4),qi(r._hasTrailingIcon()?7:-1))},dependencies:[ix],styles:['.mdc-evolution-chip,.mdc-evolution-chip__cell,.mdc-evolution-chip__action{display:inline-flex;align-items:center}.mdc-evolution-chip{position:relative;max-width:100%}.mdc-evolution-chip__cell,.mdc-evolution-chip__action{height:100%}.mdc-evolution-chip__cell--primary{flex-basis:100%;overflow-x:hidden}.mdc-evolution-chip__cell--trailing{flex:1 0 auto}.mdc-evolution-chip__action{align-items:center;background:none;border:none;box-sizing:content-box;cursor:pointer;display:inline-flex;justify-content:center;outline:none;padding:0;text-decoration:none;color:inherit}.mdc-evolution-chip__action--presentational{cursor:auto}.mdc-evolution-chip--disabled,.mdc-evolution-chip__action:disabled{pointer-events:none}@media(forced-colors: active){.mdc-evolution-chip--disabled,.mdc-evolution-chip__action:disabled{forced-color-adjust:none}}.mdc-evolution-chip__action--primary{font:inherit;letter-spacing:inherit;white-space:inherit;overflow-x:hidden}.mat-mdc-standard-chip .mdc-evolution-chip__action--primary::before{border-width:var(--mdc-chip-outline-width, 1px);border-radius:var(--mdc-chip-container-shape-radius, 8px);box-sizing:border-box;content:"";height:100%;left:0;position:absolute;pointer-events:none;top:0;width:100%;z-index:1;border-style:solid}.mat-mdc-standard-chip .mdc-evolution-chip__action--primary{padding-left:12px;padding-right:12px}.mat-mdc-standard-chip.mdc-evolution-chip--with-primary-graphic .mdc-evolution-chip__action--primary{padding-left:0;padding-right:12px}[dir=rtl] .mat-mdc-standard-chip.mdc-evolution-chip--with-primary-graphic .mdc-evolution-chip__action--primary{padding-left:12px;padding-right:0}.mat-mdc-standard-chip:not(.mdc-evolution-chip--disabled) .mdc-evolution-chip__action--primary::before{border-color:var(--mdc-chip-outline-color, var(--mat-sys-outline))}.mdc-evolution-chip__action--primary:not(.mdc-evolution-chip__action--presentational):not(.mdc-ripple-upgraded):focus::before{border-color:var(--mdc-chip-focus-outline-color, var(--mat-sys-on-surface-variant))}.mat-mdc-standard-chip.mdc-evolution-chip--disabled .mdc-evolution-chip__action--primary::before{border-color:var(--mdc-chip-disabled-outline-color, color-mix(in srgb, var(--mat-sys-on-surface) 12%, transparent))}.mat-mdc-standard-chip.mdc-evolution-chip--selected .mdc-evolution-chip__action--primary::before{border-width:var(--mdc-chip-flat-selected-outline-width, 0)}.mat-mdc-basic-chip .mdc-evolution-chip__action--primary{font:inherit}.mat-mdc-standard-chip.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__action--primary{padding-left:12px;padding-right:0}[dir=rtl] .mat-mdc-standard-chip.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__action--primary{padding-left:0;padding-right:12px}.mat-mdc-standard-chip.mdc-evolution-chip--with-primary-graphic.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__action--primary{padding-left:0;padding-right:0}[dir=rtl] .mat-mdc-standard-chip.mdc-evolution-chip--with-primary-graphic.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__action--primary{padding-left:0;padding-right:0}.mdc-evolution-chip--with-avatar.mdc-evolution-chip--with-primary-graphic .mdc-evolution-chip__action--primary{padding-left:0;padding-right:12px}[dir=rtl] .mdc-evolution-chip--with-avatar.mdc-evolution-chip--with-primary-graphic .mdc-evolution-chip__action--primary{padding-left:12px;padding-right:0}.mdc-evolution-chip--with-avatar.mdc-evolution-chip--with-primary-graphic.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__action--primary{padding-left:0;padding-right:0}[dir=rtl] .mdc-evolution-chip--with-avatar.mdc-evolution-chip--with-primary-graphic.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__action--primary{padding-left:0;padding-right:0}.mdc-evolution-chip__action--trailing{position:relative;overflow:visible}.mat-mdc-standard-chip:not(.mdc-evolution-chip--disabled) .mdc-evolution-chip__action--trailing{color:var(--mdc-chip-with-trailing-icon-trailing-icon-color, var(--mat-sys-on-surface-variant))}.mat-mdc-standard-chip.mdc-evolution-chip--disabled .mdc-evolution-chip__action--trailing{color:var(--mdc-chip-with-trailing-icon-disabled-trailing-icon-color, var(--mat-sys-on-surface))}.mat-mdc-standard-chip.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__action--trailing{padding-left:8px;padding-right:8px}.mat-mdc-standard-chip.mdc-evolution-chip--with-primary-graphic.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__action--trailing{padding-left:8px;padding-right:8px}.mdc-evolution-chip--with-avatar.mdc-evolution-chip--with-primary-graphic.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__action--trailing{padding-left:8px;padding-right:8px}[dir=rtl] .mdc-evolution-chip--with-avatar.mdc-evolution-chip--with-primary-graphic.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__action--trailing{padding-left:8px;padding-right:8px}.mdc-evolution-chip__text-label{-webkit-user-select:none;user-select:none;white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.mat-mdc-standard-chip .mdc-evolution-chip__text-label{font-family:var(--mdc-chip-label-text-font, var(--mat-sys-label-large-font));line-height:var(--mdc-chip-label-text-line-height, var(--mat-sys-label-large-line-height));font-size:var(--mdc-chip-label-text-size, var(--mat-sys-label-large-size));font-weight:var(--mdc-chip-label-text-weight, var(--mat-sys-label-large-weight));letter-spacing:var(--mdc-chip-label-text-tracking, var(--mat-sys-label-large-tracking))}.mat-mdc-standard-chip:not(.mdc-evolution-chip--disabled) .mdc-evolution-chip__text-label{color:var(--mdc-chip-label-text-color, var(--mat-sys-on-surface-variant))}.mat-mdc-standard-chip.mdc-evolution-chip--selected:not(.mdc-evolution-chip--disabled) .mdc-evolution-chip__text-label{color:var(--mdc-chip-selected-label-text-color, var(--mat-sys-on-secondary-container))}.mat-mdc-standard-chip.mdc-evolution-chip--disabled .mdc-evolution-chip__text-label,.mat-mdc-standard-chip.mdc-evolution-chip--selected.mdc-evolution-chip--disabled .mdc-evolution-chip__text-label{color:var(--mdc-chip-disabled-label-text-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent))}.mdc-evolution-chip__graphic{align-items:center;display:inline-flex;justify-content:center;overflow:hidden;pointer-events:none;position:relative;flex:1 0 auto}.mat-mdc-standard-chip .mdc-evolution-chip__graphic{width:var(--mdc-chip-with-avatar-avatar-size, 24px);height:var(--mdc-chip-with-avatar-avatar-size, 24px);font-size:var(--mdc-chip-with-avatar-avatar-size, 24px)}.mdc-evolution-chip--selecting .mdc-evolution-chip__graphic{transition:width 150ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-evolution-chip--selectable:not(.mdc-evolution-chip--selected):not(.mdc-evolution-chip--with-primary-icon) .mdc-evolution-chip__graphic{width:0}.mat-mdc-standard-chip.mdc-evolution-chip--with-primary-graphic .mdc-evolution-chip__graphic{padding-left:6px;padding-right:6px}.mdc-evolution-chip--with-avatar.mdc-evolution-chip--with-primary-graphic .mdc-evolution-chip__graphic{padding-left:4px;padding-right:8px}[dir=rtl] .mdc-evolution-chip--with-avatar.mdc-evolution-chip--with-primary-graphic .mdc-evolution-chip__graphic{padding-left:8px;padding-right:4px}.mat-mdc-standard-chip.mdc-evolution-chip--with-primary-graphic.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__graphic{padding-left:6px;padding-right:6px}.mdc-evolution-chip--with-avatar.mdc-evolution-chip--with-primary-graphic.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__graphic{padding-left:4px;padding-right:8px}[dir=rtl] .mdc-evolution-chip--with-avatar.mdc-evolution-chip--with-primary-graphic.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__graphic{padding-left:8px;padding-right:4px}.mdc-evolution-chip__checkmark{position:absolute;opacity:0;top:50%;left:50%;height:20px;width:20px}.mat-mdc-standard-chip:not(.mdc-evolution-chip--disabled) .mdc-evolution-chip__checkmark{color:var(--mdc-chip-with-icon-selected-icon-color, var(--mat-sys-on-secondary-container))}.mat-mdc-standard-chip.mdc-evolution-chip--disabled .mdc-evolution-chip__checkmark{color:var(--mdc-chip-with-icon-disabled-icon-color, var(--mat-sys-on-surface))}.mdc-evolution-chip--selecting .mdc-evolution-chip__checkmark{transition:transform 150ms 0ms cubic-bezier(0.4, 0, 0.2, 1);transform:translate(-75%, -50%)}.mdc-evolution-chip--selected .mdc-evolution-chip__checkmark{transform:translate(-50%, -50%);opacity:1}.mdc-evolution-chip__checkmark-svg{display:block}.mdc-evolution-chip__checkmark-path{stroke-width:2px;stroke-dasharray:29.7833385;stroke-dashoffset:29.7833385;stroke:currentColor}.mdc-evolution-chip--selecting .mdc-evolution-chip__checkmark-path{transition:stroke-dashoffset 150ms 45ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-evolution-chip--selected .mdc-evolution-chip__checkmark-path{stroke-dashoffset:0}@media(forced-colors: active){.mdc-evolution-chip__checkmark-path{stroke:CanvasText !important}}.mat-mdc-standard-chip .mdc-evolution-chip__icon--trailing{height:18px;width:18px;font-size:18px}.mdc-evolution-chip--disabled .mdc-evolution-chip__icon--trailing.mat-mdc-chip-remove{opacity:calc(var(--mat-chip-trailing-action-opacity, 1)*var(--mdc-chip-with-trailing-icon-disabled-trailing-icon-opacity, 0.38))}.mdc-evolution-chip--disabled .mdc-evolution-chip__icon--trailing.mat-mdc-chip-remove:focus{opacity:calc(var(--mat-chip-trailing-action-focus-opacity, 1)*var(--mdc-chip-with-trailing-icon-disabled-trailing-icon-opacity, 0.38))}.mat-mdc-standard-chip{border-radius:var(--mdc-chip-container-shape-radius, 8px);height:var(--mdc-chip-container-height, 32px)}.mat-mdc-standard-chip:not(.mdc-evolution-chip--disabled){background-color:var(--mdc-chip-elevated-container-color, transparent)}.mat-mdc-standard-chip.mdc-evolution-chip--disabled{background-color:var(--mdc-chip-elevated-disabled-container-color)}.mat-mdc-standard-chip.mdc-evolution-chip--selected:not(.mdc-evolution-chip--disabled){background-color:var(--mdc-chip-elevated-selected-container-color, var(--mat-sys-secondary-container))}.mat-mdc-standard-chip.mdc-evolution-chip--selected.mdc-evolution-chip--disabled{background-color:var(--mdc-chip-flat-disabled-selected-container-color, color-mix(in srgb, var(--mat-sys-on-surface) 12%, transparent))}@media(forced-colors: active){.mat-mdc-standard-chip{outline:solid 1px}}.mat-mdc-standard-chip .mdc-evolution-chip__icon--primary{border-radius:var(--mdc-chip-with-avatar-avatar-shape-radius, 24px);width:var(--mdc-chip-with-icon-icon-size, 18px);height:var(--mdc-chip-with-icon-icon-size, 18px);font-size:var(--mdc-chip-with-icon-icon-size, 18px)}.mdc-evolution-chip--selected .mdc-evolution-chip__icon--primary{opacity:0}.mat-mdc-standard-chip:not(.mdc-evolution-chip--disabled) .mdc-evolution-chip__icon--primary{color:var(--mdc-chip-with-icon-icon-color, var(--mat-sys-on-surface-variant))}.mat-mdc-standard-chip.mdc-evolution-chip--disabled .mdc-evolution-chip__icon--primary{color:var(--mdc-chip-with-icon-disabled-icon-color, var(--mat-sys-on-surface))}.mat-mdc-chip-highlighted{--mdc-chip-with-icon-icon-color:var(--mdc-chip-with-icon-selected-icon-color, var(--mat-sys-on-secondary-container));--mdc-chip-elevated-container-color:var(--mdc-chip-elevated-selected-container-color, var(--mat-sys-secondary-container));--mdc-chip-label-text-color:var(--mdc-chip-selected-label-text-color, var(--mat-sys-on-secondary-container));--mdc-chip-outline-width:var(--mdc-chip-flat-selected-outline-width, 0)}.mat-mdc-chip-focus-overlay{background:var(--mdc-chip-focus-state-layer-color, var(--mat-sys-on-surface-variant))}.mat-mdc-chip-selected .mat-mdc-chip-focus-overlay,.mat-mdc-chip-highlighted .mat-mdc-chip-focus-overlay{background:var(--mdc-chip-selected-focus-state-layer-color, var(--mat-sys-on-secondary-container))}.mat-mdc-chip:hover .mat-mdc-chip-focus-overlay{background:var(--mdc-chip-hover-state-layer-color, var(--mat-sys-on-surface-variant));opacity:var(--mdc-chip-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mat-mdc-chip-focus-overlay .mat-mdc-chip-selected:hover,.mat-mdc-chip-highlighted:hover .mat-mdc-chip-focus-overlay{background:var(--mdc-chip-selected-hover-state-layer-color, var(--mat-sys-on-secondary-container));opacity:var(--mdc-chip-selected-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mat-mdc-chip.cdk-focused .mat-mdc-chip-focus-overlay{background:var(--mdc-chip-focus-state-layer-color, var(--mat-sys-on-surface-variant));opacity:var(--mdc-chip-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mat-mdc-chip-selected.cdk-focused .mat-mdc-chip-focus-overlay,.mat-mdc-chip-highlighted.cdk-focused .mat-mdc-chip-focus-overlay{background:var(--mdc-chip-selected-focus-state-layer-color, var(--mat-sys-on-secondary-container));opacity:var(--mdc-chip-selected-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mdc-evolution-chip--disabled:not(.mdc-evolution-chip--selected) .mat-mdc-chip-avatar{opacity:var(--mdc-chip-with-avatar-disabled-avatar-opacity, 0.38)}.mdc-evolution-chip--disabled .mdc-evolution-chip__icon--trailing{opacity:var(--mdc-chip-with-trailing-icon-disabled-trailing-icon-opacity, 0.38)}.mdc-evolution-chip--disabled.mdc-evolution-chip--selected .mdc-evolution-chip__checkmark{opacity:var(--mdc-chip-with-icon-disabled-icon-opacity, 0.38)}.mat-mdc-standard-chip.mdc-evolution-chip--disabled{opacity:var(--mat-chip-disabled-container-opacity, 1)}.mat-mdc-standard-chip.mdc-evolution-chip--selected .mdc-evolution-chip__icon--trailing,.mat-mdc-standard-chip.mat-mdc-chip-highlighted .mdc-evolution-chip__icon--trailing{color:var(--mat-chip-selected-trailing-icon-color, var(--mat-sys-on-secondary-container))}.mat-mdc-standard-chip.mdc-evolution-chip--selected.mdc-evolution-chip--disabled .mdc-evolution-chip__icon--trailing,.mat-mdc-standard-chip.mat-mdc-chip-highlighted.mdc-evolution-chip--disabled .mdc-evolution-chip__icon--trailing{color:var(--mat-chip-selected-disabled-trailing-icon-color, var(--mat-sys-on-surface))}.mat-mdc-chip-remove{opacity:var(--mat-chip-trailing-action-opacity, 1)}.mat-mdc-chip-remove:focus{opacity:var(--mat-chip-trailing-action-focus-opacity, 1)}.mat-mdc-chip-remove::after{background-color:var(--mat-chip-trailing-action-state-layer-color, var(--mat-sys-on-surface-variant))}.mat-mdc-chip-remove:hover::after{opacity:var(--mat-chip-trailing-action-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mat-mdc-chip-remove:focus::after{opacity:var(--mat-chip-trailing-action-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mat-mdc-chip-selected .mat-mdc-chip-remove::after,.mat-mdc-chip-highlighted .mat-mdc-chip-remove::after{background-color:var(--mat-chip-selected-trailing-action-state-layer-color, var(--mat-sys-on-secondary-container))}.mat-mdc-standard-chip{-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-standard-chip .mdc-evolution-chip__cell--primary,.mat-mdc-standard-chip .mdc-evolution-chip__action--primary,.mat-mdc-standard-chip .mat-mdc-chip-action-label{overflow:visible}.mat-mdc-standard-chip .mat-mdc-chip-graphic,.mat-mdc-standard-chip .mat-mdc-chip-trailing-icon{box-sizing:content-box}.mat-mdc-standard-chip._mat-animation-noopable,.mat-mdc-standard-chip._mat-animation-noopable .mdc-evolution-chip__graphic,.mat-mdc-standard-chip._mat-animation-noopable .mdc-evolution-chip__checkmark,.mat-mdc-standard-chip._mat-animation-noopable .mdc-evolution-chip__checkmark-path{transition-duration:1ms;animation-duration:1ms}.mat-mdc-chip-focus-overlay{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;opacity:0;border-radius:inherit;transition:opacity 150ms linear}._mat-animation-noopable .mat-mdc-chip-focus-overlay{transition:none}.mat-mdc-basic-chip .mat-mdc-chip-focus-overlay{display:none}.mat-mdc-chip .mat-ripple.mat-mdc-chip-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-chip-avatar{text-align:center;line-height:1;color:var(--mdc-chip-with-icon-icon-color, currentColor)}.mat-mdc-chip{position:relative;z-index:0}.mat-mdc-chip-action-label{text-align:left;z-index:1}[dir=rtl] .mat-mdc-chip-action-label{text-align:right}.mat-mdc-chip.mdc-evolution-chip--with-trailing-action .mat-mdc-chip-action-label{position:relative}.mat-mdc-chip-action-label .mat-mdc-chip-primary-focus-indicator{position:absolute;top:0;right:0;bottom:0;left:0;pointer-events:none}.mat-mdc-chip-action-label .mat-focus-indicator::before{margin:calc(calc(var(--mat-focus-indicator-border-width, 3px) + 2px)*-1)}.mat-mdc-chip-remove::before{margin:calc(var(--mat-focus-indicator-border-width, 3px)*-1);left:8px;right:8px}.mat-mdc-chip-remove::after{content:"";display:block;opacity:0;position:absolute;top:-3px;bottom:-3px;left:5px;right:5px;border-radius:50%;box-sizing:border-box;padding:12px;margin:-12px;background-clip:content-box}.mat-mdc-chip-remove .mat-icon{width:18px;height:18px;font-size:18px;box-sizing:content-box}.mat-chip-edit-input{cursor:text;display:inline-block;color:inherit;outline:0}@media(forced-colors: active){.mat-mdc-chip-selected:not(.mat-mdc-chip-multiple){outline-width:3px}}.mat-mdc-chip-action:focus .mat-focus-indicator::before{content:""}\n'],encapsulation:2,changeDetection:0})}return t})(),DP=(()=>{class t extends Yg{_defaultOptions=te(qT,{optional:!0});chipListSelectable=!0;_chipListMultiple=!1;_chipListHideSingleSelectionIndicator=this._defaultOptions?.hideSingleSelectionIndicator??!1;get selectable(){return this._selectable&&this.chipListSelectable}set selectable(e){this._selectable=e,this._changeDetectorRef.markForCheck()}_selectable=!0;get selected(){return this._selected}set selected(e){this._setSelectedState(e,!1,!0)}_selected=!1;get ariaSelected(){return this.selectable?this.selected.toString():null}basicChipAttrName="mat-basic-chip-option";selectionChange=new $e;ngOnInit(){super.ngOnInit(),this.role="presentation"}select(){this._setSelectedState(!0,!1,!0)}deselect(){this._setSelectedState(!1,!1,!0)}selectViaInteraction(){this._setSelectedState(!0,!0,!0)}toggleSelected(e=!1){return this._setSelectedState(!this.selected,e,!0),this.selected}_handlePrimaryActionInteraction(){this.disabled||(this.focus(),this.selectable&&this.toggleSelected(!0))}_hasLeadingGraphic(){return!!this.leadingIcon||!this._chipListHideSingleSelectionIndicator||this._chipListMultiple}_setSelectedState(e,i,r){e!==this.selected&&(this._selected=e,r&&this.selectionChange.emit({source:this,isUserInput:i,selected:this.selected}),this._changeDetectorRef.markForCheck())}static \u0275fac=(()=>{let e;return function(r){return(e||(e=m(t)))(r||t)}})();static \u0275cmp=kn({type:t,selectors:[["mat-basic-chip-option"],["","mat-basic-chip-option",""],["mat-chip-option"],["","mat-chip-option",""]],hostAttrs:[1,"mat-mdc-chip","mat-mdc-chip-option"],hostVars:37,hostBindings:function(i,r){2&i&&(rc("id",r.id),ii("tabindex",null)("aria-label",null)("aria-description",null)("role",r.role),Di("mdc-evolution-chip",!r._isBasicChip)("mdc-evolution-chip--filter",!r._isBasicChip)("mdc-evolution-chip--selectable",!r._isBasicChip)("mat-mdc-chip-selected",r.selected)("mat-mdc-chip-multiple",r._chipListMultiple)("mat-mdc-chip-disabled",r.disabled)("mat-mdc-chip-with-avatar",r.leadingIcon)("mdc-evolution-chip--disabled",r.disabled)("mdc-evolution-chip--selected",r.selected)("mdc-evolution-chip--selecting",!r._animationsDisabled)("mdc-evolution-chip--with-trailing-action",r._hasTrailingIcon())("mdc-evolution-chip--with-primary-icon",r.leadingIcon)("mdc-evolution-chip--with-primary-graphic",r._hasLeadingGraphic())("mdc-evolution-chip--with-avatar",r.leadingIcon)("mat-mdc-chip-highlighted",r.highlighted)("mat-mdc-chip-with-trailing-icon",r._hasTrailingIcon()))},inputs:{selectable:[2,"selectable","selectable",Un],selected:[2,"selected","selected",Un]},outputs:{selectionChange:"selectionChange"},features:[pi([{provide:Yg,useExisting:t},{provide:WT,useExisting:t}]),Nn],ngContentSelectors:oU,decls:10,vars:8,consts:[[1,"mat-mdc-chip-focus-overlay"],[1,"mdc-evolution-chip__cell","mdc-evolution-chip__cell--primary"],["matChipAction","","role","option",3,"_allowFocusWhenDisabled"],[1,"mdc-evolution-chip__graphic","mat-mdc-chip-graphic"],[1,"mdc-evolution-chip__text-label","mat-mdc-chip-action-label"],[1,"mat-mdc-chip-primary-focus-indicator","mat-focus-indicator"],[1,"mdc-evolution-chip__cell","mdc-evolution-chip__cell--trailing"],[1,"cdk-visually-hidden",3,"id"],[1,"mdc-evolution-chip__checkmark"],["viewBox","-2 -3 30 30","focusable","false","aria-hidden","true",1,"mdc-evolution-chip__checkmark-svg"],["fill","none","stroke","currentColor","d","M1.73,12.91 8.1,19.28 22.79,4.59",1,"mdc-evolution-chip__checkmark-path"]],template:function(i,r){1&i&&(os(rU),Wt(0,"span",0),ae(1,"span",1)(2,"button",2),vt(3,gre,5,0,"span",3),ae(4,"span",4),Fi(5),Wt(6,"span",5),le()()(),vt(7,_re,2,0,"span",6),ae(8,"span",7),Re(9),le()),2&i&&(xe(2),Xe("_allowFocusWhenDisabled",!0),ii("aria-selected",r.ariaSelected)("aria-label",r.ariaLabel)("aria-describedby",r._ariaDescriptionId),xe(),qi(r._hasLeadingGraphic()?3:-1),xe(4),qi(r._hasTrailingIcon()?7:-1),xe(),Xe("id",r._ariaDescriptionId),xe(),er(r.ariaDescription))},dependencies:[ix],styles:['.mdc-evolution-chip,.mdc-evolution-chip__cell,.mdc-evolution-chip__action{display:inline-flex;align-items:center}.mdc-evolution-chip{position:relative;max-width:100%}.mdc-evolution-chip__cell,.mdc-evolution-chip__action{height:100%}.mdc-evolution-chip__cell--primary{flex-basis:100%;overflow-x:hidden}.mdc-evolution-chip__cell--trailing{flex:1 0 auto}.mdc-evolution-chip__action{align-items:center;background:none;border:none;box-sizing:content-box;cursor:pointer;display:inline-flex;justify-content:center;outline:none;padding:0;text-decoration:none;color:inherit}.mdc-evolution-chip__action--presentational{cursor:auto}.mdc-evolution-chip--disabled,.mdc-evolution-chip__action:disabled{pointer-events:none}@media(forced-colors: active){.mdc-evolution-chip--disabled,.mdc-evolution-chip__action:disabled{forced-color-adjust:none}}.mdc-evolution-chip__action--primary{font:inherit;letter-spacing:inherit;white-space:inherit;overflow-x:hidden}.mat-mdc-standard-chip .mdc-evolution-chip__action--primary::before{border-width:var(--mdc-chip-outline-width, 1px);border-radius:var(--mdc-chip-container-shape-radius, 8px);box-sizing:border-box;content:"";height:100%;left:0;position:absolute;pointer-events:none;top:0;width:100%;z-index:1;border-style:solid}.mat-mdc-standard-chip .mdc-evolution-chip__action--primary{padding-left:12px;padding-right:12px}.mat-mdc-standard-chip.mdc-evolution-chip--with-primary-graphic .mdc-evolution-chip__action--primary{padding-left:0;padding-right:12px}[dir=rtl] .mat-mdc-standard-chip.mdc-evolution-chip--with-primary-graphic .mdc-evolution-chip__action--primary{padding-left:12px;padding-right:0}.mat-mdc-standard-chip:not(.mdc-evolution-chip--disabled) .mdc-evolution-chip__action--primary::before{border-color:var(--mdc-chip-outline-color, var(--mat-sys-outline))}.mdc-evolution-chip__action--primary:not(.mdc-evolution-chip__action--presentational):not(.mdc-ripple-upgraded):focus::before{border-color:var(--mdc-chip-focus-outline-color, var(--mat-sys-on-surface-variant))}.mat-mdc-standard-chip.mdc-evolution-chip--disabled .mdc-evolution-chip__action--primary::before{border-color:var(--mdc-chip-disabled-outline-color, color-mix(in srgb, var(--mat-sys-on-surface) 12%, transparent))}.mat-mdc-standard-chip.mdc-evolution-chip--selected .mdc-evolution-chip__action--primary::before{border-width:var(--mdc-chip-flat-selected-outline-width, 0)}.mat-mdc-basic-chip .mdc-evolution-chip__action--primary{font:inherit}.mat-mdc-standard-chip.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__action--primary{padding-left:12px;padding-right:0}[dir=rtl] .mat-mdc-standard-chip.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__action--primary{padding-left:0;padding-right:12px}.mat-mdc-standard-chip.mdc-evolution-chip--with-primary-graphic.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__action--primary{padding-left:0;padding-right:0}[dir=rtl] .mat-mdc-standard-chip.mdc-evolution-chip--with-primary-graphic.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__action--primary{padding-left:0;padding-right:0}.mdc-evolution-chip--with-avatar.mdc-evolution-chip--with-primary-graphic .mdc-evolution-chip__action--primary{padding-left:0;padding-right:12px}[dir=rtl] .mdc-evolution-chip--with-avatar.mdc-evolution-chip--with-primary-graphic .mdc-evolution-chip__action--primary{padding-left:12px;padding-right:0}.mdc-evolution-chip--with-avatar.mdc-evolution-chip--with-primary-graphic.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__action--primary{padding-left:0;padding-right:0}[dir=rtl] .mdc-evolution-chip--with-avatar.mdc-evolution-chip--with-primary-graphic.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__action--primary{padding-left:0;padding-right:0}.mdc-evolution-chip__action--trailing{position:relative;overflow:visible}.mat-mdc-standard-chip:not(.mdc-evolution-chip--disabled) .mdc-evolution-chip__action--trailing{color:var(--mdc-chip-with-trailing-icon-trailing-icon-color, var(--mat-sys-on-surface-variant))}.mat-mdc-standard-chip.mdc-evolution-chip--disabled .mdc-evolution-chip__action--trailing{color:var(--mdc-chip-with-trailing-icon-disabled-trailing-icon-color, var(--mat-sys-on-surface))}.mat-mdc-standard-chip.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__action--trailing{padding-left:8px;padding-right:8px}.mat-mdc-standard-chip.mdc-evolution-chip--with-primary-graphic.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__action--trailing{padding-left:8px;padding-right:8px}.mdc-evolution-chip--with-avatar.mdc-evolution-chip--with-primary-graphic.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__action--trailing{padding-left:8px;padding-right:8px}[dir=rtl] .mdc-evolution-chip--with-avatar.mdc-evolution-chip--with-primary-graphic.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__action--trailing{padding-left:8px;padding-right:8px}.mdc-evolution-chip__text-label{-webkit-user-select:none;user-select:none;white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.mat-mdc-standard-chip .mdc-evolution-chip__text-label{font-family:var(--mdc-chip-label-text-font, var(--mat-sys-label-large-font));line-height:var(--mdc-chip-label-text-line-height, var(--mat-sys-label-large-line-height));font-size:var(--mdc-chip-label-text-size, var(--mat-sys-label-large-size));font-weight:var(--mdc-chip-label-text-weight, var(--mat-sys-label-large-weight));letter-spacing:var(--mdc-chip-label-text-tracking, var(--mat-sys-label-large-tracking))}.mat-mdc-standard-chip:not(.mdc-evolution-chip--disabled) .mdc-evolution-chip__text-label{color:var(--mdc-chip-label-text-color, var(--mat-sys-on-surface-variant))}.mat-mdc-standard-chip.mdc-evolution-chip--selected:not(.mdc-evolution-chip--disabled) .mdc-evolution-chip__text-label{color:var(--mdc-chip-selected-label-text-color, var(--mat-sys-on-secondary-container))}.mat-mdc-standard-chip.mdc-evolution-chip--disabled .mdc-evolution-chip__text-label,.mat-mdc-standard-chip.mdc-evolution-chip--selected.mdc-evolution-chip--disabled .mdc-evolution-chip__text-label{color:var(--mdc-chip-disabled-label-text-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent))}.mdc-evolution-chip__graphic{align-items:center;display:inline-flex;justify-content:center;overflow:hidden;pointer-events:none;position:relative;flex:1 0 auto}.mat-mdc-standard-chip .mdc-evolution-chip__graphic{width:var(--mdc-chip-with-avatar-avatar-size, 24px);height:var(--mdc-chip-with-avatar-avatar-size, 24px);font-size:var(--mdc-chip-with-avatar-avatar-size, 24px)}.mdc-evolution-chip--selecting .mdc-evolution-chip__graphic{transition:width 150ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-evolution-chip--selectable:not(.mdc-evolution-chip--selected):not(.mdc-evolution-chip--with-primary-icon) .mdc-evolution-chip__graphic{width:0}.mat-mdc-standard-chip.mdc-evolution-chip--with-primary-graphic .mdc-evolution-chip__graphic{padding-left:6px;padding-right:6px}.mdc-evolution-chip--with-avatar.mdc-evolution-chip--with-primary-graphic .mdc-evolution-chip__graphic{padding-left:4px;padding-right:8px}[dir=rtl] .mdc-evolution-chip--with-avatar.mdc-evolution-chip--with-primary-graphic .mdc-evolution-chip__graphic{padding-left:8px;padding-right:4px}.mat-mdc-standard-chip.mdc-evolution-chip--with-primary-graphic.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__graphic{padding-left:6px;padding-right:6px}.mdc-evolution-chip--with-avatar.mdc-evolution-chip--with-primary-graphic.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__graphic{padding-left:4px;padding-right:8px}[dir=rtl] .mdc-evolution-chip--with-avatar.mdc-evolution-chip--with-primary-graphic.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__graphic{padding-left:8px;padding-right:4px}.mdc-evolution-chip__checkmark{position:absolute;opacity:0;top:50%;left:50%;height:20px;width:20px}.mat-mdc-standard-chip:not(.mdc-evolution-chip--disabled) .mdc-evolution-chip__checkmark{color:var(--mdc-chip-with-icon-selected-icon-color, var(--mat-sys-on-secondary-container))}.mat-mdc-standard-chip.mdc-evolution-chip--disabled .mdc-evolution-chip__checkmark{color:var(--mdc-chip-with-icon-disabled-icon-color, var(--mat-sys-on-surface))}.mdc-evolution-chip--selecting .mdc-evolution-chip__checkmark{transition:transform 150ms 0ms cubic-bezier(0.4, 0, 0.2, 1);transform:translate(-75%, -50%)}.mdc-evolution-chip--selected .mdc-evolution-chip__checkmark{transform:translate(-50%, -50%);opacity:1}.mdc-evolution-chip__checkmark-svg{display:block}.mdc-evolution-chip__checkmark-path{stroke-width:2px;stroke-dasharray:29.7833385;stroke-dashoffset:29.7833385;stroke:currentColor}.mdc-evolution-chip--selecting .mdc-evolution-chip__checkmark-path{transition:stroke-dashoffset 150ms 45ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-evolution-chip--selected .mdc-evolution-chip__checkmark-path{stroke-dashoffset:0}@media(forced-colors: active){.mdc-evolution-chip__checkmark-path{stroke:CanvasText !important}}.mat-mdc-standard-chip .mdc-evolution-chip__icon--trailing{height:18px;width:18px;font-size:18px}.mdc-evolution-chip--disabled .mdc-evolution-chip__icon--trailing.mat-mdc-chip-remove{opacity:calc(var(--mat-chip-trailing-action-opacity, 1)*var(--mdc-chip-with-trailing-icon-disabled-trailing-icon-opacity, 0.38))}.mdc-evolution-chip--disabled .mdc-evolution-chip__icon--trailing.mat-mdc-chip-remove:focus{opacity:calc(var(--mat-chip-trailing-action-focus-opacity, 1)*var(--mdc-chip-with-trailing-icon-disabled-trailing-icon-opacity, 0.38))}.mat-mdc-standard-chip{border-radius:var(--mdc-chip-container-shape-radius, 8px);height:var(--mdc-chip-container-height, 32px)}.mat-mdc-standard-chip:not(.mdc-evolution-chip--disabled){background-color:var(--mdc-chip-elevated-container-color, transparent)}.mat-mdc-standard-chip.mdc-evolution-chip--disabled{background-color:var(--mdc-chip-elevated-disabled-container-color)}.mat-mdc-standard-chip.mdc-evolution-chip--selected:not(.mdc-evolution-chip--disabled){background-color:var(--mdc-chip-elevated-selected-container-color, var(--mat-sys-secondary-container))}.mat-mdc-standard-chip.mdc-evolution-chip--selected.mdc-evolution-chip--disabled{background-color:var(--mdc-chip-flat-disabled-selected-container-color, color-mix(in srgb, var(--mat-sys-on-surface) 12%, transparent))}@media(forced-colors: active){.mat-mdc-standard-chip{outline:solid 1px}}.mat-mdc-standard-chip .mdc-evolution-chip__icon--primary{border-radius:var(--mdc-chip-with-avatar-avatar-shape-radius, 24px);width:var(--mdc-chip-with-icon-icon-size, 18px);height:var(--mdc-chip-with-icon-icon-size, 18px);font-size:var(--mdc-chip-with-icon-icon-size, 18px)}.mdc-evolution-chip--selected .mdc-evolution-chip__icon--primary{opacity:0}.mat-mdc-standard-chip:not(.mdc-evolution-chip--disabled) .mdc-evolution-chip__icon--primary{color:var(--mdc-chip-with-icon-icon-color, var(--mat-sys-on-surface-variant))}.mat-mdc-standard-chip.mdc-evolution-chip--disabled .mdc-evolution-chip__icon--primary{color:var(--mdc-chip-with-icon-disabled-icon-color, var(--mat-sys-on-surface))}.mat-mdc-chip-highlighted{--mdc-chip-with-icon-icon-color:var(--mdc-chip-with-icon-selected-icon-color, var(--mat-sys-on-secondary-container));--mdc-chip-elevated-container-color:var(--mdc-chip-elevated-selected-container-color, var(--mat-sys-secondary-container));--mdc-chip-label-text-color:var(--mdc-chip-selected-label-text-color, var(--mat-sys-on-secondary-container));--mdc-chip-outline-width:var(--mdc-chip-flat-selected-outline-width, 0)}.mat-mdc-chip-focus-overlay{background:var(--mdc-chip-focus-state-layer-color, var(--mat-sys-on-surface-variant))}.mat-mdc-chip-selected .mat-mdc-chip-focus-overlay,.mat-mdc-chip-highlighted .mat-mdc-chip-focus-overlay{background:var(--mdc-chip-selected-focus-state-layer-color, var(--mat-sys-on-secondary-container))}.mat-mdc-chip:hover .mat-mdc-chip-focus-overlay{background:var(--mdc-chip-hover-state-layer-color, var(--mat-sys-on-surface-variant));opacity:var(--mdc-chip-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mat-mdc-chip-focus-overlay .mat-mdc-chip-selected:hover,.mat-mdc-chip-highlighted:hover .mat-mdc-chip-focus-overlay{background:var(--mdc-chip-selected-hover-state-layer-color, var(--mat-sys-on-secondary-container));opacity:var(--mdc-chip-selected-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mat-mdc-chip.cdk-focused .mat-mdc-chip-focus-overlay{background:var(--mdc-chip-focus-state-layer-color, var(--mat-sys-on-surface-variant));opacity:var(--mdc-chip-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mat-mdc-chip-selected.cdk-focused .mat-mdc-chip-focus-overlay,.mat-mdc-chip-highlighted.cdk-focused .mat-mdc-chip-focus-overlay{background:var(--mdc-chip-selected-focus-state-layer-color, var(--mat-sys-on-secondary-container));opacity:var(--mdc-chip-selected-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mdc-evolution-chip--disabled:not(.mdc-evolution-chip--selected) .mat-mdc-chip-avatar{opacity:var(--mdc-chip-with-avatar-disabled-avatar-opacity, 0.38)}.mdc-evolution-chip--disabled .mdc-evolution-chip__icon--trailing{opacity:var(--mdc-chip-with-trailing-icon-disabled-trailing-icon-opacity, 0.38)}.mdc-evolution-chip--disabled.mdc-evolution-chip--selected .mdc-evolution-chip__checkmark{opacity:var(--mdc-chip-with-icon-disabled-icon-opacity, 0.38)}.mat-mdc-standard-chip.mdc-evolution-chip--disabled{opacity:var(--mat-chip-disabled-container-opacity, 1)}.mat-mdc-standard-chip.mdc-evolution-chip--selected .mdc-evolution-chip__icon--trailing,.mat-mdc-standard-chip.mat-mdc-chip-highlighted .mdc-evolution-chip__icon--trailing{color:var(--mat-chip-selected-trailing-icon-color, var(--mat-sys-on-secondary-container))}.mat-mdc-standard-chip.mdc-evolution-chip--selected.mdc-evolution-chip--disabled .mdc-evolution-chip__icon--trailing,.mat-mdc-standard-chip.mat-mdc-chip-highlighted.mdc-evolution-chip--disabled .mdc-evolution-chip__icon--trailing{color:var(--mat-chip-selected-disabled-trailing-icon-color, var(--mat-sys-on-surface))}.mat-mdc-chip-remove{opacity:var(--mat-chip-trailing-action-opacity, 1)}.mat-mdc-chip-remove:focus{opacity:var(--mat-chip-trailing-action-focus-opacity, 1)}.mat-mdc-chip-remove::after{background-color:var(--mat-chip-trailing-action-state-layer-color, var(--mat-sys-on-surface-variant))}.mat-mdc-chip-remove:hover::after{opacity:var(--mat-chip-trailing-action-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mat-mdc-chip-remove:focus::after{opacity:var(--mat-chip-trailing-action-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mat-mdc-chip-selected .mat-mdc-chip-remove::after,.mat-mdc-chip-highlighted .mat-mdc-chip-remove::after{background-color:var(--mat-chip-selected-trailing-action-state-layer-color, var(--mat-sys-on-secondary-container))}.mat-mdc-standard-chip{-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-standard-chip .mdc-evolution-chip__cell--primary,.mat-mdc-standard-chip .mdc-evolution-chip__action--primary,.mat-mdc-standard-chip .mat-mdc-chip-action-label{overflow:visible}.mat-mdc-standard-chip .mat-mdc-chip-graphic,.mat-mdc-standard-chip .mat-mdc-chip-trailing-icon{box-sizing:content-box}.mat-mdc-standard-chip._mat-animation-noopable,.mat-mdc-standard-chip._mat-animation-noopable .mdc-evolution-chip__graphic,.mat-mdc-standard-chip._mat-animation-noopable .mdc-evolution-chip__checkmark,.mat-mdc-standard-chip._mat-animation-noopable .mdc-evolution-chip__checkmark-path{transition-duration:1ms;animation-duration:1ms}.mat-mdc-chip-focus-overlay{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;opacity:0;border-radius:inherit;transition:opacity 150ms linear}._mat-animation-noopable .mat-mdc-chip-focus-overlay{transition:none}.mat-mdc-basic-chip .mat-mdc-chip-focus-overlay{display:none}.mat-mdc-chip .mat-ripple.mat-mdc-chip-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-chip-avatar{text-align:center;line-height:1;color:var(--mdc-chip-with-icon-icon-color, currentColor)}.mat-mdc-chip{position:relative;z-index:0}.mat-mdc-chip-action-label{text-align:left;z-index:1}[dir=rtl] .mat-mdc-chip-action-label{text-align:right}.mat-mdc-chip.mdc-evolution-chip--with-trailing-action .mat-mdc-chip-action-label{position:relative}.mat-mdc-chip-action-label .mat-mdc-chip-primary-focus-indicator{position:absolute;top:0;right:0;bottom:0;left:0;pointer-events:none}.mat-mdc-chip-action-label .mat-focus-indicator::before{margin:calc(calc(var(--mat-focus-indicator-border-width, 3px) + 2px)*-1)}.mat-mdc-chip-remove::before{margin:calc(var(--mat-focus-indicator-border-width, 3px)*-1);left:8px;right:8px}.mat-mdc-chip-remove::after{content:"";display:block;opacity:0;position:absolute;top:-3px;bottom:-3px;left:5px;right:5px;border-radius:50%;box-sizing:border-box;padding:12px;margin:-12px;background-clip:content-box}.mat-mdc-chip-remove .mat-icon{width:18px;height:18px;font-size:18px;box-sizing:content-box}.mat-chip-edit-input{cursor:text;display:inline-block;color:inherit;outline:0}@media(forced-colors: active){.mat-mdc-chip-selected:not(.mat-mdc-chip-multiple){outline-width:3px}}.mat-mdc-chip-action:focus .mat-focus-indicator::before{content:""}\n'],encapsulation:2,changeDetection:0})}return t})(),dE=(()=>{class t{_elementRef=te(Dn);_changeDetectorRef=te(Do);_dir=te(Bc,{optional:!0});_lastDestroyedFocusedChipIndex=null;_keyManager;_destroyed=new Et;_defaultRole="presentation";get chipFocusChanges(){return this._getChipStream(e=>e._onFocus)}get chipDestroyedChanges(){return this._getChipStream(e=>e.destroyed)}get chipRemovedChanges(){return this._getChipStream(e=>e.removed)}get disabled(){return this._disabled}set disabled(e){this._disabled=e,this._syncChipsState()}_disabled=!1;get empty(){return!this._chips||0===this._chips.length}get role(){return this._explicitRole?this._explicitRole:this.empty?null:this._defaultRole}tabIndex=0;set role(e){this._explicitRole=e}_explicitRole=null;get focused(){return this._hasFocusedChip()}_chips;_chipActions=new gs;constructor(){}ngAfterViewInit(){this._setUpFocusManagement(),this._trackChipSetChanges(),this._trackDestroyedFocusedChip()}ngOnDestroy(){this._keyManager?.destroy(),this._chipActions.destroy(),this._destroyed.next(),this._destroyed.complete()}_hasFocusedChip(){return this._chips&&this._chips.some(e=>e._hasFocus())}_syncChipsState(){this._chips?.forEach(e=>{e._chipListDisabled=this._disabled,e._changeDetectorRef.markForCheck()})}focus(){}_handleKeydown(e){this._originatesFromChip(e)&&this._keyManager.onKeydown(e)}_isValidIndex(e){return e>=0&&e<this._chips.length}_allowFocusEscape(){const e=this._elementRef.nativeElement.tabIndex;-1!==e&&(this._elementRef.nativeElement.tabIndex=-1,setTimeout(()=>this._elementRef.nativeElement.tabIndex=e))}_getChipStream(e){return this._chips.changes.pipe(Nc(null),lc(()=>zc(...this._chips.map(e))))}_originatesFromChip(e){let i=e.target;for(;i&&i!==this._elementRef.nativeElement;){if(i.classList.contains("mat-mdc-chip"))return!0;i=i.parentElement}return!1}_setUpFocusManagement(){this._chips.changes.pipe(Nc(this._chips)).subscribe(e=>{const i=[];e.forEach(r=>r._getActions().forEach(l=>i.push(l))),this._chipActions.reset(i),this._chipActions.notifyOnChanges()}),this._keyManager=new pre(this._chipActions).withVerticalOrientation().withHorizontalOrientation(this._dir?this._dir.value:"ltr").withHomeAndEnd().skipPredicate(e=>this._skipPredicate(e)),this.chipFocusChanges.pipe(jr(this._destroyed)).subscribe(({chip:e})=>{const i=e._getSourceAction(document.activeElement);i&&this._keyManager.updateActiveItem(i)}),this._dir?.change.pipe(jr(this._destroyed)).subscribe(e=>this._keyManager.withHorizontalOrientation(e))}_skipPredicate(e){return!e.isInteractive||e.disabled}_trackChipSetChanges(){this._chips.changes.pipe(Nc(null),jr(this._destroyed)).subscribe(()=>{this.disabled&&Promise.resolve().then(()=>this._syncChipsState()),this._redirectDestroyedChipFocus()})}_trackDestroyedFocusedChip(){this.chipDestroyedChanges.pipe(jr(this._destroyed)).subscribe(e=>{const r=this._chips.toArray().indexOf(e.chip);this._isValidIndex(r)&&e.chip._hasFocus()&&(this._lastDestroyedFocusedChipIndex=r)})}_redirectDestroyedChipFocus(){if(null!=this._lastDestroyedFocusedChipIndex){if(this._chips.length){const e=Math.min(this._lastDestroyedFocusedChipIndex,this._chips.length-1),i=this._chips.toArray()[e];i.disabled?1===this._chips.length?this.focus():this._keyManager.setPreviousItemActive():i.focus()}else this.focus();this._lastDestroyedFocusedChipIndex=null}}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=kn({type:t,selectors:[["mat-chip-set"]],contentQueries:function(i,r,l){if(1&i&&ro(l,Yg,5),2&i){let f;Zn(f=Xn())&&(r._chips=f)}},hostAttrs:[1,"mat-mdc-chip-set","mdc-evolution-chip-set"],hostVars:1,hostBindings:function(i,r){1&i&&Tt("keydown",function(f){return r._handleKeydown(f)}),2&i&&ii("role",r.role)},inputs:{disabled:[2,"disabled","disabled",Un],role:"role",tabIndex:[2,"tabIndex","tabIndex",e=>null==e?0:bu(e)]},ngContentSelectors:wP,decls:2,vars:0,consts:[["role","presentation",1,"mdc-evolution-chip-set__chips"]],template:function(i,r){1&i&&(os(),ae(0,"div",0),Fi(1),le())},styles:[".mat-mdc-chip-set{display:flex}.mat-mdc-chip-set:focus{outline:none}.mat-mdc-chip-set .mdc-evolution-chip-set__chips{min-width:100%;margin-left:-8px;margin-right:0}.mat-mdc-chip-set .mdc-evolution-chip{margin:4px 0 4px 8px}[dir=rtl] .mat-mdc-chip-set .mdc-evolution-chip-set__chips{margin-left:0;margin-right:-8px}[dir=rtl] .mat-mdc-chip-set .mdc-evolution-chip{margin-left:0;margin-right:8px}.mdc-evolution-chip-set__chips{display:flex;flex-flow:wrap;min-width:0}.mat-mdc-chip-set-stacked{flex-direction:column;align-items:flex-start}.mat-mdc-chip-set-stacked .mat-mdc-chip{width:100%}.mat-mdc-chip-set-stacked .mdc-evolution-chip__graphic{flex-grow:0}.mat-mdc-chip-set-stacked .mdc-evolution-chip__action--primary{flex-basis:100%;justify-content:start}input.mat-mdc-chip-input{flex:1 0 150px;margin-left:8px}[dir=rtl] input.mat-mdc-chip-input{margin-left:0;margin-right:8px}\n"],encapsulation:2,changeDetection:0})}return t})();class Are{source;value;constructor(n,e){this.source=n,this.value=e}}const kre={provide:Id,useExisting:ur(()=>MP),multi:!0};let MP=(()=>{class t extends dE{_onTouched=()=>{};_onChange=()=>{};_defaultRole="listbox";_defaultOptions=te(qT,{optional:!0});get multiple(){return this._multiple}set multiple(e){this._multiple=e,this._syncListboxProperties()}_multiple=!1;get selected(){const e=this._chips.toArray().filter(i=>i.selected);return this.multiple?e:e[0]}ariaOrientation="horizontal";get selectable(){return this._selectable}set selectable(e){this._selectable=e,this._syncListboxProperties()}_selectable=!0;compareWith=(e,i)=>e===i;required=!1;get hideSingleSelectionIndicator(){return this._hideSingleSelectionIndicator}set hideSingleSelectionIndicator(e){this._hideSingleSelectionIndicator=e,this._syncListboxProperties()}_hideSingleSelectionIndicator=this._defaultOptions?.hideSingleSelectionIndicator??!1;get chipSelectionChanges(){return this._getChipStream(e=>e.selectionChange)}get chipBlurChanges(){return this._getChipStream(e=>e._onBlur)}get value(){return this._value}set value(e){this._chips&&this._chips.length&&this._setSelectionByValue(e,!1),this._value=e}_value;change=new $e;_chips=void 0;ngAfterContentInit(){this._chips.changes.pipe(Nc(null),jr(this._destroyed)).subscribe(()=>{void 0!==this.value&&Promise.resolve().then(()=>{this._setSelectionByValue(this.value,!1)}),this._syncListboxProperties()}),this.chipBlurChanges.pipe(jr(this._destroyed)).subscribe(()=>this._blur()),this.chipSelectionChanges.pipe(jr(this._destroyed)).subscribe(e=>{this.multiple||this._chips.forEach(i=>{i!==e.source&&i._setSelectedState(!1,!1,!1)}),e.isUserInput&&this._propagateChanges()})}focus(){if(this.disabled)return;const e=this._getFirstSelectedChip();e&&!e.disabled?e.focus():this._chips.length>0?this._keyManager.setFirstItemActive():this._elementRef.nativeElement.focus()}writeValue(e){this.value=null!=e?e:void 0}registerOnChange(e){this._onChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e}_setSelectionByValue(e,i=!0){this._clearSelection(),Array.isArray(e)?e.forEach(r=>this._selectValue(r,i)):this._selectValue(e,i)}_blur(){this.disabled||setTimeout(()=>{this.focused||this._markAsTouched()})}_keydown(e){9===e.keyCode&&super._allowFocusEscape()}_markAsTouched(){this._onTouched(),this._changeDetectorRef.markForCheck()}_propagateChanges(){let e=null;e=Array.isArray(this.selected)?this.selected.map(i=>i.value):this.selected?this.selected.value:void 0,this._value=e,this.change.emit(new Are(this,e)),this._onChange(e),this._changeDetectorRef.markForCheck()}_clearSelection(e){this._chips.forEach(i=>{i!==e&&i.deselect()})}_selectValue(e,i){const r=this._chips.find(l=>null!=l.value&&this.compareWith(l.value,e));return r&&(i?r.selectViaInteraction():r.select()),r}_syncListboxProperties(){this._chips&&Promise.resolve().then(()=>{this._chips.forEach(e=>{e._chipListMultiple=this.multiple,e.chipListSelectable=this._selectable,e._chipListHideSingleSelectionIndicator=this.hideSingleSelectionIndicator,e._changeDetectorRef.markForCheck()})})}_getFirstSelectedChip(){return Array.isArray(this.selected)?this.selected.length?this.selected[0]:void 0:this.selected}_skipPredicate(e){return!e.isInteractive}static \u0275fac=(()=>{let e;return function(r){return(e||(e=m(t)))(r||t)}})();static \u0275cmp=kn({type:t,selectors:[["mat-chip-listbox"]],contentQueries:function(i,r,l){if(1&i&&ro(l,DP,5),2&i){let f;Zn(f=Xn())&&(r._chips=f)}},hostAttrs:[1,"mdc-evolution-chip-set","mat-mdc-chip-listbox"],hostVars:10,hostBindings:function(i,r){1&i&&Tt("focus",function(){return r.focus()})("blur",function(){return r._blur()})("keydown",function(f){return r._keydown(f)}),2&i&&(rc("tabIndex",r.disabled||r.empty?-1:r.tabIndex),ii("role",r.role)("aria-required",r.role?r.required:null)("aria-disabled",r.disabled.toString())("aria-multiselectable",r.multiple)("aria-orientation",r.ariaOrientation),Di("mat-mdc-chip-list-disabled",r.disabled)("mat-mdc-chip-list-required",r.required))},inputs:{multiple:[2,"multiple","multiple",Un],ariaOrientation:[0,"aria-orientation","ariaOrientation"],selectable:[2,"selectable","selectable",Un],compareWith:"compareWith",required:[2,"required","required",Un],hideSingleSelectionIndicator:[2,"hideSingleSelectionIndicator","hideSingleSelectionIndicator",Un],value:"value"},outputs:{change:"change"},features:[pi([kre]),Nn],ngContentSelectors:wP,decls:2,vars:0,consts:[["role","presentation",1,"mdc-evolution-chip-set__chips"]],template:function(i,r){1&i&&(os(),ae(0,"div",0),Fi(1),le())},styles:[".mat-mdc-chip-set{display:flex}.mat-mdc-chip-set:focus{outline:none}.mat-mdc-chip-set .mdc-evolution-chip-set__chips{min-width:100%;margin-left:-8px;margin-right:0}.mat-mdc-chip-set .mdc-evolution-chip{margin:4px 0 4px 8px}[dir=rtl] .mat-mdc-chip-set .mdc-evolution-chip-set__chips{margin-left:0;margin-right:-8px}[dir=rtl] .mat-mdc-chip-set .mdc-evolution-chip{margin-left:0;margin-right:8px}.mdc-evolution-chip-set__chips{display:flex;flex-flow:wrap;min-width:0}.mat-mdc-chip-set-stacked{flex-direction:column;align-items:flex-start}.mat-mdc-chip-set-stacked .mat-mdc-chip{width:100%}.mat-mdc-chip-set-stacked .mdc-evolution-chip__graphic{flex-grow:0}.mat-mdc-chip-set-stacked .mdc-evolution-chip__action--primary{flex-basis:100%;justify-content:start}input.mat-mdc-chip-input{flex:1 0 150px;margin-left:8px}[dir=rtl] input.mat-mdc-chip-input{margin-left:0;margin-right:8px}\n"],encapsulation:2,changeDetection:0})}return t})(),TP=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275mod=Er({type:t});static \u0275inj=Ai({providers:[jT,{provide:qT,useValue:{separatorKeyCodes:[13]}}],imports:[Qr,xR,Qr]})}return t})();const Pre=["determinateSpinner"];function Ore(t,n){if(1&t&&(ba(),ae(0,"svg",11),Wt(1,"circle",12),le()),2&t){const e=Lt();ii("viewBox",e._viewBox()),xe(),vu("stroke-dasharray",e._strokeCircumference(),"px")("stroke-dashoffset",e._strokeCircumference()/2,"px")("stroke-width",e._circleStrokeWidth(),"%"),ii("r",e._circleRadius())}}const Fre=new _t("mat-progress-spinner-default-options",{providedIn:"root",factory:function Lre(){return{diameter:cU}}}),cU=100;let rx=(()=>{class t{_elementRef=te(Dn);_noopAnimations;get color(){return this._color||this._defaultColor}set color(e){this._color=e}_color;_defaultColor="primary";_determinateCircle;constructor(){const e=te(wa,{optional:!0}),i=te(Fre);this._noopAnimations="NoopAnimations"===e&&!!i&&!i._forceAnimations,this.mode="mat-spinner"===this._elementRef.nativeElement.nodeName.toLowerCase()?"indeterminate":"determinate",i&&(i.color&&(this.color=this._defaultColor=i.color),i.diameter&&(this.diameter=i.diameter),i.strokeWidth&&(this.strokeWidth=i.strokeWidth))}mode;get value(){return"determinate"===this.mode?this._value:0}set value(e){this._value=Math.max(0,Math.min(100,e||0))}_value=0;get diameter(){return this._diameter}set diameter(e){this._diameter=e||0}_diameter=cU;get strokeWidth(){return this._strokeWidth??this.diameter/10}set strokeWidth(e){this._strokeWidth=e||0}_strokeWidth;_circleRadius(){return(this.diameter-10)/2}_viewBox(){const e=2*this._circleRadius()+this.strokeWidth;return`0 0 ${e} ${e}`}_strokeCircumference(){return 2*Math.PI*this._circleRadius()}_strokeDashOffset(){return"determinate"===this.mode?this._strokeCircumference()*(100-this._value)/100:null}_circleStrokeWidth(){return this.strokeWidth/this.diameter*100}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=kn({type:t,selectors:[["mat-progress-spinner"],["mat-spinner"]],viewQuery:function(i,r){if(1&i&&kr(Pre,5),2&i){let l;Zn(l=Xn())&&(r._determinateCircle=l.first)}},hostAttrs:["role","progressbar","tabindex","-1",1,"mat-mdc-progress-spinner","mdc-circular-progress"],hostVars:18,hostBindings:function(i,r){2&i&&(ii("aria-valuemin",0)("aria-valuemax",100)("aria-valuenow","determinate"===r.mode?r.value:null)("mode",r.mode),Kf("mat-"+r.color),vu("width",r.diameter,"px")("height",r.diameter,"px")("--mdc-circular-progress-size",r.diameter+"px")("--mdc-circular-progress-active-indicator-width",r.diameter+"px"),Di("_mat-animation-noopable",r._noopAnimations)("mdc-circular-progress--indeterminate","indeterminate"===r.mode))},inputs:{color:"color",mode:"mode",value:[2,"value","value",bu],diameter:[2,"diameter","diameter",bu],strokeWidth:[2,"strokeWidth","strokeWidth",bu]},exportAs:["matProgressSpinner"],decls:14,vars:11,consts:[["circle",""],["determinateSpinner",""],["aria-hidden","true",1,"mdc-circular-progress__determinate-container"],["xmlns","http://www.w3.org/2000/svg","focusable","false",1,"mdc-circular-progress__determinate-circle-graphic"],["cx","50%","cy","50%",1,"mdc-circular-progress__determinate-circle"],["aria-hidden","true",1,"mdc-circular-progress__indeterminate-container"],[1,"mdc-circular-progress__spinner-layer"],[1,"mdc-circular-progress__circle-clipper","mdc-circular-progress__circle-left"],[3,"ngTemplateOutlet"],[1,"mdc-circular-progress__gap-patch"],[1,"mdc-circular-progress__circle-clipper","mdc-circular-progress__circle-right"],["xmlns","http://www.w3.org/2000/svg","focusable","false",1,"mdc-circular-progress__indeterminate-circle-graphic"],["cx","50%","cy","50%"]],template:function(i,r){if(1&i&&(vt(0,Ore,2,8,"ng-template",null,0,q1),ae(2,"div",2,1),ba(),ae(4,"svg",3),Wt(5,"circle",4),le()(),hr(),ae(6,"div",5)(7,"div",6)(8,"div",7),ia(9,8),le(),ae(10,"div",9),ia(11,8),le(),ae(12,"div",10),ia(13,8),le()()()),2&i){const l=Ed(1);xe(4),ii("viewBox",r._viewBox()),xe(),vu("stroke-dasharray",r._strokeCircumference(),"px")("stroke-dashoffset",r._strokeDashOffset(),"px")("stroke-width",r._circleStrokeWidth(),"%"),ii("r",r._circleRadius()),xe(4),Xe("ngTemplateOutlet",l),xe(2),Xe("ngTemplateOutlet",l),xe(2),Xe("ngTemplateOutlet",l)}},dependencies:[n2],styles:[".mat-mdc-progress-spinner{display:block;overflow:hidden;line-height:0;position:relative;direction:ltr;transition:opacity 250ms cubic-bezier(0.4, 0, 0.6, 1)}.mat-mdc-progress-spinner circle{stroke-width:var(--mdc-circular-progress-active-indicator-width, 4px)}.mat-mdc-progress-spinner._mat-animation-noopable,.mat-mdc-progress-spinner._mat-animation-noopable .mdc-circular-progress__determinate-circle{transition:none !important}.mat-mdc-progress-spinner._mat-animation-noopable .mdc-circular-progress__indeterminate-circle-graphic,.mat-mdc-progress-spinner._mat-animation-noopable .mdc-circular-progress__spinner-layer,.mat-mdc-progress-spinner._mat-animation-noopable .mdc-circular-progress__indeterminate-container{animation:none !important}.mat-mdc-progress-spinner._mat-animation-noopable .mdc-circular-progress__indeterminate-container circle{stroke-dasharray:0 !important}@media(forced-colors: active){.mat-mdc-progress-spinner .mdc-circular-progress__indeterminate-circle-graphic,.mat-mdc-progress-spinner .mdc-circular-progress__determinate-circle{stroke:currentColor;stroke:CanvasText}}.mdc-circular-progress__determinate-container,.mdc-circular-progress__indeterminate-circle-graphic,.mdc-circular-progress__indeterminate-container,.mdc-circular-progress__spinner-layer{position:absolute;width:100%;height:100%}.mdc-circular-progress__determinate-container{transform:rotate(-90deg)}.mdc-circular-progress--indeterminate .mdc-circular-progress__determinate-container{opacity:0}.mdc-circular-progress__indeterminate-container{font-size:0;letter-spacing:0;white-space:nowrap;opacity:0}.mdc-circular-progress--indeterminate .mdc-circular-progress__indeterminate-container{opacity:1;animation:mdc-circular-progress-container-rotate 1568.2352941176ms linear infinite}.mdc-circular-progress__determinate-circle-graphic,.mdc-circular-progress__indeterminate-circle-graphic{fill:rgba(0,0,0,0)}.mat-mdc-progress-spinner .mdc-circular-progress__determinate-circle,.mat-mdc-progress-spinner .mdc-circular-progress__indeterminate-circle-graphic{stroke:var(--mdc-circular-progress-active-indicator-color, var(--mat-sys-primary))}@media(forced-colors: active){.mat-mdc-progress-spinner .mdc-circular-progress__determinate-circle,.mat-mdc-progress-spinner .mdc-circular-progress__indeterminate-circle-graphic{stroke:CanvasText}}.mdc-circular-progress__determinate-circle{transition:stroke-dashoffset 500ms cubic-bezier(0, 0, 0.2, 1)}.mdc-circular-progress__gap-patch{position:absolute;top:0;left:47.5%;box-sizing:border-box;width:5%;height:100%;overflow:hidden}.mdc-circular-progress__gap-patch .mdc-circular-progress__indeterminate-circle-graphic{left:-900%;width:2000%;transform:rotate(180deg)}.mdc-circular-progress__circle-clipper .mdc-circular-progress__indeterminate-circle-graphic{width:200%}.mdc-circular-progress__circle-right .mdc-circular-progress__indeterminate-circle-graphic{left:-100%}.mdc-circular-progress--indeterminate .mdc-circular-progress__circle-left .mdc-circular-progress__indeterminate-circle-graphic{animation:mdc-circular-progress-left-spin 1333ms cubic-bezier(0.4, 0, 0.2, 1) infinite both}.mdc-circular-progress--indeterminate .mdc-circular-progress__circle-right .mdc-circular-progress__indeterminate-circle-graphic{animation:mdc-circular-progress-right-spin 1333ms cubic-bezier(0.4, 0, 0.2, 1) infinite both}.mdc-circular-progress__circle-clipper{display:inline-flex;position:relative;width:50%;height:100%;overflow:hidden}.mdc-circular-progress--indeterminate .mdc-circular-progress__spinner-layer{animation:mdc-circular-progress-spinner-layer-rotate 5332ms cubic-bezier(0.4, 0, 0.2, 1) infinite both}@keyframes mdc-circular-progress-container-rotate{to{transform:rotate(360deg)}}@keyframes mdc-circular-progress-spinner-layer-rotate{12.5%{transform:rotate(135deg)}25%{transform:rotate(270deg)}37.5%{transform:rotate(405deg)}50%{transform:rotate(540deg)}62.5%{transform:rotate(675deg)}75%{transform:rotate(810deg)}87.5%{transform:rotate(945deg)}100%{transform:rotate(1080deg)}}@keyframes mdc-circular-progress-left-spin{from{transform:rotate(265deg)}50%{transform:rotate(130deg)}to{transform:rotate(265deg)}}@keyframes mdc-circular-progress-right-spin{from{transform:rotate(-265deg)}50%{transform:rotate(-130deg)}to{transform:rotate(-265deg)}}\n"],encapsulation:2,changeDetection:0})}return t})(),uE=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275mod=Er({type:t});static \u0275inj=Ai({imports:[Qr]})}return t})();const zre=()=>[5,10,25],Bre=(t,n,e,i)=>({"status-pending":t,"status-rejected":n,"status-verified":e,"status-resolved":i});function Vre(t,n){if(1&t&&(ae(0,"mat-option",8),Re(1),le()),2&t){const e=n.$implicit;Xe("value",e),xe(),Ci(" ",e," ")}}function Ure(t,n){1&t&&(ae(0,"div",9),Wt(1,"mat-spinner",10),le())}function jre(t,n){1&t&&(ae(0,"th",25),Re(1,"T\xedtulo"),le())}function Hre(t,n){if(1&t&&(ae(0,"td",26),Re(1),le()),2&t){const e=n.$implicit;xe(),er(e.title)}}function $re(t,n){1&t&&(ae(0,"th",25),Re(1,"Descripci\xf3n"),le())}function Gre(t,n){if(1&t&&(ae(0,"td",26),Re(1),le()),2&t){const e=n.$implicit;xe(),er(e.description)}}function qre(t,n){1&t&&(ae(0,"th",25),Re(1,"Categor\xedas"),le())}function Wre(t,n){if(1&t&&(ae(0,"mat-chip"),Re(1),le()),2&t){const e=n.$implicit;xe(),er(e.name)}}function Yre(t,n){if(1&t&&(ae(0,"td",26)(1,"mat-chip-set"),vt(2,Wre,2,1,"mat-chip",27),le()()),2&t){const e=n.$implicit;xe(2),Xe("ngForOf",e.categoryList)}}function Zre(t,n){1&t&&(ae(0,"th",25),Re(1,"Ubicaci\xf3n"),le())}function Xre(t,n){if(1&t&&(ae(0,"td",26),Re(1),le()),2&t){const e=n.$implicit;xe(),Py(" ",e.latitude,", ",e.longitude," ")}}function Kre(t,n){1&t&&(ae(0,"th",25),Re(1,"Estado"),le())}function Qre(t,n){if(1&t&&(ae(0,"td",26)(1,"span",28),Re(2),le()()),2&t){const e=n.$implicit;xe(),Xe("ngClass",vk(2,Bre,"PENDING"===e.reportStatus,"REJECTED"===e.reportStatus,"VERIFIED"===e.reportStatus,"RESOLVED"===e.reportStatus)),xe(),Ci(" ",e.reportStatus," ")}}function Jre(t,n){1&t&&(ae(0,"th",25),Re(1,"Fecha Creaci\xf3n"),le())}function eoe(t,n){if(1&t&&(ae(0,"td",26),Re(1),Jf(2,"date"),le()),2&t){const e=n.$implicit;xe(),Ci(" ",S0(2,1,e.createdAt,"short")," ")}}function toe(t,n){1&t&&(ae(0,"th",25),Re(1,"Votos"),le())}function noe(t,n){if(1&t&&(ae(0,"td",26),Re(1),le()),2&t){const e=n.$implicit;xe(),er(e.importantVotes)}}function ioe(t,n){1&t&&(ae(0,"th",25),Re(1,"Acciones"),le())}function roe(t,n){if(1&t){const e=_i();Qi(0),ae(1,"button",29),Tt("click",function(){on(e);const r=Lt().$implicit;return ln(Lt(2).verifyReport(r.id))}),ae(2,"mat-icon"),Re(3,"check"),le(),Re(4," Verificar "),le(),ae(5,"button",30),Tt("click",function(){on(e);const r=Lt().$implicit;return ln(Lt(2).rejectReport(r.id))}),ae(6,"mat-icon"),Re(7,"close"),le(),Re(8," Rechazar "),le(),Ji()}}function ooe(t,n){if(1&t){const e=_i();Qi(0),ae(1,"button",29),Tt("click",function(){on(e);const r=Lt().$implicit;return ln(Lt(2).verifyReport(r.id))}),ae(2,"mat-icon"),Re(3,"check"),le(),Re(4," Verificar "),le(),Ji()}}function soe(t,n){if(1&t){const e=_i();Qi(0),ae(1,"button",31),Tt("click",function(){on(e);const r=Lt().$implicit;return ln(Lt(2).resolveReport(r.id))}),ae(2,"mat-icon"),Re(3,"done_all"),le(),Re(4," Resolver "),le(),Ji()}}function aoe(t,n){if(1&t&&(ae(0,"td",26),vt(1,roe,9,0,"ng-container",7)(2,ooe,5,0,"ng-container",7)(3,soe,5,0,"ng-container",7),le()),2&t){const e=n.$implicit;xe(),Xe("ngIf","PENDING"===e.reportStatus),xe(),Xe("ngIf","REJECTED"===e.reportStatus),xe(),Xe("ngIf","VERIFIED"===e.reportStatus)}}function loe(t,n){1&t&&Wt(0,"tr",32)}function coe(t,n){1&t&&Wt(0,"tr",33)}function doe(t,n){if(1&t){const e=_i();ae(0,"div")(1,"table",11),Qi(2,12),vt(3,jre,2,0,"th",13)(4,Hre,2,1,"td",14),Ji(),Qi(5,15),vt(6,$re,2,0,"th",13)(7,Gre,2,1,"td",14),Ji(),Qi(8,16),vt(9,qre,2,0,"th",13)(10,Yre,3,1,"td",14),Ji(),Qi(11,17),vt(12,Zre,2,0,"th",13)(13,Xre,2,2,"td",14),Ji(),Qi(14,18),vt(15,Kre,2,0,"th",13)(16,Qre,3,7,"td",14),Ji(),Qi(17,19),vt(18,Jre,2,0,"th",13)(19,eoe,3,4,"td",14),Ji(),Qi(20,20),vt(21,toe,2,0,"th",13)(22,noe,2,1,"td",14),Ji(),Qi(23,21),vt(24,ioe,2,0,"th",13)(25,aoe,4,3,"td",14),Ji(),vt(26,loe,1,0,"tr",22)(27,coe,1,0,"tr",23),le(),ae(28,"mat-paginator",24),Tt("page",function(r){return on(e),ln(Lt().onPageChange(r))}),le()()}if(2&t){const e=Lt();xe(),Xe("dataSource",e.filteredContent()),xe(25),Xe("matHeaderRowDef",e.displayedColumns),xe(),Xe("matRowDefColumns",e.displayedColumns),xe(),Xe("length",e.paginatedData().totalElements)("pageSize",e.paginatedData().size)("pageIndex",e.paginatedData().page-1)("pageSizeOptions",HD(7,zre))}}let ox,uoe=(()=>{class t{reportService=te(q0);notificationService=te(Uc);dialog=te(Vg);loading=wr(!1);paginatedData=wr({content:[],page:0,size:10,totalElements:0,totalPages:0});router=te(oo);statuses=["PENDING","VERIFIED","REJECTED","RESOLVED"];selectedStatus=wr("");filteredContent=Sd(()=>{const e=this.paginatedData().content,i=this.selectedStatus();return i?e.filter(r=>r.reportStatus===i):e});displayedColumns=["title","description","categories","location","reportStatus","dateCreation","importantVotes","actions"];ngOnInit(){this.loadReports(1,10)}loadReports(e,i,r=""){this.loading.set(!0),this.reportService.getAllReportsPaginated(e,i,r).subscribe({next:l=>this.paginatedData.set(l),error:l=>{},complete:()=>this.loading.set(!1)})}verifyReport(e){e&&this.dialog.open(Gg,{data:{title:"Verificar reporte",message:"\xbfSeguro que deseas verificar este reporte?",confirmText:"Verificar",cancelText:"Cancelar"}}).afterClosed().subscribe(r=>{!0===r&&this.reportService.updateReportStatus(e,"VERIFIED").subscribe({next:()=>{this.notificationService.success("\u2705 Reporte verificado correctamente."),this.loadReports(1,10)},error:l=>{console.error("\u274c Error al verificar reporte:",l),this.notificationService.error("Ocurri\xf3 un error al verificar el reporte.")}})})}rejectReport(e){e&&this.dialog.open(Gg,{data:{title:"Rechazar reporte",message:"Por favor, indica el motivo del rechazo:",confirmText:"Rechazar",cancelText:"Cancelar",input:!0,inputPlaceholder:"Motivo de rechazo\u2026"}}).afterClosed().subscribe(r=>{"string"==typeof r&&this.reportService.updateReportStatus(e,"REJECTED",r).subscribe({next:()=>{this.notificationService.success("\u2705 Reporte rechazado correctamente."),this.loadReports(1,10)},error:l=>{console.error("\u274c Error al rechazar reporte:",l),this.notificationService.error("Ocurri\xf3 un error al rechazar el reporte.")}})})}resolveReport(e){e&&this.dialog.open(Gg,{data:{title:"Resolver reporte",message:"\xbfDeseas marcar este reporte como resuelto?",confirmText:"Resolver",cancelText:"Cancelar"}}).afterClosed().subscribe(r=>{!0===r&&this.reportService.updateReportStatus(e,"RESOLVED").subscribe({next:()=>{this.notificationService.success("\u2705 Reporte marcado como resuelto."),this.loadReports(1,10)},error:l=>{console.error("\u274c Error al resolver reporte:",l),this.notificationService.error("Ocurri\xf3 un error al resolver el reporte.")}})})}onPageChange(e){this.loadReports(e.pageIndex+1,e.pageSize,this.selectedStatus())}onStatusChange(e){this.selectedStatus.set(e),this.loadReports(1,this.paginatedData().size,e)}goBack(){this.router.navigate(["/map"])}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=kn({type:t,selectors:[["app-report-list"]],decls:16,vars:4,consts:[["mat-icon-button","","aria-label","Volver",1,"back-button",3,"click"],[1,"contenedor"],["appearance","outline",1,"status-filter"],[3,"selectionChange","value"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","loading-container",4,"ngIf"],[4,"ngIf"],[3,"value"],[1,"loading-container"],["diameter","50"],["mat-table","",1,"mat-elevation-z8",3,"dataSource"],["matColumnDef","title"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","description"],["matColumnDef","categories"],["matColumnDef","location"],["matColumnDef","reportStatus"],["matColumnDef","dateCreation"],["matColumnDef","importantVotes"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["aria-label","Seleccionar p\xe1gina",3,"page","length","pageSize","pageIndex","pageSizeOptions"],["mat-header-cell",""],["mat-cell",""],[4,"ngFor","ngForOf"],[3,"ngClass"],["mat-raised-button","","color","primary",1,"action-button",3,"click"],["mat-raised-button","","color","warn",1,"action-button",3,"click"],["mat-raised-button","","color","accent",1,"action-button",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(i,r){1&i&&(ae(0,"button",0),Tt("click",function(){return r.goBack()}),ae(1,"mat-icon"),Re(2,"arrow_back"),le()(),ae(3,"mat-card",1)(4,"h1"),Re(5,"Listado de reportes"),le(),Wt(6,"mat-divider"),ae(7,"mat-form-field",2)(8,"mat-label"),Re(9,"Filtrar por estado"),le(),ae(10,"mat-select",3),Tt("selectionChange",function(f){return r.onStatusChange(f.value)}),ae(11,"mat-option",4),Re(12,"Todos"),le(),vt(13,Vre,2,2,"mat-option",5),le()(),vt(14,Ure,2,0,"div",6)(15,doe,29,8,"div",7),le()),2&i&&(xe(10),Xe("value",r.selectedStatus()),xe(3),Xe("ngForOf",r.statuses),xe(),Xe("ngIf",r.loading()),xe(),Xe("ngIf",!r.loading()))},dependencies:[Ea,im,kg,Os,I0,Wg,tx,ex,sE,HT,oE,uE,rx,NT,JC,X0,eE,K0,Z0,tE,Q0,J0,nE,iE,yP,GT,nx,lv,xP,iU,TP,Yg,dE,Up,kd],styles:["[_ngcontent-%COMP%]:root{--primary-bg: #e0f4fa;--primary-accent: #79b4d8;--primary-dark: #1e3a5f;--input-bg: #ffffff;--error-color: #e74c3c;--resolve-color: #26a69a;--table-header-bg: #d0eaf5;--table-row-hover: #f2faff}mat-card[_ngcontent-%COMP%]{margin:2rem auto;padding:1.5rem;background:var(--input-bg);box-shadow:0 4px 20px #0000001a;border-radius:12px}mat-card[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin-bottom:.5rem;color:var(--primary-dark);font-weight:600;font-size:24px}.status-filter[_ngcontent-%COMP%]{width:250px;margin:1.5rem 0}.loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:50px 0}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;background-color:#fff;border-radius:8px;overflow:hidden;box-shadow:0 2px 8px #0000000d}th.mat-header-cell[_ngcontent-%COMP%]{background-color:var(--table-header-bg);color:var(--primary-dark);font-weight:600;padding:12px;border-bottom:1px solid #ccc}td.mat-cell[_ngcontent-%COMP%]{padding:12px 16px;color:#333;border-bottom:1px solid #eee}tr.mat-row[_ngcontent-%COMP%]:hover{background-color:var(--table-row-hover);transition:background-color .2s ease-in-out}mat-chip[_ngcontent-%COMP%]{background-color:var(--primary-accent);color:#fff;font-weight:500;margin-right:5px}.status-pending[_ngcontent-%COMP%], .status-rejected[_ngcontent-%COMP%], .status-verified[_ngcontent-%COMP%], .status-resolved[_ngcontent-%COMP%]{display:inline-block;padding:6px 10px;border-radius:4px;font-weight:600;font-size:13px}.status-pending[_ngcontent-%COMP%]{background-color:#fff59d;color:#444}.status-rejected[_ngcontent-%COMP%]{background-color:#ef9a9a;color:#fff}.status-verified[_ngcontent-%COMP%]{background-color:#a5d6a7;color:#fff}.status-resolved[_ngcontent-%COMP%]{background-color:#81d4fa;color:#fff}td.mat-cell[_ngcontent-%COMP%] > ng-container[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:8px 0}.action-button[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;gap:6px;height:36px;width:120px;padding:0 12px;font-size:13px;font-weight:500;line-height:1;border-radius:6px;box-shadow:0 2px 4px #0000001a;text-transform:none;box-sizing:border-box;transition:background-color .2s ease,box-shadow .2s ease}.action-button[color=primary][_ngcontent-%COMP%]{background-color:var(--primary-accent);color:#000}.action-button[color=primary][_ngcontent-%COMP%]:hover{background-color:#1e8e81;box-shadow:0 3px 6px #00000026;color:#fff}.action-button[color=warn][_ngcontent-%COMP%]{background-color:var(--error-color);color:#000}.action-button[color=warn][_ngcontent-%COMP%]:hover{background-color:#ac1e08;color:#fff}.action-button[color=accent][_ngcontent-%COMP%]{background-color:var(--resolve-color);color:#000}.action-button[color=accent][_ngcontent-%COMP%]:hover{background-color:#5fa2c9;color:#fff}.action-button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;line-height:1}mat-paginator[_ngcontent-%COMP%]{margin-top:1.5rem;background:transparent}.back-button[_ngcontent-%COMP%]{position:fixed;top:16px;left:16px;z-index:1000;width:40px;height:40px;padding:0;background-color:#fff;border:1px solid #ccc;border-radius:8px;box-shadow:0 4px 12px #0000000d;display:flex;align-items:center;justify-content:center;transition:background-color .2s ease,transform .1s ease}.back-button[_ngcontent-%COMP%]:hover{background-color:#f9f9f9;transform:translate(-2px)}.back-button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;color:#0009}"]})}return t})();const dU=["color","button","checkbox","date","datetime-local","email","file","hidden","image","month","number","password","radio","range","reset","search","submit","tel","text","time","url","week"];function uU(){if(ox)return ox;if("object"!=typeof document||!document)return ox=new Set(dU),ox;let t=document.createElement("input");return ox=new Set(dU.filter(n=>(t.setAttribute("type",n),t.type===n))),ox}let hoe=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275cmp=kn({type:t,selectors:[["ng-component"]],hostAttrs:["cdk-text-field-style-loader",""],decls:0,vars:0,template:function(i,r){},styles:["textarea.cdk-textarea-autosize{resize:none}textarea.cdk-textarea-autosize-measuring{padding:2px 0 !important;box-sizing:content-box !important;height:auto !important;overflow:hidden !important}textarea.cdk-textarea-autosize-measuring-firefox{padding:2px 0 !important;box-sizing:content-box !important;height:0 !important}@keyframes cdk-text-field-autofill-start{/*!*/}@keyframes cdk-text-field-autofill-end{/*!*/}.cdk-text-field-autofill-monitored:-webkit-autofill{animation:cdk-text-field-autofill-start 0s 1ms}.cdk-text-field-autofill-monitored:not(:-webkit-autofill){animation:cdk-text-field-autofill-end 0s 1ms}\n"],encapsulation:2,changeDetection:0})}return t})();const poe={passive:!0};let foe=(()=>{class t{_platform=te(xs);_ngZone=te(wt);_renderer=te(gt).createRenderer(null,null);_styleLoader=te(cc);_monitoredElements=new Map;constructor(){}monitor(e){if(!this._platform.isBrowser)return Md;this._styleLoader.load(hoe);const i=Bg(e),r=this._monitoredElements.get(i);if(r)return r.subject;const l=new Et,f="cdk-text-field-autofilled",w=P=>{"cdk-text-field-autofill-start"!==P.animationName||i.classList.contains(f)?"cdk-text-field-autofill-end"===P.animationName&&i.classList.contains(f)&&(i.classList.remove(f),this._ngZone.run(()=>l.next({target:P.target,isAutofilled:!1}))):(i.classList.add(f),this._ngZone.run(()=>l.next({target:P.target,isAutofilled:!0})))},M=this._ngZone.runOutsideAngular(()=>(i.classList.add("cdk-text-field-autofill-monitored"),Rl(this._renderer,i,"animationstart",w,poe)));return this._monitoredElements.set(i,{subject:l,unlisten:M}),l}stopMonitoring(e){const i=Bg(e),r=this._monitoredElements.get(i);r&&(r.unlisten(),r.subject.complete(),i.classList.remove("cdk-text-field-autofill-monitored"),i.classList.remove("cdk-text-field-autofilled"),this._monitoredElements.delete(i))}ngOnDestroy(){this._monitoredElements.forEach((e,i)=>this.stopMonitoring(i))}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),moe=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275mod=Er({type:t});static \u0275inj=Ai({})}return t})();const hU=new _t("MAT_INPUT_VALUE_ACCESSOR"),goe=["button","checkbox","file","hidden","image","radio","range","reset","submit"],_oe=new _t("MAT_INPUT_CONFIG");let IP=(()=>{class t{_elementRef=te(Dn);_platform=te(xs);ngControl=te(Ih,{optional:!0,self:!0});_autofillMonitor=te(foe);_ngZone=te(wt);_formField=te(rE,{optional:!0});_renderer=te(yt);_uid=te(Sa).getId("mat-input-");_previousNativeValue;_inputValueAccessor;_signalBasedValueAccessor;_previousPlaceholder;_errorStateTracker;_config=te(_oe,{optional:!0});_cleanupIosKeyup;_cleanupWebkitWheel;_formFieldDescribedBy;_isServer;_isNativeSelect;_isTextarea;_isInFormField;focused=!1;stateChanges=new Et;controlType="mat-input";autofilled=!1;get disabled(){return this._disabled}set disabled(e){this._disabled=qg(e),this.focused&&(this.focused=!1,this.stateChanges.next())}_disabled=!1;get id(){return this._id}set id(e){this._id=e||this._uid}_id;placeholder;name;get required(){return this._required??this.ngControl?.control?.hasValidator(bn.required)??!1}set required(e){this._required=qg(e)}_required;get type(){return this._type}set type(e){const i=this._type;this._type=e||"text",this._validateType(),!this._isTextarea&&uU().has(this._type)&&(this._elementRef.nativeElement.type=this._type),this._type!==i&&this._ensureWheelDefaultBehavior()}_type="text";get errorStateMatcher(){return this._errorStateTracker.matcher}set errorStateMatcher(e){this._errorStateTracker.matcher=e}userAriaDescribedBy;get value(){return this._signalBasedValueAccessor?this._signalBasedValueAccessor.value():this._inputValueAccessor.value}set value(e){e!==this.value&&(this._signalBasedValueAccessor?this._signalBasedValueAccessor.value.set(e):this._inputValueAccessor.value=e,this.stateChanges.next())}get readonly(){return this._readonly}set readonly(e){this._readonly=qg(e)}_readonly=!1;disabledInteractive;get errorState(){return this._errorStateTracker.errorState}set errorState(e){this._errorStateTracker.errorState=e}_neverEmptyInputTypes=["date","datetime","datetime-local","month","time","week"].filter(e=>uU().has(e));constructor(){const e=te(tv,{optional:!0}),i=te(el,{optional:!0}),r=te(jT),l=te(hU,{optional:!0,self:!0}),f=this._elementRef.nativeElement,w=f.nodeName.toLowerCase();l?Gr(l.value)?this._signalBasedValueAccessor=l:this._inputValueAccessor=l:this._inputValueAccessor=f,this._previousNativeValue=this.value,this.id=this.id,this._platform.IOS&&this._ngZone.runOutsideAngular(()=>{this._cleanupIosKeyup=this._renderer.listen(f,"keyup",this._iOSKeyupListener)}),this._errorStateTracker=new _P(r,this.ngControl,i,e,this.stateChanges),this._isServer=!this._platform.isBrowser,this._isNativeSelect="select"===w,this._isTextarea="textarea"===w,this._isInFormField=!!this._formField,this.disabledInteractive=this._config?.disabledInteractive||!1,this._isNativeSelect&&(this.controlType=f.multiple?"mat-native-select-multiple":"mat-native-select"),this._signalBasedValueAccessor&&tM(()=>{this._signalBasedValueAccessor.value(),this.stateChanges.next()})}ngAfterViewInit(){this._platform.isBrowser&&this._autofillMonitor.monitor(this._elementRef.nativeElement).subscribe(e=>{this.autofilled=e.isAutofilled,this.stateChanges.next()})}ngOnChanges(){this.stateChanges.next()}ngOnDestroy(){this.stateChanges.complete(),this._platform.isBrowser&&this._autofillMonitor.stopMonitoring(this._elementRef.nativeElement),this._cleanupIosKeyup?.(),this._cleanupWebkitWheel?.()}ngDoCheck(){this.ngControl&&(this.updateErrorState(),null!==this.ngControl.disabled&&this.ngControl.disabled!==this.disabled&&(this.disabled=this.ngControl.disabled,this.stateChanges.next())),this._dirtyCheckNativeValue(),this._dirtyCheckPlaceholder()}focus(e){this._elementRef.nativeElement.focus(e)}updateErrorState(){this._errorStateTracker.updateErrorState()}_focusChanged(e){if(e!==this.focused){if(!this._isNativeSelect&&e&&this.disabled&&this.disabledInteractive){const i=this._elementRef.nativeElement;"number"===i.type?(i.type="text",i.setSelectionRange(0,0),i.type="number"):i.setSelectionRange(0,0)}this.focused=e,this.stateChanges.next()}}_onInput(){}_dirtyCheckNativeValue(){const e=this._elementRef.nativeElement.value;this._previousNativeValue!==e&&(this._previousNativeValue=e,this.stateChanges.next())}_dirtyCheckPlaceholder(){const e=this._getPlaceholder();if(e!==this._previousPlaceholder){const i=this._elementRef.nativeElement;this._previousPlaceholder=e,e?i.setAttribute("placeholder",e):i.removeAttribute("placeholder")}}_getPlaceholder(){return this.placeholder||null}_validateType(){goe.indexOf(this._type)}_isNeverEmpty(){return this._neverEmptyInputTypes.indexOf(this._type)>-1}_isBadInput(){let e=this._elementRef.nativeElement.validity;return e&&e.badInput}get empty(){return!(this._isNeverEmpty()||this._elementRef.nativeElement.value||this._isBadInput()||this.autofilled)}get shouldLabelFloat(){if(this._isNativeSelect){const e=this._elementRef.nativeElement,i=e.options[0];return this.focused||e.multiple||!this.empty||!!(e.selectedIndex>-1&&i&&i.label)}return this.focused&&!this.disabled||!this.empty}setDescribedByIds(e){const i=this._elementRef.nativeElement,r=i.getAttribute("aria-describedby");let l;if(r){const f=this._formFieldDescribedBy||e;l=e.concat(r.split(" ").filter(w=>w&&!f.includes(w)))}else l=e;this._formFieldDescribedBy=e,l.length?i.setAttribute("aria-describedby",l.join(" ")):i.removeAttribute("aria-describedby")}onContainerClick(){this.focused||this.focus()}_isInlineSelect(){const e=this._elementRef.nativeElement;return this._isNativeSelect&&(e.multiple||e.size>1)}_iOSKeyupListener=e=>{const i=e.target;!i.value&&0===i.selectionStart&&0===i.selectionEnd&&(i.setSelectionRange(1,1),i.setSelectionRange(0,0))};_webkitBlinkWheelListener=()=>{};_ensureWheelDefaultBehavior(){this._cleanupWebkitWheel?.(),"number"===this._type&&(this._platform.BLINK||this._platform.WEBKIT)&&(this._cleanupWebkitWheel=this._renderer.listen(this._elementRef.nativeElement,"wheel",this._webkitBlinkWheelListener))}_getReadonlyAttribute(){return this._isNativeSelect?null:this.readonly||this.disabled&&this.disabledInteractive?"true":null}static \u0275fac=function(i){return new(i||t)};static \u0275dir=Ht({type:t,selectors:[["input","matInput",""],["textarea","matInput",""],["select","matNativeControl",""],["input","matNativeControl",""],["textarea","matNativeControl",""]],hostAttrs:[1,"mat-mdc-input-element"],hostVars:21,hostBindings:function(i,r){1&i&&Tt("focus",function(){return r._focusChanged(!0)})("blur",function(){return r._focusChanged(!1)})("input",function(){return r._onInput()}),2&i&&(rc("id",r.id)("disabled",r.disabled&&!r.disabledInteractive)("required",r.required),ii("name",r.name||null)("readonly",r._getReadonlyAttribute())("aria-disabled",r.disabled&&r.disabledInteractive?"true":null)("aria-invalid",r.empty&&r.required?null:r.errorState)("aria-required",r.required)("id",r.id),Di("mat-input-server",r._isServer)("mat-mdc-form-field-textarea-control",r._isInFormField&&r._isTextarea)("mat-mdc-form-field-input-control",r._isInFormField)("mat-mdc-input-disabled-interactive",r.disabledInteractive)("mdc-text-field__input",r._isInFormField)("mat-mdc-native-select-inline",r._isInlineSelect()))},inputs:{disabled:"disabled",id:"id",placeholder:"placeholder",name:"name",required:"required",type:"type",errorStateMatcher:"errorStateMatcher",userAriaDescribedBy:[0,"aria-describedby","userAriaDescribedBy"],value:"value",readonly:"readonly",disabledInteractive:[2,"disabledInteractive","disabledInteractive",Un]},exportAs:["matInput"],features:[pi([{provide:BT,useExisting:t}]),Mr]})}return t})(),AP=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275mod=Er({type:t});static \u0275inj=Ai({imports:[Qr,Wg,Wg,moe,Qr]})}return t})();const pU=new _t("MAT_DATE_LOCALE",{providedIn:"root",factory:function yoe(){return te(em)}}),sx="Method not implemented";class Pl{locale;_localeChanges=new Et;localeChanges=this._localeChanges;setTime(n,e,i,r){throw new Error(sx)}getHours(n){throw new Error(sx)}getMinutes(n){throw new Error(sx)}getSeconds(n){throw new Error(sx)}parseTime(n,e){throw new Error(sx)}addSeconds(n,e){throw new Error(sx)}getValidDateOrNull(n){return this.isDateInstance(n)&&this.isValid(n)?n:null}deserialize(n){return null==n||this.isDateInstance(n)&&this.isValid(n)?n:this.invalid()}setLocale(n){this.locale=n,this._localeChanges.next()}compareDate(n,e){return this.getYear(n)-this.getYear(e)||this.getMonth(n)-this.getMonth(e)||this.getDate(n)-this.getDate(e)}compareTime(n,e){return this.getHours(n)-this.getHours(e)||this.getMinutes(n)-this.getMinutes(e)||this.getSeconds(n)-this.getSeconds(e)}sameDate(n,e){if(n&&e){let i=this.isValid(n),r=this.isValid(e);return i&&r?!this.compareDate(n,e):i==r}return n==e}sameTime(n,e){if(n&&e){const i=this.isValid(n),r=this.isValid(e);return i&&r?!this.compareTime(n,e):i==r}return n==e}clampDate(n,e,i){return e&&this.compareDate(n,e)<0?e:i&&this.compareDate(n,i)>0?i:n}}const ax=new _t("mat-date-formats"),boe=["mat-calendar-body",""];function xoe(t,n){return this._trackRow(n)}const fU=(t,n)=>n.id;function woe(t,n){if(1&t&&(ae(0,"tr",0)(1,"td",3),Re(2),le()()),2&t){const e=Lt();xe(),vu("padding-top",e._cellPadding)("padding-bottom",e._cellPadding),ii("colspan",e.numCols),xe(),Ci(" ",e.label," ")}}function Coe(t,n){if(1&t&&(ae(0,"td",3),Re(1),le()),2&t){const e=Lt(2);vu("padding-top",e._cellPadding)("padding-bottom",e._cellPadding),ii("colspan",e._firstRowOffset),xe(),Ci(" ",e._firstRowOffset>=e.labelMinRequiredCells?e.label:""," ")}}function Eoe(t,n){if(1&t){const e=_i();ae(0,"td",6)(1,"button",7),Tt("click",function(r){const l=on(e).$implicit;return ln(Lt(2)._cellClicked(l,r))})("focus",function(r){const l=on(e).$implicit;return ln(Lt(2)._emitActiveDateChange(l,r))}),ae(2,"span",8),Re(3),le(),Wt(4,"span",9),le()()}if(2&t){const e=n.$implicit,i=n.$index,r=Lt().$index,l=Lt();vu("width",l._cellWidth)("padding-top",l._cellPadding)("padding-bottom",l._cellPadding),ii("data-mat-row",r)("data-mat-col",i),xe(),Di("mat-calendar-body-disabled",!e.enabled)("mat-calendar-body-active",l._isActiveCell(r,i))("mat-calendar-body-range-start",l._isRangeStart(e.compareValue))("mat-calendar-body-range-end",l._isRangeEnd(e.compareValue))("mat-calendar-body-in-range",l._isInRange(e.compareValue))("mat-calendar-body-comparison-bridge-start",l._isComparisonBridgeStart(e.compareValue,r,i))("mat-calendar-body-comparison-bridge-end",l._isComparisonBridgeEnd(e.compareValue,r,i))("mat-calendar-body-comparison-start",l._isComparisonStart(e.compareValue))("mat-calendar-body-comparison-end",l._isComparisonEnd(e.compareValue))("mat-calendar-body-in-comparison-range",l._isInComparisonRange(e.compareValue))("mat-calendar-body-preview-start",l._isPreviewStart(e.compareValue))("mat-calendar-body-preview-end",l._isPreviewEnd(e.compareValue))("mat-calendar-body-in-preview",l._isInPreview(e.compareValue)),Xe("ngClass",e.cssClasses)("tabindex",l._isActiveCell(r,i)?0:-1),ii("aria-label",e.ariaLabel)("aria-disabled",!e.enabled||null)("aria-pressed",l._isSelected(e.compareValue))("aria-current",l.todayValue===e.compareValue?"date":null)("aria-describedby",l._getDescribedby(e.compareValue)),xe(),Di("mat-calendar-body-selected",l._isSelected(e.compareValue))("mat-calendar-body-comparison-identical",l._isComparisonIdentical(e.compareValue))("mat-calendar-body-today",l.todayValue===e.compareValue),xe(),Ci(" ",e.displayValue," ")}}function Soe(t,n){if(1&t&&(ae(0,"tr",1),vt(1,Coe,2,6,"td",4),N1(2,Eoe,5,48,"td",5,fU),le()),2&t){const e=n.$implicit,i=n.$index,r=Lt();xe(),qi(0===i&&r._firstRowOffset?1:-1),xe(),z1(e)}}function Doe(t,n){if(1&t&&(ae(0,"th",2)(1,"span",6),Re(2),le(),ae(3,"span",3),Re(4),le()()),2&t){const e=n.$implicit;xe(2),er(e.long),xe(2),er(e.narrow)}}const Moe=["*"];function Toe(t,n){}function Ioe(t,n){if(1&t){const e=_i();ae(0,"mat-month-view",4),Fy("activeDateChange",function(r){on(e);const l=Lt();return E0(l.activeDate,r)||(l.activeDate=r),ln(r)}),Tt("_userSelection",function(r){return on(e),ln(Lt()._dateSelected(r))})("dragStarted",function(r){return on(e),ln(Lt()._dragStarted(r))})("dragEnded",function(r){return on(e),ln(Lt()._dragEnded(r))}),le()}if(2&t){const e=Lt();Oy("activeDate",e.activeDate),Xe("selected",e.selected)("dateFilter",e.dateFilter)("maxDate",e.maxDate)("minDate",e.minDate)("dateClass",e.dateClass)("comparisonStart",e.comparisonStart)("comparisonEnd",e.comparisonEnd)("startDateAccessibleName",e.startDateAccessibleName)("endDateAccessibleName",e.endDateAccessibleName)("activeDrag",e._activeDrag)}}function Aoe(t,n){if(1&t){const e=_i();ae(0,"mat-year-view",5),Fy("activeDateChange",function(r){on(e);const l=Lt();return E0(l.activeDate,r)||(l.activeDate=r),ln(r)}),Tt("monthSelected",function(r){return on(e),ln(Lt()._monthSelectedInYearView(r))})("selectedChange",function(r){return on(e),ln(Lt()._goToDateInView(r,"month"))}),le()}if(2&t){const e=Lt();Oy("activeDate",e.activeDate),Xe("selected",e.selected)("dateFilter",e.dateFilter)("maxDate",e.maxDate)("minDate",e.minDate)("dateClass",e.dateClass)}}function koe(t,n){if(1&t){const e=_i();ae(0,"mat-multi-year-view",6),Fy("activeDateChange",function(r){on(e);const l=Lt();return E0(l.activeDate,r)||(l.activeDate=r),ln(r)}),Tt("yearSelected",function(r){return on(e),ln(Lt()._yearSelectedInMultiYearView(r))})("selectedChange",function(r){return on(e),ln(Lt()._goToDateInView(r,"year"))}),le()}if(2&t){const e=Lt();Oy("activeDate",e.activeDate),Xe("selected",e.selected)("dateFilter",e.dateFilter)("maxDate",e.maxDate)("minDate",e.minDate)("dateClass",e.dateClass)}}function Roe(t,n){}const Poe=["button"],Ooe=[[["","matDatepickerToggleIcon",""]]],Foe=["[matDatepickerToggleIcon]"];function Loe(t,n){1&t&&(ba(),ae(0,"svg",2),Wt(1,"path",3),le())}let lx=(()=>{class t{changes=new Et;calendarLabel="Calendar";openCalendarLabel="Open calendar";closeCalendarLabel="Close calendar";prevMonthLabel="Previous month";nextMonthLabel="Next month";prevYearLabel="Previous year";nextYearLabel="Next year";prevMultiYearLabel="Previous 24 years";nextMultiYearLabel="Next 24 years";switchToMonthViewLabel="Choose date";switchToMultiYearViewLabel="Choose month and year";startDateLabel="Start date";endDateLabel="End date";comparisonDateLabel="Comparison range";formatYearRange(e,i){return`${e} \u2013 ${i}`}formatYearRangeLabel(e,i){return`${e} to ${i}`}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),Noe=0;class kP{value;displayValue;ariaLabel;enabled;cssClasses;compareValue;rawValue;id=Noe++;constructor(n,e,i,r,l={},f=n,w){this.value=n,this.displayValue=e,this.ariaLabel=i,this.enabled=r,this.cssClasses=l,this.compareValue=f,this.rawValue=w}}const zoe={passive:!1,capture:!0},ZT={passive:!0,capture:!0},mU={passive:!0};let cx=(()=>{class t{_elementRef=te(Dn);_ngZone=te(wt);_platform=te(xs);_intl=te(lx);_eventCleanups;_skipNextFocus;_focusActiveCellAfterViewChecked=!1;label;rows;todayValue;startValue;endValue;labelMinRequiredCells;numCols=7;activeCell=0;ngAfterViewChecked(){this._focusActiveCellAfterViewChecked&&(this._focusActiveCell(),this._focusActiveCellAfterViewChecked=!1)}isRange=!1;cellAspectRatio=1;comparisonStart;comparisonEnd;previewStart=null;previewEnd=null;startDateAccessibleName;endDateAccessibleName;selectedValueChange=new $e;previewChange=new $e;activeDateChange=new $e;dragStarted=new $e;dragEnded=new $e;_firstRowOffset;_cellPadding;_cellWidth;_startDateLabelId;_endDateLabelId;_comparisonStartDateLabelId;_comparisonEndDateLabelId;_didDragSinceMouseDown=!1;_injector=te(we);comparisonDateAccessibleName=this._intl.comparisonDateLabel;_trackRow=e=>e;constructor(){const e=te(yt),i=te(Sa);this._startDateLabelId=i.getId("mat-calendar-body-start-"),this._endDateLabelId=i.getId("mat-calendar-body-end-"),this._comparisonStartDateLabelId=i.getId("mat-calendar-body-comparison-start-"),this._comparisonEndDateLabelId=i.getId("mat-calendar-body-comparison-end-"),te(cc).load(H0),this._ngZone.runOutsideAngular(()=>{const r=this._elementRef.nativeElement,l=[Rl(e,r,"touchmove",this._touchmoveHandler,zoe),Rl(e,r,"mouseenter",this._enterHandler,ZT),Rl(e,r,"focus",this._enterHandler,ZT),Rl(e,r,"mouseleave",this._leaveHandler,ZT),Rl(e,r,"blur",this._leaveHandler,ZT),Rl(e,r,"mousedown",this._mousedownHandler,mU),Rl(e,r,"touchstart",this._mousedownHandler,mU)];this._platform.isBrowser&&l.push(e.listen("window","mouseup",this._mouseupHandler),e.listen("window","touchend",this._touchendHandler)),this._eventCleanups=l})}_cellClicked(e,i){this._didDragSinceMouseDown||e.enabled&&this.selectedValueChange.emit({value:e.value,event:i})}_emitActiveDateChange(e,i){e.enabled&&this.activeDateChange.emit({value:e.value,event:i})}_isSelected(e){return this.startValue===e||this.endValue===e}ngOnChanges(e){const i=e.numCols,{rows:r,numCols:l}=this;(e.rows||i)&&(this._firstRowOffset=r&&r.length&&r[0].length?l-r[0].length:0),(e.cellAspectRatio||i||!this._cellPadding)&&(this._cellPadding=50*this.cellAspectRatio/l+"%"),(i||!this._cellWidth)&&(this._cellWidth=100/l+"%")}ngOnDestroy(){this._eventCleanups.forEach(e=>e())}_isActiveCell(e,i){let r=e*this.numCols+i;return e&&(r-=this._firstRowOffset),r==this.activeCell}_focusActiveCell(e=!0){El(()=>{setTimeout(()=>{const i=this._elementRef.nativeElement.querySelector(".mat-calendar-body-active");i&&(e||(this._skipNextFocus=!0),i.focus())})},{injector:this._injector})}_scheduleFocusActiveCellAfterViewChecked(){this._focusActiveCellAfterViewChecked=!0}_isRangeStart(e){return OP(e,this.startValue,this.endValue)}_isRangeEnd(e){return FP(e,this.startValue,this.endValue)}_isInRange(e){return LP(e,this.startValue,this.endValue,this.isRange)}_isComparisonStart(e){return OP(e,this.comparisonStart,this.comparisonEnd)}_isComparisonBridgeStart(e,i,r){if(!this._isComparisonStart(e)||this._isRangeStart(e)||!this._isInRange(e))return!1;let l=this.rows[i][r-1];if(!l){const f=this.rows[i-1];l=f&&f[f.length-1]}return l&&!this._isRangeEnd(l.compareValue)}_isComparisonBridgeEnd(e,i,r){if(!this._isComparisonEnd(e)||this._isRangeEnd(e)||!this._isInRange(e))return!1;let l=this.rows[i][r+1];if(!l){const f=this.rows[i+1];l=f&&f[0]}return l&&!this._isRangeStart(l.compareValue)}_isComparisonEnd(e){return FP(e,this.comparisonStart,this.comparisonEnd)}_isInComparisonRange(e){return LP(e,this.comparisonStart,this.comparisonEnd,this.isRange)}_isComparisonIdentical(e){return this.comparisonStart===this.comparisonEnd&&e===this.comparisonStart}_isPreviewStart(e){return OP(e,this.previewStart,this.previewEnd)}_isPreviewEnd(e){return FP(e,this.previewStart,this.previewEnd)}_isInPreview(e){return LP(e,this.previewStart,this.previewEnd,this.isRange)}_getDescribedby(e){if(!this.isRange)return null;if(this.startValue===e&&this.endValue===e)return`${this._startDateLabelId} ${this._endDateLabelId}`;if(this.startValue===e)return this._startDateLabelId;if(this.endValue===e)return this._endDateLabelId;if(null!==this.comparisonStart&&null!==this.comparisonEnd){if(e===this.comparisonStart&&e===this.comparisonEnd)return`${this._comparisonStartDateLabelId} ${this._comparisonEndDateLabelId}`;if(e===this.comparisonStart)return this._comparisonStartDateLabelId;if(e===this.comparisonEnd)return this._comparisonEndDateLabelId}return null}_enterHandler=e=>{if(this._skipNextFocus&&"focus"===e.type)this._skipNextFocus=!1;else if(e.target&&this.isRange){const i=this._getCellFromElement(e.target);i&&this._ngZone.run(()=>this.previewChange.emit({value:i.enabled?i:null,event:e}))}};_touchmoveHandler=e=>{if(!this.isRange)return;const i=gU(e),r=i?this._getCellFromElement(i):null;i!==e.target&&(this._didDragSinceMouseDown=!0),PP(e.target)&&e.preventDefault(),this._ngZone.run(()=>this.previewChange.emit({value:r?.enabled?r:null,event:e}))};_leaveHandler=e=>{null!==this.previewEnd&&this.isRange&&("blur"!==e.type&&(this._didDragSinceMouseDown=!0),e.target&&this._getCellFromElement(e.target)&&(!e.relatedTarget||!this._getCellFromElement(e.relatedTarget))&&this._ngZone.run(()=>this.previewChange.emit({value:null,event:e})))};_mousedownHandler=e=>{if(!this.isRange)return;this._didDragSinceMouseDown=!1;const i=e.target&&this._getCellFromElement(e.target);!i||!this._isInRange(i.compareValue)||this._ngZone.run(()=>{this.dragStarted.emit({value:i.rawValue,event:e})})};_mouseupHandler=e=>{if(!this.isRange)return;const i=PP(e.target);i?i.closest(".mat-calendar-body")===this._elementRef.nativeElement&&this._ngZone.run(()=>{const r=this._getCellFromElement(i);this.dragEnded.emit({value:r?.rawValue??null,event:e})}):this._ngZone.run(()=>{this.dragEnded.emit({value:null,event:e})})};_touchendHandler=e=>{const i=gU(e);i&&this._mouseupHandler({target:i})};_getCellFromElement(e){const i=PP(e);if(i){const r=i.getAttribute("data-mat-row"),l=i.getAttribute("data-mat-col");if(r&&l)return this.rows[parseInt(r)][parseInt(l)]}return null}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=kn({type:t,selectors:[["","mat-calendar-body",""]],hostAttrs:[1,"mat-calendar-body"],inputs:{label:"label",rows:"rows",todayValue:"todayValue",startValue:"startValue",endValue:"endValue",labelMinRequiredCells:"labelMinRequiredCells",numCols:"numCols",activeCell:"activeCell",isRange:"isRange",cellAspectRatio:"cellAspectRatio",comparisonStart:"comparisonStart",comparisonEnd:"comparisonEnd",previewStart:"previewStart",previewEnd:"previewEnd",startDateAccessibleName:"startDateAccessibleName",endDateAccessibleName:"endDateAccessibleName"},outputs:{selectedValueChange:"selectedValueChange",previewChange:"previewChange",activeDateChange:"activeDateChange",dragStarted:"dragStarted",dragEnded:"dragEnded"},exportAs:["matCalendarBody"],features:[Mr],attrs:boe,decls:11,vars:11,consts:[["aria-hidden","true"],["role","row"],[1,"mat-calendar-body-hidden-label",3,"id"],[1,"mat-calendar-body-label"],[1,"mat-calendar-body-label",3,"paddingTop","paddingBottom"],["role","gridcell",1,"mat-calendar-body-cell-container",3,"width","paddingTop","paddingBottom"],["role","gridcell",1,"mat-calendar-body-cell-container"],["type","button",1,"mat-calendar-body-cell",3,"click","focus","ngClass","tabindex"],[1,"mat-calendar-body-cell-content","mat-focus-indicator"],["aria-hidden","true",1,"mat-calendar-body-cell-preview"]],template:function(i,r){1&i&&(vt(0,woe,3,6,"tr",0),N1(1,Soe,4,1,"tr",1,xoe,!0),ae(3,"span",2),Re(4),le(),ae(5,"span",2),Re(6),le(),ae(7,"span",2),Re(8),le(),ae(9,"span",2),Re(10),le()),2&i&&(qi(r._firstRowOffset<r.labelMinRequiredCells?0:-1),xe(),z1(r.rows),xe(2),Xe("id",r._startDateLabelId),xe(),Ci(" ",r.startDateAccessibleName,"\n"),xe(),Xe("id",r._endDateLabelId),xe(),Ci(" ",r.endDateAccessibleName,"\n"),xe(),Xe("id",r._comparisonStartDateLabelId),xe(),Py(" ",r.comparisonDateAccessibleName," ",r.startDateAccessibleName,"\n"),xe(),Xe("id",r._comparisonEndDateLabelId),xe(),Py(" ",r.comparisonDateAccessibleName," ",r.endDateAccessibleName,"\n"))},dependencies:[im],styles:['.mat-calendar-body{min-width:224px}.mat-calendar-body-today:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){border-color:var(--mat-datepicker-calendar-date-today-outline-color, var(--mat-sys-primary))}.mat-calendar-body-label{height:0;line-height:0;text-align:start;padding-left:4.7142857143%;padding-right:4.7142857143%;font-size:var(--mat-datepicker-calendar-body-label-text-size, var(--mat-sys-title-small-size));font-weight:var(--mat-datepicker-calendar-body-label-text-weight, var(--mat-sys-title-small-weight));color:var(--mat-datepicker-calendar-body-label-text-color, var(--mat-sys-on-surface))}.mat-calendar-body-hidden-label{display:none}.mat-calendar-body-cell-container{position:relative;height:0;line-height:0}.mat-calendar-body-cell{position:absolute;top:0;left:0;width:100%;height:100%;background:none;text-align:center;outline:none;font-family:inherit;margin:0;font-family:var(--mat-datepicker-calendar-text-font, var(--mat-sys-body-medium-font));font-size:var(--mat-datepicker-calendar-text-size, var(--mat-sys-body-medium-size));-webkit-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-calendar-body-cell::-moz-focus-inner{border:0}.mat-calendar-body-cell::before,.mat-calendar-body-cell::after,.mat-calendar-body-cell-preview{content:"";position:absolute;top:5%;left:0;z-index:0;box-sizing:border-box;display:block;height:90%;width:100%}.mat-calendar-body-range-start:not(.mat-calendar-body-in-comparison-range)::before,.mat-calendar-body-range-start::after,.mat-calendar-body-comparison-start:not(.mat-calendar-body-comparison-bridge-start)::before,.mat-calendar-body-comparison-start::after,.mat-calendar-body-preview-start .mat-calendar-body-cell-preview{left:5%;width:95%;border-top-left-radius:999px;border-bottom-left-radius:999px}[dir=rtl] .mat-calendar-body-range-start:not(.mat-calendar-body-in-comparison-range)::before,[dir=rtl] .mat-calendar-body-range-start::after,[dir=rtl] .mat-calendar-body-comparison-start:not(.mat-calendar-body-comparison-bridge-start)::before,[dir=rtl] .mat-calendar-body-comparison-start::after,[dir=rtl] .mat-calendar-body-preview-start .mat-calendar-body-cell-preview{left:0;border-radius:0;border-top-right-radius:999px;border-bottom-right-radius:999px}.mat-calendar-body-range-end:not(.mat-calendar-body-in-comparison-range)::before,.mat-calendar-body-range-end::after,.mat-calendar-body-comparison-end:not(.mat-calendar-body-comparison-bridge-end)::before,.mat-calendar-body-comparison-end::after,.mat-calendar-body-preview-end .mat-calendar-body-cell-preview{width:95%;border-top-right-radius:999px;border-bottom-right-radius:999px}[dir=rtl] .mat-calendar-body-range-end:not(.mat-calendar-body-in-comparison-range)::before,[dir=rtl] .mat-calendar-body-range-end::after,[dir=rtl] .mat-calendar-body-comparison-end:not(.mat-calendar-body-comparison-bridge-end)::before,[dir=rtl] .mat-calendar-body-comparison-end::after,[dir=rtl] .mat-calendar-body-preview-end .mat-calendar-body-cell-preview{left:5%;border-radius:0;border-top-left-radius:999px;border-bottom-left-radius:999px}[dir=rtl] .mat-calendar-body-comparison-bridge-start.mat-calendar-body-range-end::after,[dir=rtl] .mat-calendar-body-comparison-bridge-end.mat-calendar-body-range-start::after{width:95%;border-top-right-radius:999px;border-bottom-right-radius:999px}.mat-calendar-body-comparison-start.mat-calendar-body-range-end::after,[dir=rtl] .mat-calendar-body-comparison-start.mat-calendar-body-range-end::after,.mat-calendar-body-comparison-end.mat-calendar-body-range-start::after,[dir=rtl] .mat-calendar-body-comparison-end.mat-calendar-body-range-start::after{width:90%}.mat-calendar-body-in-preview{color:var(--mat-datepicker-calendar-date-preview-state-outline-color, var(--mat-sys-primary))}.mat-calendar-body-in-preview .mat-calendar-body-cell-preview{border-top:dashed 1px;border-bottom:dashed 1px}.mat-calendar-body-preview-start .mat-calendar-body-cell-preview{border-left:dashed 1px}[dir=rtl] .mat-calendar-body-preview-start .mat-calendar-body-cell-preview{border-left:0;border-right:dashed 1px}.mat-calendar-body-preview-end .mat-calendar-body-cell-preview{border-right:dashed 1px}[dir=rtl] .mat-calendar-body-preview-end .mat-calendar-body-cell-preview{border-right:0;border-left:dashed 1px}.mat-calendar-body-disabled{cursor:default}.mat-calendar-body-disabled>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){color:var(--mat-datepicker-calendar-date-disabled-state-text-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent))}.mat-calendar-body-disabled>.mat-calendar-body-today:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){border-color:var(--mat-datepicker-calendar-date-today-disabled-state-outline-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent))}@media(forced-colors: active){.mat-calendar-body-disabled{opacity:.5}}.mat-calendar-body-cell-content{top:5%;left:5%;z-index:1;display:flex;align-items:center;justify-content:center;box-sizing:border-box;width:90%;height:90%;line-height:1;border-width:1px;border-style:solid;border-radius:999px;color:var(--mat-datepicker-calendar-date-text-color, var(--mat-sys-on-surface));border-color:var(--mat-datepicker-calendar-date-outline-color, transparent)}.mat-calendar-body-cell-content.mat-focus-indicator{position:absolute}@media(forced-colors: active){.mat-calendar-body-cell-content{border:none}}.cdk-keyboard-focused .mat-calendar-body-active>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical),.cdk-program-focused .mat-calendar-body-active>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){background-color:var(--mat-datepicker-calendar-date-focus-state-background-color, color-mix(in srgb, var(--mat-sys-on-surface) calc(var(--mat-sys-focus-state-layer-opacity) * 100%), transparent))}@media(hover: hover){.mat-calendar-body-cell:not(.mat-calendar-body-disabled):hover>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){background-color:var(--mat-datepicker-calendar-date-hover-state-background-color, color-mix(in srgb, var(--mat-sys-on-surface) calc(var(--mat-sys-hover-state-layer-opacity) * 100%), transparent))}}.mat-calendar-body-selected{background-color:var(--mat-datepicker-calendar-date-selected-state-background-color, var(--mat-sys-primary));color:var(--mat-datepicker-calendar-date-selected-state-text-color, var(--mat-sys-on-primary))}.mat-calendar-body-disabled>.mat-calendar-body-selected{background-color:var(--mat-datepicker-calendar-date-selected-disabled-state-background-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent))}.mat-calendar-body-selected.mat-calendar-body-today{box-shadow:inset 0 0 0 1px var(--mat-datepicker-calendar-date-today-selected-state-outline-color, var(--mat-sys-primary))}.mat-calendar-body-in-range::before{background:var(--mat-datepicker-calendar-date-in-range-state-background-color, var(--mat-sys-primary-container))}.mat-calendar-body-comparison-identical,.mat-calendar-body-in-comparison-range::before{background:var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color, var(--mat-sys-tertiary-container))}.mat-calendar-body-comparison-identical,.mat-calendar-body-in-comparison-range::before{background:var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color, var(--mat-sys-tertiary-container))}.mat-calendar-body-comparison-bridge-start::before,[dir=rtl] .mat-calendar-body-comparison-bridge-end::before{background:linear-gradient(to right, var(--mat-datepicker-calendar-date-in-range-state-background-color, var(--mat-sys-primary-container)) 50%, var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color, var(--mat-sys-tertiary-container)) 50%)}.mat-calendar-body-comparison-bridge-end::before,[dir=rtl] .mat-calendar-body-comparison-bridge-start::before{background:linear-gradient(to left, var(--mat-datepicker-calendar-date-in-range-state-background-color, var(--mat-sys-primary-container)) 50%, var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color, var(--mat-sys-tertiary-container)) 50%)}.mat-calendar-body-in-range>.mat-calendar-body-comparison-identical,.mat-calendar-body-in-comparison-range.mat-calendar-body-in-range::after{background:var(--mat-datepicker-calendar-date-in-overlap-range-state-background-color, var(--mat-sys-secondary-container))}.mat-calendar-body-comparison-identical.mat-calendar-body-selected,.mat-calendar-body-in-comparison-range>.mat-calendar-body-selected{background:var(--mat-datepicker-calendar-date-in-overlap-range-selected-state-background-color, var(--mat-sys-secondary))}@media(forced-colors: active){.mat-datepicker-popup:not(:empty),.mat-calendar-body-cell:not(.mat-calendar-body-in-range) .mat-calendar-body-selected{outline:solid 1px}.mat-calendar-body-today{outline:dotted 1px}.mat-calendar-body-cell::before,.mat-calendar-body-cell::after,.mat-calendar-body-selected{background:none}.mat-calendar-body-in-range::before,.mat-calendar-body-comparison-bridge-start::before,.mat-calendar-body-comparison-bridge-end::before{border-top:solid 1px;border-bottom:solid 1px}.mat-calendar-body-range-start::before{border-left:solid 1px}[dir=rtl] .mat-calendar-body-range-start::before{border-left:0;border-right:solid 1px}.mat-calendar-body-range-end::before{border-right:solid 1px}[dir=rtl] .mat-calendar-body-range-end::before{border-right:0;border-left:solid 1px}.mat-calendar-body-in-comparison-range::before{border-top:dashed 1px;border-bottom:dashed 1px}.mat-calendar-body-comparison-start::before{border-left:dashed 1px}[dir=rtl] .mat-calendar-body-comparison-start::before{border-left:0;border-right:dashed 1px}.mat-calendar-body-comparison-end::before{border-right:dashed 1px}[dir=rtl] .mat-calendar-body-comparison-end::before{border-right:0;border-left:dashed 1px}}\n'],encapsulation:2,changeDetection:0})}return t})();function RP(t){return"TD"===t?.nodeName}function PP(t){let n;return RP(t)?n=t:RP(t.parentNode)?n=t.parentNode:RP(t.parentNode?.parentNode)&&(n=t.parentNode.parentNode),null!=n?.getAttribute("data-mat-row")?n:null}function OP(t,n,e){return null!==e&&n!==e&&t<e&&t===n}function FP(t,n,e){return null!==n&&n!==e&&t>=n&&t===e}function LP(t,n,e,i){return i&&null!==n&&null!==e&&n!==e&&t>=n&&t<=e}function gU(t){const n=t.changedTouches[0];return document.elementFromPoint(n.clientX,n.clientY)}class hc{start;end;_disableStructuralEquivalency;constructor(n,e){this.start=n,this.end=e}}let Zg=(()=>{class t{selection;_adapter;_selectionChanged=new Et;selectionChanged=this._selectionChanged;constructor(e,i){this.selection=e,this._adapter=i,this.selection=e}updateSelection(e,i){const r=this.selection;this.selection=e,this._selectionChanged.next({selection:e,source:i,oldValue:r})}ngOnDestroy(){this._selectionChanged.complete()}_isValidDateInstance(e){return this._adapter.isDateInstance(e)&&this._adapter.isValid(e)}static \u0275fac=function(i){Or()};static \u0275prov=Nt({token:t,factory:t.\u0275fac})}return t})(),Boe=(()=>{class t extends Zg{constructor(e){super(null,e)}add(e){super.updateSelection(e,this)}isValid(){return null!=this.selection&&this._isValidDateInstance(this.selection)}isComplete(){return null!=this.selection}clone(){const e=new t(this._adapter);return e.updateSelection(this.selection,this),e}static \u0275fac=function(i){return new(i||t)(gn(Pl))};static \u0275prov=Nt({token:t,factory:t.\u0275fac})}return t})();const _U={provide:Zg,deps:[[new La,new no,Zg],Pl],useFactory:function Uoe(t,n){return t||new Boe(n)}},XT=new _t("MAT_DATE_RANGE_SELECTION_STRATEGY");let Goe=0,yU=(()=>{class t{_changeDetectorRef=te(Do);_dateFormats=te(ax,{optional:!0});_dateAdapter=te(Pl,{optional:!0});_dir=te(Bc,{optional:!0});_rangeStrategy=te(XT,{optional:!0});_rerenderSubscription=Mi.EMPTY;_selectionKeyPressed;get activeDate(){return this._activeDate}set activeDate(e){const i=this._activeDate,r=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(e))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(r,this.minDate,this.maxDate),this._hasSameMonthAndYear(i,this._activeDate)||this._init()}_activeDate;get selected(){return this._selected}set selected(e){this._selected=e instanceof hc?e:this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(e)),this._setRanges(this._selected)}_selected;get minDate(){return this._minDate}set minDate(e){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(e))}_minDate;get maxDate(){return this._maxDate}set maxDate(e){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(e))}_maxDate;dateFilter;dateClass;comparisonStart;comparisonEnd;startDateAccessibleName;endDateAccessibleName;activeDrag=null;selectedChange=new $e;_userSelection=new $e;dragStarted=new $e;dragEnded=new $e;activeDateChange=new $e;_matCalendarBody;_monthLabel;_weeks;_firstWeekOffset;_rangeStart;_rangeEnd;_comparisonRangeStart;_comparisonRangeEnd;_previewStart;_previewEnd;_isRange;_todayDate;_weekdays;constructor(){te(cc).load(Wy),this._activeDate=this._dateAdapter.today()}ngAfterContentInit(){this._rerenderSubscription=this._dateAdapter.localeChanges.pipe(Nc(null)).subscribe(()=>this._init())}ngOnChanges(e){const i=e.comparisonStart||e.comparisonEnd;i&&!i.firstChange&&this._setRanges(this.selected),e.activeDrag&&!this.activeDrag&&this._clearPreview()}ngOnDestroy(){this._rerenderSubscription.unsubscribe()}_dateSelected(e){const i=e.value,r=this._getDateFromDayOfMonth(i);let l,f;this._selected instanceof hc?(l=this._getDateInCurrentMonth(this._selected.start),f=this._getDateInCurrentMonth(this._selected.end)):l=f=this._getDateInCurrentMonth(this._selected),(l!==i||f!==i)&&this.selectedChange.emit(r),this._userSelection.emit({value:r,event:e.event}),this._clearPreview(),this._changeDetectorRef.markForCheck()}_updateActiveDate(e){const r=this._activeDate;this.activeDate=this._getDateFromDayOfMonth(e.value),this._dateAdapter.compareDate(r,this.activeDate)&&this.activeDateChange.emit(this._activeDate)}_handleCalendarBodyKeydown(e){const i=this._activeDate,r=this._isRtl();switch(e.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,r?1:-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,r?-1:1);break;case 38:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,-7);break;case 40:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,7);break;case 36:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,1-this._dateAdapter.getDate(this._activeDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,this._dateAdapter.getNumDaysInMonth(this._activeDate)-this._dateAdapter.getDate(this._activeDate));break;case 33:this.activeDate=e.altKey?this._dateAdapter.addCalendarYears(this._activeDate,-1):this._dateAdapter.addCalendarMonths(this._activeDate,-1);break;case 34:this.activeDate=e.altKey?this._dateAdapter.addCalendarYears(this._activeDate,1):this._dateAdapter.addCalendarMonths(this._activeDate,1);break;case 13:case 32:return this._selectionKeyPressed=!0,void(this._canSelect(this._activeDate)&&e.preventDefault());case 27:return void(null!=this._previewEnd&&!Ja(e)&&(this._clearPreview(),this.activeDrag?this.dragEnded.emit({value:null,event:e}):(this.selectedChange.emit(null),this._userSelection.emit({value:null,event:e})),e.preventDefault(),e.stopPropagation()));default:return}this._dateAdapter.compareDate(i,this.activeDate)&&(this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked()),e.preventDefault()}_handleCalendarBodyKeyup(e){(32===e.keyCode||13===e.keyCode)&&(this._selectionKeyPressed&&this._canSelect(this._activeDate)&&this._dateSelected({value:this._dateAdapter.getDate(this._activeDate),event:e}),this._selectionKeyPressed=!1)}_init(){this._setRanges(this.selected),this._todayDate=this._getCellCompareValue(this._dateAdapter.today()),this._monthLabel=this._dateFormats.display.monthLabel?this._dateAdapter.format(this.activeDate,this._dateFormats.display.monthLabel):this._dateAdapter.getMonthNames("short")[this._dateAdapter.getMonth(this.activeDate)].toLocaleUpperCase();let e=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),1);this._firstWeekOffset=(7+this._dateAdapter.getDayOfWeek(e)-this._dateAdapter.getFirstDayOfWeek())%7,this._initWeekdays(),this._createWeekCells(),this._changeDetectorRef.markForCheck()}_focusActiveCell(e){this._matCalendarBody._focusActiveCell(e)}_focusActiveCellAfterViewChecked(){this._matCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_previewChanged({event:e,value:i}){if(this._rangeStrategy){const r=i?i.rawValue:null,l=this._rangeStrategy.createPreview(r,this.selected,e);if(this._previewStart=this._getCellCompareValue(l.start),this._previewEnd=this._getCellCompareValue(l.end),this.activeDrag&&r){const f=this._rangeStrategy.createDrag?.(this.activeDrag.value,this.selected,r,e);f&&(this._previewStart=this._getCellCompareValue(f.start),this._previewEnd=this._getCellCompareValue(f.end))}this._changeDetectorRef.detectChanges()}}_dragEnded(e){if(this.activeDrag)if(e.value){const i=this._rangeStrategy?.createDrag?.(this.activeDrag.value,this.selected,e.value,e.event);this.dragEnded.emit({value:i??null,event:e.event})}else this.dragEnded.emit({value:null,event:e.event})}_getDateFromDayOfMonth(e){return this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),e)}_initWeekdays(){const e=this._dateAdapter.getFirstDayOfWeek(),i=this._dateAdapter.getDayOfWeekNames("narrow");let l=this._dateAdapter.getDayOfWeekNames("long").map((f,w)=>({long:f,narrow:i[w],id:Goe++}));this._weekdays=l.slice(e).concat(l.slice(0,e))}_createWeekCells(){const e=this._dateAdapter.getNumDaysInMonth(this.activeDate),i=this._dateAdapter.getDateNames();this._weeks=[[]];for(let r=0,l=this._firstWeekOffset;r<e;r++,l++){7==l&&(this._weeks.push([]),l=0);const f=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),r+1),w=this._shouldEnableDate(f),M=this._dateAdapter.format(f,this._dateFormats.display.dateA11yLabel),P=this.dateClass?this.dateClass(f,"month"):void 0;this._weeks[this._weeks.length-1].push(new kP(r+1,i[r],M,w,P,this._getCellCompareValue(f),f))}}_shouldEnableDate(e){return!!e&&(!this.minDate||this._dateAdapter.compareDate(e,this.minDate)>=0)&&(!this.maxDate||this._dateAdapter.compareDate(e,this.maxDate)<=0)&&(!this.dateFilter||this.dateFilter(e))}_getDateInCurrentMonth(e){return e&&this._hasSameMonthAndYear(e,this.activeDate)?this._dateAdapter.getDate(e):null}_hasSameMonthAndYear(e,i){return!(!e||!i||this._dateAdapter.getMonth(e)!=this._dateAdapter.getMonth(i)||this._dateAdapter.getYear(e)!=this._dateAdapter.getYear(i))}_getCellCompareValue(e){if(e){const i=this._dateAdapter.getYear(e),r=this._dateAdapter.getMonth(e),l=this._dateAdapter.getDate(e);return new Date(i,r,l).getTime()}return null}_isRtl(){return this._dir&&"rtl"===this._dir.value}_setRanges(e){e instanceof hc?(this._rangeStart=this._getCellCompareValue(e.start),this._rangeEnd=this._getCellCompareValue(e.end),this._isRange=!0):(this._rangeStart=this._rangeEnd=this._getCellCompareValue(e),this._isRange=!1),this._comparisonRangeStart=this._getCellCompareValue(this.comparisonStart),this._comparisonRangeEnd=this._getCellCompareValue(this.comparisonEnd)}_canSelect(e){return!this.dateFilter||this.dateFilter(e)}_clearPreview(){this._previewStart=this._previewEnd=null}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=kn({type:t,selectors:[["mat-month-view"]],viewQuery:function(i,r){if(1&i&&kr(cx,5),2&i){let l;Zn(l=Xn())&&(r._matCalendarBody=l.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass",comparisonStart:"comparisonStart",comparisonEnd:"comparisonEnd",startDateAccessibleName:"startDateAccessibleName",endDateAccessibleName:"endDateAccessibleName",activeDrag:"activeDrag"},outputs:{selectedChange:"selectedChange",_userSelection:"_userSelection",dragStarted:"dragStarted",dragEnded:"dragEnded",activeDateChange:"activeDateChange"},exportAs:["matMonthView"],features:[Mr],decls:8,vars:14,consts:[["role","grid",1,"mat-calendar-table"],[1,"mat-calendar-table-header"],["scope","col"],["aria-hidden","true"],["colspan","7",1,"mat-calendar-table-header-divider"],["mat-calendar-body","",3,"selectedValueChange","activeDateChange","previewChange","dragStarted","dragEnded","keyup","keydown","label","rows","todayValue","startValue","endValue","comparisonStart","comparisonEnd","previewStart","previewEnd","isRange","labelMinRequiredCells","activeCell","startDateAccessibleName","endDateAccessibleName"],[1,"cdk-visually-hidden"]],template:function(i,r){1&i&&(ae(0,"table",0)(1,"thead",1)(2,"tr"),N1(3,Doe,5,2,"th",2,fU),le(),ae(5,"tr",3),Wt(6,"th",4),le()(),ae(7,"tbody",5),Tt("selectedValueChange",function(f){return r._dateSelected(f)})("activeDateChange",function(f){return r._updateActiveDate(f)})("previewChange",function(f){return r._previewChanged(f)})("dragStarted",function(f){return r.dragStarted.emit(f)})("dragEnded",function(f){return r._dragEnded(f)})("keyup",function(f){return r._handleCalendarBodyKeyup(f)})("keydown",function(f){return r._handleCalendarBodyKeydown(f)}),le()()),2&i&&(xe(3),z1(r._weekdays),xe(4),Xe("label",r._monthLabel)("rows",r._weeks)("todayValue",r._todayDate)("startValue",r._rangeStart)("endValue",r._rangeEnd)("comparisonStart",r._comparisonRangeStart)("comparisonEnd",r._comparisonRangeEnd)("previewStart",r._previewStart)("previewEnd",r._previewEnd)("isRange",r._isRange)("labelMinRequiredCells",3)("activeCell",r._dateAdapter.getDate(r.activeDate)-1)("startDateAccessibleName",r.startDateAccessibleName)("endDateAccessibleName",r.endDateAccessibleName))},dependencies:[cx],encapsulation:2,changeDetection:0})}return t})(),bU=(()=>{class t{_changeDetectorRef=te(Do);_dateAdapter=te(Pl,{optional:!0});_dir=te(Bc,{optional:!0});_rerenderSubscription=Mi.EMPTY;_selectionKeyPressed;get activeDate(){return this._activeDate}set activeDate(e){let i=this._activeDate;const r=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(e))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(r,this.minDate,this.maxDate),xU(this._dateAdapter,i,this._activeDate,this.minDate,this.maxDate)||this._init()}_activeDate;get selected(){return this._selected}set selected(e){this._selected=e instanceof hc?e:this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(e)),this._setSelectedYear(e)}_selected;get minDate(){return this._minDate}set minDate(e){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(e))}_minDate;get maxDate(){return this._maxDate}set maxDate(e){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(e))}_maxDate;dateFilter;dateClass;selectedChange=new $e;yearSelected=new $e;activeDateChange=new $e;_matCalendarBody;_years;_todayYear;_selectedYear;constructor(){this._activeDate=this._dateAdapter.today()}ngAfterContentInit(){this._rerenderSubscription=this._dateAdapter.localeChanges.pipe(Nc(null)).subscribe(()=>this._init())}ngOnDestroy(){this._rerenderSubscription.unsubscribe()}_init(){this._todayYear=this._dateAdapter.getYear(this._dateAdapter.today());const i=this._dateAdapter.getYear(this._activeDate)-hE(this._dateAdapter,this.activeDate,this.minDate,this.maxDate);this._years=[];for(let r=0,l=[];r<24;r++)l.push(i+r),4==l.length&&(this._years.push(l.map(f=>this._createCellForYear(f))),l=[]);this._changeDetectorRef.markForCheck()}_yearSelected(e){const i=e.value,r=this._dateAdapter.createDate(i,0,1),l=this._getDateFromYear(i);this.yearSelected.emit(r),this.selectedChange.emit(l)}_updateActiveDate(e){const r=this._activeDate;this.activeDate=this._getDateFromYear(e.value),this._dateAdapter.compareDate(r,this.activeDate)&&this.activeDateChange.emit(this.activeDate)}_handleCalendarBodyKeydown(e){const i=this._activeDate,r=this._isRtl();switch(e.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,r?1:-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,r?-1:1);break;case 38:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,-4);break;case 40:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,4);break;case 36:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,-hE(this._dateAdapter,this.activeDate,this.minDate,this.maxDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,24-hE(this._dateAdapter,this.activeDate,this.minDate,this.maxDate)-1);break;case 33:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,e.altKey?-240:-24);break;case 34:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,e.altKey?240:24);break;case 13:case 32:this._selectionKeyPressed=!0;break;default:return}this._dateAdapter.compareDate(i,this.activeDate)&&this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked(),e.preventDefault()}_handleCalendarBodyKeyup(e){(32===e.keyCode||13===e.keyCode)&&(this._selectionKeyPressed&&this._yearSelected({value:this._dateAdapter.getYear(this._activeDate),event:e}),this._selectionKeyPressed=!1)}_getActiveCell(){return hE(this._dateAdapter,this.activeDate,this.minDate,this.maxDate)}_focusActiveCell(){this._matCalendarBody._focusActiveCell()}_focusActiveCellAfterViewChecked(){this._matCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_getDateFromYear(e){const i=this._dateAdapter.getMonth(this.activeDate),r=this._dateAdapter.getNumDaysInMonth(this._dateAdapter.createDate(e,i,1));return this._dateAdapter.createDate(e,i,Math.min(this._dateAdapter.getDate(this.activeDate),r))}_createCellForYear(e){const i=this._dateAdapter.createDate(e,0,1),r=this._dateAdapter.getYearName(i),l=this.dateClass?this.dateClass(i,"multi-year"):void 0;return new kP(e,r,r,this._shouldEnableYear(e),l)}_shouldEnableYear(e){if(null==e||this.maxDate&&e>this._dateAdapter.getYear(this.maxDate)||this.minDate&&e<this._dateAdapter.getYear(this.minDate))return!1;if(!this.dateFilter)return!0;for(let r=this._dateAdapter.createDate(e,0,1);this._dateAdapter.getYear(r)==e;r=this._dateAdapter.addCalendarDays(r,1))if(this.dateFilter(r))return!0;return!1}_isRtl(){return this._dir&&"rtl"===this._dir.value}_setSelectedYear(e){if(this._selectedYear=null,e instanceof hc){const i=e.start||e.end;i&&(this._selectedYear=this._dateAdapter.getYear(i))}else e&&(this._selectedYear=this._dateAdapter.getYear(e))}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=kn({type:t,selectors:[["mat-multi-year-view"]],viewQuery:function(i,r){if(1&i&&kr(cx,5),2&i){let l;Zn(l=Xn())&&(r._matCalendarBody=l.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass"},outputs:{selectedChange:"selectedChange",yearSelected:"yearSelected",activeDateChange:"activeDateChange"},exportAs:["matMultiYearView"],decls:5,vars:7,consts:[["role","grid",1,"mat-calendar-table"],["aria-hidden","true",1,"mat-calendar-table-header"],["colspan","4",1,"mat-calendar-table-header-divider"],["mat-calendar-body","",3,"selectedValueChange","activeDateChange","keyup","keydown","rows","todayValue","startValue","endValue","numCols","cellAspectRatio","activeCell"]],template:function(i,r){1&i&&(ae(0,"table",0)(1,"thead",1)(2,"tr"),Wt(3,"th",2),le()(),ae(4,"tbody",3),Tt("selectedValueChange",function(f){return r._yearSelected(f)})("activeDateChange",function(f){return r._updateActiveDate(f)})("keyup",function(f){return r._handleCalendarBodyKeyup(f)})("keydown",function(f){return r._handleCalendarBodyKeydown(f)}),le()()),2&i&&(xe(4),Xe("rows",r._years)("todayValue",r._todayYear)("startValue",r._selectedYear)("endValue",r._selectedYear)("numCols",4)("cellAspectRatio",4/7)("activeCell",r._getActiveCell()))},dependencies:[cx],encapsulation:2,changeDetection:0})}return t})();function xU(t,n,e,i,r){const l=t.getYear(n),f=t.getYear(e),w=wU(t,i,r);return Math.floor((l-w)/24)===Math.floor((f-w)/24)}function hE(t,n,e,i){return function qoe(t,n){return(t%n+n)%n}(t.getYear(n)-wU(t,e,i),24)}function wU(t,n,e){let i=0;return e?i=t.getYear(e)-24+1:n&&(i=t.getYear(n)),i}let CU=(()=>{class t{_changeDetectorRef=te(Do);_dateFormats=te(ax,{optional:!0});_dateAdapter=te(Pl,{optional:!0});_dir=te(Bc,{optional:!0});_rerenderSubscription=Mi.EMPTY;_selectionKeyPressed;get activeDate(){return this._activeDate}set activeDate(e){let i=this._activeDate;const r=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(e))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(r,this.minDate,this.maxDate),this._dateAdapter.getYear(i)!==this._dateAdapter.getYear(this._activeDate)&&this._init()}_activeDate;get selected(){return this._selected}set selected(e){this._selected=e instanceof hc?e:this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(e)),this._setSelectedMonth(e)}_selected;get minDate(){return this._minDate}set minDate(e){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(e))}_minDate;get maxDate(){return this._maxDate}set maxDate(e){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(e))}_maxDate;dateFilter;dateClass;selectedChange=new $e;monthSelected=new $e;activeDateChange=new $e;_matCalendarBody;_months;_yearLabel;_todayMonth;_selectedMonth;constructor(){this._activeDate=this._dateAdapter.today()}ngAfterContentInit(){this._rerenderSubscription=this._dateAdapter.localeChanges.pipe(Nc(null)).subscribe(()=>this._init())}ngOnDestroy(){this._rerenderSubscription.unsubscribe()}_monthSelected(e){const i=e.value,r=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),i,1);this.monthSelected.emit(r);const l=this._getDateFromMonth(i);this.selectedChange.emit(l)}_updateActiveDate(e){const r=this._activeDate;this.activeDate=this._getDateFromMonth(e.value),this._dateAdapter.compareDate(r,this.activeDate)&&this.activeDateChange.emit(this.activeDate)}_handleCalendarBodyKeydown(e){const i=this._activeDate,r=this._isRtl();switch(e.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,r?1:-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,r?-1:1);break;case 38:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,-4);break;case 40:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,4);break;case 36:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,-this._dateAdapter.getMonth(this._activeDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,11-this._dateAdapter.getMonth(this._activeDate));break;case 33:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,e.altKey?-10:-1);break;case 34:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,e.altKey?10:1);break;case 13:case 32:this._selectionKeyPressed=!0;break;default:return}this._dateAdapter.compareDate(i,this.activeDate)&&(this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked()),e.preventDefault()}_handleCalendarBodyKeyup(e){(32===e.keyCode||13===e.keyCode)&&(this._selectionKeyPressed&&this._monthSelected({value:this._dateAdapter.getMonth(this._activeDate),event:e}),this._selectionKeyPressed=!1)}_init(){this._setSelectedMonth(this.selected),this._todayMonth=this._getMonthInCurrentYear(this._dateAdapter.today()),this._yearLabel=this._dateAdapter.getYearName(this.activeDate);let e=this._dateAdapter.getMonthNames("short");this._months=[[0,1,2,3],[4,5,6,7],[8,9,10,11]].map(i=>i.map(r=>this._createCellForMonth(r,e[r]))),this._changeDetectorRef.markForCheck()}_focusActiveCell(){this._matCalendarBody._focusActiveCell()}_focusActiveCellAfterViewChecked(){this._matCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_getMonthInCurrentYear(e){return e&&this._dateAdapter.getYear(e)==this._dateAdapter.getYear(this.activeDate)?this._dateAdapter.getMonth(e):null}_getDateFromMonth(e){const i=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),e,1),r=this._dateAdapter.getNumDaysInMonth(i);return this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),e,Math.min(this._dateAdapter.getDate(this.activeDate),r))}_createCellForMonth(e,i){const r=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),e,1),l=this._dateAdapter.format(r,this._dateFormats.display.monthYearA11yLabel),f=this.dateClass?this.dateClass(r,"year"):void 0;return new kP(e,i.toLocaleUpperCase(),l,this._shouldEnableMonth(e),f)}_shouldEnableMonth(e){const i=this._dateAdapter.getYear(this.activeDate);if(null==e||this._isYearAndMonthAfterMaxDate(i,e)||this._isYearAndMonthBeforeMinDate(i,e))return!1;if(!this.dateFilter)return!0;for(let l=this._dateAdapter.createDate(i,e,1);this._dateAdapter.getMonth(l)==e;l=this._dateAdapter.addCalendarDays(l,1))if(this.dateFilter(l))return!0;return!1}_isYearAndMonthAfterMaxDate(e,i){if(this.maxDate){const r=this._dateAdapter.getYear(this.maxDate),l=this._dateAdapter.getMonth(this.maxDate);return e>r||e===r&&i>l}return!1}_isYearAndMonthBeforeMinDate(e,i){if(this.minDate){const r=this._dateAdapter.getYear(this.minDate),l=this._dateAdapter.getMonth(this.minDate);return e<r||e===r&&i<l}return!1}_isRtl(){return this._dir&&"rtl"===this._dir.value}_setSelectedMonth(e){this._selectedMonth=e instanceof hc?this._getMonthInCurrentYear(e.start)||this._getMonthInCurrentYear(e.end):this._getMonthInCurrentYear(e)}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=kn({type:t,selectors:[["mat-year-view"]],viewQuery:function(i,r){if(1&i&&kr(cx,5),2&i){let l;Zn(l=Xn())&&(r._matCalendarBody=l.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass"},outputs:{selectedChange:"selectedChange",monthSelected:"monthSelected",activeDateChange:"activeDateChange"},exportAs:["matYearView"],decls:5,vars:9,consts:[["role","grid",1,"mat-calendar-table"],["aria-hidden","true",1,"mat-calendar-table-header"],["colspan","4",1,"mat-calendar-table-header-divider"],["mat-calendar-body","",3,"selectedValueChange","activeDateChange","keyup","keydown","label","rows","todayValue","startValue","endValue","labelMinRequiredCells","numCols","cellAspectRatio","activeCell"]],template:function(i,r){1&i&&(ae(0,"table",0)(1,"thead",1)(2,"tr"),Wt(3,"th",2),le()(),ae(4,"tbody",3),Tt("selectedValueChange",function(f){return r._monthSelected(f)})("activeDateChange",function(f){return r._updateActiveDate(f)})("keyup",function(f){return r._handleCalendarBodyKeyup(f)})("keydown",function(f){return r._handleCalendarBodyKeydown(f)}),le()()),2&i&&(xe(4),Xe("label",r._yearLabel)("rows",r._months)("todayValue",r._todayMonth)("startValue",r._selectedMonth)("endValue",r._selectedMonth)("labelMinRequiredCells",2)("numCols",4)("cellAspectRatio",4/7)("activeCell",r._dateAdapter.getMonth(r.activeDate)))},dependencies:[cx],encapsulation:2,changeDetection:0})}return t})(),EU=(()=>{class t{_intl=te(lx);calendar=te(zP);_dateAdapter=te(Pl,{optional:!0});_dateFormats=te(ax,{optional:!0});constructor(){te(cc).load(Wy);const e=te(Do);this.calendar.stateChanges.subscribe(()=>e.markForCheck())}get periodButtonText(){return"month"==this.calendar.currentView?this._dateAdapter.format(this.calendar.activeDate,this._dateFormats.display.monthYearLabel).toLocaleUpperCase():"year"==this.calendar.currentView?this._dateAdapter.getYearName(this.calendar.activeDate):this._intl.formatYearRange(...this._formatMinAndMaxYearLabels())}get periodButtonDescription(){return"month"==this.calendar.currentView?this._dateAdapter.format(this.calendar.activeDate,this._dateFormats.display.monthYearLabel).toLocaleUpperCase():"year"==this.calendar.currentView?this._dateAdapter.getYearName(this.calendar.activeDate):this._intl.formatYearRangeLabel(...this._formatMinAndMaxYearLabels())}get periodButtonLabel(){return"month"==this.calendar.currentView?this._intl.switchToMultiYearViewLabel:this._intl.switchToMonthViewLabel}get prevButtonLabel(){return{month:this._intl.prevMonthLabel,year:this._intl.prevYearLabel,"multi-year":this._intl.prevMultiYearLabel}[this.calendar.currentView]}get nextButtonLabel(){return{month:this._intl.nextMonthLabel,year:this._intl.nextYearLabel,"multi-year":this._intl.nextMultiYearLabel}[this.calendar.currentView]}currentPeriodClicked(){this.calendar.currentView="month"==this.calendar.currentView?"multi-year":"month"}previousClicked(){this.calendar.activeDate="month"==this.calendar.currentView?this._dateAdapter.addCalendarMonths(this.calendar.activeDate,-1):this._dateAdapter.addCalendarYears(this.calendar.activeDate,"year"==this.calendar.currentView?-1:-24)}nextClicked(){this.calendar.activeDate="month"==this.calendar.currentView?this._dateAdapter.addCalendarMonths(this.calendar.activeDate,1):this._dateAdapter.addCalendarYears(this.calendar.activeDate,"year"==this.calendar.currentView?1:24)}previousEnabled(){return!this.calendar.minDate||!this.calendar.minDate||!this._isSameView(this.calendar.activeDate,this.calendar.minDate)}nextEnabled(){return!this.calendar.maxDate||!this._isSameView(this.calendar.activeDate,this.calendar.maxDate)}_isSameView(e,i){return"month"==this.calendar.currentView?this._dateAdapter.getYear(e)==this._dateAdapter.getYear(i)&&this._dateAdapter.getMonth(e)==this._dateAdapter.getMonth(i):"year"==this.calendar.currentView?this._dateAdapter.getYear(e)==this._dateAdapter.getYear(i):xU(this._dateAdapter,e,i,this.calendar.minDate,this.calendar.maxDate)}_formatMinAndMaxYearLabels(){const i=this._dateAdapter.getYear(this.calendar.activeDate)-hE(this._dateAdapter,this.calendar.activeDate,this.calendar.minDate,this.calendar.maxDate),r=i+24-1;return[this._dateAdapter.getYearName(this._dateAdapter.createDate(i,0,1)),this._dateAdapter.getYearName(this._dateAdapter.createDate(r,0,1))]}_periodButtonLabelId=te(Sa).getId("mat-calendar-period-label-");static \u0275fac=function(i){return new(i||t)};static \u0275cmp=kn({type:t,selectors:[["mat-calendar-header"]],exportAs:["matCalendarHeader"],ngContentSelectors:Moe,decls:17,vars:11,consts:[[1,"mat-calendar-header"],[1,"mat-calendar-controls"],["aria-live","polite",1,"cdk-visually-hidden",3,"id"],["mat-button","","type","button",1,"mat-calendar-period-button",3,"click"],["aria-hidden","true"],["viewBox","0 0 10 5","focusable","false","aria-hidden","true",1,"mat-calendar-arrow"],["points","0,0 5,5 10,0"],[1,"mat-calendar-spacer"],["mat-icon-button","","type","button",1,"mat-calendar-previous-button",3,"click","disabled"],["viewBox","0 0 24 24","focusable","false","aria-hidden","true"],["d","M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"],["mat-icon-button","","type","button",1,"mat-calendar-next-button",3,"click","disabled"],["d","M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"]],template:function(i,r){1&i&&(os(),ae(0,"div",0)(1,"div",1)(2,"span",2),Re(3),le(),ae(4,"button",3),Tt("click",function(){return r.currentPeriodClicked()}),ae(5,"span",4),Re(6),le(),ba(),ae(7,"svg",5),Wt(8,"polygon",6),le()(),hr(),Wt(9,"div",7),Fi(10),ae(11,"button",8),Tt("click",function(){return r.previousClicked()}),ba(),ae(12,"svg",9),Wt(13,"path",10),le()(),hr(),ae(14,"button",11),Tt("click",function(){return r.nextClicked()}),ba(),ae(15,"svg",9),Wt(16,"path",12),le()()()()),2&i&&(xe(2),Xe("id",r._periodButtonLabelId),xe(),er(r.periodButtonDescription),xe(),ii("aria-label",r.periodButtonLabel)("aria-describedby",r._periodButtonLabelId),xe(2),er(r.periodButtonText),xe(),Di("mat-calendar-invert","month"!==r.calendar.currentView),xe(4),Xe("disabled",!r.previousEnabled()),ii("aria-label",r.prevButtonLabel),xe(3),Xe("disabled",!r.nextEnabled()),ii("aria-label",r.nextButtonLabel))},dependencies:[jg,Ug],encapsulation:2,changeDetection:0})}return t})(),zP=(()=>{class t{_dateAdapter=te(Pl,{optional:!0});_dateFormats=te(ax,{optional:!0});_changeDetectorRef=te(Do);headerComponent;_calendarHeaderPortal;_intlChanges;_moveFocusOnNextTick=!1;get startAt(){return this._startAt}set startAt(e){this._startAt=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(e))}_startAt;startView="month";get selected(){return this._selected}set selected(e){this._selected=e instanceof hc?e:this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(e))}_selected;get minDate(){return this._minDate}set minDate(e){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(e))}_minDate;get maxDate(){return this._maxDate}set maxDate(e){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(e))}_maxDate;dateFilter;dateClass;comparisonStart;comparisonEnd;startDateAccessibleName;endDateAccessibleName;selectedChange=new $e;yearSelected=new $e;monthSelected=new $e;viewChanged=new $e(!0);_userSelection=new $e;_userDragDrop=new $e;monthView;yearView;multiYearView;get activeDate(){return this._clampedActiveDate}set activeDate(e){this._clampedActiveDate=this._dateAdapter.clampDate(e,this.minDate,this.maxDate),this.stateChanges.next(),this._changeDetectorRef.markForCheck()}_clampedActiveDate;get currentView(){return this._currentView}set currentView(e){const i=this._currentView!==e?e:null;this._currentView=e,this._moveFocusOnNextTick=!0,this._changeDetectorRef.markForCheck(),i&&this.viewChanged.emit(i)}_currentView;_activeDrag=null;stateChanges=new Et;constructor(){this._intlChanges=te(lx).changes.subscribe(()=>{this._changeDetectorRef.markForCheck(),this.stateChanges.next()})}ngAfterContentInit(){this._calendarHeaderPortal=new zg(this.headerComponent||EU),this.activeDate=this.startAt||this._dateAdapter.today(),this._currentView=this.startView}ngAfterViewChecked(){this._moveFocusOnNextTick&&(this._moveFocusOnNextTick=!1,this.focusActiveCell())}ngOnDestroy(){this._intlChanges.unsubscribe(),this.stateChanges.complete()}ngOnChanges(e){const i=e.minDate&&!this._dateAdapter.sameDate(e.minDate.previousValue,e.minDate.currentValue)?e.minDate:void 0,r=e.maxDate&&!this._dateAdapter.sameDate(e.maxDate.previousValue,e.maxDate.currentValue)?e.maxDate:void 0,l=i||r||e.dateFilter;if(l&&!l.firstChange){const f=this._getCurrentViewComponent();f&&(this._moveFocusOnNextTick=!0,this._changeDetectorRef.detectChanges(),f._init())}this.stateChanges.next()}focusActiveCell(){this._getCurrentViewComponent()._focusActiveCell(!1)}updateTodaysDate(){this._getCurrentViewComponent()._init()}_dateSelected(e){const i=e.value;(this.selected instanceof hc||i&&!this._dateAdapter.sameDate(i,this.selected))&&this.selectedChange.emit(i),this._userSelection.emit(e)}_yearSelectedInMultiYearView(e){this.yearSelected.emit(e)}_monthSelectedInYearView(e){this.monthSelected.emit(e)}_goToDateInView(e,i){this.activeDate=e,this.currentView=i}_dragStarted(e){this._activeDrag=e}_dragEnded(e){this._activeDrag&&(e.value&&this._userDragDrop.emit(e),this._activeDrag=null)}_getCurrentViewComponent(){return this.monthView||this.yearView||this.multiYearView}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=kn({type:t,selectors:[["mat-calendar"]],viewQuery:function(i,r){if(1&i&&(kr(yU,5),kr(CU,5),kr(bU,5)),2&i){let l;Zn(l=Xn())&&(r.monthView=l.first),Zn(l=Xn())&&(r.yearView=l.first),Zn(l=Xn())&&(r.multiYearView=l.first)}},hostAttrs:[1,"mat-calendar"],inputs:{headerComponent:"headerComponent",startAt:"startAt",startView:"startView",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass",comparisonStart:"comparisonStart",comparisonEnd:"comparisonEnd",startDateAccessibleName:"startDateAccessibleName",endDateAccessibleName:"endDateAccessibleName"},outputs:{selectedChange:"selectedChange",yearSelected:"yearSelected",monthSelected:"monthSelected",viewChanged:"viewChanged",_userSelection:"_userSelection",_userDragDrop:"_userDragDrop"},exportAs:["matCalendar"],features:[pi([_U]),Mr],decls:5,vars:2,consts:[[3,"cdkPortalOutlet"],["cdkMonitorSubtreeFocus","","tabindex","-1",1,"mat-calendar-content"],[3,"activeDate","selected","dateFilter","maxDate","minDate","dateClass","comparisonStart","comparisonEnd","startDateAccessibleName","endDateAccessibleName","activeDrag"],[3,"activeDate","selected","dateFilter","maxDate","minDate","dateClass"],[3,"activeDateChange","_userSelection","dragStarted","dragEnded","activeDate","selected","dateFilter","maxDate","minDate","dateClass","comparisonStart","comparisonEnd","startDateAccessibleName","endDateAccessibleName","activeDrag"],[3,"activeDateChange","monthSelected","selectedChange","activeDate","selected","dateFilter","maxDate","minDate","dateClass"],[3,"activeDateChange","yearSelected","selectedChange","activeDate","selected","dateFilter","maxDate","minDate","dateClass"]],template:function(i,r){if(1&i&&(vt(0,Toe,0,0,"ng-template",0),ae(1,"div",1),vt(2,Ioe,1,11,"mat-month-view",2)(3,Aoe,1,6,"mat-year-view",3)(4,koe,1,6,"mat-multi-year-view",3),le()),2&i){let l;Xe("cdkPortalOutlet",r._calendarHeaderPortal),xe(2),qi("month"===(l=r.currentView)?2:"year"===l?3:"multi-year"===l?4:-1)}},dependencies:[qy,wQ,yU,CU,bU],styles:['.mat-calendar{display:block;line-height:normal;font-family:var(--mat-datepicker-calendar-text-font, var(--mat-sys-body-medium-font));font-size:var(--mat-datepicker-calendar-text-size, var(--mat-sys-body-medium-size))}.mat-calendar-header{padding:8px 8px 0 8px}.mat-calendar-content{padding:0 8px 8px 8px;outline:none}.mat-calendar-controls{display:flex;align-items:center;margin:5% calc(4.7142857143% - 16px)}.mat-calendar-spacer{flex:1 1 auto}.mat-calendar-period-button{min-width:0;margin:0 8px;font-size:var(--mat-datepicker-calendar-period-button-text-size, var(--mat-sys-title-small-size));font-weight:var(--mat-datepicker-calendar-period-button-text-weight, var(--mat-sys-title-small-weight));--mdc-text-button-label-text-color:var(--mat-datepicker-calendar-period-button-text-color, var(--mat-sys-on-surface-variant))}.mat-calendar-arrow{display:inline-block;width:10px;height:5px;margin:0 0 0 5px;vertical-align:middle;fill:var(--mat-datepicker-calendar-period-button-icon-color, var(--mat-sys-on-surface-variant))}.mat-calendar-arrow.mat-calendar-invert{transform:rotate(180deg)}[dir=rtl] .mat-calendar-arrow{margin:0 5px 0 0}@media(forced-colors: active){.mat-calendar-arrow{fill:CanvasText}}.mat-datepicker-content .mat-calendar-previous-button:not(.mat-mdc-button-disabled),.mat-datepicker-content .mat-calendar-next-button:not(.mat-mdc-button-disabled){color:var(--mat-datepicker-calendar-navigation-button-icon-color, var(--mat-sys-on-surface-variant))}[dir=rtl] .mat-calendar-previous-button,[dir=rtl] .mat-calendar-next-button{transform:rotate(180deg)}.mat-calendar-table{border-spacing:0;border-collapse:collapse;width:100%}.mat-calendar-table-header th{text-align:center;padding:0 0 8px 0;color:var(--mat-datepicker-calendar-header-text-color, var(--mat-sys-on-surface-variant));font-size:var(--mat-datepicker-calendar-header-text-size, var(--mat-sys-title-small-size));font-weight:var(--mat-datepicker-calendar-header-text-weight, var(--mat-sys-title-small-weight))}.mat-calendar-table-header-divider{position:relative;height:1px}.mat-calendar-table-header-divider::after{content:"";position:absolute;top:0;left:-8px;right:-8px;height:1px;background:var(--mat-datepicker-calendar-header-divider-color, transparent)}.mat-calendar-body-cell-content::before{margin:calc(calc(var(--mat-focus-indicator-border-width, 3px) + 3px)*-1)}.mat-calendar-body-cell:focus .mat-focus-indicator::before{content:""}\n'],encapsulation:2,changeDetection:0})}return t})();const SU=new _t("mat-datepicker-scroll-strategy",{providedIn:"root",factory:()=>{const t=te(oa);return()=>t.scrollStrategies.reposition()}}),Yoe={provide:SU,deps:[oa],useFactory:function Woe(t){return()=>t.scrollStrategies.reposition()}};let DU=(()=>{class t{_elementRef=te(Dn);_animationsDisabled="NoopAnimations"===te(wa,{optional:!0});_changeDetectorRef=te(Do);_globalModel=te(Zg);_dateAdapter=te(Pl);_ngZone=te(wt);_rangeSelectionStrategy=te(XT,{optional:!0});_stateChanges;_model;_eventCleanups;_animationFallback;_calendar;color;datepicker;comparisonStart;comparisonEnd;startDateAccessibleName;endDateAccessibleName;_isAbove;_animationDone=new Et;_isAnimating=!1;_closeButtonText;_closeButtonFocused;_actionsPortal=null;_dialogLabelId;constructor(){if(te(cc).load(Wy),this._closeButtonText=te(lx).closeCalendarLabel,!this._animationsDisabled){const e=this._elementRef.nativeElement,i=te(yt);this._eventCleanups=this._ngZone.runOutsideAngular(()=>[i.listen(e,"animationstart",this._handleAnimationEvent),i.listen(e,"animationend",this._handleAnimationEvent),i.listen(e,"animationcancel",this._handleAnimationEvent)])}}ngAfterViewInit(){this._stateChanges=this.datepicker.stateChanges.subscribe(()=>{this._changeDetectorRef.markForCheck()}),this._calendar.focusActiveCell()}ngOnDestroy(){clearTimeout(this._animationFallback),this._eventCleanups?.forEach(e=>e()),this._stateChanges?.unsubscribe(),this._animationDone.complete()}_handleUserSelection(e){const i=this._model.selection,r=e.value,l=i instanceof hc;if(l&&this._rangeSelectionStrategy){const f=this._rangeSelectionStrategy.selectionFinished(r,i,e.event);this._model.updateSelection(f,this)}else r&&(l||!this._dateAdapter.sameDate(r,i))&&this._model.add(r);(!this._model||this._model.isComplete())&&!this._actionsPortal&&this.datepicker.close()}_handleUserDragDrop(e){this._model.updateSelection(e.value,this)}_startExitAnimation(){this._elementRef.nativeElement.classList.add("mat-datepicker-content-exit"),this._animationsDisabled?this._animationDone.next():(clearTimeout(this._animationFallback),this._animationFallback=setTimeout(()=>{this._isAnimating||this._animationDone.next()},200))}_handleAnimationEvent=e=>{const i=this._elementRef.nativeElement;e.target!==i||!e.animationName.startsWith("_mat-datepicker-content")||(clearTimeout(this._animationFallback),this._isAnimating="animationstart"===e.type,i.classList.toggle("mat-datepicker-content-animating",this._isAnimating),this._isAnimating||this._animationDone.next())};_getSelected(){return this._model.selection}_applyPendingSelection(){this._model!==this._globalModel&&this._globalModel.updateSelection(this._model.selection,this)}_assignActions(e,i){this._model=e?this._globalModel.clone():this._globalModel,this._actionsPortal=e,i&&this._changeDetectorRef.detectChanges()}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=kn({type:t,selectors:[["mat-datepicker-content"]],viewQuery:function(i,r){if(1&i&&kr(zP,5),2&i){let l;Zn(l=Xn())&&(r._calendar=l.first)}},hostAttrs:[1,"mat-datepicker-content"],hostVars:6,hostBindings:function(i,r){2&i&&(Kf(r.color?"mat-"+r.color:""),Di("mat-datepicker-content-touch",r.datepicker.touchUi)("mat-datepicker-content-animations-enabled",!r._animationsDisabled))},inputs:{color:"color"},exportAs:["matDatepickerContent"],decls:5,vars:26,consts:[["cdkTrapFocus","","role","dialog",1,"mat-datepicker-content-container"],[3,"yearSelected","monthSelected","viewChanged","_userSelection","_userDragDrop","id","startAt","startView","minDate","maxDate","dateFilter","headerComponent","selected","dateClass","comparisonStart","comparisonEnd","startDateAccessibleName","endDateAccessibleName"],[3,"cdkPortalOutlet"],["type","button","mat-raised-button","",1,"mat-datepicker-close-button",3,"focus","blur","click","color"]],template:function(i,r){if(1&i&&(ae(0,"div",0)(1,"mat-calendar",1),Tt("yearSelected",function(f){return r.datepicker._selectYear(f)})("monthSelected",function(f){return r.datepicker._selectMonth(f)})("viewChanged",function(f){return r.datepicker._viewChanged(f)})("_userSelection",function(f){return r._handleUserSelection(f)})("_userDragDrop",function(f){return r._handleUserDragDrop(f)}),le(),vt(2,Roe,0,0,"ng-template",2),ae(3,"button",3),Tt("focus",function(){return r._closeButtonFocused=!0})("blur",function(){return r._closeButtonFocused=!1})("click",function(){return r.datepicker.close()}),Re(4),le()()),2&i){let l;Di("mat-datepicker-content-container-with-custom-header",r.datepicker.calendarHeaderComponent)("mat-datepicker-content-container-with-actions",r._actionsPortal),ii("aria-modal",!0)("aria-labelledby",null!==(l=r._dialogLabelId)&&void 0!==l?l:void 0),xe(),Kf(r.datepicker.panelClass),Xe("id",r.datepicker.id)("startAt",r.datepicker.startAt)("startView",r.datepicker.startView)("minDate",r.datepicker._getMinDate())("maxDate",r.datepicker._getMaxDate())("dateFilter",r.datepicker._getDateFilter())("headerComponent",r.datepicker.calendarHeaderComponent)("selected",r._getSelected())("dateClass",r.datepicker.dateClass)("comparisonStart",r.comparisonStart)("comparisonEnd",r.comparisonEnd)("startDateAccessibleName",r.startDateAccessibleName)("endDateAccessibleName",r.endDateAccessibleName),xe(),Xe("cdkPortalOutlet",r._actionsPortal),xe(),Di("cdk-visually-hidden",!r._closeButtonFocused),Xe("color",r.color||"primary"),xe(),er(r._closeButtonText)}},dependencies:[xK,zP,qy,jg],styles:["@keyframes _mat-datepicker-content-dropdown-enter{from{opacity:0;transform:scaleY(0.8)}to{opacity:1;transform:none}}@keyframes _mat-datepicker-content-dialog-enter{from{opacity:0;transform:scale(0.8)}to{opacity:1;transform:none}}@keyframes _mat-datepicker-content-exit{from{opacity:1}to{opacity:0}}.mat-datepicker-content{display:block;border-radius:4px;background-color:var(--mat-datepicker-calendar-container-background-color, var(--mat-sys-surface-container-high));color:var(--mat-datepicker-calendar-container-text-color, var(--mat-sys-on-surface));box-shadow:var(--mat-datepicker-calendar-container-elevation-shadow, 0px 0px 0px 0px rgba(0, 0, 0, 0.2), 0px 0px 0px 0px rgba(0, 0, 0, 0.14), 0px 0px 0px 0px rgba(0, 0, 0, 0.12));border-radius:var(--mat-datepicker-calendar-container-shape, var(--mat-sys-corner-large))}.mat-datepicker-content.mat-datepicker-content-animations-enabled{animation:_mat-datepicker-content-dropdown-enter 120ms cubic-bezier(0, 0, 0.2, 1)}.mat-datepicker-content .mat-calendar{width:296px;height:354px}.mat-datepicker-content .mat-datepicker-content-container-with-custom-header .mat-calendar{height:auto}.mat-datepicker-content .mat-datepicker-close-button{position:absolute;top:100%;left:0;margin-top:8px}.mat-datepicker-content-animating .mat-datepicker-content .mat-datepicker-close-button{display:none}.mat-datepicker-content-container{display:flex;flex-direction:column;justify-content:space-between}.mat-datepicker-content-touch{display:block;max-height:80vh;box-shadow:var(--mat-datepicker-calendar-container-touch-elevation-shadow, 0px 0px 0px 0px rgba(0, 0, 0, 0.2), 0px 0px 0px 0px rgba(0, 0, 0, 0.14), 0px 0px 0px 0px rgba(0, 0, 0, 0.12));border-radius:var(--mat-datepicker-calendar-container-touch-shape, var(--mat-sys-corner-extra-large));position:relative;overflow:visible}.mat-datepicker-content-touch.mat-datepicker-content-animations-enabled{animation:_mat-datepicker-content-dialog-enter 150ms cubic-bezier(0, 0, 0.2, 1)}.mat-datepicker-content-touch .mat-datepicker-content-container{min-height:312px;max-height:788px;min-width:250px;max-width:750px}.mat-datepicker-content-touch .mat-calendar{width:100%;height:auto}.mat-datepicker-content-exit.mat-datepicker-content-animations-enabled{animation:_mat-datepicker-content-exit 100ms linear}@media all and (orientation: landscape){.mat-datepicker-content-touch .mat-datepicker-content-container{width:64vh;height:80vh}}@media all and (orientation: portrait){.mat-datepicker-content-touch .mat-datepicker-content-container{width:80vw;height:100vw}.mat-datepicker-content-touch .mat-datepicker-content-container-with-actions{height:115vw}}\n"],encapsulation:2,changeDetection:0})}return t})(),MU=(()=>{class t{_overlay=te(oa);_viewContainerRef=te(io);_dateAdapter=te(Pl,{optional:!0});_dir=te(Bc,{optional:!0});_model=te(Zg);_scrollStrategy=te(SU);_inputStateChanges=Mi.EMPTY;_document=te(mr);calendarHeaderComponent;get startAt(){return this._startAt||(this.datepickerInput?this.datepickerInput.getStartValue():null)}set startAt(e){this._startAt=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(e))}_startAt;startView="month";get color(){return this._color||(this.datepickerInput?this.datepickerInput.getThemePalette():void 0)}set color(e){this._color=e}_color;touchUi=!1;get disabled(){return void 0===this._disabled&&this.datepickerInput?this.datepickerInput.disabled:!!this._disabled}set disabled(e){e!==this._disabled&&(this._disabled=e,this.stateChanges.next(void 0))}_disabled;xPosition="start";yPosition="below";restoreFocus=!0;yearSelected=new $e;monthSelected=new $e;viewChanged=new $e(!0);dateClass;openedStream=new $e;closedStream=new $e;get panelClass(){return this._panelClass}set panelClass(e){this._panelClass=function voe(t,n=/\s+/){const e=[];if(null!=t){const i=Array.isArray(t)?t:`${t}`.split(n);for(const r of i){const l=`${r}`.trim();l&&e.push(l)}}return e}(e)}_panelClass;get opened(){return this._opened}set opened(e){e?this.open():this.close()}_opened=!1;id=te(Sa).getId("mat-datepicker-");_getMinDate(){return this.datepickerInput&&this.datepickerInput.min}_getMaxDate(){return this.datepickerInput&&this.datepickerInput.max}_getDateFilter(){return this.datepickerInput&&this.datepickerInput.dateFilter}_overlayRef;_componentRef;_focusedElementBeforeOpen=null;_backdropHarnessClass=`${this.id}-backdrop`;_actionsPortal;datepickerInput;stateChanges=new Et;_injector=te(we);_changeDetectorRef=te(Do);constructor(){this._model.selectionChanged.subscribe(()=>{this._changeDetectorRef.markForCheck()})}ngOnChanges(e){const i=e.xPosition||e.yPosition;if(i&&!i.firstChange&&this._overlayRef){const r=this._overlayRef.getConfig().positionStrategy;r instanceof xV&&(this._setConnectedPositions(r),this.opened&&this._overlayRef.updatePosition())}this.stateChanges.next(void 0)}ngOnDestroy(){this._destroyOverlay(),this.close(),this._inputStateChanges.unsubscribe(),this.stateChanges.complete()}select(e){this._model.add(e)}_selectYear(e){this.yearSelected.emit(e)}_selectMonth(e){this.monthSelected.emit(e)}_viewChanged(e){this.viewChanged.emit(e)}registerInput(e){return this._inputStateChanges.unsubscribe(),this.datepickerInput=e,this._inputStateChanges=e.stateChanges.subscribe(()=>this.stateChanges.next(void 0)),this._model}registerActions(e){this._actionsPortal=e,this._componentRef?.instance._assignActions(e,!0)}removeActions(e){e===this._actionsPortal&&(this._actionsPortal=null,this._componentRef?.instance._assignActions(null,!0))}open(){this._opened||this.disabled||this._componentRef?.instance._isAnimating||(this._focusedElementBeforeOpen=MC(),this._openOverlay(),this._opened=!0,this.openedStream.emit())}close(){if(!this._opened||this._componentRef?.instance._isAnimating)return;const e=this.restoreFocus&&this._focusedElementBeforeOpen&&"function"==typeof this._focusedElementBeforeOpen.focus,i=()=>{this._opened&&(this._opened=!1,this.closedStream.emit())};if(this._componentRef){const{instance:r,location:l}=this._componentRef;r._animationDone.pipe(Qa(1)).subscribe(()=>{const f=this._document.activeElement;e&&(!f||f===this._document.activeElement||l.nativeElement.contains(f))&&this._focusedElementBeforeOpen.focus(),this._focusedElementBeforeOpen=null,this._destroyOverlay()}),r._startExitAnimation()}e?setTimeout(i):i()}_applyPendingSelection(){this._componentRef?.instance?._applyPendingSelection()}_forwardContentValues(e){e.datepicker=this,e.color=this.color,e._dialogLabelId=this.datepickerInput.getOverlayLabelId(),e._assignActions(this._actionsPortal,!1)}_openOverlay(){this._destroyOverlay();const e=this.touchUi,i=new zg(DU,this._viewContainerRef),r=this._overlayRef=this._overlay.create(new FC({positionStrategy:e?this._getDialogStrategy():this._getDropdownStrategy(),hasBackdrop:!0,backdropClass:[e?"cdk-overlay-dark-backdrop":"mat-overlay-transparent-backdrop",this._backdropHarnessClass],direction:this._dir||"ltr",scrollStrategy:e?this._overlay.scrollStrategies.block():this._scrollStrategy(),panelClass:"mat-datepicker-"+(e?"dialog":"popup")}));this._getCloseStream(r).subscribe(l=>{l&&l.preventDefault(),this.close()}),r.keydownEvents().subscribe(l=>{const f=l.keyCode;(38===f||40===f||37===f||39===f||33===f||34===f)&&l.preventDefault()}),this._componentRef=r.attach(i),this._forwardContentValues(this._componentRef.instance),e||El(()=>{r.updatePosition()},{injector:this._injector})}_destroyOverlay(){this._overlayRef&&(this._overlayRef.dispose(),this._overlayRef=this._componentRef=null)}_getDialogStrategy(){return this._overlay.position().global().centerHorizontally().centerVertically()}_getDropdownStrategy(){const e=this._overlay.position().flexibleConnectedTo(this.datepickerInput.getConnectedOverlayOrigin()).withTransformOriginOn(".mat-datepicker-content").withFlexibleDimensions(!1).withViewportMargin(8).withLockedPosition();return this._setConnectedPositions(e)}_setConnectedPositions(e){const i="end"===this.xPosition?"end":"start",r="start"===i?"end":"start",l="above"===this.yPosition?"bottom":"top",f="top"===l?"bottom":"top";return e.withPositions([{originX:i,originY:f,overlayX:i,overlayY:l},{originX:i,originY:l,overlayX:i,overlayY:f},{originX:r,originY:f,overlayX:r,overlayY:l},{originX:r,originY:l,overlayX:r,overlayY:f}])}_getCloseStream(e){const i=["ctrlKey","shiftKey","metaKey"];return zc(e.backdropClick(),e.detachments(),e.keydownEvents().pipe(bs(r=>27===r.keyCode&&!Ja(r)||this.datepickerInput&&Ja(r,"altKey")&&38===r.keyCode&&i.every(l=>!Ja(r,l)))))}static \u0275fac=function(i){return new(i||t)};static \u0275dir=Ht({type:t,inputs:{calendarHeaderComponent:"calendarHeaderComponent",startAt:"startAt",startView:"startView",color:"color",touchUi:[2,"touchUi","touchUi",Un],disabled:[2,"disabled","disabled",Un],xPosition:"xPosition",yPosition:"yPosition",restoreFocus:[2,"restoreFocus","restoreFocus",Un],dateClass:"dateClass",panelClass:"panelClass",opened:[2,"opened","opened",Un]},outputs:{yearSelected:"yearSelected",monthSelected:"monthSelected",viewChanged:"viewChanged",openedStream:"opened",closedStream:"closed"},features:[Mr]})}return t})(),Zoe=(()=>{class t extends MU{static \u0275fac=(()=>{let e;return function(r){return(e||(e=m(t)))(r||t)}})();static \u0275cmp=kn({type:t,selectors:[["mat-datepicker"]],exportAs:["matDatepicker"],features:[pi([_U,{provide:MU,useExisting:t}]),Nn],decls:0,vars:0,template:function(i,r){},encapsulation:2,changeDetection:0})}return t})();class KT{target;targetElement;value;constructor(n,e){this.target=n,this.targetElement=e,this.value=this.target.value}}let Xoe=(()=>{class t{_elementRef=te(Dn);_dateAdapter=te(Pl,{optional:!0});_dateFormats=te(ax,{optional:!0});_isInitialized;get value(){return this._model?this._getValueFromModel(this._model.selection):this._pendingValue}set value(e){this._assignValueProgrammatically(e)}_model;get disabled(){return!!this._disabled||this._parentDisabled()}set disabled(e){const i=e,r=this._elementRef.nativeElement;this._disabled!==i&&(this._disabled=i,this.stateChanges.next(void 0)),i&&this._isInitialized&&r.blur&&r.blur()}_disabled;dateChange=new $e;dateInput=new $e;stateChanges=new Et;_onTouched=()=>{};_validatorOnChange=()=>{};_cvaOnChange=()=>{};_valueChangesSubscription=Mi.EMPTY;_localeSubscription=Mi.EMPTY;_pendingValue;_parseValidator=()=>this._lastValueValid?null:{matDatepickerParse:{text:this._elementRef.nativeElement.value}};_filterValidator=e=>{const i=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(e.value));return!i||this._matchesFilter(i)?null:{matDatepickerFilter:!0}};_minValidator=e=>{const i=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(e.value)),r=this._getMinDate();return!r||!i||this._dateAdapter.compareDate(r,i)<=0?null:{matDatepickerMin:{min:r,actual:i}}};_maxValidator=e=>{const i=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(e.value)),r=this._getMaxDate();return!r||!i||this._dateAdapter.compareDate(r,i)>=0?null:{matDatepickerMax:{max:r,actual:i}}};_getValidators(){return[this._parseValidator,this._minValidator,this._maxValidator,this._filterValidator]}_registerModel(e){this._model=e,this._valueChangesSubscription.unsubscribe(),this._pendingValue&&this._assignValue(this._pendingValue),this._valueChangesSubscription=this._model.selectionChanged.subscribe(i=>{if(this._shouldHandleChangeEvent(i)){const r=this._getValueFromModel(i.selection);this._lastValueValid=this._isValidValue(r),this._cvaOnChange(r),this._onTouched(),this._formatValue(r),this.dateInput.emit(new KT(this,this._elementRef.nativeElement)),this.dateChange.emit(new KT(this,this._elementRef.nativeElement))}})}_lastValueValid=!1;constructor(){this._localeSubscription=this._dateAdapter.localeChanges.subscribe(()=>{this._assignValueProgrammatically(this.value)})}ngAfterViewInit(){this._isInitialized=!0}ngOnChanges(e){(function Koe(t,n){const e=Object.keys(t);for(let i of e){const{previousValue:r,currentValue:l}=t[i];if(!n.isDateInstance(r)||!n.isDateInstance(l))return!0;if(!n.sameDate(r,l))return!0}return!1})(e,this._dateAdapter)&&this.stateChanges.next(void 0)}ngOnDestroy(){this._valueChangesSubscription.unsubscribe(),this._localeSubscription.unsubscribe(),this.stateChanges.complete()}registerOnValidatorChange(e){this._validatorOnChange=e}validate(e){return this._validator?this._validator(e):null}writeValue(e){this._assignValueProgrammatically(e)}registerOnChange(e){this._cvaOnChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e}_onKeydown(e){Ja(e,"altKey")&&40===e.keyCode&&["ctrlKey","shiftKey","metaKey"].every(l=>!Ja(e,l))&&!this._elementRef.nativeElement.readOnly&&(this._openPopup(),e.preventDefault())}_onInput(e){const i=this._lastValueValid;let r=this._dateAdapter.parse(e,this._dateFormats.parse.dateInput);this._lastValueValid=this._isValidValue(r),r=this._dateAdapter.getValidDateOrNull(r);const l=!this._dateAdapter.sameDate(r,this.value);!r||l?this._cvaOnChange(r):(e&&!this.value&&this._cvaOnChange(r),i!==this._lastValueValid&&this._validatorOnChange()),l&&(this._assignValue(r),this.dateInput.emit(new KT(this,this._elementRef.nativeElement)))}_onChange(){this.dateChange.emit(new KT(this,this._elementRef.nativeElement))}_onBlur(){this.value&&this._formatValue(this.value),this._onTouched()}_formatValue(e){this._elementRef.nativeElement.value=null!=e?this._dateAdapter.format(e,this._dateFormats.display.dateInput):""}_assignValue(e){this._model?(this._assignValueToModel(e),this._pendingValue=null):this._pendingValue=e}_isValidValue(e){return!e||this._dateAdapter.isValid(e)}_parentDisabled(){return!1}_assignValueProgrammatically(e){e=this._dateAdapter.deserialize(e),this._lastValueValid=this._isValidValue(e),e=this._dateAdapter.getValidDateOrNull(e),this._assignValue(e),this._formatValue(e)}_matchesFilter(e){const i=this._getDateFilter();return!i||i(e)}static \u0275fac=function(i){return new(i||t)};static \u0275dir=Ht({type:t,inputs:{value:"value",disabled:[2,"disabled","disabled",Un]},outputs:{dateChange:"dateChange",dateInput:"dateInput"},features:[Mr]})}return t})();const Qoe={provide:Id,useExisting:ur(()=>BP),multi:!0},Joe={provide:sa,useExisting:ur(()=>BP),multi:!0};let BP=(()=>{class t extends Xoe{_formField=te(rE,{optional:!0});_closedSubscription=Mi.EMPTY;_openedSubscription=Mi.EMPTY;set matDatepicker(e){e&&(this._datepicker=e,this._ariaOwns.set(e.opened?e.id:null),this._closedSubscription=e.closedStream.subscribe(()=>{this._onTouched(),this._ariaOwns.set(null)}),this._openedSubscription=e.openedStream.subscribe(()=>{this._ariaOwns.set(e.id)}),this._registerModel(e.registerInput(this)))}_datepicker;_ariaOwns=wr(null);get min(){return this._min}set min(e){const i=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(e));this._dateAdapter.sameDate(i,this._min)||(this._min=i,this._validatorOnChange())}_min;get max(){return this._max}set max(e){const i=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(e));this._dateAdapter.sameDate(i,this._max)||(this._max=i,this._validatorOnChange())}_max;get dateFilter(){return this._dateFilter}set dateFilter(e){const i=this._matchesFilter(this.value);this._dateFilter=e,this._matchesFilter(this.value)!==i&&this._validatorOnChange()}_dateFilter;_validator;constructor(){super(),this._validator=bn.compose(super._getValidators())}getConnectedOverlayOrigin(){return this._formField?this._formField.getConnectedOverlayOrigin():this._elementRef}getOverlayLabelId(){return this._formField?this._formField.getLabelId():this._elementRef.nativeElement.getAttribute("aria-labelledby")}getThemePalette(){return this._formField?this._formField.color:void 0}getStartValue(){return this.value}ngOnDestroy(){super.ngOnDestroy(),this._closedSubscription.unsubscribe(),this._openedSubscription.unsubscribe()}_openPopup(){this._datepicker&&this._datepicker.open()}_getValueFromModel(e){return e}_assignValueToModel(e){this._model&&this._model.updateSelection(e,this)}_getMinDate(){return this._min}_getMaxDate(){return this._max}_getDateFilter(){return this._dateFilter}_shouldHandleChangeEvent(e){return e.source!==this}static \u0275fac=function(i){return new(i||t)};static \u0275dir=Ht({type:t,selectors:[["input","matDatepicker",""]],hostAttrs:[1,"mat-datepicker-input"],hostVars:6,hostBindings:function(i,r){1&i&&Tt("input",function(f){return r._onInput(f.target.value)})("change",function(){return r._onChange()})("blur",function(){return r._onBlur()})("keydown",function(f){return r._onKeydown(f)}),2&i&&(rc("disabled",r.disabled),ii("aria-haspopup",r._datepicker?"dialog":null)("aria-owns",r._ariaOwns())("min",r.min?r._dateAdapter.toIso8601(r.min):null)("max",r.max?r._dateAdapter.toIso8601(r.max):null)("data-mat-calendar",r._datepicker?r._datepicker.id:null))},inputs:{matDatepicker:"matDatepicker",min:"min",max:"max",dateFilter:[0,"matDatepickerFilter","dateFilter"]},exportAs:["matDatepickerInput"],features:[pi([Qoe,Joe,{provide:hU,useExisting:t}]),Nn]})}return t})(),ese=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275dir=Ht({type:t,selectors:[["","matDatepickerToggleIcon",""]]})}return t})(),TU=(()=>{class t{_intl=te(lx);_changeDetectorRef=te(Do);_stateChanges=Mi.EMPTY;datepicker;tabIndex;ariaLabel;get disabled(){return void 0===this._disabled&&this.datepicker?this.datepicker.disabled:!!this._disabled}set disabled(e){this._disabled=e}_disabled;disableRipple;_customIcon;_button;constructor(){const e=te(new Ee("tabindex"),{optional:!0}),i=Number(e);this.tabIndex=i||0===i?i:null}ngOnChanges(e){e.datepicker&&this._watchStateChanges()}ngOnDestroy(){this._stateChanges.unsubscribe()}ngAfterContentInit(){this._watchStateChanges()}_open(e){this.datepicker&&!this.disabled&&(this.datepicker.open(),e.stopPropagation())}_watchStateChanges(){const e=this.datepicker?this.datepicker.stateChanges:Fn(),i=this.datepicker&&this.datepicker.datepickerInput?this.datepicker.datepickerInput.stateChanges:Fn(),r=this.datepicker?zc(this.datepicker.openedStream,this.datepicker.closedStream):Fn();this._stateChanges.unsubscribe(),this._stateChanges=zc(this._intl.changes,e,i,r).subscribe(()=>this._changeDetectorRef.markForCheck())}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=kn({type:t,selectors:[["mat-datepicker-toggle"]],contentQueries:function(i,r,l){if(1&i&&ro(l,ese,5),2&i){let f;Zn(f=Xn())&&(r._customIcon=f.first)}},viewQuery:function(i,r){if(1&i&&kr(Poe,5),2&i){let l;Zn(l=Xn())&&(r._button=l.first)}},hostAttrs:[1,"mat-datepicker-toggle"],hostVars:8,hostBindings:function(i,r){1&i&&Tt("click",function(f){return r._open(f)}),2&i&&(ii("tabindex",null)("data-mat-calendar",r.datepicker?r.datepicker.id:null),Di("mat-datepicker-toggle-active",r.datepicker&&r.datepicker.opened)("mat-accent",r.datepicker&&"accent"===r.datepicker.color)("mat-warn",r.datepicker&&"warn"===r.datepicker.color))},inputs:{datepicker:[0,"for","datepicker"],tabIndex:"tabIndex",ariaLabel:[0,"aria-label","ariaLabel"],disabled:[2,"disabled","disabled",Un],disableRipple:"disableRipple"},exportAs:["matDatepickerToggle"],features:[Mr],ngContentSelectors:Foe,decls:4,vars:7,consts:[["button",""],["mat-icon-button","","type","button",3,"disabled","disableRipple"],["viewBox","0 0 24 24","width","24px","height","24px","fill","currentColor","focusable","false","aria-hidden","true",1,"mat-datepicker-toggle-default-icon"],["d","M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"]],template:function(i,r){1&i&&(os(Ooe),ae(0,"button",1,0),vt(2,Loe,2,0,":svg:svg",2),Fi(3),le()),2&i&&(Xe("disabled",r.disabled)("disableRipple",r.disableRipple),ii("aria-haspopup",r.datepicker?"dialog":null)("aria-label",r.ariaLabel||r._intl.openCalendarLabel)("tabindex",r.disabled?-1:r.tabIndex)("aria-expanded",r.datepicker?r.datepicker.opened:null),xe(2),qi(r._customIcon?-1:2))},dependencies:[Ug],styles:[".mat-datepicker-toggle{pointer-events:auto;color:var(--mat-datepicker-toggle-icon-color, var(--mat-sys-on-surface-variant))}.mat-datepicker-toggle-active{color:var(--mat-datepicker-toggle-active-state-icon-color, var(--mat-sys-on-surface-variant))}@media(forced-colors: active){.mat-datepicker-toggle-default-icon{color:CanvasText}}\n"],encapsulation:2,changeDetection:0})}return t})(),AU=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275mod=Er({type:t});static \u0275inj=Ai({providers:[lx,Yoe],imports:[Hg,LC,iR,DC,Qr,DU,TU,EU,RC]})}return t})(),ise=(()=>{class t{http;apiUrl=`${Cu_urlBack}/report-status-histories`;constructor(e){this.http=e}getAllHistories(e=1,i=20){const r=(new kl).set("page",e).set("size",i);return this.http.get(this.apiUrl,{params:r,withCredentials:!0})}getByReportId(e,i=1,r=20){const l=(new kl).set("page",i).set("size",r);return this.http.get(`${this.apiUrl}/by-report`,{params:l.set("reportId",e),withCredentials:!0})}getByUserId(e,i=1,r=20){const l=(new kl).set("page",i).set("size",r);return this.http.get(`${this.apiUrl}/by-user`,{params:l.set("userId",e),withCredentials:!0})}getByPreviousStatus(e,i=1,r=20){const l=(new kl).set("page",i).set("size",r);return this.http.get(`${this.apiUrl}/by-previous-status`,{params:l.set("previousStatus",e),withCredentials:!0})}getByNewStatus(e,i=1,r=20){const l=(new kl).set("page",i).set("size",r);return this.http.get(`${this.apiUrl}/by-new-satatus`,{params:l.set("newStatus",e),withCredentials:!0})}getByStatus(e,i,r=1,l=20){return e&&!i?this.getByPreviousStatus(e,r,l):!e&&i?this.getByNewStatus(i,r,l):this.getAllHistories(r,l)}static \u0275fac=function(i){return new(i||t)(gn(Eu))};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();const rse=()=>[10,20,50,100],kU=(t,n,e,i,r)=>({"status-pending":t,"status-rejected":n,"status-verified":e,"status-resolved":i,"status-na":r});function ose(t,n){1&t&&(Qi(0),ae(1,"mat-form-field",3)(2,"mat-label"),Re(3,"ID de Reporte"),le(),Wt(4,"input",16),le(),Ji())}function sse(t,n){1&t&&(Qi(0),ae(1,"mat-form-field",3)(2,"mat-label"),Re(3,"ID de Usuario"),le(),Wt(4,"input",17),le(),Ji())}function ase(t,n){1&t&&(Qi(0),ae(1,"mat-form-field",3)(2,"mat-label"),Re(3,"Estado Anterior"),le(),ae(4,"mat-select",18)(5,"mat-option",19),Re(6,"PENDING"),le(),ae(7,"mat-option",20),Re(8,"DELETED"),le(),ae(9,"mat-option",21),Re(10,"VERIFIED"),le(),ae(11,"mat-option",22),Re(12,"RESOLVED"),le(),ae(13,"mat-option",23),Re(14,"REJECTED"),le()()(),Ji())}function lse(t,n){1&t&&(Qi(0),ae(1,"mat-form-field",3)(2,"mat-label"),Re(3,"Estado Nuevo"),le(),ae(4,"mat-select",24)(5,"mat-option",19),Re(6,"PENDING"),le(),ae(7,"mat-option",20),Re(8,"DELETED"),le(),ae(9,"mat-option",21),Re(10,"VERIFIED"),le(),ae(11,"mat-option",22),Re(12,"RESOLVED"),le(),ae(13,"mat-option",23),Re(14,"REJECTED"),le()()(),Ji())}function cse(t,n){1&t&&(ae(0,"div",14),Wt(1,"mat-spinner",25),ae(2,"span"),Re(3,"Cargando historial..."),le()())}function dse(t,n){1&t&&(ae(0,"th",38),Re(1,"ID"),le())}function use(t,n){if(1&t&&(ae(0,"td",39),Re(1),le()),2&t){const e=n.$implicit;xe(),er(e.id)}}function hse(t,n){1&t&&(ae(0,"th",38),Re(1,"Reporte ID"),le())}function pse(t,n){if(1&t&&(ae(0,"td",39),Re(1),le()),2&t){const e=n.$implicit;xe(),er(e.reportId)}}function fse(t,n){1&t&&(ae(0,"th",38),Re(1,"Usuario ID"),le())}function mse(t,n){if(1&t&&(ae(0,"td",39),Re(1),le()),2&t){const e=n.$implicit;xe(),er(e.userId)}}function gse(t,n){1&t&&(ae(0,"th",38),Re(1,"Estado Anterior"),le())}function _se(t,n){if(1&t&&(ae(0,"td",39)(1,"span",40),Re(2),le()()),2&t){const e=n.$implicit;xe(),Xe("ngClass",bk(2,kU,"PENDING"===e.previousStatus,"REJECTED"===e.previousStatus,"VERIFIED"===e.previousStatus,"RESOLVED"===e.previousStatus,!e.previousStatus)),xe(),Ci(" ",e.previousStatus||"N/A"," ")}}function yse(t,n){1&t&&(ae(0,"th",38),Re(1,"Estado Nuevo"),le())}function vse(t,n){if(1&t&&(ae(0,"td",39)(1,"span",40),Re(2),le()()),2&t){const e=n.$implicit;xe(),Xe("ngClass",bk(2,kU,"PENDING"===e.newStatus,"REJECTED"===e.newStatus,"VERIFIED"===e.newStatus,"RESOLVED"===e.newStatus,!e.newStatus)),xe(),Ci(" ",e.newStatus||"N/A"," ")}}function bse(t,n){1&t&&(ae(0,"th",38),Re(1,"Fecha Cambio"),le())}function xse(t,n){if(1&t&&(ae(0,"td",39),Re(1),Jf(2,"date"),le()),2&t){const e=n.$implicit;xe(),er(S0(2,1,e.changedAt,"medium"))}}function wse(t,n){1&t&&Wt(0,"tr",41)}function Cse(t,n){1&t&&Wt(0,"tr",42)}function Ese(t,n){if(1&t){const e=_i();ae(0,"div",15)(1,"table",26),Qi(2,27),vt(3,dse,2,0,"th",28)(4,use,2,1,"td",29),Ji(),Qi(5,30),vt(6,hse,2,0,"th",28)(7,pse,2,1,"td",29),Ji(),Qi(8,31),vt(9,fse,2,0,"th",28)(10,mse,2,1,"td",29),Ji(),Qi(11,32),vt(12,gse,2,0,"th",28)(13,_se,3,8,"td",29),Ji(),Qi(14,33),vt(15,yse,2,0,"th",28)(16,vse,3,8,"td",29),Ji(),Qi(17,34),vt(18,bse,2,0,"th",28)(19,xse,3,4,"td",29),Ji(),vt(20,wse,1,0,"tr",35)(21,Cse,1,0,"tr",36),le(),ae(22,"mat-paginator",37),Tt("page",function(r){return on(e),ln(Lt().onPageChange(r))}),le()()}if(2&t){const e=Lt();xe(),Xe("dataSource",e.paginatedData().content),xe(19),Xe("matHeaderRowDef",e.displayedColumns),xe(),Xe("matRowDefColumns",e.displayedColumns),xe(),Xe("length",e.paginatedData().totalElements)("pageSize",e.paginatedData().size)("pageSizeOptions",HD(7,rse))("pageIndex",e.paginatedData().page-1)}}let Sse=(()=>{class t{historyService=te(ise);notificationService=te(Uc);fb=te(Bp);router=te(oo);loading=wr(!1);paginatedData=wr({content:[],page:0,size:20,totalElements:0,totalPages:0});statusOptions=[{value:"",display:"Todos"},{value:"PENDING",display:"Pendiente"},{value:"DELETED",display:"Eliminado"},{value:"VERIFIED",display:"Verificado"},{value:"RESOLVED",display:"Resuelto"},{value:"REJECTED",display:"Rechazado"}];filterForm=this.fb.group({filterType:["all"],reportId:[""],userId:[""],previousStatus:[""],newStatus:[""],startDate:[""],endDate:[""]});displayedColumns=["id","reportId","userId","previousStatus","newStatus","changedAt"];ngOnInit(){this.loadAllHistories(1,20)}loadAllHistories(e,i){this.loading.set(!0),this.historyService.getAllHistories(e,i).subscribe({next:r=>this.handleSuccessResponse(r),error:r=>this.handleError(r)})}loadByReportId(e,i,r){this.loading.set(!0),this.historyService.getByReportId(e,i,r).subscribe({next:l=>this.handleSuccessResponse(l),error:l=>this.handleError(l)})}loadByUserId(e,i,r){this.loading.set(!0),this.historyService.getByUserId(e,i,r).subscribe({next:l=>this.handleSuccessResponse(l),error:l=>this.handleError(l)})}loadByPreviousStatus(e,i,r){this.loading.set(!0),this.historyService.getByPreviousStatus(e,i,r).subscribe({next:l=>this.handleSuccessResponse(l),error:l=>this.handleError(l)})}loadByNewStatus(e,i,r){this.loading.set(!0),this.historyService.getByNewStatus(e,i,r).subscribe({next:l=>this.handleSuccessResponse(l),error:l=>this.handleError(l)})}loadByBothStatuses(e,i,r,l){this.loading.set(!0),this.historyService.getByStatus(e,i,r,l).subscribe({next:f=>this.handleSuccessResponse(f),error:f=>this.handleError(f)})}handleSuccessResponse(e){this.paginatedData.set({...e,content:e.content.map(i=>({...i,changedAt:new Date(i.changedAt)}))}),this.loading.set(!1)}handleError(e){console.error("Error cargando historiales",e),this.notificationService.error("No se pudo cargar el historial."),this.loading.set(!1)}onPageChange(e){const{filterType:i,...r}=this.filterForm.value,l=e.pageIndex+1,f=e.pageSize;switch(i){case"by-report":this.loadByReportId(r.reportId,l,f);break;case"by-user":this.loadByUserId(r.userId,l,f);break;case"by-previous-status":this.loadByPreviousStatus(r.previousStatus,l,f);break;case"by-new-status":this.loadByNewStatus(r.newStatus,l,f);break;case"by-status":this.loadByBothStatuses(r.previousStatus,r.newStatus,l,f);break;default:this.loadAllHistories(l,f)}}applyFilters(){const e=this.filterForm.value,r=this.paginatedData().size;switch(e.filterType){case"by-report":if(!e.reportId)return void this.notificationService.error("Debe ingresar un ID de reporte");this.loadByReportId(e.reportId,1,r);break;case"by-user":if(!e.userId)return void this.notificationService.error("Debe ingresar un ID de usuario");this.loadByUserId(e.userId,1,r);break;case"by-previous-status":this.loadByPreviousStatus(e.previousStatus||"",1,r);break;case"by-new-status":this.loadByNewStatus(e.newStatus||"",1,r);break;case"by-status":this.loadByBothStatuses(e.previousStatus||"",e.newStatus||"",1,r);break;default:this.loadAllHistories(1,r)}}clearFilters(){this.filterForm.reset({filterType:"all"}),this.loadAllHistories(1,this.paginatedData().size)}goBack(){this.router.navigate(["/map"])}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=kn({type:t,selectors:[["app-history-list"]],decls:40,vars:9,consts:[["mat-icon-button","","aria-label","Volver",1,"back-button",3,"click"],[1,"filter-form",3,"ngSubmit","formGroup"],[1,"filter-row"],["appearance","outline"],["formControlName","filterType"],["value","all"],["value","by-report"],["value","by-user"],["value","by-previous-status"],["value","by-new-status"],[4,"ngIf"],[1,"filter-actions"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["mat-button","","type","button",3,"click","disabled"],[1,"loading-section"],[1,"table-container"],["matInput","","formControlName","reportId","required",""],["matInput","","formControlName","userId","required",""],["formControlName","previousStatus"],["value","PENDING"],["value","DELETED"],["value","VERIFIED"],["value","RESOLVED"],["value","REJECTED"],["formControlName","newStatus"],["diameter","40"],["mat-table","",1,"mat-elevation-z8",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","reportId"],["matColumnDef","userId"],["matColumnDef","previousStatus"],["matColumnDef","newStatus"],["matColumnDef","changedAt"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["aria-label","Seleccionar p\xe1gina",3,"page","length","pageSize","pageSizeOptions","pageIndex"],["mat-header-cell",""],["mat-cell",""],[3,"ngClass"],["mat-header-row",""],["mat-row",""]],template:function(i,r){if(1&i&&(ae(0,"button",0),Tt("click",function(){return r.goBack()}),ae(1,"mat-icon"),Re(2,"arrow_back"),le()(),ae(3,"mat-card")(4,"mat-card-header")(5,"mat-card-title"),Re(6,"Historial de Cambios de Estado"),le()(),Wt(7,"br"),ae(8,"mat-card-content")(9,"form",1),Tt("ngSubmit",function(){return r.applyFilters()}),ae(10,"div",2)(11,"mat-form-field",3)(12,"mat-label"),Re(13,"Tipo de Filtro"),le(),ae(14,"mat-select",4)(15,"mat-option",5),Re(16,"Todos los historiales"),le(),ae(17,"mat-option",6),Re(18,"Por Reporte"),le(),ae(19,"mat-option",7),Re(20,"Por Usuario"),le(),ae(21,"mat-option",8),Re(22,"Por Estado Anterior"),le(),ae(23,"mat-option",9),Re(24,"Por Nuevo Estado"),le()()(),vt(25,ose,5,0,"ng-container",10)(26,sse,5,0,"ng-container",10)(27,ase,15,0,"ng-container",10)(28,lse,15,0,"ng-container",10),le(),ae(29,"div",11)(30,"button",12)(31,"mat-icon"),Re(32,"search"),le(),Re(33," Filtrar "),le(),ae(34,"button",13),Tt("click",function(){return r.clearFilters()}),ae(35,"mat-icon"),Re(36,"clear"),le(),Re(37," Limpiar "),le()()(),vt(38,cse,4,0,"div",14)(39,Ese,23,8,"div",15),le()()),2&i){let l,f,w,M;xe(9),Xe("formGroup",r.filterForm),xe(16),Xe("ngIf","by-report"===(null==(l=r.filterForm.get("filterType"))?null:l.value)),xe(),Xe("ngIf","by-user"===(null==(f=r.filterForm.get("filterType"))?null:f.value)),xe(),Xe("ngIf","by-previous-status"===(null==(w=r.filterForm.get("filterType"))?null:w.value)),xe(),Xe("ngIf","by-new-status"===(null==(M=r.filterForm.get("filterType"))?null:M.value)),xe(2),Xe("disabled",r.loading()||r.filterForm.invalid),xe(4),Xe("disabled",r.loading()),xe(4),qi(r.loading()?38:-1),xe(),qi(r.loading()?-1:39)}},dependencies:[Ea,im,Os,I0,nx,lv,lE,cE,aE,xP,uE,rx,NT,JC,X0,eE,K0,Z0,tE,Q0,J0,nE,iE,yP,GT,Wg,tx,ex,AP,IP,Hg,jg,Ug,Up,kd,sE,HT,oE,AU,MT,kh,dc,Ad,Ah,ST,Vp,el,Mu,z0],styles:["[_ngcontent-%COMP%]:root{--primary-bg: #e0f4fa;--primary-accent: #79b4d8;--primary-dark: #1e3a5f;--input-bg: #ffffff;--error-color: #e74c3c;--resolve-color: #26a69a;--table-header-bg: #d0eaf5;--table-row-hover: #f2faff}mat-card[_ngcontent-%COMP%]{margin:1.5rem auto;padding:1rem;background:var(--input-bg);border-radius:8px;box-shadow:0 4px 12px #0000000d}mat-card[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin-bottom:.5rem;color:var(--primary-dark);font-size:20px}.loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:40px 0}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}th.mat-header-cell[_ngcontent-%COMP%]{background:var(--table-header-bg);font-weight:600;padding:8px}td.mat-cell[_ngcontent-%COMP%]{padding:8px;border-bottom:1px solid #eee}tr.mat-row[_ngcontent-%COMP%]:hover{background:var(--table-row-hover);transition:background .2s}.status-pending[_ngcontent-%COMP%], .status-rejected[_ngcontent-%COMP%], .status-verified[_ngcontent-%COMP%], .status-resolved[_ngcontent-%COMP%]{display:inline-block;padding:4px 8px;border-radius:4px;font-weight:600;font-size:12px;text-transform:uppercase}.status-pending[_ngcontent-%COMP%]{background:#fff59d;color:#444}.status-rejected[_ngcontent-%COMP%]{background:#ef9a9a;color:#fff}.status-verified[_ngcontent-%COMP%]{background:#a5d6a7;color:#fff}.status-resolved[_ngcontent-%COMP%]{background:#81d4fa;color:#fff}mat-paginator[_ngcontent-%COMP%]{margin-top:1rem}.back-button[_ngcontent-%COMP%]{position:fixed;top:16px;left:16px;z-index:1000;background-color:#fff;border-radius:50%;box-shadow:0 2px 6px #0003}"]})}return t})();const Dse=/^\d{4}-\d{2}-\d{2}(?:T\d{2}:\d{2}:\d{2}(?:\.\d+)?(?:Z|(?:(?:\+|-)\d{2}:\d{2}))?)?$/,Mse=/^(\d?\d)[:.](\d?\d)(?:[:.](\d?\d))?\s*(AM|PM)?$/i;function UP(t,n){const e=Array(t);for(let i=0;i<t;i++)e[i]=n(i);return e}let Tse=(()=>{class t extends Pl{useUtcForDisplay=!1;_matDateLocale=te(pU,{optional:!0});constructor(){super();const e=te(pU,{optional:!0});void 0!==e&&(this._matDateLocale=e),super.setLocale(this._matDateLocale)}getYear(e){return e.getFullYear()}getMonth(e){return e.getMonth()}getDate(e){return e.getDate()}getDayOfWeek(e){return e.getDay()}getMonthNames(e){const i=new Intl.DateTimeFormat(this.locale,{month:e,timeZone:"utc"});return UP(12,r=>this._format(i,new Date(2017,r,1)))}getDateNames(){const e=new Intl.DateTimeFormat(this.locale,{day:"numeric",timeZone:"utc"});return UP(31,i=>this._format(e,new Date(2017,0,i+1)))}getDayOfWeekNames(e){const i=new Intl.DateTimeFormat(this.locale,{weekday:e,timeZone:"utc"});return UP(7,r=>this._format(i,new Date(2017,0,r+1)))}getYearName(e){const i=new Intl.DateTimeFormat(this.locale,{year:"numeric",timeZone:"utc"});return this._format(i,e)}getFirstDayOfWeek(){if(typeof Intl<"u"&&Intl.Locale){const e=new Intl.Locale(this.locale),i=(e.getWeekInfo?.()||e.weekInfo)?.firstDay??0;return 7===i?0:i}return 0}getNumDaysInMonth(e){return this.getDate(this._createDateWithOverflow(this.getYear(e),this.getMonth(e)+1,0))}clone(e){return new Date(e.getTime())}createDate(e,i,r){let l=this._createDateWithOverflow(e,i,r);return l.getMonth(),l}today(){return new Date}parse(e,i){return"number"==typeof e?new Date(e):e?new Date(Date.parse(e)):null}format(e,i){if(!this.isValid(e))throw Error("NativeDateAdapter: Cannot format invalid date.");const r=new Intl.DateTimeFormat(this.locale,{...i,timeZone:"utc"});return this._format(r,e)}addCalendarYears(e,i){return this.addCalendarMonths(e,12*i)}addCalendarMonths(e,i){let r=this._createDateWithOverflow(this.getYear(e),this.getMonth(e)+i,this.getDate(e));return this.getMonth(r)!=((this.getMonth(e)+i)%12+12)%12&&(r=this._createDateWithOverflow(this.getYear(r),this.getMonth(r),0)),r}addCalendarDays(e,i){return this._createDateWithOverflow(this.getYear(e),this.getMonth(e),this.getDate(e)+i)}toIso8601(e){return[e.getUTCFullYear(),this._2digit(e.getUTCMonth()+1),this._2digit(e.getUTCDate())].join("-")}deserialize(e){if("string"==typeof e){if(!e)return null;if(Dse.test(e)){let i=new Date(e);if(this.isValid(i))return i}}return super.deserialize(e)}isDateInstance(e){return e instanceof Date}isValid(e){return!isNaN(e.getTime())}invalid(){return new Date(NaN)}setTime(e,i,r,l){const f=this.clone(e);return f.setHours(i,r,l,0),f}getHours(e){return e.getHours()}getMinutes(e){return e.getMinutes()}getSeconds(e){return e.getSeconds()}parseTime(e,i){if("string"!=typeof e)return e instanceof Date?new Date(e.getTime()):null;const r=e.trim();if(0===r.length)return null;let l=this._parseTimeString(r);if(null===l){const f=r.replace(/[^0-9:(AM|PM)]/gi,"").trim();f.length>0&&(l=this._parseTimeString(f))}return l||this.invalid()}addSeconds(e,i){return new Date(e.getTime()+1e3*i)}_createDateWithOverflow(e,i,r){const l=new Date;return l.setFullYear(e,i,r),l.setHours(0,0,0,0),l}_2digit(e){return("00"+e).slice(-2)}_format(e,i){const r=new Date;return r.setUTCFullYear(i.getFullYear(),i.getMonth(),i.getDate()),r.setUTCHours(i.getHours(),i.getMinutes(),i.getSeconds(),i.getMilliseconds()),e.format(r)}_parseTimeString(e){const i=e.toUpperCase().match(Mse);if(i){let r=parseInt(i[1]);const l=parseInt(i[2]);let f=null==i[3]?void 0:parseInt(i[3]);const w=i[4];if(12===r?r="AM"===w?0:r:"PM"===w&&(r+=12),jP(r,0,23)&&jP(l,0,59)&&(null==f||jP(f,0,59)))return this.setTime(this.today(),r,l,f||0)}return null}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Nt({token:t,factory:t.\u0275fac})}return t})();function jP(t,n,e){return!isNaN(t)&&t>=n&&t<=e}const Ise={parse:{dateInput:null,timeInput:null},display:{dateInput:{year:"numeric",month:"numeric",day:"numeric"},timeInput:{hour:"numeric",minute:"numeric"},monthYearLabel:{year:"numeric",month:"short"},dateA11yLabel:{year:"numeric",month:"long",day:"numeric"},monthYearA11yLabel:{year:"numeric",month:"long"},timeOptionLabel:{hour:"numeric",minute:"numeric"}}};let Ase=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275mod=Er({type:t});static \u0275inj=Ai({providers:[kse()]})}return t})();function kse(t=Ise){return[{provide:Pl,useClass:Tse},{provide:ax,useValue:t}]}var Rse=Ll(578);function Ose(t,n){if(1&t&&(ae(0,"mat-error"),Re(1),le()),2&t){const e=Lt();xe(),Ci(" ",e.filterForm.getError("dateOrder")," ")}}function Fse(t,n){1&t&&Wt(0,"mat-spinner",12)}function Lse(t,n){if(1&t){const e=_i();ae(0,"mat-chip-option",25),Tt("click",function(){const r=on(e).$implicit;return ln(Lt(2).toggleCategory(r.id))}),Re(1),le()}if(2&t){const e=n.$implicit;Xe("selected",Lt(2).isSelected(e.id)),xe(),Ci(" ",e.name," ")}}function Nse(t,n){1&t&&(ae(0,"mat-error"),Re(1," Debes seleccionar al menos una categor\xeda "),le())}function zse(t,n){if(1&t&&(ae(0,"div",22)(1,"mat-chip-listbox",23),vt(2,Lse,2,2,"mat-chip-option",24),le()(),vt(3,Nse,2,0,"mat-error")),2&t){let e;const i=Lt();xe(),Xe("multiple",!0),xe(),Xe("ngForOf",i.categories),xe(),qi(null!=(e=i.filterForm.get("categoryIds"))&&e.invalid&&null!=(e=i.filterForm.get("categoryIds"))&&e.touched?3:-1)}}function Bse(t,n){1&t&&(ae(0,"mat-error"),Re(1," La latitud debe estar entre -90 y 90 "),le())}function Vse(t,n){1&t&&(ae(0,"mat-error"),Re(1," La longitud debe estar entre -180 y 180 "),le())}function Use(t,n){1&t&&(ae(0,"mat-error"),Re(1," El radio debe ser un n\xfamero positivo "),le())}function jse(t,n){1&t&&Wt(0,"mat-spinner",26)}let Hse=(()=>{class t{fb=te(Bp);http=te(Eu);categoryService=te(ZC);snackBar=te(GR);loading=!1;categories=[];loadingCategories=!1;map;radiusMarker=null;isMapInitialized=!1;router=te(oo);filterForm=this.fb.group({startDate:new qo(null),endDate:new qo(null),categoryIds:new qo([],{validators:[bn.minLength(1)]}),centerLat:new qo(null,{validators:[bn.min(-90),bn.max(90)]}),centerLng:new qo(null,{validators:[bn.min(-180),bn.max(180)]}),radiusKm:new qo(null,{validators:[bn.min(0)]})});ngOnInit(){this.loadCategories()}ngAfterViewInit(){this.initializeMap()}ngOnDestroy(){this.map&&this.map.remove()}initializeMap(){const e=sessionStorage.getItem("lat"),i=sessionStorage.getItem("lng");let r,l;e&&i?(r={lng:parseFloat(i),lat:parseFloat(e)},l=13):(r={lng:-75.681,lat:4.533},l=13),this.map=new(ss().Map)({accessToken:"pk.eyJ1IjoibWFya2F0IiwiYSI6ImNtN2o2eGcwZDAwcGsycG9pZzZ6cjhncTgifQ.f9qApUfu6cdG-w-gpjPOlQ",container:"map-container",style:"mapbox://styles/mapbox/streets-v11",center:r,zoom:13}),this.map.addControl(new(ss().NavigationControl),"top-right"),this.map.on("load",()=>{this.isMapInitialized=!0,this.setupRadiusSelection()}),this.filterForm.value.centerLat&&this.filterForm.value.centerLng&&this.updateMapWithCurrentValues()}setupRadiusSelection(){let e=!1,i=this.filterForm.value.radiusKm||5;this.map.on("click",r=>{const{lng:l,lat:f}=r.lngLat;this.filterForm.patchValue({centerLng:l,centerLat:f,radiusKm:i}),this.drawRadiusCircle([l,f],i)}),this.map.on("mousedown",()=>{e=!0}),this.map.on("mouseup",()=>{e=!1}),this.map.on("mousemove",r=>{if(!e||!this.radiusMarker)return;const l=this.radiusMarker.getLngLat(),f=function Pse(t,n,e={}){var i=JR(t),r=JR(n),l=sv(r[1]-i[1]),f=sv(r[0]-i[0]),w=sv(i[1]),M=sv(r[1]),P=Math.pow(Math.sin(l/2),2)+Math.pow(Math.sin(f/2),2)*Math.cos(w)*Math.cos(M);return function m5(t,n="kilometers"){const e=h5[n];if(!e)throw new Error(n+" units is invalid");return t*e}(2*Math.atan2(Math.sqrt(P),Math.sqrt(1-P)),e.units)}([l.lng,l.lat],[r.lngLat.lng,r.lngLat.lat],{units:"kilometers"});i=Math.max(.1,f),this.filterForm.patchValue({radiusKm:i}),this.drawRadiusCircle([l.lng,l.lat],i)})}drawRadiusCircle(e,i){this.map.getLayer("radius-fill")&&this.map.removeLayer("radius-fill"),this.map.getLayer("radius-outline")&&this.map.removeLayer("radius-outline"),this.map.getSource("radius")&&this.map.removeSource("radius"),this.radiusMarker&&this.radiusMarker.remove();const r=g5(e,i,{steps:64,units:"kilometers"});this.map.addSource("radius",{type:"geojson",data:r}),this.map.addLayer({id:"radius-fill",type:"fill",source:"radius",paint:{"fill-color":"#4285F4","fill-opacity":.2}}),this.map.addLayer({id:"radius-outline",type:"line",source:"radius",paint:{"line-color":"#4285F4","line-width":2}}),this.radiusMarker=new(ss().Marker)({draggable:!0,color:"#4285F4"}).setLngLat(e).addTo(this.map),this.radiusMarker.on("drag",()=>{const l=this.radiusMarker.getLngLat();this.filterForm.patchValue({centerLng:l.lng,centerLat:l.lat}),this.drawRadiusCircle([l.lng,l.lat],i)})}updateMapWithCurrentValues(){if(!this.isMapInitialized)return;const{centerLat:e,centerLng:i,radiusKm:r}=this.filterForm.value;if(e&&i){const l=[i,e];this.map.flyTo({center:l,zoom:12}),r&&this.drawRadiusCircle(l,r)}}loadCategories(){this.loadingCategories=!0,this.categoryService.getAllActiveCategories().subscribe({next:e=>{this.categories=e,this.loadingCategories=!1},error:e=>{console.error("Error cargando categor\xedas",e),this.snackBar.open("Error al cargar categor\xedas","Cerrar",{duration:3e3}),this.loadingCategories=!1}})}toggleCategory(e){const i=this.filterForm.get("categoryIds"),r=i?.value||[],l=r.indexOf(e);l>-1?r.splice(l,1):r.push(e),i?.setValue([...r])}isSelected(e){return(this.filterForm.get("categoryIds")?.value||[]).includes(e)}generateReport(){if(this.filterForm.invalid)return;this.loading=!0;const e=this.filterForm.value,i={startDate:e.startDate?new Date(e.startDate).toISOString():null,endDate:e.endDate?new Date(e.endDate).toISOString():null,categoryIds:e.categoryIds||[],center:e.centerLat&&e.centerLng?{type:"Point",coordinates:[e.centerLng,e.centerLat]}:null,radiusKm:e.radiusKm||null},r=Object.fromEntries(Object.entries(i).filter(([l,f])=>null!==f));this.http.post(`${Cu_urlBack}/admin/reportSummaries/pdf`,r,{params:{page:1,size:20},responseType:"arraybuffer",withCredentials:!0}).subscribe({next:l=>{const f=new Blob([l],{type:"application/pdf"});(0,Rse.saveAs)(f,`reporte_${(new Date).toISOString().split("T")[0]}.pdf`),this.loading=!1},error:l=>{console.error("Error generando PDF",l),this.snackBar.open("Error generando PDF","Cerrar",{duration:3e3}),this.loading=!1}})}goBack(){this.router.navigate(["/map"])}clearFilters(){this.filterForm.reset({startDate:null,endDate:null,categoryIds:[],centerLat:null,centerLng:null,radiusKm:null}),this.isMapInitialized&&(["radius-fill","radius-outline"].forEach(e=>{this.map.getLayer(e)&&this.map.removeLayer(e)}),this.map.getSource("radius")&&this.map.removeSource("radius"),this.radiusMarker&&(this.radiusMarker.remove(),this.radiusMarker=null))}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=kn({type:t,selectors:[["app-report-pdf-generator"]],decls:67,vars:13,consts:[["startPicker",""],["endPicker",""],["mat-icon-button","","aria-label","Volver",1,"back-button",3,"click"],[1,"contenedor"],[3,"ngSubmit","formGroup"],[1,"filter-section"],[1,"date-filters"],["appearance","fill"],["matInput","","formControlName","startDate","placeholder","YYYY-MM-DD",3,"matDatepicker"],["matSuffix","",3,"for"],["matInput","","formControlName","endDate","placeholder","YYYY-MM-DD",3,"matDatepicker"],[4,"ngIf"],["diameter","30"],["id","map-container",1,"map-container"],[1,"location-inputs"],["matInput","","formControlName","centerLat","type","number","step","0.000001"],["matInput","","formControlName","centerLng","type","number","step","0.000001"],["matInput","","formControlName","radiusKm","type","number","step","0.1","min","0"],[1,"actions"],["mat-raised-button","","color","primary","type","button",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["diameter","20",4,"ngIf"],[1,"category-chip-container"],[3,"multiple"],[3,"selected","click",4,"ngFor","ngForOf"],[3,"click","selected"],["diameter","20"]],template:function(i,r){if(1&i){const l=_i();ae(0,"button",2),Tt("click",function(){return on(l),ln(r.goBack())}),ae(1,"mat-icon"),Re(2,"arrow_back"),le()(),ae(3,"mat-card",3)(4,"mat-card-header")(5,"mat-card-title"),Re(6,"Generar Informe PDF"),le(),ae(7,"mat-card-subtitle"),Re(8,"Filtros opcionales para el reporte"),le()(),ae(9,"mat-card-content")(10,"form",4),Tt("ngSubmit",function(){return on(l),ln(r.generateReport())}),ae(11,"div",5)(12,"h3"),Re(13,"Filtros por Fecha"),le(),ae(14,"div",6)(15,"mat-form-field",7)(16,"mat-label"),Re(17,"Fecha inicio"),le(),Wt(18,"input",8)(19,"mat-datepicker-toggle",9)(20,"mat-datepicker",null,0),le(),ae(22,"mat-form-field",7)(23,"mat-label"),Re(24,"Fecha fin"),le(),Wt(25,"input",10)(26,"mat-datepicker-toggle",9)(27,"mat-datepicker",null,1),le()(),vt(29,Ose,2,1,"mat-error",11),le(),ae(30,"div",5)(31,"h3"),Re(32,"Filtros por Categor\xeda"),le(),vt(33,Fse,1,0,"mat-spinner",12)(34,zse,4,3),le(),ae(35,"div",5)(36,"h3"),Re(37,"Filtros por Ubicaci\xf3n"),le(),ae(38,"p"),Re(39,"Selecciona un \xe1rea en el mapa haciendo clic para establecer el centro y arrastrando para ajustar el radio."),le(),Wt(40,"div",13),ae(41,"div",14)(42,"mat-form-field",7)(43,"mat-label"),Re(44,"Latitud"),le(),Wt(45,"input",15),vt(46,Bse,2,0,"mat-error",11),le(),ae(47,"mat-form-field",7)(48,"mat-label"),Re(49,"Longitud"),le(),Wt(50,"input",16),vt(51,Vse,2,0,"mat-error",11),le(),ae(52,"mat-form-field",7)(53,"mat-label"),Re(54,"Radio (km)"),le(),Wt(55,"input",17),vt(56,Use,2,0,"mat-error",11),le()()(),ae(57,"div",18)(58,"button",19),Tt("click",function(){return on(l),ln(r.clearFilters())}),ae(59,"mat-icon"),Re(60,"clear"),le(),Re(61," Limpiar filtros "),le(),ae(62,"button",20)(63,"mat-icon"),Re(64,"picture_as_pdf"),le(),Re(65," Generar PDF "),vt(66,jse,1,0,"mat-spinner",21),le()()()()()}if(2&i){let l,f,w;const M=Ed(21),P=Ed(28);xe(10),Xe("formGroup",r.filterForm),xe(8),Xe("matDatepicker",M),xe(),Xe("for",M),xe(6),Xe("matDatepicker",P),xe(),Xe("for",P),xe(3),Xe("ngIf",r.filterForm.hasError("dateOrder")),xe(4),qi(r.loadingCategories?33:34),xe(13),Xe("ngIf",null==(l=r.filterForm.get("centerLat"))?null:l.invalid),xe(5),Xe("ngIf",null==(f=r.filterForm.get("centerLng"))?null:f.invalid),xe(5),Xe("ngIf",null==(w=r.filterForm.get("radiusKm"))?null:w.invalid),xe(2),Xe("disabled",r.loading),xe(4),Xe("disabled",r.loading||r.filterForm.invalid),xe(4),Xe("ngIf",r.loading)}},dependencies:[Ea,kg,Os,MT,kh,dc,qC,Ad,Ah,VR,Vp,el,Mu,nx,lv,lE,cE,vP,aE,Wg,tx,ex,Jne,tie,AP,IP,AU,Zoe,BP,TU,Ase,sE,Hg,jg,Ug,Up,kd,uE,rx,TP,MP,DP],styles:[".contenedor[_ngcontent-%COMP%]{max-width:800px;margin:50px auto;padding:30px 40px;border:1px solid #ccc;border-radius:8px;background-color:#fff;box-shadow:0 4px 12px #0000000d}.category-chip-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:8px}mat-chip-option[_ngcontent-%COMP%]{cursor:pointer}.actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;margin-top:16px}mat-spinner[_ngcontent-%COMP%]{margin-left:8px}.date-filters[_ngcontent-%COMP%]{display:flex;gap:16px;flex-wrap:wrap}.map-container[_ngcontent-%COMP%]{width:100%;height:300px;margin-bottom:16px}.date-filters[_ngcontent-%COMP%]{display:flex;gap:16px;flex-wrap:wrap;margin-bottom:8px}.filter-section[_ngcontent-%COMP%]{margin-bottom:24px}.coords-display[_ngcontent-%COMP%]{font-size:.85em;color:#0009;margin-bottom:8px}.actions[_ngcontent-%COMP%]{margin-top:16px}.back-button[_ngcontent-%COMP%]{position:fixed;top:16px;left:16px;z-index:1000;background-color:#fff;border-radius:50%;box-shadow:0 2px 6px #0003}"]})}return t})();function $se(t,n){1&t&&(ae(0,"div",11),Re(1," El nombre es obligatorio "),le())}function Gse(t,n){1&t&&(ae(0,"div",11),Re(1," M\xe1ximo 100 caracteres "),le())}function qse(t,n){1&t&&(ae(0,"div",11),Re(1," M\xe1ximo 255 caracteres "),le())}let RU=(()=>{class t{fb=te(Bp);categoryService=te(ZC);notification=te(Uc);route=te(Fg);router=te(oo);form=this.fb.group({name:["",[bn.required,bn.maxLength(100)]],description:["",[bn.maxLength(255)]]});loading=!1;isEditMode=!1;categoryId=null;ngOnInit(){this.categoryId=this.route.snapshot.paramMap.get("id"),this.isEditMode=!!this.categoryId,this.isEditMode&&this.categoryId&&(this.loading=!0,this.categoryService.getCategoryById(this.categoryId).subscribe({next:e=>{this.form.patchValue({name:e.name,description:e.description})},error:e=>{this.notification.error("No se pudo cargar la categor\xeda")},complete:()=>this.loading=!1}))}onSubmit(){if(this.form.invalid)return void this.form.markAllAsTouched();const e={name:this.form.value.name,description:this.form.value.description||""};this.loading=!0,(this.isEditMode?this.categoryService.updateCategory(this.categoryId,e):this.categoryService.addCategory(e)).subscribe({next:()=>{this.notification.success(this.isEditMode?"Categor\xeda actualizada correctamente":"Categor\xeda creada correctamente"),this.router.navigate(["/category-list"])},error:r=>{this.notification.error(this.isEditMode?"Error al actualizar categor\xeda":"Error al crear categor\xeda")},complete:()=>this.loading=!1})}goBack(){this.router.navigate(["/category-list"])}get name(){return this.form.get("name")}get description(){return this.form.get("description")}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=kn({type:t,selectors:[["app-category-form"]],decls:22,vars:7,consts:[["mat-icon-button","","aria-label","Volver",1,"back-button",3,"click"],[1,"report-container"],[3,"ngSubmit","formGroup"],[1,"field-group"],["for","name"],["appearance","outline",1,"full-width"],["matInput","","id","name","formControlName","name","placeholder","Nombre de la categor\xeda"],["class","error-message",4,"ngIf"],["for","description"],["matInput","","id","description","formControlName","description","placeholder","Descripci\xf3n de la categor\xeda","rows","4"],["type","submit",1,"submit-button",3,"disabled"],[1,"error-message"]],template:function(i,r){1&i&&(ae(0,"button",0),Tt("click",function(){return r.goBack()}),ae(1,"mat-icon"),Re(2,"arrow_back"),le()(),ae(3,"div",1)(4,"h2"),Re(5),le(),ae(6,"form",2),Tt("ngSubmit",function(){return r.onSubmit()}),ae(7,"div",3)(8,"label",4),Re(9,"Nombre"),le(),ae(10,"mat-form-field",5),Wt(11,"input",6),le(),vt(12,$se,2,0,"div",7)(13,Gse,2,0,"div",7),le(),ae(14,"div",3)(15,"label",8),Re(16,"Descripci\xf3n (opcional)"),le(),ae(17,"mat-form-field",5),Wt(18,"textarea",9),le(),vt(19,qse,2,0,"div",7),le(),ae(20,"button",10),Re(21),le()()()),2&i&&(xe(5),Ci(" ",r.isEditMode?"Editar Categor\xeda":"Crear Nueva Categor\xeda"," "),xe(),Xe("formGroup",r.form),xe(6),Xe("ngIf",(null==r.name?null:r.name.touched)&&(null==r.name?null:r.name.hasError("required"))),xe(),Xe("ngIf",(null==r.name?null:r.name.touched)&&(null==r.name?null:r.name.hasError("maxLength"))),xe(6),Xe("ngIf",(null==r.description?null:r.description.touched)&&(null==r.description?null:r.description.hasError("maxLength"))),xe(),Xe("disabled",r.loading||r.form.invalid),xe(),Ci(" ",r.loading?r.isEditMode?"Actualizando...":"Creando...":r.isEditMode?"Actualizar Categor\xeda":"Crear Categor\xeda"," "))},dependencies:[Ea,Os,Vp,kh,dc,Ad,Ah,el,Mu,Wg,tx,AP,IP,Hg,Ug,Up,kd],styles:[".back-button[_ngcontent-%COMP%]{position:fixed;top:16px;left:16px;z-index:1000;background-color:#fff;border:none;border-radius:50%;box-shadow:0 2px 8px #00000026;width:40px;height:40px;display:flex;align-items:center;justify-content:center;transition:background-color .2s ease,transform .2s ease}.back-button[_ngcontent-%COMP%]:hover{background-color:#f0f0f0;transform:translate(-2px)}.report-container[_ngcontent-%COMP%]{max-width:700px;margin:80px auto 40px;padding:30px 40px;border:1px solid #ddd;border-radius:10px;background-color:#fff;box-shadow:0 6px 16px #0000000d}.report-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{text-align:center;font-size:30px;color:#2c3e50;margin-bottom:30px}.field-group[_ngcontent-%COMP%]{margin-bottom:30px}.field-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:8px;font-weight:600;color:#34495e}.full-width[_ngcontent-%COMP%]{width:100%}.error-message[_ngcontent-%COMP%]{color:#e74c3c;font-size:.85em;margin-top:6px}.submit-button[_ngcontent-%COMP%]{display:block;width:100%;padding:14px;background-color:#f9f9f9;color:#2c3e50;border:1px solid #ccc;border-radius:4px;font-size:16px;font-weight:600;cursor:pointer;transition:background-color .2s ease,box-shadow .2s ease;margin-top:20px}.submit-button[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#eaeaea;box-shadow:0 2px 8px #0000001a}.submit-button[_ngcontent-%COMP%]:disabled{background-color:#f0f0f0;color:#999;cursor:not-allowed}"]})}return t})();const Wse=["mat-internal-form-field",""],Yse=["*"];let Zse=(()=>{class t{labelPosition;static \u0275fac=function(i){return new(i||t)};static \u0275cmp=kn({type:t,selectors:[["div","mat-internal-form-field",""]],hostAttrs:[1,"mdc-form-field","mat-internal-form-field"],hostVars:2,hostBindings:function(i,r){2&i&&Di("mdc-form-field--align-end","before"===r.labelPosition)},inputs:{labelPosition:"labelPosition"},attrs:Wse,ngContentSelectors:Yse,decls:1,vars:0,template:function(i,r){1&i&&(os(),Fi(0))},styles:[".mat-internal-form-field{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;display:inline-flex;align-items:center;vertical-align:middle}.mat-internal-form-field>label{margin-left:0;margin-right:auto;padding-left:4px;padding-right:0;order:0}[dir=rtl] .mat-internal-form-field>label{margin-left:auto;margin-right:0;padding-left:0;padding-right:4px}.mdc-form-field--align-end>label{margin-left:auto;margin-right:0;padding-left:0;padding-right:4px;order:-1}[dir=rtl] .mdc-form-field--align-end .mdc-form-field--align-end label{margin-left:0;margin-right:auto;padding-left:4px;padding-right:0}\n"],encapsulation:2,changeDetection:0})}return t})();const Xse=["switch"],Kse=["*"];function Qse(t,n){1&t&&(ae(0,"span",10),ba(),ae(1,"svg",12),Wt(2,"path",13),le(),ae(3,"svg",14),Wt(4,"path",15),le()())}const Jse=new _t("mat-slide-toggle-default-options",{providedIn:"root",factory:()=>({disableToggleValue:!1,hideIcon:!1,disabledInteractive:!1})}),eae={provide:Id,useExisting:ur(()=>HP),multi:!0};class PU{source;checked;constructor(n,e){this.source=n,this.checked=e}}let HP=(()=>{class t{_elementRef=te(Dn);_focusMonitor=te(j0);_changeDetectorRef=te(Do);defaults=te(Jse);_onChange=e=>{};_onTouched=()=>{};_validatorOnChange=()=>{};_uniqueId;_checked=!1;_createChangeEvent(e){return new PU(this,e)}_labelId;get buttonId(){return`${this.id||this._uniqueId}-button`}_switchElement;focus(){this._switchElement.nativeElement.focus()}_noopAnimations;_focused;name=null;id;labelPosition="after";ariaLabel=null;ariaLabelledby=null;ariaDescribedby;required;color;disabled=!1;disableRipple=!1;tabIndex=0;get checked(){return this._checked}set checked(e){this._checked=e,this._changeDetectorRef.markForCheck()}hideIcon;disabledInteractive;change=new $e;toggleChange=new $e;get inputId(){return`${this.id||this._uniqueId}-input`}constructor(){te(cc).load(H0);const e=te(new Ee("tabindex"),{optional:!0}),i=this.defaults,r=te(wa,{optional:!0});this.tabIndex=null==e?0:parseInt(e)||0,this.color=i.color||"accent",this._noopAnimations="NoopAnimations"===r,this.id=this._uniqueId=te(Sa).getId("mat-mdc-slide-toggle-"),this.hideIcon=i.hideIcon??!1,this.disabledInteractive=i.disabledInteractive??!1,this._labelId=this._uniqueId+"-label"}ngAfterContentInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(e=>{"keyboard"===e||"program"===e?(this._focused=!0,this._changeDetectorRef.markForCheck()):e||Promise.resolve().then(()=>{this._focused=!1,this._onTouched(),this._changeDetectorRef.markForCheck()})})}ngOnChanges(e){e.required&&this._validatorOnChange()}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}writeValue(e){this.checked=!!e}registerOnChange(e){this._onChange=e}registerOnTouched(e){this._onTouched=e}validate(e){return this.required&&!0!==e.value?{required:!0}:null}registerOnValidatorChange(e){this._validatorOnChange=e}setDisabledState(e){this.disabled=e,this._changeDetectorRef.markForCheck()}toggle(){this.checked=!this.checked,this._onChange(this.checked)}_emitChangeEvent(){this._onChange(this.checked),this.change.emit(this._createChangeEvent(this.checked))}_handleClick(){this.disabled||(this.toggleChange.emit(),this.defaults.disableToggleValue||(this.checked=!this.checked,this._onChange(this.checked),this.change.emit(new PU(this,this.checked))))}_getAriaLabelledBy(){return this.ariaLabelledby?this.ariaLabelledby:this.ariaLabel?null:this._labelId}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=kn({type:t,selectors:[["mat-slide-toggle"]],viewQuery:function(i,r){if(1&i&&kr(Xse,5),2&i){let l;Zn(l=Xn())&&(r._switchElement=l.first)}},hostAttrs:[1,"mat-mdc-slide-toggle"],hostVars:13,hostBindings:function(i,r){2&i&&(rc("id",r.id),ii("tabindex",null)("aria-label",null)("name",null)("aria-labelledby",null),Kf(r.color?"mat-"+r.color:""),Di("mat-mdc-slide-toggle-focused",r._focused)("mat-mdc-slide-toggle-checked",r.checked)("_mat-animation-noopable",r._noopAnimations))},inputs:{name:"name",id:"id",labelPosition:"labelPosition",ariaLabel:[0,"aria-label","ariaLabel"],ariaLabelledby:[0,"aria-labelledby","ariaLabelledby"],ariaDescribedby:[0,"aria-describedby","ariaDescribedby"],required:[2,"required","required",Un],color:"color",disabled:[2,"disabled","disabled",Un],disableRipple:[2,"disableRipple","disableRipple",Un],tabIndex:[2,"tabIndex","tabIndex",e=>null==e?0:bu(e)],checked:[2,"checked","checked",Un],hideIcon:[2,"hideIcon","hideIcon",Un],disabledInteractive:[2,"disabledInteractive","disabledInteractive",Un]},outputs:{change:"change",toggleChange:"toggleChange"},exportAs:["matSlideToggle"],features:[pi([eae,{provide:sa,useExisting:t,multi:!0}]),Mr],ngContentSelectors:Kse,decls:13,vars:27,consts:[["switch",""],["mat-internal-form-field","",3,"labelPosition"],["role","switch","type","button",1,"mdc-switch",3,"click","tabIndex","disabled"],[1,"mdc-switch__track"],[1,"mdc-switch__handle-track"],[1,"mdc-switch__handle"],[1,"mdc-switch__shadow"],[1,"mdc-elevation-overlay"],[1,"mdc-switch__ripple"],["mat-ripple","",1,"mat-mdc-slide-toggle-ripple","mat-focus-indicator",3,"matRippleTrigger","matRippleDisabled","matRippleCentered"],[1,"mdc-switch__icons"],[1,"mdc-label",3,"click","for"],["viewBox","0 0 24 24","aria-hidden","true",1,"mdc-switch__icon","mdc-switch__icon--on"],["d","M19.69,5.23L8.96,15.96l-4.23-4.23L2.96,13.5l6,6L21.46,7L19.69,5.23z"],["viewBox","0 0 24 24","aria-hidden","true",1,"mdc-switch__icon","mdc-switch__icon--off"],["d","M20 13H4v-2h16v2z"]],template:function(i,r){if(1&i){const l=_i();os(),ae(0,"div",1)(1,"button",2,0),Tt("click",function(){return on(l),ln(r._handleClick())}),Wt(3,"span",3),ae(4,"span",4)(5,"span",5)(6,"span",6),Wt(7,"span",7),le(),ae(8,"span",8),Wt(9,"span",9),le(),vt(10,Qse,5,0,"span",10),le()()(),ae(11,"label",11),Tt("click",function(w){return on(l),ln(w.stopPropagation())}),Fi(12),le()()}if(2&i){const l=Ed(2);Xe("labelPosition",r.labelPosition),xe(),Di("mdc-switch--selected",r.checked)("mdc-switch--unselected",!r.checked)("mdc-switch--checked",r.checked)("mdc-switch--disabled",r.disabled)("mat-mdc-slide-toggle-disabled-interactive",r.disabledInteractive),Xe("tabIndex",r.disabled&&!r.disabledInteractive?-1:r.tabIndex)("disabled",r.disabled&&!r.disabledInteractive),ii("id",r.buttonId)("name",r.name)("aria-label",r.ariaLabel)("aria-labelledby",r._getAriaLabelledBy())("aria-describedby",r.ariaDescribedby)("aria-required",r.required||null)("aria-checked",r.checked)("aria-disabled",r.disabled&&r.disabledInteractive?"true":null),xe(8),Xe("matRippleTrigger",l)("matRippleDisabled",r.disableRipple||r.disabled)("matRippleCentered",!0),xe(),qi(r.hideIcon?-1:10),xe(),Xe("for",r.buttonId),ii("id",r._labelId)}},dependencies:[KV,Zse],styles:['.mdc-switch{align-items:center;background:none;border:none;cursor:pointer;display:inline-flex;flex-shrink:0;margin:0;outline:none;overflow:visible;padding:0;position:relative;width:var(--mdc-switch-track-width, 52px)}.mdc-switch.mdc-switch--disabled{cursor:default;pointer-events:none}.mdc-switch.mat-mdc-slide-toggle-disabled-interactive{pointer-events:auto}.mdc-switch__track{overflow:hidden;position:relative;width:100%;height:var(--mdc-switch-track-height, 32px);border-radius:var(--mdc-switch-track-shape, var(--mat-sys-corner-full))}.mdc-switch--disabled.mdc-switch .mdc-switch__track{opacity:var(--mdc-switch-disabled-track-opacity, 0.12)}.mdc-switch__track::before,.mdc-switch__track::after{border:1px solid rgba(0,0,0,0);border-radius:inherit;box-sizing:border-box;content:"";height:100%;left:0;position:absolute;width:100%;border-width:var(--mat-switch-track-outline-width, 2px);border-color:var(--mat-switch-track-outline-color, var(--mat-sys-outline))}.mdc-switch--selected .mdc-switch__track::before,.mdc-switch--selected .mdc-switch__track::after{border-width:var(--mat-switch-selected-track-outline-width, 2px);border-color:var(--mat-switch-selected-track-outline-color, transparent)}.mdc-switch--disabled .mdc-switch__track::before,.mdc-switch--disabled .mdc-switch__track::after{border-width:var(--mat-switch-disabled-unselected-track-outline-width, 2px);border-color:var(--mat-switch-disabled-unselected-track-outline-color, var(--mat-sys-on-surface))}@media(forced-colors: active){.mdc-switch__track{border-color:currentColor}}.mdc-switch__track::before{transition:transform 75ms 0ms cubic-bezier(0, 0, 0.2, 1);transform:translateX(0);background:var(--mdc-switch-unselected-track-color, var(--mat-sys-surface-variant))}.mdc-switch--selected .mdc-switch__track::before{transition:transform 75ms 0ms cubic-bezier(0.4, 0, 0.6, 1);transform:translateX(100%)}[dir=rtl] .mdc-switch--selected .mdc-switch--selected .mdc-switch__track::before{transform:translateX(-100%)}.mdc-switch--selected .mdc-switch__track::before{opacity:var(--mat-switch-hidden-track-opacity, 0);transition:var(--mat-switch-hidden-track-transition, opacity 75ms)}.mdc-switch--unselected .mdc-switch__track::before{opacity:var(--mat-switch-visible-track-opacity, 1);transition:var(--mat-switch-visible-track-transition, opacity 75ms)}.mdc-switch:enabled:hover:not(:focus):not(:active) .mdc-switch__track::before{background:var(--mdc-switch-unselected-hover-track-color, var(--mat-sys-surface-variant))}.mdc-switch:enabled:focus:not(:active) .mdc-switch__track::before{background:var(--mdc-switch-unselected-focus-track-color, var(--mat-sys-surface-variant))}.mdc-switch:enabled:active .mdc-switch__track::before{background:var(--mdc-switch-unselected-pressed-track-color, var(--mat-sys-surface-variant))}.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:hover:not(:focus):not(:active) .mdc-switch__track::before,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:focus:not(:active) .mdc-switch__track::before,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:active .mdc-switch__track::before,.mdc-switch.mdc-switch--disabled .mdc-switch__track::before{background:var(--mdc-switch-disabled-unselected-track-color, var(--mat-sys-surface-variant))}.mdc-switch__track::after{transform:translateX(-100%);background:var(--mdc-switch-selected-track-color, var(--mat-sys-primary))}[dir=rtl] .mdc-switch__track::after{transform:translateX(100%)}.mdc-switch--selected .mdc-switch__track::after{transform:translateX(0)}.mdc-switch--selected .mdc-switch__track::after{opacity:var(--mat-switch-visible-track-opacity, 1);transition:var(--mat-switch-visible-track-transition, opacity 75ms)}.mdc-switch--unselected .mdc-switch__track::after{opacity:var(--mat-switch-hidden-track-opacity, 0);transition:var(--mat-switch-hidden-track-transition, opacity 75ms)}.mdc-switch:enabled:hover:not(:focus):not(:active) .mdc-switch__track::after{background:var(--mdc-switch-selected-hover-track-color, var(--mat-sys-primary))}.mdc-switch:enabled:focus:not(:active) .mdc-switch__track::after{background:var(--mdc-switch-selected-focus-track-color, var(--mat-sys-primary))}.mdc-switch:enabled:active .mdc-switch__track::after{background:var(--mdc-switch-selected-pressed-track-color, var(--mat-sys-primary))}.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:hover:not(:focus):not(:active) .mdc-switch__track::after,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:focus:not(:active) .mdc-switch__track::after,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:active .mdc-switch__track::after,.mdc-switch.mdc-switch--disabled .mdc-switch__track::after{background:var(--mdc-switch-disabled-selected-track-color, var(--mat-sys-on-surface))}.mdc-switch__handle-track{height:100%;pointer-events:none;position:absolute;top:0;transition:transform 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1);left:0;right:auto;transform:translateX(0);width:calc(100% - var(--mdc-switch-handle-width))}[dir=rtl] .mdc-switch__handle-track{left:auto;right:0}.mdc-switch--selected .mdc-switch__handle-track{transform:translateX(100%)}[dir=rtl] .mdc-switch--selected .mdc-switch__handle-track{transform:translateX(-100%)}.mdc-switch__handle{display:flex;pointer-events:auto;position:absolute;top:50%;transform:translateY(-50%);left:0;right:auto;transition:width 75ms cubic-bezier(0.4, 0, 0.2, 1),height 75ms cubic-bezier(0.4, 0, 0.2, 1),margin 75ms cubic-bezier(0.4, 0, 0.2, 1);width:var(--mdc-switch-handle-width);height:var(--mdc-switch-handle-height);border-radius:var(--mdc-switch-handle-shape, var(--mat-sys-corner-full))}[dir=rtl] .mdc-switch__handle{left:auto;right:0}.mat-mdc-slide-toggle .mdc-switch--unselected .mdc-switch__handle{width:var(--mat-switch-unselected-handle-size, 16px);height:var(--mat-switch-unselected-handle-size, 16px);margin:var(--mat-switch-unselected-handle-horizontal-margin, 0 8px)}.mat-mdc-slide-toggle .mdc-switch--unselected .mdc-switch__handle:has(.mdc-switch__icons){margin:var(--mat-switch-unselected-with-icon-handle-horizontal-margin, 0 4px)}.mat-mdc-slide-toggle .mdc-switch--selected .mdc-switch__handle{width:var(--mat-switch-selected-handle-size, 24px);height:var(--mat-switch-selected-handle-size, 24px);margin:var(--mat-switch-selected-handle-horizontal-margin, 0 24px)}.mat-mdc-slide-toggle .mdc-switch--selected .mdc-switch__handle:has(.mdc-switch__icons){margin:var(--mat-switch-selected-with-icon-handle-horizontal-margin, 0 24px)}.mat-mdc-slide-toggle .mdc-switch__handle:has(.mdc-switch__icons){width:var(--mat-switch-with-icon-handle-size, 24px);height:var(--mat-switch-with-icon-handle-size, 24px)}.mat-mdc-slide-toggle .mdc-switch:active:not(.mdc-switch--disabled) .mdc-switch__handle{width:var(--mat-switch-pressed-handle-size, 28px);height:var(--mat-switch-pressed-handle-size, 28px)}.mat-mdc-slide-toggle .mdc-switch--selected:active:not(.mdc-switch--disabled) .mdc-switch__handle{margin:var(--mat-switch-selected-pressed-handle-horizontal-margin, 0 22px)}.mat-mdc-slide-toggle .mdc-switch--unselected:active:not(.mdc-switch--disabled) .mdc-switch__handle{margin:var(--mat-switch-unselected-pressed-handle-horizontal-margin, 0 2px)}.mdc-switch--disabled.mdc-switch--selected .mdc-switch__handle::after{opacity:var(--mat-switch-disabled-selected-handle-opacity, 1)}.mdc-switch--disabled.mdc-switch--unselected .mdc-switch__handle::after{opacity:var(--mat-switch-disabled-unselected-handle-opacity, 0.38)}.mdc-switch__handle::before,.mdc-switch__handle::after{border:1px solid rgba(0,0,0,0);border-radius:inherit;box-sizing:border-box;content:"";width:100%;height:100%;left:0;position:absolute;top:0;transition:background-color 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1),border-color 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1);z-index:-1}@media(forced-colors: active){.mdc-switch__handle::before,.mdc-switch__handle::after{border-color:currentColor}}.mdc-switch--selected:enabled .mdc-switch__handle::after{background:var(--mdc-switch-selected-handle-color, var(--mat-sys-on-primary))}.mdc-switch--selected:enabled:hover:not(:focus):not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-selected-hover-handle-color, var(--mat-sys-primary-container))}.mdc-switch--selected:enabled:focus:not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-selected-focus-handle-color, var(--mat-sys-primary-container))}.mdc-switch--selected:enabled:active .mdc-switch__handle::after{background:var(--mdc-switch-selected-pressed-handle-color, var(--mat-sys-primary-container))}.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled.mdc-switch--selected:hover:not(:focus):not(:active) .mdc-switch__handle::after,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled.mdc-switch--selected:focus:not(:active) .mdc-switch__handle::after,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled.mdc-switch--selected:active .mdc-switch__handle::after,.mdc-switch--selected.mdc-switch--disabled .mdc-switch__handle::after{background:var(--mdc-switch-disabled-selected-handle-color, var(--mat-sys-surface))}.mdc-switch--unselected:enabled .mdc-switch__handle::after{background:var(--mdc-switch-unselected-handle-color, var(--mat-sys-outline))}.mdc-switch--unselected:enabled:hover:not(:focus):not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-unselected-hover-handle-color, var(--mat-sys-on-surface-variant))}.mdc-switch--unselected:enabled:focus:not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-unselected-focus-handle-color, var(--mat-sys-on-surface-variant))}.mdc-switch--unselected:enabled:active .mdc-switch__handle::after{background:var(--mdc-switch-unselected-pressed-handle-color, var(--mat-sys-on-surface-variant))}.mdc-switch--unselected.mdc-switch--disabled .mdc-switch__handle::after{background:var(--mdc-switch-disabled-unselected-handle-color, var(--mat-sys-on-surface))}.mdc-switch__handle::before{background:var(--mdc-switch-handle-surface-color)}.mdc-switch__shadow{border-radius:inherit;bottom:0;left:0;position:absolute;right:0;top:0}.mdc-switch:enabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-handle-elevation-shadow)}.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:hover:not(:focus):not(:active) .mdc-switch__shadow,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:focus:not(:active) .mdc-switch__shadow,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:active .mdc-switch__shadow,.mdc-switch.mdc-switch--disabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-disabled-handle-elevation-shadow)}.mdc-switch__ripple{left:50%;position:absolute;top:50%;transform:translate(-50%, -50%);z-index:-1;width:var(--mdc-switch-state-layer-size, 40px);height:var(--mdc-switch-state-layer-size, 40px)}.mdc-switch__ripple::after{content:"";opacity:0}.mdc-switch--disabled .mdc-switch__ripple::after{display:none}.mat-mdc-slide-toggle-disabled-interactive .mdc-switch__ripple::after{display:block}.mdc-switch:hover .mdc-switch__ripple::after{opacity:.04;transition:75ms opacity cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-slide-toggle.mat-mdc-slide-toggle-focused .mdc-switch .mdc-switch__ripple::after{opacity:.12}.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:enabled:focus .mdc-switch__ripple::after,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:enabled:active .mdc-switch__ripple::after,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:enabled:hover:not(:focus) .mdc-switch__ripple::after,.mdc-switch--unselected:enabled:hover:not(:focus) .mdc-switch__ripple::after{background:var(--mdc-switch-unselected-hover-state-layer-color, var(--mat-sys-on-surface))}.mdc-switch--unselected:enabled:focus .mdc-switch__ripple::after{background:var(--mdc-switch-unselected-focus-state-layer-color, var(--mat-sys-on-surface))}.mdc-switch--unselected:enabled:active .mdc-switch__ripple::after{background:var(--mdc-switch-unselected-pressed-state-layer-color, var(--mat-sys-on-surface));opacity:var(--mdc-switch-unselected-pressed-state-layer-opacity, var(--mat-sys-pressed-state-layer-opacity));transition:opacity 75ms linear}.mdc-switch--selected:enabled:hover:not(:focus) .mdc-switch__ripple::after{background:var(--mdc-switch-selected-hover-state-layer-color, var(--mat-sys-primary))}.mdc-switch--selected:enabled:focus .mdc-switch__ripple::after{background:var(--mdc-switch-selected-focus-state-layer-color, var(--mat-sys-primary))}.mdc-switch--selected:enabled:active .mdc-switch__ripple::after{background:var(--mdc-switch-selected-pressed-state-layer-color, var(--mat-sys-primary));opacity:var(--mdc-switch-selected-pressed-state-layer-opacity, var(--mat-sys-pressed-state-layer-opacity));transition:opacity 75ms linear}.mdc-switch__icons{position:relative;height:100%;width:100%;z-index:1;transform:translateZ(0)}.mdc-switch--disabled.mdc-switch--unselected .mdc-switch__icons{opacity:var(--mdc-switch-disabled-unselected-icon-opacity, 0.38)}.mdc-switch--disabled.mdc-switch--selected .mdc-switch__icons{opacity:var(--mdc-switch-disabled-selected-icon-opacity, 0.38)}.mdc-switch__icon{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0;opacity:0;transition:opacity 30ms 0ms cubic-bezier(0.4, 0, 1, 1)}.mdc-switch--unselected .mdc-switch__icon{width:var(--mdc-switch-unselected-icon-size, 16px);height:var(--mdc-switch-unselected-icon-size, 16px);fill:var(--mdc-switch-unselected-icon-color, var(--mat-sys-surface-variant))}.mdc-switch--unselected.mdc-switch--disabled .mdc-switch__icon{fill:var(--mdc-switch-disabled-unselected-icon-color, var(--mat-sys-surface-variant))}.mdc-switch--selected .mdc-switch__icon{width:var(--mdc-switch-selected-icon-size, 16px);height:var(--mdc-switch-selected-icon-size, 16px);fill:var(--mdc-switch-selected-icon-color, var(--mat-sys-on-primary-container))}.mdc-switch--selected.mdc-switch--disabled .mdc-switch__icon{fill:var(--mdc-switch-disabled-selected-icon-color, var(--mat-sys-on-surface))}.mdc-switch--selected .mdc-switch__icon--on,.mdc-switch--unselected .mdc-switch__icon--off{opacity:1;transition:opacity 45ms 30ms cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-slide-toggle{-webkit-user-select:none;user-select:none;display:inline-block;-webkit-tap-highlight-color:rgba(0,0,0,0);outline:0}.mat-mdc-slide-toggle .mat-mdc-slide-toggle-ripple,.mat-mdc-slide-toggle .mdc-switch__ripple::after{top:0;left:0;right:0;bottom:0;position:absolute;border-radius:50%;pointer-events:none}.mat-mdc-slide-toggle .mat-mdc-slide-toggle-ripple:not(:empty),.mat-mdc-slide-toggle .mdc-switch__ripple::after:not(:empty){transform:translateZ(0)}.mat-mdc-slide-toggle.mat-mdc-slide-toggle-focused .mat-focus-indicator::before{content:""}.mat-mdc-slide-toggle .mat-internal-form-field{color:var(--mat-switch-label-text-color, var(--mat-sys-on-surface));font-family:var(--mat-switch-label-text-font, var(--mat-sys-body-medium-font));line-height:var(--mat-switch-label-text-line-height, var(--mat-sys-body-medium-line-height));font-size:var(--mat-switch-label-text-size, var(--mat-sys-body-medium-size));letter-spacing:var(--mat-switch-label-text-tracking, var(--mat-sys-body-medium-tracking));font-weight:var(--mat-switch-label-text-weight, var(--mat-sys-body-medium-weight))}.mat-mdc-slide-toggle .mat-ripple-element{opacity:.12}.mat-mdc-slide-toggle .mat-focus-indicator::before{border-radius:50%}.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle-track,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__icon,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle::before,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle::after,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__track::before,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__track::after{transition:none}.mat-mdc-slide-toggle .mdc-switch:enabled+.mdc-label{cursor:pointer}.mat-mdc-slide-toggle .mdc-switch--disabled+label{color:var(--mdc-switch-disabled-label-text-color)}\n'],encapsulation:2,changeDetection:0})}return t})(),iae=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275mod=Er({type:t});static \u0275inj=Ai({imports:[HP,Qr,Qr]})}return t})();function rae(t,n){1&t&&(ae(0,"div",4),Wt(1,"mat-spinner",5),ae(2,"p"),Re(3,"Cargando categor\xedas\u2026"),le()())}function oae(t,n){1&t&&(ae(0,"th",17),Re(1,"ID"),le())}function sae(t,n){if(1&t&&(ae(0,"td",18),Re(1),le()),2&t){const e=n.$implicit;xe(),er(e.id)}}function aae(t,n){1&t&&(ae(0,"th",17),Re(1,"Nombre"),le())}function lae(t,n){if(1&t&&(ae(0,"td",18),Re(1),le()),2&t){const e=n.$implicit;xe(),er(e.name)}}function cae(t,n){1&t&&(ae(0,"th",17),Re(1,"Descripci\xf3n"),le())}function dae(t,n){if(1&t&&(ae(0,"td",18),Re(1),le()),2&t){const e=n.$implicit;xe(),er(e.description)}}function uae(t,n){1&t&&(ae(0,"th",17),Re(1,"Creado En"),le())}function hae(t,n){if(1&t&&(ae(0,"td",18),Re(1),Jf(2,"date"),le()),2&t){const e=n.$implicit;xe(),Ci(" ",S0(2,1,e.createdAt,"yyyy-MM-dd hh:mm a")," ")}}function pae(t,n){1&t&&(ae(0,"th",17),Re(1,"Estado"),le())}function fae(t,n){if(1&t){const e=_i();ae(0,"td",18)(1,"mat-slide-toggle",19),Tt("change",function(){const r=on(e).$implicit;return ln(Lt(2).onToggleActivation(r))}),Re(2),le()()}if(2&t){const e=n.$implicit;xe(),Xe("checked",e.activated)("disabled",!e.id),xe(),Ci(" ",e.activated?"Activada":"Desactivada"," ")}}function mae(t,n){1&t&&(ae(0,"th",17),Re(1,"Acciones"),le())}function gae(t,n){if(1&t){const e=_i();ae(0,"td",18)(1,"button",20),Tt("click",function(){const r=on(e).$implicit;return ln(Lt(2).onEdit(r))}),ae(2,"mat-icon"),Re(3,"edit"),le()()()}}function _ae(t,n){1&t&&Wt(0,"tr",21)}function yae(t,n){1&t&&Wt(0,"tr",22)}function vae(t,n){if(1&t&&(ae(0,"table",6),Qi(1,7),vt(2,oae,2,0,"th",8)(3,sae,2,1,"td",9),Ji(),Qi(4,10),vt(5,aae,2,0,"th",8)(6,lae,2,1,"td",9),Ji(),Qi(7,11),vt(8,cae,2,0,"th",8)(9,dae,2,1,"td",9),Ji(),Qi(10,12),vt(11,uae,2,0,"th",8)(12,hae,3,4,"td",9),Ji(),Qi(13,13),vt(14,pae,2,0,"th",8)(15,fae,3,3,"td",9),Ji(),Qi(16,14),vt(17,mae,2,0,"th",8)(18,gae,4,0,"td",9),Ji(),vt(19,_ae,1,0,"tr",15)(20,yae,1,0,"tr",16),le()),2&t){const e=Lt();Xe("dataSource",e.categories),xe(19),Xe("matHeaderRowDef",e.displayedColumns),xe(),Xe("matRowDefColumns",e.displayedColumns)}}let bae=(()=>{class t{categoryService=te(ZC);notification=te(Uc);router=te(oo);dialog=te(Vg);loading=!1;categories=[];displayedColumns=["id","name","description","createdAt","activated","actions"];ngOnInit(){this.fetchCategories()}fetchCategories(){this.loading=!0,this.categoryService.getAllCategories().subscribe({next:e=>this.categories=e,error:e=>{console.error("Error cargando categor\xedas",e),this.notification.error("No fue posible cargar las categor\xedas")},complete:()=>this.loading=!1})}onAdd(){this.router.navigate(["/categories/create"])}onEdit(e){e.id&&this.router.navigate(["/categories/edit",e.id])}onToggleActivation(e){if(!e.id)return;const i=e.activated?"Desactivar":"Activar",r=e.activated?"desactivada":"activada",l={title:`${i} Categor\xeda`,message:`\xbfSeguro que deseas ${i.toLowerCase()} la categor\xeda \u201c${e.name}\u201d?`,confirmText:i,cancelText:"Cancelar"};this.dialog.open(Gg,{data:l}).afterClosed().subscribe(f=>{!0===f&&this.categoryService.toggleCategoryActivation(e.id).subscribe({next:w=>{this.notification.success(`Categor\xeda \u201c${e.name}\u201d ${r}`),this.fetchCategories(),e.activated=w.activated},error:w=>{console.error("Error cambiando estado de categor\xeda",w),this.notification.error(`No se pudo ${i.toLowerCase()} la categor\xeda`)}})})}goBack(){this.router.navigate(["/map"])}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=kn({type:t,selectors:[["app-category-list"]],decls:16,vars:2,consts:[["tableBlock",""],["mat-icon-button","","aria-label","Volver",1,"back-button",3,"click"],["mat-flat-button","","color","primary",3,"click"],["class","loading-section",4,"ngIf","ngIfElse"],[1,"loading-section"],["diameter","40"],["mat-table","",1,"mat-elevation-z8",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","name"],["matColumnDef","description"],["matColumnDef","createdAt"],["matColumnDef","activated"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["color","primary",3,"change","checked","disabled"],["mat-icon-button","","color","accent",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(i,r){if(1&i){const l=_i();ae(0,"button",1),Tt("click",function(){return on(l),ln(r.goBack())}),ae(1,"mat-icon"),Re(2,"arrow_back"),le()(),ae(3,"mat-card")(4,"mat-card-header")(5,"mat-card-title"),Re(6,"Listado de Categor\xedas"),le(),ae(7,"mat-card-actions")(8,"button",2),Tt("click",function(){return on(l),ln(r.onAdd())}),ae(9,"mat-icon"),Re(10,"add"),le(),Re(11," A\xf1adir Categor\xeda "),le()()(),ae(12,"mat-card-content"),vt(13,rae,4,0,"div",3)(14,vae,21,3,"ng-template",null,0,q1),le()()}if(2&i){const l=Ed(15);xe(13),Xe("ngIf",r.loading)("ngIfElse",l)}},dependencies:[Ea,Os,I0,nx,lv,bP,lE,cE,aE,NT,JC,X0,eE,K0,Z0,tE,Q0,J0,nE,iE,uE,rx,Hg,jg,Ug,Up,kd,_R,iae,HP],styles:[".loading-section[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;justify-content:center;padding:40px 0}table[_ngcontent-%COMP%]{width:100%;margin-top:16px}th.mat-header-cell[_ngcontent-%COMP%]{font-weight:700}td.mat-cell[_ngcontent-%COMP%]{word-wrap:break-word}mat-card-header[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}mat-card-actions[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:center;margin-top:12px}.back-button[_ngcontent-%COMP%]{position:fixed;top:16px;left:16px;z-index:1000;background-color:#fff;border-radius:50%;box-shadow:0 2px 6px #0003}.bg-green[_ngcontent-%COMP%]{background-color:#d4edda;color:#155724;font-weight:700;padding:4px 8px;border-radius:4px}.bg-red[_ngcontent-%COMP%]{background-color:#f8d7da;color:#721c24;font-weight:700;padding:4px 8px;border-radius:4px}"]})}return t})(),dx=(()=>{class t{authService;router;constructor(e,i){this.authService=e,this.router=i}canActivate(){return this.authService.checkIsAdmin().pipe(an(e=>!!e||this.router.createUrlTree(["/map"])),Kr(()=>Fn(this.router.createUrlTree(["/map"]))))}static \u0275fac=function(i){return new(i||t)(gn(Su),gn(oo))};static \u0275prov=Nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function xae(t,n){1&t&&(ae(0,"div",16),Re(1," \u26a0 El nombre completo es obligatorio. "),le())}function wae(t,n){1&t&&(ae(0,"div",16),Re(1," \u26a0 El nombre debe tener al menos 8 caracteres. "),le())}function Cae(t,n){1&t&&(ae(0,"div",16),Re(1," \u26a0 El nombre no puede exceder 50 caracteres. "),le())}function Eae(t,n){1&t&&(ae(0,"div",16),Re(1," \u26a0 El correo electr\xf3nico es obligatorio. "),le())}function Sae(t,n){1&t&&(ae(0,"div",16),Re(1," \u26a0 El formato de correo no es v\xe1lido. "),le())}function Dae(t,n){1&t&&(ae(0,"div",16),Re(1," \u26a0 El correo debe tener al menos 8 caracteres. "),le())}function Mae(t,n){1&t&&(ae(0,"div",16),Re(1," \u26a0 El correo no puede exceder 50 caracteres. "),le())}function Tae(t,n){1&t&&(ae(0,"div",16),Re(1," \u26a0 La ciudad de residencia es obligatoria. "),le())}function Iae(t,n){1&t&&(ae(0,"div",16),Re(1," \u26a0 El radio de notificaciones es obligatorio. "),le())}function Aae(t,n){1&t&&(ae(0,"div",16),Re(1," \u26a0 El radio de notificaciones debe ser mayor que 0. "),le())}function kae(t,n){if(1&t){const e=_i();ae(0,"div")(1,"div",5),Wt(2,"i",6)(3,"input",7),le(),vt(4,xae,2,0,"div",8)(5,wae,2,0,"div",8)(6,Cae,2,0,"div",8),ae(7,"div",5),Wt(8,"i",9)(9,"input",10),le(),vt(10,Eae,2,0,"div",8)(11,Sae,2,0,"div",8)(12,Dae,2,0,"div",8)(13,Mae,2,0,"div",8),ae(14,"div",5),Wt(15,"i",11)(16,"input",12),le(),vt(17,Tae,2,0,"div",8),ae(18,"div",5),Wt(19,"i",13)(20,"input",14),le(),vt(21,Iae,2,0,"div",8)(22,Aae,2,0,"div",8),ae(23,"button",15),Tt("click",function(){return on(e),ln(Lt().continueToMap())}),Re(24," Actualizar Ubicaci\xf3n "),le()()}if(2&t){const e=Lt();xe(4),Xe("ngIf",e.hasError("fullName","required")),xe(),Xe("ngIf",e.hasError("fullName","minlength")),xe(),Xe("ngIf",e.hasError("fullName","maxlength")),xe(4),Xe("ngIf",e.hasError("email","required")),xe(),Xe("ngIf",e.hasError("email","email")),xe(),Xe("ngIf",e.hasError("email","minlength")),xe(),Xe("ngIf",e.hasError("email","maxlength")),xe(4),Xe("ngIf",e.hasError("cityOfResidence","required")),xe(4),Xe("ngIf",e.hasError("notificationRadiusKm","required")),xe(),Xe("ngIf",e.hasError("notificationRadiusKm","min")),xe(),Xe("disabled",e.profileForm.invalid)}}function Rae(t,n){1&t&&(ae(0,"div",17),Re(1," Cargando mapa... "),le())}function Pae(t,n){1&t&&Wt(0,"i",23)}function Oae(t,n){if(1&t){const e=_i();ae(0,"div"),Wt(1,"div",18),ae(2,"p",19),Re(3,"Haz clic en el mapa para actualizar tu ubicaci\xf3n"),le(),ae(4,"div",20)(5,"button",21),vt(6,Pae,1,0,"i",22),Re(7),le(),ae(8,"button",15),Tt("click",function(){return on(e),ln(Lt().showMap=!1)}),Re(9," Cancelar "),le()()()}if(2&t){const e=Lt();xe(5),Xe("disabled",e.profileForm.invalid||e.isSubmitting),xe(),Xe("ngIf",e.isSubmitting),xe(),Ci(" ",e.isSubmitting?"Guardando...":"Guardar Cambios"," "),xe(),Xe("disabled",e.isSubmitting)}}function Lae(t,n){1&t&&(ae(0,"div",13),Re(1," \u26a0 La contrase\xf1a actual es obligatoria. "),le())}function Nae(t,n){1&t&&(ae(0,"div",13),Re(1," \u26a0 La nueva contrase\xf1a es obligatoria. "),le())}function zae(t,n){1&t&&(ae(0,"div",13),Re(1," \u26a0 Debe tener entre 8 y 50 caracteres. "),le())}function Bae(t,n){1&t&&(ae(0,"div",13),Re(1," \u26a0 Debe contener al menos un d\xedgito, una may\xfascula y una min\xfascula. "),le())}function Vae(t,n){1&t&&Wt(0,"i",14)}function jae(t,n){if(1&t){const e=_i();ae(0,"mat-card",3)(1,"mat-card-header",4)(2,"mat-card-title"),Re(3),le(),ae(4,"mat-card-subtitle"),Re(5),le()(),ae(6,"mat-card-content",5)(7,"div",6)(8,"strong"),Re(9,"Ciudad:"),le(),ae(10,"span"),Re(11),le()(),ae(12,"div",6)(13,"strong"),Re(14,"Radio de notificaciones:"),le(),ae(15,"span"),Re(16),le()()(),ae(17,"mat-card-actions",7)(18,"button",8),Tt("click",function(){return on(e),ln(Lt().onEditData())}),ae(19,"mat-icon"),Re(20,"edit"),le(),Re(21," Editar datos "),le(),ae(22,"button",9),Tt("click",function(){return on(e),ln(Lt().onUpdatePassword())}),ae(23,"mat-icon"),Re(24,"lock"),le(),Re(25," Actualizar contrase\xf1a "),le(),ae(26,"button",10),Tt("click",function(){return on(e),ln(Lt().onDeleteAccount())}),ae(27,"mat-icon",11),Re(28,"delete_forever"),le(),Re(29," Eliminar cuenta "),le()()()}if(2&t){const e=Lt();xe(3),er(e.user.fullName),xe(2),er(e.user.email),xe(6),er(e.user.cityOfResidence),xe(5),Ci("",e.user.notificationRadiusKm," km")}}function Hae(t,n){1&t&&(ae(0,"div",12),Wt(1,"mat-progress-spinner",13),le())}const Gae=()=>[5,10,25],qae=(t,n,e,i)=>({"status-pending":t,"status-rejected":n,"status-verified":e,"status-resolved":i});function Wae(t,n){if(1&t&&(ae(0,"mat-option",8),Re(1),le()),2&t){const e=n.$implicit;Xe("value",e),xe(),Ci(" ",e," ")}}function Yae(t,n){1&t&&(ae(0,"div",9),Wt(1,"mat-spinner",10),le())}function Zae(t,n){1&t&&(ae(0,"th",25),Re(1,"T\xedtulo"),le())}function Xae(t,n){if(1&t&&(ae(0,"td",26),Re(1),le()),2&t){const e=n.$implicit;xe(),er(e.title)}}function Kae(t,n){1&t&&(ae(0,"th",25),Re(1,"Descripci\xf3n"),le())}function Qae(t,n){if(1&t&&(ae(0,"td",26),Re(1),le()),2&t){const e=n.$implicit;xe(),er(e.description)}}function Jae(t,n){1&t&&(ae(0,"th",25),Re(1,"Categor\xedas"),le())}function ele(t,n){if(1&t&&(ae(0,"mat-chip"),Re(1),le()),2&t){const e=n.$implicit;xe(),er(e.name)}}function tle(t,n){if(1&t&&(ae(0,"td",26)(1,"mat-chip-set"),vt(2,ele,2,1,"mat-chip",27),le()()),2&t){const e=n.$implicit;xe(2),Xe("ngForOf",e.categoryList)}}function nle(t,n){1&t&&(ae(0,"th",25),Re(1,"Ubicaci\xf3n"),le())}function ile(t,n){if(1&t&&(ae(0,"td",26),Re(1),le()),2&t){const e=n.$implicit;xe(),Py(" ",e.latitude,", ",e.longitude," ")}}function rle(t,n){1&t&&(ae(0,"th",25),Re(1,"Estado"),le())}function ole(t,n){if(1&t&&(ae(0,"td",26)(1,"span",28),Re(2),le()()),2&t){const e=n.$implicit;xe(),Xe("ngClass",vk(2,qae,"PENDING"===e.reportStatus,"REJECTED"===e.reportStatus,"VERIFIED"===e.reportStatus,"RESOLVED"===e.reportStatus)),xe(),Ci(" ",e.reportStatus," ")}}function sle(t,n){1&t&&(ae(0,"th",25),Re(1,"Fecha Creaci\xf3n"),le())}function ale(t,n){if(1&t&&(ae(0,"td",26),Re(1),Jf(2,"date"),le()),2&t){const e=n.$implicit;xe(),Ci(" ",S0(2,1,e.createdAt,"short")," ")}}function lle(t,n){1&t&&(ae(0,"th",25),Re(1,"Votos"),le())}function cle(t,n){if(1&t&&(ae(0,"td",26),Re(1),le()),2&t){const e=n.$implicit;xe(),er(e.importantVotes)}}function dle(t,n){1&t&&(ae(0,"th",25),Re(1,"Acciones"),le())}function ule(t,n){if(1&t){const e=_i();Qi(0),ae(1,"button",31),Tt("click",function(){on(e);const r=Lt().$implicit;return ln(Lt(2).resolveReport(r.id))}),ae(2,"mat-icon"),Re(3,"done_all"),le(),Re(4," Resolver "),le(),Ji()}}function hle(t,n){if(1&t){const e=_i();ae(0,"td",26),Qi(1),ae(2,"button",29),Tt("click",function(){const r=on(e).$implicit;return ln(Lt(2).editReport(r.id))}),ae(3,"mat-icon"),Re(4,"edit"),le(),Re(5," Editar "),le(),ae(6,"button",30),Tt("click",function(){const r=on(e).$implicit;return ln(Lt(2).deleteReport(r.id))}),ae(7,"mat-icon"),Re(8,"close"),le(),Re(9," Eliminar "),le(),Ji(),vt(10,ule,5,0,"ng-container",7),le()}if(2&t){const e=n.$implicit;xe(10),Xe("ngIf","VERIFIED"===e.reportStatus)}}function ple(t,n){1&t&&Wt(0,"tr",32)}function fle(t,n){1&t&&Wt(0,"tr",33)}function mle(t,n){if(1&t){const e=_i();ae(0,"div")(1,"table",11),Qi(2,12),vt(3,Zae,2,0,"th",13)(4,Xae,2,1,"td",14),Ji(),Qi(5,15),vt(6,Kae,2,0,"th",13)(7,Qae,2,1,"td",14),Ji(),Qi(8,16),vt(9,Jae,2,0,"th",13)(10,tle,3,1,"td",14),Ji(),Qi(11,17),vt(12,nle,2,0,"th",13)(13,ile,2,2,"td",14),Ji(),Qi(14,18),vt(15,rle,2,0,"th",13)(16,ole,3,7,"td",14),Ji(),Qi(17,19),vt(18,sle,2,0,"th",13)(19,ale,3,4,"td",14),Ji(),Qi(20,20),vt(21,lle,2,0,"th",13)(22,cle,2,1,"td",14),Ji(),Qi(23,21),vt(24,dle,2,0,"th",13)(25,hle,11,1,"td",14),Ji(),vt(26,ple,1,0,"tr",22)(27,fle,1,0,"tr",23),le(),ae(28,"mat-paginator",24),Tt("page",function(r){return on(e),ln(Lt().onPageChange(r))}),le()()}if(2&t){const e=Lt();xe(),Xe("dataSource",e.filteredContent()),xe(25),Xe("matHeaderRowDef",e.displayedColumns),xe(),Xe("matRowDefColumns",e.displayedColumns),xe(),Xe("length",e.paginatedData().totalElements)("pageSize",e.paginatedData().size)("pageIndex",e.paginatedData().page-1)("pageSizeOptions",HD(7,Gae))}}const gle=[{path:"",redirectTo:"login",pathMatch:"full"},{path:"login",component:Jee},{path:"register",component:Yee},{path:"validate-account",component:y5},{path:"map",component:bte,canActivate:[av]},{path:"report/new",component:v5,canActivate:[av]},{path:"report/edit/:id",component:v5,canActivate:[av]},{path:"user/edit",component:(()=>{class t{fb;authService;notificationService;router;cdr;profileForm;showMap=!1;isLoadingMap=!1;map;marker;isSubmitting=!1;currentUser;constructor(e,i,r,l,f){this.fb=e,this.authService=i,this.notificationService=r,this.router=l,this.cdr=f,this.profileForm=this.fb.group({email:["",[bn.required,bn.email,bn.minLength(8),bn.maxLength(50)]],fullName:["",[bn.required,bn.minLength(8),bn.maxLength(50)]],cityOfResidence:["",bn.required],notificationRadiusKm:[null,[bn.required,bn.min(1)]],latitude:[null,bn.required],longitude:[null,bn.required]})}ngOnInit(){this.loadUserData()}ngAfterViewInit(){this.currentUser?.latitude&&this.currentUser?.longitude&&setTimeout(()=>{this.showMap=!0,this.initializeMap({lng:this.currentUser.longitude,lat:this.currentUser.latitude}),this.cdr.detectChanges()},0)}loadUserData(){this.authService.getMe().subscribe({next:e=>{this.currentUser=e,this.populateForm(e)},error:()=>{this.notificationService.error("Error al cargar los datos del usuario"),this.router.navigate(["/"])}})}populateForm(e){this.profileForm.patchValue({email:e.email,fullName:e.fullName,dateBirth:e.dateBirth,cityOfResidence:e.cityOfResidence,notificationRadiusKm:e.notificationRadiusKm,latitude:e.latitude,longitude:e.longitude})}hasError(e,i){const r=this.profileForm.get(e);return!!(r&&r.touched&&r.hasError(i))}continueToMap(){if(!this.profileForm.valid)return void this.profileForm.markAllAsTouched();const i=this.profileForm.get("cityOfResidence").value;if(i===this.currentUser.cityOfResidence)return this.showMap=!0,this.isLoadingMap=!1,this.cdr.detectChanges(),void setTimeout(()=>{const r=this.profileForm.get("latitude").value,l=this.profileForm.get("longitude").value;this.initializeMap({lng:l,lat:r})},0);this.isLoadingMap=!0,this.showMap=!0,this.cdr.detectChanges(),console.log("Buscando coordenadas para:",i),this.getCityCoordinates(i).then(r=>{setTimeout(()=>this.initializeMap({lng:r.lng,lat:r.lat}),0)}).catch(r=>{console.error("Error al obtener coordenadas:",r),this.notificationService.error("Ciudad no encontrada"===r?.message?"No pudimos encontrar tu ciudad. Revisa el nombre.":"Ocurri\xf3 un error al cargar el mapa. Intenta nuevamente."),this.showMap=!1}).finally(()=>this.isLoadingMap=!1)}initializeMap(e){console.log("Inicializando mapa con coords:",e),this.map&&(this.map.remove(),console.log("Mapa anterior eliminado")),this.map=new(ss().Map)({container:"map_user",style:"mapbox://styles/mapbox/streets-v11",center:[e.lng,e.lat],zoom:12,accessToken:iv_mapboxToken}),this.map.on("load",()=>{this.map.resize(),this.isLoadingMap=!1}),this.map.addControl(new(ss().NavigationControl),"bottom-right"),this.map.on("click",({lngLat:i})=>this.onMapClick(i)),this.addMarker(e)}onMapClick(e){this.updateLocation(e),this.marker?this.marker.setLngLat(e):this.addMarker({lng:e.lng,lat:e.lat})}addMarker(e){this.marker&&this.marker.remove(),this.marker=new(ss().Marker)({draggable:!0,anchor:"center"}).setLngLat([e.lng,e.lat]).addTo(this.map).on("dragend",()=>{const i=this.marker.getLngLat();this.updateLocation(i)})}updateLocation(e){this.profileForm.patchValue({latitude:e.lat,longitude:e.lng})}getCityCoordinates(e){const r=`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(e+", Colombia")}.json?access_token=${iv_mapboxToken}&limit=1`;return fetch(r).then(l=>l.json()).then(l=>{if(!l.features||0===l.features.length)throw new Error("No se encontr\xf3 la ciudad");const[f,w]=l.features[0].center;return{lng:f,lat:w}})}onSubmit(){this.profileForm.invalid?this.profileForm.markAllAsTouched():(this.isSubmitting=!0,this.authService.updateUser(this.currentUser.id,this.profileForm.value).subscribe({next:i=>{this.notificationService.success("Datos actualizados correctamente"),this.currentUser=i,this.isSubmitting=!1,this.goBack()},error:i=>{this.notificationService.error(i.error?.message||"Error al actualizar los datos"),this.populateForm(this.currentUser),this.isSubmitting=!1}}))}goBack(){this.router.navigate(["/profile"])}static \u0275fac=function(i){return new(i||t)(ft(Bp),ft(Su),ft(Uc),ft(oo),ft(Do))};static \u0275cmp=kn({type:t,selectors:[["app-profile"]],decls:10,vars:4,consts:[["mat-icon-button","","aria-label","Volver",1,"back-button",3,"click"],[1,"profile-container"],[3,"ngSubmit","formGroup"],[4,"ngIf"],["class","loading-spinner",4,"ngIf"],[1,"field-group"],[1,"icon","fa","fa-user"],["type","text","placeholder","Nombre completo","formControlName","fullName"],["class","error-message",4,"ngIf"],[1,"icon","fa","fa-envelope"],["type","email","placeholder","Correo electr\xf3nico","formControlName","email"],[1,"icon","fa","fa-city"],["type","text","placeholder","Ciudad de residencia","formControlName","cityOfResidence"],[1,"icon","fa","fa-bullhorn"],["type","number","placeholder","Radio de notificaciones (Km)","formControlName","notificationRadiusKm"],["type","button",1,"submit-button",3,"click","disabled"],[1,"error-message"],[1,"loading-spinner"],["id","map_user"],[1,"map-instructions"],[1,"form-actions"],["type","submit",1,"submit-button",3,"disabled"],["class","fas fa-spinner fa-spin me-2",4,"ngIf"],[1,"fas","fa-spinner","fa-spin","me-2"]],template:function(i,r){1&i&&(ae(0,"button",0),Tt("click",function(){return r.goBack()}),ae(1,"mat-icon"),Re(2,"arrow_back"),le()(),ae(3,"div",1)(4,"h2"),Re(5,"Actualizar campos"),le(),ae(6,"form",2),Tt("ngSubmit",function(){return r.onSubmit()}),vt(7,kae,25,11,"div",3)(8,Rae,2,0,"div",4)(9,Oae,10,4,"div",3),le()()),2&i&&(xe(6),Xe("formGroup",r.profileForm),xe(),Xe("ngIf",!r.showMap),xe(),Xe("ngIf",r.isLoadingMap),xe(),Xe("ngIf",r.showMap&&!r.isLoadingMap))},dependencies:[Ea,Os,Vp,kh,dc,qC,Ad,Ah,el,Mu,kd],styles:["[_ngcontent-%COMP%]:root{--primary-bg: #e0f4fa;--primary-accent: #79b4d8;--primary-dark: #1e3a5f;--input-bg: #ffffff;--error-color: #e74c3c;--cancel-color: #95a5a6}.profile-container[_ngcontent-%COMP%]{width:360px;background:var(--input-bg);margin:60px auto;padding:30px;border-radius:12px;text-align:center;box-shadow:0 4px 15px #0000001a;position:relative}.profile-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:24px;margin:0 0 25px;color:var(--primary-dark)}.field-group[_ngcontent-%COMP%]{position:relative;margin-bottom:15px}.field-group[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{position:absolute;top:50%;left:12px;transform:translateY(-50%);color:var(--primary-accent);font-size:18px}.field-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:12px 12px 12px 40px;border:2px solid #ccc;border-radius:6px;font-size:14px;background:var(--input-bg);transition:border-color .2s ease;box-sizing:border-box}.field-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary-accent)}.error-message[_ngcontent-%COMP%]{text-align:left;color:var(--error-color);font-size:13px;margin:-10px 0 10px;padding-left:40px}.submit-button[_ngcontent-%COMP%]{width:100%;padding:12px;margin-top:3px;background:var(--primary-accent);color:#000;border:none;border-radius:6px;cursor:pointer;font-size:16px;font-weight:600;transition:background .3s ease,transform .2s ease;box-shadow:0 2px 8px #00000026}.cancel-button[_ngcontent-%COMP%]{width:100%;padding:12px;margin-top:10px;background:var(--cancel-color);color:#fff;border:none;border-radius:6px;cursor:pointer;font-size:16px;font-weight:600;transition:background .3s ease}.submit-button[_ngcontent-%COMP%]:disabled, .cancel-button[_ngcontent-%COMP%]:disabled{opacity:.7;cursor:not-allowed}.submit-button[_ngcontent-%COMP%]:not(:disabled):hover{background:var(--primary-dark);transform:translateY(-2px)}.cancel-button[_ngcontent-%COMP%]:not(:disabled):hover{background:#7f8c8d}#map_user[_ngcontent-%COMP%]{width:100%;height:400px;border:1px solid #ccc;border-radius:4px;margin-bottom:15px}.map-instructions[_ngcontent-%COMP%]{color:var(--primary-dark);font-size:14px;margin-bottom:20px}.loading-spinner[_ngcontent-%COMP%]{font-size:16px;color:var(--primary-dark);margin:20px 0}.back-button[_ngcontent-%COMP%]{position:fixed;top:16px;left:16px;z-index:1000;background-color:#fff;border-radius:50%;box-shadow:0 2px 6px #0003}.form-actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}"]})}return t})(),canActivate:[av]},{path:"user/edit/password",component:(()=>{class t{fb;authService;notificationService;router;passwordForm;isSubmitting=!1;userId;constructor(e,i,r,l){this.fb=e,this.authService=i,this.notificationService=r,this.router=l}ngOnInit(){this.initForm(),this.authService.getMe().subscribe({next:e=>this.userId=e.id,error:()=>{this.notificationService.error("Error al obtener informaci\xf3n del usuario"),this.router.navigate(["/"])}})}initForm(){this.passwordForm=this.fb.group({currentPassword:["",[bn.required]],newPassword:["",[bn.required,bn.minLength(8),bn.maxLength(50),bn.pattern(/^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).*$/)]]})}hasError(e,i){const r=this.passwordForm.get(e);return!!(r&&r.touched&&r.hasError(i))}onSubmit(){this.passwordForm.invalid?this.passwordForm.markAllAsTouched():(this.isSubmitting=!0,this.authService.updatePassword(this.userId,this.passwordForm.value).subscribe({next:()=>{this.notificationService.success("Contrase\xf1a actualizada correctamente"),this.router.navigate(["/profile"])},error:i=>{this.notificationService.error(i.error?.message||"Error al actualizar la contrase\xf1a"),this.isSubmitting=!1}}))}goBack(){this.router.navigate(["/profile"])}static \u0275fac=function(i){return new(i||t)(ft(Bp),ft(Su),ft(Uc),ft(oo))};static \u0275cmp=kn({type:t,selectors:[["app-password-update"]],decls:23,vars:9,consts:[["mat-icon-button","","aria-label","Volver",1,"back-button",3,"click"],[1,"password-update-container"],["novalidate","",3,"ngSubmit","formGroup"],[1,"field-group"],[1,"icon","fa","fa-lock"],["type","password","placeholder","Contrase\xf1a actual","formControlName","currentPassword"],["class","error-message",4,"ngIf"],[1,"icon","fa","fa-key"],["type","password","placeholder","Nueva contrase\xf1a","formControlName","newPassword"],[1,"button-group"],["type","submit",3,"disabled"],["class","fas fa-spinner fa-spin",4,"ngIf"],["type","button",3,"click","disabled"],[1,"error-message"],[1,"fas","fa-spinner","fa-spin"]],template:function(i,r){1&i&&(ae(0,"button",0),Tt("click",function(){return r.goBack()}),ae(1,"mat-icon"),Re(2,"arrow_back"),le()(),ae(3,"div",1)(4,"h2"),Re(5,"Actualizar contrase\xf1a"),le(),ae(6,"form",2),Tt("ngSubmit",function(){return r.onSubmit()}),ae(7,"div",3),Wt(8,"i",4)(9,"input",5),le(),vt(10,Lae,2,0,"div",6),ae(11,"div",3),Wt(12,"i",7)(13,"input",8),le(),vt(14,Nae,2,0,"div",6)(15,zae,2,0,"div",6)(16,Bae,2,0,"div",6),ae(17,"div",9)(18,"button",10),vt(19,Vae,1,0,"i",11),Re(20),le(),ae(21,"button",12),Tt("click",function(){return r.goBack()}),Re(22," Cancelar "),le()()()()),2&i&&(xe(6),Xe("formGroup",r.passwordForm),xe(4),Xe("ngIf",r.hasError("currentPassword","required")),xe(4),Xe("ngIf",r.hasError("newPassword","required")),xe(),Xe("ngIf",r.hasError("newPassword","minlength")||r.hasError("newPassword","maxlength")),xe(),Xe("ngIf",r.hasError("newPassword","pattern")),xe(2),Xe("disabled",r.isSubmitting),xe(),Xe("ngIf",r.isSubmitting),xe(),Ci(" ",r.isSubmitting?"Actualizando...":"Actualizar contrase\xf1a"," "),xe(),Xe("disabled",r.isSubmitting))},dependencies:[Ea,Os,Vp,kh,dc,Ad,Ah,el,Mu,kd],styles:["[_ngcontent-%COMP%]:root{--primary-bg: #e0f4fa;--primary-accent: #79b4d8;--primary-dark: #1e3a5f;--input-bg: #ffffff;--error-color: #e74c3c}.password-update-container[_ngcontent-%COMP%]{width:360px;background:var(--input-bg);margin:60px auto;padding:30px;border-radius:12px;text-align:center;box-shadow:0 4px 15px #0000001a;position:relative}.password-update-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:24px;margin-bottom:25px;color:var(--primary-dark)}.field-group[_ngcontent-%COMP%]{position:relative;margin-bottom:15px}.field-group[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{position:absolute;top:50%;left:12px;transform:translateY(-50%);color:var(--primary-accent);font-size:18px}.field-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:12px 12px 12px 40px;border:2px solid #ccc;border-radius:6px;font-size:14px;background:var(--input-bg);transition:border-color .2s ease;box-sizing:border-box}.field-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary-accent)}.error-message[_ngcontent-%COMP%]{text-align:left;color:var(--error-color);font-size:13px;margin:-10px 0 10px;padding-left:40px}.button-group[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:10px}.button-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1;padding:12px;background:var(--primary-accent);color:#000;border:none;border-radius:6px;cursor:pointer;font-size:16px;font-weight:600;transition:background .3s ease,transform .2s ease;box-shadow:0 2px 8px #00000026}.button-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{background:#aaa;color:#ccc;cursor:not-allowed}.button-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:not(:disabled):hover{background:var(--primary-dark);transform:translateY(-2px)}.back-button[_ngcontent-%COMP%]{position:fixed;top:16px;left:16px;z-index:1000;background-color:#fff;border-radius:50%;box-shadow:0 2px 6px #0003}.fa-spinner[_ngcontent-%COMP%]{margin-right:8px}"]})}return t})(),canActivate:[av]},{path:"profile",component:(()=>{class t{authService=te(Su);notification=te(Uc);router=te(oo);dialog=te(Vg);user;loading=!0;ngOnInit(){this.authService.getMe().subscribe({next:e=>{this.user=e},error:e=>{console.error("Error al cargar perfil",e),this.notification.error("No fue posible cargar tu perfil"),this.router.navigate(["/"])},complete:()=>this.loading=!1})}onEditData(){this.router.navigate(["/user/edit"])}onUpdatePassword(){this.router.navigate(["/user/edit/password"])}onDeleteAccount(){this.user?.id&&this.dialog.open(Gg,{data:{title:"Eliminar cuenta",message:"\xbfEst\xe1s seguro de que deseas eliminar tu cuenta? Esta acci\xf3n no se puede deshacer.",confirmText:"Eliminar",cancelText:"Cancelar"}}).afterClosed().subscribe(i=>{i&&this.authService.deleteUser(this.user.id).subscribe({next:()=>{this.notification.success("Cuenta eliminada correctamente"),this.router.navigate(["/login"])},error:r=>{console.error("Error al eliminar cuenta",r),this.notification.error("No se pudo eliminar tu cuenta")}})})}goBack(){this.router.navigate(["/map"])}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=kn({type:t,selectors:[["app-profile"]],decls:5,vars:2,consts:[["mat-icon-button","","aria-label","Volver",1,"back-button",3,"click"],["class","profile-card",4,"ngIf"],["class","loading-spinner",4,"ngIf"],[1,"profile-card"],[1,"profile-header"],[1,"content"],[1,"info-group"],[1,"actions"],["mat-stroked-button","",3,"click"],["mat-stroked-button","","color","primary",3,"click"],["mat-flat-button","","color","primary",1,"delete-button",3,"click"],[1,"delete-icon"],[1,"loading-spinner"],["mode","indeterminate"]],template:function(i,r){1&i&&(ae(0,"button",0),Tt("click",function(){return r.goBack()}),ae(1,"mat-icon"),Re(2,"arrow_back"),le()(),vt(3,jae,30,4,"mat-card",1)(4,Hae,2,0,"div",2)),2&i&&(xe(3),Xe("ngIf",!r.loading&&r.user),xe(),Xe("ngIf",r.loading))},dependencies:[Ea,Os,nx,lv,bP,lE,cE,vP,aE,Hg,jg,Ug,Up,kd,_R,rx],styles:["[_ngcontent-%COMP%]:root{--primary-bg: #e0f4fa;--primary-accent: #79b4d8;--primary-dark: #1e3a5f;--input-bg: #ffffff;--error-color: #e74c3c}.back-button[_ngcontent-%COMP%]{position:fixed;top:16px;left:16px;background-color:var(--input-bg);color:var(--primary-dark);border-radius:50%;box-shadow:0 2px 6px #0000001a;z-index:1000;transition:all .2s ease}.back-button[_ngcontent-%COMP%]:hover{background-color:var(--primary-bg);transform:scale(1.05)}.profile-card[_ngcontent-%COMP%]{max-width:500px;width:90%;margin:80px auto 40px;padding:24px;background:var(--input-bg);border-radius:12px;box-shadow:0 4px 15px #0000001a}.profile-header[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;margin-bottom:20px;text-align:center;width:100%}.avatar-center[_ngcontent-%COMP%]{width:80px;height:80px;margin:0 auto 16px;border-radius:50%;background-color:var(--primary-bg);color:var(--primary-dark);display:flex;align-items:center;justify-content:center}.avatar-center[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:36px}mat-card-title[_ngcontent-%COMP%]{font-size:1.5rem;color:var(--primary-dark);margin:0 auto 4px;text-align:center;width:100%}mat-card-subtitle[_ngcontent-%COMP%]{color:var(--primary-accent);font-size:1rem;text-align:center;width:100%;margin:0 auto}.content[_ngcontent-%COMP%]{padding:16px 0;margin:16px 0;border-top:1px solid rgba(0,0,0,.1);border-bottom:1px solid rgba(0,0,0,.1)}.info-group[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:12px;padding:0 8px}.info-group[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:var(--primary-dark)}.actions[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;justify-content:center;gap:12px;margin-top:24px}.actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:160px;padding:8px 16px;display:flex;align-items:center;justify-content:center;gap:8px;border-radius:6px;transition:all .2s ease}.actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px}button[color=warn][_ngcontent-%COMP%]{background-color:var(--error-color);color:#fff}button[color=warn][_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#fff}.loading-spinner[_ngcontent-%COMP%]{display:flex;justify-content:center;margin-top:80px}@media (max-width: 600px){.profile-card[_ngcontent-%COMP%]{margin-top:60px;padding:16px}.actions[_ngcontent-%COMP%]{flex-direction:column;gap:8px}.actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}}"]})}return t})(),canActivate:[av]},{path:"my-reports",component:(()=>{class t{reportService=te(q0);notificationService=te(Uc);dialog=te(Vg);loading=wr(!1);paginatedData=wr({content:[],page:0,size:10,totalElements:0,totalPages:0});router=te(oo);statuses=["PENDING","VERIFIED","REJECTED","RESOLVED"];selectedStatus=wr("");filteredContent=Sd(()=>{const e=this.paginatedData().content,i=this.selectedStatus();return i?e.filter(r=>r.reportStatus===i):e});displayedColumns=["title","description","categories","location","reportStatus","dateCreation","importantVotes","actions"];ngOnInit(){this.loadReports(1,10)}loadReports(e,i,r=""){this.loading.set(!0),this.reportService.getMyReportsPaginated(e,i,r).subscribe({next:l=>this.paginatedData.set(l),error:l=>{},complete:()=>this.loading.set(!1)})}deleteReport(e){e&&this.dialog.open(Gg,{data:{title:"Eliminar Reporte",message:"\xbfSeguro que quieres eliminar este reporte?",confirmText:"Eliminar",cancelText:"Cancelar"}}).afterClosed().subscribe(r=>{!0===r&&this.reportService.deleteReport(e).subscribe({next:()=>{this.notificationService.success("\u2705 Reporte eliminado correctamente."),this.loadReports(1,10)},error:l=>{console.error("\u274c Error al rechazar reporte:",l),this.notificationService.error("Ocurri\xf3 un error al rechazar el reporte.")}})})}editReport(e){e&&this.router.navigate([`report/edit/${e}`])}resolveReport(e){e&&this.dialog.open(Gg,{data:{title:"Resolver reporte",message:"\xbfDeseas marcar este reporte como resuelto?",confirmText:"Resolver",cancelText:"Cancelar"}}).afterClosed().subscribe(r=>{!0===r&&this.reportService.updateReportStatus(e,"RESOLVED").subscribe({next:()=>{this.notificationService.success("\u2705 Reporte marcado como resuelto."),this.loadReports(1,10)},error:l=>{console.error("\u274c Error al resolver reporte:",l),this.notificationService.error("Ocurri\xf3 un error al resolver el reporte.")}})})}onPageChange(e){this.loadReports(e.pageIndex+1,e.pageSize,this.selectedStatus())}onStatusChange(e){this.selectedStatus.set(e),this.loadReports(1,this.paginatedData().size,e)}goBack(){this.router.navigate(["/map"])}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=kn({type:t,selectors:[["app-report-list"]],decls:16,vars:4,consts:[["mat-icon-button","","aria-label","Volver",1,"back-button",3,"click"],[1,"contenedor"],["appearance","outline",1,"status-filter"],[3,"selectionChange","value"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","loading-container",4,"ngIf"],[4,"ngIf"],[3,"value"],[1,"loading-container"],["diameter","50"],["mat-table","",1,"mat-elevation-z8",3,"dataSource"],["matColumnDef","title"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","description"],["matColumnDef","categories"],["matColumnDef","location"],["matColumnDef","reportStatus"],["matColumnDef","dateCreation"],["matColumnDef","importantVotes"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["aria-label","Seleccionar p\xe1gina",3,"page","length","pageSize","pageIndex","pageSizeOptions"],["mat-header-cell",""],["mat-cell",""],[4,"ngFor","ngForOf"],[3,"ngClass"],["mat-raised-button","","color","primary",1,"action-button",3,"click"],["mat-raised-button","","color","warn",1,"action-button",3,"click"],["mat-raised-button","","color","accent",1,"action-button",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(i,r){1&i&&(ae(0,"button",0),Tt("click",function(){return r.goBack()}),ae(1,"mat-icon"),Re(2,"arrow_back"),le()(),ae(3,"mat-card",1)(4,"h1"),Re(5,"Mis Reportes"),le(),Wt(6,"mat-divider"),ae(7,"mat-form-field",2)(8,"mat-label"),Re(9,"Filtrar por estado"),le(),ae(10,"mat-select",3),Tt("selectionChange",function(f){return r.onStatusChange(f.value)}),ae(11,"mat-option",4),Re(12,"Todos"),le(),vt(13,Wae,2,2,"mat-option",5),le()(),vt(14,Yae,2,0,"div",6)(15,mle,29,8,"div",7),le()),2&i&&(xe(10),Xe("value",r.selectedStatus()),xe(3),Xe("ngForOf",r.statuses),xe(),Xe("ngIf",r.loading()),xe(),Xe("ngIf",!r.loading()))},dependencies:[Ea,im,kg,Os,I0,Wg,tx,ex,sE,HT,oE,uE,rx,NT,JC,X0,eE,K0,Z0,tE,Q0,J0,nE,iE,yP,GT,nx,lv,xP,iU,TP,Yg,dE,Up,kd],styles:["[_ngcontent-%COMP%]:root{--primary-bg: #e0f4fa;--primary-accent: #79b4d8;--primary-dark: #1e3a5f;--input-bg: #ffffff;--error-color: #e74c3c;--resolve-color: #26a69a;--table-header-bg: #d0eaf5;--table-row-hover: #f2faff}mat-card[_ngcontent-%COMP%]{margin:2rem auto;padding:1.5rem;background:var(--input-bg);box-shadow:0 4px 20px #0000001a;border-radius:12px}mat-card[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin-bottom:.5rem;color:var(--primary-dark);font-weight:600;font-size:24px}.status-filter[_ngcontent-%COMP%]{width:250px;margin:1.5rem 0}.loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:50px 0}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;background-color:#fff;border-radius:8px;overflow:hidden;box-shadow:0 2px 8px #0000000d}th.mat-header-cell[_ngcontent-%COMP%]{background-color:var(--table-header-bg);color:var(--primary-dark);font-weight:600;padding:12px;border-bottom:1px solid #ccc}td.mat-cell[_ngcontent-%COMP%]{padding:12px 16px;color:#333;border-bottom:1px solid #eee}tr.mat-row[_ngcontent-%COMP%]:hover{background-color:var(--table-row-hover);transition:background-color .2s ease-in-out}mat-chip[_ngcontent-%COMP%]{background-color:var(--primary-accent);color:#fff;font-weight:500;margin-right:5px}.status-pending[_ngcontent-%COMP%], .status-rejected[_ngcontent-%COMP%], .status-verified[_ngcontent-%COMP%], .status-resolved[_ngcontent-%COMP%]{display:inline-block;padding:6px 10px;border-radius:4px;font-weight:600;font-size:13px}.status-pending[_ngcontent-%COMP%]{background-color:#fff59d;color:#444}.status-rejected[_ngcontent-%COMP%]{background-color:#ef9a9a;color:#fff}.status-verified[_ngcontent-%COMP%]{background-color:#a5d6a7;color:#fff}.status-resolved[_ngcontent-%COMP%]{background-color:#81d4fa;color:#fff}td.mat-cell[_ngcontent-%COMP%] > ng-container[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:8px 0}.action-button[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;gap:6px;height:36px;width:120px;padding:0 12px;font-size:13px;font-weight:500;line-height:1;border-radius:6px;box-shadow:0 2px 4px #0000001a;text-transform:none;box-sizing:border-box;transition:background-color .2s ease,box-shadow .2s ease}.action-button[color=primary][_ngcontent-%COMP%]{background-color:var(--primary-accent);color:#000}.action-button[color=primary][_ngcontent-%COMP%]:hover{background-color:#1e8e81;box-shadow:0 3px 6px #00000026;color:#fff}.action-button[color=warn][_ngcontent-%COMP%]{background-color:var(--error-color);color:#000}.action-button[color=warn][_ngcontent-%COMP%]:hover{background-color:#ac1e08;color:#fff}.action-button[color=accent][_ngcontent-%COMP%]{background-color:var(--resolve-color);color:#000}.action-button[color=accent][_ngcontent-%COMP%]:hover{background-color:#5fa2c9;color:#fff}.action-button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;line-height:1}mat-paginator[_ngcontent-%COMP%]{margin-top:1.5rem;background:transparent}.back-button[_ngcontent-%COMP%]{position:fixed;top:16px;left:16px;z-index:1000;width:40px;height:40px;padding:0;background-color:#fff;border:1px solid #ccc;border-radius:8px;box-shadow:0 4px 12px #0000000d;display:flex;align-items:center;justify-content:center;transition:background-color .2s ease,transform .1s ease}.back-button[_ngcontent-%COMP%]:hover{background-color:#f9f9f9;transform:translate(-2px)}.back-button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;color:#0009}"]})}return t})(),canActivate:[av]},{path:"validate-account",component:y5},{path:"reset-password",component:Zte},{path:"report-list-admin",component:uoe,canActivate:[dx]},{path:"report-histories",component:Sse,canActivate:[dx]},{path:"report-summary",component:Hse,canActivate:[dx]},{path:"category-list",component:bae,canActivate:[dx]},{path:"categories/create",component:RU,canActivate:[dx]},{path:"categories/edit/:id",component:RU,canActivate:[dx]},{path:"**",component:Xte}];let _le=(()=>{class t{http;router;refreshing=!1;constructor(e,i){this.http=e,this.router=i}intercept(e,i){return i.handle(e).pipe(Kr(r=>401!==r.status||this.refreshing||e.url.endsWith("/accessTokens")?ra(()=>r):(this.refreshing=!0,this.http.post(`${Cu_urlBack}/api/v1/auth/accessTokens`,{},{withCredentials:!0}).pipe(lc(()=>i.handle(e)),Kr(l=>(this.router.navigate(["/login"]),ra(()=>l))),Vy(()=>{this.refreshing=!1})))))}static \u0275fac=function(i){return new(i||t)(gn(Eu),gn(oo))};static \u0275prov=Nt({token:t,factory:t.\u0275fac})}return t})();function OU(t){return null!==t&&"object"==typeof t&&"constructor"in t&&t.constructor===Object}function $P(t,n){void 0===t&&(t={}),void 0===n&&(n={});const e=["__proto__","constructor","prototype"];Object.keys(n).filter(i=>e.indexOf(i)<0).forEach(i=>{typeof t[i]>"u"?t[i]=n[i]:OU(n[i])&&OU(t[i])&&Object.keys(n[i]).length>0&&$P(t[i],n[i])})}const FU={body:{},addEventListener(){},removeEventListener(){},activeElement:{blur(){},nodeName:""},querySelector:()=>null,querySelectorAll:()=>[],getElementById:()=>null,createEvent:()=>({initEvent(){}}),createElement:()=>({children:[],childNodes:[],style:{},setAttribute(){},getElementsByTagName:()=>[]}),createElementNS:()=>({}),importNode:()=>null,location:{hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",protocol:"",search:""}};function Da(){const t=typeof document<"u"?document:{};return $P(t,FU),t}const yle={document:FU,navigator:{userAgent:""},location:{hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",protocol:"",search:""},history:{replaceState(){},pushState(){},go(){},back(){}},CustomEvent:function(){return this},addEventListener(){},removeEventListener(){},getComputedStyle:()=>({getPropertyValue:()=>""}),Image(){},Date(){},screen:{},setTimeout(){},clearTimeout(){},matchMedia:()=>({}),requestAnimationFrame:t=>typeof setTimeout>"u"?(t(),null):setTimeout(t,0),cancelAnimationFrame(t){typeof setTimeout>"u"||clearTimeout(t)}};function Wo(){const t=typeof window<"u"?window:{};return $P(t,yle),t}function Xg(t){return void 0===t&&(t=""),t.trim().split(" ").filter(n=>!!n.trim())}function cv(t,n){return void 0===n&&(n=0),setTimeout(t,n)}function Tu(){return Date.now()}function GP(t,n){void 0===n&&(n="x");const e=Wo();let i,r,l;const f=function ble(t){const n=Wo();let e;return n.getComputedStyle&&(e=n.getComputedStyle(t,null)),!e&&t.currentStyle&&(e=t.currentStyle),e||(e=t.style),e}(t);return e.WebKitCSSMatrix?(r=f.transform||f.webkitTransform,r.split(",").length>6&&(r=r.split(", ").map(w=>w.replace(",",".")).join(", ")),l=new e.WebKitCSSMatrix("none"===r?"":r)):(l=f.MozTransform||f.OTransform||f.MsTransform||f.msTransform||f.transform||f.getPropertyValue("transform").replace("translate(","matrix(1, 0, 0, 1,"),i=l.toString().split(",")),"x"===n&&(r=e.WebKitCSSMatrix?l.m41:16===i.length?parseFloat(i[12]):parseFloat(i[4])),"y"===n&&(r=e.WebKitCSSMatrix?l.m42:16===i.length?parseFloat(i[13]):parseFloat(i[5])),r||0}function pE(t){return"object"==typeof t&&null!==t&&t.constructor&&"Object"===Object.prototype.toString.call(t).slice(8,-1)}function xle(t){return typeof window<"u"&&typeof window.HTMLElement<"u"?t instanceof HTMLElement:t&&(1===t.nodeType||11===t.nodeType)}function Pd(){const t=Object(arguments.length<=0?void 0:arguments[0]),n=["__proto__","constructor","prototype"];for(let e=1;e<arguments.length;e+=1){const i=e<0||arguments.length<=e?void 0:arguments[e];if(null!=i&&!xle(i)){const r=Object.keys(Object(i)).filter(l=>n.indexOf(l)<0);for(let l=0,f=r.length;l<f;l+=1){const w=r[l],M=Object.getOwnPropertyDescriptor(i,w);void 0!==M&&M.enumerable&&(pE(t[w])&&pE(i[w])?i[w].__swiper__?t[w]=i[w]:Pd(t[w],i[w]):!pE(t[w])&&pE(i[w])?(t[w]={},i[w].__swiper__?t[w]=i[w]:Pd(t[w],i[w])):t[w]=i[w])}}}return t}function fE(t,n,e){t.style.setProperty(n,e)}function LU(t){let{swiper:n,targetPosition:e,side:i}=t;const r=Wo(),l=-n.translate;let w,f=null;const M=n.params.speed;n.wrapperEl.style.scrollSnapType="none",r.cancelAnimationFrame(n.cssModeFrameID);const P=e>l?"next":"prev",L=(Q,X)=>"next"===P&&Q>=X||"prev"===P&&Q<=X,$=()=>{w=(new Date).getTime(),null===f&&(f=w);const Q=Math.max(Math.min((w-f)/M,1),0),X=.5-Math.cos(Q*Math.PI)/2;let Y=l+X*(e-l);if(L(Y,e)&&(Y=e),n.wrapperEl.scrollTo({[i]:Y}),L(Y,e))return n.wrapperEl.style.overflow="hidden",n.wrapperEl.style.scrollSnapType="",setTimeout(()=>{n.wrapperEl.style.overflow="",n.wrapperEl.scrollTo({[i]:Y})}),void r.cancelAnimationFrame(n.cssModeFrameID);n.cssModeFrameID=r.requestAnimationFrame($)};$()}function dv(t){return t.querySelector(".swiper-slide-transform")||t.shadowRoot&&t.shadowRoot.querySelector(".swiper-slide-transform")||t}function tl(t,n){void 0===n&&(n="");const e=Wo(),i=[...t.children];return e.HTMLSlotElement&&t instanceof HTMLSlotElement&&i.push(...t.assignedElements()),n?i.filter(r=>r.matches(n)):i}function QT(t){try{return void console.warn(t)}catch{}}function Od(t,n){void 0===n&&(n=[]);const e=document.createElement(t);return e.classList.add(...Array.isArray(n)?n:Xg(n)),e}function JT(t){const n=Wo(),e=Da(),i=t.getBoundingClientRect(),r=e.body;return{top:i.top+(t===n?n.scrollY:t.scrollTop)-(t.clientTop||r.clientTop||0),left:i.left+(t===n?n.scrollX:t.scrollLeft)-(t.clientLeft||r.clientLeft||0)}}function Kg(t,n){return Wo().getComputedStyle(t,null).getPropertyValue(n)}function mE(t){let e,n=t;if(n){for(e=0;null!==(n=n.previousSibling);)1===n.nodeType&&(e+=1);return e}}function uv(t,n){const e=[];let i=t.parentElement;for(;i;)n?i.matches(n)&&e.push(i):e.push(i),i=i.parentElement;return e}function gE(t,n){n&&t.addEventListener("transitionend",function e(i){i.target===t&&(n.call(t,i),t.removeEventListener("transitionend",e))})}function qP(t,n,e){const i=Wo();return e?t["width"===n?"offsetWidth":"offsetHeight"]+parseFloat(i.getComputedStyle(t,null).getPropertyValue("width"===n?"margin-right":"margin-top"))+parseFloat(i.getComputedStyle(t,null).getPropertyValue("width"===n?"margin-left":"margin-bottom")):t.offsetWidth}function Sr(t){return(Array.isArray(t)?t:[t]).filter(n=>!!n)}function eI(t){return n=>Math.abs(n)>0&&t.browser&&t.browser.need3dFix&&Math.abs(n)%90==0?n+.001:n}let WP,YP,ZP;function NU(){return WP||(WP=function Dle(){const t=Wo(),n=Da();return{smoothScroll:n.documentElement&&n.documentElement.style&&"scrollBehavior"in n.documentElement.style,touch:!!("ontouchstart"in t||t.DocumentTouch&&n instanceof t.DocumentTouch)}}()),WP}function zU(t){return void 0===t&&(t={}),YP||(YP=function Mle(t){let{userAgent:n}=void 0===t?{}:t;const e=NU(),i=Wo(),r=i.navigator.platform,l=n||i.navigator.userAgent,f={ios:!1,android:!1},w=i.screen.width,M=i.screen.height,P=l.match(/(Android);?[\s\/]+([\d.]+)?/);let L=l.match(/(iPad).*OS\s([\d_]+)/);const $=l.match(/(iPod)(.*OS\s([\d_]+))?/),Q=!L&&l.match(/(iPhone\sOS|iOS)\s([\d_]+)/),X="Win32"===r;let Y="MacIntel"===r;return!L&&Y&&e.touch&&["1024x1366","1366x1024","834x1194","1194x834","834x1112","1112x834","768x1024","1024x768","820x1180","1180x820","810x1080","1080x810"].indexOf(`${w}x${M}`)>=0&&(L=l.match(/(Version)\/([\d.]+)/),L||(L=[0,1,"13_0_0"]),Y=!1),P&&!X&&(f.os="android",f.android=!0),(L||Q||$)&&(f.os="ios",f.ios=!0),f}(t)),YP}function BU(){return ZP||(ZP=function Tle(){const t=Wo(),n=zU();let e=!1;function i(){const w=t.navigator.userAgent.toLowerCase();return w.indexOf("safari")>=0&&w.indexOf("chrome")<0&&w.indexOf("android")<0}if(i()){const w=String(t.navigator.userAgent);if(w.includes("Version/")){const[M,P]=w.split("Version/")[1].split(" ")[0].split(".").map(L=>Number(L));e=M<16||16===M&&P<2}}const r=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(t.navigator.userAgent),l=i();return{isSafari:e||l,needPerspectiveFix:e,need3dFix:l||r&&n.ios,isWebView:r}}()),ZP}const VU=(t,n,e)=>{n&&!t.classList.contains(e)?t.classList.add(e):!n&&t.classList.contains(e)&&t.classList.remove(e)},XP=(t,n,e)=>{n&&!t.classList.contains(e)?t.classList.add(e):!n&&t.classList.contains(e)&&t.classList.remove(e)},tI=(t,n)=>{if(!t||t.destroyed||!t.params)return;const i=n.closest(t.isElement?"swiper-slide":`.${t.params.slideClass}`);if(i){let r=i.querySelector(`.${t.params.lazyPreloaderClass}`);!r&&t.isElement&&(i.shadowRoot?r=i.shadowRoot.querySelector(`.${t.params.lazyPreloaderClass}`):requestAnimationFrame(()=>{i.shadowRoot&&(r=i.shadowRoot.querySelector(`.${t.params.lazyPreloaderClass}`),r&&r.remove())})),r&&r.remove()}},KP=(t,n)=>{if(!t.slides[n])return;const e=t.slides[n].querySelector('[loading="lazy"]');e&&e.removeAttribute("loading")},QP=t=>{if(!t||t.destroyed||!t.params)return;let n=t.params.lazyPreloadPrevNext;const e=t.slides.length;if(!e||!n||n<0)return;n=Math.min(n,e);const i="auto"===t.params.slidesPerView?t.slidesPerViewDynamic():Math.ceil(t.params.slidesPerView),r=t.activeIndex;if(t.params.grid&&t.params.grid.rows>1){const f=r,w=[f-n];return w.push(...Array.from({length:n}).map((M,P)=>f+i+P)),void t.slides.forEach((M,P)=>{w.includes(M.column)&&KP(t,P)})}const l=r+i-1;if(t.params.rewind||t.params.loop)for(let f=r-n;f<=l+n;f+=1){const w=(f%e+e)%e;(w<r||w>l)&&KP(t,w)}else for(let f=Math.max(r-n,0);f<=Math.min(l+n,e-1);f+=1)f!==r&&(f>l||f<r)&&KP(t,f)};function UU(t){let{swiper:n,runCallbacks:e,direction:i,step:r}=t;const{activeIndex:l,previousIndex:f}=n;let w=i;if(w||(w=l>f?"next":l<f?"prev":"reset"),n.emit(`transition${r}`),e&&l!==f){if("reset"===w)return void n.emit(`slideResetTransition${r}`);n.emit(`slideChangeTransition${r}`),n.emit("next"===w?`slideNextTransition${r}`:`slidePrevTransition${r}`)}}function jU(t,n,e){const i=Wo(),{params:r}=t,l=r.edgeSwipeDetection,f=r.edgeSwipeThreshold;return!l||!(e<=f||e>=i.innerWidth-f)||"prevent"===l&&(n.preventDefault(),!0)}function mce(t){const n=this,e=Da();let i=t;i.originalEvent&&(i=i.originalEvent);const r=n.touchEventsData;if("pointerdown"===i.type){if(null!==r.pointerId&&r.pointerId!==i.pointerId)return;r.pointerId=i.pointerId}else"touchstart"===i.type&&1===i.targetTouches.length&&(r.touchId=i.targetTouches[0].identifier);if("touchstart"===i.type)return void jU(n,i,i.targetTouches[0].pageX);const{params:l,touches:f,enabled:w}=n;if(!w||!l.simulateTouch&&"mouse"===i.pointerType||n.animating&&l.preventInteractionOnTransition)return;!n.animating&&l.cssMode&&l.loop&&n.loopFix();let M=i.target;if("wrapper"===l.touchEventsTarget&&!function Cle(t,n){const e=Wo();let i=n.contains(t);return!i&&e.HTMLSlotElement&&n instanceof HTMLSlotElement&&(i=[...n.assignedElements()].includes(t),i||(i=function wle(t,n){const e=[n];for(;e.length>0;){const i=e.shift();if(t===i)return!0;e.push(...i.children,...i.shadowRoot?i.shadowRoot.children:[],...i.assignedElements?i.assignedElements():[])}}(t,n))),i}(M,n.wrapperEl)||"which"in i&&3===i.which||"button"in i&&i.button>0||r.isTouched&&r.isMoved)return;const P=!!l.noSwipingClass&&""!==l.noSwipingClass,L=i.composedPath?i.composedPath():i.path;P&&i.target&&i.target.shadowRoot&&L&&(M=L[0]);const $=l.noSwipingSelector?l.noSwipingSelector:`.${l.noSwipingClass}`;if(l.noSwiping&&(i.target&&i.target.shadowRoot?function fce(t,n){return void 0===n&&(n=this),function e(i){if(!i||i===Da()||i===Wo())return null;i.assignedSlot&&(i=i.assignedSlot);const r=i.closest(t);return r||i.getRootNode?r||e(i.getRootNode().host):null}(n)}($,M):M.closest($)))return void(n.allowClick=!0);if(l.swipeHandler&&!M.closest(l.swipeHandler))return;f.currentX=i.pageX,f.currentY=i.pageY;const X=f.currentX,Y=f.currentY;if(!jU(n,i,X))return;Object.assign(r,{isTouched:!0,isMoved:!1,allowTouchCallbacks:!0,isScrolling:void 0,startMoving:void 0}),f.startX=X,f.startY=Y,r.touchStartTime=Tu(),n.allowClick=!0,n.updateSize(),n.swipeDirection=void 0,l.threshold>0&&(r.allowThresholdMove=!1);let K=!0;M.matches(r.focusableElements)&&(K=!1,"SELECT"===M.nodeName&&(r.isTouched=!1)),e.activeElement&&e.activeElement.matches(r.focusableElements)&&e.activeElement!==M&&("mouse"===i.pointerType||"mouse"!==i.pointerType&&!M.matches(r.focusableElements))&&e.activeElement.blur(),(l.touchStartForcePreventDefault||K&&n.allowTouchMove&&l.touchStartPreventDefault)&&!M.isContentEditable&&i.preventDefault(),l.freeMode&&l.freeMode.enabled&&n.freeMode&&n.animating&&!l.cssMode&&n.freeMode.onTouchStart(),n.emit("touchStart",i)}function gce(t){const n=Da(),e=this,i=e.touchEventsData,{params:r,touches:l,rtlTranslate:f,enabled:w}=e;if(!w||!r.simulateTouch&&"mouse"===t.pointerType)return;let P,M=t;if(M.originalEvent&&(M=M.originalEvent),"pointermove"===M.type&&(null!==i.touchId||M.pointerId!==i.pointerId))return;if("touchmove"===M.type){if(P=[...M.changedTouches].find(It=>It.identifier===i.touchId),!P||P.identifier!==i.touchId)return}else P=M;if(!i.isTouched)return void(i.startMoving&&i.isScrolling&&e.emit("touchMoveOpposite",M));const L=P.pageX,$=P.pageY;if(M.preventedByNestedSwiper)return l.startX=L,void(l.startY=$);if(!e.allowTouchMove)return M.target.matches(i.focusableElements)||(e.allowClick=!1),void(i.isTouched&&(Object.assign(l,{startX:L,startY:$,currentX:L,currentY:$}),i.touchStartTime=Tu()));if(r.touchReleaseOnEdges&&!r.loop)if(e.isVertical()){if($<l.startY&&e.translate<=e.maxTranslate()||$>l.startY&&e.translate>=e.minTranslate())return i.isTouched=!1,void(i.isMoved=!1)}else{if(f&&(L>l.startX&&-e.translate<=e.maxTranslate()||L<l.startX&&-e.translate>=e.minTranslate()))return;if(!f&&(L<l.startX&&e.translate<=e.maxTranslate()||L>l.startX&&e.translate>=e.minTranslate()))return}if(n.activeElement&&n.activeElement.matches(i.focusableElements)&&n.activeElement!==M.target&&"mouse"!==M.pointerType&&n.activeElement.blur(),n.activeElement&&M.target===n.activeElement&&M.target.matches(i.focusableElements))return i.isMoved=!0,void(e.allowClick=!1);i.allowTouchCallbacks&&e.emit("touchMove",M),l.previousX=l.currentX,l.previousY=l.currentY,l.currentX=L,l.currentY=$;const Q=l.currentX-l.startX,X=l.currentY-l.startY;if(e.params.threshold&&Math.sqrt(Q**2+X**2)<e.params.threshold)return;if(typeof i.isScrolling>"u"){let It;e.isHorizontal()&&l.currentY===l.startY||e.isVertical()&&l.currentX===l.startX?i.isScrolling=!1:Q*Q+X*X>=25&&(It=180*Math.atan2(Math.abs(X),Math.abs(Q))/Math.PI,i.isScrolling=e.isHorizontal()?It>r.touchAngle:90-It>r.touchAngle)}if(i.isScrolling&&e.emit("touchMoveOpposite",M),typeof i.startMoving>"u"&&(l.currentX!==l.startX||l.currentY!==l.startY)&&(i.startMoving=!0),i.isScrolling||"touchmove"===M.type&&i.preventTouchMoveFromPointerMove)return void(i.isTouched=!1);if(!i.startMoving)return;e.allowClick=!1,!r.cssMode&&M.cancelable&&M.preventDefault(),r.touchMoveStopPropagation&&!r.nested&&M.stopPropagation();let Y=e.isHorizontal()?Q:X,K=e.isHorizontal()?l.currentX-l.previousX:l.currentY-l.previousY;r.oneWayMovement&&(Y=Math.abs(Y)*(f?1:-1),K=Math.abs(K)*(f?1:-1)),l.diff=Y,Y*=r.touchRatio,f&&(Y=-Y,K=-K);const de=e.touchesDirection;e.swipeDirection=Y>0?"prev":"next",e.touchesDirection=K>0?"prev":"next";const ye=e.params.loop&&!r.cssMode,he="next"===e.touchesDirection&&e.allowSlideNext||"prev"===e.touchesDirection&&e.allowSlidePrev;if(!i.isMoved){if(ye&&he&&e.loopFix({direction:e.swipeDirection}),i.startTranslate=e.getTranslate(),e.setTransition(0),e.animating){const It=new window.CustomEvent("transitionend",{bubbles:!0,cancelable:!0,detail:{bySwiperTouchMove:!0}});e.wrapperEl.dispatchEvent(It)}i.allowMomentumBounce=!1,r.grabCursor&&(!0===e.allowSlideNext||!0===e.allowSlidePrev)&&e.setGrabCursor(!0),e.emit("sliderFirstMove",M)}if((new Date).getTime(),!1!==r._loopSwapReset&&i.isMoved&&i.allowThresholdMove&&de!==e.touchesDirection&&ye&&he&&Math.abs(Y)>=1)return Object.assign(l,{startX:L,startY:$,currentX:L,currentY:$,startTranslate:i.currentTranslate}),i.loopSwapReset=!0,void(i.startTranslate=i.currentTranslate);e.emit("sliderMove",M),i.isMoved=!0,i.currentTranslate=Y+i.startTranslate;let Ge=!0,ct=r.resistanceRatio;if(r.touchReleaseOnEdges&&(ct=0),Y>0?(ye&&he&&i.allowThresholdMove&&i.currentTranslate>(r.centeredSlides?e.minTranslate()-e.slidesSizesGrid[e.activeIndex+1]-("auto"!==r.slidesPerView&&e.slides.length-r.slidesPerView>=2?e.slidesSizesGrid[e.activeIndex+1]+e.params.spaceBetween:0)-e.params.spaceBetween:e.minTranslate())&&e.loopFix({direction:"prev",setTranslate:!0,activeSlideIndex:0}),i.currentTranslate>e.minTranslate()&&(Ge=!1,r.resistance&&(i.currentTranslate=e.minTranslate()-1+(-e.minTranslate()+i.startTranslate+Y)**ct))):Y<0&&(ye&&he&&i.allowThresholdMove&&i.currentTranslate<(r.centeredSlides?e.maxTranslate()+e.slidesSizesGrid[e.slidesSizesGrid.length-1]+e.params.spaceBetween+("auto"!==r.slidesPerView&&e.slides.length-r.slidesPerView>=2?e.slidesSizesGrid[e.slidesSizesGrid.length-1]+e.params.spaceBetween:0):e.maxTranslate())&&e.loopFix({direction:"next",setTranslate:!0,activeSlideIndex:e.slides.length-("auto"===r.slidesPerView?e.slidesPerViewDynamic():Math.ceil(parseFloat(r.slidesPerView,10)))}),i.currentTranslate<e.maxTranslate()&&(Ge=!1,r.resistance&&(i.currentTranslate=e.maxTranslate()+1-(e.maxTranslate()-i.startTranslate-Y)**ct))),Ge&&(M.preventedByNestedSwiper=!0),!e.allowSlideNext&&"next"===e.swipeDirection&&i.currentTranslate<i.startTranslate&&(i.currentTranslate=i.startTranslate),!e.allowSlidePrev&&"prev"===e.swipeDirection&&i.currentTranslate>i.startTranslate&&(i.currentTranslate=i.startTranslate),!e.allowSlidePrev&&!e.allowSlideNext&&(i.currentTranslate=i.startTranslate),r.threshold>0){if(!(Math.abs(Y)>r.threshold||i.allowThresholdMove))return void(i.currentTranslate=i.startTranslate);if(!i.allowThresholdMove)return i.allowThresholdMove=!0,l.startX=l.currentX,l.startY=l.currentY,i.currentTranslate=i.startTranslate,void(l.diff=e.isHorizontal()?l.currentX-l.startX:l.currentY-l.startY)}!r.followFinger||r.cssMode||((r.freeMode&&r.freeMode.enabled&&e.freeMode||r.watchSlidesProgress)&&(e.updateActiveIndex(),e.updateSlidesClasses()),r.freeMode&&r.freeMode.enabled&&e.freeMode&&e.freeMode.onTouchMove(),e.updateProgress(i.currentTranslate),e.setTranslate(i.currentTranslate))}function _ce(t){const n=this,e=n.touchEventsData;let r,i=t;if(i.originalEvent&&(i=i.originalEvent),"touchend"===i.type||"touchcancel"===i.type){if(r=[...i.changedTouches].find(ct=>ct.identifier===e.touchId),!r||r.identifier!==e.touchId)return}else{if(null!==e.touchId||i.pointerId!==e.pointerId)return;r=i}if(["pointercancel","pointerout","pointerleave","contextmenu"].includes(i.type)&&(!["pointercancel","contextmenu"].includes(i.type)||!n.browser.isSafari&&!n.browser.isWebView))return;e.pointerId=null,e.touchId=null;const{params:f,touches:w,rtlTranslate:M,slidesGrid:P,enabled:L}=n;if(!L||!f.simulateTouch&&"mouse"===i.pointerType)return;if(e.allowTouchCallbacks&&n.emit("touchEnd",i),e.allowTouchCallbacks=!1,!e.isTouched)return e.isMoved&&f.grabCursor&&n.setGrabCursor(!1),e.isMoved=!1,void(e.startMoving=!1);f.grabCursor&&e.isMoved&&e.isTouched&&(!0===n.allowSlideNext||!0===n.allowSlidePrev)&&n.setGrabCursor(!1);const $=Tu(),Q=$-e.touchStartTime;if(n.allowClick){const ct=i.path||i.composedPath&&i.composedPath();n.updateClickedSlide(ct&&ct[0]||i.target,ct),n.emit("tap click",i),Q<300&&$-e.lastClickTime<300&&n.emit("doubleTap doubleClick",i)}if(e.lastClickTime=Tu(),cv(()=>{n.destroyed||(n.allowClick=!0)}),!e.isTouched||!e.isMoved||!n.swipeDirection||0===w.diff&&!e.loopSwapReset||e.currentTranslate===e.startTranslate&&!e.loopSwapReset)return e.isTouched=!1,e.isMoved=!1,void(e.startMoving=!1);let X;if(e.isTouched=!1,e.isMoved=!1,e.startMoving=!1,X=f.followFinger?M?n.translate:-n.translate:-e.currentTranslate,f.cssMode)return;if(f.freeMode&&f.freeMode.enabled)return void n.freeMode.onTouchEnd({currentPos:X});const Y=X>=-n.maxTranslate()&&!n.params.loop;let K=0,de=n.slidesSizesGrid[0];for(let ct=0;ct<P.length;ct+=ct<f.slidesPerGroupSkip?1:f.slidesPerGroup){const It=ct<f.slidesPerGroupSkip-1?1:f.slidesPerGroup;typeof P[ct+It]<"u"?(Y||X>=P[ct]&&X<P[ct+It])&&(K=ct,de=P[ct+It]-P[ct]):(Y||X>=P[ct])&&(K=ct,de=P[P.length-1]-P[P.length-2])}let ye=null,he=null;f.rewind&&(n.isBeginning?he=f.virtual&&f.virtual.enabled&&n.virtual?n.virtual.slides.length-1:n.slides.length-1:n.isEnd&&(ye=0));const Ce=(X-P[K])/de,Ge=K<f.slidesPerGroupSkip-1?1:f.slidesPerGroup;if(Q>f.longSwipesMs){if(!f.longSwipes)return void n.slideTo(n.activeIndex);"next"===n.swipeDirection&&n.slideTo(Ce>=f.longSwipesRatio?f.rewind&&n.isEnd?ye:K+Ge:K),"prev"===n.swipeDirection&&(Ce>1-f.longSwipesRatio?n.slideTo(K+Ge):null!==he&&Ce<0&&Math.abs(Ce)>f.longSwipesRatio?n.slideTo(he):n.slideTo(K))}else{if(!f.shortSwipes)return void n.slideTo(n.activeIndex);!n.navigation||i.target!==n.navigation.nextEl&&i.target!==n.navigation.prevEl?("next"===n.swipeDirection&&n.slideTo(null!==ye?ye:K+Ge),"prev"===n.swipeDirection&&n.slideTo(null!==he?he:K)):n.slideTo(i.target===n.navigation.nextEl?K+Ge:K)}}function HU(){const t=this,{params:n,el:e}=t;if(e&&0===e.offsetWidth)return;n.breakpoints&&t.setBreakpoint();const{allowSlideNext:i,allowSlidePrev:r,snapGrid:l}=t,f=t.virtual&&t.params.virtual.enabled;t.allowSlideNext=!0,t.allowSlidePrev=!0,t.updateSize(),t.updateSlides(),t.updateSlidesClasses(),!("auto"===n.slidesPerView||n.slidesPerView>1)||!t.isEnd||t.isBeginning||t.params.centeredSlides||f&&n.loop?t.params.loop&&!f?t.slideToLoop(t.realIndex,0,!1,!0):t.slideTo(t.activeIndex,0,!1,!0):t.slideTo(t.slides.length-1,0,!1,!0),t.autoplay&&t.autoplay.running&&t.autoplay.paused&&(clearTimeout(t.autoplay.resizeTimeout),t.autoplay.resizeTimeout=setTimeout(()=>{t.autoplay&&t.autoplay.running&&t.autoplay.paused&&t.autoplay.resume()},500)),t.allowSlidePrev=r,t.allowSlideNext=i,t.params.watchOverflow&&l!==t.snapGrid&&t.checkOverflow()}function yce(t){const n=this;n.enabled&&(n.allowClick||(n.params.preventClicks&&t.preventDefault(),n.params.preventClicksPropagation&&n.animating&&(t.stopPropagation(),t.stopImmediatePropagation())))}function vce(){const t=this,{wrapperEl:n,rtlTranslate:e,enabled:i}=t;if(!i)return;let r;t.previousTranslate=t.translate,t.translate=t.isHorizontal()?-n.scrollLeft:-n.scrollTop,0===t.translate&&(t.translate=0),t.updateActiveIndex(),t.updateSlidesClasses();const l=t.maxTranslate()-t.minTranslate();r=0===l?0:(t.translate-t.minTranslate())/l,r!==t.progress&&t.updateProgress(e?-t.translate:t.translate),t.emit("setTranslate",t.translate,!1)}function bce(t){const n=this;tI(n,t.target),!n.params.cssMode&&("auto"===n.params.slidesPerView||n.params.autoHeight)&&n.update()}function xce(){const t=this;t.documentTouchHandlerProceeded||(t.documentTouchHandlerProceeded=!0,t.params.touchReleaseOnEdges&&(t.el.style.touchAction="auto"))}const $U=(t,n)=>{const e=Da(),{params:i,el:r,wrapperEl:l,device:f}=t,w=!!i.nested,M="on"===n?"addEventListener":"removeEventListener",P=n;!r||"string"==typeof r||(e[M]("touchstart",t.onDocumentTouchStart,{passive:!1,capture:w}),r[M]("touchstart",t.onTouchStart,{passive:!1}),r[M]("pointerdown",t.onTouchStart,{passive:!1}),e[M]("touchmove",t.onTouchMove,{passive:!1,capture:w}),e[M]("pointermove",t.onTouchMove,{passive:!1,capture:w}),e[M]("touchend",t.onTouchEnd,{passive:!0}),e[M]("pointerup",t.onTouchEnd,{passive:!0}),e[M]("pointercancel",t.onTouchEnd,{passive:!0}),e[M]("touchcancel",t.onTouchEnd,{passive:!0}),e[M]("pointerout",t.onTouchEnd,{passive:!0}),e[M]("pointerleave",t.onTouchEnd,{passive:!0}),e[M]("contextmenu",t.onTouchEnd,{passive:!0}),(i.preventClicks||i.preventClicksPropagation)&&r[M]("click",t.onClick,!0),i.cssMode&&l[M]("scroll",t.onScroll),t[P](i.updateOnWindowResize?f.ios||f.android?"resize orientationchange observerUpdate":"resize observerUpdate":"observerUpdate",HU,!0),r[M]("load",t.onLoad,{capture:!0}))},GU=(t,n)=>t.grid&&n.grid&&n.grid.rows>1;var JP={init:!0,direction:"horizontal",oneWayMovement:!1,swiperElementNodeName:"SWIPER-CONTAINER",touchEventsTarget:"wrapper",initialSlide:0,speed:300,cssMode:!1,updateOnWindowResize:!0,resizeObserver:!0,nested:!1,createElements:!1,eventsPrefix:"swiper",enabled:!0,focusableElements:"input, select, option, textarea, button, video, label",width:null,height:null,preventInteractionOnTransition:!1,userAgent:null,url:null,edgeSwipeDetection:!1,edgeSwipeThreshold:20,autoHeight:!1,setWrapperSize:!1,virtualTranslate:!1,effect:"slide",breakpoints:void 0,breakpointsBase:"window",spaceBetween:0,slidesPerView:1,slidesPerGroup:1,slidesPerGroupSkip:0,slidesPerGroupAuto:!1,centeredSlides:!1,centeredSlidesBounds:!1,slidesOffsetBefore:0,slidesOffsetAfter:0,normalizeSlideIndex:!0,centerInsufficientSlides:!1,watchOverflow:!0,roundLengths:!1,touchRatio:1,touchAngle:45,simulateTouch:!0,shortSwipes:!0,longSwipes:!0,longSwipesRatio:.5,longSwipesMs:300,followFinger:!0,allowTouchMove:!0,threshold:5,touchMoveStopPropagation:!1,touchStartPreventDefault:!0,touchStartForcePreventDefault:!1,touchReleaseOnEdges:!1,uniqueNavElements:!0,resistance:!0,resistanceRatio:.85,watchSlidesProgress:!1,grabCursor:!1,preventClicks:!0,preventClicksPropagation:!0,slideToClickedSlide:!1,loop:!1,loopAddBlankSlides:!0,loopAdditionalSlides:0,loopPreventsSliding:!0,rewind:!1,allowSlidePrev:!0,allowSlideNext:!0,swipeHandler:null,noSwiping:!0,noSwipingClass:"swiper-no-swiping",noSwipingSelector:null,passiveListeners:!0,maxBackfaceHiddenSlides:10,containerModifierClass:"swiper-",slideClass:"swiper-slide",slideBlankClass:"swiper-slide-blank",slideActiveClass:"swiper-slide-active",slideVisibleClass:"swiper-slide-visible",slideFullyVisibleClass:"swiper-slide-fully-visible",slideNextClass:"swiper-slide-next",slidePrevClass:"swiper-slide-prev",wrapperClass:"swiper-wrapper",lazyPreloaderClass:"swiper-lazy-preloader",lazyPreloadPrevNext:0,runCallbacksOnInit:!0,_emitClasses:!1};function Oce(t,n){return function(i){void 0===i&&(i={});const r=Object.keys(i)[0],l=i[r];"object"==typeof l&&null!==l?(!0===t[r]&&(t[r]={enabled:!0}),"navigation"===r&&t[r]&&t[r].enabled&&!t[r].prevEl&&!t[r].nextEl&&(t[r].auto=!0),["pagination","scrollbar"].indexOf(r)>=0&&t[r]&&t[r].enabled&&!t[r].el&&(t[r].auto=!0),r in t&&"enabled"in l?("object"==typeof t[r]&&!("enabled"in t[r])&&(t[r].enabled=!0),t[r]||(t[r]={enabled:!1}),Pd(n,i)):Pd(n,i)):Pd(n,i)}}const eO={eventsEmitter:{on(t,n,e){const i=this;if(!i.eventsListeners||i.destroyed||"function"!=typeof n)return i;const r=e?"unshift":"push";return t.split(" ").forEach(l=>{i.eventsListeners[l]||(i.eventsListeners[l]=[]),i.eventsListeners[l][r](n)}),i},once(t,n,e){const i=this;if(!i.eventsListeners||i.destroyed||"function"!=typeof n)return i;function r(){i.off(t,r),r.__emitterProxy&&delete r.__emitterProxy;for(var l=arguments.length,f=new Array(l),w=0;w<l;w++)f[w]=arguments[w];n.apply(i,f)}return r.__emitterProxy=n,i.on(t,r,e)},onAny(t,n){const e=this;if(!e.eventsListeners||e.destroyed||"function"!=typeof t)return e;const i=n?"unshift":"push";return e.eventsAnyListeners.indexOf(t)<0&&e.eventsAnyListeners[i](t),e},offAny(t){const n=this;if(!n.eventsListeners||n.destroyed||!n.eventsAnyListeners)return n;const e=n.eventsAnyListeners.indexOf(t);return e>=0&&n.eventsAnyListeners.splice(e,1),n},off(t,n){const e=this;return!e.eventsListeners||e.destroyed||!e.eventsListeners||t.split(" ").forEach(i=>{typeof n>"u"?e.eventsListeners[i]=[]:e.eventsListeners[i]&&e.eventsListeners[i].forEach((r,l)=>{(r===n||r.__emitterProxy&&r.__emitterProxy===n)&&e.eventsListeners[i].splice(l,1)})}),e},emit(){const t=this;if(!t.eventsListeners||t.destroyed||!t.eventsListeners)return t;let n,e,i;for(var r=arguments.length,l=new Array(r),f=0;f<r;f++)l[f]=arguments[f];return"string"==typeof l[0]||Array.isArray(l[0])?(n=l[0],e=l.slice(1,l.length),i=t):(n=l[0].events,e=l[0].data,i=l[0].context||t),e.unshift(i),(Array.isArray(n)?n:n.split(" ")).forEach(M=>{t.eventsAnyListeners&&t.eventsAnyListeners.length&&t.eventsAnyListeners.forEach(P=>{P.apply(i,[M,...e])}),t.eventsListeners&&t.eventsListeners[M]&&t.eventsListeners[M].forEach(P=>{P.apply(i,e)})}),t}},update:{updateSize:function Rle(){const t=this;let n,e;const i=t.el;n=typeof t.params.width<"u"&&null!==t.params.width?t.params.width:i.clientWidth,e=typeof t.params.height<"u"&&null!==t.params.height?t.params.height:i.clientHeight,!(0===n&&t.isHorizontal()||0===e&&t.isVertical())&&(n=n-parseInt(Kg(i,"padding-left")||0,10)-parseInt(Kg(i,"padding-right")||0,10),e=e-parseInt(Kg(i,"padding-top")||0,10)-parseInt(Kg(i,"padding-bottom")||0,10),Number.isNaN(n)&&(n=0),Number.isNaN(e)&&(e=0),Object.assign(t,{width:n,height:e,size:t.isHorizontal()?n:e}))},updateSlides:function Ple(){const t=this;function n(At,Xt){return parseFloat(At.getPropertyValue(t.getDirectionLabel(Xt))||0)}const e=t.params,{wrapperEl:i,slidesEl:r,size:l,rtlTranslate:f,wrongRTL:w}=t,M=t.virtual&&e.virtual.enabled,P=M?t.virtual.slides.length:t.slides.length,L=tl(r,`.${t.params.slideClass}, swiper-slide`),$=M?t.virtual.slides.length:L.length;let Q=[];const X=[],Y=[];let K=e.slidesOffsetBefore;"function"==typeof K&&(K=e.slidesOffsetBefore.call(t));let de=e.slidesOffsetAfter;"function"==typeof de&&(de=e.slidesOffsetAfter.call(t));const ye=t.snapGrid.length,he=t.slidesGrid.length;let Ce=e.spaceBetween,Ge=-K,ct=0,It=0;if(typeof l>"u")return;"string"==typeof Ce&&Ce.indexOf("%")>=0?Ce=parseFloat(Ce.replace("%",""))/100*l:"string"==typeof Ce&&(Ce=parseFloat(Ce)),t.virtualSize=-Ce,L.forEach(At=>{f?At.style.marginLeft="":At.style.marginRight="",At.style.marginBottom="",At.style.marginTop=""}),e.centeredSlides&&e.cssMode&&(fE(i,"--swiper-centered-offset-before",""),fE(i,"--swiper-centered-offset-after",""));const Pt=e.grid&&e.grid.rows>1&&t.grid;let $t;Pt?t.grid.initSlides(L):t.grid&&t.grid.unsetSlides();const mt="auto"===e.slidesPerView&&e.breakpoints&&Object.keys(e.breakpoints).filter(At=>typeof e.breakpoints[At].slidesPerView<"u").length>0;for(let At=0;At<$;At+=1){let Xt;if($t=0,L[At]&&(Xt=L[At]),Pt&&t.grid.updateSlide(At,Xt,L),!L[At]||"none"!==Kg(Xt,"display")){if("auto"===e.slidesPerView){mt&&(L[At].style[t.getDirectionLabel("width")]="");const Gt=getComputedStyle(Xt),jt=Xt.style.transform,Kt=Xt.style.webkitTransform;if(jt&&(Xt.style.transform="none"),Kt&&(Xt.style.webkitTransform="none"),e.roundLengths)$t=t.isHorizontal()?qP(Xt,"width",!0):qP(Xt,"height",!0);else{const dn=n(Gt,"width"),mn=n(Gt,"padding-left"),St=n(Gt,"padding-right"),Rt=n(Gt,"margin-left"),Cn=n(Gt,"margin-right"),pr=Gt.getPropertyValue("box-sizing");if(pr&&"border-box"===pr)$t=dn+Rt+Cn;else{const{clientWidth:as,offsetWidth:Ma}=Xt;$t=dn+mn+St+Rt+Cn+(Ma-as)}}jt&&(Xt.style.transform=jt),Kt&&(Xt.style.webkitTransform=Kt),e.roundLengths&&($t=Math.floor($t))}else $t=(l-(e.slidesPerView-1)*Ce)/e.slidesPerView,e.roundLengths&&($t=Math.floor($t)),L[At]&&(L[At].style[t.getDirectionLabel("width")]=`${$t}px`);L[At]&&(L[At].swiperSlideSize=$t),Y.push($t),e.centeredSlides?(Ge=Ge+$t/2+ct/2+Ce,0===ct&&0!==At&&(Ge=Ge-l/2-Ce),0===At&&(Ge=Ge-l/2-Ce),Math.abs(Ge)<.001&&(Ge=0),e.roundLengths&&(Ge=Math.floor(Ge)),It%e.slidesPerGroup==0&&Q.push(Ge),X.push(Ge)):(e.roundLengths&&(Ge=Math.floor(Ge)),(It-Math.min(t.params.slidesPerGroupSkip,It))%t.params.slidesPerGroup==0&&Q.push(Ge),X.push(Ge),Ge=Ge+$t+Ce),t.virtualSize+=$t+Ce,ct=$t,It+=1}}if(t.virtualSize=Math.max(t.virtualSize,l)+de,f&&w&&("slide"===e.effect||"coverflow"===e.effect)&&(i.style.width=`${t.virtualSize+Ce}px`),e.setWrapperSize&&(i.style[t.getDirectionLabel("width")]=`${t.virtualSize+Ce}px`),Pt&&t.grid.updateWrapperSize($t,Q),!e.centeredSlides){const At=[];for(let Xt=0;Xt<Q.length;Xt+=1){let Gt=Q[Xt];e.roundLengths&&(Gt=Math.floor(Gt)),Q[Xt]<=t.virtualSize-l&&At.push(Gt)}Q=At,Math.floor(t.virtualSize-l)-Math.floor(Q[Q.length-1])>1&&Q.push(t.virtualSize-l)}if(M&&e.loop){const At=Y[0]+Ce;if(e.slidesPerGroup>1){const Xt=Math.ceil((t.virtual.slidesBefore+t.virtual.slidesAfter)/e.slidesPerGroup),Gt=At*e.slidesPerGroup;for(let jt=0;jt<Xt;jt+=1)Q.push(Q[Q.length-1]+Gt)}for(let Xt=0;Xt<t.virtual.slidesBefore+t.virtual.slidesAfter;Xt+=1)1===e.slidesPerGroup&&Q.push(Q[Q.length-1]+At),X.push(X[X.length-1]+At),t.virtualSize+=At}if(0===Q.length&&(Q=[0]),0!==Ce){const At=t.isHorizontal()&&f?"marginLeft":t.getDirectionLabel("marginRight");L.filter((Xt,Gt)=>!(e.cssMode&&!e.loop)||Gt!==L.length-1).forEach(Xt=>{Xt.style[At]=`${Ce}px`})}if(e.centeredSlides&&e.centeredSlidesBounds){let At=0;Y.forEach(Gt=>{At+=Gt+(Ce||0)}),At-=Ce;const Xt=At>l?At-l:0;Q=Q.map(Gt=>Gt<=0?-K:Gt>Xt?Xt+de:Gt)}if(e.centerInsufficientSlides){let At=0;Y.forEach(Gt=>{At+=Gt+(Ce||0)}),At-=Ce;const Xt=(e.slidesOffsetBefore||0)+(e.slidesOffsetAfter||0);if(At+Xt<l){const Gt=(l-At-Xt)/2;Q.forEach((jt,Kt)=>{Q[Kt]=jt-Gt}),X.forEach((jt,Kt)=>{X[Kt]=jt+Gt})}}if(Object.assign(t,{slides:L,snapGrid:Q,slidesGrid:X,slidesSizesGrid:Y}),e.centeredSlides&&e.cssMode&&!e.centeredSlidesBounds){fE(i,"--swiper-centered-offset-before",-Q[0]+"px"),fE(i,"--swiper-centered-offset-after",t.size/2-Y[Y.length-1]/2+"px");const At=-t.snapGrid[0],Xt=-t.slidesGrid[0];t.snapGrid=t.snapGrid.map(Gt=>Gt+At),t.slidesGrid=t.slidesGrid.map(Gt=>Gt+Xt)}if($!==P&&t.emit("slidesLengthChange"),Q.length!==ye&&(t.params.watchOverflow&&t.checkOverflow(),t.emit("snapGridLengthChange")),X.length!==he&&t.emit("slidesGridLengthChange"),e.watchSlidesProgress&&t.updateSlidesOffset(),t.emit("slidesUpdated"),!(M||e.cssMode||"slide"!==e.effect&&"fade"!==e.effect)){const At=`${e.containerModifierClass}backface-hidden`,Xt=t.el.classList.contains(At);$<=e.maxBackfaceHiddenSlides?Xt||t.el.classList.add(At):Xt&&t.el.classList.remove(At)}},updateAutoHeight:function Ole(t){const n=this,e=[],i=n.virtual&&n.params.virtual.enabled;let l,r=0;"number"==typeof t?n.setTransition(t):!0===t&&n.setTransition(n.params.speed);const f=w=>i?n.slides[n.getSlideIndexByData(w)]:n.slides[w];if("auto"!==n.params.slidesPerView&&n.params.slidesPerView>1)if(n.params.centeredSlides)(n.visibleSlides||[]).forEach(w=>{e.push(w)});else for(l=0;l<Math.ceil(n.params.slidesPerView);l+=1){const w=n.activeIndex+l;if(w>n.slides.length&&!i)break;e.push(f(w))}else e.push(f(n.activeIndex));for(l=0;l<e.length;l+=1)if(typeof e[l]<"u"){const w=e[l].offsetHeight;r=w>r?w:r}(r||0===r)&&(n.wrapperEl.style.height=`${r}px`)},updateSlidesOffset:function Fle(){const t=this,n=t.slides,e=t.isElement?t.isHorizontal()?t.wrapperEl.offsetLeft:t.wrapperEl.offsetTop:0;for(let i=0;i<n.length;i+=1)n[i].swiperSlideOffset=(t.isHorizontal()?n[i].offsetLeft:n[i].offsetTop)-e-t.cssOverflowAdjustment()},updateSlidesProgress:function Lle(t){void 0===t&&(t=this&&this.translate||0);const n=this,e=n.params,{slides:i,rtlTranslate:r,snapGrid:l}=n;if(0===i.length)return;typeof i[0].swiperSlideOffset>"u"&&n.updateSlidesOffset();let f=-t;r&&(f=t),n.visibleSlidesIndexes=[],n.visibleSlides=[];let w=e.spaceBetween;"string"==typeof w&&w.indexOf("%")>=0?w=parseFloat(w.replace("%",""))/100*n.size:"string"==typeof w&&(w=parseFloat(w));for(let M=0;M<i.length;M+=1){const P=i[M];let L=P.swiperSlideOffset;e.cssMode&&e.centeredSlides&&(L-=i[0].swiperSlideOffset);const $=(f+(e.centeredSlides?n.minTranslate():0)-L)/(P.swiperSlideSize+w),Q=(f-l[0]+(e.centeredSlides?n.minTranslate():0)-L)/(P.swiperSlideSize+w),X=-(f-L),Y=X+n.slidesSizesGrid[M],K=X>=0&&X<=n.size-n.slidesSizesGrid[M],de=X>=0&&X<n.size-1||Y>1&&Y<=n.size||X<=0&&Y>=n.size;de&&(n.visibleSlides.push(P),n.visibleSlidesIndexes.push(M)),VU(P,de,e.slideVisibleClass),VU(P,K,e.slideFullyVisibleClass),P.progress=r?-$:$,P.originalProgress=r?-Q:Q}},updateProgress:function Nle(t){const n=this;typeof t>"u"&&(t=n&&n.translate&&n.translate*(n.rtlTranslate?-1:1)||0);const e=n.params,i=n.maxTranslate()-n.minTranslate();let{progress:r,isBeginning:l,isEnd:f,progressLoop:w}=n;const M=l,P=f;if(0===i)r=0,l=!0,f=!0;else{r=(t-n.minTranslate())/i;const L=Math.abs(t-n.minTranslate())<1,$=Math.abs(t-n.maxTranslate())<1;l=L||r<=0,f=$||r>=1,L&&(r=0),$&&(r=1)}if(e.loop){const L=n.getSlideIndexByData(0),$=n.getSlideIndexByData(n.slides.length-1),Q=n.slidesGrid[L],X=n.slidesGrid[$],Y=n.slidesGrid[n.slidesGrid.length-1],K=Math.abs(t);w=K>=Q?(K-Q)/Y:(K+Y-X)/Y,w>1&&(w-=1)}Object.assign(n,{progress:r,progressLoop:w,isBeginning:l,isEnd:f}),(e.watchSlidesProgress||e.centeredSlides&&e.autoHeight)&&n.updateSlidesProgress(t),l&&!M&&n.emit("reachBeginning toEdge"),f&&!P&&n.emit("reachEnd toEdge"),(M&&!l||P&&!f)&&n.emit("fromEdge"),n.emit("progress",r)},updateSlidesClasses:function zle(){const t=this,{slides:n,params:e,slidesEl:i,activeIndex:r}=t,f=t.grid&&e.grid&&e.grid.rows>1,w=$=>tl(i,`.${e.slideClass}${$}, swiper-slide${$}`)[0];let M,P,L;if(t.virtual&&e.virtual.enabled)if(e.loop){let $=r-t.virtual.slidesBefore;$<0&&($=t.virtual.slides.length+$),$>=t.virtual.slides.length&&($-=t.virtual.slides.length),M=w(`[data-swiper-slide-index="${$}"]`)}else M=w(`[data-swiper-slide-index="${r}"]`);else f?(M=n.find($=>$.column===r),L=n.find($=>$.column===r+1),P=n.find($=>$.column===r-1)):M=n[r];M&&(f||(L=function Sle(t,n){const e=[];for(;t.nextElementSibling;){const i=t.nextElementSibling;n?i.matches(n)&&e.push(i):e.push(i),t=i}return e}(M,`.${e.slideClass}, swiper-slide`)[0],e.loop&&!L&&(L=n[0]),P=function Ele(t,n){const e=[];for(;t.previousElementSibling;){const i=t.previousElementSibling;n?i.matches(n)&&e.push(i):e.push(i),t=i}return e}(M,`.${e.slideClass}, swiper-slide`)[0],e.loop&&0===!P&&(P=n[n.length-1]))),n.forEach($=>{XP($,$===M,e.slideActiveClass),XP($,$===L,e.slideNextClass),XP($,$===P,e.slidePrevClass)}),t.emitSlidesClasses()},updateActiveIndex:function Vle(t){const n=this,e=n.rtlTranslate?n.translate:-n.translate,{snapGrid:i,params:r,activeIndex:l,realIndex:f,snapIndex:w}=n;let P,M=t;const L=X=>{let Y=X-n.virtual.slidesBefore;return Y<0&&(Y=n.virtual.slides.length+Y),Y>=n.virtual.slides.length&&(Y-=n.virtual.slides.length),Y};if(typeof M>"u"&&(M=function Ble(t){const{slidesGrid:n,params:e}=t,i=t.rtlTranslate?t.translate:-t.translate;let r;for(let l=0;l<n.length;l+=1)typeof n[l+1]<"u"?i>=n[l]&&i<n[l+1]-(n[l+1]-n[l])/2?r=l:i>=n[l]&&i<n[l+1]&&(r=l+1):i>=n[l]&&(r=l);return e.normalizeSlideIndex&&(r<0||typeof r>"u")&&(r=0),r}(n)),i.indexOf(e)>=0)P=i.indexOf(e);else{const X=Math.min(r.slidesPerGroupSkip,M);P=X+Math.floor((M-X)/r.slidesPerGroup)}if(P>=i.length&&(P=i.length-1),M===l&&!n.params.loop)return void(P!==w&&(n.snapIndex=P,n.emit("snapIndexChange")));if(M===l&&n.params.loop&&n.virtual&&n.params.virtual.enabled)return void(n.realIndex=L(M));const $=n.grid&&r.grid&&r.grid.rows>1;let Q;if(n.virtual&&r.virtual.enabled&&r.loop)Q=L(M);else if($){const X=n.slides.find(K=>K.column===M);let Y=parseInt(X.getAttribute("data-swiper-slide-index"),10);Number.isNaN(Y)&&(Y=Math.max(n.slides.indexOf(X),0)),Q=Math.floor(Y/r.grid.rows)}else if(n.slides[M]){const X=n.slides[M].getAttribute("data-swiper-slide-index");Q=X?parseInt(X,10):M}else Q=M;Object.assign(n,{previousSnapIndex:w,snapIndex:P,previousRealIndex:f,realIndex:Q,previousIndex:l,activeIndex:M}),n.initialized&&QP(n),n.emit("activeIndexChange"),n.emit("snapIndexChange"),(n.initialized||n.params.runCallbacksOnInit)&&(f!==Q&&n.emit("realIndexChange"),n.emit("slideChange"))},updateClickedSlide:function Ule(t,n){const e=this,i=e.params;let r=t.closest(`.${i.slideClass}, swiper-slide`);!r&&e.isElement&&n&&n.length>1&&n.includes(t)&&[...n.slice(n.indexOf(t)+1,n.length)].forEach(w=>{!r&&w.matches&&w.matches(`.${i.slideClass}, swiper-slide`)&&(r=w)});let f,l=!1;if(r)for(let w=0;w<e.slides.length;w+=1)if(e.slides[w]===r){l=!0,f=w;break}if(!r||!l)return e.clickedSlide=void 0,void(e.clickedIndex=void 0);e.clickedSlide=r,e.clickedIndex=e.virtual&&e.params.virtual.enabled?parseInt(r.getAttribute("data-swiper-slide-index"),10):f,i.slideToClickedSlide&&void 0!==e.clickedIndex&&e.clickedIndex!==e.activeIndex&&e.slideToClickedSlide()}},translate:{getTranslate:function Hle(t){void 0===t&&(t=this.isHorizontal()?"x":"y");const{params:e,rtlTranslate:i,translate:r,wrapperEl:l}=this;if(e.virtualTranslate)return i?-r:r;if(e.cssMode)return r;let f=GP(l,t);return f+=this.cssOverflowAdjustment(),i&&(f=-f),f||0},setTranslate:function $le(t,n){const e=this,{rtlTranslate:i,params:r,wrapperEl:l,progress:f}=e;let L,w=0,M=0;e.isHorizontal()?w=i?-t:t:M=t,r.roundLengths&&(w=Math.floor(w),M=Math.floor(M)),e.previousTranslate=e.translate,e.translate=e.isHorizontal()?w:M,r.cssMode?l[e.isHorizontal()?"scrollLeft":"scrollTop"]=e.isHorizontal()?-w:-M:r.virtualTranslate||(e.isHorizontal()?w-=e.cssOverflowAdjustment():M-=e.cssOverflowAdjustment(),l.style.transform=`translate3d(${w}px, ${M}px, 0px)`);const $=e.maxTranslate()-e.minTranslate();L=0===$?0:(t-e.minTranslate())/$,L!==f&&e.updateProgress(t),e.emit("setTranslate",e.translate,n)},minTranslate:function Gle(){return-this.snapGrid[0]},maxTranslate:function qle(){return-this.snapGrid[this.snapGrid.length-1]},translateTo:function Wle(t,n,e,i,r){void 0===t&&(t=0),void 0===n&&(n=this.params.speed),void 0===e&&(e=!0),void 0===i&&(i=!0);const l=this,{params:f,wrapperEl:w}=l;if(l.animating&&f.preventInteractionOnTransition)return!1;const M=l.minTranslate(),P=l.maxTranslate();let L;if(L=i&&t>M?M:i&&t<P?P:t,l.updateProgress(L),f.cssMode){const $=l.isHorizontal();if(0===n)w[$?"scrollLeft":"scrollTop"]=-L;else{if(!l.support.smoothScroll)return LU({swiper:l,targetPosition:-L,side:$?"left":"top"}),!0;w.scrollTo({[$?"left":"top"]:-L,behavior:"smooth"})}return!0}return 0===n?(l.setTransition(0),l.setTranslate(L),e&&(l.emit("beforeTransitionStart",n,r),l.emit("transitionEnd"))):(l.setTransition(n),l.setTranslate(L),e&&(l.emit("beforeTransitionStart",n,r),l.emit("transitionStart")),l.animating||(l.animating=!0,l.onTranslateToWrapperTransitionEnd||(l.onTranslateToWrapperTransitionEnd=function(Q){!l||l.destroyed||Q.target===this&&(l.wrapperEl.removeEventListener("transitionend",l.onTranslateToWrapperTransitionEnd),l.onTranslateToWrapperTransitionEnd=null,delete l.onTranslateToWrapperTransitionEnd,l.animating=!1,e&&l.emit("transitionEnd"))}),l.wrapperEl.addEventListener("transitionend",l.onTranslateToWrapperTransitionEnd))),!0}},transition:{setTransition:function Zle(t,n){const e=this;e.params.cssMode||(e.wrapperEl.style.transitionDuration=`${t}ms`,e.wrapperEl.style.transitionDelay=0===t?"0ms":""),e.emit("setTransition",t,n)},transitionStart:function Xle(t,n){void 0===t&&(t=!0);const e=this,{params:i}=e;i.cssMode||(i.autoHeight&&e.updateAutoHeight(),UU({swiper:e,runCallbacks:t,direction:n,step:"Start"}))},transitionEnd:function Kle(t,n){void 0===t&&(t=!0);const e=this,{params:i}=e;e.animating=!1,!i.cssMode&&(e.setTransition(0),UU({swiper:e,runCallbacks:t,direction:n,step:"End"}))}},slide:{slideTo:function Jle(t,n,e,i,r){void 0===t&&(t=0),void 0===e&&(e=!0),"string"==typeof t&&(t=parseInt(t,10));const l=this;let f=t;f<0&&(f=0);const{params:w,snapGrid:M,slidesGrid:P,previousIndex:L,activeIndex:$,rtlTranslate:Q,wrapperEl:X,enabled:Y}=l;if(!Y&&!i&&!r||l.destroyed||l.animating&&w.preventInteractionOnTransition)return!1;typeof n>"u"&&(n=l.params.speed);const K=Math.min(l.params.slidesPerGroupSkip,f);let de=K+Math.floor((f-K)/l.params.slidesPerGroup);de>=M.length&&(de=M.length-1);const ye=-M[de];if(w.normalizeSlideIndex)for(let Pt=0;Pt<P.length;Pt+=1){const $t=-Math.floor(100*ye),mt=Math.floor(100*P[Pt]),At=Math.floor(100*P[Pt+1]);typeof P[Pt+1]<"u"?$t>=mt&&$t<At-(At-mt)/2?f=Pt:$t>=mt&&$t<At&&(f=Pt+1):$t>=mt&&(f=Pt)}if(l.initialized&&f!==$&&(!l.allowSlideNext&&(Q?ye>l.translate&&ye>l.minTranslate():ye<l.translate&&ye<l.minTranslate())||!l.allowSlidePrev&&ye>l.translate&&ye>l.maxTranslate()&&($||0)!==f))return!1;let he;f!==(L||0)&&e&&l.emit("beforeSlideChangeStart"),l.updateProgress(ye),he=f>$?"next":f<$?"prev":"reset";const Ce=l.virtual&&l.params.virtual.enabled;if((!Ce||!r)&&(Q&&-ye===l.translate||!Q&&ye===l.translate))return l.updateActiveIndex(f),w.autoHeight&&l.updateAutoHeight(),l.updateSlidesClasses(),"slide"!==w.effect&&l.setTranslate(ye),"reset"!==he&&(l.transitionStart(e,he),l.transitionEnd(e,he)),!1;if(w.cssMode){const Pt=l.isHorizontal(),$t=Q?ye:-ye;if(0===n)Ce&&(l.wrapperEl.style.scrollSnapType="none",l._immediateVirtual=!0),Ce&&!l._cssModeVirtualInitialSet&&l.params.initialSlide>0?(l._cssModeVirtualInitialSet=!0,requestAnimationFrame(()=>{X[Pt?"scrollLeft":"scrollTop"]=$t})):X[Pt?"scrollLeft":"scrollTop"]=$t,Ce&&requestAnimationFrame(()=>{l.wrapperEl.style.scrollSnapType="",l._immediateVirtual=!1});else{if(!l.support.smoothScroll)return LU({swiper:l,targetPosition:$t,side:Pt?"left":"top"}),!0;X.scrollTo({[Pt?"left":"top"]:$t,behavior:"smooth"})}return!0}const It=BU().isSafari;return Ce&&!r&&It&&l.isElement&&l.virtual.update(!1,!1,f),l.setTransition(n),l.setTranslate(ye),l.updateActiveIndex(f),l.updateSlidesClasses(),l.emit("beforeTransitionStart",n,i),l.transitionStart(e,he),0===n?l.transitionEnd(e,he):l.animating||(l.animating=!0,l.onSlideToWrapperTransitionEnd||(l.onSlideToWrapperTransitionEnd=function($t){!l||l.destroyed||$t.target===this&&(l.wrapperEl.removeEventListener("transitionend",l.onSlideToWrapperTransitionEnd),l.onSlideToWrapperTransitionEnd=null,delete l.onSlideToWrapperTransitionEnd,l.transitionEnd(e,he))}),l.wrapperEl.addEventListener("transitionend",l.onSlideToWrapperTransitionEnd)),!0},slideToLoop:function ece(t,n,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),"string"==typeof t&&(t=parseInt(t,10));const r=this;if(r.destroyed)return;typeof n>"u"&&(n=r.params.speed);const l=r.grid&&r.params.grid&&r.params.grid.rows>1;let f=t;if(r.params.loop)if(r.virtual&&r.params.virtual.enabled)f+=r.virtual.slidesBefore;else{let w;if(l){const Q=f*r.params.grid.rows;w=r.slides.find(X=>1*X.getAttribute("data-swiper-slide-index")===Q).column}else w=r.getSlideIndexByData(f);const M=l?Math.ceil(r.slides.length/r.params.grid.rows):r.slides.length,{centeredSlides:P}=r.params;let L=r.params.slidesPerView;"auto"===L?L=r.slidesPerViewDynamic():(L=Math.ceil(parseFloat(r.params.slidesPerView,10)),P&&L%2==0&&(L+=1));let $=M-w<L;if(P&&($=$||w<Math.ceil(L/2)),i&&P&&"auto"!==r.params.slidesPerView&&!l&&($=!1),$){const Q=P?w<r.activeIndex?"prev":"next":w-r.activeIndex-1<r.params.slidesPerView?"next":"prev";r.loopFix({direction:Q,slideTo:!0,activeSlideIndex:"next"===Q?w+1:w-M+1,slideRealIndex:"next"===Q?r.realIndex:void 0})}if(l){const Q=f*r.params.grid.rows;f=r.slides.find(X=>1*X.getAttribute("data-swiper-slide-index")===Q).column}else f=r.getSlideIndexByData(f)}return requestAnimationFrame(()=>{r.slideTo(f,n,e,i)}),r},slideNext:function tce(t,n,e){void 0===n&&(n=!0);const i=this,{enabled:r,params:l,animating:f}=i;if(!r||i.destroyed)return i;typeof t>"u"&&(t=i.params.speed);let w=l.slidesPerGroup;"auto"===l.slidesPerView&&1===l.slidesPerGroup&&l.slidesPerGroupAuto&&(w=Math.max(i.slidesPerViewDynamic("current",!0),1));const M=i.activeIndex<l.slidesPerGroupSkip?1:w;if(l.loop){if(f&&(!i.virtual||!l.virtual.enabled)&&l.loopPreventsSliding)return!1;if(i.loopFix({direction:"next"}),i._clientLeft=i.wrapperEl.clientLeft,i.activeIndex===i.slides.length-1&&l.cssMode)return requestAnimationFrame(()=>{i.slideTo(i.activeIndex+M,t,n,e)}),!0}return i.slideTo(l.rewind&&i.isEnd?0:i.activeIndex+M,t,n,e)},slidePrev:function nce(t,n,e){void 0===n&&(n=!0);const i=this,{params:r,snapGrid:l,slidesGrid:f,rtlTranslate:w,enabled:M,animating:P}=i;if(!M||i.destroyed)return i;if(typeof t>"u"&&(t=i.params.speed),r.loop){if(P&&(!i.virtual||!r.virtual.enabled)&&r.loopPreventsSliding)return!1;i.loopFix({direction:"prev"}),i._clientLeft=i.wrapperEl.clientLeft}function Q(he){return he<0?-Math.floor(Math.abs(he)):Math.floor(he)}const X=Q(w?i.translate:-i.translate),Y=l.map(he=>Q(he)),K=r.freeMode&&r.freeMode.enabled;let de=l[Y.indexOf(X)-1];if(typeof de>"u"&&(r.cssMode||K)){let he;l.forEach((Ce,Ge)=>{X>=Ce&&(he=Ge)}),typeof he<"u"&&(de=K?l[he]:l[he>0?he-1:he])}let ye=0;return typeof de<"u"&&(ye=f.indexOf(de),ye<0&&(ye=i.activeIndex-1),"auto"===r.slidesPerView&&1===r.slidesPerGroup&&r.slidesPerGroupAuto&&(ye=ye-i.slidesPerViewDynamic("previous",!0)+1,ye=Math.max(ye,0))),r.rewind&&i.isBeginning?i.slideTo(i.params.virtual&&i.params.virtual.enabled&&i.virtual?i.virtual.slides.length-1:i.slides.length-1,t,n,e):r.loop&&0===i.activeIndex&&r.cssMode?(requestAnimationFrame(()=>{i.slideTo(ye,t,n,e)}),!0):i.slideTo(ye,t,n,e)},slideReset:function ice(t,n,e){void 0===n&&(n=!0);const i=this;if(!i.destroyed)return typeof t>"u"&&(t=i.params.speed),i.slideTo(i.activeIndex,t,n,e)},slideToClosest:function rce(t,n,e,i){void 0===n&&(n=!0),void 0===i&&(i=.5);const r=this;if(r.destroyed)return;typeof t>"u"&&(t=r.params.speed);let l=r.activeIndex;const f=Math.min(r.params.slidesPerGroupSkip,l),w=f+Math.floor((l-f)/r.params.slidesPerGroup),M=r.rtlTranslate?r.translate:-r.translate;if(M>=r.snapGrid[w]){const P=r.snapGrid[w];M-P>(r.snapGrid[w+1]-P)*i&&(l+=r.params.slidesPerGroup)}else{const P=r.snapGrid[w-1];M-P<=(r.snapGrid[w]-P)*i&&(l-=r.params.slidesPerGroup)}return l=Math.max(l,0),l=Math.min(l,r.slidesGrid.length-1),r.slideTo(l,t,n,e)},slideToClickedSlide:function oce(){const t=this;if(t.destroyed)return;const{params:n,slidesEl:e}=t,i="auto"===n.slidesPerView?t.slidesPerViewDynamic():n.slidesPerView;let l,r=t.clickedIndex;const f=t.isElement?"swiper-slide":`.${n.slideClass}`;if(n.loop){if(t.animating)return;l=parseInt(t.clickedSlide.getAttribute("data-swiper-slide-index"),10),n.centeredSlides?r<t.loopedSlides-i/2||r>t.slides.length-t.loopedSlides+i/2?(t.loopFix(),r=t.getSlideIndex(tl(e,`${f}[data-swiper-slide-index="${l}"]`)[0]),cv(()=>{t.slideTo(r)})):t.slideTo(r):r>t.slides.length-i?(t.loopFix(),r=t.getSlideIndex(tl(e,`${f}[data-swiper-slide-index="${l}"]`)[0]),cv(()=>{t.slideTo(r)})):t.slideTo(r)}else t.slideTo(r)}},loop:{loopCreate:function ace(t,n){const e=this,{params:i,slidesEl:r}=e;if(!i.loop||e.virtual&&e.params.virtual.enabled)return;const l=()=>{tl(r,`.${i.slideClass}, swiper-slide`).forEach((Q,X)=>{Q.setAttribute("data-swiper-slide-index",X)})},f=e.grid&&i.grid&&i.grid.rows>1,w=i.slidesPerGroup*(f?i.grid.rows:1),P=f&&e.slides.length%i.grid.rows!=0,L=$=>{for(let Q=0;Q<$;Q+=1){const X=e.isElement?Od("swiper-slide",[i.slideBlankClass]):Od("div",[i.slideClass,i.slideBlankClass]);e.slidesEl.append(X)}};e.slides.length%w!=0?(i.loopAddBlankSlides?(L(w-e.slides.length%w),e.recalcSlides(),e.updateSlides()):QT("Swiper Loop Warning: The number of slides is not even to slidesPerGroup, loop mode may not function properly. You need to add more slides (or make duplicates, or empty slides)"),l()):P?(i.loopAddBlankSlides?(L(i.grid.rows-e.slides.length%i.grid.rows),e.recalcSlides(),e.updateSlides()):QT("Swiper Loop Warning: The number of slides is not even to grid.rows, loop mode may not function properly. You need to add more slides (or make duplicates, or empty slides)"),l()):l(),e.loopFix({slideRealIndex:t,direction:i.centeredSlides?void 0:"next",initial:n})},loopFix:function lce(t){let{slideRealIndex:n,slideTo:e=!0,direction:i,setTranslate:r,activeSlideIndex:l,initial:f,byController:w,byMousewheel:M}=void 0===t?{}:t;const P=this;if(!P.params.loop)return;P.emit("beforeLoopFix");const{slides:L,allowSlidePrev:$,allowSlideNext:Q,slidesEl:X,params:Y}=P,{centeredSlides:K,initialSlide:de}=Y;if(P.allowSlidePrev=!0,P.allowSlideNext=!0,P.virtual&&Y.virtual.enabled)return e&&(Y.centeredSlides||0!==P.snapIndex?Y.centeredSlides&&P.snapIndex<Y.slidesPerView?P.slideTo(P.virtual.slides.length+P.snapIndex,0,!1,!0):P.snapIndex===P.snapGrid.length-1&&P.slideTo(P.virtual.slidesBefore,0,!1,!0):P.slideTo(P.virtual.slides.length,0,!1,!0)),P.allowSlidePrev=$,P.allowSlideNext=Q,void P.emit("loopFix");let ye=Y.slidesPerView;"auto"===ye?ye=P.slidesPerViewDynamic():(ye=Math.ceil(parseFloat(Y.slidesPerView,10)),K&&ye%2==0&&(ye+=1));const he=Y.slidesPerGroupAuto?ye:Y.slidesPerGroup;let Ce=he;Ce%he!=0&&(Ce+=he-Ce%he),Ce+=Y.loopAdditionalSlides,P.loopedSlides=Ce;const Ge=P.grid&&Y.grid&&Y.grid.rows>1;L.length<ye+Ce||"cards"===P.params.effect&&L.length<ye+2*Ce?QT("Swiper Loop Warning: The number of slides is not enough for loop mode, it will be disabled or not function properly. You need to add more slides (or make duplicates) or lower the values of slidesPerView and slidesPerGroup parameters"):Ge&&"row"===Y.grid.fill&&QT("Swiper Loop Warning: Loop mode is not compatible with grid.fill = `row`");const ct=[],It=[],Pt=Ge?Math.ceil(L.length/Y.grid.rows):L.length,$t=f&&Pt-de<ye&&!K;let mt=$t?de:P.activeIndex;typeof l>"u"?l=P.getSlideIndex(L.find(mn=>mn.classList.contains(Y.slideActiveClass))):mt=l;const At="next"===i||!i,Xt="prev"===i||!i;let Gt=0,jt=0;const dn=(Ge?L[l].column:l)+(K&&typeof r>"u"?-ye/2+.5:0);if(dn<Ce){Gt=Math.max(Ce-dn,he);for(let mn=0;mn<Ce-dn;mn+=1){const St=mn-Math.floor(mn/Pt)*Pt;if(Ge){const Rt=Pt-St-1;for(let Cn=L.length-1;Cn>=0;Cn-=1)L[Cn].column===Rt&&ct.push(Cn)}else ct.push(Pt-St-1)}}else if(dn+ye>Pt-Ce){jt=Math.max(dn-(Pt-2*Ce),he),$t&&(jt=Math.max(jt,ye-Pt+de+1));for(let mn=0;mn<jt;mn+=1){const St=mn-Math.floor(mn/Pt)*Pt;Ge?L.forEach((Rt,Cn)=>{Rt.column===St&&It.push(Cn)}):It.push(St)}}if(P.__preventObserver__=!0,requestAnimationFrame(()=>{P.__preventObserver__=!1}),"cards"===P.params.effect&&L.length<ye+2*Ce&&(It.includes(l)&&It.splice(It.indexOf(l),1),ct.includes(l)&&ct.splice(ct.indexOf(l),1)),Xt&&ct.forEach(mn=>{L[mn].swiperLoopMoveDOM=!0,X.prepend(L[mn]),L[mn].swiperLoopMoveDOM=!1}),At&&It.forEach(mn=>{L[mn].swiperLoopMoveDOM=!0,X.append(L[mn]),L[mn].swiperLoopMoveDOM=!1}),P.recalcSlides(),"auto"===Y.slidesPerView?P.updateSlides():Ge&&(ct.length>0&&Xt||It.length>0&&At)&&P.slides.forEach((mn,St)=>{P.grid.updateSlide(St,mn,P.slides)}),Y.watchSlidesProgress&&P.updateSlidesOffset(),e)if(ct.length>0&&Xt)if(typeof n>"u"){const Rt=P.slidesGrid[mt+Gt]-P.slidesGrid[mt];M?P.setTranslate(P.translate-Rt):(P.slideTo(mt+Math.ceil(Gt),0,!1,!0),r&&(P.touchEventsData.startTranslate=P.touchEventsData.startTranslate-Rt,P.touchEventsData.currentTranslate=P.touchEventsData.currentTranslate-Rt))}else r&&(P.slideTo(P.activeIndex+(Ge?ct.length/Y.grid.rows:ct.length),0,!1,!0),P.touchEventsData.currentTranslate=P.translate);else if(It.length>0&&At)if(typeof n>"u"){const Rt=P.slidesGrid[mt-jt]-P.slidesGrid[mt];M?P.setTranslate(P.translate-Rt):(P.slideTo(mt-jt,0,!1,!0),r&&(P.touchEventsData.startTranslate=P.touchEventsData.startTranslate-Rt,P.touchEventsData.currentTranslate=P.touchEventsData.currentTranslate-Rt))}else P.slideTo(P.activeIndex-(Ge?It.length/Y.grid.rows:It.length),0,!1,!0);if(P.allowSlidePrev=$,P.allowSlideNext=Q,P.controller&&P.controller.control&&!w){const mn={slideRealIndex:n,direction:i,setTranslate:r,activeSlideIndex:l,byController:!0};Array.isArray(P.controller.control)?P.controller.control.forEach(St=>{!St.destroyed&&St.params.loop&&St.loopFix({...mn,slideTo:St.params.slidesPerView===Y.slidesPerView&&e})}):P.controller.control instanceof P.constructor&&P.controller.control.params.loop&&P.controller.control.loopFix({...mn,slideTo:P.controller.control.params.slidesPerView===Y.slidesPerView&&e})}P.emit("loopFix")},loopDestroy:function cce(){const t=this,{params:n,slidesEl:e}=t;if(!n.loop||!e||t.virtual&&t.params.virtual.enabled)return;t.recalcSlides();const i=[];t.slides.forEach(r=>{const l=typeof r.swiperSlideIndex>"u"?1*r.getAttribute("data-swiper-slide-index"):r.swiperSlideIndex;i[l]=r}),t.slides.forEach(r=>{r.removeAttribute("data-swiper-slide-index")}),i.forEach(r=>{e.append(r)}),t.recalcSlides(),t.slideTo(t.realIndex,0)}},grabCursor:{setGrabCursor:function uce(t){const n=this;if(!n.params.simulateTouch||n.params.watchOverflow&&n.isLocked||n.params.cssMode)return;const e="container"===n.params.touchEventsTarget?n.el:n.wrapperEl;n.isElement&&(n.__preventObserver__=!0),e.style.cursor="move",e.style.cursor=t?"grabbing":"grab",n.isElement&&requestAnimationFrame(()=>{n.__preventObserver__=!1})},unsetGrabCursor:function hce(){const t=this;t.params.watchOverflow&&t.isLocked||t.params.cssMode||(t.isElement&&(t.__preventObserver__=!0),t["container"===t.params.touchEventsTarget?"el":"wrapperEl"].style.cursor="",t.isElement&&requestAnimationFrame(()=>{t.__preventObserver__=!1}))}},events:{attachEvents:function wce(){const t=this,{params:n}=t;t.onTouchStart=mce.bind(t),t.onTouchMove=gce.bind(t),t.onTouchEnd=_ce.bind(t),t.onDocumentTouchStart=xce.bind(t),n.cssMode&&(t.onScroll=vce.bind(t)),t.onClick=yce.bind(t),t.onLoad=bce.bind(t),$U(t,"on")},detachEvents:function Cce(){$U(this,"off")}},breakpoints:{setBreakpoint:function Sce(){const t=this,{realIndex:n,initialized:e,params:i,el:r}=t,l=i.breakpoints;if(!l||l&&0===Object.keys(l).length)return;const f=Da(),w="window"!==i.breakpointsBase&&i.breakpointsBase?"container":i.breakpointsBase,M=["window","container"].includes(i.breakpointsBase)||!i.breakpointsBase?t.el:f.querySelector(i.breakpointsBase),P=t.getBreakpoint(l,w,M);if(!P||t.currentBreakpoint===P)return;const $=(P in l?l[P]:void 0)||t.originalParams,Q=GU(t,i),X=GU(t,$),Y=t.params.grabCursor,K=$.grabCursor,de=i.enabled;Q&&!X?(r.classList.remove(`${i.containerModifierClass}grid`,`${i.containerModifierClass}grid-column`),t.emitContainerClasses()):!Q&&X&&(r.classList.add(`${i.containerModifierClass}grid`),($.grid.fill&&"column"===$.grid.fill||!$.grid.fill&&"column"===i.grid.fill)&&r.classList.add(`${i.containerModifierClass}grid-column`),t.emitContainerClasses()),Y&&!K?t.unsetGrabCursor():!Y&&K&&t.setGrabCursor(),["navigation","pagination","scrollbar"].forEach(It=>{if(typeof $[It]>"u")return;const Pt=i[It]&&i[It].enabled,$t=$[It]&&$[It].enabled;Pt&&!$t&&t[It].disable(),!Pt&&$t&&t[It].enable()});const ye=$.direction&&$.direction!==i.direction,he=i.loop&&($.slidesPerView!==i.slidesPerView||ye),Ce=i.loop;ye&&e&&t.changeDirection(),Pd(t.params,$);const Ge=t.params.enabled,ct=t.params.loop;Object.assign(t,{allowTouchMove:t.params.allowTouchMove,allowSlideNext:t.params.allowSlideNext,allowSlidePrev:t.params.allowSlidePrev}),de&&!Ge?t.disable():!de&&Ge&&t.enable(),t.currentBreakpoint=P,t.emit("_beforeBreakpoint",$),e&&(he?(t.loopDestroy(),t.loopCreate(n),t.updateSlides()):!Ce&&ct?(t.loopCreate(n),t.updateSlides()):Ce&&!ct&&t.loopDestroy()),t.emit("breakpoint",$)},getBreakpoint:function Dce(t,n,e){if(void 0===n&&(n="window"),!t||"container"===n&&!e)return;let i=!1;const r=Wo(),l="window"===n?r.innerHeight:e.clientHeight,f=Object.keys(t).map(w=>{if("string"==typeof w&&0===w.indexOf("@")){const M=parseFloat(w.substr(1));return{value:l*M,point:w}}return{value:w,point:w}});f.sort((w,M)=>parseInt(w.value,10)-parseInt(M.value,10));for(let w=0;w<f.length;w+=1){const{point:M,value:P}=f[w];"window"===n?r.matchMedia(`(min-width: ${P}px)`).matches&&(i=M):P<=e.clientWidth&&(i=M)}return i||"max"}},checkOverflow:{checkOverflow:function Rce(){const t=this,{isLocked:n,params:e}=t,{slidesOffsetBefore:i}=e;if(i){const r=t.slides.length-1;t.isLocked=t.size>t.slidesGrid[r]+t.slidesSizesGrid[r]+2*i}else t.isLocked=1===t.snapGrid.length;!0===e.allowSlideNext&&(t.allowSlideNext=!t.isLocked),!0===e.allowSlidePrev&&(t.allowSlidePrev=!t.isLocked),n&&n!==t.isLocked&&(t.isEnd=!1),n!==t.isLocked&&t.emit(t.isLocked?"lock":"unlock")}},classes:{addClasses:function Ice(){const t=this,{classNames:n,params:e,rtl:i,el:r,device:l}=t,f=function Tce(t,n){const e=[];return t.forEach(i=>{"object"==typeof i?Object.keys(i).forEach(r=>{i[r]&&e.push(n+r)}):"string"==typeof i&&e.push(n+i)}),e}(["initialized",e.direction,{"free-mode":t.params.freeMode&&e.freeMode.enabled},{autoheight:e.autoHeight},{rtl:i},{grid:e.grid&&e.grid.rows>1},{"grid-column":e.grid&&e.grid.rows>1&&"column"===e.grid.fill},{android:l.android},{ios:l.ios},{"css-mode":e.cssMode},{centered:e.cssMode&&e.centeredSlides},{"watch-progress":e.watchSlidesProgress}],e.containerModifierClass);n.push(...f),r.classList.add(...n),t.emitContainerClasses()},removeClasses:function Ace(){const{el:n,classNames:e}=this;!n||"string"==typeof n||(n.classList.remove(...e),this.emitContainerClasses())}}},tO={};class Fd{constructor(){let n,e;for(var i=arguments.length,r=new Array(i),l=0;l<i;l++)r[l]=arguments[l];1===r.length&&r[0].constructor&&"Object"===Object.prototype.toString.call(r[0]).slice(8,-1)?e=r[0]:[n,e]=r,e||(e={}),e=Pd({},e),n&&!e.el&&(e.el=n);const f=Da();if(e.el&&"string"==typeof e.el&&f.querySelectorAll(e.el).length>1){const L=[];return f.querySelectorAll(e.el).forEach($=>{const Q=Pd({},e,{el:$});L.push(new Fd(Q))}),L}const w=this;w.__swiper__=!0,w.support=NU(),w.device=zU({userAgent:e.userAgent}),w.browser=BU(),w.eventsListeners={},w.eventsAnyListeners=[],w.modules=[...w.__modules__],e.modules&&Array.isArray(e.modules)&&w.modules.push(...e.modules);const M={};w.modules.forEach(L=>{L({params:e,swiper:w,extendParams:Oce(e,M),on:w.on.bind(w),once:w.once.bind(w),off:w.off.bind(w),emit:w.emit.bind(w)})});const P=Pd({},JP,M);return w.params=Pd({},P,tO,e),w.originalParams=Pd({},w.params),w.passedParams=Pd({},e),w.params&&w.params.on&&Object.keys(w.params.on).forEach(L=>{w.on(L,w.params.on[L])}),w.params&&w.params.onAny&&w.onAny(w.params.onAny),Object.assign(w,{enabled:w.params.enabled,el:n,classNames:[],slides:[],slidesGrid:[],snapGrid:[],slidesSizesGrid:[],isHorizontal:()=>"horizontal"===w.params.direction,isVertical:()=>"vertical"===w.params.direction,activeIndex:0,realIndex:0,isBeginning:!0,isEnd:!1,translate:0,previousTranslate:0,progress:0,velocity:0,animating:!1,cssOverflowAdjustment(){return Math.trunc(this.translate/2**23)*2**23},allowSlideNext:w.params.allowSlideNext,allowSlidePrev:w.params.allowSlidePrev,touchEventsData:{isTouched:void 0,isMoved:void 0,allowTouchCallbacks:void 0,touchStartTime:void 0,isScrolling:void 0,currentTranslate:void 0,startTranslate:void 0,allowThresholdMove:void 0,focusableElements:w.params.focusableElements,lastClickTime:0,clickTimeout:void 0,velocities:[],allowMomentumBounce:void 0,startMoving:void 0,pointerId:null,touchId:null},allowClick:!0,allowTouchMove:w.params.allowTouchMove,touches:{startX:0,startY:0,currentX:0,currentY:0,diff:0},imagesToLoad:[],imagesLoaded:0}),w.emit("_swiper"),w.params.init&&w.init(),w}getDirectionLabel(n){return this.isHorizontal()?n:{width:"height","margin-top":"margin-left","margin-bottom ":"margin-right","margin-left":"margin-top","margin-right":"margin-bottom","padding-left":"padding-top","padding-right":"padding-bottom",marginRight:"marginBottom"}[n]}getSlideIndex(n){const{slidesEl:e,params:i}=this,l=mE(tl(e,`.${i.slideClass}, swiper-slide`)[0]);return mE(n)-l}getSlideIndexByData(n){return this.getSlideIndex(this.slides.find(e=>1*e.getAttribute("data-swiper-slide-index")===n))}recalcSlides(){const{slidesEl:e,params:i}=this;this.slides=tl(e,`.${i.slideClass}, swiper-slide`)}enable(){const n=this;n.enabled||(n.enabled=!0,n.params.grabCursor&&n.setGrabCursor(),n.emit("enable"))}disable(){const n=this;n.enabled&&(n.enabled=!1,n.params.grabCursor&&n.unsetGrabCursor(),n.emit("disable"))}setProgress(n,e){const i=this;n=Math.min(Math.max(n,0),1);const r=i.minTranslate(),f=(i.maxTranslate()-r)*n+r;i.translateTo(f,typeof e>"u"?0:e),i.updateActiveIndex(),i.updateSlidesClasses()}emitContainerClasses(){const n=this;if(!n.params._emitClasses||!n.el)return;const e=n.el.className.split(" ").filter(i=>0===i.indexOf("swiper")||0===i.indexOf(n.params.containerModifierClass));n.emit("_containerClasses",e.join(" "))}getSlideClasses(n){const e=this;return e.destroyed?"":n.className.split(" ").filter(i=>0===i.indexOf("swiper-slide")||0===i.indexOf(e.params.slideClass)).join(" ")}emitSlidesClasses(){const n=this;if(!n.params._emitClasses||!n.el)return;const e=[];n.slides.forEach(i=>{const r=n.getSlideClasses(i);e.push({slideEl:i,classNames:r}),n.emit("_slideClass",i,r)}),n.emit("_slideClasses",e)}slidesPerViewDynamic(n,e){void 0===n&&(n="current"),void 0===e&&(e=!1);const{params:r,slides:l,slidesGrid:f,slidesSizesGrid:w,size:M,activeIndex:P}=this;let L=1;if("number"==typeof r.slidesPerView)return r.slidesPerView;if(r.centeredSlides){let Q,$=l[P]?Math.ceil(l[P].swiperSlideSize):0;for(let X=P+1;X<l.length;X+=1)l[X]&&!Q&&($+=Math.ceil(l[X].swiperSlideSize),L+=1,$>M&&(Q=!0));for(let X=P-1;X>=0;X-=1)l[X]&&!Q&&($+=l[X].swiperSlideSize,L+=1,$>M&&(Q=!0))}else if("current"===n)for(let $=P+1;$<l.length;$+=1)(e?f[$]+w[$]-f[P]<M:f[$]-f[P]<M)&&(L+=1);else for(let $=P-1;$>=0;$-=1)f[P]-f[$]<M&&(L+=1);return L}update(){const n=this;if(!n||n.destroyed)return;const{snapGrid:e,params:i}=n;function r(){const w=Math.min(Math.max(n.rtlTranslate?-1*n.translate:n.translate,n.maxTranslate()),n.minTranslate());n.setTranslate(w),n.updateActiveIndex(),n.updateSlidesClasses()}let l;i.breakpoints&&n.setBreakpoint(),[...n.el.querySelectorAll('[loading="lazy"]')].forEach(f=>{f.complete&&tI(n,f)}),n.updateSize(),n.updateSlides(),n.updateProgress(),n.updateSlidesClasses(),i.freeMode&&i.freeMode.enabled&&!i.cssMode?(r(),i.autoHeight&&n.updateAutoHeight()):(l=n.slideTo(("auto"===i.slidesPerView||i.slidesPerView>1)&&n.isEnd&&!i.centeredSlides?(n.virtual&&i.virtual.enabled?n.virtual.slides:n.slides).length-1:n.activeIndex,0,!1,!0),l||r()),i.watchOverflow&&e!==n.snapGrid&&n.checkOverflow(),n.emit("update")}changeDirection(n,e){void 0===e&&(e=!0);const i=this,r=i.params.direction;return n||(n="horizontal"===r?"vertical":"horizontal"),n===r||"horizontal"!==n&&"vertical"!==n||(i.el.classList.remove(`${i.params.containerModifierClass}${r}`),i.el.classList.add(`${i.params.containerModifierClass}${n}`),i.emitContainerClasses(),i.params.direction=n,i.slides.forEach(l=>{"vertical"===n?l.style.width="":l.style.height=""}),i.emit("changeDirection"),e&&i.update()),i}changeLanguageDirection(n){const e=this;e.rtl&&"rtl"===n||!e.rtl&&"ltr"===n||(e.rtl="rtl"===n,e.rtlTranslate="horizontal"===e.params.direction&&e.rtl,e.rtl?(e.el.classList.add(`${e.params.containerModifierClass}rtl`),e.el.dir="rtl"):(e.el.classList.remove(`${e.params.containerModifierClass}rtl`),e.el.dir="ltr"),e.update())}mount(n){const e=this;if(e.mounted)return!0;let i=n||e.params.el;if("string"==typeof i&&(i=document.querySelector(i)),!i)return!1;i.swiper=e,i.parentNode&&i.parentNode.host&&i.parentNode.host.nodeName===e.params.swiperElementNodeName.toUpperCase()&&(e.isElement=!0);const r=()=>`.${(e.params.wrapperClass||"").trim().split(" ").join(".")}`;let f=i&&i.shadowRoot&&i.shadowRoot.querySelector?i.shadowRoot.querySelector(r()):tl(i,r())[0];return!f&&e.params.createElements&&(f=Od("div",e.params.wrapperClass),i.append(f),tl(i,`.${e.params.slideClass}`).forEach(w=>{f.append(w)})),Object.assign(e,{el:i,wrapperEl:f,slidesEl:e.isElement&&!i.parentNode.host.slideSlots?i.parentNode.host:f,hostEl:e.isElement?i.parentNode.host:i,mounted:!0,rtl:"rtl"===i.dir.toLowerCase()||"rtl"===Kg(i,"direction"),rtlTranslate:"horizontal"===e.params.direction&&("rtl"===i.dir.toLowerCase()||"rtl"===Kg(i,"direction")),wrongRTL:"-webkit-box"===Kg(f,"display")}),!0}init(n){const e=this;if(e.initialized||!1===e.mount(n))return e;e.emit("beforeInit"),e.params.breakpoints&&e.setBreakpoint(),e.addClasses(),e.updateSize(),e.updateSlides(),e.params.watchOverflow&&e.checkOverflow(),e.params.grabCursor&&e.enabled&&e.setGrabCursor(),e.slideTo(e.params.loop&&e.virtual&&e.params.virtual.enabled?e.params.initialSlide+e.virtual.slidesBefore:e.params.initialSlide,0,e.params.runCallbacksOnInit,!1,!0),e.params.loop&&e.loopCreate(void 0,!0),e.attachEvents();const r=[...e.el.querySelectorAll('[loading="lazy"]')];return e.isElement&&r.push(...e.hostEl.querySelectorAll('[loading="lazy"]')),r.forEach(l=>{l.complete?tI(e,l):l.addEventListener("load",f=>{tI(e,f.target)})}),QP(e),e.initialized=!0,QP(e),e.emit("init"),e.emit("afterInit"),e}destroy(n,e){void 0===n&&(n=!0),void 0===e&&(e=!0);const i=this,{params:r,el:l,wrapperEl:f,slides:w}=i;return typeof i.params>"u"||i.destroyed||(i.emit("beforeDestroy"),i.initialized=!1,i.detachEvents(),r.loop&&i.loopDestroy(),e&&(i.removeClasses(),l&&"string"!=typeof l&&l.removeAttribute("style"),f&&f.removeAttribute("style"),w&&w.length&&w.forEach(M=>{M.classList.remove(r.slideVisibleClass,r.slideFullyVisibleClass,r.slideActiveClass,r.slideNextClass,r.slidePrevClass),M.removeAttribute("style"),M.removeAttribute("data-swiper-slide-index")})),i.emit("destroy"),Object.keys(i.eventsListeners).forEach(M=>{i.off(M)}),!1!==n&&(i.el&&"string"!=typeof i.el&&(i.el.swiper=null),function vle(t){const n=t;Object.keys(n).forEach(e=>{try{n[e]=null}catch{}try{delete n[e]}catch{}})}(i)),i.destroyed=!0),null}static extendDefaults(n){Pd(tO,n)}static get extendedDefaults(){return tO}static get defaults(){return JP}static installModule(n){Fd.prototype.__modules__||(Fd.prototype.__modules__=[]);const e=Fd.prototype.__modules__;"function"==typeof n&&e.indexOf(n)<0&&e.push(n)}static use(n){return Array.isArray(n)?(n.forEach(e=>Fd.installModule(e)),Fd):(Fd.installModule(n),Fd)}}function nO(t,n,e,i){return t.params.createElements&&Object.keys(i).forEach(r=>{if(!e[r]&&!0===e.auto){let l=tl(t.el,`.${i[r]}`)[0];l||(l=Od("div",i[r]),l.className=i[r],t.el.append(l)),e[r]=l,n[r]=l}}),e}function dm(t){return void 0===t&&(t=""),`.${t.trim().replace(/([\.:!+\/])/g,"\\$1").replace(/ /g,".")}`}function Kce(t){const n=this,{params:e,slidesEl:i}=n;e.loop&&n.loopDestroy();const r=l=>{if("string"==typeof l){const f=document.createElement("div");f.innerHTML=l,i.append(f.children[0]),f.innerHTML=""}else i.append(l)};if("object"==typeof t&&"length"in t)for(let l=0;l<t.length;l+=1)t[l]&&r(t[l]);else r(t);n.recalcSlides(),e.loop&&n.loopCreate(),(!e.observer||n.isElement)&&n.update()}function Qce(t){const n=this,{params:e,activeIndex:i,slidesEl:r}=n;e.loop&&n.loopDestroy();let l=i+1;const f=w=>{if("string"==typeof w){const M=document.createElement("div");M.innerHTML=w,r.prepend(M.children[0]),M.innerHTML=""}else r.prepend(w)};if("object"==typeof t&&"length"in t){for(let w=0;w<t.length;w+=1)t[w]&&f(t[w]);l=i+t.length}else f(t);n.recalcSlides(),e.loop&&n.loopCreate(),(!e.observer||n.isElement)&&n.update(),n.slideTo(l,0,!1)}function Jce(t,n){const e=this,{params:i,activeIndex:r,slidesEl:l}=e;let f=r;i.loop&&(f-=e.loopedSlides,e.loopDestroy(),e.recalcSlides());const w=e.slides.length;if(t<=0)return void e.prependSlide(n);if(t>=w)return void e.appendSlide(n);let M=f>t?f+1:f;const P=[];for(let L=w-1;L>=t;L-=1){const $=e.slides[L];$.remove(),P.unshift($)}if("object"==typeof n&&"length"in n){for(let L=0;L<n.length;L+=1)n[L]&&l.append(n[L]);M=f>t?f+n.length:f}else l.append(n);for(let L=0;L<P.length;L+=1)l.append(P[L]);e.recalcSlides(),i.loop&&e.loopCreate(),(!i.observer||e.isElement)&&e.update(),e.slideTo(i.loop?M+e.loopedSlides:M,0,!1)}function ede(t){const n=this,{params:e,activeIndex:i}=n;let r=i;e.loop&&(r-=n.loopedSlides,n.loopDestroy());let f,l=r;if("object"==typeof t&&"length"in t){for(let w=0;w<t.length;w+=1)f=t[w],n.slides[f]&&n.slides[f].remove(),f<l&&(l-=1);l=Math.max(l,0)}else f=t,n.slides[f]&&n.slides[f].remove(),f<l&&(l-=1),l=Math.max(l,0);n.recalcSlides(),e.loop&&n.loopCreate(),(!e.observer||n.isElement)&&n.update(),n.slideTo(e.loop?l+n.loopedSlides:l,0,!1)}function tde(){const t=this,n=[];for(let e=0;e<t.slides.length;e+=1)n.push(e);t.removeSlide(n)}function ux(t){const{effect:n,swiper:e,on:i,setTranslate:r,setTransition:l,overwriteParams:f,perspective:w,recreateShadows:M,getEffectParams:P}=t;let L;i("beforeInit",()=>{if(e.params.effect!==n)return;e.classNames.push(`${e.params.containerModifierClass}${n}`),w&&w()&&e.classNames.push(`${e.params.containerModifierClass}3d`);const $=f?f():{};Object.assign(e.params,$),Object.assign(e.originalParams,$)}),i("setTranslate",()=>{e.params.effect===n&&r()}),i("setTransition",($,Q)=>{e.params.effect===n&&l(Q)}),i("transitionEnd",()=>{if(e.params.effect===n&&M){if(!P||!P().slideShadows)return;e.slides.forEach($=>{$.querySelectorAll(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").forEach(Q=>Q.remove())}),M()}}),i("virtualUpdate",()=>{e.params.effect===n&&(e.slides.length||(L=!0),requestAnimationFrame(()=>{L&&e.slides&&e.slides.length&&(r(),L=!1)}))})}function _E(t,n){const e=dv(n);return e!==n&&(e.style.backfaceVisibility="hidden",e.style["-webkit-backface-visibility"]="hidden"),e}function nI(t){let{swiper:n,duration:e,transformElements:i,allSlides:r}=t;const{activeIndex:l}=n;if(n.params.virtualTranslate&&0!==e){let M,w=!1;M=r?i:i.filter(P=>{const L=P.classList.contains("swiper-slide-transform")?(w=>w.parentElement?w.parentElement:n.slides.find(P=>P.shadowRoot&&P.shadowRoot===w.parentNode))(P):P;return n.getSlideIndex(L)===l}),M.forEach(P=>{gE(P,()=>{if(w||!n||n.destroyed)return;w=!0,n.animating=!1;const L=new window.CustomEvent("transitionend",{bubbles:!0,cancelable:!0});n.wrapperEl.dispatchEvent(L)})})}}function hx(t,n,e){const i=`swiper-slide-shadow${e?`-${e}`:""}${t?` swiper-slide-shadow-${t}`:""}`,r=dv(n);let l=r.querySelector(`.${i.split(" ").join(".")}`);return l||(l=Od("div",i.split(" ")),r.append(l)),l}Object.keys(eO).forEach(t=>{Object.keys(eO[t]).forEach(n=>{Fd.prototype[n]=eO[t][n]})}),Fd.use([function Ile(t){let{swiper:n,on:e,emit:i}=t;const r=Wo();let l=null,f=null;const w=()=>{!n||n.destroyed||!n.initialized||(i("beforeResize"),i("resize"))},L=()=>{!n||n.destroyed||!n.initialized||i("orientationchange")};e("init",()=>{n.params.resizeObserver&&typeof r.ResizeObserver<"u"?!n||n.destroyed||!n.initialized||(l=new ResizeObserver($=>{f=r.requestAnimationFrame(()=>{const{width:Q,height:X}=n;let Y=Q,K=X;$.forEach(de=>{let{contentBoxSize:ye,contentRect:he,target:Ce}=de;Ce&&Ce!==n.el||(Y=he?he.width:(ye[0]||ye).inlineSize,K=he?he.height:(ye[0]||ye).blockSize)}),(Y!==Q||K!==X)&&w()})}),l.observe(n.el)):(r.addEventListener("resize",w),r.addEventListener("orientationchange",L))}),e("destroy",()=>{f&&r.cancelAnimationFrame(f),l&&l.unobserve&&n.el&&(l.unobserve(n.el),l=null),r.removeEventListener("resize",w),r.removeEventListener("orientationchange",L)})},function Ale(t){let{swiper:n,extendParams:e,on:i,emit:r}=t;const l=[],f=Wo(),w=function(L,$){void 0===$&&($={});const X=new(f.MutationObserver||f.WebkitMutationObserver)(Y=>{if(n.__preventObserver__)return;if(1===Y.length)return void r("observerUpdate",Y[0]);const K=function(){r("observerUpdate",Y[0])};f.requestAnimationFrame?f.requestAnimationFrame(K):f.setTimeout(K,0)});X.observe(L,{attributes:typeof $.attributes>"u"||$.attributes,childList:n.isElement||(typeof $.childList>"u"||$).childList,characterData:typeof $.characterData>"u"||$.characterData}),l.push(X)};e({observer:!1,observeParents:!1,observeSlideChildren:!1}),i("init",()=>{if(n.params.observer){if(n.params.observeParents){const L=uv(n.hostEl);for(let $=0;$<L.length;$+=1)w(L[$])}w(n.hostEl,{childList:n.params.observeSlideChildren}),w(n.wrapperEl,{attributes:!1})}}),i("destroy",()=>{l.forEach(L=>{L.disconnect()}),l.splice(0,l.length)})}]),Fd.use([function Fce(t){let l,{swiper:n,extendParams:e,on:i,emit:r}=t;e({virtual:{enabled:!1,slides:[],cache:!0,renderSlide:null,renderExternal:null,renderExternalUpdate:!0,addSlidesBefore:0,addSlidesAfter:0}});const f=Da();n.virtual={cache:{},from:void 0,to:void 0,slides:[],offset:0,slidesGrid:[]};const w=f.createElement("div");function M(Y,K){const de=n.params.virtual;if(de.cache&&n.virtual.cache[K])return n.virtual.cache[K];let ye;return de.renderSlide?(ye=de.renderSlide.call(n,Y,K),"string"==typeof ye&&(w.innerHTML=ye,ye=w.children[0])):ye=n.isElement?Od("swiper-slide"):Od("div",n.params.slideClass),ye.setAttribute("data-swiper-slide-index",K),de.renderSlide||(ye.innerHTML=Y),de.cache&&(n.virtual.cache[K]=ye),ye}function P(Y,K,de){const{slidesPerView:ye,slidesPerGroup:he,centeredSlides:Ce,loop:Ge,initialSlide:ct}=n.params;if(K&&!Ge&&ct>0)return;const{addSlidesBefore:It,addSlidesAfter:Pt}=n.params.virtual,{from:$t,to:mt,slides:At,slidesGrid:Xt,offset:Gt}=n.virtual;n.params.cssMode||n.updateActiveIndex();const jt=typeof de>"u"?n.activeIndex||0:de;let Kt,dn,mn;Kt=n.rtlTranslate?"right":n.isHorizontal()?"left":"top",Ce?(dn=Math.floor(ye/2)+he+Pt,mn=Math.floor(ye/2)+he+It):(dn=ye+(he-1)+Pt,mn=(Ge?ye:he)+It);let St=jt-mn,Rt=jt+dn;Ge||(St=Math.max(St,0),Rt=Math.min(Rt,At.length-1));let Cn=(n.slidesGrid[St]||0)-(n.slidesGrid[0]||0);function pr(){n.updateSlides(),n.updateProgress(),n.updateSlidesClasses(),r("virtualUpdate")}if(Ge&&jt>=mn?(St-=mn,Ce||(Cn+=n.slidesGrid[0])):Ge&&jt<mn&&(St=-mn,Ce&&(Cn+=n.slidesGrid[0])),Object.assign(n.virtual,{from:St,to:Rt,offset:Cn,slidesGrid:n.slidesGrid,slidesBefore:mn,slidesAfter:dn}),$t===St&&mt===Rt&&!Y)return n.slidesGrid!==Xt&&Cn!==Gt&&n.slides.forEach(sn=>{sn.style[Kt]=Cn-Math.abs(n.cssOverflowAdjustment())+"px"}),n.updateProgress(),void r("virtualUpdate");if(n.params.virtual.renderExternal)return n.params.virtual.renderExternal.call(n,{offset:Cn,from:St,to:Rt,slides:function(){const yn=[];for(let Fr=St;Fr<=Rt;Fr+=1)yn.push(At[Fr]);return yn}()}),void(n.params.virtual.renderExternalUpdate?pr():r("virtualUpdate"));const as=[],Ma=[],$p=sn=>{let yn=sn;return sn<0?yn=At.length+sn:yn>=At.length&&(yn-=At.length),yn};if(Y)n.slides.filter(sn=>sn.matches(`.${n.params.slideClass}, swiper-slide`)).forEach(sn=>{sn.remove()});else for(let sn=$t;sn<=mt;sn+=1)if(sn<St||sn>Rt){const yn=$p(sn);n.slides.filter(Fr=>Fr.matches(`.${n.params.slideClass}[data-swiper-slide-index="${yn}"], swiper-slide[data-swiper-slide-index="${yn}"]`)).forEach(Fr=>{Fr.remove()})}const un=Ge?2*At.length:At.length;for(let sn=Ge?-At.length:0;sn<un;sn+=1)if(sn>=St&&sn<=Rt){const yn=$p(sn);typeof mt>"u"||Y?Ma.push(yn):(sn>mt&&Ma.push(yn),sn<$t&&as.push(yn))}if(Ma.forEach(sn=>{n.slidesEl.append(M(At[sn],sn))}),Ge)for(let sn=as.length-1;sn>=0;sn-=1){const yn=as[sn];n.slidesEl.prepend(M(At[yn],yn))}else as.sort((sn,yn)=>yn-sn),as.forEach(sn=>{n.slidesEl.prepend(M(At[sn],sn))});tl(n.slidesEl,".swiper-slide, swiper-slide").forEach(sn=>{sn.style[Kt]=Cn-Math.abs(n.cssOverflowAdjustment())+"px"}),pr()}i("beforeInit",()=>{if(!n.params.virtual.enabled)return;let Y;if(typeof n.passedParams.virtual.slides>"u"){const K=[...n.slidesEl.children].filter(de=>de.matches(`.${n.params.slideClass}, swiper-slide`));K&&K.length&&(n.virtual.slides=[...K],Y=!0,K.forEach((de,ye)=>{de.setAttribute("data-swiper-slide-index",ye),n.virtual.cache[ye]=de,de.remove()}))}Y||(n.virtual.slides=n.params.virtual.slides),n.classNames.push(`${n.params.containerModifierClass}virtual`),n.params.watchSlidesProgress=!0,n.originalParams.watchSlidesProgress=!0,P(!1,!0)}),i("setTranslate",()=>{n.params.virtual.enabled&&(n.params.cssMode&&!n._immediateVirtual?(clearTimeout(l),l=setTimeout(()=>{P()},100)):P())}),i("init update resize",()=>{n.params.virtual.enabled&&n.params.cssMode&&fE(n.wrapperEl,"--swiper-virtual-size",`${n.virtualSize}px`)}),Object.assign(n.virtual,{appendSlide:function L(Y){if("object"==typeof Y&&"length"in Y)for(let K=0;K<Y.length;K+=1)Y[K]&&n.virtual.slides.push(Y[K]);else n.virtual.slides.push(Y);P(!0)},prependSlide:function $(Y){const K=n.activeIndex;let de=K+1,ye=1;if(Array.isArray(Y)){for(let he=0;he<Y.length;he+=1)Y[he]&&n.virtual.slides.unshift(Y[he]);de=K+Y.length,ye=Y.length}else n.virtual.slides.unshift(Y);if(n.params.virtual.cache){const he=n.virtual.cache,Ce={};Object.keys(he).forEach(Ge=>{const ct=he[Ge],It=ct.getAttribute("data-swiper-slide-index");It&&ct.setAttribute("data-swiper-slide-index",parseInt(It,10)+ye),Ce[parseInt(Ge,10)+ye]=ct}),n.virtual.cache=Ce}P(!0),n.slideTo(de,0)},removeSlide:function Q(Y){if(typeof Y>"u"||null===Y)return;let K=n.activeIndex;if(Array.isArray(Y))for(let de=Y.length-1;de>=0;de-=1)n.params.virtual.cache&&(delete n.virtual.cache[Y[de]],Object.keys(n.virtual.cache).forEach(ye=>{ye>Y&&(n.virtual.cache[ye-1]=n.virtual.cache[ye],n.virtual.cache[ye-1].setAttribute("data-swiper-slide-index",ye-1),delete n.virtual.cache[ye])})),n.virtual.slides.splice(Y[de],1),Y[de]<K&&(K-=1),K=Math.max(K,0);else n.params.virtual.cache&&(delete n.virtual.cache[Y],Object.keys(n.virtual.cache).forEach(de=>{de>Y&&(n.virtual.cache[de-1]=n.virtual.cache[de],n.virtual.cache[de-1].setAttribute("data-swiper-slide-index",de-1),delete n.virtual.cache[de])})),n.virtual.slides.splice(Y,1),Y<K&&(K-=1),K=Math.max(K,0);P(!0),n.slideTo(K,0)},removeAllSlides:function X(){n.virtual.slides=[],n.params.virtual.cache&&(n.virtual.cache={}),P(!0),n.slideTo(0,0)},update:P})},function Lce(t){let{swiper:n,extendParams:e,on:i,emit:r}=t;const l=Da(),f=Wo();function w(L){if(!n.enabled)return;const{rtlTranslate:$}=n;let Q=L;Q.originalEvent&&(Q=Q.originalEvent);const X=Q.keyCode||Q.charCode,Y=n.params.keyboard.pageUpDown,K=Y&&33===X,de=Y&&34===X,ye=37===X,he=39===X,Ce=38===X,Ge=40===X;if(!n.allowSlideNext&&(n.isHorizontal()&&he||n.isVertical()&&Ge||de)||!n.allowSlidePrev&&(n.isHorizontal()&&ye||n.isVertical()&&Ce||K))return!1;if(!(Q.shiftKey||Q.altKey||Q.ctrlKey||Q.metaKey||l.activeElement&&l.activeElement.nodeName&&("input"===l.activeElement.nodeName.toLowerCase()||"textarea"===l.activeElement.nodeName.toLowerCase()))){if(n.params.keyboard.onlyInViewport&&(K||de||ye||he||Ce||Ge)){let ct=!1;if(uv(n.el,`.${n.params.slideClass}, swiper-slide`).length>0&&0===uv(n.el,`.${n.params.slideActiveClass}`).length)return;const It=n.el,Pt=It.clientWidth,$t=It.clientHeight,mt=f.innerWidth,At=f.innerHeight,Xt=JT(It);$&&(Xt.left-=It.scrollLeft);const Gt=[[Xt.left,Xt.top],[Xt.left+Pt,Xt.top],[Xt.left,Xt.top+$t],[Xt.left+Pt,Xt.top+$t]];for(let jt=0;jt<Gt.length;jt+=1){const Kt=Gt[jt];if(Kt[0]>=0&&Kt[0]<=mt&&Kt[1]>=0&&Kt[1]<=At){if(0===Kt[0]&&0===Kt[1])continue;ct=!0}}if(!ct)return}n.isHorizontal()?((K||de||ye||he)&&(Q.preventDefault?Q.preventDefault():Q.returnValue=!1),((de||he)&&!$||(K||ye)&&$)&&n.slideNext(),((K||ye)&&!$||(de||he)&&$)&&n.slidePrev()):((K||de||Ce||Ge)&&(Q.preventDefault?Q.preventDefault():Q.returnValue=!1),(de||Ge)&&n.slideNext(),(K||Ce)&&n.slidePrev()),r("keyPress",X)}}function M(){n.keyboard.enabled||(l.addEventListener("keydown",w),n.keyboard.enabled=!0)}function P(){n.keyboard.enabled&&(l.removeEventListener("keydown",w),n.keyboard.enabled=!1)}n.keyboard={enabled:!1},e({keyboard:{enabled:!1,onlyInViewport:!0,pageUpDown:!0}}),i("init",()=>{n.params.keyboard.enabled&&M()}),i("destroy",()=>{n.keyboard.enabled&&P()}),Object.assign(n.keyboard,{enable:M,disable:P})},function Nce(t){let{swiper:n,extendParams:e,on:i,emit:r}=t;const l=Wo();e({mousewheel:{enabled:!1,releaseOnEdges:!1,invert:!1,forceToAxis:!1,sensitivity:1,eventsTarget:"container",thresholdDelta:null,thresholdTime:null,noMousewheelClass:"swiper-no-mousewheel"}}),n.mousewheel={enabled:!1};let f,M,w=Tu();const P=[];function $(){n.enabled&&(n.mouseEntered=!0)}function Q(){n.enabled&&(n.mouseEntered=!1)}function X(Ce){return!(n.params.mousewheel.thresholdDelta&&Ce.delta<n.params.mousewheel.thresholdDelta||n.params.mousewheel.thresholdTime&&Tu()-w<n.params.mousewheel.thresholdTime)&&(Ce.delta>=6&&Tu()-w<60||(Ce.direction<0?(!n.isEnd||n.params.loop)&&!n.animating&&(n.slideNext(),r("scroll",Ce.raw)):(!n.isBeginning||n.params.loop)&&!n.animating&&(n.slidePrev(),r("scroll",Ce.raw)),w=(new l.Date).getTime(),!1))}function K(Ce){let Ge=Ce,ct=!0;if(!n.enabled||Ce.target.closest(`.${n.params.mousewheel.noMousewheelClass}`))return;const It=n.params.mousewheel;n.params.cssMode&&Ge.preventDefault();let Pt=n.el;"container"!==n.params.mousewheel.eventsTarget&&(Pt=document.querySelector(n.params.mousewheel.eventsTarget));const $t=Pt&&Pt.contains(Ge.target);if(!n.mouseEntered&&!$t&&!It.releaseOnEdges)return!0;Ge.originalEvent&&(Ge=Ge.originalEvent);let mt=0;const At=n.rtlTranslate?-1:1,Xt=function L(Ce){let Pt=0,$t=0,mt=0,At=0;return"detail"in Ce&&($t=Ce.detail),"wheelDelta"in Ce&&($t=-Ce.wheelDelta/120),"wheelDeltaY"in Ce&&($t=-Ce.wheelDeltaY/120),"wheelDeltaX"in Ce&&(Pt=-Ce.wheelDeltaX/120),"axis"in Ce&&Ce.axis===Ce.HORIZONTAL_AXIS&&(Pt=$t,$t=0),mt=10*Pt,At=10*$t,"deltaY"in Ce&&(At=Ce.deltaY),"deltaX"in Ce&&(mt=Ce.deltaX),Ce.shiftKey&&!mt&&(mt=At,At=0),(mt||At)&&Ce.deltaMode&&(1===Ce.deltaMode?(mt*=40,At*=40):(mt*=800,At*=800)),mt&&!Pt&&(Pt=mt<1?-1:1),At&&!$t&&($t=At<1?-1:1),{spinX:Pt,spinY:$t,pixelX:mt,pixelY:At}}(Ge);if(It.forceToAxis)if(n.isHorizontal()){if(!(Math.abs(Xt.pixelX)>Math.abs(Xt.pixelY)))return!0;mt=-Xt.pixelX*At}else{if(!(Math.abs(Xt.pixelY)>Math.abs(Xt.pixelX)))return!0;mt=-Xt.pixelY}else mt=Math.abs(Xt.pixelX)>Math.abs(Xt.pixelY)?-Xt.pixelX*At:-Xt.pixelY;if(0===mt)return!0;It.invert&&(mt=-mt);let Gt=n.getTranslate()+mt*It.sensitivity;if(Gt>=n.minTranslate()&&(Gt=n.minTranslate()),Gt<=n.maxTranslate()&&(Gt=n.maxTranslate()),ct=!!n.params.loop||!(Gt===n.minTranslate()||Gt===n.maxTranslate()),ct&&n.params.nested&&Ge.stopPropagation(),n.params.freeMode&&n.params.freeMode.enabled){const jt={time:Tu(),delta:Math.abs(mt),direction:Math.sign(mt)},Kt=M&&jt.time<M.time+500&&jt.delta<=M.delta&&jt.direction===M.direction;if(!Kt){M=void 0;let dn=n.getTranslate()+mt*It.sensitivity;const mn=n.isBeginning,St=n.isEnd;if(dn>=n.minTranslate()&&(dn=n.minTranslate()),dn<=n.maxTranslate()&&(dn=n.maxTranslate()),n.setTransition(0),n.setTranslate(dn),n.updateProgress(),n.updateActiveIndex(),n.updateSlidesClasses(),(!mn&&n.isBeginning||!St&&n.isEnd)&&n.updateSlidesClasses(),n.params.loop&&n.loopFix({direction:jt.direction<0?"next":"prev",byMousewheel:!0}),n.params.freeMode.sticky){clearTimeout(f),f=void 0,P.length>=15&&P.shift();const Rt=P.length?P[P.length-1]:void 0,Cn=P[0];if(P.push(jt),Rt&&(jt.delta>Rt.delta||jt.direction!==Rt.direction))P.splice(0);else if(P.length>=15&&jt.time-Cn.time<500&&Cn.delta-jt.delta>=1&&jt.delta<=6){const pr=mt>0?.8:.2;M=jt,P.splice(0),f=cv(()=>{n.destroyed||!n.params||n.slideToClosest(n.params.speed,!0,void 0,pr)},0)}f||(f=cv(()=>{!n.destroyed&&n.params&&(M=jt,P.splice(0),n.slideToClosest(n.params.speed,!0,void 0,.5))},500))}if(Kt||r("scroll",Ge),n.params.autoplay&&n.params.autoplay.disableOnInteraction&&n.autoplay.stop(),It.releaseOnEdges&&(dn===n.minTranslate()||dn===n.maxTranslate()))return!0}}else{const jt={time:Tu(),delta:Math.abs(mt),direction:Math.sign(mt),raw:Ce};P.length>=2&&P.shift();const Kt=P.length?P[P.length-1]:void 0;if(P.push(jt),Kt?(jt.direction!==Kt.direction||jt.delta>Kt.delta||jt.time>Kt.time+150)&&X(jt):X(jt),function Y(Ce){const Ge=n.params.mousewheel;if(Ce.direction<0){if(n.isEnd&&!n.params.loop&&Ge.releaseOnEdges)return!0}else if(n.isBeginning&&!n.params.loop&&Ge.releaseOnEdges)return!0;return!1}(jt))return!0}return Ge.preventDefault?Ge.preventDefault():Ge.returnValue=!1,!1}function de(Ce){let Ge=n.el;"container"!==n.params.mousewheel.eventsTarget&&(Ge=document.querySelector(n.params.mousewheel.eventsTarget)),Ge[Ce]("mouseenter",$),Ge[Ce]("mouseleave",Q),Ge[Ce]("wheel",K)}function ye(){return n.params.cssMode?(n.wrapperEl.removeEventListener("wheel",K),!0):!n.mousewheel.enabled&&(de("addEventListener"),n.mousewheel.enabled=!0,!0)}function he(){return n.params.cssMode?(n.wrapperEl.addEventListener(event,K),!0):!!n.mousewheel.enabled&&(de("removeEventListener"),n.mousewheel.enabled=!1,!0)}i("init",()=>{!n.params.mousewheel.enabled&&n.params.cssMode&&he(),n.params.mousewheel.enabled&&ye()}),i("destroy",()=>{n.params.cssMode&&ye(),n.mousewheel.enabled&&he()}),Object.assign(n.mousewheel,{enable:ye,disable:he})},function zce(t){let{swiper:n,extendParams:e,on:i,emit:r}=t;function l(Y){let K;return Y&&"string"==typeof Y&&n.isElement&&(K=n.el.querySelector(Y)||n.hostEl.querySelector(Y),K)?K:(Y&&("string"==typeof Y&&(K=[...document.querySelectorAll(Y)]),n.params.uniqueNavElements&&"string"==typeof Y&&K&&K.length>1&&1===n.el.querySelectorAll(Y).length?K=n.el.querySelector(Y):K&&1===K.length&&(K=K[0])),Y&&!K?Y:K)}function f(Y,K){const de=n.params.navigation;(Y=Sr(Y)).forEach(ye=>{ye&&(ye.classList[K?"add":"remove"](...de.disabledClass.split(" ")),"BUTTON"===ye.tagName&&(ye.disabled=K),n.params.watchOverflow&&n.enabled&&ye.classList[n.isLocked?"add":"remove"](de.lockClass))})}function w(){const{nextEl:Y,prevEl:K}=n.navigation;if(n.params.loop)return f(K,!1),void f(Y,!1);f(K,n.isBeginning&&!n.params.rewind),f(Y,n.isEnd&&!n.params.rewind)}function M(Y){Y.preventDefault(),(!n.isBeginning||n.params.loop||n.params.rewind)&&(n.slidePrev(),r("navigationPrev"))}function P(Y){Y.preventDefault(),(!n.isEnd||n.params.loop||n.params.rewind)&&(n.slideNext(),r("navigationNext"))}function L(){const Y=n.params.navigation;if(n.params.navigation=nO(n,n.originalParams.navigation,n.params.navigation,{nextEl:"swiper-button-next",prevEl:"swiper-button-prev"}),!Y.nextEl&&!Y.prevEl)return;let K=l(Y.nextEl),de=l(Y.prevEl);Object.assign(n.navigation,{nextEl:K,prevEl:de}),K=Sr(K),de=Sr(de);const ye=(he,Ce)=>{he&&he.addEventListener("click","next"===Ce?P:M),!n.enabled&&he&&he.classList.add(...Y.lockClass.split(" "))};K.forEach(he=>ye(he,"next")),de.forEach(he=>ye(he,"prev"))}function $(){let{nextEl:Y,prevEl:K}=n.navigation;Y=Sr(Y),K=Sr(K);const de=(ye,he)=>{ye.removeEventListener("click","next"===he?P:M),ye.classList.remove(...n.params.navigation.disabledClass.split(" "))};Y.forEach(ye=>de(ye,"next")),K.forEach(ye=>de(ye,"prev"))}e({navigation:{nextEl:null,prevEl:null,hideOnClick:!1,disabledClass:"swiper-button-disabled",hiddenClass:"swiper-button-hidden",lockClass:"swiper-button-lock",navigationDisabledClass:"swiper-navigation-disabled"}}),n.navigation={nextEl:null,prevEl:null},i("init",()=>{!1===n.params.navigation.enabled?X():(L(),w())}),i("toEdge fromEdge lock unlock",()=>{w()}),i("destroy",()=>{$()}),i("enable disable",()=>{let{nextEl:Y,prevEl:K}=n.navigation;Y=Sr(Y),K=Sr(K),n.enabled?w():[...Y,...K].filter(de=>!!de).forEach(de=>de.classList.add(n.params.navigation.lockClass))}),i("click",(Y,K)=>{let{nextEl:de,prevEl:ye}=n.navigation;de=Sr(de),ye=Sr(ye);const he=K.target;let Ce=ye.includes(he)||de.includes(he);if(n.isElement&&!Ce){const Ge=K.path||K.composedPath&&K.composedPath();Ge&&(Ce=Ge.find(ct=>de.includes(ct)||ye.includes(ct)))}if(n.params.navigation.hideOnClick&&!Ce){if(n.pagination&&n.params.pagination&&n.params.pagination.clickable&&(n.pagination.el===he||n.pagination.el.contains(he)))return;let Ge;de.length?Ge=de[0].classList.contains(n.params.navigation.hiddenClass):ye.length&&(Ge=ye[0].classList.contains(n.params.navigation.hiddenClass)),r(!0===Ge?"navigationShow":"navigationHide"),[...de,...ye].filter(ct=>!!ct).forEach(ct=>ct.classList.toggle(n.params.navigation.hiddenClass))}});const X=()=>{n.el.classList.add(...n.params.navigation.navigationDisabledClass.split(" ")),$()};Object.assign(n.navigation,{enable:()=>{n.el.classList.remove(...n.params.navigation.navigationDisabledClass.split(" ")),L(),w()},disable:X,update:w,init:L,destroy:$})},function Bce(t){let{swiper:n,extendParams:e,on:i,emit:r}=t;const l="swiper-pagination";e({pagination:{el:null,bulletElement:"span",clickable:!1,hideOnClick:!1,renderBullet:null,renderProgressbar:null,renderFraction:null,renderCustom:null,progressbarOpposite:!1,type:"bullets",dynamicBullets:!1,dynamicMainBullets:1,formatFractionCurrent:he=>he,formatFractionTotal:he=>he,bulletClass:`${l}-bullet`,bulletActiveClass:`${l}-bullet-active`,modifierClass:`${l}-`,currentClass:`${l}-current`,totalClass:`${l}-total`,hiddenClass:`${l}-hidden`,progressbarFillClass:`${l}-progressbar-fill`,progressbarOppositeClass:`${l}-progressbar-opposite`,clickableClass:`${l}-clickable`,lockClass:`${l}-lock`,horizontalClass:`${l}-horizontal`,verticalClass:`${l}-vertical`,paginationDisabledClass:`${l}-disabled`}}),n.pagination={el:null,bullets:[]};let f,w=0;function M(){return!n.params.pagination.el||!n.pagination.el||Array.isArray(n.pagination.el)&&0===n.pagination.el.length}function P(he,Ce){const{bulletActiveClass:Ge}=n.params.pagination;he&&(he=he[("prev"===Ce?"previous":"next")+"ElementSibling"])&&(he.classList.add(`${Ge}-${Ce}`),(he=he[("prev"===Ce?"previous":"next")+"ElementSibling"])&&he.classList.add(`${Ge}-${Ce}-${Ce}`))}function $(he){const Ce=he.target.closest(dm(n.params.pagination.bulletClass));if(!Ce)return;he.preventDefault();const Ge=mE(Ce)*n.params.slidesPerGroup;if(n.params.loop){if(n.realIndex===Ge)return;const ct=function L(he,Ce,Ge){return(Ce%=Ge)==1+(he%=Ge)?"next":Ce===he-1?"previous":void 0}(n.realIndex,Ge,n.slides.length);"next"===ct?n.slideNext():"previous"===ct?n.slidePrev():n.slideToLoop(Ge)}else n.slideTo(Ge)}function Q(){const he=n.rtl,Ce=n.params.pagination;if(M())return;let ct,It,Ge=n.pagination.el;Ge=Sr(Ge);const $t=n.params.loop?Math.ceil((n.virtual&&n.params.virtual.enabled?n.virtual.slides.length:n.slides.length)/n.params.slidesPerGroup):n.snapGrid.length;if(n.params.loop?(It=n.previousRealIndex||0,ct=n.params.slidesPerGroup>1?Math.floor(n.realIndex/n.params.slidesPerGroup):n.realIndex):typeof n.snapIndex<"u"?(ct=n.snapIndex,It=n.previousSnapIndex):(It=n.previousIndex||0,ct=n.activeIndex||0),"bullets"===Ce.type&&n.pagination.bullets&&n.pagination.bullets.length>0){const mt=n.pagination.bullets;let At,Xt,Gt;if(Ce.dynamicBullets&&(f=qP(mt[0],n.isHorizontal()?"width":"height",!0),Ge.forEach(jt=>{jt.style[n.isHorizontal()?"width":"height"]=f*(Ce.dynamicMainBullets+4)+"px"}),Ce.dynamicMainBullets>1&&void 0!==It&&(w+=ct-(It||0),w>Ce.dynamicMainBullets-1?w=Ce.dynamicMainBullets-1:w<0&&(w=0)),At=Math.max(ct-w,0),Xt=At+(Math.min(mt.length,Ce.dynamicMainBullets)-1),Gt=(Xt+At)/2),mt.forEach(jt=>{const Kt=[...["","-next","-next-next","-prev","-prev-prev","-main"].map(dn=>`${Ce.bulletActiveClass}${dn}`)].map(dn=>"string"==typeof dn&&dn.includes(" ")?dn.split(" "):dn).flat();jt.classList.remove(...Kt)}),Ge.length>1)mt.forEach(jt=>{const Kt=mE(jt);Kt===ct?jt.classList.add(...Ce.bulletActiveClass.split(" ")):n.isElement&&jt.setAttribute("part","bullet"),Ce.dynamicBullets&&(Kt>=At&&Kt<=Xt&&jt.classList.add(...`${Ce.bulletActiveClass}-main`.split(" ")),Kt===At&&P(jt,"prev"),Kt===Xt&&P(jt,"next"))});else{const jt=mt[ct];if(jt&&jt.classList.add(...Ce.bulletActiveClass.split(" ")),n.isElement&&mt.forEach((Kt,dn)=>{Kt.setAttribute("part",dn===ct?"bullet-active":"bullet")}),Ce.dynamicBullets){const Kt=mt[At],dn=mt[Xt];for(let mn=At;mn<=Xt;mn+=1)mt[mn]&&mt[mn].classList.add(...`${Ce.bulletActiveClass}-main`.split(" "));P(Kt,"prev"),P(dn,"next")}}if(Ce.dynamicBullets){const jt=Math.min(mt.length,Ce.dynamicMainBullets+4),Kt=(f*jt-f)/2-Gt*f,dn=he?"right":"left";mt.forEach(mn=>{mn.style[n.isHorizontal()?dn:"top"]=`${Kt}px`})}}Ge.forEach((mt,At)=>{if("fraction"===Ce.type&&(mt.querySelectorAll(dm(Ce.currentClass)).forEach(Xt=>{Xt.textContent=Ce.formatFractionCurrent(ct+1)}),mt.querySelectorAll(dm(Ce.totalClass)).forEach(Xt=>{Xt.textContent=Ce.formatFractionTotal($t)})),"progressbar"===Ce.type){let Xt;Xt=Ce.progressbarOpposite?n.isHorizontal()?"vertical":"horizontal":n.isHorizontal()?"horizontal":"vertical";const Gt=(ct+1)/$t;let jt=1,Kt=1;"horizontal"===Xt?jt=Gt:Kt=Gt,mt.querySelectorAll(dm(Ce.progressbarFillClass)).forEach(dn=>{dn.style.transform=`translate3d(0,0,0) scaleX(${jt}) scaleY(${Kt})`,dn.style.transitionDuration=`${n.params.speed}ms`})}"custom"===Ce.type&&Ce.renderCustom?(mt.innerHTML=Ce.renderCustom(n,ct+1,$t),0===At&&r("paginationRender",mt)):(0===At&&r("paginationRender",mt),r("paginationUpdate",mt)),n.params.watchOverflow&&n.enabled&&mt.classList[n.isLocked?"add":"remove"](Ce.lockClass)})}function X(){const he=n.params.pagination;if(M())return;const Ce=n.virtual&&n.params.virtual.enabled?n.virtual.slides.length:n.grid&&n.params.grid.rows>1?n.slides.length/Math.ceil(n.params.grid.rows):n.slides.length;let Ge=n.pagination.el;Ge=Sr(Ge);let ct="";if("bullets"===he.type){let It=n.params.loop?Math.ceil(Ce/n.params.slidesPerGroup):n.snapGrid.length;n.params.freeMode&&n.params.freeMode.enabled&&It>Ce&&(It=Ce);for(let Pt=0;Pt<It;Pt+=1)ct+=he.renderBullet?he.renderBullet.call(n,Pt,he.bulletClass):`<${he.bulletElement} ${n.isElement?'part="bullet"':""} class="${he.bulletClass}"></${he.bulletElement}>`}"fraction"===he.type&&(ct=he.renderFraction?he.renderFraction.call(n,he.currentClass,he.totalClass):`<span class="${he.currentClass}"></span> / <span class="${he.totalClass}"></span>`),"progressbar"===he.type&&(ct=he.renderProgressbar?he.renderProgressbar.call(n,he.progressbarFillClass):`<span class="${he.progressbarFillClass}"></span>`),n.pagination.bullets=[],Ge.forEach(It=>{"custom"!==he.type&&(It.innerHTML=ct||""),"bullets"===he.type&&n.pagination.bullets.push(...It.querySelectorAll(dm(he.bulletClass)))}),"custom"!==he.type&&r("paginationRender",Ge[0])}function Y(){n.params.pagination=nO(n,n.originalParams.pagination,n.params.pagination,{el:"swiper-pagination"});const he=n.params.pagination;if(!he.el)return;let Ce;"string"==typeof he.el&&n.isElement&&(Ce=n.el.querySelector(he.el)),!Ce&&"string"==typeof he.el&&(Ce=[...document.querySelectorAll(he.el)]),Ce||(Ce=he.el),Ce&&0!==Ce.length&&(n.params.uniqueNavElements&&"string"==typeof he.el&&Array.isArray(Ce)&&Ce.length>1&&(Ce=[...n.el.querySelectorAll(he.el)],Ce.length>1&&(Ce=Ce.find(Ge=>uv(Ge,".swiper")[0]===n.el))),Array.isArray(Ce)&&1===Ce.length&&(Ce=Ce[0]),Object.assign(n.pagination,{el:Ce}),Ce=Sr(Ce),Ce.forEach(Ge=>{"bullets"===he.type&&he.clickable&&Ge.classList.add(...(he.clickableClass||"").split(" ")),Ge.classList.add(he.modifierClass+he.type),Ge.classList.add(n.isHorizontal()?he.horizontalClass:he.verticalClass),"bullets"===he.type&&he.dynamicBullets&&(Ge.classList.add(`${he.modifierClass}${he.type}-dynamic`),w=0,he.dynamicMainBullets<1&&(he.dynamicMainBullets=1)),"progressbar"===he.type&&he.progressbarOpposite&&Ge.classList.add(he.progressbarOppositeClass),he.clickable&&Ge.addEventListener("click",$),n.enabled||Ge.classList.add(he.lockClass)}))}function K(){const he=n.params.pagination;if(M())return;let Ce=n.pagination.el;Ce&&(Ce=Sr(Ce),Ce.forEach(Ge=>{Ge.classList.remove(he.hiddenClass),Ge.classList.remove(he.modifierClass+he.type),Ge.classList.remove(n.isHorizontal()?he.horizontalClass:he.verticalClass),he.clickable&&(Ge.classList.remove(...(he.clickableClass||"").split(" ")),Ge.removeEventListener("click",$))})),n.pagination.bullets&&n.pagination.bullets.forEach(Ge=>Ge.classList.remove(...he.bulletActiveClass.split(" ")))}i("changeDirection",()=>{if(!n.pagination||!n.pagination.el)return;const he=n.params.pagination;let{el:Ce}=n.pagination;Ce=Sr(Ce),Ce.forEach(Ge=>{Ge.classList.remove(he.horizontalClass,he.verticalClass),Ge.classList.add(n.isHorizontal()?he.horizontalClass:he.verticalClass)})}),i("init",()=>{!1===n.params.pagination.enabled?ye():(Y(),X(),Q())}),i("activeIndexChange",()=>{typeof n.snapIndex>"u"&&Q()}),i("snapIndexChange",()=>{Q()}),i("snapGridLengthChange",()=>{X(),Q()}),i("destroy",()=>{K()}),i("enable disable",()=>{let{el:he}=n.pagination;he&&(he=Sr(he),he.forEach(Ce=>Ce.classList[n.enabled?"remove":"add"](n.params.pagination.lockClass)))}),i("lock unlock",()=>{Q()}),i("click",(he,Ce)=>{const Ge=Ce.target,ct=Sr(n.pagination.el);if(n.params.pagination.el&&n.params.pagination.hideOnClick&&ct&&ct.length>0&&!Ge.classList.contains(n.params.pagination.bulletClass)){if(n.navigation&&(n.navigation.nextEl&&Ge===n.navigation.nextEl||n.navigation.prevEl&&Ge===n.navigation.prevEl))return;const It=ct[0].classList.contains(n.params.pagination.hiddenClass);r(!0===It?"paginationShow":"paginationHide"),ct.forEach(Pt=>Pt.classList.toggle(n.params.pagination.hiddenClass))}});const ye=()=>{n.el.classList.add(n.params.pagination.paginationDisabledClass);let{el:he}=n.pagination;he&&(he=Sr(he),he.forEach(Ce=>Ce.classList.add(n.params.pagination.paginationDisabledClass))),K()};Object.assign(n.pagination,{enable:()=>{n.el.classList.remove(n.params.pagination.paginationDisabledClass);let{el:he}=n.pagination;he&&(he=Sr(he),he.forEach(Ce=>Ce.classList.remove(n.params.pagination.paginationDisabledClass))),Y(),X(),Q()},disable:ye,render:X,update:Q,init:Y,destroy:K})},function Vce(t){let{swiper:n,extendParams:e,on:i,emit:r}=t;const l=Da();let P,L,$,Q,f=!1,w=null,M=null;function X(){if(!n.params.scrollbar.el||!n.scrollbar.el)return;const{scrollbar:Gt,rtlTranslate:jt}=n,{dragEl:Kt,el:dn}=Gt,mn=n.params.scrollbar;let Rt=L,Cn=($-L)*(n.params.loop?n.progressLoop:n.progress);jt?(Cn=-Cn,Cn>0?(Rt=L-Cn,Cn=0):-Cn+L>$&&(Rt=$+Cn)):Cn<0?(Rt=L+Cn,Cn=0):Cn+L>$&&(Rt=$-Cn),n.isHorizontal()?(Kt.style.transform=`translate3d(${Cn}px, 0, 0)`,Kt.style.width=`${Rt}px`):(Kt.style.transform=`translate3d(0px, ${Cn}px, 0)`,Kt.style.height=`${Rt}px`),mn.hide&&(clearTimeout(w),dn.style.opacity=1,w=setTimeout(()=>{dn.style.opacity=0,dn.style.transitionDuration="400ms"},1e3))}function K(){if(!n.params.scrollbar.el||!n.scrollbar.el)return;const{scrollbar:Gt}=n,{dragEl:jt,el:Kt}=Gt;jt.style.width="",jt.style.height="",$=n.isHorizontal()?Kt.offsetWidth:Kt.offsetHeight,Q=n.size/(n.virtualSize+n.params.slidesOffsetBefore-(n.params.centeredSlides?n.snapGrid[0]:0)),L="auto"===n.params.scrollbar.dragSize?$*Q:parseInt(n.params.scrollbar.dragSize,10),n.isHorizontal()?jt.style.width=`${L}px`:jt.style.height=`${L}px`,Kt.style.display=Q>=1?"none":"",n.params.scrollbar.hide&&(Kt.style.opacity=0),n.params.watchOverflow&&n.enabled&&Gt.el.classList[n.isLocked?"add":"remove"](n.params.scrollbar.lockClass)}function de(Gt){return n.isHorizontal()?Gt.clientX:Gt.clientY}function ye(Gt){const{scrollbar:jt,rtlTranslate:Kt}=n,{el:dn}=jt;let mn;mn=(de(Gt)-JT(dn)[n.isHorizontal()?"left":"top"]-(null!==P?P:L/2))/($-L),mn=Math.max(Math.min(mn,1),0),Kt&&(mn=1-mn);const St=n.minTranslate()+(n.maxTranslate()-n.minTranslate())*mn;n.updateProgress(St),n.setTranslate(St),n.updateActiveIndex(),n.updateSlidesClasses()}function he(Gt){const jt=n.params.scrollbar,{scrollbar:Kt,wrapperEl:dn}=n,{el:mn,dragEl:St}=Kt;f=!0,P=Gt.target===St?de(Gt)-Gt.target.getBoundingClientRect()[n.isHorizontal()?"left":"top"]:null,Gt.preventDefault(),Gt.stopPropagation(),dn.style.transitionDuration="100ms",St.style.transitionDuration="100ms",ye(Gt),clearTimeout(M),mn.style.transitionDuration="0ms",jt.hide&&(mn.style.opacity=1),n.params.cssMode&&(n.wrapperEl.style["scroll-snap-type"]="none"),r("scrollbarDragStart",Gt)}function Ce(Gt){const{scrollbar:jt,wrapperEl:Kt}=n,{el:dn,dragEl:mn}=jt;f&&(Gt.preventDefault&&Gt.cancelable?Gt.preventDefault():Gt.returnValue=!1,ye(Gt),Kt.style.transitionDuration="0ms",dn.style.transitionDuration="0ms",mn.style.transitionDuration="0ms",r("scrollbarDragMove",Gt))}function Ge(Gt){const jt=n.params.scrollbar,{scrollbar:Kt,wrapperEl:dn}=n,{el:mn}=Kt;f&&(f=!1,n.params.cssMode&&(n.wrapperEl.style["scroll-snap-type"]="",dn.style.transitionDuration=""),jt.hide&&(clearTimeout(M),M=cv(()=>{mn.style.opacity=0,mn.style.transitionDuration="400ms"},1e3)),r("scrollbarDragEnd",Gt),jt.snapOnRelease&&n.slideToClosest())}function ct(Gt){const{scrollbar:jt,params:Kt}=n,dn=jt.el;if(!dn)return;const St=!!Kt.passiveListeners&&{passive:!1,capture:!1},Rt=!!Kt.passiveListeners&&{passive:!0,capture:!1};if(!dn)return;const Cn="on"===Gt?"addEventListener":"removeEventListener";dn[Cn]("pointerdown",he,St),l[Cn]("pointermove",Ce,St),l[Cn]("pointerup",Ge,Rt)}function $t(){const{scrollbar:Gt,el:jt}=n;n.params.scrollbar=nO(n,n.originalParams.scrollbar,n.params.scrollbar,{el:"swiper-scrollbar"});const Kt=n.params.scrollbar;if(!Kt.el)return;let dn,mn;if("string"==typeof Kt.el&&n.isElement&&(dn=n.el.querySelector(Kt.el)),dn||"string"!=typeof Kt.el)dn||(dn=Kt.el);else if(dn=l.querySelectorAll(Kt.el),!dn.length)return;n.params.uniqueNavElements&&"string"==typeof Kt.el&&dn.length>1&&1===jt.querySelectorAll(Kt.el).length&&(dn=jt.querySelector(Kt.el)),dn.length>0&&(dn=dn[0]),dn.classList.add(n.isHorizontal()?Kt.horizontalClass:Kt.verticalClass),dn&&(mn=dn.querySelector(dm(n.params.scrollbar.dragClass)),mn||(mn=Od("div",n.params.scrollbar.dragClass),dn.append(mn))),Object.assign(Gt,{el:dn,dragEl:mn}),Kt.draggable&&function It(){!n.params.scrollbar.el||!n.scrollbar.el||ct("on")}(),dn&&dn.classList[n.enabled?"remove":"add"](...Xg(n.params.scrollbar.lockClass))}function mt(){const Gt=n.params.scrollbar,jt=n.scrollbar.el;jt&&jt.classList.remove(...Xg(n.isHorizontal()?Gt.horizontalClass:Gt.verticalClass)),function Pt(){!n.params.scrollbar.el||!n.scrollbar.el||ct("off")}()}e({scrollbar:{el:null,dragSize:"auto",hide:!1,draggable:!1,snapOnRelease:!0,lockClass:"swiper-scrollbar-lock",dragClass:"swiper-scrollbar-drag",scrollbarDisabledClass:"swiper-scrollbar-disabled",horizontalClass:"swiper-scrollbar-horizontal",verticalClass:"swiper-scrollbar-vertical"}}),n.scrollbar={el:null,dragEl:null},i("changeDirection",()=>{if(!n.scrollbar||!n.scrollbar.el)return;const Gt=n.params.scrollbar;let{el:jt}=n.scrollbar;jt=Sr(jt),jt.forEach(Kt=>{Kt.classList.remove(Gt.horizontalClass,Gt.verticalClass),Kt.classList.add(n.isHorizontal()?Gt.horizontalClass:Gt.verticalClass)})}),i("init",()=>{!1===n.params.scrollbar.enabled?Xt():($t(),K(),X())}),i("update resize observerUpdate lock unlock changeDirection",()=>{K()}),i("setTranslate",()=>{X()}),i("setTransition",(Gt,jt)=>{!function Y(Gt){!n.params.scrollbar.el||!n.scrollbar.el||(n.scrollbar.dragEl.style.transitionDuration=`${Gt}ms`)}(jt)}),i("enable disable",()=>{const{el:Gt}=n.scrollbar;Gt&&Gt.classList[n.enabled?"remove":"add"](...Xg(n.params.scrollbar.lockClass))}),i("destroy",()=>{mt()});const Xt=()=>{n.el.classList.add(...Xg(n.params.scrollbar.scrollbarDisabledClass)),n.scrollbar.el&&n.scrollbar.el.classList.add(...Xg(n.params.scrollbar.scrollbarDisabledClass)),mt()};Object.assign(n.scrollbar,{enable:()=>{n.el.classList.remove(...Xg(n.params.scrollbar.scrollbarDisabledClass)),n.scrollbar.el&&n.scrollbar.el.classList.remove(...Xg(n.params.scrollbar.scrollbarDisabledClass)),$t(),K(),X()},disable:Xt,updateSize:K,setTranslate:X,init:$t,destroy:mt})},function Uce(t){let{swiper:n,extendParams:e,on:i}=t;e({parallax:{enabled:!1}});const r="[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y], [data-swiper-parallax-opacity], [data-swiper-parallax-scale]",l=(M,P)=>{const{rtl:L}=n,$=L?-1:1,Q=M.getAttribute("data-swiper-parallax")||"0";let X=M.getAttribute("data-swiper-parallax-x"),Y=M.getAttribute("data-swiper-parallax-y");const K=M.getAttribute("data-swiper-parallax-scale"),de=M.getAttribute("data-swiper-parallax-opacity"),ye=M.getAttribute("data-swiper-parallax-rotate");if(X||Y?(X=X||"0",Y=Y||"0"):n.isHorizontal()?(X=Q,Y="0"):(Y=Q,X="0"),X=X.indexOf("%")>=0?parseInt(X,10)*P*$+"%":X*P*$+"px",Y=Y.indexOf("%")>=0?parseInt(Y,10)*P+"%":Y*P+"px",typeof de<"u"&&null!==de){const Ce=de-(de-1)*(1-Math.abs(P));M.style.opacity=Ce}let he=`translate3d(${X}, ${Y}, 0px)`;typeof K<"u"&&null!==K&&(he+=` scale(${K-(K-1)*(1-Math.abs(P))})`),ye&&typeof ye<"u"&&null!==ye&&(he+=` rotate(${ye*P*-1}deg)`),M.style.transform=he},f=()=>{const{el:M,slides:P,progress:L,snapGrid:$}=n,X=tl(M,r);n.isElement&&X.push(...tl(n.hostEl,r)),X.forEach(Y=>{l(Y,L)}),P.forEach((Y,K)=>{let de=Y.progress;n.params.slidesPerGroup>1&&"auto"!==n.params.slidesPerView&&(de+=Math.ceil(K/2)-L*($.length-1)),de=Math.min(Math.max(de,-1),1),Y.querySelectorAll(`${r}, [data-swiper-parallax-rotate]`).forEach(ye=>{l(ye,de)})})};i("beforeInit",()=>{n.params.parallax.enabled&&(n.params.watchSlidesProgress=!0,n.originalParams.watchSlidesProgress=!0)}),i("init",()=>{n.params.parallax.enabled&&f()}),i("setTranslate",()=>{n.params.parallax.enabled&&f()}),i("setTransition",(M,P)=>{n.params.parallax.enabled&&function(M){void 0===M&&(M=n.params.speed);const{el:P,hostEl:L}=n,$=[...P.querySelectorAll(r)];n.isElement&&$.push(...L.querySelectorAll(r)),$.forEach(Q=>{let X=parseInt(Q.getAttribute("data-swiper-parallax-duration"),10)||M;0===M&&(X=0),Q.style.transitionDuration=`${X}ms`})}(P)})},function jce(t){let{swiper:n,extendParams:e,on:i,emit:r}=t;const l=Wo();e({zoom:{enabled:!1,limitToOriginalSize:!1,maxRatio:3,minRatio:1,panOnMouseMove:!1,toggle:!0,containerClass:"swiper-zoom-container",zoomedSlideClass:"swiper-slide-zoomed"}}),n.zoom={enabled:!1};let $,Q,f=1,w=!1,M=!1,P={x:0,y:0};const X=[],Y={originX:0,originY:0,slideEl:void 0,slideWidth:void 0,slideHeight:void 0,imageEl:void 0,imageWrapEl:void 0,maxRatio:3},K={isTouched:void 0,isMoved:void 0,currentX:void 0,currentY:void 0,minX:void 0,minY:void 0,maxX:void 0,maxY:void 0,width:void 0,height:void 0,startX:void 0,startY:void 0,touchesStart:{},touchesCurrent:{}},de={x:void 0,y:void 0,prevPositionX:void 0,prevPositionY:void 0,prevTime:void 0};let Xt,ye=1;function he(){return X.length<2?1:Math.sqrt((X[1].pageX-X[0].pageX)**2+(X[1].pageY-X[0].pageY)**2)}function Ce(){const un=n.params.zoom,sn=Y.imageWrapEl.getAttribute("data-swiper-zoom")||un.maxRatio;return un.limitToOriginalSize&&Y.imageEl&&Y.imageEl.naturalWidth?Math.min(Y.imageEl.naturalWidth/Y.imageEl.offsetWidth,sn):sn}function It(un){const sn=function ct(){return n.isElement?"swiper-slide":`.${n.params.slideClass}`}();return!!(un.target.matches(sn)||n.slides.filter(yn=>yn.contains(un.target)).length>0)}function Pt(un){const sn=`.${n.params.zoom.containerClass}`;return!!(un.target.matches(sn)||[...n.hostEl.querySelectorAll(sn)].filter(yn=>yn.contains(un.target)).length>0)}function $t(un){if("mouse"===un.pointerType&&X.splice(0,X.length),!It(un))return;const sn=n.params.zoom;if($=!1,Q=!1,X.push(un),!(X.length<2)){if($=!0,Y.scaleStart=he(),!Y.slideEl){Y.slideEl=un.target.closest(`.${n.params.slideClass}, swiper-slide`),Y.slideEl||(Y.slideEl=n.slides[n.activeIndex]);let yn=Y.slideEl.querySelector(`.${sn.containerClass}`);if(yn&&(yn=yn.querySelectorAll("picture, img, svg, canvas, .swiper-zoom-target")[0]),Y.imageEl=yn,Y.imageWrapEl=yn?uv(Y.imageEl,`.${sn.containerClass}`)[0]:void 0,!Y.imageWrapEl)return void(Y.imageEl=void 0);Y.maxRatio=Ce()}if(Y.imageEl){const[yn,Fr]=function Ge(){if(X.length<2)return{x:null,y:null};const un=Y.imageEl.getBoundingClientRect();return[(X[0].pageX+(X[1].pageX-X[0].pageX)/2-un.x-l.scrollX)/f,(X[0].pageY+(X[1].pageY-X[0].pageY)/2-un.y-l.scrollY)/f]}();Y.originX=yn,Y.originY=Fr,Y.imageEl.style.transitionDuration="0ms"}w=!0}}function mt(un){if(!It(un))return;const sn=n.params.zoom,yn=n.zoom,Fr=X.findIndex(Ol=>Ol.pointerId===un.pointerId);Fr>=0&&(X[Fr]=un),!(X.length<2)&&(Q=!0,Y.scaleMove=he(),Y.imageEl&&(yn.scale=Y.scaleMove/Y.scaleStart*f,yn.scale>Y.maxRatio&&(yn.scale=Y.maxRatio-1+(yn.scale-Y.maxRatio+1)**.5),yn.scale<sn.minRatio&&(yn.scale=sn.minRatio+1-(sn.minRatio-yn.scale+1)**.5),Y.imageEl.style.transform=`translate3d(0,0,0) scale(${yn.scale})`))}function At(un){if(!It(un)||"mouse"===un.pointerType&&"pointerout"===un.type)return;const sn=n.params.zoom,yn=n.zoom,Fr=X.findIndex(Ol=>Ol.pointerId===un.pointerId);Fr>=0&&X.splice(Fr,1),$&&Q&&($=!1,Q=!1,Y.imageEl&&(yn.scale=Math.max(Math.min(yn.scale,Y.maxRatio),sn.minRatio),Y.imageEl.style.transitionDuration=`${n.params.speed}ms`,Y.imageEl.style.transform=`translate3d(0,0,0) scale(${yn.scale})`,f=yn.scale,w=!1,yn.scale>1&&Y.slideEl?Y.slideEl.classList.add(`${sn.zoomedSlideClass}`):yn.scale<=1&&Y.slideEl&&Y.slideEl.classList.remove(`${sn.zoomedSlideClass}`),1===yn.scale&&(Y.originX=0,Y.originY=0,Y.slideEl=void 0)))}function Gt(){n.touchEventsData.preventTouchMoveFromPointerMove=!1}function dn(un){const yn="mouse"===un.pointerType&&n.params.zoom.panOnMouseMove;if(!It(un)||!Pt(un))return;const Fr=n.zoom;if(!Y.imageEl)return;if(!K.isTouched||!Y.slideEl)return void(yn&&Rt(un));if(yn)return void Rt(un);K.isMoved||(K.width=Y.imageEl.offsetWidth||Y.imageEl.clientWidth,K.height=Y.imageEl.offsetHeight||Y.imageEl.clientHeight,K.startX=GP(Y.imageWrapEl,"x")||0,K.startY=GP(Y.imageWrapEl,"y")||0,Y.slideWidth=Y.slideEl.offsetWidth,Y.slideHeight=Y.slideEl.offsetHeight,Y.imageWrapEl.style.transitionDuration="0ms");const Qg=K.height*Fr.scale;if(K.minX=Math.min(Y.slideWidth/2-K.width*Fr.scale/2,0),K.maxX=-K.minX,K.minY=Math.min(Y.slideHeight/2-Qg/2,0),K.maxY=-K.minY,K.touchesCurrent.x=X.length>0?X[0].pageX:un.pageX,K.touchesCurrent.y=X.length>0?X[0].pageY:un.pageY,Math.max(Math.abs(K.touchesCurrent.x-K.touchesStart.x),Math.abs(K.touchesCurrent.y-K.touchesStart.y))>5&&(n.allowClick=!1),!K.isMoved&&!w){if(n.isHorizontal()&&(Math.floor(K.minX)===Math.floor(K.startX)&&K.touchesCurrent.x<K.touchesStart.x||Math.floor(K.maxX)===Math.floor(K.startX)&&K.touchesCurrent.x>K.touchesStart.x))return K.isTouched=!1,void Gt();if(!n.isHorizontal()&&(Math.floor(K.minY)===Math.floor(K.startY)&&K.touchesCurrent.y<K.touchesStart.y||Math.floor(K.maxY)===Math.floor(K.startY)&&K.touchesCurrent.y>K.touchesStart.y))return K.isTouched=!1,void Gt()}un.cancelable&&un.preventDefault(),un.stopPropagation(),function jt(){clearTimeout(Xt),n.touchEventsData.preventTouchMoveFromPointerMove=!0,Xt=setTimeout(()=>{n.destroyed||Gt()})}(),K.isMoved=!0;const um=(Fr.scale-f)/(Y.maxRatio-n.params.zoom.minRatio),{originX:e_,originY:Fl}=Y;K.currentX=K.touchesCurrent.x-K.touchesStart.x+K.startX+um*(K.width-2*e_),K.currentY=K.touchesCurrent.y-K.touchesStart.y+K.startY+um*(K.height-2*Fl),K.currentX<K.minX&&(K.currentX=K.minX+1-(K.minX-K.currentX+1)**.8),K.currentX>K.maxX&&(K.currentX=K.maxX-1+(K.currentX-K.maxX+1)**.8),K.currentY<K.minY&&(K.currentY=K.minY+1-(K.minY-K.currentY+1)**.8),K.currentY>K.maxY&&(K.currentY=K.maxY-1+(K.currentY-K.maxY+1)**.8),de.prevPositionX||(de.prevPositionX=K.touchesCurrent.x),de.prevPositionY||(de.prevPositionY=K.touchesCurrent.y),de.prevTime||(de.prevTime=Date.now()),de.x=(K.touchesCurrent.x-de.prevPositionX)/(Date.now()-de.prevTime)/2,de.y=(K.touchesCurrent.y-de.prevPositionY)/(Date.now()-de.prevTime)/2,Math.abs(K.touchesCurrent.x-de.prevPositionX)<2&&(de.x=0),Math.abs(K.touchesCurrent.y-de.prevPositionY)<2&&(de.y=0),de.prevPositionX=K.touchesCurrent.x,de.prevPositionY=K.touchesCurrent.y,de.prevTime=Date.now(),Y.imageWrapEl.style.transform=`translate3d(${K.currentX}px, ${K.currentY}px,0)`}function St(){const un=n.zoom;Y.slideEl&&n.activeIndex!==n.slides.indexOf(Y.slideEl)&&(Y.imageEl&&(Y.imageEl.style.transform="translate3d(0,0,0) scale(1)"),Y.imageWrapEl&&(Y.imageWrapEl.style.transform="translate3d(0,0,0)"),Y.slideEl.classList.remove(`${n.params.zoom.zoomedSlideClass}`),un.scale=1,f=1,Y.slideEl=void 0,Y.imageEl=void 0,Y.imageWrapEl=void 0,Y.originX=0,Y.originY=0)}function Rt(un){if(f<=1||!Y.imageWrapEl||!It(un)||!Pt(un))return;const sn=l.getComputedStyle(Y.imageWrapEl).transform,yn=new l.DOMMatrix(sn);if(!M)return M=!0,P.x=un.clientX,P.y=un.clientY,K.startX=yn.e,K.startY=yn.f,K.width=Y.imageEl.offsetWidth||Y.imageEl.clientWidth,K.height=Y.imageEl.offsetHeight||Y.imageEl.clientHeight,Y.slideWidth=Y.slideEl.offsetWidth,void(Y.slideHeight=Y.slideEl.offsetHeight);const Fr=-3*(un.clientX-P.x),Ol=-3*(un.clientY-P.y),Jg=K.height*f,e_=Y.slideHeight,Fl=Math.min(Y.slideWidth/2-K.width*f/2,0),Rh=-Fl,vE=Math.min(e_/2-Jg/2,0),oI=-vE,fx=Math.max(Math.min(K.startX+Fr,Rh),Fl),mx=Math.max(Math.min(K.startY+Ol,oI),vE);Y.imageWrapEl.style.transitionDuration="0ms",Y.imageWrapEl.style.transform=`translate3d(${fx}px, ${mx}px, 0)`,P.x=un.clientX,P.y=un.clientY,K.startX=fx,K.startY=mx,K.currentX=fx,K.currentY=mx}function Cn(un){const sn=n.zoom,yn=n.params.zoom;if(!Y.slideEl){un&&un.target&&(Y.slideEl=un.target.closest(`.${n.params.slideClass}, swiper-slide`)),Y.slideEl||(Y.slideEl=n.params.virtual&&n.params.virtual.enabled&&n.virtual?tl(n.slidesEl,`.${n.params.slideActiveClass}`)[0]:n.slides[n.activeIndex]);let bE=Y.slideEl.querySelector(`.${yn.containerClass}`);bE&&(bE=bE.querySelectorAll("picture, img, svg, canvas, .swiper-zoom-target")[0]),Y.imageEl=bE,Y.imageWrapEl=bE?uv(Y.imageEl,`.${yn.containerClass}`)[0]:void 0}if(!Y.imageEl||!Y.imageWrapEl)return;let Fr,Ol,Qg,Jg,um,e_,Fl,Rh,vE,oI,fx,mx,sI,aI,rO,oO,sO,aO;n.params.cssMode&&(n.wrapperEl.style.overflow="hidden",n.wrapperEl.style.touchAction="none"),Y.slideEl.classList.add(`${yn.zoomedSlideClass}`),typeof K.touchesStart.x>"u"&&un?(Fr=un.pageX,Ol=un.pageY):(Fr=K.touchesStart.x,Ol=K.touchesStart.y);const lO=f,gx="number"==typeof un?un:null;1===f&&gx&&(Fr=void 0,Ol=void 0,K.touchesStart.x=void 0,K.touchesStart.y=void 0);const JU=Ce();sn.scale=gx||JU,f=gx||JU,!un||1===f&&gx?(Fl=0,Rh=0):(sO=Y.slideEl.offsetWidth,aO=Y.slideEl.offsetHeight,Qg=JT(Y.slideEl).left+l.scrollX,Jg=JT(Y.slideEl).top+l.scrollY,um=Qg+sO/2-Fr,e_=Jg+aO/2-Ol,vE=Y.imageEl.offsetWidth||Y.imageEl.clientWidth,oI=Y.imageEl.offsetHeight||Y.imageEl.clientHeight,fx=vE*sn.scale,mx=oI*sn.scale,sI=Math.min(sO/2-fx/2,0),aI=Math.min(aO/2-mx/2,0),rO=-sI,oO=-aI,lO>0&&gx&&"number"==typeof K.currentX&&"number"==typeof K.currentY?(Fl=K.currentX*sn.scale/lO,Rh=K.currentY*sn.scale/lO):(Fl=um*sn.scale,Rh=e_*sn.scale),Fl<sI&&(Fl=sI),Fl>rO&&(Fl=rO),Rh<aI&&(Rh=aI),Rh>oO&&(Rh=oO)),gx&&1===sn.scale&&(Y.originX=0,Y.originY=0),K.currentX=Fl,K.currentY=Rh,Y.imageWrapEl.style.transitionDuration="300ms",Y.imageWrapEl.style.transform=`translate3d(${Fl}px, ${Rh}px,0)`,Y.imageEl.style.transitionDuration="300ms",Y.imageEl.style.transform=`translate3d(0,0,0) scale(${sn.scale})`}function pr(){const un=n.zoom,sn=n.params.zoom;if(!Y.slideEl){Y.slideEl=n.params.virtual&&n.params.virtual.enabled&&n.virtual?tl(n.slidesEl,`.${n.params.slideActiveClass}`)[0]:n.slides[n.activeIndex];let yn=Y.slideEl.querySelector(`.${sn.containerClass}`);yn&&(yn=yn.querySelectorAll("picture, img, svg, canvas, .swiper-zoom-target")[0]),Y.imageEl=yn,Y.imageWrapEl=yn?uv(Y.imageEl,`.${sn.containerClass}`)[0]:void 0}!Y.imageEl||!Y.imageWrapEl||(n.params.cssMode&&(n.wrapperEl.style.overflow="",n.wrapperEl.style.touchAction=""),un.scale=1,f=1,K.currentX=void 0,K.currentY=void 0,K.touchesStart.x=void 0,K.touchesStart.y=void 0,Y.imageWrapEl.style.transitionDuration="300ms",Y.imageWrapEl.style.transform="translate3d(0,0,0)",Y.imageEl.style.transitionDuration="300ms",Y.imageEl.style.transform="translate3d(0,0,0) scale(1)",Y.slideEl.classList.remove(`${sn.zoomedSlideClass}`),Y.slideEl=void 0,Y.originX=0,Y.originY=0,n.params.zoom.panOnMouseMove&&(P={x:0,y:0},M&&(M=!1,K.startX=0,K.startY=0)))}function as(un){const sn=n.zoom;sn.scale&&1!==sn.scale?pr():Cn(un)}function Ma(){return{passiveListener:!!n.params.passiveListeners&&{passive:!0,capture:!1},activeListenerWithCapture:!n.params.passiveListeners||{passive:!1,capture:!0}}}function $p(){const un=n.zoom;if(un.enabled)return;un.enabled=!0;const{passiveListener:sn,activeListenerWithCapture:yn}=Ma();n.wrapperEl.addEventListener("pointerdown",$t,sn),n.wrapperEl.addEventListener("pointermove",mt,yn),["pointerup","pointercancel","pointerout"].forEach(Fr=>{n.wrapperEl.addEventListener(Fr,At,sn)}),n.wrapperEl.addEventListener("pointermove",dn,yn)}function yE(){const un=n.zoom;if(!un.enabled)return;un.enabled=!1;const{passiveListener:sn,activeListenerWithCapture:yn}=Ma();n.wrapperEl.removeEventListener("pointerdown",$t,sn),n.wrapperEl.removeEventListener("pointermove",mt,yn),["pointerup","pointercancel","pointerout"].forEach(Fr=>{n.wrapperEl.removeEventListener(Fr,At,sn)}),n.wrapperEl.removeEventListener("pointermove",dn,yn)}Object.defineProperty(n.zoom,"scale",{get:()=>ye,set(un){ye!==un&&r("zoomChange",un,Y.imageEl,Y.slideEl),ye=un}}),i("init",()=>{n.params.zoom.enabled&&$p()}),i("destroy",()=>{yE()}),i("touchStart",(un,sn)=>{n.zoom.enabled&&function Kt(un){if(!Y.imageEl||K.isTouched)return;n.device.android&&un.cancelable&&un.preventDefault(),K.isTouched=!0;const yn=X.length>0?X[0]:un;K.touchesStart.x=yn.pageX,K.touchesStart.y=yn.pageY}(sn)}),i("touchEnd",(un,sn)=>{n.zoom.enabled&&function mn(){const un=n.zoom;if(X.length=0,!Y.imageEl)return;if(!K.isTouched||!K.isMoved)return K.isTouched=!1,void(K.isMoved=!1);K.isTouched=!1,K.isMoved=!1;let sn=300,yn=300;const Ol=K.currentX+de.x*sn,Jg=K.currentY+de.y*yn;0!==de.x&&(sn=Math.abs((Ol-K.currentX)/de.x)),0!==de.y&&(yn=Math.abs((Jg-K.currentY)/de.y));const um=Math.max(sn,yn);K.currentX=Ol,K.currentY=Jg;const Fl=K.height*un.scale;K.minX=Math.min(Y.slideWidth/2-K.width*un.scale/2,0),K.maxX=-K.minX,K.minY=Math.min(Y.slideHeight/2-Fl/2,0),K.maxY=-K.minY,K.currentX=Math.max(Math.min(K.currentX,K.maxX),K.minX),K.currentY=Math.max(Math.min(K.currentY,K.maxY),K.minY),Y.imageWrapEl.style.transitionDuration=`${um}ms`,Y.imageWrapEl.style.transform=`translate3d(${K.currentX}px, ${K.currentY}px,0)`}()}),i("doubleTap",(un,sn)=>{!n.animating&&n.params.zoom.enabled&&n.zoom.enabled&&n.params.zoom.toggle&&as(sn)}),i("transitionEnd",()=>{n.zoom.enabled&&n.params.zoom.enabled&&St()}),i("slideChange",()=>{n.zoom.enabled&&n.params.zoom.enabled&&n.params.cssMode&&St()}),Object.assign(n.zoom,{enable:$p,disable:yE,in:Cn,out:pr,toggle:as})},function Hce(t){let{swiper:n,extendParams:e,on:i}=t;function r(P,L){const $=function(){let K,de,ye;return(he,Ce)=>{for(de=-1,K=he.length;K-de>1;)ye=K+de>>1,he[ye]<=Ce?de=ye:K=ye;return K}}();let Q,X;return this.x=P,this.y=L,this.lastIndex=P.length-1,this.interpolate=function(K){return K?(X=$(this.x,K),Q=X-1,(K-this.x[Q])*(this.y[X]-this.y[Q])/(this.x[X]-this.x[Q])+this.y[Q]):0},this}function M(){n.controller.control&&n.controller.spline&&(n.controller.spline=void 0,delete n.controller.spline)}e({controller:{control:void 0,inverse:!1,by:"slide"}}),n.controller={control:void 0},i("beforeInit",()=>{typeof window<"u"&&("string"==typeof n.params.controller.control||n.params.controller.control instanceof HTMLElement)?("string"==typeof n.params.controller.control?[...document.querySelectorAll(n.params.controller.control)]:[n.params.controller.control]).forEach(L=>{if(n.controller.control||(n.controller.control=[]),L&&L.swiper)n.controller.control.push(L.swiper);else if(L){const $=`${n.params.eventsPrefix}init`,Q=X=>{n.controller.control.push(X.detail[0]),n.update(),L.removeEventListener($,Q)};L.addEventListener($,Q)}}):n.controller.control=n.params.controller.control}),i("update",()=>{M()}),i("resize",()=>{M()}),i("observerUpdate",()=>{M()}),i("setTranslate",(P,L,$)=>{!n.controller.control||n.controller.control.destroyed||n.controller.setTranslate(L,$)}),i("setTransition",(P,L,$)=>{!n.controller.control||n.controller.control.destroyed||n.controller.setTransition(L,$)}),Object.assign(n.controller,{setTranslate:function f(P,L){const $=n.controller.control;let Q,X;const Y=n.constructor;function K(de){if(de.destroyed)return;const ye=n.rtlTranslate?-n.translate:n.translate;"slide"===n.params.controller.by&&(function l(P){n.controller.spline=n.params.loop?new r(n.slidesGrid,P.slidesGrid):new r(n.snapGrid,P.snapGrid)}(de),X=-n.controller.spline.interpolate(-ye)),(!X||"container"===n.params.controller.by)&&(Q=(de.maxTranslate()-de.minTranslate())/(n.maxTranslate()-n.minTranslate()),(Number.isNaN(Q)||!Number.isFinite(Q))&&(Q=1),X=(ye-n.minTranslate())*Q+de.minTranslate()),n.params.controller.inverse&&(X=de.maxTranslate()-X),de.updateProgress(X),de.setTranslate(X,n),de.updateActiveIndex(),de.updateSlidesClasses()}if(Array.isArray($))for(let de=0;de<$.length;de+=1)$[de]!==L&&$[de]instanceof Y&&K($[de]);else $ instanceof Y&&L!==$&&K($)},setTransition:function w(P,L){const $=n.constructor,Q=n.controller.control;let X;function Y(K){K.destroyed||(K.setTransition(P,n),0!==P&&(K.transitionStart(),K.params.autoHeight&&cv(()=>{K.updateAutoHeight()}),gE(K.wrapperEl,()=>{Q&&K.transitionEnd()})))}if(Array.isArray(Q))for(X=0;X<Q.length;X+=1)Q[X]!==L&&Q[X]instanceof $&&Y(Q[X]);else Q instanceof $&&L!==Q&&Y(Q)}})},function $ce(t){let{swiper:n,extendParams:e,on:i}=t;e({a11y:{enabled:!0,notificationClass:"swiper-notification",prevSlideMessage:"Previous slide",nextSlideMessage:"Next slide",firstSlideMessage:"This is the first slide",lastSlideMessage:"This is the last slide",paginationBulletMessage:"Go to slide {{index}}",slideLabelMessage:"{{index}} / {{slidesLength}}",containerMessage:null,containerRoleDescriptionMessage:null,containerRole:null,itemRoleDescriptionMessage:null,slideRole:"group",id:null,scrollOnFocus:!0}}),n.a11y={clicked:!1};let l,f,r=null,w=(new Date).getTime();function M(St){const Rt=r;0!==Rt.length&&(Rt.innerHTML="",Rt.innerHTML=St)}function L(St){(St=Sr(St)).forEach(Rt=>{Rt.setAttribute("tabIndex","0")})}function $(St){(St=Sr(St)).forEach(Rt=>{Rt.setAttribute("tabIndex","-1")})}function Q(St,Rt){(St=Sr(St)).forEach(Cn=>{Cn.setAttribute("role",Rt)})}function X(St,Rt){(St=Sr(St)).forEach(Cn=>{Cn.setAttribute("aria-roledescription",Rt)})}function K(St,Rt){(St=Sr(St)).forEach(Cn=>{Cn.setAttribute("aria-label",Rt)})}function he(St){(St=Sr(St)).forEach(Rt=>{Rt.setAttribute("aria-disabled",!0)})}function Ce(St){(St=Sr(St)).forEach(Rt=>{Rt.setAttribute("aria-disabled",!1)})}function Ge(St){if(13!==St.keyCode&&32!==St.keyCode)return;const Rt=n.params.a11y,Cn=St.target;if(!n.pagination||!n.pagination.el||Cn!==n.pagination.el&&!n.pagination.el.contains(St.target)||St.target.matches(dm(n.params.pagination.bulletClass))){if(n.navigation&&n.navigation.prevEl&&n.navigation.nextEl){const pr=Sr(n.navigation.prevEl);Sr(n.navigation.nextEl).includes(Cn)&&(n.isEnd&&!n.params.loop||n.slideNext(),M(n.isEnd?Rt.lastSlideMessage:Rt.nextSlideMessage)),pr.includes(Cn)&&(n.isBeginning&&!n.params.loop||n.slidePrev(),M(n.isBeginning?Rt.firstSlideMessage:Rt.prevSlideMessage))}n.pagination&&Cn.matches(dm(n.params.pagination.bulletClass))&&Cn.click()}}function It(){return n.pagination&&n.pagination.bullets&&n.pagination.bullets.length}function Pt(){return It()&&n.params.pagination.clickable}const mt=(St,Rt,Cn)=>{L(St),"BUTTON"!==St.tagName&&(Q(St,"button"),St.addEventListener("keydown",Ge)),K(St,Cn),function Y(St,Rt){(St=Sr(St)).forEach(Cn=>{Cn.setAttribute("aria-controls",Rt)})}(St,Rt)},At=St=>{f&&f!==St.target&&!f.contains(St.target)&&(l=!0),n.a11y.clicked=!0},Xt=()=>{l=!1,requestAnimationFrame(()=>{requestAnimationFrame(()=>{n.destroyed||(n.a11y.clicked=!1)})})},Gt=St=>{w=(new Date).getTime()},jt=St=>{if(n.a11y.clicked||!n.params.a11y.scrollOnFocus||(new Date).getTime()-w<100)return;const Rt=St.target.closest(`.${n.params.slideClass}, swiper-slide`);if(!Rt||!n.slides.includes(Rt))return;f=Rt;const Cn=n.slides.indexOf(Rt)===n.activeIndex,pr=n.params.watchSlidesProgress&&n.visibleSlides&&n.visibleSlides.includes(Rt);Cn||pr||St.sourceCapabilities&&St.sourceCapabilities.firesTouchEvents||(n.isHorizontal()?n.el.scrollLeft=0:n.el.scrollTop=0,requestAnimationFrame(()=>{l||(n.params.loop?n.slideToLoop(parseInt(Rt.getAttribute("data-swiper-slide-index")),0):n.slideTo(n.slides.indexOf(Rt),0),l=!1)}))},Kt=()=>{const St=n.params.a11y;St.itemRoleDescriptionMessage&&X(n.slides,St.itemRoleDescriptionMessage),St.slideRole&&Q(n.slides,St.slideRole);const Rt=n.slides.length;St.slideLabelMessage&&n.slides.forEach((Cn,pr)=>{const as=n.params.loop?parseInt(Cn.getAttribute("data-swiper-slide-index"),10):pr;K(Cn,St.slideLabelMessage.replace(/\{\{index\}\}/,as+1).replace(/\{\{slidesLength\}\}/,Rt))})};i("beforeInit",()=>{r=Od("span",n.params.a11y.notificationClass),r.setAttribute("aria-live","assertive"),r.setAttribute("aria-atomic","true")}),i("afterInit",()=>{n.params.a11y.enabled&&(()=>{const St=n.params.a11y;n.el.append(r);const Rt=n.el;St.containerRoleDescriptionMessage&&X(Rt,St.containerRoleDescriptionMessage),St.containerMessage&&K(Rt,St.containerMessage),St.containerRole&&Q(Rt,St.containerRole);const Cn=n.wrapperEl,pr=St.id||Cn.getAttribute("id")||`swiper-wrapper-${function P(St){return void 0===St&&(St=16),"x".repeat(St).replace(/x/g,()=>Math.round(16*Math.random()).toString(16))}(16)}`,as=n.params.autoplay&&n.params.autoplay.enabled?"off":"polite";(function de(St,Rt){(St=Sr(St)).forEach(Cn=>{Cn.setAttribute("id",Rt)})})(Cn,pr),function ye(St,Rt){(St=Sr(St)).forEach(Cn=>{Cn.setAttribute("aria-live",Rt)})}(Cn,as),Kt();let{nextEl:Ma,prevEl:$p}=n.navigation?n.navigation:{};Ma=Sr(Ma),$p=Sr($p),Ma&&Ma.forEach(un=>mt(un,pr,St.nextSlideMessage)),$p&&$p.forEach(un=>mt(un,pr,St.prevSlideMessage)),Pt()&&Sr(n.pagination.el).forEach(sn=>{sn.addEventListener("keydown",Ge)}),Da().addEventListener("visibilitychange",Gt),n.el.addEventListener("focus",jt,!0),n.el.addEventListener("focus",jt,!0),n.el.addEventListener("pointerdown",At,!0),n.el.addEventListener("pointerup",Xt,!0)})()}),i("slidesLengthChange snapGridLengthChange slidesGridLengthChange",()=>{n.params.a11y.enabled&&Kt()}),i("fromEdge toEdge afterInit lock unlock",()=>{n.params.a11y.enabled&&function ct(){if(n.params.loop||n.params.rewind||!n.navigation)return;const{nextEl:St,prevEl:Rt}=n.navigation;Rt&&(n.isBeginning?(he(Rt),$(Rt)):(Ce(Rt),L(Rt))),St&&(n.isEnd?(he(St),$(St)):(Ce(St),L(St)))}()}),i("paginationUpdate",()=>{n.params.a11y.enabled&&function $t(){const St=n.params.a11y;It()&&n.pagination.bullets.forEach(Rt=>{n.params.pagination.clickable&&(L(Rt),n.params.pagination.renderBullet||(Q(Rt,"button"),K(Rt,St.paginationBulletMessage.replace(/\{\{index\}\}/,mE(Rt)+1)))),Rt.matches(dm(n.params.pagination.bulletActiveClass))?Rt.setAttribute("aria-current","true"):Rt.removeAttribute("aria-current")})}()}),i("destroy",()=>{n.params.a11y.enabled&&function mn(){r&&r.remove();let{nextEl:St,prevEl:Rt}=n.navigation?n.navigation:{};St=Sr(St),Rt=Sr(Rt),St&&St.forEach(pr=>pr.removeEventListener("keydown",Ge)),Rt&&Rt.forEach(pr=>pr.removeEventListener("keydown",Ge)),Pt()&&Sr(n.pagination.el).forEach(as=>{as.removeEventListener("keydown",Ge)}),Da().removeEventListener("visibilitychange",Gt),n.el&&"string"!=typeof n.el&&(n.el.removeEventListener("focus",jt,!0),n.el.removeEventListener("pointerdown",At,!0),n.el.removeEventListener("pointerup",Xt,!0))}()})},function Gce(t){let{swiper:n,extendParams:e,on:i}=t;e({history:{enabled:!1,root:"",replaceState:!1,key:"slides",keepQuery:!1}});let r=!1,l={};const f=X=>X.toString().replace(/\s+/g,"-").replace(/[^\w-]+/g,"").replace(/--+/g,"-").replace(/^-+/,"").replace(/-+$/,""),w=X=>{const Y=Wo();let K;K=X?new URL(X):Y.location;const de=K.pathname.slice(1).split("/").filter(Ge=>""!==Ge),ye=de.length;return{key:de[ye-2],value:de[ye-1]}},M=(X,Y)=>{const K=Wo();if(!r||!n.params.history.enabled)return;let de;de=n.params.url?new URL(n.params.url):K.location;const ye=n.virtual&&n.params.virtual.enabled?n.slidesEl.querySelector(`[data-swiper-slide-index="${Y}"]`):n.slides[Y];let he=f(ye.getAttribute("data-history"));if(n.params.history.root.length>0){let Ge=n.params.history.root;"/"===Ge[Ge.length-1]&&(Ge=Ge.slice(0,Ge.length-1)),he=`${Ge}/${X?`${X}/`:""}${he}`}else de.pathname.includes(X)||(he=`${X?`${X}/`:""}${he}`);n.params.history.keepQuery&&(he+=de.search);const Ce=K.history.state;Ce&&Ce.value===he||(n.params.history.replaceState?K.history.replaceState({value:he},null,he):K.history.pushState({value:he},null,he))},P=(X,Y,K)=>{if(Y)for(let de=0,ye=n.slides.length;de<ye;de+=1){const he=n.slides[de];if(f(he.getAttribute("data-history"))===Y){const Ge=n.getSlideIndex(he);n.slideTo(Ge,X,K)}}else n.slideTo(0,X,K)},L=()=>{l=w(n.params.url),P(n.params.speed,l.value,!1)};i("init",()=>{n.params.history.enabled&&(()=>{const X=Wo();if(n.params.history){if(!X.history||!X.history.pushState)return n.params.history.enabled=!1,void(n.params.hashNavigation.enabled=!0);if(r=!0,l=w(n.params.url),!l.key&&!l.value)return void(n.params.history.replaceState||X.addEventListener("popstate",L));P(0,l.value,n.params.runCallbacksOnInit),n.params.history.replaceState||X.addEventListener("popstate",L)}})()}),i("destroy",()=>{n.params.history.enabled&&(()=>{const X=Wo();n.params.history.replaceState||X.removeEventListener("popstate",L)})()}),i("transitionEnd _freeModeNoMomentumRelease",()=>{r&&M(n.params.history.key,n.activeIndex)}),i("slideChange",()=>{r&&n.params.cssMode&&M(n.params.history.key,n.activeIndex)})},function qce(t){let{swiper:n,extendParams:e,emit:i,on:r}=t,l=!1;const f=Da(),w=Wo();e({hashNavigation:{enabled:!1,replaceState:!1,watchState:!1,getSlideIndex(Q,X){if(n.virtual&&n.params.virtual.enabled){const Y=n.slides.find(de=>de.getAttribute("data-hash")===X);return Y?parseInt(Y.getAttribute("data-swiper-slide-index"),10):0}return n.getSlideIndex(tl(n.slidesEl,`.${n.params.slideClass}[data-hash="${X}"], swiper-slide[data-hash="${X}"]`)[0])}}});const M=()=>{i("hashChange");const Q=f.location.hash.replace("#",""),X=n.virtual&&n.params.virtual.enabled?n.slidesEl.querySelector(`[data-swiper-slide-index="${n.activeIndex}"]`):n.slides[n.activeIndex];if(Q!==(X?X.getAttribute("data-hash"):"")){const K=n.params.hashNavigation.getSlideIndex(n,Q);if(typeof K>"u"||Number.isNaN(K))return;n.slideTo(K)}},P=()=>{if(!l||!n.params.hashNavigation.enabled)return;const Q=n.virtual&&n.params.virtual.enabled?n.slidesEl.querySelector(`[data-swiper-slide-index="${n.activeIndex}"]`):n.slides[n.activeIndex],X=Q?Q.getAttribute("data-hash")||Q.getAttribute("data-history"):"";n.params.hashNavigation.replaceState&&w.history&&w.history.replaceState?(w.history.replaceState(null,null,`#${X}`||""),i("hashSet")):(f.location.hash=X||"",i("hashSet"))};r("init",()=>{n.params.hashNavigation.enabled&&(()=>{if(!n.params.hashNavigation.enabled||n.params.history&&n.params.history.enabled)return;l=!0;const Q=f.location.hash.replace("#","");if(Q){const Y=n.params.hashNavigation.getSlideIndex(n,Q);n.slideTo(Y||0,0,n.params.runCallbacksOnInit,!0)}n.params.hashNavigation.watchState&&w.addEventListener("hashchange",M)})()}),r("destroy",()=>{n.params.hashNavigation.enabled&&n.params.hashNavigation.watchState&&w.removeEventListener("hashchange",M)}),r("transitionEnd _freeModeNoMomentumRelease",()=>{l&&P()}),r("slideChange",()=>{l&&n.params.cssMode&&P()})},function Wce(t){let{swiper:n,extendParams:e,on:i,emit:r,params:l}=t;n.autoplay={running:!1,paused:!1,timeLeft:0},e({autoplay:{enabled:!1,delay:3e3,waitForTransition:!0,disableOnInteraction:!1,stopOnLastSlide:!1,reverseDirection:!1,pauseOnMouseEnter:!1}});let f,w,L,Q,X,Y,K,de,ye,he,M=l&&l.autoplay?l.autoplay.delay:3e3,P=l&&l.autoplay?l.autoplay.delay:3e3,$=(new Date).getTime();function Ce(Rt){!n||n.destroyed||!n.wrapperEl||Rt.target===n.wrapperEl&&(n.wrapperEl.removeEventListener("transitionend",Ce),!(he||Rt.detail&&Rt.detail.bySwiperTouchMove)&&At())}const Ge=()=>{if(n.destroyed||!n.autoplay.running)return;n.autoplay.paused?Q=!0:Q&&(P=L,Q=!1);const Rt=n.autoplay.paused?L:$+P-(new Date).getTime();n.autoplay.timeLeft=Rt,r("autoplayTimeLeft",Rt,Rt/M),w=requestAnimationFrame(()=>{Ge()})},It=Rt=>{if(n.destroyed||!n.autoplay.running)return;cancelAnimationFrame(w),Ge();let Cn=typeof Rt>"u"?n.params.autoplay.delay:Rt;M=n.params.autoplay.delay,P=n.params.autoplay.delay;const pr=(()=>{let Rt;return Rt=n.virtual&&n.params.virtual.enabled?n.slides.find(pr=>pr.classList.contains("swiper-slide-active")):n.slides[n.activeIndex],Rt?parseInt(Rt.getAttribute("data-swiper-autoplay"),10):void 0})();!Number.isNaN(pr)&&pr>0&&typeof Rt>"u"&&(Cn=pr,M=pr,P=pr),L=Cn;const as=n.params.speed,Ma=()=>{!n||n.destroyed||(n.params.autoplay.reverseDirection?!n.isBeginning||n.params.loop||n.params.rewind?(n.slidePrev(as,!0,!0),r("autoplay")):n.params.autoplay.stopOnLastSlide||(n.slideTo(n.slides.length-1,as,!0,!0),r("autoplay")):!n.isEnd||n.params.loop||n.params.rewind?(n.slideNext(as,!0,!0),r("autoplay")):n.params.autoplay.stopOnLastSlide||(n.slideTo(0,as,!0,!0),r("autoplay")),n.params.cssMode&&($=(new Date).getTime(),requestAnimationFrame(()=>{It()})))};return Cn>0?(clearTimeout(f),f=setTimeout(()=>{Ma()},Cn)):requestAnimationFrame(()=>{Ma()}),Cn},Pt=()=>{$=(new Date).getTime(),n.autoplay.running=!0,It(),r("autoplayStart")},$t=()=>{n.autoplay.running=!1,clearTimeout(f),cancelAnimationFrame(w),r("autoplayStop")},mt=(Rt,Cn)=>{if(n.destroyed||!n.autoplay.running)return;clearTimeout(f),Rt||(ye=!0);const pr=()=>{r("autoplayPause"),n.params.autoplay.waitForTransition?n.wrapperEl.addEventListener("transitionend",Ce):At()};if(n.autoplay.paused=!0,Cn)return de&&(L=n.params.autoplay.delay),de=!1,void pr();L=(L||n.params.autoplay.delay)-((new Date).getTime()-$),(!(n.isEnd&&L<0)||n.params.loop)&&(L<0&&(L=0),pr())},At=()=>{n.isEnd&&L<0&&!n.params.loop||n.destroyed||!n.autoplay.running||($=(new Date).getTime(),ye?(ye=!1,It(L)):It(),n.autoplay.paused=!1,r("autoplayResume"))},Xt=()=>{if(n.destroyed||!n.autoplay.running)return;const Rt=Da();"hidden"===Rt.visibilityState&&(ye=!0,mt(!0)),"visible"===Rt.visibilityState&&At()},Gt=Rt=>{"mouse"===Rt.pointerType&&(ye=!0,he=!0,!n.animating&&!n.autoplay.paused&&mt(!0))},jt=Rt=>{"mouse"===Rt.pointerType&&(he=!1,n.autoplay.paused&&At())};i("init",()=>{n.params.autoplay.enabled&&(n.params.autoplay.pauseOnMouseEnter&&(n.el.addEventListener("pointerenter",Gt),n.el.addEventListener("pointerleave",jt)),Da().addEventListener("visibilitychange",Xt),Pt())}),i("destroy",()=>{n.el&&"string"!=typeof n.el&&(n.el.removeEventListener("pointerenter",Gt),n.el.removeEventListener("pointerleave",jt)),Da().removeEventListener("visibilitychange",Xt),n.autoplay.running&&$t()}),i("_freeModeStaticRelease",()=>{(Y||ye)&&At()}),i("_freeModeNoMomentumRelease",()=>{n.params.autoplay.disableOnInteraction?$t():mt(!0,!0)}),i("beforeTransitionStart",(Rt,Cn,pr)=>{n.destroyed||!n.autoplay.running||(pr||!n.params.autoplay.disableOnInteraction?mt(!0,!0):$t())}),i("sliderFirstMove",()=>{if(!n.destroyed&&n.autoplay.running){if(n.params.autoplay.disableOnInteraction)return void $t();X=!0,Y=!1,ye=!1,K=setTimeout(()=>{ye=!0,Y=!0,mt(!0)},200)}}),i("touchEnd",()=>{if(!n.destroyed&&n.autoplay.running&&X){if(clearTimeout(K),clearTimeout(f),n.params.autoplay.disableOnInteraction)return Y=!1,void(X=!1);Y&&n.params.cssMode&&At(),Y=!1,X=!1}}),i("slideChange",()=>{n.destroyed||!n.autoplay.running||(de=!0)}),Object.assign(n.autoplay,{start:Pt,stop:$t,pause:mt,resume:At})},function Yce(t){let{swiper:n,extendParams:e,on:i}=t;e({thumbs:{swiper:null,multipleActiveThumbs:!0,autoScrollOffset:0,slideThumbActiveClass:"swiper-slide-thumb-active",thumbsContainerClass:"swiper-thumbs"}});let r=!1,l=!1;function f(){const P=n.thumbs.swiper;if(!P||P.destroyed)return;const L=P.clickedIndex,$=P.clickedSlide;if($&&$.classList.contains(n.params.thumbs.slideThumbActiveClass)||typeof L>"u"||null===L)return;let Q;Q=P.params.loop?parseInt(P.clickedSlide.getAttribute("data-swiper-slide-index"),10):L,n.params.loop?n.slideToLoop(Q):n.slideTo(Q)}function w(){const{thumbs:P}=n.params;if(r)return!1;r=!0;const L=n.constructor;if(P.swiper instanceof L){if(P.swiper.destroyed)return r=!1,!1;n.thumbs.swiper=P.swiper,Object.assign(n.thumbs.swiper.originalParams,{watchSlidesProgress:!0,slideToClickedSlide:!1}),Object.assign(n.thumbs.swiper.params,{watchSlidesProgress:!0,slideToClickedSlide:!1}),n.thumbs.swiper.update()}else if(pE(P.swiper)){const $=Object.assign({},P.swiper);Object.assign($,{watchSlidesProgress:!0,slideToClickedSlide:!1}),n.thumbs.swiper=new L($),l=!0}return n.thumbs.swiper.el.classList.add(n.params.thumbs.thumbsContainerClass),n.thumbs.swiper.on("tap",f),!0}function M(P){const L=n.thumbs.swiper;if(!L||L.destroyed)return;const $="auto"===L.params.slidesPerView?L.slidesPerViewDynamic():L.params.slidesPerView;let Q=1;const X=n.params.thumbs.slideThumbActiveClass;if(n.params.slidesPerView>1&&!n.params.centeredSlides&&(Q=n.params.slidesPerView),n.params.thumbs.multipleActiveThumbs||(Q=1),Q=Math.floor(Q),L.slides.forEach(de=>de.classList.remove(X)),L.params.loop||L.params.virtual&&L.params.virtual.enabled)for(let de=0;de<Q;de+=1)tl(L.slidesEl,`[data-swiper-slide-index="${n.realIndex+de}"]`).forEach(ye=>{ye.classList.add(X)});else for(let de=0;de<Q;de+=1)L.slides[n.realIndex+de]&&L.slides[n.realIndex+de].classList.add(X);const Y=n.params.thumbs.autoScrollOffset,K=Y&&!L.params.loop;if(n.realIndex!==L.realIndex||K){const de=L.activeIndex;let ye,he;if(L.params.loop){const Ce=L.slides.find(Ge=>Ge.getAttribute("data-swiper-slide-index")===`${n.realIndex}`);ye=L.slides.indexOf(Ce),he=n.activeIndex>n.previousIndex?"next":"prev"}else ye=n.realIndex,he=ye>n.previousIndex?"next":"prev";K&&(ye+="next"===he?Y:-1*Y),L.visibleSlidesIndexes&&L.visibleSlidesIndexes.indexOf(ye)<0&&(L.params.centeredSlides&&(ye=ye>de?ye-Math.floor($/2)+1:ye+Math.floor($/2)-1),L.slideTo(ye,P?0:void 0))}}n.thumbs={swiper:null},i("beforeInit",()=>{const{thumbs:P}=n.params;if(P&&P.swiper)if("string"==typeof P.swiper||P.swiper instanceof HTMLElement){const L=Da(),$=()=>{const X="string"==typeof P.swiper?L.querySelector(P.swiper):P.swiper;if(X&&X.swiper)P.swiper=X.swiper,w(),M(!0);else if(X){const Y=`${n.params.eventsPrefix}init`,K=de=>{P.swiper=de.detail[0],X.removeEventListener(Y,K),w(),M(!0),P.swiper.update(),n.update()};X.addEventListener(Y,K)}return X},Q=()=>{n.destroyed||$()||requestAnimationFrame(Q)};requestAnimationFrame(Q)}else w(),M(!0)}),i("slideChange update resize observerUpdate",()=>{M()}),i("setTransition",(P,L)=>{const $=n.thumbs.swiper;!$||$.destroyed||$.setTransition(L)}),i("beforeDestroy",()=>{const P=n.thumbs.swiper;!P||P.destroyed||l&&P.destroy()}),Object.assign(n.thumbs,{init:w,update:M})},function Zce(t){let{swiper:n,extendParams:e,emit:i,once:r}=t;e({freeMode:{enabled:!1,momentum:!0,momentumRatio:1,momentumBounce:!0,momentumBounceRatio:1,momentumVelocityRatio:1,sticky:!1,minimumVelocity:.02}}),Object.assign(n,{freeMode:{onTouchStart:function l(){if(n.params.cssMode)return;const M=n.getTranslate();n.setTranslate(M),n.setTransition(0),n.touchEventsData.velocities.length=0,n.freeMode.onTouchEnd({currentPos:n.rtl?n.translate:-n.translate})},onTouchMove:function f(){if(n.params.cssMode)return;const{touchEventsData:M,touches:P}=n;0===M.velocities.length&&M.velocities.push({position:P[n.isHorizontal()?"startX":"startY"],time:M.touchStartTime}),M.velocities.push({position:P[n.isHorizontal()?"currentX":"currentY"],time:Tu()})},onTouchEnd:function w(M){let{currentPos:P}=M;if(n.params.cssMode)return;const{params:L,wrapperEl:$,rtlTranslate:Q,snapGrid:X,touchEventsData:Y}=n,de=Tu()-Y.touchStartTime;if(P<-n.minTranslate())n.slideTo(n.activeIndex);else if(P>-n.maxTranslate())n.slideTo(n.slides.length<X.length?X.length-1:n.slides.length-1);else{if(L.freeMode.momentum){if(Y.velocities.length>1){const $t=Y.velocities.pop(),mt=Y.velocities.pop(),Xt=$t.time-mt.time;n.velocity=($t.position-mt.position)/Xt,n.velocity/=2,Math.abs(n.velocity)<L.freeMode.minimumVelocity&&(n.velocity=0),(Xt>150||Tu()-$t.time>300)&&(n.velocity=0)}else n.velocity=0;n.velocity*=L.freeMode.momentumVelocityRatio,Y.velocities.length=0;let ye=1e3*L.freeMode.momentumRatio,Ce=n.translate+n.velocity*ye;Q&&(Ce=-Ce);let ct,Ge=!1;const It=20*Math.abs(n.velocity)*L.freeMode.momentumBounceRatio;let Pt;if(Ce<n.maxTranslate())L.freeMode.momentumBounce?(Ce+n.maxTranslate()<-It&&(Ce=n.maxTranslate()-It),ct=n.maxTranslate(),Ge=!0,Y.allowMomentumBounce=!0):Ce=n.maxTranslate(),L.loop&&L.centeredSlides&&(Pt=!0);else if(Ce>n.minTranslate())L.freeMode.momentumBounce?(Ce-n.minTranslate()>It&&(Ce=n.minTranslate()+It),ct=n.minTranslate(),Ge=!0,Y.allowMomentumBounce=!0):Ce=n.minTranslate(),L.loop&&L.centeredSlides&&(Pt=!0);else if(L.freeMode.sticky){let $t;for(let mt=0;mt<X.length;mt+=1)if(X[mt]>-Ce){$t=mt;break}Ce=Math.abs(X[$t]-Ce)<Math.abs(X[$t-1]-Ce)||"next"===n.swipeDirection?X[$t]:X[$t-1],Ce=-Ce}if(Pt&&r("transitionEnd",()=>{n.loopFix()}),0!==n.velocity){if(ye=Q?Math.abs((-Ce-n.translate)/n.velocity):Math.abs((Ce-n.translate)/n.velocity),L.freeMode.sticky){const $t=Math.abs((Q?-Ce:Ce)-n.translate),mt=n.slidesSizesGrid[n.activeIndex];ye=$t<mt?L.speed:$t<2*mt?1.5*L.speed:2.5*L.speed}}else if(L.freeMode.sticky)return void n.slideToClosest();L.freeMode.momentumBounce&&Ge?(n.updateProgress(ct),n.setTransition(ye),n.setTranslate(Ce),n.transitionStart(!0,n.swipeDirection),n.animating=!0,gE($,()=>{!n||n.destroyed||!Y.allowMomentumBounce||(i("momentumBounce"),n.setTransition(L.speed),setTimeout(()=>{n.setTranslate(ct),gE($,()=>{!n||n.destroyed||n.transitionEnd()})},0))})):n.velocity?(i("_freeModeNoMomentumRelease"),n.updateProgress(Ce),n.setTransition(ye),n.setTranslate(Ce),n.transitionStart(!0,n.swipeDirection),n.animating||(n.animating=!0,gE($,()=>{!n||n.destroyed||n.transitionEnd()}))):n.updateProgress(Ce),n.updateActiveIndex(),n.updateSlidesClasses()}else{if(L.freeMode.sticky)return void n.slideToClosest();L.freeMode&&i("_freeModeNoMomentumRelease")}(!L.freeMode.momentum||de>=L.longSwipesMs)&&(i("_freeModeStaticRelease"),n.updateProgress(),n.updateActiveIndex(),n.updateSlidesClasses())}}}})},function Xce(t){let r,l,f,w,{swiper:n,extendParams:e,on:i}=t;e({grid:{rows:1,fill:"column"}});const M=()=>{let K=n.params.spaceBetween;return"string"==typeof K&&K.indexOf("%")>=0?K=parseFloat(K.replace("%",""))/100*n.size:"string"==typeof K&&(K=parseFloat(K)),K};i("init",()=>{w=n.params.grid&&n.params.grid.rows>1}),i("update",()=>{const{params:K,el:de}=n,ye=K.grid&&K.grid.rows>1;w&&!ye?(de.classList.remove(`${K.containerModifierClass}grid`,`${K.containerModifierClass}grid-column`),f=1,n.emitContainerClasses()):!w&&ye&&(de.classList.add(`${K.containerModifierClass}grid`),"column"===K.grid.fill&&de.classList.add(`${K.containerModifierClass}grid-column`),n.emitContainerClasses()),w=ye}),n.grid={initSlides:K=>{const{slidesPerView:de}=n.params,{rows:ye,fill:he}=n.params.grid,Ce=n.virtual&&n.params.virtual.enabled?n.virtual.slides.length:K.length;f=Math.floor(Ce/ye),r=Math.floor(Ce/ye)===Ce/ye?Ce:Math.ceil(Ce/ye)*ye,"auto"!==de&&"row"===he&&(r=Math.max(r,de*ye)),l=r/ye},unsetSlides:()=>{n.slides&&n.slides.forEach(K=>{K.swiperSlideGridSet&&(K.style.height="",K.style[n.getDirectionLabel("margin-top")]="")})},updateSlide:(K,de,ye)=>{const{slidesPerGroup:he}=n.params,Ce=M(),{rows:Ge,fill:ct}=n.params.grid,It=n.virtual&&n.params.virtual.enabled?n.virtual.slides.length:ye.length;let Pt,$t,mt;if("row"===ct&&he>1){const At=Math.floor(K/(he*Ge)),Xt=K-Ge*he*At,Gt=0===At?he:Math.min(Math.ceil((It-At*Ge*he)/Ge),he);mt=Math.floor(Xt/Gt),$t=Xt-mt*Gt+At*he,Pt=$t+mt*r/Ge,de.style.order=Pt}else"column"===ct?($t=Math.floor(K/Ge),mt=K-$t*Ge,($t>f||$t===f&&mt===Ge-1)&&(mt+=1,mt>=Ge&&(mt=0,$t+=1))):(mt=Math.floor(K/l),$t=K-mt*l);de.row=mt,de.column=$t,de.style.height=`calc((100% - ${(Ge-1)*Ce}px) / ${Ge})`,de.style[n.getDirectionLabel("margin-top")]=0!==mt?Ce&&`${Ce}px`:"",de.swiperSlideGridSet=!0},updateWrapperSize:(K,de)=>{const{centeredSlides:ye,roundLengths:he}=n.params,Ce=M(),{rows:Ge}=n.params.grid;if(n.virtualSize=(K+Ce)*r,n.virtualSize=Math.ceil(n.virtualSize/Ge)-Ce,n.params.cssMode||(n.wrapperEl.style[n.getDirectionLabel("width")]=`${n.virtualSize+Ce}px`),ye){const ct=[];for(let It=0;It<de.length;It+=1){let Pt=de[It];he&&(Pt=Math.floor(Pt)),de[It]<n.virtualSize+de[0]&&ct.push(Pt)}de.splice(0,de.length),de.push(...ct)}}}},function nde(t){let{swiper:n}=t;Object.assign(n,{appendSlide:Kce.bind(n),prependSlide:Qce.bind(n),addSlide:Jce.bind(n),removeSlide:ede.bind(n),removeAllSlides:tde.bind(n)})},function ide(t){let{swiper:n,extendParams:e,on:i}=t;e({fadeEffect:{crossFade:!1}}),ux({effect:"fade",swiper:n,on:i,setTranslate:()=>{const{slides:f}=n;for(let M=0;M<f.length;M+=1){const P=n.slides[M];let $=-P.swiperSlideOffset;n.params.virtualTranslate||($-=n.translate);let Q=0;n.isHorizontal()||(Q=$,$=0);const X=n.params.fadeEffect.crossFade?Math.max(1-Math.abs(P.progress),0):1+Math.min(Math.max(P.progress,-1),0),Y=_E(0,P);Y.style.opacity=X,Y.style.transform=`translate3d(${$}px, ${Q}px, 0px)`}},setTransition:f=>{const w=n.slides.map(M=>dv(M));w.forEach(M=>{M.style.transitionDuration=`${f}ms`}),nI({swiper:n,duration:f,transformElements:w,allSlides:!0})},overwriteParams:()=>({slidesPerView:1,slidesPerGroup:1,watchSlidesProgress:!0,spaceBetween:0,virtualTranslate:!n.params.cssMode})})},function rde(t){let{swiper:n,extendParams:e,on:i}=t;e({cubeEffect:{slideShadows:!0,shadow:!0,shadowOffset:20,shadowScale:.94}});const r=(M,P,L)=>{let $=M.querySelector(L?".swiper-slide-shadow-left":".swiper-slide-shadow-top"),Q=M.querySelector(L?".swiper-slide-shadow-right":".swiper-slide-shadow-bottom");$||($=Od("div",("swiper-slide-shadow-cube swiper-slide-shadow-"+(L?"left":"top")).split(" ")),M.append($)),Q||(Q=Od("div",("swiper-slide-shadow-cube swiper-slide-shadow-"+(L?"right":"bottom")).split(" ")),M.append(Q)),$&&($.style.opacity=Math.max(-P,0)),Q&&(Q.style.opacity=Math.max(P,0))};ux({effect:"cube",swiper:n,on:i,setTranslate:()=>{const{el:M,wrapperEl:P,slides:L,width:$,height:Q,rtlTranslate:X,size:Y,browser:K}=n,de=eI(n),ye=n.params.cubeEffect,he=n.isHorizontal(),Ce=n.virtual&&n.params.virtual.enabled;let ct,Ge=0;ye.shadow&&(he?(ct=n.wrapperEl.querySelector(".swiper-cube-shadow"),ct||(ct=Od("div","swiper-cube-shadow"),n.wrapperEl.append(ct)),ct.style.height=`${$}px`):(ct=M.querySelector(".swiper-cube-shadow"),ct||(ct=Od("div","swiper-cube-shadow"),M.append(ct))));for(let Pt=0;Pt<L.length;Pt+=1){const $t=L[Pt];let mt=Pt;Ce&&(mt=parseInt($t.getAttribute("data-swiper-slide-index"),10));let At=90*mt,Xt=Math.floor(At/360);X&&(At=-At,Xt=Math.floor(-At/360));const Gt=Math.max(Math.min($t.progress,1),-1);let jt=0,Kt=0,dn=0;mt%4==0?(jt=4*-Xt*Y,dn=0):(mt-1)%4==0?(jt=0,dn=4*-Xt*Y):(mt-2)%4==0?(jt=Y+4*Xt*Y,dn=Y):(mt-3)%4==0&&(jt=-Y,dn=3*Y+4*Y*Xt),X&&(jt=-jt),he||(Kt=jt,jt=0);const mn=`rotateX(${de(he?0:-At)}deg) rotateY(${de(he?At:0)}deg) translate3d(${jt}px, ${Kt}px, ${dn}px)`;Gt<=1&&Gt>-1&&(Ge=90*mt+90*Gt,X&&(Ge=90*-mt-90*Gt)),$t.style.transform=mn,ye.slideShadows&&r($t,Gt,he)}if(P.style.transformOrigin=`50% 50% -${Y/2}px`,P.style["-webkit-transform-origin"]=`50% 50% -${Y/2}px`,ye.shadow)if(he)ct.style.transform=`translate3d(0px, ${$/2+ye.shadowOffset}px, ${-$/2}px) rotateX(89.99deg) rotateZ(0deg) scale(${ye.shadowScale})`;else{const Pt=Math.abs(Ge)-90*Math.floor(Math.abs(Ge)/90),$t=1.5-(Math.sin(2*Pt*Math.PI/360)/2+Math.cos(2*Pt*Math.PI/360)/2),At=ye.shadowScale/$t;ct.style.transform=`scale3d(${ye.shadowScale}, 1, ${At}) translate3d(0px, ${Q/2+ye.shadowOffset}px, ${-Q/2/At}px) rotateX(-89.99deg)`}const It=(K.isSafari||K.isWebView)&&K.needPerspectiveFix?-Y/2:0;P.style.transform=`translate3d(0px,0,${It}px) rotateX(${de(n.isHorizontal()?0:Ge)}deg) rotateY(${de(n.isHorizontal()?-Ge:0)}deg)`,P.style.setProperty("--swiper-cube-translate-z",`${It}px`)},setTransition:M=>{const{el:P,slides:L}=n;if(L.forEach($=>{$.style.transitionDuration=`${M}ms`,$.querySelectorAll(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").forEach(Q=>{Q.style.transitionDuration=`${M}ms`})}),n.params.cubeEffect.shadow&&!n.isHorizontal()){const $=P.querySelector(".swiper-cube-shadow");$&&($.style.transitionDuration=`${M}ms`)}},recreateShadows:()=>{const M=n.isHorizontal();n.slides.forEach(P=>{const L=Math.max(Math.min(P.progress,1),-1);r(P,L,M)})},getEffectParams:()=>n.params.cubeEffect,perspective:()=>!0,overwriteParams:()=>({slidesPerView:1,slidesPerGroup:1,watchSlidesProgress:!0,resistanceRatio:0,spaceBetween:0,centeredSlides:!1,virtualTranslate:!0})})},function ode(t){let{swiper:n,extendParams:e,on:i}=t;e({flipEffect:{slideShadows:!0,limitRotation:!0}});const r=(M,P)=>{let L=n.isHorizontal()?M.querySelector(".swiper-slide-shadow-left"):M.querySelector(".swiper-slide-shadow-top"),$=n.isHorizontal()?M.querySelector(".swiper-slide-shadow-right"):M.querySelector(".swiper-slide-shadow-bottom");L||(L=hx("flip",M,n.isHorizontal()?"left":"top")),$||($=hx("flip",M,n.isHorizontal()?"right":"bottom")),L&&(L.style.opacity=Math.max(-P,0)),$&&($.style.opacity=Math.max(P,0))};ux({effect:"flip",swiper:n,on:i,setTranslate:()=>{const{slides:M,rtlTranslate:P}=n,L=n.params.flipEffect,$=eI(n);for(let Q=0;Q<M.length;Q+=1){const X=M[Q];let Y=X.progress;n.params.flipEffect.limitRotation&&(Y=Math.max(Math.min(X.progress,1),-1));const K=X.swiperSlideOffset;let ye=-180*Y,he=0,Ce=n.params.cssMode?-K-n.translate:-K,Ge=0;n.isHorizontal()?P&&(ye=-ye):(Ge=Ce,Ce=0,he=-ye,ye=0),X.style.zIndex=-Math.abs(Math.round(Y))+M.length,L.slideShadows&&r(X,Y);const ct=`translate3d(${Ce}px, ${Ge}px, 0px) rotateX(${$(he)}deg) rotateY(${$(ye)}deg)`;_E(0,X).style.transform=ct}},setTransition:M=>{const P=n.slides.map(L=>dv(L));P.forEach(L=>{L.style.transitionDuration=`${M}ms`,L.querySelectorAll(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").forEach($=>{$.style.transitionDuration=`${M}ms`})}),nI({swiper:n,duration:M,transformElements:P})},recreateShadows:()=>{n.slides.forEach(M=>{let P=M.progress;n.params.flipEffect.limitRotation&&(P=Math.max(Math.min(M.progress,1),-1)),r(M,P)})},getEffectParams:()=>n.params.flipEffect,perspective:()=>!0,overwriteParams:()=>({slidesPerView:1,slidesPerGroup:1,watchSlidesProgress:!0,spaceBetween:0,virtualTranslate:!n.params.cssMode})})},function sde(t){let{swiper:n,extendParams:e,on:i}=t;e({coverflowEffect:{rotate:50,stretch:0,depth:100,scale:1,modifier:1,slideShadows:!0}}),ux({effect:"coverflow",swiper:n,on:i,setTranslate:()=>{const{width:f,height:w,slides:M,slidesSizesGrid:P}=n,L=n.params.coverflowEffect,$=n.isHorizontal(),Q=n.translate,X=$?f/2-Q:w/2-Q,Y=$?L.rotate:-L.rotate,K=L.depth,de=eI(n);for(let ye=0,he=M.length;ye<he;ye+=1){const Ce=M[ye],Ge=P[ye],It=(X-Ce.swiperSlideOffset-Ge/2)/Ge,Pt="function"==typeof L.modifier?L.modifier(It):It*L.modifier;let $t=$?Y*Pt:0,mt=$?0:Y*Pt,At=-K*Math.abs(Pt),Xt=L.stretch;"string"==typeof Xt&&-1!==Xt.indexOf("%")&&(Xt=parseFloat(L.stretch)/100*Ge);let Gt=$?0:Xt*Pt,jt=$?Xt*Pt:0,Kt=1-(1-L.scale)*Math.abs(Pt);Math.abs(jt)<.001&&(jt=0),Math.abs(Gt)<.001&&(Gt=0),Math.abs(At)<.001&&(At=0),Math.abs($t)<.001&&($t=0),Math.abs(mt)<.001&&(mt=0),Math.abs(Kt)<.001&&(Kt=0);const dn=`translate3d(${jt}px,${Gt}px,${At}px)  rotateX(${de(mt)}deg) rotateY(${de($t)}deg) scale(${Kt})`;if(_E(0,Ce).style.transform=dn,Ce.style.zIndex=1-Math.abs(Math.round(Pt)),L.slideShadows){let St=Ce.querySelector($?".swiper-slide-shadow-left":".swiper-slide-shadow-top"),Rt=Ce.querySelector($?".swiper-slide-shadow-right":".swiper-slide-shadow-bottom");St||(St=hx("coverflow",Ce,$?"left":"top")),Rt||(Rt=hx("coverflow",Ce,$?"right":"bottom")),St&&(St.style.opacity=Pt>0?Pt:0),Rt&&(Rt.style.opacity=-Pt>0?-Pt:0)}}},setTransition:f=>{n.slides.map(M=>dv(M)).forEach(M=>{M.style.transitionDuration=`${f}ms`,M.querySelectorAll(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").forEach(P=>{P.style.transitionDuration=`${f}ms`})})},perspective:()=>!0,overwriteParams:()=>({watchSlidesProgress:!0})})},function ade(t){let{swiper:n,extendParams:e,on:i}=t;e({creativeEffect:{limitProgress:1,shadowPerProgress:!1,progressMultiplier:1,perspective:!0,prev:{translate:[0,0,0],rotate:[0,0,0],opacity:1,scale:1},next:{translate:[0,0,0],rotate:[0,0,0],opacity:1,scale:1}}});const r=w=>"string"==typeof w?w:`${w}px`;ux({effect:"creative",swiper:n,on:i,setTranslate:()=>{const{slides:w,wrapperEl:M,slidesSizesGrid:P}=n,L=n.params.creativeEffect,{progressMultiplier:$}=L,Q=n.params.centeredSlides,X=eI(n);Q&&(M.style.transform=`translateX(calc(50% - ${P[0]/2-n.params.slidesOffsetBefore||0}px))`);for(let Y=0;Y<w.length;Y+=1){const K=w[Y],de=K.progress,ye=Math.min(Math.max(K.progress,-L.limitProgress),L.limitProgress);let he=ye;Q||(he=Math.min(Math.max(K.originalProgress,-L.limitProgress),L.limitProgress));const Ce=K.swiperSlideOffset,Ge=[n.params.cssMode?-Ce-n.translate:-Ce,0,0],ct=[0,0,0];let It=!1;n.isHorizontal()||(Ge[1]=Ge[0],Ge[0]=0);let Pt={translate:[0,0,0],rotate:[0,0,0],scale:1,opacity:1};ye<0?(Pt=L.next,It=!0):ye>0&&(Pt=L.prev,It=!0),Ge.forEach((Kt,dn)=>{Ge[dn]=`calc(${Kt}px + (${r(Pt.translate[dn])} * ${Math.abs(ye*$)}))`}),ct.forEach((Kt,dn)=>{let mn=Pt.rotate[dn]*Math.abs(ye*$);ct[dn]=mn}),K.style.zIndex=-Math.abs(Math.round(de))+w.length;const $t=Ge.join(", "),mt=`rotateX(${X(ct[0])}deg) rotateY(${X(ct[1])}deg) rotateZ(${X(ct[2])}deg)`,Xt=he<0?1+(1-Pt.opacity)*he*$:1-(1-Pt.opacity)*he*$,Gt=`translate3d(${$t}) ${mt} ${he<0?`scale(${1+(1-Pt.scale)*he*$})`:`scale(${1-(1-Pt.scale)*he*$})`}`;if(It&&Pt.shadow||!It){let Kt=K.querySelector(".swiper-slide-shadow");!Kt&&Pt.shadow&&(Kt=hx("creative",K)),Kt&&(Kt.style.opacity=Math.min(Math.max(Math.abs(L.shadowPerProgress?ye*(1/L.limitProgress):ye),0),1))}const jt=_E(0,K);jt.style.transform=Gt,jt.style.opacity=Xt,Pt.origin&&(jt.style.transformOrigin=Pt.origin)}},setTransition:w=>{const M=n.slides.map(P=>dv(P));M.forEach(P=>{P.style.transitionDuration=`${w}ms`,P.querySelectorAll(".swiper-slide-shadow").forEach(L=>{L.style.transitionDuration=`${w}ms`})}),nI({swiper:n,duration:w,transformElements:M,allSlides:!0})},perspective:()=>n.params.creativeEffect.perspective,overwriteParams:()=>({watchSlidesProgress:!0,virtualTranslate:!n.params.cssMode})})},function lde(t){let{swiper:n,extendParams:e,on:i}=t;e({cardsEffect:{slideShadows:!0,rotate:!0,perSlideRotate:2,perSlideOffset:8}}),ux({effect:"cards",swiper:n,on:i,setTranslate:()=>{const{slides:f,activeIndex:w,rtlTranslate:M}=n,P=n.params.cardsEffect,{startTranslate:L,isTouched:$}=n.touchEventsData,Q=M?-n.translate:n.translate;for(let X=0;X<f.length;X+=1){const Y=f[X],K=Y.progress,de=Math.min(Math.max(K,-4),4);let ye=Y.swiperSlideOffset;n.params.centeredSlides&&!n.params.cssMode&&(n.wrapperEl.style.transform=`translateX(${n.minTranslate()}px)`),n.params.centeredSlides&&n.params.cssMode&&(ye-=f[0].swiperSlideOffset);let he=n.params.cssMode?-ye-n.translate:-ye,Ce=0;const Ge=-100*Math.abs(de);let ct=1,It=-P.perSlideRotate*de,Pt=P.perSlideOffset-.75*Math.abs(de);const $t=n.virtual&&n.params.virtual.enabled?n.virtual.from+X:X;if(($t===w||$t===w-1)&&de>0&&de<1&&($||n.params.cssMode)&&Q<L||($t===w||$t===w+1)&&de<0&&de>-1&&($||n.params.cssMode)&&Q>L){const Kt=(1-Math.abs((Math.abs(de)-.5)/.5))**.5;It+=-28*de*Kt,ct+=-.5*Kt,Pt+=96*Kt,Ce=-25*Kt*Math.abs(de)+"%"}if(he=de<0?`calc(${he}px ${M?"-":"+"} (${Pt*Math.abs(de)}%))`:de>0?`calc(${he}px ${M?"-":"+"} (-${Pt*Math.abs(de)}%))`:`${he}px`,!n.isHorizontal()){const Kt=Ce;Ce=he,he=Kt}const Gt=`\n        translate3d(${he}, ${Ce}, ${Ge}px)\n        rotateZ(${P.rotate?M?-It:It:0}deg)\n        scale(${de<0?""+(1+(1-ct)*de):""+(1-(1-ct)*de)})\n      `;if(P.slideShadows){let Kt=Y.querySelector(".swiper-slide-shadow");Kt||(Kt=hx("cards",Y)),Kt&&(Kt.style.opacity=Math.min(Math.max((Math.abs(de)-.5)/.5,0),1))}Y.style.zIndex=-Math.abs(Math.round(K))+f.length,_E(0,Y).style.transform=Gt}},setTransition:f=>{const w=n.slides.map(M=>dv(M));w.forEach(M=>{M.style.transitionDuration=`${f}ms`,M.querySelectorAll(".swiper-slide-shadow").forEach(P=>{P.style.transitionDuration=`${f}ms`})}),nI({swiper:n,duration:f,transformElements:w})},perspective:()=>!0,overwriteParams:()=>({_loopSwapReset:!1,watchSlidesProgress:!0,loopAdditionalSlides:n.params.cardsEffect.rotate?3:2,centeredSlides:!0,virtualTranslate:!n.params.cssMode})})}]);const iI=["eventsPrefix","injectStyles","injectStylesUrls","modules","init","_direction","oneWayMovement","swiperElementNodeName","touchEventsTarget","initialSlide","_speed","cssMode","updateOnWindowResize","resizeObserver","nested","focusableElements","_enabled","_width","_height","preventInteractionOnTransition","userAgent","url","_edgeSwipeDetection","_edgeSwipeThreshold","_freeMode","_autoHeight","setWrapperSize","virtualTranslate","_effect","breakpoints","breakpointsBase","_spaceBetween","_slidesPerView","maxBackfaceHiddenSlides","_grid","_slidesPerGroup","_slidesPerGroupSkip","_slidesPerGroupAuto","_centeredSlides","_centeredSlidesBounds","_slidesOffsetBefore","_slidesOffsetAfter","normalizeSlideIndex","_centerInsufficientSlides","_watchOverflow","roundLengths","touchRatio","touchAngle","simulateTouch","_shortSwipes","_longSwipes","longSwipesRatio","longSwipesMs","_followFinger","allowTouchMove","_threshold","touchMoveStopPropagation","touchStartPreventDefault","touchStartForcePreventDefault","touchReleaseOnEdges","uniqueNavElements","_resistance","_resistanceRatio","_watchSlidesProgress","_grabCursor","preventClicks","preventClicksPropagation","_slideToClickedSlide","_loop","loopAdditionalSlides","loopAddBlankSlides","loopPreventsSliding","_rewind","_allowSlidePrev","_allowSlideNext","_swipeHandler","_noSwiping","noSwipingClass","noSwipingSelector","passiveListeners","containerModifierClass","slideClass","slideActiveClass","slideVisibleClass","slideFullyVisibleClass","slideNextClass","slidePrevClass","slideBlankClass","wrapperClass","lazyPreloaderClass","lazyPreloadPrevNext","runCallbacksOnInit","observer","observeParents","observeSlideChildren","a11y","_autoplay","_controller","coverflowEffect","cubeEffect","fadeEffect","flipEffect","creativeEffect","cardsEffect","hashNavigation","history","keyboard","mousewheel","_navigation","_pagination","parallax","_scrollbar","_thumbs","virtual","zoom","control"];function px(t){return"object"==typeof t&&null!==t&&t.constructor&&"Object"===Object.prototype.toString.call(t).slice(8,-1)&&!t.__swiper__}function iO(t,n){const e=["__proto__","constructor","prototype"];Object.keys(n).filter(i=>e.indexOf(i)<0).forEach(i=>{typeof t[i]>"u"?t[i]=n[i]:px(n[i])&&px(t[i])&&Object.keys(n[i]).length>0?n[i].__swiper__?t[i]=n[i]:iO(t[i],n[i]):t[i]=n[i]})}function rI(t){return void 0===t&&(t=""),t.replace(/-[a-z]/g,n=>n.toUpperCase().replace("-",""))}const qU=t=>{if(parseFloat(t)===Number(t))return Number(t);if("true"===t||""===t)return!0;if("false"===t)return!1;if("null"===t)return null;if("undefined"!==t){if("string"==typeof t&&t.includes("{")&&t.includes("}")&&t.includes('"')){let n;try{n=JSON.parse(t)}catch{n=t}return n}return t}},WU=["a11y","autoplay","controller","cards-effect","coverflow-effect","creative-effect","cube-effect","fade-effect","flip-effect","free-mode","grid","hash-navigation","history","keyboard","mousewheel","navigation","pagination","parallax","scrollbar","thumbs","virtual","zoom"];function YU(t,n,e){const i={},r={};iO(i,JP);const l=[...iI,"on"],f=l.map(M=>M.replace(/_/,""));l.forEach(M=>{M=M.replace("_",""),typeof t[M]<"u"&&(r[M]=t[M])});const w=[...t.attributes];return"string"==typeof n&&typeof e<"u"&&w.push({name:n,value:px(e)?{...e}:e}),w.forEach(M=>{const P=WU.find(L=>M.name.startsWith(`${L}-`));if(P){const L=rI(P),$=rI(M.name.split(`${P}-`)[1]);typeof r[L]>"u"&&(r[L]={}),!0===r[L]&&(r[L]={enabled:!0}),r[L][$]=qU(M.value)}else{const L=rI(M.name);if(!f.includes(L))return;const $=qU(M.value);r[L]&&WU.includes(M.name)&&!px($)?(r[L].constructor!==Object&&(r[L]={}),r[L].enabled=!!$):r[L]=$}}),iO(i,r),i.navigation?i.navigation={prevEl:".swiper-button-prev",nextEl:".swiper-button-next",...!0!==i.navigation?i.navigation:{}}:!1===i.navigation&&delete i.navigation,i.scrollbar?i.scrollbar={el:".swiper-scrollbar",...!0!==i.scrollbar?i.scrollbar:{}}:!1===i.scrollbar&&delete i.scrollbar,i.pagination?i.pagination={el:".swiper-pagination",...!0!==i.pagination?i.pagination:{}}:!1===i.pagination&&delete i.pagination,{params:i,passedParams:r}}const fde=":host{--swiper-theme-color:#007aff}:host{position:relative;display:block;margin-left:auto;margin-right:auto;z-index:1}.swiper{width:100%;height:100%;margin-left:auto;margin-right:auto;position:relative;overflow:hidden;list-style:none;padding:0;z-index:1;display:block}.swiper-vertical>.swiper-wrapper{flex-direction:column}.swiper-wrapper{position:relative;width:100%;height:100%;z-index:1;display:flex;transition-property:transform;transition-timing-function:var(--swiper-wrapper-transition-timing-function,initial);box-sizing:content-box}.swiper-android ::slotted(swiper-slide),.swiper-ios ::slotted(swiper-slide),.swiper-wrapper{transform:translate3d(0px,0,0)}.swiper-horizontal{touch-action:pan-y}.swiper-vertical{touch-action:pan-x}::slotted(swiper-slide){flex-shrink:0;width:100%;height:100%;position:relative;transition-property:transform;display:block}::slotted(.swiper-slide-invisible-blank){visibility:hidden}.swiper-autoheight,.swiper-autoheight ::slotted(swiper-slide){height:auto}.swiper-autoheight .swiper-wrapper{align-items:flex-start;transition-property:transform,height}.swiper-backface-hidden ::slotted(swiper-slide){transform:translateZ(0);-webkit-backface-visibility:hidden;backface-visibility:hidden}.swiper-3d.swiper-css-mode .swiper-wrapper{perspective:1200px}.swiper-3d .swiper-wrapper{transform-style:preserve-3d}.swiper-3d{perspective:1200px}.swiper-3d .swiper-cube-shadow,.swiper-3d ::slotted(swiper-slide){transform-style:preserve-3d}.swiper-css-mode>.swiper-wrapper{overflow:auto;scrollbar-width:none;-ms-overflow-style:none}.swiper-css-mode>.swiper-wrapper::-webkit-scrollbar{display:none}.swiper-css-mode ::slotted(swiper-slide){scroll-snap-align:start start}.swiper-css-mode.swiper-horizontal>.swiper-wrapper{scroll-snap-type:x mandatory}.swiper-css-mode.swiper-vertical>.swiper-wrapper{scroll-snap-type:y mandatory}.swiper-css-mode.swiper-free-mode>.swiper-wrapper{scroll-snap-type:none}.swiper-css-mode.swiper-free-mode ::slotted(swiper-slide){scroll-snap-align:none}.swiper-css-mode.swiper-centered>.swiper-wrapper::before{content:'';flex-shrink:0;order:9999}.swiper-css-mode.swiper-centered ::slotted(swiper-slide){scroll-snap-align:center center;scroll-snap-stop:always}.swiper-css-mode.swiper-centered.swiper-horizontal ::slotted(swiper-slide):first-child{margin-inline-start:var(--swiper-centered-offset-before)}.swiper-css-mode.swiper-centered.swiper-horizontal>.swiper-wrapper::before{height:100%;min-height:1px;width:var(--swiper-centered-offset-after)}.swiper-css-mode.swiper-centered.swiper-vertical ::slotted(swiper-slide):first-child{margin-block-start:var(--swiper-centered-offset-before)}.swiper-css-mode.swiper-centered.swiper-vertical>.swiper-wrapper::before{width:100%;min-width:1px;height:var(--swiper-centered-offset-after)}.swiper-virtual ::slotted(swiper-slide){-webkit-backface-visibility:hidden;transform:translateZ(0)}.swiper-virtual.swiper-css-mode .swiper-wrapper::after{content:'';position:absolute;left:0;top:0;pointer-events:none}.swiper-virtual.swiper-css-mode.swiper-horizontal .swiper-wrapper::after{height:1px;width:var(--swiper-virtual-size)}.swiper-virtual.swiper-css-mode.swiper-vertical .swiper-wrapper::after{width:1px;height:var(--swiper-virtual-size)}:host{--swiper-navigation-size:44px}.swiper-button-next,.swiper-button-prev{position:absolute;top:var(--swiper-navigation-top-offset,50%);width:calc(var(--swiper-navigation-size)/ 44 * 27);height:var(--swiper-navigation-size);margin-top:calc(0px - (var(--swiper-navigation-size)/ 2));z-index:10;cursor:pointer;display:flex;align-items:center;justify-content:center;color:var(--swiper-navigation-color,var(--swiper-theme-color))}.swiper-button-next.swiper-button-disabled,.swiper-button-prev.swiper-button-disabled{opacity:.35;cursor:auto;pointer-events:none}.swiper-button-next.swiper-button-hidden,.swiper-button-prev.swiper-button-hidden{opacity:0;cursor:auto;pointer-events:none}.swiper-navigation-disabled .swiper-button-next,.swiper-navigation-disabled .swiper-button-prev{display:none!important}.swiper-button-next svg,.swiper-button-prev svg{width:100%;height:100%;object-fit:contain;transform-origin:center}.swiper-rtl .swiper-button-next svg,.swiper-rtl .swiper-button-prev svg{transform:rotate(180deg)}.swiper-button-prev,.swiper-rtl .swiper-button-next{left:var(--swiper-navigation-sides-offset,10px);right:auto}.swiper-button-next,.swiper-rtl .swiper-button-prev{right:var(--swiper-navigation-sides-offset,10px);left:auto}.swiper-button-lock{display:none}.swiper-pagination{position:absolute;text-align:center;transition:.3s opacity;transform:translate3d(0,0,0);z-index:10}.swiper-pagination.swiper-pagination-hidden{opacity:0}.swiper-pagination-disabled>.swiper-pagination,.swiper-pagination.swiper-pagination-disabled{display:none!important}.swiper-horizontal>.swiper-pagination-bullets,.swiper-pagination-bullets.swiper-pagination-horizontal,.swiper-pagination-custom,.swiper-pagination-fraction{bottom:var(--swiper-pagination-bottom,8px);top:var(--swiper-pagination-top,auto);left:0;width:100%}.swiper-pagination-bullets-dynamic{overflow:hidden;font-size:0}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet{transform:scale(.33);position:relative}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active{transform:scale(1)}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active-main{transform:scale(1)}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active-prev{transform:scale(.66)}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active-prev-prev{transform:scale(.33)}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active-next{transform:scale(.66)}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active-next-next{transform:scale(.33)}.swiper-pagination-bullet{width:var(--swiper-pagination-bullet-width,var(--swiper-pagination-bullet-size,8px));height:var(--swiper-pagination-bullet-height,var(--swiper-pagination-bullet-size,8px));display:inline-block;border-radius:var(--swiper-pagination-bullet-border-radius,50%);background:var(--swiper-pagination-bullet-inactive-color,#000);opacity:var(--swiper-pagination-bullet-inactive-opacity, .2)}button.swiper-pagination-bullet{border:none;margin:0;padding:0;box-shadow:none;-webkit-appearance:none;appearance:none}.swiper-pagination-clickable .swiper-pagination-bullet{cursor:pointer}.swiper-pagination-bullet:only-child{display:none!important}.swiper-pagination-bullet-active{opacity:var(--swiper-pagination-bullet-opacity, 1);background:var(--swiper-pagination-color,var(--swiper-theme-color))}.swiper-pagination-vertical.swiper-pagination-bullets,.swiper-vertical>.swiper-pagination-bullets{right:var(--swiper-pagination-right,8px);left:var(--swiper-pagination-left,auto);top:50%;transform:translate3d(0px,-50%,0)}.swiper-pagination-vertical.swiper-pagination-bullets .swiper-pagination-bullet,.swiper-vertical>.swiper-pagination-bullets .swiper-pagination-bullet{margin:var(--swiper-pagination-bullet-vertical-gap,6px) 0;display:block}.swiper-pagination-vertical.swiper-pagination-bullets.swiper-pagination-bullets-dynamic,.swiper-vertical>.swiper-pagination-bullets.swiper-pagination-bullets-dynamic{top:50%;transform:translateY(-50%);width:8px}.swiper-pagination-vertical.swiper-pagination-bullets.swiper-pagination-bullets-dynamic .swiper-pagination-bullet,.swiper-vertical>.swiper-pagination-bullets.swiper-pagination-bullets-dynamic .swiper-pagination-bullet{display:inline-block;transition:.2s transform,.2s top}.swiper-horizontal>.swiper-pagination-bullets .swiper-pagination-bullet,.swiper-pagination-horizontal.swiper-pagination-bullets .swiper-pagination-bullet{margin:0 var(--swiper-pagination-bullet-horizontal-gap,4px)}.swiper-horizontal>.swiper-pagination-bullets.swiper-pagination-bullets-dynamic,.swiper-pagination-horizontal.swiper-pagination-bullets.swiper-pagination-bullets-dynamic{left:50%;transform:translateX(-50%);white-space:nowrap}.swiper-horizontal>.swiper-pagination-bullets.swiper-pagination-bullets-dynamic .swiper-pagination-bullet,.swiper-pagination-horizontal.swiper-pagination-bullets.swiper-pagination-bullets-dynamic .swiper-pagination-bullet{transition:.2s transform,.2s left}.swiper-horizontal.swiper-rtl>.swiper-pagination-bullets-dynamic .swiper-pagination-bullet{transition:.2s transform,.2s right}.swiper-pagination-fraction{color:var(--swiper-pagination-fraction-color,inherit)}.swiper-pagination-progressbar{background:var(--swiper-pagination-progressbar-bg-color,rgba(0,0,0,.25));position:absolute}.swiper-pagination-progressbar .swiper-pagination-progressbar-fill{background:var(--swiper-pagination-color,var(--swiper-theme-color));position:absolute;left:0;top:0;width:100%;height:100%;transform:scale(0);transform-origin:left top}.swiper-rtl .swiper-pagination-progressbar .swiper-pagination-progressbar-fill{transform-origin:right top}.swiper-horizontal>.swiper-pagination-progressbar,.swiper-pagination-progressbar.swiper-pagination-horizontal,.swiper-pagination-progressbar.swiper-pagination-vertical.swiper-pagination-progressbar-opposite,.swiper-vertical>.swiper-pagination-progressbar.swiper-pagination-progressbar-opposite{width:100%;height:var(--swiper-pagination-progressbar-size,4px);left:0;top:0}.swiper-horizontal>.swiper-pagination-progressbar.swiper-pagination-progressbar-opposite,.swiper-pagination-progressbar.swiper-pagination-horizontal.swiper-pagination-progressbar-opposite,.swiper-pagination-progressbar.swiper-pagination-vertical,.swiper-vertical>.swiper-pagination-progressbar{width:var(--swiper-pagination-progressbar-size,4px);height:100%;left:0;top:0}.swiper-pagination-lock{display:none}.swiper-scrollbar{border-radius:var(--swiper-scrollbar-border-radius,10px);position:relative;touch-action:none;background:var(--swiper-scrollbar-bg-color,rgba(0,0,0,.1))}.swiper-scrollbar-disabled>.swiper-scrollbar,.swiper-scrollbar.swiper-scrollbar-disabled{display:none!important}.swiper-horizontal>.swiper-scrollbar,.swiper-scrollbar.swiper-scrollbar-horizontal{position:absolute;left:var(--swiper-scrollbar-sides-offset,1%);bottom:var(--swiper-scrollbar-bottom,4px);top:var(--swiper-scrollbar-top,auto);z-index:50;height:var(--swiper-scrollbar-size,4px);width:calc(100% - 2 * var(--swiper-scrollbar-sides-offset,1%))}.swiper-scrollbar.swiper-scrollbar-vertical,.swiper-vertical>.swiper-scrollbar{position:absolute;left:var(--swiper-scrollbar-left,auto);right:var(--swiper-scrollbar-right,4px);top:var(--swiper-scrollbar-sides-offset,1%);z-index:50;width:var(--swiper-scrollbar-size,4px);height:calc(100% - 2 * var(--swiper-scrollbar-sides-offset,1%))}.swiper-scrollbar-drag{height:100%;width:100%;position:relative;background:var(--swiper-scrollbar-drag-bg-color,rgba(0,0,0,.5));border-radius:var(--swiper-scrollbar-border-radius,10px);left:0;top:0}.swiper-scrollbar-cursor-drag{cursor:move}.swiper-scrollbar-lock{display:none}::slotted(.swiper-slide-zoomed){cursor:move;touch-action:none}.swiper .swiper-notification{position:absolute;left:0;top:0;pointer-events:none;opacity:0;z-index:-1000}.swiper-free-mode>.swiper-wrapper{transition-timing-function:ease-out;margin:0 auto}.swiper-grid>.swiper-wrapper{flex-wrap:wrap}.swiper-grid-column>.swiper-wrapper{flex-wrap:wrap;flex-direction:column}.swiper-fade.swiper-free-mode ::slotted(swiper-slide){transition-timing-function:ease-out}.swiper-fade ::slotted(swiper-slide){pointer-events:none;transition-property:opacity}.swiper-fade ::slotted(swiper-slide) ::slotted(swiper-slide){pointer-events:none}.swiper-fade ::slotted(.swiper-slide-active){pointer-events:auto}.swiper-fade ::slotted(.swiper-slide-active) ::slotted(.swiper-slide-active){pointer-events:auto}.swiper.swiper-cube{overflow:visible}.swiper-cube ::slotted(swiper-slide){pointer-events:none;-webkit-backface-visibility:hidden;backface-visibility:hidden;z-index:1;visibility:hidden;transform-origin:0 0;width:100%;height:100%}.swiper-cube ::slotted(swiper-slide) ::slotted(swiper-slide){pointer-events:none}.swiper-cube.swiper-rtl ::slotted(swiper-slide){transform-origin:100% 0}.swiper-cube ::slotted(.swiper-slide-active),.swiper-cube ::slotted(.swiper-slide-active) ::slotted(.swiper-slide-active){pointer-events:auto}.swiper-cube ::slotted(.swiper-slide-active),.swiper-cube ::slotted(.swiper-slide-next),.swiper-cube ::slotted(.swiper-slide-prev){pointer-events:auto;visibility:visible}.swiper-cube .swiper-cube-shadow{position:absolute;left:0;bottom:0px;width:100%;height:100%;opacity:.6;z-index:0}.swiper-cube .swiper-cube-shadow:before{content:'';background:#000;position:absolute;left:0;top:0;bottom:0;right:0;filter:blur(50px)}.swiper-cube ::slotted(.swiper-slide-next)+::slotted(swiper-slide){pointer-events:auto;visibility:visible}.swiper.swiper-flip{overflow:visible}.swiper-flip ::slotted(swiper-slide){pointer-events:none;-webkit-backface-visibility:hidden;backface-visibility:hidden;z-index:1}.swiper-flip ::slotted(swiper-slide) ::slotted(swiper-slide){pointer-events:none}.swiper-flip ::slotted(.swiper-slide-active),.swiper-flip ::slotted(.swiper-slide-active) ::slotted(.swiper-slide-active){pointer-events:auto}.swiper-creative ::slotted(swiper-slide){-webkit-backface-visibility:hidden;backface-visibility:hidden;overflow:hidden;transition-property:transform,opacity,height}.swiper.swiper-cards{overflow:visible}.swiper-cards ::slotted(swiper-slide){transform-origin:center bottom;-webkit-backface-visibility:hidden;backface-visibility:hidden;overflow:hidden}",ZU=typeof window>"u"||typeof HTMLElement>"u"?class gde{}:HTMLElement,XU='<svg width="11" height="20" viewBox="0 0 11 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M0.38296 20.0762C0.111788 19.805 0.111788 19.3654 0.38296 19.0942L9.19758 10.2796L0.38296 1.46497C0.111788 1.19379 0.111788 0.754138 0.38296 0.482966C0.654131 0.211794 1.09379 0.211794 1.36496 0.482966L10.4341 9.55214C10.8359 9.9539 10.8359 10.6053 10.4341 11.007L1.36496 20.0762C1.09379 20.3474 0.654131 20.3474 0.38296 20.0762Z" fill="currentColor"/></svg>\n    ',KU=(t,n)=>{if(typeof CSSStyleSheet<"u"&&t.adoptedStyleSheets){const e=new CSSStyleSheet;e.replaceSync(n),t.adoptedStyleSheets=[e]}else{const e=document.createElement("style");e.rel="stylesheet",e.textContent=n,t.appendChild(e)}};class QU extends ZU{constructor(){super(),this.attachShadow({mode:"open"})}static get nextButtonSvg(){return XU}static get prevButtonSvg(){return XU.replace("/></svg>",' transform-origin="center" transform="rotate(180)"/></svg>')}cssStyles(){return[fde,...this.injectStyles&&Array.isArray(this.injectStyles)?this.injectStyles:[]].join("\n")}cssLinks(){return this.injectStylesUrls||[]}calcSlideSlots(){const n=this.slideSlots||0,e=[...this.querySelectorAll("[slot^=slide-]")].map(i=>parseInt(i.getAttribute("slot").split("slide-")[1],10));if(this.slideSlots=e.length?Math.max(...e)+1:0,this.rendered)if(this.slideSlots>n)for(let i=n;i<this.slideSlots;i+=1){const r=document.createElement("swiper-slide");r.setAttribute("part",`slide slide-${i+1}`);const l=document.createElement("slot");l.setAttribute("name",`slide-${i+1}`),r.appendChild(l),this.shadowRoot.querySelector(".swiper-wrapper").appendChild(r)}else if(this.slideSlots<n){const i=this.swiper.slides;for(let r=i.length-1;r>=0;r-=1)r>this.slideSlots&&i[r].remove()}}render(){if(this.rendered)return;this.calcSlideSlots();let n=this.cssStyles();this.slideSlots>0&&(n=n.replace(/::slotted\(([a-z-0-9.]*)\)/g,"$1")),n.length&&KU(this.shadowRoot,n),this.cssLinks().forEach(i=>{if(this.shadowRoot.querySelector(`link[href="${i}"]`))return;const l=document.createElement("link");l.rel="stylesheet",l.href=i,this.shadowRoot.appendChild(l)});const e=document.createElement("div");e.classList.add("swiper"),e.part="container",e.innerHTML=`\n      <slot name="container-start"></slot>\n      <div class="swiper-wrapper" part="wrapper">\n        <slot></slot>\n        ${Array.from({length:this.slideSlots}).map((i,r)=>`\n        <swiper-slide part="slide slide-${r}">\n          <slot name="slide-${r}"></slot>\n        </swiper-slide>\n        `).join("")}\n      </div>\n      <slot name="container-end"></slot>\n      ${function dde(t){return void 0===t&&(t={}),t.navigation&&typeof t.navigation.nextEl>"u"&&typeof t.navigation.prevEl>"u"}(this.passedParams)?`\n        <div part="button-prev" class="swiper-button-prev">${this.constructor.prevButtonSvg}</div>\n        <div part="button-next" class="swiper-button-next">${this.constructor.nextButtonSvg}</div>\n      `:""}\n      ${function ude(t){return void 0===t&&(t={}),t.pagination&&typeof t.pagination.el>"u"}(this.passedParams)?'\n        <div part="pagination" class="swiper-pagination"></div>\n      ':""}\n      ${function hde(t){return void 0===t&&(t={}),t.scrollbar&&typeof t.scrollbar.el>"u"}(this.passedParams)?'\n        <div part="scrollbar" class="swiper-scrollbar"></div>\n      ':""}\n    `,this.shadowRoot.appendChild(e),this.rendered=!0}initialize(){var n=this;if(this.swiper&&this.swiper.initialized)return;const{params:e,passedParams:i}=YU(this);this.swiperParams=e,this.passedParams=i,delete this.swiperParams.init,this.render(),this.swiper=new Fd(this.shadowRoot.querySelector(".swiper"),{...e.virtual?{}:{observer:!0},...e,touchEventsTarget:"container",onAny:function(r){"observerUpdate"===r&&n.calcSlideSlots();const l=e.eventsPrefix?`${e.eventsPrefix}${r.toLowerCase()}`:r.toLowerCase();for(var f=arguments.length,w=new Array(f>1?f-1:0),M=1;M<f;M++)w[M-1]=arguments[M];const P=new CustomEvent(l,{detail:w,bubbles:"hashChange"!==r,cancelable:!0});n.dispatchEvent(P)}})}connectedCallback(){this.swiper&&this.swiper.initialized&&this.nested&&this.closest("swiper-slide")&&this.closest("swiper-slide").swiperLoopMoveDOM||!1===this.init||"false"===this.getAttribute("init")||this.initialize()}disconnectedCallback(){this.nested&&this.closest("swiper-slide")&&this.closest("swiper-slide").swiperLoopMoveDOM||this.swiper&&this.swiper.destroy&&this.swiper.destroy()}updateSwiperOnPropChange(n,e){const{params:i,passedParams:r}=YU(this,n,e);this.passedParams=r,this.swiperParams=i,(!this.swiper||this.swiper.params[n]!==e)&&function pde(t){let{swiper:n,slides:e,passedParams:i,changedParams:r,nextEl:l,prevEl:f,scrollbarEl:w,paginationEl:M}=t;const P=r.filter(mt=>"children"!==mt&&"direction"!==mt&&"wrapperClass"!==mt),{params:L,pagination:$,navigation:Q,scrollbar:X,virtual:Y,thumbs:K}=n;let de,ye,he,Ce,Ge,ct,It,Pt;r.includes("thumbs")&&i.thumbs&&i.thumbs.swiper&&!i.thumbs.swiper.destroyed&&L.thumbs&&(!L.thumbs.swiper||L.thumbs.swiper.destroyed)&&(de=!0),r.includes("controller")&&i.controller&&i.controller.control&&L.controller&&!L.controller.control&&(ye=!0),r.includes("pagination")&&i.pagination&&(i.pagination.el||M)&&(L.pagination||!1===L.pagination)&&$&&!$.el&&(he=!0),r.includes("scrollbar")&&i.scrollbar&&(i.scrollbar.el||w)&&(L.scrollbar||!1===L.scrollbar)&&X&&!X.el&&(Ce=!0),r.includes("navigation")&&i.navigation&&(i.navigation.prevEl||f)&&(i.navigation.nextEl||l)&&(L.navigation||!1===L.navigation)&&Q&&!Q.prevEl&&!Q.nextEl&&(Ge=!0);const $t=mt=>{n[mt]&&(n[mt].destroy(),"navigation"===mt?(n.isElement&&(n[mt].prevEl.remove(),n[mt].nextEl.remove()),L[mt].prevEl=void 0,L[mt].nextEl=void 0,n[mt].prevEl=void 0,n[mt].nextEl=void 0):(n.isElement&&n[mt].el.remove(),L[mt].el=void 0,n[mt].el=void 0))};r.includes("loop")&&n.isElement&&(L.loop&&!i.loop?ct=!0:!L.loop&&i.loop?It=!0:Pt=!0),P.forEach(mt=>{if(px(L[mt])&&px(i[mt]))Object.assign(L[mt],i[mt]),("navigation"===mt||"pagination"===mt||"scrollbar"===mt)&&"enabled"in i[mt]&&!i[mt].enabled&&$t(mt);else{const At=i[mt];!0!==At&&!1!==At||"navigation"!==mt&&"pagination"!==mt&&"scrollbar"!==mt?L[mt]=i[mt]:!1===At&&$t(mt)}}),P.includes("controller")&&!ye&&n.controller&&n.controller.control&&L.controller&&L.controller.control&&(n.controller.control=L.controller.control),r.includes("children")&&e&&Y&&L.virtual.enabled?(Y.slides=e,Y.update(!0)):r.includes("virtual")&&Y&&L.virtual.enabled&&(e&&(Y.slides=e),Y.update(!0)),r.includes("children")&&e&&L.loop&&(Pt=!0),de&&K.init()&&K.update(!0),ye&&(n.controller.control=L.controller.control),he&&(n.isElement&&(!M||"string"==typeof M)&&(M=document.createElement("div"),M.classList.add("swiper-pagination"),M.part.add("pagination"),n.el.appendChild(M)),M&&(L.pagination.el=M),$.init(),$.render(),$.update()),Ce&&(n.isElement&&(!w||"string"==typeof w)&&(w=document.createElement("div"),w.classList.add("swiper-scrollbar"),w.part.add("scrollbar"),n.el.appendChild(w)),w&&(L.scrollbar.el=w),X.init(),X.updateSize(),X.setTranslate()),Ge&&(n.isElement&&((!l||"string"==typeof l)&&(l=document.createElement("div"),l.classList.add("swiper-button-next"),l.innerHTML=n.hostEl.constructor.nextButtonSvg,l.part.add("button-next"),n.el.appendChild(l)),(!f||"string"==typeof f)&&(f=document.createElement("div"),f.classList.add("swiper-button-prev"),f.innerHTML=n.hostEl.constructor.prevButtonSvg,f.part.add("button-prev"),n.el.appendChild(f))),l&&(L.navigation.nextEl=l),f&&(L.navigation.prevEl=f),Q.init(),Q.update()),r.includes("allowSlideNext")&&(n.allowSlideNext=i.allowSlideNext),r.includes("allowSlidePrev")&&(n.allowSlidePrev=i.allowSlidePrev),r.includes("direction")&&n.changeDirection(i.direction,!1),(ct||Pt)&&n.loopDestroy(),(It||Pt)&&n.loopCreate(),n.update()}({swiper:this.swiper,passedParams:this.passedParams,changedParams:[rI(n)],..."navigation"===n&&r[n]?{prevEl:".swiper-button-prev",nextEl:".swiper-button-next"}:{},..."pagination"===n&&r[n]?{paginationEl:".swiper-pagination"}:{},..."scrollbar"===n&&r[n]?{scrollbarEl:".swiper-scrollbar"}:{}})}attributeChangedCallback(n,e,i){this.swiper&&this.swiper.initialized&&("true"===e&&null===i&&(i=!1),this.updateSwiperOnPropChange(n,i))}static get observedAttributes(){return iI.filter(e=>e.includes("_")).map(e=>e.replace(/[A-Z]/g,i=>`-${i}`).replace("_","").toLowerCase())}}iI.forEach(t=>{"init"!==t&&(t=t.replace("_",""),Object.defineProperty(QU.prototype,t,{configurable:!0,get(){return(this.passedParams||{})[t]},set(n){this.passedParams||(this.passedParams={}),this.passedParams[t]=n,this.swiper&&this.swiper.initialized&&this.updateSwiperOnPropChange(t,n)}}))});typeof window<"u"&&(window.SwiperElementRegisterParams=t=>{iI.push(...t)}),typeof window>"u"||(window.customElements.get("swiper-container")||window.customElements.define("swiper-container",QU),window.customElements.get("swiper-slide")||window.customElements.define("swiper-slide",class _de extends ZU{constructor(){super(),this.attachShadow({mode:"open"})}render(){const n=this.lazy||""===this.getAttribute("lazy")||"true"===this.getAttribute("lazy");if(KU(this.shadowRoot,"::slotted(.swiper-slide-shadow),::slotted(.swiper-slide-shadow-bottom),::slotted(.swiper-slide-shadow-left),::slotted(.swiper-slide-shadow-right),::slotted(.swiper-slide-shadow-top){position:absolute;left:0;top:0;width:100%;height:100%;pointer-events:none;z-index:10}::slotted(.swiper-slide-shadow){background:rgba(0,0,0,.15)}::slotted(.swiper-slide-shadow-left){background-image:linear-gradient(to left,rgba(0,0,0,.5),rgba(0,0,0,0))}::slotted(.swiper-slide-shadow-right){background-image:linear-gradient(to right,rgba(0,0,0,.5),rgba(0,0,0,0))}::slotted(.swiper-slide-shadow-top){background-image:linear-gradient(to top,rgba(0,0,0,.5),rgba(0,0,0,0))}::slotted(.swiper-slide-shadow-bottom){background-image:linear-gradient(to bottom,rgba(0,0,0,.5),rgba(0,0,0,0))}.swiper-lazy-preloader{animation:swiper-preloader-spin 1s infinite linear;width:42px;height:42px;position:absolute;left:50%;top:50%;margin-left:-21px;margin-top:-21px;z-index:10;transform-origin:50%;box-sizing:border-box;border:4px solid var(--swiper-preloader-color,var(--swiper-theme-color));border-radius:50%;border-top-color:transparent}@keyframes swiper-preloader-spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}::slotted(.swiper-slide-shadow-cube.swiper-slide-shadow-bottom),::slotted(.swiper-slide-shadow-cube.swiper-slide-shadow-left),::slotted(.swiper-slide-shadow-cube.swiper-slide-shadow-right),::slotted(.swiper-slide-shadow-cube.swiper-slide-shadow-top){z-index:0;-webkit-backface-visibility:hidden;backface-visibility:hidden}::slotted(.swiper-slide-shadow-flip.swiper-slide-shadow-bottom),::slotted(.swiper-slide-shadow-flip.swiper-slide-shadow-left),::slotted(.swiper-slide-shadow-flip.swiper-slide-shadow-right),::slotted(.swiper-slide-shadow-flip.swiper-slide-shadow-top){z-index:0;-webkit-backface-visibility:hidden;backface-visibility:hidden}::slotted(.swiper-zoom-container){width:100%;height:100%;display:flex;justify-content:center;align-items:center;text-align:center}::slotted(.swiper-zoom-container)>canvas,::slotted(.swiper-zoom-container)>img,::slotted(.swiper-zoom-container)>svg{max-width:100%;max-height:100%;object-fit:contain}"),this.shadowRoot.appendChild(document.createElement("slot")),n){const e=document.createElement("div");e.classList.add("swiper-lazy-preloader"),e.part.add("preloader"),this.shadowRoot.appendChild(e)}}initialize(){this.render()}connectedCallback(){this.swiperLoopMoveDOM||this.initialize()}})),function sW(t,n){return $G({rootComponent:t,...M3(n)})}(gee,{providers:[function XX(...t){const n=[Eu,VB,zB,{provide:zM,useExisting:zB},{provide:BM,useFactory:()=>te(OB,{optional:!0})??te(VB)},{provide:SC,useValue:ZX,multi:!0},{provide:Y2,useValue:!0},{provide:HB,useClass:YX}];for(const e of t)n.push(...e.\u0275providers);return ul(n)}(function KX(){return function Gy(t,n){return{\u0275kind:t,\u0275providers:n}}(Ng.LegacyInterceptors,[{provide:$B,useFactory:BX},{provide:SC,useExisting:$B,multi:!0}])}()),{provide:LB,useClass:_le,multi:!0},function uX(t,...n){return ul([{provide:bC,multi:!0,useValue:t},[],{provide:Fg,useFactory:bB,deps:[oo]},{provide:u0,multi:!0,useFactory:xB},n.map(e=>e.\u0275providers)])}(gle)]}).catch(t=>console.error(t))},578:function(hm,Ph){var Ll,nl;void 0!==(nl="function"==typeof(Ll=function(){"use strict";function h(nr,jn,ri){var Bi=new XMLHttpRequest;Bi.open("GET",nr),Bi.responseType="blob",Bi.onload=function(){To(Bi.response,jn,ri)},Bi.onerror=function(){console.error("could not download file")},Bi.send()}function Jr(nr){var jn=new XMLHttpRequest;jn.open("HEAD",nr,!1);try{jn.send()}catch{}return 200<=jn.status&&299>=jn.status}function Ro(nr){try{nr.dispatchEvent(new MouseEvent("click"))}catch{var jn=document.createEvent("MouseEvents");jn.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),nr.dispatchEvent(jn)}}var Kn="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:void 0,Gn=Kn.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),To=Kn.saveAs||("object"!=typeof window||window!==Kn?function(){}:"download"in HTMLAnchorElement.prototype&&!Gn?function(nr,jn,ri){var Bi=Kn.URL||Kn.webkitURL,fi=document.createElement("a");fi.download=jn=jn||nr.name||"download",fi.rel="noopener","string"==typeof nr?(fi.href=nr,fi.origin===location.origin?Ro(fi):Jr(fi.href)?h(nr,jn,ri):Ro(fi,fi.target="_blank")):(fi.href=Bi.createObjectURL(nr),setTimeout(function(){Bi.revokeObjectURL(fi.href)},4e4),setTimeout(function(){Ro(fi)},0))}:"msSaveOrOpenBlob"in navigator?function(nr,jn,ri){if(jn=jn||nr.name||"download","string"!=typeof nr)navigator.msSaveOrOpenBlob(function pm(nr,jn){return typeof jn>"u"?jn={autoBom:!1}:"object"!=typeof jn&&(console.warn("Deprecated: Expected third argument to be a object"),jn={autoBom:!jn}),jn.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(nr.type)?new Blob(["\ufeff",nr],{type:nr.type}):nr}(nr,ri),jn);else if(Jr(nr))h(nr,jn,ri);else{var Bi=document.createElement("a");Bi.href=nr,Bi.target="_blank",setTimeout(function(){Ro(Bi)})}}:function(nr,jn,ri,Bi){if((Bi=Bi||open("","_blank"))&&(Bi.document.title=Bi.document.body.innerText="downloading..."),"string"==typeof nr)return h(nr,jn,ri);var fi="application/octet-stream"===nr.type,Ta=/constructor/i.test(Kn.HTMLElement)||Kn.safari,jc=/CriOS\/[\d]+/.test(navigator.userAgent);if((jc||fi&&Ta||Gn)&&typeof FileReader<"u"){var Li=new FileReader;Li.onloadend=function(){var Sn=Li.result;Sn=jc?Sn:Sn.replace(/^data:[^;]*;/,"data:attachment/file;"),Bi?Bi.location.href=Sn:location=Sn,Bi=null},Li.readAsDataURL(nr)}else{var Ld=Kn.URL||Kn.webkitURL,Ia=Ld.createObjectURL(nr);Bi?Bi.location=Ia:location.href=Ia,Bi=null,setTimeout(function(){Ld.revokeObjectURL(Ia)},4e4)}});Kn.saveAs=To.saveAs=To,hm.exports=To})?Ll.apply(Ph,[]):Ll)&&(hm.exports=nl)}},hm=>{hm(hm.s=458)}]);